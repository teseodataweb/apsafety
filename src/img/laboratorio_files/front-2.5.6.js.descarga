/* front
 * version 2.5.6
 * -------------------- */

/* /js/libs/json2.js
 * compresion time: 0.04578 -(ms)
 * ----------------- */
/*
    json2.js
    2011-10-19

    Public Domain.

    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.

    See http://www.JSON.org/js.html


    This code should be minified before deployment.
    See http://javascript.crockford.com/jsmin.html

    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO
    NOT CONTROL.


    This file creates a global JSON object containing two methods: stringify
    and parse.

        JSON.stringify(value, replacer, space)
            value       any JavaScript value, usually an object or array.

            replacer    an optional parameter that determines how object
                        values are stringified for objects. It can be a
                        function or an array of strings.

            space       an optional parameter that specifies the indentation
                        of nested structures. If it is omitted, the text will
                        be packed without extra whitespace. If it is a number,
                        it will specify the number of spaces to indent at each
                        level. If it is a string (such as '\t' or '&nbsp;'),
                        it contains the characters used to indent at each level.

            This method produces a JSON text from a JavaScript value.

            When an object value is found, if the object contains a toJSON
            method, its toJSON method will be called and the result will be
            stringified. A toJSON method does not serialize: it returns the
            value represented by the name/value pair that should be serialized,
            or undefined if nothing should be serialized. The toJSON method
            will be passed the key associated with the value, and this will be
            bound to the value

            For example, this would serialize Dates as ISO strings.

                Date.prototype.toJSON = function (key) {
                    function f(n) {
                        // Format integers to have at least two digits.
                        return n < 10 ? '0' + n : n;
                    }

                    return this.getUTCFullYear()   + '-' +
                         f(this.getUTCMonth() + 1) + '-' +
                         f(this.getUTCDate())      + 'T' +
                         f(this.getUTCHours())     + ':' +
                         f(this.getUTCMinutes())   + ':' +
                         f(this.getUTCSeconds())   + 'Z';
                };

            You can provide an optional replacer method. It will be passed the
            key and value of each member, with this bound to the containing
            object. The value that is returned from your method will be
            serialized. If your method returns undefined, then the member will
            be excluded from the serialization.

            If the replacer parameter is an array of strings, then it will be
            used to select the members to be serialized. It filters the results
            such that only members with keys listed in the replacer array are
            stringified.

            Values that do not have JSON representations, such as undefined or
            functions, will not be serialized. Such values in objects will be
            dropped; in arrays they will be replaced with null. You can use
            a replacer function to replace those with JSON values.
            JSON.stringify(undefined) returns undefined.

            The optional space parameter produces a stringification of the
            value that is filled with line breaks and indentation to make it
            easier to read.

            If the space parameter is a non-empty string, then that string will
            be used for indentation. If the space parameter is a number, then
            the indentation will be that many spaces.

            Example:

            text = JSON.stringify(['e', {pluribus: 'unum'}]);
            // text is '["e",{"pluribus":"unum"}]'


            text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\t');
            // text is '[\n\t"e",\n\t{\n\t\t"pluribus": "unum"\n\t}\n]'

            text = JSON.stringify([new Date()], function (key, value) {
                return this[key] instanceof Date ?
                    'Date(' + this[key] + ')' : value;
            });
            // text is '["Date(---current time---)"]'


        JSON.parse(text, reviver)
            This method parses a JSON text to produce an object or array.
            It can throw a SyntaxError exception.

            The optional reviver parameter is a function that can filter and
            transform the results. It receives each of the keys and values,
            and its return value is used instead of the original value.
            If it returns what it received, then the structure is not modified.
            If it returns undefined then the member is deleted.

            Example:

            // Parse the text. Values that look like ISO date strings will
            // be converted to Date objects.

            myData = JSON.parse(text, function (key, value) {
                var a;
                if (typeof value === 'string') {
                    a =
/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(value);
                    if (a) {
                        return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],
                            +a[5], +a[6]));
                    }
                }
                return value;
            });

            myData = JSON.parse('["Date(09/09/2001)"]', function (key, value) {
                var d;
                if (typeof value === 'string' &&
                        value.slice(0, 5) === 'Date(' &&
                        value.slice(-1) === ')') {
                    d = new Date(value.slice(5, -1));
                    if (d) {
                        return d;
                    }
                }
                return value;
            });


    This is a reference implementation. You are free to copy, modify, or
    redistribute.
*/

/*jslint evil: true, regexp: true */

/*members "", "\b", "\t", "\n", "\f", "\r", "\"", JSON, "\\", apply,
    call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,
    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,
    lastIndex, length, parse, prototype, push, replace, slice, stringify,
    test, toJSON, toString, valueOf
*/


// Create a JSON object only if one does not already exist. We create the
// methods in a closure to avoid creating global variables.

var JSON;
if (!JSON) {
    JSON = {};
}

(function () {
    'use strict';

    function f(n) {
        // Format integers to have at least two digits.
        return n < 10 ? '0' + n : n;
    }

    if (typeof Date.prototype.toJSON !== 'function') {

        Date.prototype.toJSON = function (key) {

            return isFinite(this.valueOf())
                ? this.getUTCFullYear()     + '-' +
                    f(this.getUTCMonth() + 1) + '-' +
                    f(this.getUTCDate())      + 'T' +
                    f(this.getUTCHours())     + ':' +
                    f(this.getUTCMinutes())   + ':' +
                    f(this.getUTCSeconds())   + 'Z'
                : null;
        };

        String.prototype.toJSON      =
            Number.prototype.toJSON  =
            Boolean.prototype.toJSON = function (key) {
                return this.valueOf();
            };
    }

    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        gap,
        indent,
        meta = {    // table of character substitutions
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '"' : '\\"',
            '\\': '\\\\'
        },
        rep;


    function quote(string) {

// If the string contains no control characters, no quote characters, and no
// backslash characters, then we can safely slap some quotes around it.
// Otherwise we must also replace the offending characters with safe escape
// sequences.

        escapable.lastIndex = 0;
        return escapable.test(string) ? '"' + string.replace(escapable, function (a) {
            var c = meta[a];
            return typeof c === 'string'
                ? c
                : '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
        }) + '"' : '"' + string + '"';
    }


    function str(key, holder) {

// Produce a string from holder[key].

        var i,          // The loop counter.
            k,          // The member key.
            v,          // The member value.
            length,
            mind = gap,
            partial,
            value = holder[key];

// If the value has a toJSON method, call it to obtain a replacement value.

        if (value && typeof value === 'object' &&
                typeof value.toJSON === 'function') {
            value = value.toJSON(key);
        }

// If we were called with a replacer function, then call the replacer to
// obtain a replacement value.

        if (typeof rep === 'function') {
            value = rep.call(holder, key, value);
        }

// What happens next depends on the value's type.

        switch (typeof value) {
        case 'string':
            return quote(value);

        case 'number':

// JSON numbers must be finite. Encode non-finite numbers as null.

            return isFinite(value) ? String(value) : 'null';

        case 'boolean':
        case 'null':

// If the value is a boolean or null, convert it to a string. Note:
// typeof null does not produce 'null'. The case is included here in
// the remote chance that this gets fixed someday.

            return String(value);

// If the type is 'object', we might be dealing with an object or an array or
// null.

        case 'object':

// Due to a specification blunder in ECMAScript, typeof null is 'object',
// so watch out for that case.

            if (!value) {
                return 'null';
            }

// Make an array to hold the partial results of stringifying this object value.

            gap += indent;
            partial = [];

// Is the value an array?

            if (Object.prototype.toString.apply(value) === '[object Array]') {

// The value is an array. Stringify every element. Use null as a placeholder
// for non-JSON values.

                length = value.length;
                for (i = 0; i < length; i += 1) {
                    partial[i] = str(i, value) || 'null';
                }

// Join all of the elements together, separated with commas, and wrap them in
// brackets.

                v = partial.length === 0
                    ? '[]'
                    : gap
                    ? '[\n' + gap + partial.join(',\n' + gap) + '\n' + mind + ']'
                    : '[' + partial.join(',') + ']';
                gap = mind;
                return v;
            }

// If the replacer is an array, use it to select the members to be stringified.

            if (rep && typeof rep === 'object') {
                length = rep.length;
                for (i = 0; i < length; i += 1) {
                    if (typeof rep[i] === 'string') {
                        k = rep[i];
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            } else {

// Otherwise, iterate through all of the keys in the object.

                for (k in value) {
                    if (Object.prototype.hasOwnProperty.call(value, k)) {
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            }

// Join all of the member texts together, separated with commas,
// and wrap them in braces.

            v = partial.length === 0
                ? '{}'
                : gap
                ? '{\n' + gap + partial.join(',\n' + gap) + '\n' + mind + '}'
                : '{' + partial.join(',') + '}';
            gap = mind;
            return v;
        }
    }

// If the JSON object does not yet have a stringify method, give it one.

    if (typeof JSON.stringify !== 'function') {
        JSON.stringify = function (value, replacer, space) {

// The stringify method takes a value and an optional replacer, and an optional
// space parameter, and returns a JSON text. The replacer can be a function
// that can replace values, or an array of strings that will select the keys.
// A default replacer method can be provided. Use of the space parameter can
// produce text that is more easily readable.

            var i;
            gap = '';
            indent = '';

// If the space parameter is a number, make an indent string containing that
// many spaces.

            if (typeof space === 'number') {
                for (i = 0; i < space; i += 1) {
                    indent += ' ';
                }

// If the space parameter is a string, it will be used as the indent string.

            } else if (typeof space === 'string') {
                indent = space;
            }

// If there is a replacer, it must be a function or an array.
// Otherwise, throw an error.

            rep = replacer;
            if (replacer && typeof replacer !== 'function' &&
                    (typeof replacer !== 'object' ||
                    typeof replacer.length !== 'number')) {
                throw new Error('JSON.stringify');
            }

// Make a fake root object containing our value under the key of ''.
// Return the result of stringifying the value.

            return str('', {'': value});
        };
    }


// If the JSON object does not yet have a parse method, give it one.

    if (typeof JSON.parse !== 'function') {
        JSON.parse = function (text, reviver) {

// The parse method takes a text and an optional reviver function, and returns
// a JavaScript value if the text is a valid JSON text.

            var j;

            function walk(holder, key) {

// The walk method is used to recursively walk the resulting structure so
// that modifications can be made.

                var k, v, value = holder[key];
                if (value && typeof value === 'object') {
                    for (k in value) {
                        if (Object.prototype.hasOwnProperty.call(value, k)) {
                            v = walk(value, k);
                            if (v !== undefined) {
                                value[k] = v;
                            } else {
                                delete value[k];
                            }
                        }
                    }
                }
                return reviver.call(holder, key, value);
            }


// Parsing happens in four stages. In the first stage, we replace certain
// Unicode characters with escape sequences. JavaScript handles many characters
// incorrectly, either silently deleting them, or treating them as line endings.

            text = String(text);
            cx.lastIndex = 0;
            if (cx.test(text)) {
                text = text.replace(cx, function (a) {
                    return '\\u' +
                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                });
            }

// In the second stage, we run the text against regular expressions that look
// for non-JSON patterns. We are especially concerned with '()' and 'new'
// because they can cause invocation, and '=' because it can cause mutation.
// But just to be safe, we want to reject all unexpected forms.

// We split the second stage into 4 regexp operations in order to work around
// crippling inefficiencies in IE's and Safari's regexp engines. First we
// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we
// replace all simple value tokens with ']' characters. Third, we delete all
// open brackets that follow a colon or comma or that begin the text. Finally,
// we look to see that the remaining characters are only whitespace or ']' or
// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.

            if (/^[\],:{}\s]*$/
                    .test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')
                        .replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']')
                        .replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {

// In the third stage we use the eval function to compile the text into a
// JavaScript structure. The '{' operator is subject to a syntactic ambiguity
// in JavaScript: it can begin a block or an object literal. We wrap the text
// in parens to eliminate the ambiguity.

                j = eval('(' + text + ')');

// In the optional fourth stage, we recursively walk the new structure, passing
// each name/value pair to a reviver function for possible transformation.

                return typeof reviver === 'function'
                    ? walk({'': j}, '')
                    : j;
            }

// If the text is not JSON parseable, then a SyntaxError is thrown.

            throw new SyntaxError('JSON.parse');
        };
    }
}());


/* /js/libs/modernizr-custom.js
 * compresion time: 0.03099 -(ms)
 * ---------------------------- */
/*! modernizr 3.3.1 (Custom Build) | MIT *
 * http://modernizr.com/download/?-applicationcache-audio-backgroundsize-borderimage-borderradius-boxshadow-canvas-canvastext-cssanimations-cssgradients-cssreflections-csstransforms-csstransforms3d-csstransitions-flexbox-flexboxlegacy-fontface-fullscreen-generatedcontent-hashchange-history-hsla-indexeddb-inlinesvg-input-inputtypes-localstorage-multiplebgs-opacity-postmessage-rgba-sessionstorage-svgasimg-svgfilters-svgforeignobject-textshadow-video-websockets-websqldatabase-webworkers-domprefixes-hasevent-prefixes-setclasses-shiv-testallprops-testprop-teststyles !*/
!function(e,t,n){function r(e,t){return typeof e===t}function a(){var e,t,n,a,o,i,s;for(var c in x)if(x.hasOwnProperty(c)){if(e=[],t=x[c],t.name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(a=r(t.fn,"function")?t.fn():t.fn,o=0;o<e.length;o++)i=e[o],s=i.split("."),1===s.length?Modernizr[s[0]]=a:(!Modernizr[s[0]]||Modernizr[s[0]]instanceof Boolean||(Modernizr[s[0]]=new Boolean(Modernizr[s[0]])),Modernizr[s[0]][s[1]]=a),b.push((a?"":"no-")+s.join("-"))}}function o(e){var t=S.className,n=Modernizr._config.classPrefix||"";if(C&&(t=t.baseVal),Modernizr._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}Modernizr._config.enableClasses&&(t+=" "+n+e.join(" "+n),C?S.className.baseVal=t:S.className=t)}function i(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):C?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function s(e,t){return!!~(""+e).indexOf(t)}function c(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,n){return t+n.toUpperCase()}).replace(/^-/,"")}function d(){var e=t.body;return e||(e=i(C?"svg":"body"),e.fake=!0),e}function l(e,n,r,a){var o,s,c,l,u="modernizr",f=i("div"),p=d();if(parseInt(r,10))for(;r--;)c=i("div"),c.id=a?a[r]:u+(r+1),f.appendChild(c);return o=i("style"),o.type="text/css",o.id="s"+u,(p.fake?p:f).appendChild(o),p.appendChild(f),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),f.id=u,p.fake&&(p.style.background="",p.style.overflow="hidden",l=S.style.overflow,S.style.overflow="hidden",S.appendChild(p)),s=n(f,e),p.fake?(p.parentNode.removeChild(p),S.style.overflow=l,S.offsetHeight):f.parentNode.removeChild(f),!!s}function u(e,t){if("object"==typeof e)for(var n in e)D(e,n)&&u(n,e[n]);else{e=e.toLowerCase();var r=e.split("."),a=Modernizr[r[0]];if(2==r.length&&(a=a[r[1]]),"undefined"!=typeof a)return Modernizr;t="function"==typeof t?t():t,1==r.length?Modernizr[r[0]]=t:(!Modernizr[r[0]]||Modernizr[r[0]]instanceof Boolean||(Modernizr[r[0]]=new Boolean(Modernizr[r[0]])),Modernizr[r[0]][r[1]]=t),o([(t&&0!=t?"":"no-")+r.join("-")]),Modernizr._trigger(e,t)}return Modernizr}function f(e,t){return function(){return e.apply(t,arguments)}}function p(e,t,n){var a;for(var o in e)if(e[o]in t)return n===!1?e[o]:(a=t[e[o]],r(a,"function")?f(a,n||t):a);return!1}function m(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function g(t,r){var a=t.length;if("CSS"in e&&"supports"in e.CSS){for(;a--;)if(e.CSS.supports(m(t[a]),r))return!0;return!1}if("CSSSupportsRule"in e){for(var o=[];a--;)o.push("("+m(t[a])+":"+r+")");return o=o.join(" or "),l("@supports ("+o+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return n}function h(e,t,a,o){function d(){u&&(delete B.style,delete B.modElem)}if(o=r(o,"undefined")?!1:o,!r(a,"undefined")){var l=g(e,a);if(!r(l,"undefined"))return l}for(var u,f,p,m,h,v=["modernizr","tspan"];!B.style;)u=!0,B.modElem=i(v.shift()),B.style=B.modElem.style;for(p=e.length,f=0;p>f;f++)if(m=e[f],h=B.style[m],s(m,"-")&&(m=c(m)),B.style[m]!==n){if(o||r(a,"undefined"))return d(),"pfx"==t?m:!0;try{B.style[m]=a}catch(y){}if(B.style[m]!=h)return d(),"pfx"==t?m:!0}return d(),!1}function v(e,t,n,a,o){var i=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+j.join(i+" ")+i).split(" ");return r(t,"string")||r(t,"undefined")?h(s,t,a,o):(s=(e+" "+_.join(i+" ")+i).split(" "),p(s,t,n))}function y(e,t,r){return v(e,n,n,t,r)}var b=[],x=[],T={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){x.push({name:e,fn:t,options:n})},addAsyncTest:function(e){x.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=T,Modernizr=new Modernizr,Modernizr.addTest("applicationcache","applicationCache"in e),Modernizr.addTest("history",function(){var t=navigator.userAgent;return-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone")?e.history&&"pushState"in e.history:!1}),Modernizr.addTest("postmessage","postMessage"in e),Modernizr.addTest("websockets","WebSocket"in e&&2===e.WebSocket.CLOSING),Modernizr.addTest("localstorage",function(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}}),Modernizr.addTest("sessionstorage",function(){var e="modernizr";try{return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch(t){return!1}}),Modernizr.addTest("websqldatabase","openDatabase"in e),Modernizr.addTest("svgfilters",function(){var t=!1;try{t="SVGFEColorMatrixElement"in e&&2==SVGFEColorMatrixElement.SVG_FECOLORMATRIX_TYPE_SATURATE}catch(n){}return t}),Modernizr.addTest("webworkers","Worker"in e);var w=T._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];T._prefixes=w;var S=t.documentElement,C="svg"===S.nodeName.toLowerCase();C||!function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=b.elements;return"string"==typeof e?e.split(" "):e}function a(e,t){var n=b.elements;"string"!=typeof n&&(n=n.join(" ")),"string"!=typeof e&&(e=e.join(" ")),b.elements=n+" "+e,d(t)}function o(e){var t=y[e[h]];return t||(t={},v++,e[h]=v,y[v]=t),t}function i(e,n,r){if(n||(n=t),u)return n.createElement(e);r||(r=o(n));var a;return a=r.cache[e]?r.cache[e].cloneNode():g.test(e)?(r.cache[e]=r.createElem(e)).cloneNode():r.createElem(e),!a.canHaveChildren||m.test(e)||a.tagUrn?a:r.frag.appendChild(a)}function s(e,n){if(e||(e=t),u)return e.createDocumentFragment();n=n||o(e);for(var a=n.frag.cloneNode(),i=0,s=r(),c=s.length;c>i;i++)a.createElement(s[i]);return a}function c(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return b.shivMethods?i(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/[\w\-:]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(b,t.frag)}function d(e){e||(e=t);var r=o(e);return!b.shivCSS||l||r.hasCSS||(r.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),u||c(e,r),e}var l,u,f="3.7.3",p=e.html5||{},m=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,g=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,h="_html5shiv",v=0,y={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",l="hidden"in e,u=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(n){l=!0,u=!0}}();var b={elements:p.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:f,shivCSS:p.shivCSS!==!1,supportsUnknownElements:u,shivMethods:p.shivMethods!==!1,type:"default",shivDocument:d,createElement:i,createDocumentFragment:s,addElements:a};e.html5=b,d(t),"object"==typeof module&&module.exports&&(module.exports=b)}("undefined"!=typeof e?e:this,t);var E="Moz O ms Webkit",_=T._config.usePrefixes?E.toLowerCase().split(" "):[];T._domPrefixes=_;var k=function(){function e(e,t){var a;return e?(t&&"string"!=typeof t||(t=i(t||"div")),e="on"+e,a=e in t,!a&&r&&(t.setAttribute||(t=i("div")),t.setAttribute(e,""),a="function"==typeof t[e],t[e]!==n&&(t[e]=n),t.removeAttribute(e)),a):!1}var r=!("onblur"in t.documentElement);return e}();T.hasEvent=k,Modernizr.addTest("hashchange",function(){return k("hashchange",e)===!1?!1:t.documentMode===n||t.documentMode>7}),Modernizr.addTest("audio",function(){var e=i("audio"),t=!1;try{(t=!!e.canPlayType)&&(t=new Boolean(t),t.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),t.mp3=e.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,""),t.opus=e.canPlayType('audio/ogg; codecs="opus"')||e.canPlayType('audio/webm; codecs="opus"').replace(/^no$/,""),t.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),t.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(n){}return t}),Modernizr.addTest("canvas",function(){var e=i("canvas");return!(!e.getContext||!e.getContext("2d"))}),Modernizr.addTest("canvastext",function(){return Modernizr.canvas===!1?!1:"function"==typeof i("canvas").getContext("2d").fillText}),Modernizr.addTest("video",function(){var e=i("video"),t=!1;try{(t=!!e.canPlayType)&&(t=new Boolean(t),t.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),t.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),t.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""),t.vp9=e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,""),t.hls=e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,""))}catch(n){}return t}),Modernizr.addTest("cssgradients",function(){for(var e,t="background-image:",n="gradient(linear,left top,right bottom,from(#9f9),to(white));",r="",a=0,o=w.length-1;o>a;a++)e=0===a?"to ":"",r+=t+w[a]+"linear-gradient("+e+"left top, #9f9, white);";Modernizr._config.usePrefixes&&(r+=t+"-webkit-"+n);var s=i("a"),c=s.style;return c.cssText=r,(""+c.backgroundImage).indexOf("gradient")>-1}),Modernizr.addTest("multiplebgs",function(){var e=i("a").style;return e.cssText="background:url(https://),url(https://),red url(https://)",/(url\s*\(.*?){3}/.test(e.background)}),Modernizr.addTest("opacity",function(){var e=i("a").style;return e.cssText=w.join("opacity:.55;"),/^0.55$/.test(e.opacity)}),Modernizr.addTest("rgba",function(){var e=i("a").style;return e.cssText="background-color:rgba(150,255,150,.5)",(""+e.backgroundColor).indexOf("rgba")>-1}),Modernizr.addTest("inlinesvg",function(){var e=i("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"==("undefined"!=typeof SVGRect&&e.firstChild&&e.firstChild.namespaceURI)});var P=i("input"),O="autocomplete autofocus list placeholder max min multiple pattern required step".split(" "),z={};Modernizr.input=function(t){for(var n=0,r=t.length;r>n;n++)z[t[n]]=!!(t[n]in P);return z.list&&(z.list=!(!i("datalist")||!e.HTMLDataListElement)),z}(O);var A="search tel url email datetime date month week time datetime-local number range color".split(" "),$={};Modernizr.inputtypes=function(e){for(var r,a,o,i=e.length,s="1)",c=0;i>c;c++)P.setAttribute("type",r=e[c]),o="text"!==P.type&&"style"in P,o&&(P.value=s,P.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(r)&&P.style.WebkitAppearance!==n?(S.appendChild(P),a=t.defaultView,o=a.getComputedStyle&&"textfield"!==a.getComputedStyle(P,null).WebkitAppearance&&0!==P.offsetHeight,S.removeChild(P)):/^(search|tel)$/.test(r)||(o=/^(url|email)$/.test(r)?P.checkValidity&&P.checkValidity()===!1:P.value!=s)),$[e[c]]=!!o;return $}(A),Modernizr.addTest("hsla",function(){var e=i("a").style;return e.cssText="background-color:hsla(120,40%,100%,.5)",s(e.backgroundColor,"rgba")||s(e.backgroundColor,"hsla")});var F="CSS"in e&&"supports"in e.CSS,N="supportsCSS"in e;Modernizr.addTest("supports",F||N);var R={}.toString;Modernizr.addTest("svgforeignobject",function(){return!!t.createElementNS&&/SVGForeignObject/.test(R.call(t.createElementNS("http://www.w3.org/2000/svg","foreignObject")))});var j=T._config.usePrefixes?E.split(" "):[];T._cssomPrefixes=j;var M=T.testStyles=l,L=function(){var e=navigator.userAgent,t=e.match(/applewebkit\/([0-9]+)/gi)&&parseFloat(RegExp.$1),n=e.match(/w(eb)?osbrowser/gi),r=e.match(/windows phone/gi)&&e.match(/iemobile\/([0-9])+/gi)&&parseFloat(RegExp.$1)>=9,a=533>t&&e.match(/android/gi);return n||a||r}();L?Modernizr.addTest("fontface",!1):M('@font-face {font-family:"font";src:url("https://")}',function(e,n){var r=t.getElementById("smodernizr"),a=r.sheet||r.styleSheet,o=a?a.cssRules&&a.cssRules[0]?a.cssRules[0].cssText:a.cssText||"":"",i=/src/i.test(o)&&0===o.indexOf(n.split(" ")[0]);Modernizr.addTest("fontface",i)}),M('#modernizr{font:0/0 a}#modernizr:after{content:":)";visibility:hidden;font:7px/1 a}',function(e){Modernizr.addTest("generatedcontent",e.offsetHeight>=7)});var I=function(t){var r,a=w.length,o=e.CSSRule;if("undefined"==typeof o)return n;if(!t)return!1;if(t=t.replace(/^@/,""),r=t.replace(/-/g,"_").toUpperCase()+"_RULE",r in o)return"@"+t;for(var i=0;a>i;i++){var s=w[i],c=s.toUpperCase()+"_"+r;if(c in o)return"@-"+s.toLowerCase()+"-"+t}return!1};T.atRule=I;var D;!function(){var e={}.hasOwnProperty;D=r(e,"undefined")||r(e.call,"undefined")?function(e,t){return t in e&&r(e.constructor.prototype[t],"undefined")}:function(t,n){return e.call(t,n)}}(),T._l={},T.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),Modernizr.hasOwnProperty(e)&&setTimeout(function(){Modernizr._trigger(e,Modernizr[e])},0)},T._trigger=function(e,t){if(this._l[e]){var n=this._l[e];setTimeout(function(){var e,r;for(e=0;e<n.length;e++)(r=n[e])(t)},0),delete this._l[e]}},Modernizr._q.push(function(){T.addTest=u}),Modernizr.addTest("svgasimg",t.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"));var V={elem:i("modernizr")};Modernizr._q.push(function(){delete V.elem});var B={style:V.elem.style};Modernizr._q.unshift(function(){delete B.style});var U=T.testProp=function(e,t,r){return h([e],n,t,r)};Modernizr.addTest("textshadow",U("textShadow","1px 1px")),T.testAllProps=v,T.testAllProps=y,Modernizr.addTest("cssanimations",y("animationName","a",!0)),Modernizr.addTest("backgroundsize",y("backgroundSize","100%",!0)),Modernizr.addTest("borderimage",y("borderImage","url() 1",!0)),Modernizr.addTest("borderradius",y("borderRadius","0px",!0)),Modernizr.addTest("boxshadow",y("boxShadow","1px 1px",!0)),Modernizr.addTest("flexbox",y("flexBasis","1px",!0)),Modernizr.addTest("flexboxlegacy",y("boxDirection","reverse",!0)),Modernizr.addTest("cssreflections",y("boxReflect","above",!0)),Modernizr.addTest("csstransforms",function(){return-1===navigator.userAgent.indexOf("Android 2.")&&y("transform","scale(1)",!0)}),Modernizr.addTest("csstransforms3d",function(){var e=!!y("perspective","1px",!0),t=Modernizr._config.usePrefixes;if(e&&(!t||"webkitPerspective"in S.style)){var n,r="#modernizr{width:0;height:0}";Modernizr.supports?n="@supports (perspective: 1px)":(n="@media (transform-3d)",t&&(n+=",(-webkit-transform-3d)")),n+="{#modernizr{width:7px;height:18px;margin:0;padding:0;border:0}}",M(r+n,function(t){e=7===t.offsetWidth&&18===t.offsetHeight})}return e}),Modernizr.addTest("csstransitions",y("transition","all",!0));var q=T.prefixed=function(e,t,n){return 0===e.indexOf("@")?I(e):(-1!=e.indexOf("-")&&(e=c(e)),t?v(e,t,n):v(e,"pfx"))};Modernizr.addTest("fullscreen",!(!q("exitFullscreen",t,!1)&&!q("cancelFullScreen",t,!1)));var H;try{H=q("indexedDB",e)}catch(W){}Modernizr.addTest("indexeddb",!!H),H&&Modernizr.addTest("indexeddb.deletedatabase","deleteDatabase"in H),a(),o(b),delete T.addTest,delete T.addAsyncTest;for(var G=0;G<Modernizr._q.length;G++)Modernizr._q[G]();e.Modernizr=Modernizr}(window,document);


/* /js/libs/jquery-1.8.3.min.js
 * compresion time: 0.04411 -(ms)
 * ---------------------------- */
/*! jQuery v1.8.3 jquery.com | jquery.org/license */
(function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(P,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else r=t}return r}function B(e){var t;for(t in e){if(t==="data"&&v.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function et(){return!1}function tt(){return!0}function ut(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t))return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return v.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t))return v.filter(t,r,!n);t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e))return;var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)v.event.add(t,n,u[n][r])}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==="input"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e)return t}return r}function Gt(e,t){return e=t||e,v.css(e,"display")==="none"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style)continue;i[s]=v._data(n,"olddisplay"),t?(!i[s]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&Gt(n)&&(i[s]=v._data(n,"olddisplay",nn(n.nodeName)))):(r=Dt(n,"display"),!i[s]&&r!=="none"&&v._data(n,"olddisplay",r))}for(s=0;s<o;s++){n=e[s];if(!n.style)continue;if(!t||n.style.display==="none"||n.style.display==="")n.style.display=t?i[s]||"":"none"}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function en(e,t,n,r){var i=n===(r?"border":"content")?4:t==="width"?1:0,s=0;for(;i<4;i+=2)n==="margin"&&(s+=v.css(e,n+$t[i],!0)),r?(n==="content"&&(s-=parseFloat(Dt(e,"padding"+$t[i]))||0),n!=="margin"&&(s-=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0)):(s+=parseFloat(Dt(e,"padding"+$t[i]))||0,n!=="padding"&&(s+=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0));return s}function tn(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,"boxSizing")==="border-box";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null)r=e.style[t];if(Ut.test(r))return r;i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?"border":"content"),i)+"px"}function nn(e){if(Wt[e])return Wt[e];var t=v("<"+e+">").appendTo(i.body),n=t.css("display");t.remove();if(n==="none"||n===""){Pt=i.body.appendChild(Pt||v.extend(i.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement)Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write("<!doctype html><html><body>"),Ht.close();t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,"display"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&v.type(t)==="object")for(i in t)fn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Cn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n))for(;u<a;u++)r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[s?"unshift":"push"](n)}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++)u=a[f](n,r,i),typeof u=="string"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));return(c||!u)&&!o["*"]&&(u=kn(e,n,r,i,"*",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]==="*")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=o[++f];)if(i!=="*"){if(u!=="*"&&u!==i){n=a[u+" "+i]||a["* "+i];if(!n)for(r in a){s=r.split(" ");if(s[1]===i){n=a[u+" "+s[0]]||a["* "+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+u+" to "+i}}}u=i}return{state:"success",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++)f.tweens[s].run(i);return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r)return r}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,"display")==="inline"&&v.css(e,"float")==="none"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s==="toggle";if(s===(g?"hide":"show"))continue;m.push(r)}}o=m.length;if(o){u=v._data(e,"fxshow")||v._data(e,"fxshow",{}),"hidden"in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,"fxshow",!0);for(t in d)v.style(e,t,d[t])});for(r=0;r<o;r++)i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=$t[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){return(t+"").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",A,!1),v.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),"slice",l.call(arguments).join(","))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady)return;if(!i.body)return setTimeout(v.ready,1);v.isReady=!0;if(e!==!0&&--v.readyWait>0)return;r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger("ready").off("ready")},isFunction:function(e){return v.type(e)==="function"},isArray:Array.isArray||function(e){return v.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||"object"},isPlainObject:function(e){if(!e||v.type(e)!=="object"||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return!e||typeof e!="string"?null:(typeof t=="boolean"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string")return null;t=v.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(S.test(t.replace(T,"@").replace(N,"]").replace(x,"")))return(new Function("return "+t))();v.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e)if(n.apply(e[i],r)===!1)break}else for(;s<o;)if(n.apply(e[s++],r)===!1)break}else if(u){for(i in e)if(n.call(e[i],i,e[i])===!1)break}else for(;s<o;)if(n.call(e[s],s,e[s++])===!1)break;return e},trim:d&&!d.call("\ufeff\u00a0")?function(e){return e==null?"":d.call(e)}:function(e){return e==null?"":(e+"").replace(b,"")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n==="string"||n==="function"||n==="regexp"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=="number"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f)for(;u<a;u++)i=n(e[u],u,r),i!=null&&(o[o.length]=i);else for(s in e)i=n(e[s],s,r),i!=null&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r=="object"){for(l in r)v.access(e,n,l,r[l],1,o,i);s=1}else if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n)for(;l<c;l++)n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);s=1}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState==="complete")setTimeout(v.ready,1);else if(i.addEventListener)i.addEventListener("DOMContentLoaded",A,!1),e.addEventListener("load",v.ready,!1);else{i.attachEvent("onreadystatechange",A),e.attachEvent("onload",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}v.ready()}}()}}return r.promise(t)},v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value==="on",optSelected:o.selected,getSetAttribute:p.className!=="t",enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",h)),u=i.createElement("input"),u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","checked"),u.setAttribute("name","t"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})f="on"+l,c=f in p,c||(p.setAttribute(f,"return;"),c=typeof p[f]=="function"),t[l+"Bubbles"]=c;return v(function(){var n,r,s,o,u="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=i.getElementsByTagName("body")[0];if(!a)return;n=i.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(n,a.firstChild),r=i.createElement("div"),n.appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=r.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML="",r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:"4px"}).width==="4px",o=i.createElement("div"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width="0",r.style.width="1px",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!="undefined"&&(r.innerHTML="",r.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display="block",r.style.overflow="visible",r.innerHTML="<div></div>",r.firstChild.style.width="5px",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e))return;var s,o,u=v.expando,a=typeof n=="string",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)return;c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n=="object"||typeof n=="function")i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?B:v.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!B(u[a]))return}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf("data-")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));v._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){v.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",v.access(this,function(n){if(n===t)return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=v(this);t.triggerHandler("setData"+i,r),v.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v.removeData(e,t+"queue",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=v._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ");i.className=v.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(" "+i.className+" ").replace(q," ");for(s=0,o=n.length;s<o;s++)while(r.indexOf(" "+n[s]+" ")>=0)r=r.replace(" "+n[s]+" "," ");i.className=e?v.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&v._data(this,"__className__",this.className),this.className=this.className||e===!1?"":v._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(R,""):r==null?"":r);return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":v.isArray(s)&&(s=v.map(s,function(e){return e==null?"":e+""})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,s,"value")===t)this.value=s})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find("option").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(i&&v.isFunction(v.fn[n]))return v(e)[n](r);if(typeof e.getAttribute=="undefined")return v.prop(e,n,r);u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++)i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,""),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode)v.error("type property can't be changed");else if(!v.support.radioValue&&t==="radio"&&v.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return j&&v.nodeName(e,"button")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,"button"))return j.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!=="":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+""}},v.each(["width","height"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===""&&(t="false"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each(["href","src","width","height"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype="encoding"),v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,"mouseenter$1 mouseleave$1")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))return;r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v=="undefined"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(" ");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events))return;t=v.trim(Z(t||"")).split(" ");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h)v.event.remove(e,u+t[s],n,r,!0);continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp("(^|\\.)"+f.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(c=0;c<d.length;c++)m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==="**"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered))return;y.indexOf("!")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(".")>=0&&(b=y.split("."),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y])return;n=typeof n=="object"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=y.indexOf(":")<0?"on"+y:"";if(!s){u=v.cache;for(f in u)u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1)return;m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode)m.push([l,g]),c=l;c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++)l=m[f][0],n.type=m[f][1],d=(v._data(l,"events")||{})[n.type]&&v._data(l,"handle"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=="click"||!v.nodeName(s,"a"))&&v.acceptData(s)&&h&&s[y]&&(y!=="focus"&&y!=="blur"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,"events")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1)return;if(m&&(!n.button||n.type!=="click"))for(s=n.target;s!=this;s=s.parentNode||this)if(s.disabled!==!0||n.type!=="click"){u={},f=[];for(r=0;r<m;r++)c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);f.length&&w.push({elem:s,matches:f})}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando])return e;var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;)n=o[--t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;r&&!v._data(r,"_submit_attached")&&(v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),v._data(r,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")v.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate("change",this,e,!0)});return!1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,"_change_attached")&&(v.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate("change",this.parentNode,e,!0)}),v._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,"._change"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=et;else if(!i)return this;return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return v.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,"lastToggle"+e.guid)||0)%r;return v._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=R.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Z&&t.getElementsByClassName)return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}return vt(e.replace(j,"$1"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ot(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=I.exec(u))s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j," ");for(o in i.filter)(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=w++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=b+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[at(ft(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join("").replace(j,"$1"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++)v(x,m,a,f);if(u){if(y>0)while(w--)!x[w]&&!m[w]&&(m[w]=E.call(l));m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++)nt(e,t[r],n);return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace($,""),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return S.apply(n,x.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},k=C(),L=C(),A=C(),O="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",_=M.replace("w","w#"),D="([*^$|!~]?=)",P="\\["+O+"*("+M+")"+O+"*(?:"+D+O+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+_+")|)|)"+O+"*\\]",H=":("+M+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+P+")|[^:]|\\\\.)*|.*))\\)|)",B=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)",j=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),F=new RegExp("^"+O+"*,"+O+"*"),I=new RegExp("^"+O+"*([\\x20\\t\\r\\n\\f>+~])"+O+"*"),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),NAME:new RegExp("^\\[name=['\"]?("+M+")['\"]?\\]"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+H),POS:new RegExp(B,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),needsContext:new RegExp("^"+O+"*[>+~]|"+B,"i")},K=function(e){var t=g.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length}),G=K(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),Y=K(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Z=K(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,""),e[3]=(e[4]||e[5]||"").replace($,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace($,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace($,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,"$1"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:rt("radio"),checkbox:rt("checkbox"),file:rt("file"),password:rt("password"),image:rt("image"),submit:it("submit"),reset:it("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return ot(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return ot(i[f],s[f]);return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},nt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+" "];if(!s){t||(t=ut(e)),n=t.length;while(n--)s=ht(t[n]),s[d]?r.push(s):i.push(s);s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+O+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),K(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+O+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ut(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=z.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",H)}catch(n){}}),s=new RegExp(s.join("|")),nt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[":"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!="string")return v(e).filter(function(){for(t=0,n=u.length;t<n;t++)if(v.contains(u[t],this))return!0});o=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0)for(i=r;i<o.length;i++)for(s=0;s<r;s++)if(o[s]===o[i]){o.splice(i--,1);break}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1),"not",e)},filter:function(e){return this.pushStack(ft(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!="string"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?typeof e=="string"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return at(e,"nextSibling")},prev:function(e){return at(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r=="string"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(","))}}),v.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ct="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp("<(?:"+ct+")[\\s/>]","i"),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ct=lt(i),kt=Ct.appendChild(i.createElement("div"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,"X<div>","</div>"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),"before",this.selector)}},after:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),"after",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||v.filter(e,[n]).length)!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName("*"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(ht,""):t;if(typeof e=="string"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(dt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),"replaceWith",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f=="string"&&St.test(f))return this.each(function(){v(this).domManip(e,n,r)});if(v.isFunction(f))return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,"tr");for(u=i.cacheable||c-1;a<c;a++)r.call(n&&v.nodeName(this[a],"table")?Lt(this[a],"tbody"):this[a],a===u?o:v.clone(o,!0,!0))}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Tt,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=="string"&&a.length<512&&n===i&&a.charAt(0)==="<"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)return o[t](this[0]),this;for(;i<u;i++)r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s)i[s]&&Ot(r[s],i[s])}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s)At(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment=="undefined")t=i;for(s=0;(u=e[s])!=null;s++){typeof u=="number"&&(u+="");if(!u)continue;if(typeof u=="string")if(!gt.test(u))u=t.createTextNode(u);else{y=y||lt(t),c=t.createElement("div"),y.appendChild(c),u=u.replace(dt,"<$1></$2>"),a=(vt.exec(u)||["",""])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--)c=c.lastChild;if(!v.support.tbody){h=mt.test(u),p=a==="table"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==="<table>"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o)v.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked)for(s=0;(u=b[s])!=null;s++)v.nodeName(u,"input")?_t(u):typeof u.getElementsByTagName!="undefined"&&v.grep(u.getElementsByTagName("input"),_t);if(n){m=function(e){if(!e.type||xt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)};for(s=0;(u=b[s])!=null;s++)if(!v.nodeName(u,"script")||!m(u))n.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(g=v.grep(v.merge([],u.getElementsByTagName("script")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++)if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp("^("+m+")(.*)$","i"),Ut=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),zt=new RegExp("^([-+])=("+m+")","i"),Wt={BODY:"block"},Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:0,fontWeight:400},$t=["Top","Right","Bottom","Left"],Jt=["Webkit","O","Moz","ms"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e=="boolean";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,"opacity");return n===""?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!v.cssNumber[a]&&(r+="px");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==="normal"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];r=n.call(e);for(i in t)e.style[i]=s[i];return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===""&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==="fontSize"?"1em":i,i=s.pixelLeft+"px",s.left=n,r&&(e.runtimeStyle.left=r)),i===""?"auto":i}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&It.test(Dt(e,"display"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,"boxSizing")==="border-box"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=Bt.test(s)?s.replace(Bt,i):s+" "+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:"inline-block"},function(){if(t)return Dt(e,"marginRight")})}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+"px":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,"display"))==="none"},v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+$t[r]+t]=i[r]||i[r-2]||i[0];return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,"\r\n")}}):{name:t.name,value:n.replace(on,"\r\n")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)fn(r,e[r],n,s);return i.join("&").replace(rn,"+")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=["*/"]+["*"];try{cn=s.href}catch(Nn){cn=i.createElement("a"),cn.href="",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!="string"&&En)return En.apply(this,arguments);if(!this.length)return this;var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),v.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v("<div>").append(e.replace(yn,"")).find(i):e)}),this},v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,"script")},getJSON:function(e,t,n){return v.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),o=t,i=a||"",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(v.lastModified[r]=S),S=x.getResponseHeader("Etag"),S&&(v.etag[r]=S)),e===304?(T="notmodified",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);else{b=T;if(!T||e)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger("ajax"+(l?"Success":"Error"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--v.active||v.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks("once memory"),g=c.statusCode||{},b={},w={},E=0,S="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i))s[n[1].toLowerCase()]=n[2]}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2)for(t in e)g[t]=[g[t],e[t]];else t=e[x.status],x.always(t)}return this},c.url=((e||c.url)+"").replace(hn,"").replace(mn,ln[1]+"//"),c.dataTypes=v.trim(c.dataType||"*").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==="http:"?80:443))==(ln[3]||(ln[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2)return x;f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?"&":"?")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,"$1_="+N);c.url=C+(C===c.url?(gn.test(c.url)?"&":"?")+"_="+N:"")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader("If-Modified-Since",v.lastModified[r]),v.etag[r]&&x.setRequestHeader("If-None-Match",v.etag[r])),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in{success:1,error:1,complete:1})x[l](c[l]);o=kn(xn,c,n,x);if(!o)T(-1,"No Transport");else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2))throw k;T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mn.pop()||v.expando+"_"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dn.test(a);if(n.dataTypes[0]==="jsonp"||c||h)return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,"$1"+s):h?n.data=a.replace(Dn,"$1"+s):l&&(n.url+=(_n.test(f)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||v.error(s+" was not called"),u[0]},n.dataTypes[0]="json",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),"script"}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,o){n=i.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn)Hn[e](0,1)}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i)a.readyState!==4&&a.abort();else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),Wn=/queueHooks$/,Xn=[Gn],Vn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?"":"px");if(r!=="px"&&u){u=v.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,v.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r=="boolean"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn("show"),slideUp:Zn("hide"),slideToggle:Zn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e=="object"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c)return;return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!="undefined"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,"marginTop"))||0,n+=parseFloat(v.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,"position");r==="static"&&(e.style.position="relative");var i=v(e),s=i.offset(),o=v.css(e,"top"),u=v.css(e,"left"),a=(r==="absolute"||r==="fixed")&&v.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,"marginTop"))||0,n.left-=parseFloat(v.css(e,"marginLeft"))||0,r.top+=parseFloat(v.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(v.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,"position")==="static")e=e.offsetParent;return e||i.body})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return v})})(window);


/* /js/libs/i18next-1.6.0.min.js
 * compresion time: 0.03004 -(ms)
 * ----------------------------- */
// i18next, v1.6.0
// Copyright (c)2013 Jan Mhlemann (jamuhl).
// Distributed under MIT license
// http://i18next.com
(function(){function a(e,t){if(!t||typeof t=="function")return e;for(var n in t)e[n]=t[n];return e}function f(e,t,n){var r,i=0,s=e.length,o=s===undefined||typeof e=="function";if(n){if(o){for(r in e)if(t.apply(e[r],n)===!1)break}else for(;i<s;)if(t.apply(e[i++],n)===!1)break}else if(o){for(r in e)if(t.call(e[r],r,e[r])===!1)break}else for(;i<s;)if(t.call(e[i],i,e[i++])===!1)break;return e}function l(e){var t=function(e){if(window.XMLHttpRequest)return e(null,new XMLHttpRequest);if(window.ActiveXObject)try{return e(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(t){return e(null,new ActiveXObject("Microsoft.XMLHTTP"))}return e(new Error)},n=function(e){if(typeof e=="string")return e;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},r=function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t},i=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=r(e);var n="",i,s,o,u,a,f,l,c=0;do i=e.charCodeAt(c++),s=e.charCodeAt(c++),o=e.charCodeAt(c++),u=i>>2,a=(i&3)<<4|s>>4,f=(s&15)<<2|o>>6,l=o&63,isNaN(s)?f=l=64:isNaN(o)&&(l=64),n+=t.charAt(u)+t.charAt(a)+t.charAt(f)+t.charAt(l),i=s=o="",u=a=f=l="";while(c<e.length);return n},s=function(){var e=arguments[0];for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e},o=function(e,r,i,u){typeof i=="function"&&(u=i,i={}),i.cache=i.cache||!1,i.data=i.data||{},i.headers=i.headers||{},i.jsonp=i.jsonp||!1,i.async=i.async===undefined?!0:i.async;var a=s({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},o.headers,i.headers),f;a["content-type"]==="application/json"?f=JSON.stringify(i.data):f=n(i.data);if(e==="GET"){var l=[];f&&(l.push(f),f=null),i.cache||l.push("_="+(new Date).getTime()),i.jsonp&&(l.push("callback="+i.jsonp),l.push("jsonp="+i.jsonp)),l=l.join("&"),l.length>1&&(r.indexOf("?")>-1?r+="&"+l:r+="?"+l);if(i.jsonp){var c=document.getElementsByTagName("head")[0],h=document.createElement("script");h.type="text/javascript",h.src=r,c.appendChild(h);return}}t(function(t,n){if(t)return u(t);n.open(e,r,i.async);for(var s in a)a.hasOwnProperty(s)&&n.setRequestHeader(s,a[s]);n.onreadystatechange=function(){if(n.readyState===4){var e=n.responseText||"";if(!u)return;u(n.status,{text:function(){return e},json:function(){return JSON.parse(e)}})}},n.send(f)})},u={authBasic:function(e,t){o.headers.Authorization="Basic "+i(e+":"+t)},connect:function(e,t,n){return o("CONNECT",e,t,n)},del:function(e,t,n){return o("DELETE",e,t,n)},get:function(e,t,n){return o("GET",e,t,n)},head:function(e,t,n){return o("HEAD",e,t,n)},headers:function(e){o.headers=e||{}},isAllowed:function(e,t,n){this.options(e,function(e,r){n(r.text().indexOf(t)!==-1)})},options:function(e,t,n){return o("OPTIONS",e,t,n)},patch:function(e,t,n){return o("PATCH",e,t,n)},post:function(e,t,n){return o("POST",e,t,n)},put:function(e,t,n){return o("PUT",e,t,n)},trace:function(e,t,n){return o("TRACE",e,t,n)}},a=e.type?e.type.toLowerCase():"get";u[a](e.url,e,function(t,n){t===200?e.success(n.json(),t,null):e.error(n.text(),t,null)})}function d(e,s){typeof e=="function"&&(s=e,e={}),e=e||{},p.extend(u,e),typeof u.ns=="string"&&(u.ns={namespaces:[u.ns],defaultNs:u.ns}),u.interpolationPrefixEscaped=p.regexEscape(u.interpolationPrefix),u.interpolationSuffixEscaped=p.regexEscape(u.interpolationSuffix),u.lng||(u.lng=p.detectLanguage()),u.lng?u.useCookie&&p.cookie.create(u.cookieName,u.lng,u.cookieExpirationTime):(u.lng=u.fallbackLng,u.useCookie&&p.cookie.remove(u.cookieName)),o=p.toLanguages(u.lng),i=o[0],p.log("currentLng set to: "+i),_.setCurrentLng(i),t&&u.setJqueryExt&&S();var a;t&&t.Deferred&&(a=t.Deferred());if(u.resStore){r=u.resStore,s&&s(L),a&&a.resolve();if(a)return a.promise();return}var f=p.toLanguages(u.lng);typeof u.preload=="string"&&(u.preload=[u.preload]);for(var l=0,c=u.preload.length;l<c;l++){var h=p.toLanguages(u.preload[l]);for(var d=0,v=h.length;d<v;d++)f.indexOf(h[d])<0&&f.push(h[d])}n.sync.load(f,u,function(e,t){r=t,s&&s(L),a&&a.resolve()});if(a)return a.promise()}function v(e,t){typeof e=="string"&&(e=[e]);for(var n=0,r=e.length;n<r;n++)u.preload.indexOf(e[n])<0&&u.preload.push(e[n]);return d(t)}function m(e,t,n){typeof t!="string"&&(n=t,t=u.ns.defaultNs),r[e]=r[e]||{},r[e][t]=r[e][t]||{},p.extend(r[e][t],n)}function g(e){u.ns.defaultNs=e}function y(e,t){b([e],t)}function b(e,t){var i={dynamicLoad:u.dynamicLoad,resGetPath:u.resGetPath,getAsync:u.getAsync,ns:{namespaces:e,defaultNs:""}},s=p.toLanguages(u.lng);typeof u.preload=="string"&&(u.preload=[u.preload]);for(var o=0,a=u.preload.length;o<a;o++){var f=p.toLanguages(u.preload[o]);for(var l=0,c=f.length;l<c;l++)s.indexOf(f[l])<0&&s.push(f[l])}var h=[];for(var d=0,v=s.length;d<v;d++){var m=!1,g=r[s[d]];if(g)for(var y=0,b=e.length;y<b;y++)g[e[y]]||(m=!0);else m=!0;m&&h.push(s[d])}h.length?n.sync._fetch(h,i,function(i,s){var o=e.length*h.length;p.each(e,function(e,i){p.each(h,function(e,a){r[a]=r[a]||{},r[a][i]=s[a][i],o--,o===0&&t&&(u.useLocalStorage&&n.sync._storeLocal(r),t())})})}):t&&t()}function w(e,t){return d({lng:e},t)}function E(){return i}function S(){function e(e,n,r){if(n.length===0)return;var i="text";if(n.indexOf("[")===0){var s=n.split("]");n=s[1],i=s[0].substr(1,s[0].length-1)}n.indexOf(";")===n.length-1&&(n=n.substr(0,n.length-2));var o;i==="html"?(o=u.defaultValueFromContent?t.extend({defaultValue:e.html()},r):r,e.html(t.t(n,o))):i==="text"?(o=u.defaultValueFromContent?t.extend({defaultValue:e.text()},r):r,e.text(t.t(n,o))):(o=u.defaultValueFromContent?t.extend({defaultValue:e.attr(i)},r):r,e.attr(i,t.t(n,o)))}function n(n,r){var i=n.attr(u.selectorAttr);if(!i)return;var s=n,o=n.data("i18n-target");o&&(s=n.find(o)||n),!r&&u.useDataAttrOptions===!0&&(r=n.data("i18n-options")),r=r||{};if(i.indexOf(";")<=i.length-1){var a=i.split(";");t.each(a,function(t,n){e(s,n,r)})}else e(s,k,r);u.useDataAttrOptions===!0&&n.data("i18n-options",r)}t.t=t.t||L,t.fn.i18n=function(e){return this.each(function(){n(t(this),e);var r=t(this).find("["+u.selectorAttr+"]");r.each(function(){n(t(this),e)})})}}function x(e,t,n,r){r=r||t;if(e.indexOf(r.interpolationPrefix||u.interpolationPrefix)<0)return e;var i=r.interpolationPrefix?p.regexEscape(r.interpolationPrefix):u.interpolationPrefixEscaped,s=r.interpolationSuffix?p.regexEscape(r.interpolationSuffix):u.interpolationSuffixEscaped;return p.each(t,function(t,o){typeof o=="object"&&o!==null?e=x(e,o,n?n+u.keyseparator+t:t,r):e=e.replace(new RegExp([i,n?n+u.keyseparator+t:t,s].join(""),"g"),o)}),e}function T(e,t){var n=",",r="{",i="}",o=p.extend({},t);delete o.postProcess;while(e.indexOf(u.reusePrefix)!=-1){s++;if(s>u.maxRecursion)break;var a=e.indexOf(u.reusePrefix),f=e.indexOf(u.reuseSuffix,a)+u.reuseSuffix.length,l=e.substring(a,f),c=l.replace(u.reusePrefix,"").replace(u.reuseSuffix,"");if(c.indexOf(n)!=-1){var h=c.indexOf(n);if(c.indexOf(r,h)!=-1&&c.indexOf(i,h)!=-1){var d=c.indexOf(r,h),v=c.indexOf(i,d)+i.length;try{o=p.extend(o,JSON.parse(c.substring(d,v))),c=c.substring(0,h)}catch(m){}}}var g=A(c,o);e=e.replace(l,g)}return e}function N(e){return e.context&&typeof e.context=="string"}function C(e){return e.count!==undefined&&typeof e.count!="string"&&e.count!==1}function L(e,t){return s=0,A(e,t)}function A(e,t){t=t||{};if(!r)return f;var s,a,f=t.defaultValue||e,l=o;if(t.lng){l=p.toLanguages(t.lng);if(!r[l[0]]){var c=u.getAsync;u.getAsync=!1,n.sync.load(l,u,function(e,t){p.extend(r,t),u.getAsync=c})}}var h=t.ns||u.ns.defaultNs;if(e.indexOf(u.nsseparator)>-1){var d=e.split(u.nsseparator);h=d[0],e=d[1]}if(N(t)){s=p.extend({},t),delete s.context,s.defaultValue=u.contextNotFound;var v=h+u.nsseparator+e+"_"+t.context;a=L(v,s);if(a!=u.contextNotFound)return x(a,{context:t.context})}if(C(t)){s=p.extend({},t),delete s.count,s.defaultValue=u.pluralNotFound;var m=h+u.nsseparator+e+u.pluralSuffix,g=_.get(i,t.count);g>=0?m=m+"_"+g:g===1&&(m=h+u.nsseparator+e),a=L(m,s);if(a!=u.pluralNotFound)return x(a,{count:t.count})}var y,b=e.split(u.keyseparator);for(var w=0,E=l.length;w<E;w++){if(y)break;var S=l[w],k=0,O=r[S]&&r[S][h];while(b[k])O=O&&O[b[k]],k++;if(O!==undefined){if(typeof O=="string")O=x(O,t),O=T(O,t);else if(Object.prototype.toString.apply(O)==="[object Array]"&&!u.returnObjectTrees&&!t.returnObjectTrees)O=O.join("\n"),O=x(O,t),O=T(O,t);else if(!u.returnObjectTrees&&!t.returnObjectTrees)O="key '"+h+":"+e+" ("+S+")' "+"returned a object instead of string.",p.log(O);else{var P={};for(var H in O)P[H]=A(h+u.nsseparator+e+u.keyseparator+H,t);O=P}y=O}}y===undefined&&u.fallbackToDefaultNS&&(y=A(e,t)),y===undefined&&u.sendMissing&&(t.lng?M.postMissing(l[0],h,e,f,l):M.postMissing(u.lng,h,e,f,l));var B=t.postProcess||u.postProcess;return y!==undefined&&B&&D[B]&&(y=D[B](y,e,t)),y===undefined&&(f=x(f,t),f=T(f,t)),y!==undefined?y:f}function O(){var e,t=[];typeof window!="undefined"&&(function(){var e=window.location.search.substring(1),n=e.split("&");for(var r=0;r<n.length;r++){var i=n[r].indexOf("=");if(i>0){var s=n[r].substring(0,i),o=n[r].substring(i+1);t[s]=o}}}(),t[u.detectLngQS]&&(e=t[u.detectLngQS]));if(!e&&typeof document!="undefined"&&u.useCookie){var n=p.cookie.read(u.cookieName);n&&(e=n)}return!e&&typeof navigator!="undefined"&&(e=navigator.language?navigator.language:navigator.userLanguage),e}Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1});var e=this,t=e.jQuery,n={},r={},i,s=0,o=[];typeof module!="undefined"&&module.exports?module.exports=n:(t&&(t.i18n=t.i18n||n),e.i18n=e.i18n||n);var u={lng:undefined,load:"all",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:"dev",detectLngQS:"setLng",ns:"translation",fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"locales/__lng__/__ns__.json",resPostPath:"locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:undefined,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),setJqueryExt:!0,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:undefined,useCookie:!0,cookieName:"i18next",postProcess:undefined},c={create:function(e,t,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+n*60*1e3),r="; expires="+i.toGMTString()}else r="";document.cookie=e+"="+t+r+"; path=/"},read:function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null},remove:function(e){this.create(e,"",-1)}},h={create:function(e,t,n){},read:function(e){return null},remove:function(e){}},p={extend:t?t.extend:a,each:t?t.each:f,ajax:t?t.ajax:l,cookie:typeof document!="undefined"?c:h,detectLanguage:O,log:function(e){u.debug&&typeof console!="undefined"&&console.log(e)},toLanguages:function(e){var t=[];if(typeof e=="string"&&e.indexOf("-")>-1){var n=e.split("-");e=u.lowerCaseLng?n[0].toLowerCase()+"-"+n[1].toLowerCase():n[0].toLowerCase()+"-"+n[1].toUpperCase(),u.load!=="unspecific"&&t.push(e),u.load!=="current"&&t.push(n[0])}else t.push(e);return t.indexOf(u.fallbackLng)===-1&&u.fallbackLng&&t.push(u.fallbackLng),t},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},M={load:function(e,t,n){t.useLocalStorage?M._loadLocal(e,t,function(r,i){var s=[];for(var o=0,u=e.length;o<u;o++)i[e[o]]||s.push(e[o]);s.length>0?M._fetch(s,t,function(e,t){p.extend(i,t),M._storeLocal(t),n(null,i)}):n(null,i)}):M._fetch(e,t,function(e,t){n(null,t)})},_loadLocal:function(e,t,n){var r={},i=(new Date).getTime();if(window.localStorage){var s=e.length;p.each(e,function(e,o){var u=window.localStorage.getItem("res_"+o);u&&(u=JSON.parse(u),u.i18nStamp&&u.i18nStamp+t.localStorageExpirationTime>i&&(r[o]=u)),s--,s===0&&n(null,r)})}},_storeLocal:function(e){if(window.localStorage)for(var t in e)e[t].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+t,JSON.stringify(e[t]));return},_fetch:function(e,t,n){var r=t.ns,i={};if(!t.dynamicLoad){var s=r.namespaces.length*e.length,o;p.each(r.namespaces,function(r,u){p.each(e,function(e,r){var a=function(e,t){e&&(o=o||[],o.push(e)),i[r]=i[r]||{},i[r][u]=t,s--,s===0&&n(o,i)};typeof t.customLoad=="function"?t.customLoad(r,u,t,a):M._fetchOne(r,u,t,a)})})}else{var u=x(t.resGetPath,{lng:e.join("+"),ns:r.namespaces.join("+")});p.ajax({url:u,success:function(e,t,r){p.log("loaded: "+u),n(null,e)},error:function(e,t,r){p.log("failed loading: "+u),n("failed loading resource.json error: "+r)},dataType:"json",async:t.getAsync})}},_fetchOne:function(e,t,n,r){var i=x(n.resGetPath,{lng:e,ns:t});p.ajax({url:i,success:function(e,t,n){p.log("loaded: "+i),r(null,e)},error:function(e,t,n){p.log("failed loading: "+i),r(n,{})},dataType:"json",async:n.getAsync})},postMissing:function(e,t,n,i,s){var o={};o[n]=i;var a=[];if(u.sendMissingTo==="fallback")a.push({lng:u.fallbackLng,url:x(u.resPostPath,{lng:u.fallbackLng,ns:t})});else if(u.sendMissingTo==="current")a.push({lng:e,url:x(u.resPostPath,{lng:e,ns:t})});else if(u.sendMissingTo==="all")for(var f=0,l=s.length;f<l;f++)a.push({lng:s[f],url:x(u.resPostPath,{lng:s[f],ns:t})});for(var c=0,h=a.length;c<h;c++){var d=a[c];p.ajax({url:d.url,type:u.sendType,data:o,success:function(e,s,o){p.log("posted missing key '"+n+"' to: "+d.url);var u=n.split("."),a=0,f=r[d.lng][t];while(u[a])a===u.length-1?f=f[u[a]]=i:f=f[u[a]]=f[u[a]]||{},a++},error:function(e,t,r){p.log("failed posting missing key '"+n+"' to: "+d.url)},dataType:"json",async:u.postAsync})}}},_={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(e===0?0:e==1?1:e==2?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ay:{name:"Aymar",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(e!=1)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(e!=1)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(e!=1)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(e==1?0:e>=2&&e<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(e==1?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(e==1?0:e==2?1:e!=8&&e!=11?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(e!=1)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(e!=1)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(e!=1)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(e!=1)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(e!=1)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(e!=1)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(e!=1)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(e!=1)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(e!=1)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(e!=1)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(e==1?0:e==2?1:e<7?2:e<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(e==1||e==11?0:e==2||e==12?1:e>2&&e<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(e!=1)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(e!=1)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(e!=1)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(e!=1)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(e!=1)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(e!=1)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(e!==0)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(e!=1)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(e==1?0:e==2?1:e==3?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[0,1,2],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e!==0?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(e!=1)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(e==1||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(e!=1)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(e==1?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(e==1?0:e===0||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(e!=1)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(e!=1)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(e!=1)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(e!=1)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(e!=1)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(e!=1)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(e!=1)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(e!=1)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(e!=1)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(e==1?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(e!=1)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(e!=1)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(e!=1)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(e){return Number(e==1?0:e===0||e%100>0&&e%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(e!=1)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(e!=1)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(e!=1)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(e==1?0:e>=2&&e<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(e!=1)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(e!=1)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(e!=1)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(e!=1)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(e!=1)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(e!=1)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(e!=1)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(e!=1)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(e!=1)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(e!=1)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}},addRule:function(e,t){_.rules[e]=t},setCurrentLng:function(e){if(!_.currentRule||_.currentRule.lng!==e){var t=e.split("-");_.currentRule={lng:e,rule:_.rules[t[0]]}}},get:function(e,t){function r(t,n){var r;_.currentRule&&_.currentRule.lng===e?r=_.currentRule.rule:r=_.rules[t];if(r){var i=r.plurals(n),s=r.numbers[i];return r.numbers.length===2&&r.numbers[0]===1&&(s===2?s=-1:s===1&&(s=1)),s}return n===1?"1":"-1"}var n=e.split("-");return r(n[0],t)}},D={},P=function(e,t){D[e]=t},H=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var i=1,s=n.length,o="",u,a=[],f,l,c,h,p,d;for(f=0;f<s;f++){o=e(n[f]);if(o==="string")a.push(n[f]);else if(o==="array"){c=n[f];if(c[2]){u=r[i];for(l=0;l<c[2].length;l++){if(!u.hasOwnProperty(c[2][l]))throw H('[sprintf] property "%s" does not exist',c[2][l]);u=u[c[2][l]]}}else c[1]?u=r[c[1]]:u=r[i++];if(/[^s]/.test(c[8])&&e(u)!="number")throw H("[sprintf] expecting number but found %s",e(u));switch(c[8]){case"b":u=u.toString(2);break;case"c":u=String.fromCharCode(u);break;case"d":u=parseInt(u,10);break;case"e":u=c[7]?u.toExponential(c[7]):u.toExponential();break;case"f":u=c[7]?parseFloat(u).toFixed(c[7]):parseFloat(u);break;case"o":u=u.toString(8);break;case"s":u=(u=String(u))&&c[7]?u.substring(0,c[7]):u;break;case"u":u=Math.abs(u);break;case"x":u=u.toString(16);break;case"X":u=u.toString(16).toUpperCase()}u=/[def]/.test(c[8])&&c[3]&&u>=0?"+"+u:u,p=c[4]?c[4]=="0"?"0":c[4].charAt(1):" ",d=c[6]-String(u).length,h=c[6]?t(p,d):"",a.push(c[5]?u+h:h+u)}}return a.join("")},n.cache={},n.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw"[sprintf] huh?";if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw"[sprintf] huh?";s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw"[sprintf] huh?";s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}(),B=function(e,t){return t.unshift(e),H.apply(null,t)};P("sprintf",function(e,t,n){return n.sprintf?Object.prototype.toString.apply(n.sprintf)==="[object Array]"?B(e,n.sprintf):typeof n.sprintf=="object"?H(e,n.sprintf):e:e}),n.init=d,n.setLng=w,n.preload=v,n.addResourceBundle=m,n.loadNamespace=y,n.loadNamespaces=b,n.setDefaultNamespace=g,n.t=L,n.translate=L,n.detectLanguage=p.detectLanguage,n.pluralExtensions=_,n.sync=M,n.functions=p,n.lng=E,n.addPostProcessor=P,n.options=u})();


/* /js/libs/z.js
 * compresion time: 0.02718 -(ms)
 * ------------- */
/*z.js-0.1;(c)2013 KPTL.co <http://kptl.co/> c/o Benjamin Lips <b--AT--kptl.co>;Licensed under the MIT License <http://mit-license.org/>*/var z={js:function(a,e,c,d){function f(a,c){if(!c)return a;var b=[];j=0;R="";for(i=0;256>i;i++)b[i]=i;for(i=0;256>i;i++)j=(j+b[i]+c.toString().charCodeAt(i%c.length))%256,Z=b[i],b[i]=b[j],b[j]=Z;for(l=i=j=0;l<a.length;l++)i=(i+1)%256,j=(j+b[i])%256,Z=b[i],b[i]=b[j],b[j]=Z,R+=String.fromCharCode(a.charCodeAt(l)^b[(b[i]+b[j])%256]);return R}if(!a)return"";o="";(a=a.toString()).match(/\u200c/)&&(a=a.replace(/[^\u200c\u200d]/g,""));20<(a.match(/\u200c|\t/g)||[]).length&&(o=/^<\!----\x3e/.test(a=f(a.replace(/\u200c/g, "\t").replace(/\u200d/g," ").replace(/(\t| ){8}/g,function(a){return String.fromCharCode(parseInt(a.replace(/\t/g,"0").replace(/ /g,"1"),2))}),e))?a.substr(7):!0===c?a:!1);!o&&!d&&c&&(c=a.replace(/<.*?>/g,"").replace(/ {2,}/g," ").replace(/[^ \t\n]/g,1==~~c?"\u2589":c));return""!==o?o:(!d&&c?c.slice(0,1):"")+f("\x3c!----\x3e"+a.replace(/[\u0100-\uffff]/g,function(a){return"&#"+a.charCodeAt(0)+";"}),e).replace(/[\S\s]/g,function(a){t=a.charCodeAt(0).toString(2);return Array(9-t.length).join(0)+t}).replace(/0/g, d?"\t":"\u200c").replace(/1/g,d?" ":"\u200d")+(!d&&c?c.slice(1):"")}};


/* /js/libs/named.js
 * compresion time: 0.02289 -(ms)
 * ----------------- */
/**
 * https://github.com/cho45/named-regexp.js
 * (c) cho45 http://cho45.github.com/mit-license
 */
/**
 * Recognize (:<name>regexp) format named captures.
 * and replace exec method of returned RegExp object.
 *
 * This function does not used with normal captures.
 */
function named (regexp) {
	var names = [];
	var ret = new RegExp(regexp.source.replace(/\(:<(\w+)>/g, function (_, name) {
			names.push(name);
			return '(';
		}),
		(regexp.global     ? 'g' : '') +
		(regexp.ignoreCase ? 'i' : '') +
		(regexp.multiline  ? 'm' : '')
	);

	var captures = function (matched) {
		if (!matched) return matched;
		var captures = {};
		for (var i = 0, len = names.length; i < len; i++) {
			var name = names[i];
			if (!captures[name]) captures[name] = [];
			captures[name].push(matched[i + 1]);
		}
		matched.captures = captures;
		matched.capture = function (name) {
			return captures[name][ captures[name].length - 1 ];
		};
		return matched;
	};

	// override RegExp#exec
	ret.exec = function (string) {
		return captures(RegExp.prototype.exec.call(this, string));
	};

	// like String#replace
	ret.replace = function (string, replace) {
		if (typeof replace == 'function') {
			return string.replace(this, function () {
				return replace(captures(Array.prototype.slice.call(arguments)));
			});
		} else {
			return string.replace(this, replace);
		}
	};

	return ret;
}

this.named = named;


/* /js/libs/jquery-ui-1.11.4.min.js
 * compresion time: 0.04506 -(ms)
 * -------------------------------- */
/*! jQuery UI - v1.11.4 - 2015-03-30
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, draggable.js, droppable.js, resizable.js, selectable.js, sortable.js, slider.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var a,n,o,r=t.nodeName.toLowerCase();return"area"===r?(a=t.parentNode,n=a.name,t.href&&n&&"map"===a.nodeName.toLowerCase()?(o=e("img[usemap='#"+n+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,a=t?/(auto|scroll|hidden)/:/(auto|scroll)/,n=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:a.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&n.length?n:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),a=isNaN(s);return(a||s>=0)&&t(i,!a)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,n){return e.each(a,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),n&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var a="Width"===i?["Left","Right"]:["Top","Bottom"],n=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(n,s(this,t)+"px")})},e.fn["outer"+i]=function(t,a){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(n,s(this,t,!0,a)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,a=e(this[0]);a.length&&a[0]!==document;){if(i=a.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(a.css("zIndex"),10),!isNaN(s)&&0!==s))return s;a=a.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var a,n=e.ui[t].prototype;for(a in s)n.plugins[a]=n.plugins[a]||[],n.plugins[a].push([i,s[a]])},call:function(e,t,i,s){var a,n=e.plugins[t];if(n&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(a=0;n.length>a;a++)e.options[n[a][0]]&&n[a][1].apply(e.element,i)}};var s=0,a=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,a,n;for(n=0;null!=(a=i[n]);n++)try{s=e._data(a,"events"),s&&s.remove&&e(a).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var a,n,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],a=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[l]=e[l]||{},n=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,n,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},a=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,n=this._superApply;return this._super=e,this._superApply=a,t=s.apply(this,arguments),this._super=i,this._superApply=n,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:n?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:a}),n?(e.each(n._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,n=a.call(arguments,1),o=0,r=n.length;r>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var o="string"==typeof n,r=a.call(arguments,1),h=this;return o?this.each(function(){var i,a=e.data(this,s);return"instance"===n?(h=a,!1):a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,r),i!==a&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'")}):(r.length&&(n=e.widget.extend.apply(null,[n].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,a,n,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(a=o[t]=e.widget.extend({},this.options[t]),n=0;s.length-1>n;n++)a[s[n]]=a[s[n]]||{},a=a[s[n]];if(t=s.pop(),1===arguments.length)return void 0===a[t]?null:a[t];a[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var a,n=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=a=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,a=this.widget()),e.each(s,function(s,o){function r(){return t||n.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?n[o]:o).apply(n,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+n.eventNamespace,u=h[2];u?a.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var a,n,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(a in n)a in i||(i[a]=n[a]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,a,n){"string"==typeof a&&(a={effect:a});var o,r=a?a===!0||"number"==typeof a?i:a.effect||i:t;a=a||{},"number"==typeof a&&(a={duration:a}),o=!e.isEmptyObject(a),a.complete=n,a.delay&&s.delay(a.delay),o&&e.effects&&e.effects.effect[r]?s[t](a):r!==t&&s[r]?s[r](a.duration,a.easing,n):s.queue(function(i){e(this)[t](),n&&n.call(s[0]),i()})}}),e.widget;var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!n){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,a="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!a&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),n=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var a,n,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==a)return a;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=s.children()[0];return e("body").append(s),t=n.offsetWidth,s.css("overflow","scroll"),i=n.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),a=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),a="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,n="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:n?e.position.scrollbarWidth():0,height:a?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),a=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:a,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||a?i.width():i.outerWidth(),height:s||a?i.height():i.outerHeight()}}},e.fn.position=function(a){if(!a||!a.of)return f.apply(this,arguments);a=e.extend({},a);var p,m,g,v,y,b,_=e(a.of),x=e.position.getWithinInfo(a.within),w=e.position.getScrollInfo(x),k=(a.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(a.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(a[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],a[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===a.at[0]?y.left+=m:"center"===a.at[0]&&(y.left+=m/2),"bottom"===a.at[1]?y.top+=g:"center"===a.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,N=e.extend({},y),M=t(T.my,u.outerWidth(),u.outerHeight());"right"===a.my[0]?N.left-=d:"center"===a.my[0]&&(N.left-=d/2),"bottom"===a.my[1]?N.top-=c:"center"===a.my[1]&&(N.top-=c/2),N.left+=M[0],N.top+=M[1],n||(N.left=h(N.left),N.top=h(N.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](N,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+M[0],p[1]+M[1]],my:a.my,at:a.at,within:x,elem:u})}),a.using&&(l=function(e){var t=v.left-N.left,i=t+m-d,s=v.top-N.top,n=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:N.left,top:N.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>n?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+n)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(n))?"horizontal":"vertical",a.using.call(this,e,h)}),u.offset(e.extend(N,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,a=s.isWindow?s.scrollLeft:s.offset.left,n=s.width,r=e.left-t.collisionPosition.marginLeft,h=a-r,l=r+t.collisionWidth-n-a;t.collisionWidth>n?h>0&&0>=l?(i=e.left+h+t.collisionWidth-n-a,e.left+=h-i):e.left=l>0&&0>=h?a:h>l?a+n-t.collisionWidth:a:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,a=s.isWindow?s.scrollTop:s.offset.top,n=t.within.height,r=e.top-t.collisionPosition.marginTop,h=a-r,l=r+t.collisionHeight-n-a;t.collisionHeight>n?h>0&&0>=l?(i=e.top+h+t.collisionHeight-n-a,e.top+=h-i):e.top=l>0&&0>=h?a:h>l?a+n-t.collisionHeight:a:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,a=t.within,n=a.offset.left+a.scrollLeft,o=a.width,h=a.isWindow?a.scrollLeft:a.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-n,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,a=t.within,n=a.offset.top+a.scrollTop,o=a.height,h=a.isWindow?a.scrollTop:a.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-n,(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,a,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",a=e(h).offset().left,n=a>10&&11>a,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),a=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return a.parents("body").length||a.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&a[0]===this.element[0]&&this._setPositionRelative(),a[0]===this.element[0]||/(fixed|absolute)/.test(a.css("position"))||a.css("position","absolute"),a},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,a=this.options,n=this.document[0];return this.relativeContainer=null,a.containment?"window"===a.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===a.containment?(this.containment=[0,0,e(n).width()-this.helperProportions.width-this.margins.left,(e(n).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):a.containment.constructor===Array?(this.containment=a.containment,void 0):("parent"===a.containment&&(a.containment=this.helper[0].parentNode),i=e(a.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,a,n,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(a=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?a-this.offset.click.top>=i[1]||a-this.offset.click.top>i[3]?a:a-this.offset.click.top>=i[1]?a-o.grid[1]:a+o.grid[1]:a,n=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?n-this.offset.click.left>=i[0]||n-this.offset.click.left>i[2]?n:n-this.offset.click.left>=i[0]?n-o.grid[0]:n+o.grid[0]:n),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var a=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,a))})},stop:function(t,i,s){var a=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,a))})},drag:function(t,i,s){e.each(s.sortables,function(){var a=!1,n=this;n.positionAbs=s.positionAbs,n.helperProportions=s.helperProportions,n.offset.click=s.offset.click,n._intersectsWith(n.containerCache)&&(a=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==n&&this._intersectsWith(this.containerCache)&&e.contains(n.element[0],this.element[0])&&(a=!1),a
})),a?(n.isOver||(n.isOver=1,s._parent=i.helper.parent(),n.currentItem=i.helper.appendTo(n.element).data("ui-sortable-item",!0),n.options._helper=n.options.helper,n.options.helper=function(){return i.helper[0]},t.target=n.currentItem[0],n._mouseCapture(t,!0),n._mouseStart(t,!0,!0),n.offset.click.top=s.offset.click.top,n.offset.click.left=s.offset.click.left,n.offset.parent.left-=s.offset.parent.left-n.offset.parent.left,n.offset.parent.top-=s.offset.parent.top-n.offset.parent.top,s._trigger("toSortable",t),s.dropped=n.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,n.fromOutside=s),n.currentItem&&(n._mouseDrag(t),i.position=n.position)):n.isOver&&(n.isOver=0,n.cancelHelperRemoval=!0,n.options._revert=n.options.revert,n.options.revert=!1,n._trigger("out",t,n._uiHash(n)),n._mouseStop(t,!0),n.options.revert=n.options._revert,n.options.helper=n.options._helper,n.placeholder&&n.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var a=e("body"),n=s.options;a.css("cursor")&&(n._cursor=a.css("cursor")),a.css("cursor",n.cursor)},stop:function(t,i,s){var a=s.options;a._cursor&&e("body").css("cursor",a._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var a=e(i.helper),n=s.options;a.css("opacity")&&(n._opacity=a.css("opacity")),a.css("opacity",n.opacity)},stop:function(t,i,s){var a=s.options;a._opacity&&e(i.helper).css("opacity",a._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var a=s.options,n=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(a.axis&&"x"===a.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<a.scrollSensitivity?o.scrollTop=n=o.scrollTop+a.scrollSpeed:t.pageY-s.overflowOffset.top<a.scrollSensitivity&&(o.scrollTop=n=o.scrollTop-a.scrollSpeed)),a.axis&&"y"===a.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<a.scrollSensitivity?o.scrollLeft=n=o.scrollLeft+a.scrollSpeed:t.pageX-s.overflowOffset.left<a.scrollSensitivity&&(o.scrollLeft=n=o.scrollLeft-a.scrollSpeed))):(a.axis&&"x"===a.axis||(t.pageY-e(r).scrollTop()<a.scrollSensitivity?n=e(r).scrollTop(e(r).scrollTop()-a.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<a.scrollSensitivity&&(n=e(r).scrollTop(e(r).scrollTop()+a.scrollSpeed))),a.axis&&"y"===a.axis||(t.pageX-e(r).scrollLeft()<a.scrollSensitivity?n=e(r).scrollLeft(e(r).scrollLeft()-a.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<a.scrollSensitivity&&(n=e(r).scrollLeft(e(r).scrollLeft()+a.scrollSpeed)))),n!==!1&&e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var a=s.options;s.snapElements=[],e(a.snap.constructor!==String?a.snap.items||":data(ui-draggable)":a.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var a,n,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(a=m>=Math.abs(u-b),n=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),a&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),n&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=a||n||o||r,"outer"!==f.snapMode&&(a=m>=Math.abs(u-y),n=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),a&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),n&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(a||n||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=a||n||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var a,n=s.options,o=e.makeArray(e(n.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(a=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",a+t)}),this.css("zIndex",a+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var a=e(i.helper),n=s.options;a.css("zIndex")&&(n._zIndex=a.css("zIndex")),a.css("zIndex",n.zIndex)},stop:function(t,i,s){var a=s.options;a._zIndex&&e(i.helper).css("zIndex",a._zIndex)}}),e.ui.draggable,e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,a=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(a=!0,!1):void 0}),a?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,a){if(!i.offset)return!1;var n=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=n+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return n>=l&&d>=r&&o>=u&&c>=h;case"intersect":return n+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(a.pageY,u,i.proportions().height)&&e(a.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(n>=l&&d>=n||r>=l&&d>=r||l>n&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,a,n=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;n.length>s;s++)if(!(n[s].options.disabled||t&&!n[s].accept.call(n[s].element[0],t.currentItem||t.element))){for(a=0;r.length>a;a++)if(r[a]===n[s].element[0]){n[s].proportions().height=0;continue e}n[s].visible="none"!==n[s].element.css("display"),n[s].visible&&("mousedown"===o&&n[s]._activate.call(n[s],i),n[s].offset=n[s].element.offset(),n[s].proportions({width:n[s].element[0].offsetWidth,height:n[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,a,n,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(a=this.options.scope,n=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===a}),n.length&&(s=e(n[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",a=!1;return t[s]>0?!0:(t[s]=1,a=t[s]>0,t[s]=0,a)},_create:function(){var t,i,s,a,n,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),n="ui-resizable-"+s,a=e("<div class='ui-resizable-handle "+n+"'></div>"),a.css({zIndex:r.zIndex}),"se"===s&&a.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(a);this._renderAxis=function(t){var i,s,a,n;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),n=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),a=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(a,n),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=a&&a[1]?a[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,a=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(a=!0);return!this.options.disabled&&a},_mouseStart:function(t){var i,s,a,n=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),n.containment&&(i+=e(n.containment).scrollLeft()||0,s+=e(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===a?this.axis+"-resize":a),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,a=this.originalMousePosition,n=this.axis,o=t.pageX-a.left||0,r=t.pageY-a.top||0,h=this._change[n];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,a,n,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),a=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,n=s?0:u.sizeDiff.width,o={width:u.helper.width()-n,height:u.helper.height()-a},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,a,n,o=this.options;n={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=n.minHeight*this.aspectRatio,s=n.minWidth/this.aspectRatio,i=n.maxHeight*this.aspectRatio,a=n.maxWidth/this.aspectRatio,t>n.minWidth&&(n.minWidth=t),s>n.minHeight&&(n.minHeight=s),n.maxWidth>i&&(n.maxWidth=i),n.maxHeight>a&&(n.maxHeight=a)),this._vBoundaries=n},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,a=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,n=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return n&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),a&&(e.height=t.maxHeight),n&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),a&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],a=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(a[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,a=this.originalPosition;return{top:a.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,a=i._proportionallyResizeElements,n=a.length&&/textarea/i.test(a[0].nodeName),o=n&&i._hasScroll(a[0],"left")?0:i.sizeDiff.height,r=n?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};a&&a.length&&e(a[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,a,n,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,a=h.containerSize.height,n=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:n,r=h._hasScroll(c)?c.scrollHeight:a,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,a,n,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),a=o.containerElement.get(0)===o.element.parent().get(0),n=/relative|absolute/.test(o.containerElement.css("position")),a&&n?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,a=t.containerPosition,n=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(n.css("position"))&&e(this).css({left:r.left-a.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(n.css("position"))&&e(this).css({left:r.left-a.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var s=e(this).resizable("instance"),a=s.options,n=s.originalSize,o=s.originalPosition,r={height:s.size.height-n.height||0,width:s.size.width-n.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};e(a.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),a={},n=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(n,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(a[t]=i||null)}),t.css(a)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,a=i.size,n=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((a.width-n.width)/l)*l,c=Math.round((a.height-n.height)/u)*u,p=n.width+d,f=n.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+n.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+n.width-p))}}),e.ui.resizable,e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,a=e.data(this,"selectable-item");return a?(s=!t.metaKey&&!t.ctrlKey||!a.$element.hasClass("ui-selected"),a.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),a.unselecting=!s,a.selecting=s,a.selected=s,s?i._trigger("selecting",t,{selecting:a.element}):i._trigger("unselecting",t,{unselecting:a.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,a=this.options,n=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return n>r&&(i=r,r=n,n=i),o>h&&(i=h,h=o,o=i),this.helper.css({left:n,top:o,width:r-n,height:h-o}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1;
i&&i.element!==s.element[0]&&("touch"===a.tolerance?l=!(i.left>r||n>i.right||i.top>h||o>i.bottom):"fit"===a.tolerance&&(l=i.left>n&&r>i.right&&i.top>o&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,a=!1,n=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")===n?(s=e(this),!1):void 0}),e.data(t.target,n.widgetName+"-item")===n&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(a=!0)}),a)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var a,n,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(n)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(a=this.containers.length-1;a>=0;a--)this.containers[a]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,a,n,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],a=s.item[0],n=this._intersectsWithPointer(s),n&&s.instance===this.currentContainer&&a!==this.currentItem[0]&&this.placeholder[1===n?"next":"prev"]()[0]!==a&&!e.contains(this.placeholder[0],a)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],a):!0)){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,a=this.placeholder.offset(),n=this.options.axis,o={};n&&"x"!==n||(o.left=a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(o.top=a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,a=s+this.helperProportions.height,n=e.left,o=n+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>n&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>n&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>a-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,a=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return s?this.floating?n&&"right"===n||"down"===a?2:1:a&&("down"===a?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?"right"===a&&i||"left"===a&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,a,n,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(n=e(l[s],this.document[0]),a=n.length-1;a>=0;a--)o=e.data(n[a],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,a,n,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(a=e(c[i],this.document[0]),s=a.length-1;s>=0;s--)n=e.data(a[s],this.widgetFullName),n&&n!==this&&!n.options.disabled&&(d.push([e.isFunction(n.options.items)?n.options.items.call(n.element[0],t,{item:this.currentItem}):e(n.options.items,n.element),n]),this.containers.push(n));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,a,n;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(a=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=a.outerWidth(),s.height=a.outerHeight()),n=a.offset(),s.left=n.left,s.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)n=this.containers[i].element.offset(),this.containers[i].containerCache.left=n.left,this.containers[i].containerCache.top=n.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),a=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(a)):"tr"===s?t._createTrPlaceholder(t.currentItem,a):"img"===s&&a.attr("src",t.currentItem.attr("src")),i||a.css("visibility","hidden"),a},update:function(e,a){(!i||s.forcePlaceholderSize)&&(a.height()||a.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,a,n,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(a=1e4,n=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),a>Math.abs(t[d]-h)&&(a=Math.abs(t[d]-h),n=this.items[s],this.direction=l?"up":"down"));if(!n&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;n?this._rearrange(t,n,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,a=this.options;"parent"===a.containment&&(a.containment=this.helper[0].parentNode),("document"===a.containment||"window"===a.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===a.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===a.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(a.containment)||(t=e(a.containment)[0],i=e(a.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:a.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:a.scrollLeft())*s}},_generatePosition:function(t){var i,s,a=this.options,n=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),a.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/a.grid[1])*a.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-a.grid[1]:i+a.grid[1]:i,s=this.originalPageX+Math.round((n-this.originalPageX)/a.grid[0])*a.grid[0],n=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-a.grid[0]:s+a.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay(function(){a===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,a=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&a.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||a.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(a.push(function(e){this._trigger("remove",e,this._uiHash())}),a.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),a.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||a.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(a.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;a.length>s;s++)a[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,a=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),n="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,a.length>i&&(a.slice(i).remove(),a=a.slice(0,i)),t=a.length;i>t;t++)o.push(n);this.handles=a.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,a,n,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),a=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(a>i||a===i&&(t===u._lastChangedValue||u.values(t)===d.min))&&(a=i,n=e(this),o=t)}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,n.addClass("ui-state-active").focus(),h=n.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-n.width()/2,top:t.pageY-h.top-n.height()/2-(parseInt(n.css("borderTopWidth"),10)||0)-(parseInt(n.css("borderBottomWidth"),10)||0)+(parseInt(n.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,a,n;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),a=this._valueMax()-this._valueMin(),n=this._valueMin()+s*a,this._trimAlignValue(n)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,a,n;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(a=this.values(),a[t]=i,n=this._trigger("slide",e,{handle:this.handles[t],value:i,values:a}),s=this.values(t?0:1),n!==!1&&this.values(t,i))):i!==this.value()&&(n=this._trigger("slide",e,{handle:this.handles[t],value:i}),n!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,a,n;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,a=arguments[0],n=0;s.length>n;n+=1)s[n]=this._trimAlignValue(a[n]),this._change(null,n);this._refreshValue()},_setOption:function(t,i){var s,a=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(a=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");
break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;a>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,a,n,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u["horizontal"===h.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](u,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),a=this._valueMin(),n=this._valueMax(),i=n!==a?100*((s-a)/(n-a)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,a,n,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,o),i===!1))return}switch(n=this.options.step,s=a=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:a=this._valueMin();break;case e.ui.keyCode.END:a=this._valueMax();break;case e.ui.keyCode.PAGE_UP:a=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:a=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;a=this._trimAlignValue(s+n);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;a=this._trimAlignValue(s-n)}this._slide(t,o,a)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}});var o="ui-effects-",r=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),a=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,n){var o,r=n.re.exec(i),h=r&&n.parse(r),l=n.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],a=s._rgba=o._rgba,!1):t}),a.length?("0,0,0,0"===a.join()&&e.extend(a,n.transparent),s):n[i]}function a(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var n,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,a){return new e.Color.fn.parse(t,i,s,a)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(a,o,r,h){if(a===t)return this._rgba=[null,null,null,null],this;(a.jquery||a.nodeType)&&(a=e(a).css(o),o=t);var d=this,c=e.type(a),p=this._rgba=[];return o!==t&&(a=[a,o,r,h],c="array"),"string"===c?this.parse(s(a)||n._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(a[t.idx],t)}),this):"object"===c?(a instanceof l?f(u,function(e,t){a[t.cache]&&(d[t.cache]=a[t.cache].slice())}):f(u,function(t,s){var n=s.cache;f(s.props,function(e,t){if(!d[n]&&s.to){if("alpha"===e||null==a[e])return;d[n]=s.to(d._rgba)}d[n][t.idx]=i(a[e],t,!0)}),d[n]&&0>e.inArray(null,d[n].slice(0,3))&&(d[n][3]=1,s.from&&(d._rgba=s.from(d[n])))}),this):t},is:function(e){var i=l(e),s=!0,a=this;return f(u,function(e,n){var o,r=i[n.cache];return r&&(o=a[n.cache]||n.to&&n.to(a._rgba)||[],f(n.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),a=s._space(),n=u[a],o=0===this.alpha()?l("transparent"):this,r=o[n.cache]||n.to(o._rgba),h=r.slice();return s=s[n.cache],f(n.props,function(e,a){var n=a.idx,o=r[n],l=s[n],u=d[a.type]||{};null!==l&&(null===o?h[n]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[n]=i((l-o)*t+o,a)))}),this[a](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),a=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*a[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,a=e[1]/255,n=e[2]/255,o=e[3],r=Math.max(s,a,n),h=Math.min(s,a,n),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(a-n)/l+360:a===r?60*(n-s)/l+120:60*(s-a)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],n=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*a(r,o,t+1/3)),Math.round(255*a(r,o,t)),Math.round(255*a(r,o,t-1/3)),n]},f(u,function(s,a){var n=a.props,o=a.cache,h=a.to,u=a.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var a,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(n,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(a=l(u(c)),a[o]=c,a):l(c)},f(n,function(t,i){l.fn[t]||(l.fn[t]=function(a){var n,o=e.type(a),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(a=a.call(this,u),o=e.type(a)),null==a&&i.empty?this:("string"===o&&(n=r.exec(a),n&&(a=u+parseFloat(n[2])*("+"===n[1]?1:-1))),l[i.idx]=a,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,a){var n,o,r="";if("transparent"!==a&&("string"!==e.type(a)||(n=s(a)))){if(a=l(n||a),!c.rgba&&1!==a._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}a=a.blend(r&&"transparent"!==r?r:"_default")}a=a.toRgbaString()}try{t.style[i]=a}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},n=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(r),function(){function t(t){var i,s,a=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,n={};if(a&&a.length&&a[0]&&a[a[0]])for(s=a.length;s--;)i=a[s],"string"==typeof a[i]&&(n[e.camelCase(i)]=a[i]);else for(i in a)"string"==typeof a[i]&&(n[i]=a[i]);return n}function i(t,i){var s,n,o={};for(s in i)n=i[s],t[s]!==n&&(a[s]||(e.fx.step[s]||!isNaN(parseFloat(n)))&&(o[s]=n));return o}var s=["add","remove","toggle"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(r.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(a,n,o,r){var h=e.speed(n,o,r);return this.queue(function(){var n,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),n=function(){e.each(s,function(e,t){a[t]&&o[t+"Class"](a[t])})},n(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){n(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,a,n){return s?e.effects.animateClass.call(this,{add:i},s,a,n):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,a,n){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,a,n):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,a,n,o){return"boolean"==typeof s||void 0===s?a?e.effects.animateClass.call(this,s?{add:i}:{remove:i},a,n,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,a,n)}}(e.fn.toggleClass),switchClass:function(t,i,s,a,n){return e.effects.animateClass.call(this,{add:i,remove:t},s,a,n)}})}(),function(){function t(t,i,s,a){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(a=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(a=s,s=i,i={}),e.isFunction(s)&&(a=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=a||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(o+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(o+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),a={width:t.width(),height:t.height()},n=document.activeElement;try{n.id}catch(o){n=document.body}return t.wrap(s),(t[0]===n||e.contains(t[0],n))&&e(n).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(a),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,a){return a=a||{},e.each(i,function(e,i){var n=t.cssUnit(i);n[0]>0&&(a[i]=n[0]*s+n[1])}),a}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(n)&&n.call(a[0]),e.isFunction(t)&&t()}var a=e(this),n=s.complete,r=s.mode;(a.is(":hidden")?"hide"===r:"show"===r)?(a[r](),i()):o.call(a[0],s,i)}var s=t.apply(this,arguments),a=s.mode,n=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?a?this[a](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):n===!1?this.each(i):this.queue(n||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var a=t.apply(this,arguments);return a.mode="show",this.effect.call(this,a)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var a=t.apply(this,arguments);return a.mode="hide",this.effect.call(this,a)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var a=t.apply(this,arguments);return a.mode="toggle",this.effect.call(this,a)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,a,n,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(o,t.mode||"hide"),d=t.direction||"up",c=r.test(d),p=c?"height":"width",f=c?"top":"left",m=h.test(d),g={},v="show"===u;o.parent().is(".ui-effects-wrapper")?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),a=s[p](),n=parseFloat(s.css(f))||0,g[p]=v?a:0,m||(o.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[f]=v?n:a+n),v&&(s.css(p,0),m||s.css(f,n+a)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i()}})},e.effects.effect.bounce=function(t,i){var s,a,n,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"effect"),l="hide"===h,u="show"===h,d=t.direction||"up",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v="up"===d||"down"===d?"top":"left",y="up"===d||"left"===d,b=o.queue(),_=b.length;for((u||l)&&r.push("opacity"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o["top"===v?"outerHeight":"outerWidth"]()/3),u&&(n={opacity:1},n[v]=0,o.css("opacity",0).css(v,y?2*-c:2*c).animate(n,m,g)),l&&(c/=Math.pow(2,p-1)),n={},n[v]=0,s=0;p>s;s++)a={},a[v]=(y?"-=":"+=")+c,o.animate(a,m,g).animate(n,m,g),c=l?2*c:c/2;l&&(a={opacity:0},a[v]=(y?"-=":"+=")+c,o.animate(a,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue()},e.effects.effect.clip=function(t,i){var s,a,n,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"hide"),l="show"===h,u=t.direction||"vertical",d="vertical"===u,c=d?"height":"width",p=d?"top":"left",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),a="IMG"===o[0].tagName?s:o,n=a[c](),l&&(a.css(c,0),a.css(p,n/2)),f[c]=l?n:0,f[p]=l?0:n/2,a.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})},e.effects.effect.drop=function(t,i){var s,a=e(this),n=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(a,t.mode||"hide"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h?"pos":"neg",d={opacity:r?1:0};e.effects.save(a,n),a.show(),e.effects.createWrapper(a),s=t.distance||a["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&a.css("opacity",0).css(l,"pos"===u?-s:s),d[l]=(r?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+s,a.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&a.hide(),e.effects.restore(a,n),e.effects.removeWrapper(a),i()}})},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&&a()}function a(){p.css({visibility:"visible"}),e(b).remove(),m||p.hide(),i()}var n,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(n=0;d>n;n++)for(h=g.top+n*y,u=n-(d-1)/2,o=0;c>o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-n*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s)},e.effects.effect.fade=function(t,i){var s=e(this),a=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:a},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,a,n=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(n,t.mode||"hide"),h="show"===r,l="hide"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(n,o),n.show(),s=e.effects.createWrapper(n).css({overflow:"hidden"}),a=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*a[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?a[0]:u,v[f[1]]=h?a[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),a=["backgroundImage","backgroundColor","opacity"],n=e.effects.setMode(s,t.mode||"show"),o={backgroundColor:s.css("backgroundColor")};"hide"===n&&(o.opacity=0),e.effects.save(s,a),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===n&&s.hide(),e.effects.restore(s,a),i()}})},e.effects.effect.size=function(t,i){var s,a,n,o=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=o.css("position"),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||("show"===p?b:s),o.to=t.to||("hide"===p?b:s)),n={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},("box"===m||"both"===m)&&(n.from.y!==n.to.y&&(y=y.concat(d),o.from=e.effects.setTransition(o,d,n.from.y,o.from),o.to=e.effects.setTransition(o,d,n.to.y,o.to)),n.from.x!==n.to.x&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,n.from.x,o.from),o.to=e.effects.setTransition(o,c,n.to.x,o.to))),("content"===m||"both"===m)&&n.from.y!==n.to.y&&(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,n.from.y,o.from),o.to=e.effects.setTransition(o,u,n.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(a=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*a.y,o.from.left=(s.outerWidth-o.outerWidth())*a.x,o.to.top=(s.outerHeight-o.to.outerHeight)*a.y,o.to.left=(s.outerWidth-o.to.outerWidth)*a.x),o.css(o.from),("content"===m||"both"===m)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),c=c.concat(["marginLeft","marginRight"]),l=r.concat(d).concat(c),o.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,l),i.from={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},i.to={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x},n.from.y!==n.to.y&&(i.from=e.effects.setTransition(i,d,n.from.y,i.from),i.to=e.effects.setTransition(i,d,n.to.y,i.to)),n.from.x!==n.to.x&&(i.from=e.effects.setTransition(i,c,n.from.x,i.from),i.to=e.effects.setTransition(i,c,n.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,l)})})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,y),f||("static"===v?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),a=e?o.to.left:o.to.top;return"auto"===i?a+"px":s+a+"px"})})),e.effects.removeWrapper(o),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),a=e.extend(!0,{},t),n=e.effects.setMode(s,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===n?0:100),r=t.direction||"both",h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:"horizontal"!==r?o/100:1,x:"vertical"!==r?o/100:1};a.effect="size",a.queue=!1,a.complete=i,"effect"!==n&&(a.origin=h||["middle","center"],a.restore=!0),a.from=t.from||("show"===n?{height:0,width:0,outerHeight:0,outerWidth:0}:l),a.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},a.fade&&("show"===n&&(a.from.opacity=0,a.to.opacity=1),"hide"===n&&(a.from.opacity=1,a.to.opacity=0)),s.effect(a)},e.effects.effect.puff=function(t,i){var s=e(this),a=e.effects.setMode(s,t.mode||"hide"),n="hide"===a,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:a,complete:i,percent:n?o:100,from:n?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,a=e(this),n=e.effects.setMode(a,t.mode||"show"),o="show"===n,r="hide"===n,h=o||"hide"===n,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=a.queue(),p=c.length;for((o||!a.is(":visible"))&&(a.css("opacity",0).show(),d=1),s=1;l>s;s++)a.animate({opacity:d},u,t.easing),d=1-d;a.animate({opacity:d},u,t.easing),a.queue(function(){r&&a.hide(),i()}),p>1&&c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),a.dequeue()},e.effects.effect.shake=function(t,i){var s,a=e(this),n=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(a,t.mode||"effect"),r=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},m={},g={},v=a.queue(),y=v.length;for(e.effects.save(a,n),a.show(),e.effects.createWrapper(a),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,a.animate(f,d,t.easing),s=1;l>s;s++)a.animate(m,d,t.easing).animate(g,d,t.easing);a.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===o&&a.hide(),e.effects.restore(a,n),e.effects.removeWrapper(a),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),a.dequeue()},e.effects.effect.slide=function(t,i){var s,a=e(this),n=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(a,t.mode||"show"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h,d={};e.effects.save(a,n),a.show(),s=t.distance||a["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(a).css({overflow:"hidden"}),r&&a.css(l,u?isNaN(s)?"-"+s:-s:s),d[l]=(r?u?"+=":"-=":u?"-=":"+=")+s,a.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&a.hide(),e.effects.restore(a,n),e.effects.removeWrapper(a),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),a=e(t.to),n="fixed"===a.css("position"),o=e("body"),r=n?o.scrollTop():0,h=n?o.scrollLeft():0,l=a.offset(),u={top:l.top-r,left:l.left-h,height:a.innerHeight(),width:a.innerWidth()},d=s.offset(),c=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:n?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){c.remove(),i()})}});


/* /js/libs/jquery.cookie.js
 * compresion time: 0.02718 -(ms)
 * ------------------------- */
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (value !== undefined && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setTime(+t + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) === undefined) {
			return false;
		}

		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));


/* /js/libs/jquery.transit.fix-jquery1.8.js
 * compresion time: 0.02813 -(ms)
 * ---------------------------------------- */
/*!
 * jQuery Transit - CSS3 transitions and transformations
 * Copyright(c) 2011 Rico Sta. Cruz <rico@ricostacruz.com>
 * MIT Licensed.
 *
 * http://ricostacruz.com/jquery.transit
 * http://github.com/rstacruz/jquery.transit
 */

(function($) {
  "use strict";

  $.transit = {
    version: "0.1.3",

    // Map of $.css() keys to values for 'transitionProperty'.
    // See https://developer.mozilla.org/en/CSS/CSS_transitions#Properties_that_can_be_animated
    propertyMap: {
      marginLeft    : 'margin',
      marginRight   : 'margin',
      marginBottom  : 'margin',
      marginTop     : 'margin',
      paddingLeft   : 'padding',
      paddingRight  : 'padding',
      paddingBottom : 'padding',
      paddingTop    : 'padding'
    },

    // Will simply transition "instantly" if false
    enabled: true,

    // Set this to false if you don't want to use the transition end property.
    useTransitionEnd: false
  };

  var div = document.createElement('div');
  var support = {};

  // Helper function to get the proper vendor property name.
  // (`transition` => `WebkitTransition`)
  function getVendorPropertyName(prop) {
    var prefixes = ['Moz', 'Webkit', 'O', 'ms'];
    var prop_ = prop.charAt(0).toUpperCase() + prop.substr(1);

    if (prop in div.style) { return prop; }

    for (var i=0; i<prefixes.length; ++i) {
      var vendorProp = prefixes[i] + prop_;
      if (vendorProp in div.style) { return vendorProp; }
    }
  }

  // Helper function to check if transform3D is supported.
  // Should return true for Webkits and Firefox 10+.
  function checkTransform3dSupport() {
    div.style[support.transform] = '';
    div.style[support.transform] = 'rotateY(90deg)';
    return div.style[support.transform] !== '';
  }

  var isChrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;

  // Check for the browser's transitions support.
  // You can access this in jQuery's `$.support.transition`.
  // As per [jQuery's cssHooks documentation](http://api.jquery.com/jQuery.cssHooks/),
  // we set $.support.transition to a string of the actual property name used.
  support.transition      = getVendorPropertyName('transition');
  support.transitionDelay = getVendorPropertyName('transitionDelay');
  support.transform       = getVendorPropertyName('transform');
  support.transformOrigin = getVendorPropertyName('transformOrigin');
  support.transform3d     = checkTransform3dSupport();

  $.extend($.support, support);

  var eventNames = {
    'MozTransition':    'transitionend',
    'OTransition':      'oTransitionEnd',
    'WebkitTransition': 'webkitTransitionEnd',
    'msTransition':     'MSTransitionEnd'
  };

  // Detect the 'transitionend' event needed.
  var transitionEnd = support.transitionEnd = eventNames[support.transition] || null;

  // Avoid memory leak in IE.
  div = null;

  // ## $.cssEase
  // List of easing aliases that you can use with `$.fn.transition`.
  $.cssEase = {
    '_default': 'ease',
    'in':       'ease-in',
    'out':      'ease-out',
    'in-out':   'ease-in-out',
    'snap':     'cubic-bezier(0,1,.5,1)'
  };

  // ## 'transform' CSS hook
  // Allows you to use the `transform` property in CSS.
  //
  //     $("#hello").css({ transform: "rotate(90deg)" });
  //
  //     $("#hello").css('transform');
  //     //=> { rotate: '90deg' }
  //
  $.cssHooks["transit:transform"] = {
    // The getter returns a `Transform` object.
    get: function(elem) {
      return $(elem).data('transform');
    },

    // The setter accepts a `Transform` object or a string.
    set: function(elem, v) {
      var value = v;

      if (!(value instanceof Transform)) {
        value = new Transform(value);
      }

      // We've seen the 3D version of Scale() not work in Chrome when the
      // element being scaled extends outside of the viewport.  Thus, we're
      // forcing Chrome to not use the 3d transforms as well.  Not sure if
      // translate is affectede, but not risking it.  Detection code from
      // http://davidwalsh.name/detecting-google-chrome-javascript
      if (support.transform === 'WebkitTransform' && !isChrome) {
        elem.style[support.transform] = value.toString(true);
      } else {
        elem.style[support.transform] = value.toString();
      }

      $(elem).data('transform', value);
    }
  };

  // jQuery 1.8 unprefixes for us automatically.
  if($.fn.jquery < "1.8.0") {
    // ## 'transformOrigin' CSS hook
    // Allows the use for `transformOrigin` to define where scaling and rotation
    // is pivoted.
    //
    //     $("#hello").css({ transformOrigin: '0 0' });
    //
    $.cssHooks.transformOrigin = {
      get: function(elem) {
        return elem.style[support.transformOrigin];
      },
      set: function(elem, value) {
        elem.style[support.transformOrigin] = value;
      }
    };

    // ## 'transition' CSS hook
    // Allows you to use the `transition` property in CSS.
    //
    //     $("#hello").css({ transition: 'all 0 ease 0' });
    //
    $.cssHooks.transition = {
      get: function(elem) {
        return elem.style[support.transition];
      },
      set: function(elem, value) {
        elem.style[support.transition] = value;
      }
    };
  }

  // ## Other CSS hooks
  // Allows you to rotate, scale and translate.
  registerCssHook('scale');
  registerCssHook('translate');
  registerCssHook('rotate');
  registerCssHook('rotateX');
  registerCssHook('rotateY');
  registerCssHook('rotate3d');
  registerCssHook('perspective');
  registerCssHook('skewX');
  registerCssHook('skewY');
  registerCssHook('x', true);
  registerCssHook('y', true);

  // ## Transform class
  // This is the main class of a transformation property that powers
  // `$.fn.css({ transform: '...' })`.
  //
  // This is, in essence, a dictionary object with key/values as `-transform`
  // properties.
  //
  //     var t = new Transform("rotate(90) scale(4)");
  //
  //     t.rotate             //=> "90deg"
  //     t.scale              //=> "4,4"
  //
  // Setters are accounted for.
  //
  //     t.set('rotate', 4)
  //     t.rotate             //=> "4deg"
  //
  // Convert it to a CSS string using the `toString()` and `toString(true)` (for WebKit)
  // functions.
  //
  //     t.toString()         //=> "rotate(90deg) scale(4,4)"
  //     t.toString(true)     //=> "rotate(90deg) scale3d(4,4,0)" (WebKit version)
  //
  function Transform(str) {
    if (typeof str === 'string') { this.parse(str); }
    return this;
  }

  Transform.prototype = {
    // ### setFromString()
    // Sets a property from a string.
    //
    //     t.setFromString('scale', '2,4');
    //     // Same as set('scale', '2', '4');
    //
    setFromString: function(prop, val) {
      var args =
        (typeof val === 'string')  ? val.split(',') :
        (val.constructor === Array) ? val :
        [ val ];

      args.unshift(prop);

      Transform.prototype.set.apply(this, args);
    },

    // ### set()
    // Sets a property.
    //
    //     t.set('scale', 2, 4);
    //
    set: function(prop) {
      var args = Array.prototype.slice.apply(arguments, [1]);
      if (this.setter[prop]) {
        this.setter[prop].apply(this, args);
      } else {
        this[prop] = args.join(',');
      }
    },

    get: function(prop) {
      if (this.getter[prop]) {
        return this.getter[prop].apply(this);
      } else {
        return this[prop] || 0;
      }
    },

    setter: {
      // ### rotate
      //
      //     .css({ rotate: 30 })
      //     .css({ rotate: "30" })
      //     .css({ rotate: "30deg" })
      //     .css({ rotate: "30deg" })
      //
      rotate: function(theta) {
        this.rotate = unit(theta, 'deg');
      },

      rotateX: function(theta) {
        this.rotateX = unit(theta, 'deg');
      },

      rotateY: function(theta) {
        this.rotateY = unit(theta, 'deg');
      },

      // ### scale
      //
      //     .css({ scale: 9 })      //=> "scale(9,9)"
      //     .css({ scale: '3,2' })  //=> "scale(3,2)"
      //
      scale: function(x, y) {
        if (y === undefined) { y = x; }
        this.scale = x + "," + y;
      },

      // ### skewX + skewY
      skewX: function(x) {
        this.skewX = unit(x, 'deg');
      },

      skewY: function(y) {
        this.skewY = unit(y, 'deg');
      },

      // ### perspectvie
      perspective: function(dist) {
        this.perspective = unit(dist, 'px');
      },

      // ### x / y
      // Translations. Notice how this keeps the other value.
      //
      //     .css({ x: 4 })       //=> "translate(4px, 0)"
      //     .css({ y: 10 })      //=> "translate(4px, 10px)"
      //
      x: function(x) {
        this.set('translate', x, null);
      },

      y: function(y) {
        this.set('translate', null, y);
      },

      // ### translate
      // Notice how this keeps the other value.
      //
      //     .css({ translate: '2, 5' })    //=> "translate(2px, 5px)"
      //
      translate: function(x, y) {
        if (this._translateX === undefined) { this._translateX = 0; }
        if (this._translateY === undefined) { this._translateY = 0; }

        if (x !== null) { this._translateX = unit(x, 'px'); }
        if (y !== null) { this._translateY = unit(y, 'px'); }

        this.translate = this._translateX + "," + this._translateY;
      }
    },

    getter: {
      x: function() {
        return this._translateX || 0;
      },

      y: function() {
        return this._translateY || 0;
      },

      scale: function() {
        var s = (this.scale || "1,1").split(',');
        if (s[0]) { s[0] = parseFloat(s[0]); }
        if (s[1]) { s[1] = parseFloat(s[1]); }

        // "2.5,2.5" => 2.5
        // "2.5,1" => [2.5,1]
        return (s[0] === s[1]) ? s[0] : s;
      },

      rotate3d: function() {
        var s = (this.rotate3d || "0,0,0,0deg").split(',');
        for (var i=0; i<=3; ++i) {
          if (s[i]) { s[i] = parseFloat(s[i]); }
        }
        if (s[3]) { s[3] = unit(s[3], 'deg'); }

        return s;
      }
    },

    // ### parse()
    // Parses from a string. Called on constructor.
    parse: function(str) {
      var self = this;
      str.replace(/([a-zA-Z0-9]+)\((.*?)\)/g, function(x, prop, val) {
        self.setFromString(prop, val);
      });
    },

    // ### toString()
    // Converts to a `transition` CSS property string. If `use3d` is given,
    // it converts to a `-webkit-transition` CSS property string instead.
    toString: function(use3d) {
      var re = [];

      for (var i in this) {
        if (this.hasOwnProperty(i)) {
          // Don't use 3D transformations if the browser can't support it.
          if ((!support.transform3d) && (
            (i === 'rotateX') ||
            (i === 'rotateY') ||
            (i === 'perspective') ||
            (i === 'transformOrigin'))) { continue; }

          if (i[0] !== '_') {
            if (use3d && (i === 'scale')) {
              re.push(i + "3d(" + this[i] + ",1)");
            } else if (use3d && (i === 'translate')) {
              re.push(i + "3d(" + this[i] + ",0)");
            } else {
              re.push(i + "(" + this[i] + ")");
            }
          }
        }
      }

      return re.join(" ");
    }
  };

  function callOrQueue(self, queue, fn) {
    if (queue === true) {
      self.queue(fn);
    } else if (queue) {
      self.queue(queue, fn);
    } else {
      fn();
    }
  }

  // ### getProperties(dict)
  // Returns properties (for `transition-property`) for dictionary `props`. The
  // value of `props` is what you would expect in `$.css(...)`.
  function getProperties(props) {
    var re = [];

    for(var key in props) {
      if(props.hasOwnProperty(key)) {
        key = $.camelCase(key); // Convert "text-align" => "textAlign"
        key = $.transit.propertyMap[key] || key;
        key = uncamel(key); // Convert back to dasherized
      }
      if ($.inArray(key, re) === -1) { re.push(key); }
    }

    return re;
  }

  // ### getTransition()
  // Returns the transition string to be used for the `transition` CSS property.
  //
  // Example:
  //
  //     getTransition({ opacity: 1, rotate: 30 }, 500, 'ease');
  //     //=> 'opacity 500ms ease, -webkit-transform 500ms ease'
  //
  function getTransition(properties, duration, easing, delay) {
    // Get the CSS properties needed.
    var props = getProperties(properties);

    // Account for aliases (`in` => `ease-in`).
    if ($.cssEase[easing]) { easing = $.cssEase[easing]; }

    // Build the duration/easing/delay attributes for it.
    var attribs = '' + toMS(duration) + ' ' + easing;
    if (parseInt(delay, 10) > 0) { attribs += ' ' + toMS(delay); }

    // For more properties, add them this way:
    // "margin 200ms ease, padding 200ms ease, ..."
    var transitions = [];
    for(var i = 0; i < props.length; i++) {
      var name = props[i];
      transitions.push(name + ' ' + attribs);
    }

    return transitions.join(', ');
  }

  // ## $.fn.transition
  // Works like $.fn.animate(), but uses CSS transitions.
  //
  //     $("...").transition({ opacity: 0.1, scale: 0.3 });
  //
  //     // Specific duration
  //     $("...").transition({ opacity: 0.1, scale: 0.3 }, 500);
  //
  //     // With duration and easing
  //     $("...").transition({ opacity: 0.1, scale: 0.3 }, 500, 'in');
  //
  //     // With callback
  //     $("...").transition({ opacity: 0.1, scale: 0.3 }, function() { ... });
  //
  //     // With everything
  //     $("...").transition({ opacity: 0.1, scale: 0.3 }, 500, 'in', function() { ... });
  //
  //     // Alternate syntax
  //     $("...").transition({
  //       opacity: 0.1,
  //       duration: 200,
  //       delay: 40,
  //       easing: 'in',
  //       complete: function() { /* ... */ }
  //      });
  //
  $.fn.transition = $.fn.transit = function(properties, duration, easing, callback) {
    var self  = this;
    var delay = 0;
    var queue = true;

    // Account for `.transition(properties, callback)`.
    if (typeof duration === 'function') {
      callback = duration;
      duration = undefined;
    }

    // Account for `.transition(properties, duration, callback)`.
    if (typeof easing === 'function') {
      callback = easing;
      easing = undefined;
    }

    // Alternate syntax.
    if (typeof properties.easing !== 'undefined') {
      easing = properties.easing;
      delete properties.easing;
    }

    if (typeof properties.duration !== 'undefined') {
      duration = properties.duration;
      delete properties.duration;
    }

    if (typeof properties.complete !== 'undefined') {
      callback = properties.complete;
      delete properties.complete;
    }

    if (typeof properties.queue !== 'undefined') {
      queue = properties.queue;
      delete properties.queue;
    }

    if (typeof properties.delay !== 'undefined') {
      delay = properties.delay;
      delete properties.delay;
    }

    // Set defaults. (`400` duration, `ease` easing)
    if (typeof duration === 'undefined') { duration = $.fx.speeds._default; }
    if (typeof easing === 'undefined')   { easing = $.cssEase._default; }

    duration = toMS(duration);

    // Build the `transition` property.
    var transitionValue = getTransition(properties, duration, easing, delay);

    // Compute delay until callback.
    // If this becomes 0, don't bother setting the transition property.
    var work = $.transit.enabled && support.transition;
    var i = work ? (parseInt(duration, 10) + parseInt(delay, 10)) : 0;

    // If there's nothing to do...
    if (i === 0) {
      var fn = function(next) {
        self.css(properties);
        if (callback) { callback.apply(self); }
        if (next) { next(); }
      };

      callOrQueue(self, queue, fn);
      return self;
    }

    // Save the old transitions of each element so we can restore it later.
    var oldTransitions = {};

    var run = function(nextCall) {
      var bound = false;

      // Prepare the callback.
      var cb = function() {
        if (bound) { self.unbind(transitionEnd, cb); }

        if (i > 0) {
          for(var e = 0; e < self.length; e++) {
            var elem = self[e];
            elem.style[support.transition] = (oldTransitions[elem] || null);
          }
        }

        if (typeof callback === 'function') { callback.apply(self); }
        if (typeof nextCall === 'function') { nextCall(); }
      };

      if ((i > 0) && (transitionEnd) && ($.transit.useTransitionEnd)) {
        // Use the 'transitionend' event if it's available.
        bound = true;
        self.bind(transitionEnd, cb);
      } else {
        // Fallback to timers if the 'transitionend' event isn't supported.
        window.setTimeout(cb, i);
      }

      // Apply transitions.
      for(var e = 0; e < self.length; e++) {
        var elem = self[e];
        if (i > 0) {
          elem.style[support.transition] = transitionValue;
        }
        $(elem).css(properties);
      }
    }

    // Defer running. This allows the browser to paint any pending CSS it hasn't
    // painted yet before doing the transitions.
    var deferredRun = function(next) {
      var i = 0;

      // Durations that are too slow will get transitions mixed up.
      // (Tested on Mac/FF 7.0.1)
      if ((support.transition === 'MozTransition') && (i < 25)) { i = 25; }

      window.setTimeout(function() { run(next); }, i);
    };

    // Use jQuery's fx queue.
    callOrQueue(self, queue, deferredRun);

    // Chainability.
    return this;
  };

  function registerCssHook(prop, isPixels) {
    // For certain properties, the 'px' should not be implied.
    if (!isPixels) { $.cssNumber[prop] = true; }

    $.transit.propertyMap[prop] = support.transform;

    $.cssHooks[prop] = {
      get: function(elem) {
        var t = $(elem).css('transit:transform') || new Transform();
        return t.get(prop);
      },

      set: function(elem, value) {
        var $elem = $(elem)
        var t = $elem.css('transit:transform') || new Transform();
        t.setFromString(prop, value);
        $elem.css("transit:transform", t)
      }
    };
  }

  // ### uncamel(str)
  // Converts a camelcase string to a dasherized string.
  // (`marginLeft` => `margin-left`)
  function uncamel(str) {
    return str.replace(/([A-Z])/g, function(letter) { return '-' + letter.toLowerCase(); });
  }

  // ### unit(number, unit)
  // Ensures that number `number` has a unit. If no unit is found, assume the
  // default is `unit`.
  //
  //     unit(2, 'px')          //=> "2px"
  //     unit("30deg", 'rad')   //=> "30deg"
  //
  function unit(i, units) {
    if ((typeof i === "string") && (!i.match(/^[\-0-9\.]+$/))) {
      return i;
    } else {
      return "" + i + units;
    }
  }

  // ### toMS(duration)
  // Converts given `duration` to a millisecond string.
  //
  //     toMS('fast')   //=> '400ms'
  //     toMS(10)       //=> '10ms'
  //
  function toMS(duration) {
    var i = duration;

    // Allow for string durations like 'fast'.
    if ($.fx.speeds[i]) { i = $.fx.speeds[i]; }

    return unit(i, 'ms');
  }

  // Export some functions for testable-ness.
  $.transit.getTransitionValue = getTransition;
})(jQuery);


/* /js/libs/jquery.ba-bbq.min.js
 * compresion time: 0.02313 -(ms)
 * ----------------------------- */
/*
 * jQuery BBQ: Back Button & Query Library - v1.2.1 - 2/17/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($,p){var i,m=Array.prototype.slice,r=decodeURIComponent,a=$.param,c,l,v,b=$.bbq=$.bbq||{},q,u,j,e=$.event.special,d="hashchange",A="querystring",D="fragment",y="elemUrlAttr",g="location",k="href",t="src",x=/^.*\?|#.*$/g,w=/^.*\#/,h,C={};function E(F){return typeof F==="string"}function B(G){var F=m.call(arguments,1);return function(){return G.apply(this,F.concat(m.call(arguments)))}}function n(F){return F.replace(/^[^#]*#?(.*)$/,"$1")}function o(F){return F.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function f(H,M,F,I,G){var O,L,K,N,J;if(I!==i){K=F.match(H?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);J=K[3]||"";if(G===2&&E(I)){L=I.replace(H?w:x,"")}else{N=l(K[2]);I=E(I)?l[H?D:A](I):I;L=G===2?I:G===1?$.extend({},I,N):$.extend({},N,I);L=a(L);if(H){L=L.replace(h,r)}}O=K[1]+(H?"#":L||!K[1]?"?":"")+L+J}else{O=M(F!==i?F:p[g][k])}return O}a[A]=B(f,0,o);a[D]=c=B(f,1,n);c.noEscape=function(G){G=G||"";var F=$.map(G.split(""),encodeURIComponent);h=new RegExp(F.join("|"),"g")};c.noEscape(",/");$.deparam=l=function(I,F){var H={},G={"true":!0,"false":!1,"null":null};$.each(I.replace(/\+/g," ").split("&"),function(L,Q){var K=Q.split("="),P=r(K[0]),J,O=H,M=0,R=P.split("]["),N=R.length-1;if(/\[/.test(R[0])&&/\]$/.test(R[N])){R[N]=R[N].replace(/\]$/,"");R=R.shift().split("[").concat(R);N=R.length-1}else{N=0}if(K.length===2){J=r(K[1]);if(F){J=J&&!isNaN(J)?+J:J==="undefined"?i:G[J]!==i?G[J]:J}if(N){for(;M<=N;M++){P=R[M]===""?O.length:R[M];O=O[P]=M<N?O[P]||(R[M+1]&&isNaN(R[M+1])?{}:[]):J}}else{if($.isArray(H[P])){H[P].push(J)}else{if(H[P]!==i){H[P]=[H[P],J]}else{H[P]=J}}}}else{if(P){H[P]=F?i:""}}});return H};function z(H,F,G){if(F===i||typeof F==="boolean"){G=F;F=a[H?D:A]()}else{F=E(F)?F.replace(H?w:x,""):F}return l(F,G)}l[A]=B(z,0);l[D]=v=B(z,1);$[y]||($[y]=function(F){return $.extend(C,F)})({a:k,base:k,iframe:t,img:t,input:t,form:"action",link:k,script:t});j=$[y];function s(I,G,H,F){if(!E(H)&&typeof H!=="object"){F=H;H=G;G=i}return this.each(function(){var L=$(this),J=G||j()[(this.nodeName||"").toLowerCase()]||"",K=J&&L.attr(J)||"";L.attr(J,a[I](K,H,F))})}$.fn[A]=B(s,A);$.fn[D]=B(s,D);b.pushState=q=function(I,F){if(E(I)&&/^#/.test(I)&&F===i){F=2}var H=I!==i,G=c(p[g][k],H?I:{},H?F:2);p[g][k]=G+(/#/.test(G)?"":"#")};b.getState=u=function(F,G){return F===i||typeof F==="boolean"?v(F):v(G)[F]};b.removeState=function(F){var G={};if(F!==i){G=u();$.each($.isArray(F)?F:arguments,function(I,H){delete G[H]})}q(G,2)};e[d]=$.extend(e[d],{add:function(F){var H;function G(J){var I=J[D]=c();J.getState=function(K,L){return K===i||typeof K==="boolean"?l(I,K):l(I,L)[K]};H.apply(this,arguments)}if($.isFunction(F)){H=F;return G}else{H=F.handler;F.handler=G}}})})(jQuery,this);
/*
 * jQuery hashchange event - v1.2 - 2/11/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($,i,b){var j,k=$.event.special,c="location",d="hashchange",l="href",f=$.browser,g=document.documentMode,h=f.msie&&(g===b||g<8),e="on"+d in i&&!h;function a(m){m=m||i[c][l];return m.replace(/^[^#]*#?(.*)$/,"$1")}$[d+"Delay"]=100;k[d]=$.extend(k[d],{setup:function(){if(e){return false}$(j.start)},teardown:function(){if(e){return false}$(j.stop)}});j=(function(){var m={},r,n,o,q;function p(){o=q=function(s){return s};if(h){n=$('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;q=function(){return a(n.document[c][l])};o=function(u,s){if(u!==s){var t=n.document;t.open().close();t[c].hash="#"+u}};o(a())}}m.start=function(){if(r){return}var t=a();o||p();(function s(){var v=a(),u=q(t);if(v!==t){o(t=v,u);$(i).trigger(d)}else{if(u!==t){i[c][l]=i[c][l].replace(/#.*/,"")+"#"+u}}r=setTimeout(s,$[d+"Delay"])})()};m.stop=function(){if(!n){r&&clearTimeout(r);r=0}};return m})()})(jQuery,this);


/* /js/libs/jquery.scrollTo.min.js
 * compresion time: 0.02193 -(ms)
 * ------------------------------- */
/**
 * Copyright (c) 2007-2015 Ariel Flesler - aflesler  gmail  com | http://flesler.blogspot.com
 * Licensed under MIT
 * @author Ariel Flesler
 * @version 2.1.3
 */
;(function(f){"use strict";"function"===typeof define&&define.amd?define(["jquery"],f):"undefined"!==typeof module&&module.exports?module.exports=f(require("jquery")):f(jQuery)})(function($){"use strict";function n(a){return!a.nodeName||-1!==$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"])}function h(a){return $.isFunction(a)||$.isPlainObject(a)?a:{top:a,left:a}}var p=$.scrollTo=function(a,d,b){return $(window).scrollTo(a,d,b)};p.defaults={axis:"xy",duration:0,limit:!0};$.fn.scrollTo=function(a,d,b){"object"=== typeof d&&(b=d,d=0);"function"===typeof b&&(b={onAfter:b});"max"===a&&(a=9E9);b=$.extend({},p.defaults,b);d=d||b.duration;var u=b.queue&&1<b.axis.length;u&&(d/=2);b.offset=h(b.offset);b.over=h(b.over);return this.each(function(){function k(a){var k=$.extend({},b,{queue:!0,duration:d,complete:a&&function(){a.call(q,e,b)}});r.animate(f,k)}if(null!==a){var l=n(this),q=l?this.contentWindow||window:this,r=$(q),e=a,f={},t;switch(typeof e){case "number":case "string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(e)){e= h(e);break}e=l?$(e):$(e,q);case "object":if(e.length===0)return;if(e.is||e.style)t=(e=$(e)).offset()}var v=$.isFunction(b.offset)&&b.offset(q,e)||b.offset;$.each(b.axis.split(""),function(a,c){var d="x"===c?"Left":"Top",m=d.toLowerCase(),g="scroll"+d,h=r[g](),n=p.max(q,c);t?(f[g]=t[m]+(l?0:h-r.offset()[m]),b.margin&&(f[g]-=parseInt(e.css("margin"+d),10)||0,f[g]-=parseInt(e.css("border"+d+"Width"),10)||0),f[g]+=v[m]||0,b.over[m]&&(f[g]+=e["x"===c?"width":"height"]()*b.over[m])):(d=e[m],f[g]=d.slice&& "%"===d.slice(-1)?parseFloat(d)/100*n:d);b.limit&&/^\d+$/.test(f[g])&&(f[g]=0>=f[g]?0:Math.min(f[g],n));!a&&1<b.axis.length&&(h===f[g]?f={}:u&&(k(b.onAfterFirst),f={}))});k(b.onAfter)}})};p.max=function(a,d){var b="x"===d?"Width":"Height",h="scroll"+b;if(!n(a))return a[h]-$(a)[b.toLowerCase()]();var b="client"+b,k=a.ownerDocument||a.document,l=k.documentElement,k=k.body;return Math.max(l[h],k[h])-Math.min(l[b],k[b])};$.Tween.propHooks.scrollLeft=$.Tween.propHooks.scrollTop={get:function(a){return $(a.elem)[a.prop]()}, set:function(a){var d=this.get(a);if(a.options.interrupt&&a._last&&a._last!==d)return $(a.elem).stop();var b=Math.round(a.now);d!==b&&($(a.elem)[a.prop](b),a._last=this.get(a))}};return p});


/* /js/libs/jquery.events.longpress.js
 * compresion time: 0.02217 -(ms)
 * ----------------------------------- */
(function(){
	var eventName = 'longpress';
	var defaults = {
		'duration'	: 2000
	}

	function reset( element, guid ){
		var _data = $(element).data(eventName + '.data');
		if( _data ){
			var handleObj = _data.handleObjects[guid];
			handleObj.clickPrevented = false;
			handleObj.mouseupPrevented = false;
			clearTimeout( handleObj.timeoutHandle  );
		}
	}

	jQuery.event.special[eventName] = {
		setup: function (data, namespaces, eventHandle) {
			// Do something when the first event handler is bound to a particular element.
			// Do something each time an event handler is bound to a particular element.
			var _data = {
				'handleObjects': {}
			};
			$(this).data(eventName + '.data', _data);
		},

		teardown: function (namespaces) {
			$(this).removeData(eventName + '.data');
		},

		add: function (handleObj) {
			var _data = $(this).data(eventName + '.data')
				, guid = handleObj.guid
				, eventData = $.extend({}, handleObj.data )
				, duration = eventData.duration || defaults.duration;

			_data.handleObjects[guid] = handleObj;

			var mousedown = function(){
				reset( this, guid );
				handleObj.timeoutHandle = setTimeout( function(){
					var event = $.Event('longpress');
					event.preventClick = function(){
						handleObj.clickPrevented = true;
					}
					event.preventMouseup = function(){
						handleObj.mouseupPrevented = true;
					}
					handleObj.handler.call( this, event, handleObj.data );
				}.bind( this ), duration );
			}.bind( this );

			var mouseup = function( event ){
				if( handleObj.mouseupPrevented ){
					event.stopImmediatePropagation();
					event.preventDefault();
				}
				setTimeout( function(){
					reset( this, guid );
				}.bind(this),0);
			}.bind( this );

			var click = function( event ){
				if( handleObj.clickPrevented ){
					event.stopImmediatePropagation();
					event.preventDefault();
				}
			}


			handleObj.mousedown		= mousedown;
			handleObj.mouseup		= mouseup;
			handleObj.click			= click;

			$(this).on('mousedown', mousedown);
			$(this).on('mouseup', mouseup);
			$(this).on('click', click);
		},

		remove: function( handleObj ) {
			var _data = $(this).data(eventName + '.data')
			var guid = handleObj.guid;
			var handleObj = _data.handleObjects[guid];
			if( handleObj ){
				reset( this, guid );
				$(this).off('mousedown', handleObj.mousedown );
				$(this).off('mouseup', handleObj.mouseup );
				$(this).off('click', handleObj.click );
			}
			delete _data.handleObjects[guid];
		},

		_default: function( event ) {
			// The default action for the event. This callback will be triggered unless event.preventDefault() is called.
		}
	}
}());


/* /js/libs/date.min.js
 * compresion time: 0.02599 -(ms)
 * -------------------- */
/**
 * Version: 1.0 Alpha-1 
 * Build Date: 13-Nov-2007
 * Copyright (c) 2006-2007, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * License: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/. 
 * Website: http://www.datejs.com/ or http://www.coolite.com/datejs/
 */
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('X.3z={1f:"9k-95",94:"5m (4K 4W)",8v:"5m (4K 4W)",3X:["8p","8m","8h","8g","8f","8d","87"],3N:["81","7V","7R","7G","7g","74","6F"],6y:["6P","6Q","6S","7m","7n","7B","7F"],7P:["S","M","T","W","T","F","S"],3K:["7Z","80","86","88","6k","8a","8b","8e","8i","8j","8k","8l"],3W:["8n","8o","8q","8r","6k","8s","8t","8H","8K","8L","8M","8O"],49:"8R",4d:"8U",5I:0,5u:93,4Z:"4n",5G:{4N:"M/d/1h",6C:"37, 2G 1H, 1h",6w:"h:1m 1U",6r:"h:1m:1N 1U",5O:"37, 2G 1H, 1h h:1m:1N 1U",6a:"1h-1x-2n:1m:1N",6x:"1h-1x-1H 2t:1m:4w",66:"1V, 1H 2z 1h 2t:1m:1N 5r",5V:"2G 1H",5Y:"2G, 1h"},4v:{3j:/^3j(9O)?/i,3w:/^3w(9M)?/i,3x:/^3x(9A)?/i,3G:/^3G(9z)?/i,2U:/^2U/i,3e:/^3e(e)?/i,3m:/^3m(y)?/i,3n:/^3n(9y)?/i,3s:/^3s(t(4t)?)?/i,3y:/^3y(9x)?/i,3A:/^3A(4t)?/i,3E:/^3E(4t)?/i,4r:/^9w(n(O)?)?/i,4z:/^9v(n(O)?)?/i,4C:/^9t(e(s(O)?)?)?/i,4U:/^9q(d(9o)?)?/i,5l:/^39(u(r(s(O)?)?)?)?/i,5T:/^9n(i(O)?)?/i,4o:/^9m(t(9l)?)?/i,65:/^3k/i,3l:/^1E|3l|4m(9j)?/i,2o:/^(\\+|9i(9h)?|9g|9f)/i,4l:/^(\\-|9e(9c)?|4J)/i,4j:/^9b(9a)?/i,1c:/^t(98(5c)?)?/i,4g:/^97(96)?/i,1F:/^n(92)?/i,3C:/^91|90(1r)?s?/i,1r:/^8Y(8X)?s?/i,1s:/^8W|2B(8V)?s?/i,1a:/^h(8T)?s?/i,2i:/^w(8S)?s?/i,K:/^m(8Q)?s?/i,O:/^d(5c)?s?/i,16:/^y(8P)?s?/i,6u:/^(a|p)/i,6A:/^(a\\.?m?\\.?|p\\.?m?\\.?)/i,1y:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((4x)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|4x|8J)/i,47:/^\\s*(46|44|43|39)/i,4H:/^\\s*(\\:|a(?!u|p)|p)/i},42:[{1f:"8I",1k:"-41"},{1f:"5r",1k:"-41"},{1f:"8G",1k:"-4P"},{1f:"8F",1k:"-8D"},{1f:"8C",1k:"-4V"},{1f:"8A",1k:"-4P"},{1f:"8z",1k:"-4Y"},{1f:"8y",1k:"-4V"},{1f:"8x",1k:"-8w"},{1f:"8u",1k:"-4Y"}]};(B(){I $D=X,$P=$D.2F,$C=$D.3z,p=B(s,l){G(!l){l=2}A("41"+s).2D(l*-1)};$P.2S=B(){8.5A(0);8.5B(0);8.5F(0);8.3R(0);A 8};$P.5H=B(){I n=Y X();8.5A(n.3P());8.5B(n.34());8.5F(n.3b());8.3R(n.3O());A 8};$D.1c=B(){A Y X().2S()};$D.5Z=B(1Z,20){G(63(1Z)||63(20)){1n Y 8c(1Z+" - "+20);}1d G(1Z 1G X&&20 1G X){A(1Z<20)?-1:(1Z>20)?1:0}1d{1n Y 68(1Z+" - "+20);}};$D.3h=B(1Z,20){A(1Z.3i(20)===0)};$D.6h=B(1f){I n=$C.3X,m=$C.3N,o=$C.6y,s=1f.1w();1b(I i=0;i<n.Q;i++){G(n[i].1w()==s||m[i].1w()==s||o[i].1w()==s){A i}}A-1};$D.85=B(1f){I n=$C.3K,m=$C.3W,s=1f.1w();1b(I i=0;i<n.Q;i++){G(n[i].1w()==s||m[i].1w()==s){A i}}A-1};$D.6s=B(16){A((16%4===0&&16%2V!==0)||16%2W===0)};$D.33=B(16,K){A[31,($D.6s(16)?29:28),31,30,31,30,31,31,30,31,30,31][K]};$D.4y=B(1k){I z=$C.42,p;1b(I i=0;i<z.Q;i++){G(z[i].1k===1k){A z[i].1f}}A J};$D.2g=B(1f){I z=$C.42,p;1b(I i=0;i<z.Q;i++){G(z[i].1f===1f.2R()){A z[i].1k}}A J};$P.2q=B(){A Y X(8.2T())};$P.3i=B(1g){A X.5Z(8,1g)};$P.3h=B(1g){A X.3h(8,1g||Y X())};$P.4G=B(3v,4I){A 8.2T()>=3v.2T()&&8.2T()<=4I.2T()};$P.7Y=B(1g){A 8.3i(1g||Y X())===1};$P.7X=B(1g){A(8.3i(1g||Y X())===-1)};$P.7W=B(){A 8.4M(Y X())};$P.4M=B(1g){A 8.2q().2S().3h(1g.2q().2S())};$P.2N=B(L){8.3R(8.3O()+L);A 8};$P.2X=B(L){A 8.2N(L*7U)};$P.3B=B(L){A 8.2N(L*7T)};$P.3J=B(L){A 8.2N(L*7S)};$P.2s=B(L){8.3I(8.1Q()+L);A 8};$P.3F=B(L){A 8.2s(L*7)};$P.2Y=B(L){I n=8.1Q();8.3I(1);8.7Q(8.1i()+L);8.3I(52.2B(n,$D.33(8.1O(),8.1i())));A 8};$P.3L=B(L){A 8.2Y(L*12)};$P.2o=B(19){G(2Q 19=="5b"){8.1Y=19;A 8}I x=19;G(x.5e){8.2N(x.5e)}G(x.5f){8.2X(x.5f)}G(x.5g){8.3B(x.5g)}G(x.5h){8.3J(x.5h)}G(x.5i){8.3F(x.5i)}G(x.3Q){8.2Y(x.3Q)}G(x.5k){8.3L(x.5k)}G(x.1u){8.2s(x.1u)}A 8};I $y,$m,$d;$P.3S=B(){I a,b,c,d,e,f,g,n,s,w;$y=(!$y)?8.1O():$y;$m=(!$m)?8.1i()+1:$m;$d=(!$d)?8.1Q():$d;G($m<=2){a=$y-1;b=(a/4|0)-(a/2V|0)+(a/2W|0);c=((a-1)/4|0)-((a-1)/2V|0)+((a-1)/2W|0);s=b-c;e=0;f=$d-1+(31*($m-1))}1d{a=$y;b=(a/4|0)-(a/2V|0)+(a/2W|0);c=((a-1)/4|0)-((a-1)/2V|0)+((a-1)/2W|0);s=b-c;e=s+1;f=$d+((7E*($m-3)+2)/5)+58+s}g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;G(n<0){w=53-((g-s)/5|0)}1d G(n>7v+s){w=1}1d{w=(n/7|0)+1}$y=$m=$d=J;A w};$P.7p=B(){$y=8.5w();$m=8.5x()+1;$d=8.5y();A p(8.3S())};$P.3Z=B(n){A 8.2O(1).3F(n-8.3S())};$D.27=B(n,2B,5C,1f){G(2Q n=="5D"){A 1t}1d G(2Q n!="5b"){1n Y 68(n+" 2I 2r a 1S.");}1d G(n<2B||n>5C){1n Y 45(n+" 2I 2r a 5J L 1b "+1f+".");}A 1K};$D.5L=B(L){A $D.27(L,0,7i,"3C")};$D.5N=B(L){A $D.27(L,0,59,"1r")};$D.5P=B(L){A $D.27(L,0,59,"1s")};$D.5Q=B(L){A $D.27(L,0,23,"1a")};$D.5R=B(L,16,K){A $D.27(L,1,$D.33(16,K),"O")};$D.5S=B(L){A $D.27(L,0,11,"K")};$D.5U=B(L){A $D.27(L,0,6W,"16")};$P.1j=B(19){G($D.5L(19.3C)){8.2N(19.3C-8.3O())}G($D.5N(19.1r)){8.2X(19.1r-8.3b())}G($D.5P(19.1s)){8.3B(19.1s-8.34())}G($D.5Q(19.1a)){8.3J(19.1a-8.3P())}G($D.5S(19.K)){8.2Y(19.K-8.1i())}G($D.5U(19.16)){8.3L(19.16-8.1O())}G($D.5R(19.O,8.1O(),8.1i())){8.2s(19.O-8.1Q())}G(19.1y){8.5X(19.1y)}G(19.2J){8.4a(19.2J)}G(19.2i&&$D.27(19.2i,0,53,"2i")){8.3Z(19.2i)}A 8};$P.60=B(){A 8.1j({O:1})};$P.4b=B(){A 8.1j({O:$D.33(8.1O(),8.1i())})};$P.4c=B(1B,3a){I 25=0;G(3a>0){25=3a-1}1d G(3a===-1){8.4b();G(8.2b()!==1B){8.2O(1B,-1)}A 8}A 8.60().2s(-1).2O(1B,+1).3F(25)};$P.2O=B(1B,1l){I 2k=(1B-8.2b()+7*(1l||+1))%7;A 8.2s((2k===0)?2k+=7*(1l||+1):2k)};$P.69=B(K,1l){I 2k=(K-8.1i()+12*(1l||+1))%12;A 8.2Y((2k===0)?2k+=12*(1l||+1):2k)};$P.6O=B(){A 52.6N((8.2q().2S()-Y X(8.1O(),0,1))/6M)+1};$P.6L=B(){A $D.4y(8.6e())};$P.4a=B(1k){I 6f=8.2g(),6g=1S(1k)*-6/10;A 8.3B(6g-6f)};$P.5X=B(1k){A 8.4a($D.2g(1k))};$P.6j=B(){A(X.1c().1j({K:0,O:1}).2g()!==X.1c().1j({K:6,O:1}).2g())};$P.6K=B(){A(8.6j()&&Y X().2g()===X.1c().1j({K:6,O:1}).2g())};$P.6e=B(){I n=8.2g()*-10/6,r;G(n<0){r=(n-6l).2M();A r.6n(0)+r.6o(2)}1d{r=(n+6l).2M();A"+"+r.6o(1)}};$P.6J=B(1g){A(1g||Y X())-8};G(!$P.6q){$P.6q=B(){B f(n){A n<10?\'0\'+n:n}A\'"\'+8.5w()+\'-\'+f(8.5x()+1)+\'-\'+f(8.5y())+\'T\'+f(8.6I())+\':\'+f(8.6H())+\':\'+f(8.6G())+\'Z"\'}}$P.6v=$P.2M;$P.2M=B(2c){I x=8;G(2c&&2c.Q==1){I c=$C.5G;x.t=x.2M;3o(2c){R"d":A x.t(c.4N);R"D":A x.t(c.6C);R"F":A x.t(c.5O);R"m":A x.t(c.5V);R"r":A x.t(c.66);R"s":A x.t(c.6a);R"t":A x.t(c.6w);R"T":A x.t(c.6r);R"u":A x.t(c.6x);R"y":A x.t(c.5Y)}}I 6z=B(n){3o(n*1){R 1:R 21:R 31:A"46";R 2:R 22:A"44";R 3:R 23:A"43";6B:A"39"}};A 2c?2c.2u(/(\\\\)?(1H?d?d?|1x?M?M?|2P?y?y?|3c?|2t?|1m?|1N?|1U?|S)/g,B(m){G(m.6n(0)==="\\\\"){A m.2u("\\\\","")}x.h=x.3P;3o(m){R"3c":A p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));R"h":A x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);R"2t":A p(x.h());R"H":A x.h();R"1m":A p(x.34());R"m":A x.34();R"1N":A p(x.3b());R"s":A x.3b();R"1h":A p(x.1O(),4);R"2P":A p(x.1O());R"37":A $C.3X[x.2b()];R"1V":A $C.3N[x.2b()];R"1H":A p(x.1Q());R"d":A x.1Q();R"2G":A $C.3K[x.1i()];R"2z":A $C.3W[x.1i()];R"1x":A p((x.1i()+1));R"M":A x.1i()+1;R"t":A x.h()<12?$C.49.1L(0,1):$C.4d.1L(0,1);R"1U":A x.h()<12?$C.49:$C.4d;R"S":A 6z(x.1Q());6B:A m}}):8.6v()}}());(B(){I $D=X,$P=$D.2F,$C=$D.3z,$N=1S.2F;$P.1Y=+1;$P.32=J;$P.1W=1t;$P.2Z=1t;$P.2v=1t;$N.3u="O";$P.3k=B(){8.1Y=+1;A 8};$D.3k=B(){A $D.1c().3k()};$P.1E=$P.4m=$P.6c=B(){8.1Y=-1;A 8};$D.1E=$D.4m=$D.6c=B(){A $D.1c().1E()};$P.2I=B(){8.1W=1K;A 8};$P.6b=B(){8.2Z=1K;8.2v=1t;A 8};$P.1c=B(){A 8.6b().O()};$P.2m=B(){G(8.1W){8.1W=1t;A(!8.2I().4o()&&!8.2I().4r())}A 1t};$P.4h=B(2K){A(2Q 2K==="6R")?$D.3H(8.2M("d")+" "+2K):8.1j(2K)};$N.6T=$N.6U=B(1g){I c={};c[8.3u]=8;A((!1g)?Y X():1g.2q()).2o(c)};$N.4J=$N.6V=B(1g){I c={};c[8.3u]=8*-1;A((!1g)?Y X():1g.2q()).2o(c)};I 2e=("6X 6Y 6Z 70 71 72 73").2f(/\\s/),1C=("75 76 77 78 2U 79 7a 7b 7c 7d 7e 7f").2f(/\\s/),V=("7h 5M 7j 7k 7l 5K 5E 7o").2f(/\\s/),5v=("7q 7r 7s 7t X 5K 5E 7u").2f(/\\s/),3Y=("7w 7x 1r 7y 7z 7A").2f(/\\s/),2w;$P.3V=B(){I o={};1b(I i=0;i<V.Q;i++){o[V[i].1w()]=8["7C"+5v[i]]()}A o};$D.7D=B(19){19.2i=J;A X.1c().1j(19)};I 5q=B(n){A B(){G(8.1W){8.1W=1t;A 8.2b()==n}G(8.32!==J){G(8.2v){8.2X(8.1Y*-1)}8.2v=1t;I 3U=8.32;8.32=J;I 1D=8.2q().4b();8.4c(n,3U);G(8>1D){1n Y 45($D.7H(n)+" 7I 2r 7J "+3U+" 7K 7L 7M K 7N "+$D.7O(1D.1i())+" "+1D.1O()+".");}A 8}A 8.2O(n,8.1Y)}};I 5o=B(n){A B(){I t=$D.1c(),25=n-t.2b();G(n===0&&$C.5I===1&&t.2b()!==0){25=25+7}A t.2s(25)}};1b(I i=0;i<2e.Q;i++){$D[2e[i].2R()]=$D[2e[i].2R().1L(0,3)]=i;$D[2e[i]]=$D[2e[i].1L(0,3)]=5o(i);$P[2e[i]]=$P[2e[i].1L(0,3)]=5q(i)}I 56=B(n){A B(){G(8.1W){8.1W=1t;A 8.1i()===n}A 8.69(n,8.1Y)}};I 51=B(n){A B(){A $D.1c().1j({K:n,O:1})}};1b(I j=0;j<1C.Q;j++){$D[1C[j].2R()]=$D[1C[j].2R().1L(0,3)]=j;$D[1C[j]]=$D[1C[j].1L(0,3)]=51(j);$P[1C[j]]=$P[1C[j].1L(0,3)]=56(j)}I 48=B(j){A B(){G(8.2v){8.2v=1t;A 8}G(8.2Z){8.2Z=8.1W=1t;I 4S=8.3V(),4Q=(1o[0]||Y X()).3V(),v="",k=j.1w();1b(I m=(V.Q-1);m>-1;m--){v=V[m].1w();G(4S[v]!=4Q[v]){A 1t}G(k==v){26}}A 1K}G(j.1L(j.Q-1)!="s"){j+="s"}A 8["2o"+j](8.1Y)}};I 4F=B(n){A B(){8.3u=n;A 8}};1b(I k=0;k<V.Q;k++){2w=V[k].1w();$P[2w]=$P[2w+"s"]=48(V[k]);$N[2w]=$N[2w+"s"]=4F(2w)}$P.4A=48("5M");I 3M=B(n){A B(1B){G(8.2Z){A 8.4A(1o[0])}G(1B||1B===0){A 8.4c(1B,n)}8.32=n;G(n===2&&(1B===5D||1B===J)){8.2v=1K;A 8.2X(8.1Y)}A 8}};1b(I l=0;l<3Y.Q;l++){$P[3Y[l]]=(l===0)?3M(-1):3M(l)}}());(B(){X.3p={1z:B(s){8.82="83 84 4h \'"+s.1L(0,10)+" ...\'"}};I $P=X.3p;I E=$P.6p={15:B(r){A B(s){I 1C=s.6m(r);G(1C){A([1C[0],s.1L(1C[0].Q)])}1d{1n Y $P.1z(s);}}},89:B(s){A B(s){A E.15(Y 67("^\\s*"+s+"\\s*"))(s)}},3g:B(s){A E.15(Y 67("^"+s))},6E:B(p){A B(s){I 2h=[],U=J;64(s.Q){1q{U=p.17(8,s)}1p(e){2h.1R(U[0]);s=U[1];36}26}A[2h,s]}},3T:B(p){A B(s){I U=[],r=J;64(s.Q){1q{r=p.17(8,s)}1p(e){A[U,s]}U.1R(r[0]);s=r[1]}A[U,s]}},2E:B(p){A B(s){I r=J;1q{r=p.17(8,s)}1p(e){A[J,s]}A[r[0],r[1]]}},2r:B(p){A B(s){1q{p.17(8,s)}1p(e){A[J,s]}1n Y $P.1z(s);}},1J:B(p){A p?B(s){I r=J;r=p.17(8,s);A[J,r[1]]}:J},5n:B(){I V=1o[0],2h=1X.2F.2D.17(1o,1),U=[];1b(I i=0;i<V.Q;i++){U.1R(E.1v(V[i],2h))}A U},18:B(2l){I 18={},r=J;A B(s){1q{r=18[s]=(18[s]||2l.17(8,s))}1p(e){r=18[s]=e}G(r 1G $P.1z){1n r;}1d{A r}}},2H:B(){I V=1o;A B(s){I r=J;1b(I i=0;i<V.Q;i++){G(V[i]==J){36}1q{r=(V[i].17(8,s))}1p(e){r=J}G(r){A r}}1n Y $P.1z(s);}},1v:B(){I V=1o;A B(s){I U=[],r=J;1b(I i=0;i<V.Q;i++){G(V[i]==J){36}1q{r=(V[i].17(8,s))}1p(e){1n Y $P.1z(s);}U.1R(r[0]);s=r[1]}A[U,s]}},57:B(){I V=1o,E=E;A E.1v(E.2E(V))},55:B(V,d,c){d=d||E.15(/^\\s*/);c=c||J;G(V.Q==1){A V[0]}A B(s){I r=J,q=J;I U=[];1b(I i=0;i<V.Q;i++){1q{r=V[i].17(8,s)}1p(e){26}U.1R(r[0]);1q{q=d.17(8,r[1])}1p(54){q=J;26}s=q[1]}G(!r){1n Y $P.1z(s);}G(q){1n Y $P.1z(q[1]);}G(c){1q{r=c.17(8,r[1])}1p(50){1n Y $P.1z(r[1]);}}A[U,(r?r[1]:s)]}},4G:B(40,p,3t){3t=3t||40;I 1I=E.1v(E.1J(40),p,E.1J(3t));A B(s){I U=1I.17(8,s);A[[U[0][0],r[0][2]],U[1]]}},8B:B(p,d,c){d=d||E.15(/^\\s*/);c=c||J;A(p 1G 1X?E.1v(E.5n(p.2D(0,-1),E.1J(d)),p.2D(-1),E.1J(c)):E.1v(E.3T(E.1v(p,E.1J(d))),V,E.1J(c)))},1j:B(V,d,c){d=d||E.15(/^\\s*/);c=c||J;A B(s){I r=J,p=J,q=J,U=J,1P=[[],s],1E=1t;1b(I i=0;i<V.Q;i++){q=J;p=J;r=J;1E=(V.Q==1);1q{r=V[i].17(8,s)}1p(e){36}U=[[r[0]],r[1]];G(r[1].Q>0&&!1E){1q{q=d.17(8,r[1])}1p(54){1E=1K}}1d{1E=1K}G(!1E&&q[1].Q===0){1E=1K}G(!1E){I 2h=[];1b(I j=0;j<V.Q;j++){G(i!=j){2h.1R(V[j])}}p=E.1j(2h,d).17(8,q[1]);G(p[0].Q>0){U[0]=U[0].4T(p[0]);U[1]=p[1]}}G(U[1].Q<1P[1].Q){1P=U}G(1P[1].Q===0){26}}G(1P[0].Q===0){A 1P}G(c){1q{q=c.17(8,1P[1])}1p(50){1n Y $P.1z(1P[1]);}1P[1]=q[1]}A 1P}},8E:B(4R,4O){A B(s){A 4R[4O].17(8,s)}},2u:B(2l,4L){A B(s){I r=2l.17(8,s);A[4L,r[1]]}},14:B(2l,2d){A B(s){I r=2l.17(8,s);A[2d.17(8,r[0]),r[1]]}},2B:B(2B,2l){A B(s){I U=2l.17(8,s);G(U[0].Q<2B){1n Y $P.1z(s);}A U}}};I 6D=B(2C){A B(){I 2j=J,U=[];G(1o.Q>1){2j=1X.2F.2D.17(1o)}1d G(1o[0]1G 1X){2j=1o[0]}G(2j){1b(I i=0,V=2j.25();i<V.Q;i++){2j.8N(V[i]);U.1R(2C.2p(J,2j));2j.25();A U}}1d{A 2C.2p(J,1o)}}};I 3f="2E 2r 1J 18".2f(/\\s/);1b(I i=0;i<3f.Q;i++){E[3f[i]]=6D(E[3f[i]])}I 6i=B(2C){A B(){G(1o[0]1G 1X){A 2C.2p(J,1o[0])}1d{A 2C.2p(J,1o)}}};I 3d="1v 2H 57".2f(/\\s/);1b(I j=0;j<3d.Q;j++){E[3d[j]]=6i(E[3d[j]])}}());(B(){I $D=X,$P=$D.2F,$C=$D.3z;I 4e=B(2L){I U=[];1b(I i=0;i<2L.Q;i++){G(2L[i]1G 1X){U=U.4T(4e(2L[i]))}1d{G(2L[i]){U.1R(2L[i])}}}A U};$D.35={};$D.5W={1a:B(s){A B(){8.1a=1S(s)}},1s:B(s){A B(){8.1s=1S(s)}},1r:B(s){A B(){8.1r=1S(s)}},1T:B(s){A B(){8.1T=s.2D(0,1).1w()}},1y:B(s){A B(){I n=s.2u(/[^\\d\\+\\-]/g,"");G(n.Q){8.2J=1S(n)}1d{8.1y=s.1w()}}},O:B(x){I s=x[0];A B(){8.O=1S(s.6m(/\\d+/)[0])}},K:B(s){A B(){8.K=(s.Q==3)?"3j 3w 3x 3G 2U 3e 3m 3n 3s 3y 3A 3E".4f(s)/4:1S(s)-1}},16:B(s){A B(){I n=1S(s);8.16=((s.Q>2)?n:(n+(((n+5z)<$C.5u)?5z:8Z)))}},3D:B(s){A B(){3o(s){R"4j":8.1u=-1;26;R"4g":8.1u=1;26;R"1c":8.1u=0;26;R"1F":8.1u=0;8.1F=1K;26}}},5s:B(x){x=(x 1G 1X)?x:[x];1b(I i=0;i<x.Q;i++){G(x[i]){x[i].17(8)}}I 1F=Y X();G((8.1a||8.1s)&&(!8.K&&!8.16&&!8.O)){8.O=1F.1Q()}G(!8.16){8.16=1F.1O()}G(!8.K&&8.K!==0){8.K=1F.1i()}G(!8.O){8.O=1}G(!8.1a){8.1a=0}G(!8.1s){8.1s=0}G(!8.1r){8.1r=0}G(8.1T&&8.1a){G(8.1T=="p"&&8.1a<12){8.1a=8.1a+12}1d G(8.1T=="a"&&8.1a==12){8.1a=0}}G(8.O>$D.33(8.16,8.K)){1n Y 45(8.O+" 2I 2r a 5J L 1b 1u.");}I r=Y X(8.16,8.K,8.O,8.1a,8.1s,8.1r);G(8.1y){r.1j({1y:8.1y})}1d G(8.2J){r.1j({2J:8.2J})}A r},5p:B(x){x=(x 1G 1X)?4e(x):[x];G(x.Q===0){A J}1b(I i=0;i<x.Q;i++){G(2Q x[i]=="B"){x[i].17(8)}}I 1c=$D.1c();G(8.1F&&!8.1e&&!8.1A){A Y X()}1d G(8.1F){1c=Y X()}I 1M=!!(8.1u&&8.1u!==J||8.1l||8.1A);I 2x,24,1l;1l=((8.1l=="3l"||8.1A=="4l")?-1:1);G(!8.1F&&"1a 1s 1r".4f(8.1e)!=-1){1c.5H()}G(8.K||8.K===0){G("16 O 1a 1s 1r".4f(8.1e)!=-1){8.L=8.K+1;8.K=J;1M=1K}}G(!1M&&8.2m&&!8.O&&!8.1u){I 1D=X[8.2m]();8.O=1D.1Q();G(!8.K){8.K=1D.1i()}8.16=1D.1O()}G(1M&&8.2m&&8.1e!="K"){8.1e="O";2x=($D.6h(8.2m)-1c.2b());24=7;8.1u=2x?((2x+(1l*24))%24):(1l*24)}G(8.K&&8.1e=="O"&&8.1A){8.L=(8.K+1);8.K=J}G(8.L!=J&&8.K!=J&&8.16!=J){8.O=8.L*1}G(8.K&&!8.O&&8.L){1c.1j({O:8.L*1});G(!1M){8.O=8.L*1}}G(!8.K&&8.L&&8.1e=="K"&&!8.1F){8.K=8.L;1M=1K}G(1M&&(8.K||8.K===0)&&8.1e!="16"){8.1e="K";2x=(8.K-1c.1i());24=12;8.3Q=2x?((2x+(1l*24))%24):(1l*24);8.K=J}G(!8.1e){8.1e="O"}G(!8.L&&8.1A&&8.1A!==J&&8[8.1e+"s"]&&8[8.1e+"s"]!==J){8[8.1e+"s"]=8[8.1e+"s"]+((8.1A=="2o")?1:-1)+(8.L||0)*1l}1d G(8[8.1e+"s"]==J||8.1A!=J){G(!8.L){8.L=1}8[8.1e+"s"]=8.L*1l}G(8.1T&&8.1a){G(8.1T=="p"&&8.1a<12){8.1a=8.1a+12}1d G(8.1T=="a"&&8.1a==12){8.1a=0}}G(8.2m&&!8.O&&!8.1u){I 1D=X[8.2m]();8.O=1D.1Q();G(1D.1i()!==1c.1i()){8.K=1D.1i()}}G((8.K||8.K===0)&&!8.O){8.O=1}G(!8.1l&&!8.1A&&8.1e=="2i"&&8.L&&!8.O&&!8.K){A X.1c().3Z(8.L)}G(1M&&8.1y&&8.O&&8.1u){8.O=8.1u}A(1M)?1c.2o(8):1c.1j(8)}};I E=$D.3p.6p,g=$D.35,t=$D.5W,1I;g.5a=E.15(/^([\\s\\-\\.\\,\\/\\99]+)/);g.4X=E.3g(":");g.4i=E.15(/^\\s*/);g.4E=E.15(/^(([\\s\\,]|4h|@|9d)+)/);I 4k={};g.2A=B(3r){I 2d=4k[3r];G(!2d){I c=$C.4v;I 3q=3r.2f(/\\s+/),V=[];1b(I i=0;i<3q.Q;i++){V.1R(E.2u(E.15(c[3q[i]]),3q[i]))}2d=4k[3r]=E.2H.2p(J,V)}A 2d};g.2y=B(6t){A E.15($C.4v[6t])};g.h=E.18(E.14(E.15(/^(0[0-9]|1[0-2]|[1-9])/),t.1a));g.3c=E.18(E.14(E.15(/^(0[0-9]|1[0-2])/),t.1a));g.H=E.18(E.14(E.15(/^([0-1][0-9]|2[0-3]|[0-9])/),t.1a));g.2t=E.18(E.14(E.15(/^([0-1][0-9]|2[0-3])/),t.1a));g.m=E.18(E.14(E.15(/^([0-5][0-9]|[0-9])/),t.1s));g.1m=E.18(E.14(E.15(/^[0-5][0-9]/),t.1s));g.s=E.18(E.14(E.15(/^([0-5][0-9]|[0-9])/),t.1r));g.1N=E.18(E.14(E.15(/^[0-5][0-9]/),t.1r));g.62=E.18(E.55([g.H,g.m,g.s],g.4X));g.t=E.18(E.14(g.2y("6u"),t.1T));g.1U=E.18(E.14(g.2y("6A"),t.1T));g.z=E.18(E.14(E.15(/^((\\+|\\-)\\s*\\d\\d\\d\\d)|((\\+|\\-)\\d\\d\\:?\\d\\d)/),t.1y));g.61=E.18(E.14(E.15(/^((\\+|\\-)\\s*\\d\\d\\d\\d)|((\\+|\\-)\\d\\d\\:?\\d\\d)/),t.1y));g.4p=E.18(E.14(g.2y("1y"),t.1y));g.5j=E.1v(E.1J(g.4i),E.1j([g.1U,g.4p]));g.2K=E.1v(E.2E(E.1J(E.3g("T"))),g.62,g.5j);g.d=E.18(E.14(E.1v(E.15(/^([0-2]\\d|3[0-1]|\\d)/),E.2E(g.2y("47"))),t.O));g.1H=E.18(E.14(E.1v(E.15(/^([0-2]\\d|3[0-1])/),E.2E(g.2y("47"))),t.O));g.1V=g.37=E.18(E.14(g.2A("4r 4z 4C 4U 5l 5T 4o"),B(s){A B(){8.2m=s}}));g.M=E.18(E.14(E.15(/^(1[0-2]|0\\d|\\d)/),t.K));g.1x=E.18(E.14(E.15(/^(1[0-2]|0\\d)/),t.K));g.2z=g.2G=E.18(E.14(g.2A("3j 3w 3x 3G 2U 3e 3m 3n 3s 3y 3A 3E"),t.K));g.y=E.18(E.14(E.15(/^(\\d\\d?)/),t.16));g.2P=E.18(E.14(E.15(/^(\\d\\d)/),t.16));g.9p=E.18(E.14(E.15(/^(\\d\\d?\\d?\\d?)/),t.16));g.1h=E.18(E.14(E.15(/^(\\d\\d\\d\\d)/),t.16));1I=B(){A E.1v(E.2H.2p(J,1o),E.2r(g.2y("4H")))};g.O=1I(g.d,g.1H);g.K=1I(g.M,g.2z);g.16=1I(g.1h,g.2P);g.5d=E.14(g.2A("3l 65"),B(s){A B(){8.1l=s}});g.1A=E.14(g.2A("2o 4l"),B(s){A B(){8.1A=s}});g.3D=E.14(g.2A("4j 4g 1c 1F"),t.3D);g.1e=E.14(g.2A("1r 1s 1a O 2i K 16"),B(s){A B(){8.1e=s}});g.L=E.14(E.15(/^\\d\\d?(46|44|43|39)?/),B(s){A B(){8.L=s.2u(/\\D/g,"")}});g.1M=E.1j([g.3D,g.1A,g.L,g.1e,g.5d,g.1V,g.2z]);1I=B(){A E.1j(1o,g.5a)};g.4n=1I(g.1V,g.K,g.O,g.16);g.9r=1I(g.1V,g.16,g.K,g.O);g.9s=1I(g.1V,g.O,g.K,g.16);g.1g=B(s){A((g[$C.4Z]||g.4n).17(8,s))};g.2c=E.14(E.3T(E.2H(E.14(E.15(/^(1H?d?d?|1x?M?M?|2P?y?y?|3c?|2t?|1m?|1N?|1U?|61?z?)/),B(38){G(g[38]){A g[38]}1d{1n $D.3p.1z(38);}}),E.14(E.15(/^[^9u]+/),B(s){A E.1J(E.3g(s))}))),B(4B){A E.14(E.1v.2p(J,4B),t.5s)});I 4q={};I 4s=B(f){A 4q[f]=(4q[f]||g.2c(f)[0])};g.4u=B(2a){G(2a 1G 1X){I U=[];1b(I i=0;i<2a.Q;i++){U.1R(4s(2a[i]))}A E.2H.2p(J,U)}1d{A 4s(2a)}};g.5t=g.4u(["\\"1h-1x-2n:1m:4w\\"","1h-1x-2n:1m:4w","1h-1x-2n:1m:9B","1h-1x-2n:1m:1N","1h-1x-2n:9C","1h-1x-2n:9D","1h-1x-2n:1m","1V, 2z 1H, 1h H:1m:1N 1U","1V 2z d 1h 2t:1m:1N 4p","9E","9F","9G","9H","9I","9J","1h","9K","9L","d"]);g.4D=E.14(E.1j([g.1g,g.2K,g.1M],g.4E,g.4i),t.5p);g.3v=B(s){1q{I r=g.5t.17({},s);G(r[1].Q===0){A r}}1p(e){}A g.4D.17({},s)};$D.9N=$D.3H;$D.3H=B(s){I r=J;G(!s){A J}G(s 1G X){A s}1q{r=$D.35.3v.17({},s.2u(/^\\s*(\\S*(\\s+\\S+)*)\\s*$/,"$1"))}1p(e){A J}A((r[1].Q===0)?r[0]:J)};$D.6d=B(2a){I 2d=$D.35.4u(2a);A B(s){I r=J;1q{r=2d.17({},s)}1p(e){A J}A((r[1].Q===0)?r[0]:J)}};$D.9P=B(s,2a){A $D.6d(2a)(s)}}());',62,610,'||||||||this||||||||||||||||||||||||||||return|function|||_||if||var|null|month|value|||day||length|case|||rx|px||Date|new||||||process|rtoken|year|call|cache|config|hour|for|today|else|unit|name|date|yyyy|getMonth|set|offset|orient|mm|throw|arguments|catch|try|second|minute|false|days|each|toLowerCase|MM|timezone|Exception|operator|dayOfWeek|mx|temp|last|now|instanceof|dd|_fn|ignore|true|substring|expression|ss|getFullYear|best|getDate|push|Number|meridian|tt|ddd|_is|Array|_orient|date1|date2||||mod|shift|break|_validate|||fx|getDay|format|fn|dx|split|getTimezoneOffset|qx|week|args|diff|rule|weekday|ddTHH|add|apply|clone|not|addDays|HH|replace|_isSecond|de|gap|ctoken2|MMM|ctoken|min|op|slice|optional|prototype|MMMM|any|is|timezoneOffset|time|ax|toString|addMilliseconds|moveToDayOfWeek|yy|typeof|toUpperCase|clearTime|getTime|may|100|400|addSeconds|addMonths|_same|||_nth|getDaysInMonth|getMinutes|Grammar|continue|dddd|fmt|th|occurrence|getSeconds|hh|vx|jun|gx|stoken|equals|compareTo|jan|next|past|jul|aug|switch|Parsing|kx|keys|sep|d2|_dateElement|start|feb|mar|oct|CultureInfo|nov|addMinutes|millisecond|rday|dec|addWeeks|apr|parse|setDate|addHours|monthNames|addYears|nthfn|abbreviatedDayNames|getMilliseconds|getHours|months|setMilliseconds|getWeek|many|ntemp|toObject|abbreviatedMonthNames|dayNames|nth|setWeek|d1|000|timezones|rd|nd|RangeError|st|ordinalSuffix|ef|amDesignator|setTimezoneOffset|moveToLastDayOfMonth|moveToNthOccurrence|pmDesignator|flattenAndCompact|indexOf|tomorrow|at|whiteSpace|yesterday|_C|subtract|prev|mdy|sat|zzz|_F|sun|_get|ember|formats|regexPatterns|ssZ|gmt|getTimezoneAbbreviation|mon|_ss|rules|tue|_start|generalDelimiter|nf|between|timeContext|end|ago|United|repl|isSameDay|shortDate|fname|0500|o2|gr|o1|concat|wed|0600|States|timePartDelimiter|0700|dateElementOrder|ey|smf|Math||ex|sequence|mf|all|||datePartDelimiter|number|ay|orientation|milliseconds|seconds|minutes|hours|weeks|timeSuffix|years|thu|English|product|sdf|finish|df|GMT|finishExact|_formats|twoDigitYearMax|pxf|getUTCFullYear|getUTCMonth|getUTCDate|2000|setHours|setMinutes|max|undefined|Month|setSeconds|formatPatterns|setTimeToNow|firstDayOfWeek|valid|Week|validateMillisecond|Second|validateSecond|fullDateTime|validateMinute|validateHour|validateDay|validateMonth|fri|validateYear|monthDay|Translator|setTimezone|yearMonth|compare|moveToFirstDayOfMonth|zz|hms|isNaN|while|future|rfc1123|RegExp|TypeError|moveToMonth|sortableDateTime|same|previous|getParseFunction|getUTCOffset|here|there|getDayNumberFromName|_vector|hasDaylightSavingTime|May|10000|match|charAt|substr|Operators|toISOString|longTime|isLeapYear|key|shortMeridian|_toString|shortTime|universalSortableDateTime|shortestDayNames|ord|longMeridian|default|longDate|_generator|until|Sat|getUTCSeconds|getUTCMinutes|getUTCHours|getElapsed|isDaylightSavingTime|getTimezone|86400000|ceil|getOrdinalNumber|Su|Mo|string|Tu|fromNow|after|before|9999|sunday|monday|tuesday|wednesday|thursday|friday|saturday|Fri|january|february|march|april|june|july|august|september|october|november|december|Thu|Millisecond|999|Minute|Hour|Day|We|Th|Year|getISOWeek|Milliseconds|Seconds|Minutes|Hours|FullYear|364|final|first|third|fourth|fifth|Fr|get|fromObject|153|Sa|Wed|getDayName|does|occur|times|in|the|of|getMonthName|firstLetterDayNames|setMonth|Tue|3600000|60000|1000|Mon|isToday|isBefore|isAfter|January|February|Sun|message|Parse|error|getMonthNumberFromName|March|Saturday|April|token|June|July|Error|Friday|August|Thursday|Wednesday|Tuesday|September|October|November|December|Monday|Jan|Feb|Sunday|Mar|Apr|Jun|Jul|PDT|nativeName|0800|PST|MDT|MST|CDT|list|CST|0400|forward|EDT|EST|Aug|UTC|utc|Sep|Oct|Nov|unshift|Dec|ear|onth|AM|eek|our|PM|ute|mn|ond|sec|1900|milli|ms|ow|2029|englishName|US|orrow|tom|od|x27|terday|yes|ore|on|bef|hence|from|er|aft|ious|en|urday|sa|fr|nesday|yyy|we|ymd|dmy|tu|dMyhHmstz|mo|su|ober|ust|il|ch|ssz|mmZ|mmz|MMddyyyy|ddMMyyyy|Mddyyyy|ddMyyyy|Mdyyyy|dMyyyy|Mdyy|dMyy|ruary|_parse|uary|parseExact'.split('|'),0,{}));


/* /js/libs/jquery.resize.js
 * compresion time: 0.02408 -(ms)
 * ------------------------- */
/**
 * FIX DE LISANDRO PUZZOLO PARA VERIFICAR SI element.__resizeTriggers__ PERTENECE AL PADRE ANTES DE QUITRSELO
 * tambin dispara el evento "resize" para el elemento
 * 
* Detect Element Resize Plugin for jQuery
*
* https://github.com/sdecima/javascript-detect-element-resize
* Sebastian Decima
*
* version: 0.5.3
**/

(function ( $ ) {
	var attachEvent = document.attachEvent,
		stylesCreated = false;
	
	var jQuery_resize = $.fn.resize;
	
	$.fn.resize = function(callback) {
		return this.each(function() {
			if(this == window)
				jQuery_resize.call(jQuery(this), callback);
			else
				addResizeListener(this, callback);
		});
	}

	$.fn.removeResize = function(callback) {
		return this.each(function() {
			removeResizeListener(this, callback);
		});
	}
	
	if (!attachEvent) {
		var requestFrame = (function(){
			var raf = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame ||
								function(fn){ return window.setTimeout(fn, 20); };
			return function(fn){ return raf(fn); };
		})();
		
		var cancelFrame = (function(){
			var cancel = window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame ||
								   window.clearTimeout;
		  return function(id){ return cancel(id); };
		})();

		function resetTriggers(element){
			var triggers = element.__resizeTriggers__,
				expand = triggers.firstElementChild,
				contract = triggers.lastElementChild,
				expandChild = expand.firstElementChild;
			contract.scrollLeft = contract.scrollWidth;
			contract.scrollTop = contract.scrollHeight;
			expandChild.style.width = expand.offsetWidth + 1 + 'px';
			expandChild.style.height = expand.offsetHeight + 1 + 'px';
			expand.scrollLeft = expand.scrollWidth;
			expand.scrollTop = expand.scrollHeight;
		};

		function checkTriggers(element){
			return element.offsetWidth != element.__resizeLast__.width ||
						 element.offsetHeight != element.__resizeLast__.height;
		}

		/*
		function scrollListener(e){
			var element = this;
			resetTriggers(this);
			if (this.__resizeRAF__) cancelFrame(this.__resizeRAF__);
			this.__resizeRAF__ = requestFrame(function(){
				if (checkTriggers(element)) {
					element.__resizeLast__.width = element.offsetWidth;
					element.__resizeLast__.height = element.offsetHeight;
					element.__resizeListeners__.forEach(function(fn){
						fn.call(element, e);
					});
				}
			});
		};*/

		// add de Lisandro Puzzolo para disparar eventos
		function scrollListener(e){
			var element = this;
			resetTriggers(this);
			if (this.__resizeRAF__) cancelFrame(this.__resizeRAF__);
			this.__resizeRAF__ = requestFrame(function(){
				if (checkTriggers(element)) {
					element.__resizeLast__.width = element.offsetWidth;
					element.__resizeLast__.height = element.offsetHeight;
					$(element).triggerHandler('elementresize');
					$(element).triggerHandler('resize');
					element.__resizeListeners__.forEach(function(fn){
						fn.call(element, e);
					});
				}
			});
		};


		// fix de Lisandro Puzzolo para que la respuesta sea inmediata y sin glitches
		/*
		function scrollListener(e){
			var element = this;
			resetTriggers(element);
			if( !element.__resizeTicking ){
				element.__resizeTicking = true;

				element.__resizeLast__.width = element.offsetWidth;
				element.__resizeLast__.height = element.offsetHeight;
				$(element).trigger('resize');
				element.__resizeListeners__.forEach(function(fn){
					fn.call(element, e);
				});

				requestFrame( function(){
					element.__resizeTicking = false;
				})
			}
		};
		*/
		
		/* Detect CSS Animations support to detect element display/re-attach */
		var animation = false,
			animationstring = 'animation',
			keyframeprefix = '',
			animationstartevent = 'animationstart',
			domPrefixes = 'Webkit Moz O ms'.split(' '),
			startEvents = 'webkitAnimationStart animationstart oAnimationStart MSAnimationStart'.split(' '),
			pfx  = '';
		{
			var elm = document.createElement('fakeelement');
			if( elm.style.animationName !== undefined ) { animation = true; }    
			
			if( animation === false ) {
				for( var i = 0; i < domPrefixes.length; i++ ) {
					if( elm.style[ domPrefixes[i] + 'AnimationName' ] !== undefined ) {
						pfx = domPrefixes[ i ];
						animationstring = pfx + 'Animation';
						keyframeprefix = '-' + pfx.toLowerCase() + '-';
						animationstartevent = startEvents[ i ];
						animation = true;
						break;
					}
				}
			}
		}
		
		var animationName = 'resizeanim';
		var animationKeyframes = '@' + keyframeprefix + 'keyframes ' + animationName + ' { from { opacity: 0; } to { opacity: 0; } } ';
		var animationStyle = keyframeprefix + 'animation: 1ms ' + animationName + '; ';
	}
	
	function createStyles() {
		if (!stylesCreated) {
			//opacity:0 works around a chrome bug https://code.google.com/p/chromium/issues/detail?id=286360
			var css = (animationKeyframes ? animationKeyframes : '') +
					'.resize-triggers { ' + (animationStyle ? animationStyle : '') + 'visibility: hidden; opacity: 0; } ' +
					'.resize-triggers, .resize-triggers > div, .contract-trigger:before { content: \" \"; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',
				head = document.head || document.getElementsByTagName('head')[0],
				style = document.createElement('style');
			
			style.type = 'text/css';
			if (style.styleSheet) {
				style.styleSheet.cssText = css;
			} else {
				style.appendChild(document.createTextNode(css));
			}

			head.appendChild(style);
			stylesCreated = true;
		}
	}
	
	window.addResizeListener = function(element, fn){
		if (attachEvent) element.attachEvent('onresize', fn);
		else {
			if (!element.__resizeTriggers__) {
				if (getComputedStyle(element).position == 'static') element.style.position = 'relative';
				createStyles();
				element.__resizeLast__ = {};
				element.__resizeListeners__ = [];
				(element.__resizeTriggers__ = document.createElement('div')).className = 'resize-triggers';
				element.__resizeTriggers__.innerHTML = '<div class="expand-trigger"><div></div></div>' +
																						'<div class="contract-trigger"></div>';
				element.appendChild(element.__resizeTriggers__);
				resetTriggers(element);
				element.addEventListener('scroll', scrollListener, true);
				
				/* Listen for a css animation to detect element display/re-attach */
				animationstartevent && element.__resizeTriggers__.addEventListener(animationstartevent, function(e) {
					if(e.animationName == animationName)
						resetTriggers(element);
				});
			}
			element.__resizeListeners__.push(fn);
		}
	};
	
	window.removeResizeListener = function(element, fn){
		if (attachEvent) element.detachEvent('onresize', fn);
		else {
			if( element.__resizeListeners__ ){
				element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn), 1);
				if (!element.__resizeListeners__.length) {
					element.removeEventListener('scroll', scrollListener);
					if( element.__resizeTriggers__.parentNode == element ){
						element.__resizeTriggers__ = !element.removeChild(element.__resizeTriggers__);
					} else {
						element.__resizeTriggers__ = null;
					}
				}
			}
		}
	}
}( jQuery ));


/* /js/libs/jquery.scaletoparent.js
 * compresion time: 0.02408 -(ms)
 * -------------------------------- */
/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 * options: {
 *	consider	: 'both' | 'width',
 *	proportional: true | false
 * }
 * 
 */

;(function($) {
	$.widget("custom.scaleToParent", {
		// default options
		options: {
			to: null,
			consider: 'both',
			proportional: true,
			// callbacks
			change: null,
			transformOrigin: 'center center'
		},
		// the constructor
		_create: function() {
			this.element
				// add a class for theming
				.addClass("scaled-to-parent");
		
		
			var $parent = $(this._getToElement())
				, $element = $(this.element);
			
			this._parentOriginalCss = {
				position	: $parent.inlineCss('position'),
				overflow	: $parent.inlineCss('overflow'),
				top			: $parent.inlineCss('top'),
				left		: $parent.inlineCss('left'),
				right		: $parent.inlineCss('right'),
				bottom		: $parent.inlineCss('bottom')
			};
			
			this._originalCss = {
				transform		: $element.inlineCss('transform'),
				transformOrigin	: $element.inlineCss('transformOrigin'),
				position		: $element.inlineCss('position'),
				top				: $element.inlineCss('top'),
				left			: $element.inlineCss('left'),
				height			: $element.inlineCss('height')
			};

			// bind click events on the changer button to the random method
			this._on(window, {
				resize: '_windowResize'
						// _on won't call random when widget is disabled
						//click: "random"
			});

			$(this._getToElement()).resize(this._refresh.bind(this));
			$(this.element).resize(this._refresh.bind(this));

			this._windowResize();
		},
		
					
						
		_refresh: function(){
			var $parent = $(this._getToElement());
			this._cleanStyle();
			if( this._spacerElement ) this._spacerElement.remove();

			var parentWidth = $parent.width()
				, parentHeight = $parent.height()
				, parentProp = parentWidth / parentHeight
				, scaleFactor = 1
				, top = 0
				, left = 0
				, transformOrigin;

			$parent.css({top: '', left: '', right: '', bottom: ''});			
			var width = this.element.outerWidth(true)
				, height = this.element.outerHeight(true)
				, prop = width / height;
			this._cleanStyle();

			if( this.options.consider == 'both' || !this.options.consider ){
				if (parentProp < prop) {
					scaleFactor = this._setScaleFactor( parentWidth / width );
				} else {
					scaleFactor = this._setScaleFactor( parentHeight / height );
				}

			} else {
				if( this.options.consider == 'width' ){
					scaleFactor = this._setScaleFactor( parentWidth / width );					
					if( this.options.proportional === false ){
						this.element.css({
							height: parentHeight / scaleFactor
						});
						height = this.element.outerHeight(true);
					} else {	
						if( !this._spacerElement ) this._spacerElement = $('<div>');
						this._spacerElement.css({width: '100%', height: height * scaleFactor });
						this.element.before( this._spacerElement );	
						this.element.css({
							position: 'absolute'
						});
						parentHeight = $parent.height()
					}
				}
			}
				
			this.element.css({
				transform: 'scale(' + scaleFactor + ')',
				transformOrigin: this.options.transformOrigin
			});
			
			if ($parent.css("position") == 'static' || $parent.css("position") == '') {
				$parent.css({
					position: 'relative',
					overflow: 'hidden'
				});
			}

				
			transformOrigin = this.element.getTransformOrigin();
			
			
			left = (parentWidth - (width * scaleFactor)) / 2;
			top = (parentHeight - (height * scaleFactor)) / 2;

			top += parseFloat( $parent.css('paddingTop') );
			left += parseFloat( $parent.css('paddingLeft') );

			var oCenterLeft = width * transformOrigin.leftProp;
			var dCenterLeft = ( width * scaleFactor ) * transformOrigin.leftProp;
			left -= ( oCenterLeft - dCenterLeft );
			var oCenterTop = height * transformOrigin.topProp;
			var dCenterTop = ( height * scaleFactor ) * transformOrigin.topProp;
			top -= ( oCenterTop - dCenterTop );

			this.element.css({
				position: 'absolute',
				top: top,
				left: left
			});

				
		},
		
		_setScaleFactor: function( scaleFactor ){
			this._scaleFactor = scaleFactor;
			if( this.options.overscale === false  && this._scaleFactor > 1 ) this._scaleFactor = 1;
			return this._scaleFactor;
		},
		
		_getScaleFactor: function(){
			return this._scaleFactor;
		},
		
		random: function() {

		},
		
		_cleanStyle: function(){
			this.element
				.css( this._originalCss );

			$(this._getToElement())
				.css( this._parentOriginalCss );
		},
		
		_destroy: function() {
			this.element
				.removeClass('scaled-to-parent');
		
			this._cleanStyle();

			$(this.element).removeResize();
			$(this._getToElement()).removeResize();
			clearTimeout( this._windowResizeTimeout );
			
			this._spacerElement && this._spacerElement.remove();

		},
		// _setOptions is called with a hash of all options that are changing
		// always refresh when changing options
		_setOptions: function() {
			// _super and _superApply handle keeping the right this-context
			this._superApply(arguments);
			this._refresh();
		},
		
		_getToElement: function() {
			return this.options.to || this.element.parent()[0];
		},
		
		_windowResize: function() {
			var self = this;
			
			if( !self._dumping)  {
				self._refresh();				
			}
			self._dumping = true;
			
			clearTimeout( this._windowResizeTimeout );
			this._windowResizeTimeout = setTimeout( function(){
				self._refresh();	
				self._dumping = false;
			},500);
		}
	});
})(jQuery);




/*
aplica una transformacin para escalar el contenido
 */
;(function($) {
	$.widget("custom.scale", {
		// default options
		options: {
			type: 'cover',
			onScale: null,
			amount	: 1,

			upscale	: 1
		},
		// the constructor
		_create: function() {
			this.element
				// add a class for theming
				.addClass("scaled");


			var $parent = $(this._getToElement())
				, $element = $(this.element);


			// bind click events on the changer button to the random method
			this._on(window, {
				resize: '_windowResize'
			});

			$(this._getToElement()).resize(this._refresh.bind(this));
			$(this.element).resize(this._refresh.bind(this));

			this._windowResize();
		},

		_refresh: function(){
			var $parent = $(this._getToElement());
			var parentWidth = $parent.innerWidth()
				, parentHeight = $parent.innerHeight()
				, parentProp = parentWidth / parentHeight
				, $element = $(this.element)
				, width = $element.outerWidth()
				, height = $element.outerHeight()
				, prop = width / height
				, scale = 1
				, amount = this.options.amount

			if( this.options.type=='cover' ){
				if( parentProp > prop ){
					scale = parentWidth / width;
				} else {
					scale = parentHeight / height;
				}
			}
			if( this.options.type=='contain' ){
				if( parentProp < prop ){
					scale = parentWidth / width;
				} else {
					scale = parentHeight / height;
				}
			}

			var left = (parentWidth - width )/2;
			var top = (parentHeight - height)/2;
			if( left < 0 ) left *= amount;
			if( top < 0 ) top *= amount;

			var scaleup = (scale-1) * amount;
			if( scaleup > 0 ){
				scaleup *= this.options.upscale;
			}

			scale = 1 + scaleup;

			$element.css({
				left: left,
				top: top
			});

			this._getScaleElement().css({
				transform	: $.cssTransform({
					scale	: scale
				})
			});

			var params = {
				scale	: scale * amount,
				left	: left,
				top		: top
			};
			this.options.onScale && this.options.onScale( params );
		},

		_getScaleElement: function(){
			return $(this.options.scaleElement || this.element, this.element).eq(0);
		},

		_cleanStyle: function(){
			var $element = $(this.element);
			$element.css({
				left		: '',
				top			: ''
			});
			this._getScaleElement().css({
				transform: ''
			});
		},

		_destroy: function() {
			this.element
				.removeClass('scaled-to-parent');

			this._cleanStyle();

			$(this.element).removeResize();
			$(this._getToElement()).removeResize();
			clearTimeout( this._windowResizeTimeout );

			this._spacerElement && this._spacerElement.remove();

		},
		// _setOptions is called with a hash of all options that are changing
		// always refresh when changing options
		_setOptions: function() {
			// _super and _superApply handle keeping the right this-context
			this._superApply(arguments);
			this._refresh();
		},

		_getToElement: function() {
			return this.options.to || this.element.parent()[0];
		},

		_windowResize: function() {
			var self = this;

			if( !self._dumping)  {
				self._refresh();
			}
			self._dumping = true;

			clearTimeout( this._windowResizeTimeout );
			this._windowResizeTimeout = setTimeout( function(){
				self._refresh();
				self._dumping = false;
			},500);
		}
	});
})(jQuery);


/* /js/libs/jquery.copycss.js
 * compresion time: 0.02193 -(ms)
 * -------------------------- */
/**
 * Created by Lisandro on 11/11/2015.
 */
/*
 Copyright 2014 Mike Dunn
 http://upshots.org/
 Permission is hereby granted, free of charge, to any person obtaining
 a copy of this software and associated documentation files (the
 "Software"), to deal in the Software without restriction, including
 without limitation the rights to use, copy, modify, merge, publish,
 distribute, sublicense, and/or sell copies of the Software, and to
 permit persons to whom the Software is furnished to do so, subject to
 the following conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function($){

	$.fn.getStyles = function(only, except) {

		// the map to return with requested styles and values as KVP
		var product = {};

		// the style object from the DOM element we need to iterate through
		var style;

		// recycle the name of the style attribute
		var name;

		// if it's a limited list, no need to run through the entire style object
		if (only && only instanceof Array) {

			for (var i = 0, l = only.length; i < l; i++) {
				// since we have the name already, just return via built-in .css method
				name = only[i];
				product[name] = this.css(name);
			}

		} else {

			// prevent from empty selector
			if (this.length) {

				// otherwise, we need to get everything
				var dom = this.get(0);

				// standards
				if (window.getComputedStyle) {

					// convenience methods to turn css case ('background-image') to camel ('backgroundImage')
					var pattern = /\-([a-z])/g;
					var uc = function (a, b) {
						return b.toUpperCase();
					};
					var camelize = function(string){
						return string.replace(pattern, uc);
					};

					// make sure we're getting a good reference
					if (style = window.getComputedStyle(dom, null)) {
						var camel, value;
						// opera doesn't give back style.length - use truthy since a 0 length may as well be skipped anyways
						if (style.length) {
							for (var i = 0, l = style.length; i < l; i++) {
								name = style[i];
								camel = camelize(name);
								value = style.getPropertyValue(name);
								product[camel] = value;
							}
						} else {
							// opera
							for (name in style) {
								camel = camelize(name);
								value = style.getPropertyValue(name) || style[name];
								product[camel] = value;
							}
						}
					}
				}
				// IE - first try currentStyle, then normal style object - don't bother with runtimeStyle
				else if (style = dom.currentStyle) {
					for (name in style) {
						product[name] = style[name];
					}
				}
				else if (style = dom.style) {
					for (name in style) {
						if (typeof style[name] != 'function') {
							product[name] = style[name];
						}
					}
				}
			}
		}

		// remove any styles specified...
		// be careful on blacklist - sometimes vendor-specific values aren't obvious but will be visible...  e.g., excepting 'color' will still let '-webkit-text-fill-color' through, which will in fact color the text
		if (except && except instanceof Array) {
			for (var i = 0, l = except.length; i < l; i++) {
				name = except[i];
				delete product[name];
			}
		}

		// one way out so we can process blacklist in one spot
		return product;

	};

	// sugar - source is the selector, dom element or jQuery instance to copy from - only and except are optional
	$.fn.copyCSS = function(source, only, except) {
		var styles = $(source).getStyles(only, except);
		this.css(styles);

		return this;
	};

})(jQuery);


/* /js/libs/jquery.textfill.min.js
 * compresion time: 0.02098 -(ms)
 * ------------------------------- */
/*
  textfill
 @name      jquery.textfill.js
 @author    Russ Painter
 @author    Yu-Jie Lin
 @author    Alexandre Dantas
 @version   0.6.0
 @date      2014-08-19
 @copyright (c) 2014 Alexandre Dantas
 @copyright (c) 2012-2013 Yu-Jie Lin
 @copyright (c) 2009 Russ Painter
 @license   MIT License
 @homepage  https://github.com/jquery-textfill/jquery-textfill
 @example   http://jquery-textfill.github.io/jquery-textfill/index.html
*/
(function(m){m.fn.textfill=function(r){function f(){a.debug&&"undefined"!=typeof console&&"undefined"!=typeof console.debug&&console.debug.apply(console,arguments)}function s(){"undefined"!=typeof console&&"undefined"!=typeof console.warn&&console.warn.apply(console,arguments)}function p(a,b,e,k,n,g){function d(a,b){var c=" / ";a>b?c=" > ":a==b&&(c=" = ");return c}f("[TextFill] "+a+" { font-size: "+b.css("font-size")+",Height: "+b.height()+"px "+d(b.height(),e)+e+"px,Width: "+b.width()+d(b.width(),
k)+k+",minFontPixels: "+n+"px, maxFontPixels: "+g+"px }")}function q(a,b,e,k,f,g,d,h){for(p(a,b,f,g,d,h);d<h-1;){var l=Math.floor((d+h)/2);b.css("font-size",l);if(e.call(b)<=k){if(d=l,e.call(b)==k)break}else h=l;p(a,b,f,g,d,h)}b.css("font-size",h);e.call(b)<=k&&(d=h,p(a+"* ",b,f,g,d,h));return d}var a=m.extend({debug:!1,maxFontPixels:40,minFontPixels:4,innerTag:"span",widthOnly:!1,success:null,callback:null,fail:null,complete:null,explicitWidth:null,explicitHeight:null,changeLineHeight:!1},r);f("[TextFill] Start Debug");
this.each(function(){var c=m(a.innerTag+":visible:first",this),b=a.explicitHeight||m(this).height(),e=a.explicitWidth||m(this).width(),k=c.css("font-size"),n=parseFloat(c.css("line-height"))/parseFloat(k);f("[TextFill] Inner text: "+c.text());f("[TextFill] All options: ",a);f("[TextFill] Maximum sizes: { Height: "+b+"px, Width: "+e+"px }");var g=a.minFontPixels,d=0>=a.maxFontPixels?b:a.maxFontPixels,h=void 0;a.widthOnly||(h=q("Height",c,m.fn.height,b,b,e,g,d));var l=void 0,l=q("Width",c,m.fn.width,
e,b,e,g,d);a.widthOnly?(c.css({"font-size":l,"white-space":"nowrap"}),a.changeLineHeight&&c.parent().css("line-height",n*l+"px")):(g=Math.min(h,l),c.css("font-size",g),a.changeLineHeight&&c.parent().css("line-height",n*g+"px"));f("[TextFill] Finished { Old font-size: "+k+", New font-size: "+c.css("font-size")+" }");c.width()>e||c.height()>b&&!a.widthOnly?(c.css("font-size",k),a.fail&&a.fail(this),f("[TextFill] Failure { Current Width: "+c.width()+", Maximum Width: "+e+", Current Height: "+c.height()+
", Maximum Height: "+b+" }")):a.success?a.success(this):a.callback&&(s("callback is deprecated, use success, instead"),a.callback(this))});a.complete&&a.complete(this);f("[TextFill] End Debug");return this}})(window.jQuery);


/* /js/libs/jquery.xcolor.min.js
 * compresion time: 0.02408 -(ms)
 * ----------------------------- */
/*
 * modificado por Lisandro Puzzolo para que soporte new $.xcolor('#ff0000')
 *
 * @license jQuery paging plugin v1.8.0b 06/21/2010
 * http://www.xarg.org/project/jquery-color-plugin-xcolor/
 *
 * Copyright (c) 2010, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/
!function(a,b){function e(a){function f(a,c){var d;if(b!==a&&(a=parseFloat(a)),b===c)c=255,d=255;else if(1===c){if(b===a||1===a)return 1;c=100,d=1}else d=c;return isNaN(a)||a<=0?0:c<a?d:a<1||1===c?1===d?a:a*d|0:a*d/c}function g(a,b,c){function d(a,b,c){return c=++c%1,6*c<1?a+6*(b-a)*c:2*c<1?b:3*c<2?a+(b-a)*(4-6*c):a}if(a=f(a,360)/360,b=f(b,1),c=f(c,1),0===b)return c=Math.round(255*c),[c,c,c];var e=c<.5?c+c*b:c+b-c*b,g=c+c-e;return[Math.round(255*d(g,e,a+1/3)),Math.round(255*d(g,e,a)),Math.round(255*d(g,e,a-1/3))]}function h(a,b,c){a=f(a,360)/60,b=f(b,1),c=f(c,1);var d=0|a,e=a-d,g=Math.round(255*c*(1-b)),h=Math.round(255*c*(1-b*e)),i=Math.round(255*c*(1-b*(1-e)));switch(c=Math.round(255*c),d){case 1:return[h,c,g];case 2:return[g,c,i];case 3:return[g,h,c];case 4:return[i,g,c];case 5:return[c,g,h]}return[c,i,g]}this.setColor=function(a){if(this.success=!0,"number"==typeof a)return this.a=(a>>24&255)/255,this.r=a>>16&255,this.g=a>>8&255,void(this.b=255&a);for(;"object"==typeof a;){if(0 in a&&1 in a&&2 in a)return this.a=f(a[3],1),this.r=f(a[0]),this.g=f(a[1]),void(this.b=f(a[2]));if("r"in a&&"g"in a&&"b"in a)return this.a=f(a.a,1),this.r=f(a.r),this.g=f(a.g),void(this.b=f(a.b));if("h"in a&&"s"in a){var d;if("l"in a)d=g(a.h,a.s,a.l);else if("v"in a)d=h(a.h,a.s,a.v);else{if(!("b"in a))break;d=h(a.h,a.s,a.b)}return this.a=f(a.a,1),this.r=d[0],this.g=d[1],void(this.b=d[2])}break}if("string"==typeof a){a=a.toLowerCase().replace(/[^a-z0-9,.()#%]/g,"");var e,i;if("transparent"===a)return void(this.a=this.r=this.g=this.b=0);if("rand"===a)return i=16777215*Math.random()|0,this.a=1,this.r=i>>16&255,this.g=i>>8&255,void(this.b=255&i);if(b!==c[a]&&(a="#"+c[a]),e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/.exec(a))return this.a=1,this.r=parseInt(e[1],16),this.g=parseInt(e[2],16),void(this.b=parseInt(e[3],16));if(e=/^#?([0-9a-f])([0-9a-f])([0-9a-f])$/.exec(a))return this.a=1,this.r=parseInt(e[1]+e[1],16),this.g=parseInt(e[2]+e[2],16),void(this.b=parseInt(e[3]+e[3],16));if(e=/^rgba?\((\d{1,3}),(\d{1,3}),(\d{1,3})(,([0-9.]+))?\)$/.exec(a))return this.a=f(e[5],1),this.r=f(e[1]),this.g=f(e[2]),void(this.b=f(e[3]));if(e=/^rgba?\(([0-9.]+\%),([0-9.]+\%),([0-9.]+\%)(,([0-9.]+)\%?)?\)$/.exec(a))return this.a=f(e[5],1),this.r=Math.round(2.55*f(e[1],100)),this.g=Math.round(2.55*f(e[2],100)),void(this.b=Math.round(2.55*f(e[3],100)));if(e=/^hs([bvl])a?\((\d{1,3}),(\d{1,3}),(\d{1,3})(,([0-9.]+))?\)$/.exec(a)){var j;return j="l"===e[1]?g:h,i=j(parseInt(e[2],10),parseInt(e[3],10),parseInt(e[4],10)),this.a=f(e[6],1),this.r=i[0],this.g=i[1],void(this.b=i[2])}if(e=/^(\d{1,3}),(\d{1,3}),(\d{1,3})(,([0-9.]+))?$/.exec(a))return this.a=f(e[5],1),this.r=f(e[1]),this.g=f(e[2]),void(this.b=f(e[3]))}this.success=!1},this.getColor=function(a){if(b!==a)switch(a.toLowerCase()){case"rgb":return this.getRGB();case"hsv":case"hsb":return this.getHSV();case"hsl":return this.getHSL();case"int":return this.getInt();case"array":return this.getArray();case"fraction":return this.getFraction();case"css":case"style":return this.getCSS();case"name":return this.getName()}return this.getHex()},this.getRGB=function(){return this.success?{r:this.r,g:this.g,b:this.b,a:this.a}:null},this.getCSS=function(){return this.success?0===this.a?"transparent":1===this.a?"rgb("+this.r+","+this.g+","+this.b+")":d(this.r,this.g,this.b,this.a):null},this.getArray=function(){return this.success?[this.r,this.g,this.b,100*this.a|0]:null},this.getName=function(){if(this.success){var b,a=null,d=c,f=this.getHSL();for(var g in d){var h=new e(d[g]).getHSL(),i=Math.sqrt(.5*(f.h-h.h)*(f.h-h.h)+.5*(f.s-h.s)*(f.s-h.s)+(f.l-h.l)*(f.l-h.l));(null===a||i<a)&&(a=i,b=g)}return b}return null},this.getFraction=function(){return this.success?{r:this.r/255,g:this.g/255,b:this.b/255,a:this.a}:null},this.getHSL=function(){if(this.success){var g,h,a=this.r/255,b=this.g/255,c=this.b/255,d=Math.min(a,b,c),e=Math.max(a,b,c),f=e-d,i=(e+d)/2;return 0===f?(g=0,h=0):(g=a===e?(b-c)/f:b===e?2+(c-a)/f:4+(a-b)/f,h=f/(i<.5?e+d:2-e-d)),{h:Math.round(60*((6+g)%6)),s:Math.round(100*h),l:Math.round(100*i),a:this.a}}return null},this.getHSV=function(){if(this.success){var g,h,a=this.r/255,b=this.g/255,c=this.b/255,d=Math.min(a,b,c),e=Math.max(a,b,c),f=e-d,i=e;return h=0===e?0:f/e,g=0===f?0:a===e?(b-c)/f:b===e?2+(c-a)/f:4+(a-b)/f,{h:Math.round(60*((6+g)%6)),s:Math.round(100*h),v:Math.round(100*i),a:this.a}}return null},this.getHex=function(){if(this.success){var a="0123456789abcdef",b=this.r>>4,c=this.g>>4,d=this.b>>4,e=15&this.r,f=15&this.g,g=15&this.b;return"#"+a.charAt(b)+a.charAt(e)+a.charAt(c)+a.charAt(f)+a.charAt(d)+a.charAt(g)}return null},this.getInt=function(a){return this.success?b!==a?(100*this.a|0)<<24^this.r<<16^this.g<<8^this.b:16777215&(this.r<<16^this.g<<8^this.b):null},this.toString=function(){return this.getHex()},this.setColor(a)}function f(b,c){var d="";do if(d=a.css(b,c),""!==d&&"transparent"!==d&&"rgba(0, 0, 0, 0)"!==d||a.nodeName(b,"body"))break;while(b=b.parentNode);return""===d&&(d=a.support.rgba?"transparent":"backgroundColor"===c?"white":"black"),new e(d)}function g(){this.test=function(a){var b=new e(a);return b.success?b:null},this.red=function(a){var b=new e(a);return b.success?(b.g=255,b.b=255,b):null},this.blue=function(a){var b=new e(a);return b.success?(b.r=255,b.g=255,b):null},this.green=function(a){var b=new e(a);return b.success?(b.r=255,b.b=255,b):null},this.sepia=function(a){var b=new e(a);if(b.success){var c=b.r,d=b.g,f=b.b;return b.r=Math.round(.393*c+.769*d+.189*f),b.g=Math.round(.349*c+.686*d+.168*f),b.b=Math.round(.272*c+.534*d+.131*f),b}return null},this.random=function(){return new e([255*Math.random()|0,255*Math.random()|0,255*Math.random()|0])},this.inverse=function(a){var b=new e(a);return b.success?(b.r^=255,b.g^=255,b.b^=255,b):null},this.opacity=function(a,b,c){var d=new e(a),f=new e(b);return d.success&f.success?(c>1&&(c/=100),c=Math.max(c-1+f.a,0),d.r=Math.round((f.r-d.r)*c+d.r),d.g=Math.round((f.g-d.g)*c+d.g),d.b=Math.round((f.b-d.b)*c+d.b),d):null},this.greyfilter=function(a,b){var c,d=new e(a);if(d.success){switch(b){case 1:c=.35+13*(d.r+d.g+d.b)/60;break;case 2:c=(13*(d.r+d.g+d.b)+5355)/60;break;default:c=.3*d.r+.59*d.g+.11*d.b}return d.r=d.g=d.b=Math.min(0|c,255),d}return null},this.webround=function(a){var b=new e(a);return b.success?((b.r+=51-b.r%51)>255&&(b.r=255),(b.g+=51-b.g%51)>255&&(b.g=255),(b.b+=51-b.b%51)>255&&(b.b=255),b):null},this.distance=function(a,b){var c=new e(a),d=new e(b);return c.success&d.success?Math.sqrt(3*(d.r-c.r)*(d.r-c.r)+4*(d.g-c.g)*(d.g-c.g)+2*(d.b-c.b)*(d.b-c.b)):null},this.readable=function(a,b,c){var d=new e(b),f=new e(a);if(c=c||10,d.success&f.success){var g=.299*f.r+.587*f.g+.114*f.b-.299*d.r-.587*d.g-.114*d.b;return!(g<1.5+141.162*Math.pow(.975,c)&&g>-.5-154.709*Math.pow(.99,c))}return null},this.combine=function(a,b){var c=new e(a),d=new e(b);return c.success&d.success?(c.r^=d.r,c.g^=d.g,c.b^=d.b,c):null},this.breed=function(a,b){var c=new e(a),d=new e(b),f=0,g=6;if(c.success&d.success){for(;g--;)Math.random()<.5&&(f|=15<<(g<<2));return c.r=c.r&(f>>16&255)|d.r&(f>>16&255^255),c.g=c.g&(f>>8&255)|d.g&(f>>8&255^255),c.b=c.b&(f>>0&255)|d.b&(f>>0&255^255),c}return null},this.additive=function(a,b){var c=new e(a),d=new e(b);return c.success&d.success?((c.r+=d.r)>255&&(c.r=255),(c.g+=d.g)>255&&(c.g=255),(c.b+=d.b)>255&&(c.b=255),c):null},this.subtractive=function(a,b){var c=new e(a),d=new e(b);return c.success&d.success?((c.r+=d.r-255)<0&&(c.r=0),(c.g+=d.g-255)<0&&(c.g=0),(c.b+=d.b-255)<0&&(c.b=0),c):null},this.subtract=function(a,b){var c=new e(a),d=new e(b);return c.success&d.success?((c.r-=d.r)<0&&(c.r=0),(c.g-=d.g)<0&&(c.g=0),(c.b-=d.b)<0&&(c.b=0),c):null},this.multiply=function(a,b){var c=new e(a),d=new e(b);return c.success&d.success?(c.r=c.r/255*d.r|0,c.g=c.g/255*d.g|0,c.b=c.b/255*d.b|0,c):null},this.average=function(a,b){var c=new e(a),d=new e(b);return c.success&d.success?(c.r=c.r+d.r>>1,c.g=c.g+d.g>>1,c.b=c.b+d.b>>1,c):null},this.triad=function(a){var b=new e(a);return b.success?[b,new e([b.b,b.r,b.g]),new e([b.g,b.b,b.r])]:null},this.tetrad=function(a){var b=new e(a);return b.success?[b,new e([b.b,b.r,b.b]),new e([b.b,b.g,b.r]),new e([b.r,b.b,b.r])]:null},this.gradientlevel=function(a,c,d,f){if(b===f&&(f=1),d>f)return null;var g=new e(a),h=new e(c);return g.success&h.success?(g.r=g.r+(h.r-g.r)/f*d|0,g.g=g.g+(h.g-g.g)/f*d|0,g.b=g.b+(h.b-g.b)/f*d|0,g):null},this.gradientarray=function(b,c,d){if(c>d||!b.length)return null;if(1==b.length)return new e(b[0]);var f=c*(b.length-1)/(d+1)|0,g=d/(b.length-1);return a.xcolor.gradientlevel(b[f],b[f+1],c-f*g,g)},this.nearestname=function(a){return a=new e(a),a.success?a.getName():null},this.darken=function(a,c,d){if(b===c)c=1;else if(c<0)return this.lighten(a,-c,d);b===d&&(d=32);var f=new e(a);return f.success?((f.r-=d*c)<0&&(f.r=0),(f.g-=d*c)<0&&(f.g=0),(f.b-=d*c)<0&&(f.b=0),f):null},this.lighten=function(a,c,d){if(b===c)c=1;else if(c<0)return this.darken(a,-c,d);b===d&&(d=32);var f=new e(a);return f.success?((f.r+=d*c)>255&&(f.r=255),(f.g+=d*c)>255&&(f.g=255),(f.b+=d*c)>255&&(f.b=255),f):null},this.analogous=function(a,c,d){b===c&&(c=8),b===d&&(d=30);var f=new e(a);if(f.success){var g=f.getHSV(),h=360/d,i=[f];for(g.h=(g.h-(h*c>>1)+720)%360;--c;)g.h+=h,g.h%=360,i.push(new e(g));return i}return null},this.complementary=function(a){var b=new e(a);if(b.success){var c=b.getHSL();return c.h=(c.h+180)%360,new e(c)}return null},this.splitcomplement=function(a){var b=new e(a);if(b.success){var c=b.getHSV(),d=[b];return c.h+=72,c.h%=360,d.push(new e(c)),c.h+=144,c.h%=360,d.push(new e(c)),d}return null},this.monochromatic=function(a,c){b===c&&(c=6);var d=new e(a);if(d.success){for(var f=d.getHSV(),g=[d];--c;)f.v+=20,f.v%=100,g.push(new e(f));return g}return null}}var d,c={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};a.each(["color","backgroundColor","borderColor","borderTopColor","borderBottomColor","borderLeftColor","borderRightColor","outlineColor"],function(c,g){a.cssHooks[g]={set:function(a,b){a.style[g]=new e(b).getCSS()}},a.fx.step[g]=function(a){if(b===a.xinit){if("string"==typeof a.end&&-1!==a.end.indexOf(";")){var c,h=a.end.split(";");if(h.length>2){for(c in h)-1===h[c].indexOf("native")?h[c]=new e(h[c]):h[c]=f(a.elem,g);a.start=null,a.end=h}else a.start=new e(h[0]),a.end=new e(h[1])}else a.start=f(a.elem,g),a.end=new e(a.end);a.xinit=1}var i=a.start,j=a.end,k=a.pos;if(null===i){var l=k*(j.length-1),m=k<1?0|l:j.length-2;i=j[m],j=j[m+1],k=l-m}a.elem.style[g]=d(i.r+k*(j.r-i.r)|0,i.g+k*(j.g-i.g)|0,i.b+k*(j.b-i.b)|0,i.a+k*(j.a-i.a))}}),a(function(){var b=document.createElement("div"),c=b.style;d=function(a,b,c,d){return"rgba("+a+","+b+","+c+","+d+")"},c.cssText="background-color:rgba(1,1,1,.5)",(a.support.rgba=c.backgroundColor.indexOf("rgba")>-1)||(d=function(a,b,c){return"rgb("+a+","+b+","+c+")"})}),a.xcolor=e,a.extend(a.xcolor,new g),a.fn.readable=function(){var b=this[0],c="",d="";do if(""!==c||"transparent"!==(c=a.css(b,"color"))&&"rgba(0, 0, 0, 0)"!==c||(c=""),""!==d||"transparent"!==(d=a.css(b,"backgroundColor"))&&"rgba(0, 0, 0, 0)"!==d||(d=""),""!==c&&""!==d||a.nodeName(b,"body"))break;while(b=b.parentNode);return""===c&&(c="black"),""===d&&(d="white"),a.xcolor.readable(d,c)},a.fn.colorize=function(a,b,c){var f={gradient:function(a,b,c,d){return a/b},flip:function(a,b,c,d){return" "===d?c:!c},pillow:function(a,b,c,d){return a*=2,a<=b?a/b:2-a/b}};if("function"==typeof c);else{if(void 0===f[c])return;c=f[c]}a=new e(a),b=new e(b),this.each(function(){var e=this.childNodes,f=0,g=0;if(a.success&b.success){for(var h=e.length;h--;f+=e[h].textContent.length);!function e(h){var j,i=0;if(3===h.nodeType){var n,o,q,k=a,l=b,m=f,p=0,r=c;for(j=h.nodeValue.length,o=document.createElement("span"),i=0;i<j;++i)n=document.createElement("span"),q=h.nodeValue.charAt(i),p=r(g,m,p,q),n.style.color=d(k.r+p*(l.r-k.r)|0,k.g+p*(l.g-k.g)|0,k.b+p*(l.b-k.b)|0,k.a+p*(l.a-k.a)),n.appendChild(document.createTextNode(q)),o.appendChild(n),++g;h.parentNode.replaceChild(o,h)}else for(j=h.childNodes.length;i<j;++i)e(h.childNodes[i])}(this)}})}}(jQuery);


/* /js/libs/jquery.rule-1.0.2-min.js
 * compresion time: 0.02217 -(ms)
 * --------------------------------- */
/*
 * jQuery.Rule - Css Rules manipulation, the jQuery way.
 * Copyright (c) 2007-2011 Ariel Flesler - aflesler(at)gmail(dot)com | http://flesler.blogspot.com
 * Dual licensed under MIT and GPL.
 * Date: 02/7/2011
 * @author Ariel Flesler
 * @version 1.0.2
 */
(function(f){var c=f('<style rel="alternate stylesheet" type="text/css" />').appendTo("head")[0],k=c.sheet?"sheet":"styleSheet",i=c[k],m=i.rules?"rules":"cssRules",g=i.deleteRule?"deleteRule":"removeRule",d=i.ownerNode?"ownerNode":"owningElement",e=/^([^{]+)\{([^}]*)\}/m,l=/([^:]+):([^;}]+)/;i.disabled=true;var j=f.rule=function(n,o){if(!(this instanceof j)){return new j(n,o)}this.sheets=j.sheets(o);if(n&&e.test(n)){n=j.clean(n)}if(typeof n=="object"&&!n.exec){b(this,n.get?n.get():n.splice?n:[n])}else{b(this,this.sheets.cssRules().get());if(n){return this.filter(n)}}return this};f.extend(j,{sheets:function(p){var n=p;if(typeof n!="object"){n=f.makeArray(document.styleSheets)}n=f(n).not(i);if(typeof p=="string"){n=n.ownerNode().filter(p).sheet()}return n},rule:function(n){if(n.selectorText){return["",n.selectorText,n.style.cssText]}return e.exec(n)},appendTo:function(q,n,o){switch(typeof n){case"string":n=this.sheets(n);case"object":if(n[0]){n=n[0]}if(n[k]){n=n[k]}if(n[m]){break}default:if(typeof q=="object"){return q}n=i}var t;if(!o&&(t=this.parent(q))){q=this.remove(q,t)}var s=this.rule(q);if(n.addRule){n.addRule(s[1],s[2]||";")}else{if(n.insertRule){n.insertRule(s[1]+"{"+s[2]+"}",n[m].length)}}return n[m][n[m].length-1]},remove:function(o,q){q=q||this.parent(o);if(q!=i){var n=q?f.inArray(o,q[m]):-1;if(n!=-1){o=this.appendTo(o,0,true);q[g](n)}}return o},clean:function(n){return f.map(n.split("}"),function(o){if(o){return j.appendTo(o+"}")}})},parent:function(o){if(typeof o=="string"||!f.browser.msie){return o.parentStyleSheet}var n;this.sheets().each(function(){if(f.inArray(o,this[m])!=-1){n=this;return false}});return n},outerText:function(n){return !n||!n.selectorText?"":[n.selectorText+"{","\t"+n.style.cssText,"}"].join("\n").toLowerCase()},text:function(o,n){if(n!==undefined){o.style.cssText=n}return !o?"":o.style.cssText.toLowerCase()}});j.fn=j.prototype={pushStack:function(n,p){var o=j(n,p||this.sheets);o.prevObject=this;return o},end:function(){return this.prevObject||j(0,[])},filter:function(n){var p;if(!n){n=/./}if(n.split){p=f.trim(n).toLowerCase().split(/\s*,\s*/);n=function(){var o=this.selectorText||"";return !!f.grep(o.toLowerCase().split(/\s*,\s*/),function(q){return f.inArray(q,p)!=-1}).length}}else{if(n.exec){p=n;n=function(){return p.test(this.selectorText)}}}return this.pushStack(f.grep(this,function(q,o){return n.call(q,o)}))},add:function(n,o){return this.pushStack(f.merge(this.get(),j(n,o)))},is:function(n){return !!(n&&this.filter(n).length)},not:function(p,o){p=j(p,o);return this.filter(function(){return f.inArray(this,p)==-1})},append:function(n){var p=this,o;f.each(n.split(/\s*;\s*/),function(r,q){if((o=l.exec(q))){p.css(o[1],o[2])}});return this},text:function(n){return !arguments.length?j.text(this[0]):this.each(function(){j.text(this,n)})},outerText:function(){return j.outerText(this[0])}};f.each({ownerNode:d,sheet:k,cssRules:m},function(n,o){var p=o==m;f.fn[n]=function(){return this.map(function(){return p?f.makeArray(this[o]):this[o]})}});f.fn.cssText=function(){return this.filter("link,style").eq(0).sheet().cssRules().map(function(){return j.outerText(this)}).get().join("\n")};f.each("remove,appendTo,parent".split(","),function(n,o){j.fn[o]=function(){var p=f.makeArray(arguments),q=this;p.unshift(0);return this.each(function(r){p[0]=this;q[r]=j[o].apply(j,p)||q[r]})}});f.each(("each,index,get,size,eq,slice,map,attr,andSelf,css,show,hide,toggle,queue,dequeue,stop,animate,fadeIn,fadeOut,fadeTo").split(","),function(n,o){j.fn[o]=f.fn[o]});function b(o,n){o.length=0;Array.prototype.push.apply(o,n)}var h=f.curCSS;f.curCSS=function(o,n){return("selectorText" in o)?o.style[n]||f.prop(o,n=="opacity"?1:0,"curCSS",0,n):h.apply(this,arguments)};j.cache={};var a=function(n){return function(p){var o=p.selectorText;if(o){arguments[0]=j.cache[o]=j.cache[o]||{}}return n.apply(f,arguments)}};f.data=a(f.data);f.removeData=a(f.removeData);f(window).unload(function(){f(i).cssRules().remove()})})(jQuery);


/* /js/libs/bootstrap-2.3.1.min.js
 * compresion time: 0.02718 -(ms)
 * ------------------------------- */
/*!
* Bootstrap.js by @fat & @mdo
* Copyright 2012 Twitter, Inc.
* http://www.apache.org/licenses/LICENSE-2.0.txt
*/
!function(e){"use strict";e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var n=e(this),r=n.attr("data-target"),i;r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=e(r),t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s()};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.alert.data-api",t,n.prototype.close)}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(t){var n=this.getActiveIndex(),r=this;if(t>this.$items.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){r.to(t)}):n==t?this.pause().cycle():this.slide(t>n?"next":"prev",e(this.$items[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f;this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u](),f=e.Event("slide",{relatedTarget:i[0],direction:o});if(i.hasClass("active"))return;this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var t=e(a.$indicators.children()[a.getActiveIndex()]);t&&t.addClass("active")}));if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),n.data()),o;i.carousel(s),(o=n.attr("data-slide-to"))&&i.data("carousel").pause().to(o).cycle(),t.preventDefault()})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(this.transitioning||this.$element.hasClass("in"))return;t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in");if(r&&r.length){i=r.data("collapse");if(i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][n])},hide:function(){var t;if(this.transitioning||!this.$element.hasClass("in"))return;t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0)},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[e!==null?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){n.type=="show"&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n);if(n.isDefaultPrevented())return;this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=e.extend({},e.fn.collapse.defaults,r.data(),typeof n=="object"&&n);i||r.data("collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();n[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(i).collapse(s)})}(window.jQuery),!function(e){"use strict";function r(){e(t).each(function(){i(e(this)).removeClass("open")})}function i(t){var n=t.attr("data-target"),r;n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),r=n&&e(n);if(!r||!r.length)r=t.parent();return r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||s.toggleClass("open"),n.focus(),!1},keydown:function(n){var r,s,o,u,a,f;if(!/(38|40|27)/.test(n.keyCode))return;r=e(this),n.preventDefault(),n.stopPropagation();if(r.is(".disabled, :disabled"))return;u=i(r),a=u.hasClass("open");if(!a||a&&n.keyCode==27)return n.which==27&&u.find(t).focus(),r.click();s=e("[role=menu] li:not(.divider):visible a",u);if(!s.length)return;f=s.index(s.filter(":focus")),n.keyCode==38&&f>0&&f--,n.keyCode==40&&f<s.length-1&&f++,~f||(f=0),s.eq(f).focus()}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.dropdown.data-api",r).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown-menu",function(e){e.stopPropagation()}).on("click.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.$backdrop.click(this.options.backdrop=="static"?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in");if(!t)return;i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t):t()):t&&t()}};var n=e.fn.modal;e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);i||r.data("modal",i=new t(this,s)),typeof n=="string"?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s,o,u,a;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,o=this.options.trigger.split(" ");for(a=o.length;a--;)u=o[a],u=="click"?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):u!="manual"&&(i=u=="hover"?"mouseenter":"focus",s=u=="hover"?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this)));this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e.fn[this.type].defaults,r={},i;this._options&&e.each(this._options,function(e,t){n[e]!=t&&(r[e]=t)},this),i=e(t.currentTarget)[this.type](r).data(this.type);if(!i.options.delay||!i.options.delay.show)return i.show();clearTimeout(this.timeout),i.hoverState="in",this.timeout=setTimeout(function(){i.hoverState=="in"&&i.show()},i.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var t,n,r,i,s,o,u=e.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(u);if(u.isDefaultPrevented())return;t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,t.detach().css({top:0,left:0,display:"block"}),this.options.container?t.appendTo(this.options.container):t.insertAfter(this.$element),n=this.getPosition(),r=t[0].offsetWidth,i=t[0].offsetHeight;switch(s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}this.applyPlacement(o,s),this.$element.trigger("shown")}},applyPlacement:function(e,t){var n=this.tip(),r=n[0].offsetWidth,i=n[0].offsetHeight,s,o,u,a;n.offset(e).addClass(t).addClass("in"),s=n[0].offsetWidth,o=n[0].offsetHeight,t=="top"&&o!=i&&(e.top=e.top+i-o,a=!0),t=="bottom"||t=="top"?(u=0,e.left<0&&(u=e.left*-2,e.left=0,n.offset(e),s=n[0].offsetWidth,o=n[0].offsetHeight),this.replaceArrow(u-r+s,s,"left")):this.replaceArrow(o-i,o,"top"),a&&n.offset(e)},replaceArrow:function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function i(){var t=setTimeout(function(){n.off(e.support.transition.end).detach()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.detach()})}var t=this,n=this.tip(),r=e.Event("hide");this.$element.trigger(r);if(r.isDefaultPrevented())return;return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?i():n.detach(),this.$element.trigger("hidden"),this},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var t=this.$element[0];return e.extend({},typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var n=t?e(t.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=(typeof n.content=="function"?n.content.call(t[0]):n.content)||t.attr("data-content"),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(window.jQuery),!function(e){"use strict";function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var n=e(this),r=n.data("target")||n.attr("href"),i=/^#\w/.test(r)&&e(r);return i&&i.length&&[[i.position().top+(!e.isWindow(t.$scrollElement.get(0))&&t.$scrollElement.scrollTop()),r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active:last a")[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=e(this.options.menu),this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t=typeof this.$element[e]=="function"),t},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},focus:function(e){this.focused=!0},blur:function(e){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(e){e.stopPropagation(),e.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(t){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var n=e.fn.typeahead;e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e.fn.typeahead.noConflict=function(){return e.fn.typeahead=n,this},e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;n.typeahead(n.data())})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)).on("click.affix.data-api",e.proxy(function(){setTimeout(e.proxy(this.checkPosition,this),1)},this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var t=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),i=this.options.offset,s=i.bottom,o=i.top,u="affix affix-top affix-bottom",a;typeof i!="object"&&(s=o=i),typeof o=="function"&&(o=i.top()),typeof s=="function"&&(s=i.bottom()),a=this.unpin!=null&&n+this.unpin<=r.top?!1:s!=null&&r.top+this.$element.height()>=t-s?"bottom":o!=null&&n<=o?"top":!1;if(this.affixed===a)return;this.affixed=a,this.unpin=a=="bottom"?r.top-n:null,this.$element.removeClass(u).addClass("affix"+(a?"-"+a:""))};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s=typeof n=="object"&&n;i||r.data("affix",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery);


/* /js/libs/bootstrap.extensions.js
 * compresion time: 0.02384 -(ms)
 * -------------------------------- */
/* SMARTAFFIX CLASS DEFINITION
		 * ====================== */
!function ($) {

	"use strict"; // jshint ;_;

	var SmartAffix = function (element, options) {
		this.uid = Math.round(Math.random()*9999999);
		this.options = $.extend({}, $.fn.smartaffix.defaults, options);
		this.$element = $(element);
		this.$window = $(window).on('scroll.smartaffix.' + this.uid + '.data-api resize.smartaffix.' + this.uid + '.data-api', $.proxy(this.checkPosition, this));
		this.$anchor = this.$element.prev('[rel="affix-anchor"]');
		if(this.$anchor.length == 0){
			this.$anchor = $('<a rel="affix-anchor"></a>');
			this.$anchorCreated = true;
			this.$element.before(this.$anchor);
		}
		this.checkPosition();
		
		this._timeoutHandle = setTimeout(function(){
			this.checkPosition();
			this.checkPosition()
		}.bind(this),1000);
	};

	SmartAffix.prototype.destroy = function(){
		clearTimeout( this._timeoutHandle );
		this.checkPosition( true );
		this.$window = $(window).off('scroll.smartaffix.' + this.uid + '.data-api resize.smartaffix.' + this.uid + '.data-api');
		this.$element.removeData('smartaffix');
		if(this.$anchorCreated){
			this.$anchor.remove();
		}
	},
	

	
	SmartAffix.prototype.checkPosition = function ( forceValue ) {		
		var scrollHeight = $(document).height()
		, scrollTop = this.$window.scrollTop()
		, position = this.$element.offset()
		, offset = this.options.offset
		, offsetBottom = offset.bottom
		, offsetTop = offset.top
		, reset = 'affix affix-top affix-bottom affix-at-top affix-at-bottom'
		, affix
		, windowHeight = $(window).height()
		, includeMargins = true
		, fixedTo = null;

		if (typeof offset != 'object') offsetBottom = offsetTop = offset;
		if (typeof offsetTop == 'function') offsetTop = offset.top();
		if (typeof offsetBottom == 'function') offsetBottom = offset.bottom();
		

		if(this.$anchor.length != 0){
			offsetTop = this.$anchor.offset().top + 0;
			offsetBottom = this.$anchor.offset().top + 0;
		}
		
		var elementGlobalPosition = (this.fixedTo ? this.$anchor : this.$element ).relativeOffset(window);
		var elementBottomOutbounds = elementGlobalPosition.bottom > windowHeight;
		var elementTopOutbounds = elementGlobalPosition.top < 0;
		
		if( forceValue === undefined || forceValue instanceof $.Event ){
			if( this.options.fixTop || offsetTop ){
				if( elementTopOutbounds ){
					fixedTo = 'top';
				} else {
					affix = 'top';
				}
			}

			if( this.options.fixBottom || offsetBottom ){
				if( elementBottomOutbounds ){
					fixedTo = 'bottom';
				} else {
					affix = 'bottom';
				}
			}
		} else {
			affix = forceValue;
		}

		if( this.$element.outerHeight( includeMargins ) > $(window).height()){
			affix = null;
			fixedTo = null;
		}


		this.$anchor.css({
			height: fixedTo ? this.$element.outerHeight( includeMargins ) : 0,
			display: 'block'
		});

		if( fixedTo ){
			if(this.$anchor.width()){
				var hPadding = this.$element.outerWidth() - this.$element.width(),
					marginLeft = parseInt( this.$element.css('marginLeft') ) || 0,
					marginRight = parseInt( this.$element.css('marginRight') ) || 0,
					hMargin = marginLeft + marginRight,
					elementWidth = this.$anchor.width() - hPadding - hMargin;

				this.$element.width( elementWidth );		
			} else {
				//console.debug('error: this.$anchor.width()', this.$anchor.width(), this.$anchor.css('display'))
			}
		} else {
			this.$element.css({width: ''});
		}
		
		if (this.fixedTo !== undefined && this.fixedTo === fixedTo) return;
		this.affixed = affix;
		this.fixedTo = fixedTo;
		


		this.$element.removeClass(reset)
			.addClass( affix ? 'affix-' + affix : '' )
			.addClass( fixedTo ? 'affix affix-at-' + fixedTo : '');

	};


	/* AFFIX PLUGIN DEFINITION
		  * ======================= */

	$.fn.smartaffix = function (option) {
		return this.each(function () {
			var $this = $(this)
			, data = $this.data('smartaffix')
			, options = typeof option == 'object' && option;
			if (!data) $this.data('smartaffix', (data = new SmartAffix(this, options)));
			if (typeof option == 'string') data[option]()
		})
	};

	$.fn.smartaffix.Constructor = SmartAffix;

	$.fn.smartaffix.defaults = {
		offset: 0,
		fixTop: true,
		fixBottom: true
	};


	/* AFFIX DATA-API
		  * ============== */

	$(window).on('load', function () {
		$('[data-spy="smartaffix"]').each(function () {
			var $spy = $(this)
			, data = $spy.data();

			data.offset = data.offset || {};

			data.offsetBottom && (data.offset.bottom = data.offsetBottom);
			data.offsetTop && (data.offset.top = data.offsetTop);

			$spy.smartaffix(data)
		})
	});


	/* AGREGADOS A POPOVER
	 * ----------------
	 */

	$.extend($.fn.popover.Constructor.prototype, {
		reposition : function() {
			var $tip, inside, pos, actualWidth, actualHeight, placement, tp;

			if (this.hasContent() && this.enabled) {
		        $tip = this.tip();
		        $tip.removeClass('fade in top bottom left right topLeft topRight bottomLeft bottomRight rightTop rightBottom leftTop leftBottom');

				placement = typeof this.options.placement == 'function' ? this.options.placement
						.call(this, $tip[0], this.$element[0])
						: this.options.placement;

				inside = /in/.test(placement);

				$tip.css({
					top : 0,
					left : 0,
					display : 'block'
				});

				pos = this.getPosition(inside);

				actualWidth = $tip[0].offsetWidth;
				actualHeight = $tip[0].offsetHeight;

				switch (inside ? placement.split(' ')[1] : placement) {
				  case 'bottom':
					tp = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - actualWidth / 2};
					break;
				  case 'top':
					tp = {top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2};
					break;
				  case 'left':
					tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth};
					break;
				  case 'right':
					tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width};
					break;

				  // extend placements (top)
				  case 'topLeft':
					tp = {top: pos.top - actualHeight,  left: pos.left + pos.width / 2 - (actualWidth * .10)};
					break;
				  case 'topRight':
					tp = {top: pos.top - actualHeight, left: pos.left + pos.width / 2 - (actualWidth * .90)};
					break;

				  // extend placements (right)
				  case 'rightTop':
					tp = {top: pos.top + pos.height / 2 - (actualHeight *.10), left: pos.left + pos.width};
					break;
				  case 'rightBottom':
					tp = {top: pos.top + pos.height / 2 - (actualHeight * .90), left: pos.left + pos.width};
					break;

				  // extend placements (bottom)
				  case 'bottomLeft':
					tp = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - (actualWidth * .10)};
					break;
				  case 'bottomRight':
					tp = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - (actualWidth * .90)};
					break;

				  // extend placements (left)
				  case 'leftTop':
					tp = {top: pos.top + pos.height / 2 - (actualHeight *.10), left: pos.left - actualWidth};
					break;
				  case 'leftBottom':
					tp = {top: pos.top + pos.height / 2 - (actualHeight * .90), left: pos.left - actualWidth};
					break;

				}

				$tip
		          .offset(tp)
		          .addClass(placement)
		          .addClass('in')
				      
			}
		}
	});

	if( $.fn.popover.Constructor.VERSION > '3.3.2' ){
		$.extend( $.fn.popover.Constructor.prototype, {
			reposition: function () {
				var e = $.Event('show.bs.' + this.type)

				if (this.hasContent() && this.enabled) {
					this.$element.trigger(e)

					var inDom = $.contains(this.$element[0].ownerDocument.documentElement, this.$element[0])
					if (e.isDefaultPrevented() || !inDom) return
					var that = this

					var $tip = this.tip()

					var tipId = this.getUID(this.type)

					//this.setContent()
					//$tip.attr('id', tipId)
					//this.$element.attr('aria-describedby', tipId)

					//if (this.options.animation) $tip.addClass('fade')

					var placement = typeof this.options.placement == 'function' ?
						this.options.placement.call(this, $tip[0], this.$element[0]) :
						this.options.placement

					var autoToken = /\s?auto?\s?/i
					var autoPlace = autoToken.test(placement)
					if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

					$tip
						//.detach()
						.css({top: 0, left: 0, display: 'block'})
						.addClass(placement)
						.data('bs.' + this.type, this)

					//this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)
					//this.$element.trigger('inserted.bs.' + this.type)

					var pos = this.getPosition()
					var actualWidth = $tip[0].offsetWidth
					var actualHeight = $tip[0].offsetHeight

					if (autoPlace) {
						var orgPlacement = placement
						var viewportDim = this.getPosition(this.$viewport)

						placement = placement == 'bottom' && pos.bottom + actualHeight > viewportDim.bottom ? 'top' :
							placement == 'top' && pos.top - actualHeight < viewportDim.top ? 'bottom' :
								placement == 'right' && pos.right + actualWidth > viewportDim.width ? 'left' :
									placement == 'left' && pos.left - actualWidth < viewportDim.left ? 'right' :
										placement

						$tip
							.removeClass(orgPlacement)
							.addClass(placement)
					}

					var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

					this.applyPlacement(calculatedOffset, placement)
				}
			}
		});
	}


	////////////////////////////////////////////////////////////
	var carouselPrototype = $.fn.carousel.Constructor.prototype;
	var carouselOriginalCycle = carouselPrototype.cycle;
	//var slidingInverval = 10;
	var search = location.search.slice(1).split('&').map(function(key){var splitted = key.split('='); var result = {}; result[splitted[0]] = splitted[1]; return result; });
	//if( search.testingPerformance != 1 ) slidingInverval = 500;


	$.extend(carouselPrototype, {
		initialize: function(){
			var self = this
				, resizeThrottle
				, resizeRequests = 0;

			if(!this._initialized) {
				this._initialized = true;

				if( this.options.height == 'fixed' ) {
					$.each( this.getSlides(), function( i, slide ){
						$(slide).resize( function(){
							if( $(slide).isOutsideWindow().visible ){
								if( !resizeThrottle ){
									self.setFixedHeight();
									resizeThrottle = setTimeout(function(){
										if( resizeRequests ) self.setFixedHeight();
										resizeThrottle = null;
										resizeRequests = 0;
									}, 1000 );
								} else {
									resizeRequests++;
								}
							}
						})
					});
				}

			}
		},

		destroy: function(){
			if (this.interval) clearInterval(this.interval);

			if( this.options.height == 'fixed' ) {
				$.each(this.getSlides(), function (i, slide) {
					$(slide).removeResize();
				});
			}
		},

		cycle: function(){
			carouselOriginalCycle.apply( this, arguments );
			this.initialize();
		},

		pause: function (e) {
			if (!e) this.paused = true
			/*
			if (this.$element.find('.next, .prev').length && $.support.transition.end) {
				this.$element.trigger($.support.transition.end)
				this.cycle(true)
			}
			*/

			clearInterval(this.interval)
			this.interval = null
			return this
		},

		next: function(){
			if (this.sliding || !this.$element.is(':onscreen')) return
			return this.slide('next')
		},

		getSlides: function(){
			return this.$element.find('.carousel-inner').children();
		},

		getSlidesHeights: function(){
			var $slides = this.getSlides();
			return $slides.map(function(i, element){
				return( $(element).realHeight() );
			});
		},

		getMaxSlidesHeight: function(){
			var slidesHeights = this.getSlidesHeights();
			return Math.max.apply(Math, slidesHeights );
		},

		setFixedHeight: function(){
			var height = this.getMaxSlidesHeight();
			this.$element.find('.carousel-inner').css({minHeight: height });
			
			$.each( this.getSlides(), function( i, element ){
				var elementHeight = $(element).height();
				var elementRealHeight = $(element).realHeight();
				var marginTop = (height - elementRealHeight ) / 2;
				$(element).css({paddingTop: marginTop, paddingBottom: marginTop});
			});
		},

		// agregado para que Carousel anime el height luego de cada slide
		slide: function (type, next) {
			var $active = this.$element.find('.item.active')
				, $next = next || $active[type]()
				, isCycling = this.interval
				, direction = type == 'next' ? 'left' : 'right'
				, fallback  = type == 'next' ? 'first' : 'last'
				, that = this
				, e
				, options = this.options
				, self = this
				, $carouselInner = $active.closest('.carousel-inner')

			options.preserveMinHeight = true;

			this.sliding = true;

			isCycling && this.pause();

			$next = $next.length ? $next : this.$element.find('.item')[fallback]();

			e = $.Event('slide', {
				relatedTarget: $next[0]
				, direction: direction
			});

			if ($next.hasClass('active')) return;

			if (this.$indicators.length) {
				this.$indicators.find('.active').removeClass('active');
				this.$element.one('slid', function () {
					var $nextIndicator = $(that.$indicators.children()[that.getActiveIndex()]);
					$nextIndicator && $nextIndicator.addClass('active');
				})
			}


			if ($.support.transition && this.$element.hasClass('slide')) {
				this.$element.trigger(e);
				if (e.isDefaultPrevented()) return;
				$next.addClass(type);
				$next[0].offsetWidth; // force reflow
				$active.addClass(direction);
				$next.addClass(direction);
				$active.addClass('animated');
				$next.addClass('animated');

				/*
				var transitionInterval = setInterval( function(){
					that.$element.trigger('sliding');
				},slidingInverval );
				*/

				var transitionInterval;
				var ticking = false;
				var loop = function(){
					that.$element.trigger('sliding');
					transitionInterval = requestAnimationFrame( loop );
				}
				loop();

				if( options.height == 'animateDuringSlide' ){
					$carouselInner.stop().height('');
					var height = $carouselInner.height();
					var nextHeight = $next.realHeight();
					var duration = parseFloat($next.css('transition-duration')) * 1000;

					$carouselInner.animate({height: nextHeight}, duration, function () {
					});
				} else if( options.height == 'fixed' ){
					self.setFixedHeight();
				}

				this.$element.one($.support.transition.end, function () {
					var lastHeight = $carouselInner.height();

					$carouselInner.stop().height('');
					var height = $carouselInner.height();

					$next.removeClass([type, direction].join(' ')).addClass('active');
					$active.removeClass(['active', direction].join(' '));

					$active.removeClass('animated');
					$next.removeClass('animated');


					that.sliding = false;

					//clearInterval( transitionInterval );
					cancelAnimationFrame( transitionInterval );

					setTimeout(function () {
						that.$element.trigger('slid');
					}, 0);

					var finalHeight = $carouselInner.height();

					if( options.height == 'animateAfterSlide' ){
						$carouselInner.height(height);
						$carouselInner.animate({height: finalHeight}, function () {
							$carouselInner.stop().height('');
						});
					}
				});
			} else {
				this.$element.trigger(e);
				if (e.isDefaultPrevented()) return;
				$active.removeClass('active');
				$next.addClass('active');
				this.sliding = false;
				this.$element.trigger('slid')
			}

			isCycling && this.cycle();

			return this
		}
	});
	
	
}(window.jQuery);		
		


!function($){
	"use strict"; // jshint ;_;
	var SmartAffix2 = function( element, options ){
		this.$element = $(element);
		this.$window = $(window);
		this.options = $.extend({}, options );

		this._createAnchor();
		this._bindEvents();

		this.checkPosition();
	};
	
	$.extend(SmartAffix2.prototype, {	
		_createAnchor: function(){
			this.$anchor = this.$element.prev('[rel="affix-anchor"]');
			if(this.$anchor.length === 0){
				this.$anchor = $('<a rel="affix-anchor"></a>');
				this.$anchorCreated = true;
				this.$element.before(this.$anchor);
			}	
		},
		
		_bindEvents: function(){
			this.$window.on('scroll.smartaffix.' + this.uid + '.data-api resize.smartaffix.' + this.uid + '.data-api', $.proxy(this.checkPosition, this));
		},
		
		destroy: function(){
			this.$window.off('scroll.smartaffix.' + this.uid + '.data-api resize.smartaffix.' + this.uid + '.data-api', $.proxy(this.checkPosition, this));
			this.$element.removeData('smartaffix2');
			if(this.$anchorCreated){
				this.$anchor.remove();
			}
		},
		
		checkPosition: function(){
			var element = this.affixed ? this.$anchor : this.$element
				, outside = element.isOutsideWindow()
				, affixed = this.affixed
				, includeMargins = true
				, _outside = this._outside || {};
			
			this.affixed = false;
			if( this.options.fixBottom ){
				var outsidebottom = !!outside.bottom;
				if( outsidebottom ) this.affixed = true;
				this.$element.toggleClass('affix-at-bottom', outsidebottom );
			}
			
			if( this.options.fixTop ){
				var outsidetop = !!outside.top;
				if( outsidetop ) this.affixed = true;
				this.$element.toggleClass('affix-at-top', outsidetop);
			}

			if( affixed !== this.affixed ){
				this.$anchor.css({
					height: this.affixed ? this.$element.outerHeight( includeMargins ) : 0,
					display: 'block'
				});

				this.$element.toggleClass('affix hardware-accelerated', this.affixed);
			}
			
			this._outside = outside;
		}
	});
	
	$.fn.smartaffix2 = function (option) {
		return this.each(function () {
			var $this = $(this)
			, data = $this.data('smartaffix2')
			, options = typeof option == 'object' && option;
			if (!data) $this.data('smartaffix2', (data = new SmartAffix2(this, options)));
			if (typeof option == 'string') data[option]()
		});
	};

	$.fn.smartaffix2.Constructor = SmartAffix2;
	
	$.fn.smartaffix2.defaults = {
		offset: 0,
		fixTop: true,
		fixBottom: true
	}
	
}(window.jQuery);


/* /js/libs/image-scale.lisandro.js
 * compresion time: 0.02384 -(ms)
 * -------------------------------- */
// ==========================================================================
// Project:     Image Scale
// Description: Scale images to fit or fill any target size via two simple properties: scale and align.
// Copyright:   2012-2013 Nicolas BADIA
// License:     Licensed under the MIT license (see LICENCE)
// Version:     1.3.1
// ==========================================================================

!function($) { "use strict";

  // ..........................................................
  // IMAGE SCALE PLUGIN DEFINITION
  //

  $.fn.imageScale = function( option ) {

    return this.each(function() {
      var $this = $(this),
          data = $this.data('imageScale');
          
      if (!data) {
        //$this.css('opacity', 0);

        var didLoad = $this[0].complete,
            options = $.extend({}, $.fn.imageScale.defaults, typeof option == 'object' && option),

            loadFunc = function() {
              $this.data('imageScale', (data = new ImageScale(this, options)));

              if (options.rescaleOnResize) {
                $(window).resize(function(e) { data.scheduleScale(); });
              }

              
              //// ADON LISANDRO, BUSCAR LA VUELTA DE DEJAR ESTO FUERA 
              
              $(window).on('recalc.imageScale', function(e) {
            	  data.recalc();
              });
              //////////////////////////////////////////////////////

              data.scale(true);

              var callback = options.callback;
              if (typeof callback === 'function') callback($this, data);
              else if (callback && typeof callback === 'object') {
                callback.target[callback.action].apply(callback.target, [$this, data]);
              }
            };

        if (didLoad) {
          loadFunc.apply($this[0]);
        }
        else {
          $this.load(loadFunc);
        }
      }
      else {
        if (typeof option == 'string') data[option]();
      }
    })
  }

  $.fn.imageScale.defaults = {
    /**
      Determines how the image will scale to fit within its containing space. Possible values:

      * **fill** - stretches or compresses the source image to fill the target frame
      * **best-fill** - fits the shortest side of the source image within the target frame while maintaining the original aspect ratio
      * **best-fit** - fits the longest edge of the source image within the target frame while maintaining the original aspect ratio
      * **best-fit-down** - same as *best-fit* but will not stretch the source if it is smaller than the target
      * **none** - the source image is left unscaled

      @type String
      @default best-fill
      @since Version 1.2
    */
    scale: 'best-fill',

    /**
      Align the image within its frame. Possible values:

      * **left**
      * **right**
      * **center**
      * **top**
      * **bottom**
      * **top-left**
      * **top-right**
      * **bottom-left**
      * **bottom-right**

      @type String
      @default center
      @since Version 1.2
    */
    align: 'center',

    /**
      A jQuery Object against which the image size will be calculated.
      If null, the parent of the image will be used.

      @type jQuery Object
      @default null
      @since Version 1.0
    */
    parent: null,

    /**
      A boolean determining if the parent should hide its overflow.

      @type Boolean
      @default true
      @since Version 1.0
    */
    hideParentOverflow: true,

    /**
      A duration in milliseconds determining how long the fadeIn animation will run when your image is scale for the firstTime.

      Set it to 0 if you don't want any animation.

      @type Number|String
      @default 0
      @since Version 1.1
    */
    fadeInDuration: 0,

    /**
      A boolean indicating if the image size should be rescaled when the window is resized. 

      The window size is checked using requestAnimationFrame for good performance.
      
      @type Boolean
      @default true
      @since Version 1.0
    */
    rescaleOnResize: true,

    /**
      A function that will be call once the image has been load and scale. 

      Must be either a function or an object. If an object, it must has a target (an object) 
      and an action (the name of the method in the target) as property.

      Here is an example:

          $images.imageScale({ 
            callback: {
              target: this,
              action: 'didScale'
            }
          });
      
      @type Function|Object
      @default null
      @since Version 1.3
    */
    callback: null,
    
    fixDisplay: true,

    /**
      A number indicating the debug level :

      1: error
      2: error & warning
      3: error & warning & notice
      
      @type Number
      @default 0
      @since Version 1.0
    */
    debug: 0
  }

  // ..........................................................
  // IMAGE SCALE PUBLIC CLASS DEFINITION
  //

  var ImageScale = function(element, options) { 
    this.options = options;
    this.element = element;
    var $element = this.$element = $(element);

    /* ORIGINAL
	this.elementWidth = $element.attr('width') || element.width;
    this.elementHeight = $element.attr('height') || element.height;
	*/
	// MODIFICADO
    this.elementWidth = $element.attr('width') || $(element).innerWidth() || element.width;
    this.elementHeight = $element.attr('height') || $(element).innerHeight() || element.height;
	/////////////
	

    this.$parent = $( options.parent ? options.parent : $(element).parent()[0] );
    
    /*
    if (!(this.elementWidth>0 && this.elementHeight>0)){
    	throw new Error( 'ImageScale probablemente no pudo determinar el alto o el ancho de la imagen' );
    } else {
    	console.debug('ImageScale.constructor this.elementWidth:', this.elementWidth, 'this.elementHeight:', this.elementHeight);
    }*/

  }

  $.fn.imageScale.Constructor = ImageScale;

  ImageScale.prototype = {

    NONE: "none",
    FILL: "fill",
    BEST_FILL: "best-fill",
    BEST_FIT: "best-fit",
    BEST_FIT_DOWN_ONLY: "best-fit-down",
    
    ALIGN_LEFT: 'left',
    ALIGN_RIGHT: 'right',
    ALIGN_CENTER: 'center',
    ALIGN_TOP: 'top',
    ALIGN_BOTTOM: 'bottom',
    ALIGN_TOP_LEFT: 'top-left',
    ALIGN_TOP_RIGHT: 'top-right',
    ALIGN_BOTTOM_LEFT: 'bottom-left',
    ALIGN_BOTTOM_RIGHT: 'bottom-right',

    constructor: ImageScale,

    /**
      Main method. Used to scale the images.

      When `rescaleOnResize` is set to true, this method is executed each time the
      windows size changes.  
      
      If `rescaleOnResize` is set to false, you may want to call it manually. Here is an 
      example on how you should do it:

          $image.imageScale('scale');


      @param {Boolean} firstTime
    */
    scale: function(firstTime) {
      if (this._isDestroyed) return;

      var that = this,   
          options = this.options,
          $parent = this.$parent,
          element = this.element,
          $element = this.$element,
          sourceWidth,
          sourceHeight,
          destWidth, 
          destHeight;

      if (firstTime) {
        if (options.hideParentOverflow) {
          $parent.css({ overflow: 'hidden' });
        }

        //$element.css({ opacity: 1 });
      }

      this._didScheduleScale = false;

      if (options.rescaleOnResize) {
        if (!this._needUpdate()) return;
      }
      
 
      if(options.fixDisplay){
          var $elementParents = $element.parents(":css(display=none)");
          
          $elementParents.each( function(){
        	  var display = this.style.display;    	  
        	  $(this).data('_oldVDisplay', display);
        	  $(this).show();
          });             	  
      }
      
      
      /** hack porque Chrome aparentemente al accdeder por primera vez a algunas propiedades devuelve 0
       *//////////////////
       
      $parent.outerWidth();
      $parent.outerHeight();
      
      $parent.innerWidth();
      $parent.innerHeight();
      
      /*///////////////////// */
      
      destWidth = $parent.outerWidth(); 
      destHeight = $parent.outerHeight();
      
      
      
      var destInnerWidth = $parent.innerWidth(), 
          destInnerHeight = $parent.innerHeight(),

          widthOffset = destWidth - destInnerWidth,
          heightOffset = destHeight - destInnerHeight,

          scaleData = $element.attr('data-scale'),
          alignData = $element.attr('data-align'),

          scale = scaleData?scaleData:options.scale,
          align = alignData?alignData:options.align,

          fadeInDuration = options.fadeInDuration;

      if (!scale) {
        if (options.debug > 2) {
          console.log("imageScale - DEBUG NOTICE: The scale property is null.");
        }
        return;
      }

      if (this._cacheDestWidth === destWidth && this._cacheDestHeight === destHeight) {
        if (options.debug > 2) {
          console.log("imageScale - DEBUG NOTICE: The parent size hasn't changed: dest width: '"+destWidth+"' - dest height: '"+destHeight+"'.");
        }
      }


      element.width;
      element.height;
      //console.debug('ImageScale.scale() A) element.width', element.width, 'element.height:', element.height);

      sourceWidth = this.elementWidth = (this.elementWidth || element.width); 
      sourceHeight = this.elementHeight = (this.elementHeight || element.height);
          
    
      // console.debug('ImageScale.scale() B) element.width', element.width, 'element.height:', element.height);
      //console.debug('ImageScale.scale() this.elementWidth:', this.elementWidth, 'this.elementHeight:', this.elementHeight);

      
      
      if (!(destWidth && destHeight && sourceWidth && sourceHeight)) {
        if (options.debug > 0) {
          console.error("imageScale - DEBUG ERROR: The dimensions are incorrect: source width: '"+sourceWidth+"' - source height: '"+sourceHeight+"' - dest width: '"+destWidth+"' - dest height: '"+destHeight+"'.");
          console.error('imageScale - DEBUG ERROR: est en el dom?', $parent.parents('html').length>0);
          console.error('imageScale - DEBUG ERROR: clase del modal:', $parent.closest('.modal').attr('class') );
        }
        return;
      }

      this._cacheDestWidth = destWidth;
      this._cacheDestHeight = destHeight;

      var layout = this._innerFrameForSize(scale, align, sourceWidth, sourceHeight, destWidth, destHeight);

      if (widthOffset) layout.x -= widthOffset/2;
      if (heightOffset) layout.y -= heightOffset/2;

      $element.css({ position: 'absolute', top: layout.y+'px', left: layout.x+'px', width: layout.width+'px', height: layout.height+'px', 'max-width': 'none' });
      
      
      if(options.fixDisplay){
	      $elementParents.each( function(){
	    	  var display = $(this).data('_oldVDisplay');
	    	  //console.debug(this, display);
	    	  $(this).css({display: display});
	      })
      }
	      

      if (firstTime && fadeInDuration) {
        $element.css({ display: 'none' });
        $element.fadeIn(fadeInDuration);
      }
    },

    /**
      Removes the data for the element.
    
      Here is an example on how you can call the destroy method:

          $image.imageScale('destroy');

    */
    destroy: function() {
      this._isDestroyed = true;
      this.$element.removeData('imageScale');
    },

    /**
      @private
      
      Returns a frame (x, y, width, height) fitting the source size (sourceWidth & sourceHeight) within the
      destination size (destWidth & destHeight) according to the align and scale properties.
      
      @param {String} scale
      @param {String} align
      @param {Number} sourceWidth
      @param {Number} sourceHeight
      @param {Number} destWidth
      @param {Number} destHeight
      @returns {Object} the inner frame with properties: { x: value, y: value, width: value, height: value }
    */
    _innerFrameForSize: function(scale, align, sourceWidth, sourceHeight, destWidth, destHeight) {
      var scaleX,
          scaleY,
          result;

      // Fast path
      result = { x: 0, y: 0, width: destWidth, height: destHeight };
      if (scale === this.FILL) return result;

      // Determine the appropriate scale
      scaleX = destWidth / sourceWidth;
      scaleY = destHeight / sourceHeight;

      switch (scale) {
        case this.BEST_FILL:
          scale = scaleX > scaleY ? scaleX : scaleY;
          break;
        case this.BEST_FIT:
          scale = scaleX < scaleY ? scaleX : scaleY;
          break;
        
        case this.NONE:
          scale = 1.0;
          break;
        //case this.BEST_FIT_DOWN_ONLY:
        default:
          if (scale !== this.BEST_FIT_DOWN_ONLY && this.options.debug > 1) {
            console.warn("imageScale - DEBUG WARNING: The scale '"+scale+"' was not understood.");
          }
        
          if ((sourceWidth > destWidth) || (sourceHeight > destHeight)) {
            scale = scaleX < scaleY ? scaleX : scaleY;
          } else {
            scale = 1.0;
          }
          break;
      }

      sourceWidth *= scale;
      sourceHeight *= scale;
      result.width = Math.round(sourceWidth);
      result.height = Math.round(sourceHeight);

      // Align the image within its frame
      switch (align) {
        case this.ALIGN_LEFT:
          result.x = 0;
          result.y = (destHeight / 2) - (sourceHeight / 2);
          break;
        case this.ALIGN_RIGHT:
          result.x = destWidth - sourceWidth;
          result.y = (destHeight / 2) - (sourceHeight / 2);
          break;
        case this.ALIGN_TOP:
          result.x = (destWidth / 2) - (sourceWidth / 2);
          result.y = 0;
          break;
        case this.ALIGN_BOTTOM:
          result.x = (destWidth / 2) - (sourceWidth / 2);
          result.y = destHeight - sourceHeight;
          break;
        case this.ALIGN_TOP_LEFT:
          result.x = 0;
          result.y = 0;
          break;
        case this.ALIGN_TOP_RIGHT:
          result.x = destWidth - sourceWidth;
          result.y = 0;
          break;
        case this.ALIGN_BOTTOM_LEFT:
          result.x = 0;
          result.y = destHeight - sourceHeight;
          break;
        case this.ALIGN_BOTTOM_RIGHT:
          result.x = destWidth - sourceWidth;
          result.y = destHeight - sourceHeight;
          break;
        default: // this.ALIGN_CENTER
          if (align !== this.ALIGN_CENTER && this.options.debug > 1) {
            console.warn("imageScale - DEBUG WARNING: The align '"+align+"' was not understood.");
          }
          result.x = (destWidth / 2) - (sourceWidth / 2);
          result.y = (destHeight / 2) - (sourceHeight / 2);
      }

      return result;
    },

    /**
      @private

      Determines if the windows size has changed since the last update.

      @returns {Boolean}
    */
    _needUpdate: function() {
      var size = $(window).height() + ' ' + $(window).width();

      if (this._lastWindowSize !== size) {
        this._lastWindowSize = size;
        return true;
      }
      return false;
    },

    /**
      @private

      Schedule a scale update.
    */
    scheduleScale: function() {
      if (this._didScheduleScale) return; 

      if (window.requestAnimationFrame) {
        var that = this;
        this._didScheduleScale = true;
        requestAnimationFrame(function() { that.scale(); });
      }
      else {
        this.scale();
      }
    },
    
    
    recalc: function(){
    	var data = this;
    	
	   	 this.$element.css({width:'auto', height: 'auto'});
		  delete data._lastWindowSize;
		  delete data._cacheDestWidth;
		  delete data._cacheDestHeight;
		  delete data.elementHeight;
		  delete data.elementWidth;
		  this.scheduleScale();
    },
    

    /** @private */
    _cacheDestWidth: null,

    /** @private */
    _cacheDestHeight: null,

    /** @private */
    _lastWindowSize: null,

    /** @private */
    _didScheduleScale: null
  }
}(window.jQuery);


/* /js/libs/odometer.lisandro.min.js
 * compresion time: 0.02289 -(ms)
 * --------------------------------- */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=[].slice;m='<span class="odometer-value"></span>';p='<span class="odometer-ribbon"><span class="odometer-ribbon-inner">'+m+"</span></span>";r='<span class="odometer-digit"><span class="odometer-digit-spacer">8</span><span class="odometer-digit-inner">'+p+"</span></span>";o='<span class="odometer-formatting-mark"></span>';n="(,ddd).dd";u=/^\(?([^)]*)\)?(?:(.)(d+))?$/;a=30;s=2e3;e=20;f=2;i=.5;l=1e3/a;t=1e3/e;d="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd";T=document.createElement("div").style;v=T.transition!=null||T.webkitTransition!=null||T.mozTransition!=null||T.oTransition!=null;S=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;y=function(e){var t;t=document.createElement("div");t.innerHTML=e;return t.children[0]};E=function(e,t){return e.className=e.className.replace(new RegExp("(^| )"+t.split(" ").join("|")+"( |$)","gi")," ")};g=function(e,t){E(e,t);return e.className+=" "+t};N=function(e,t){var n;if(document.createEvent!=null){n=document.createEvent("HTMLEvents");n.initEvent(t,true,true);return e.dispatchEvent(n)}};w=function(){var e,t;return(e=(t=window.performance)!=null?typeof t.now==="function"?t.now():void 0:void 0)!=null?e:+(new Date)};x=function(e,t){if(t==null){t=0}if(!t){return Math.round(e)}e*=Math.pow(10,t);e+=.5;e=Math.floor(e);return e/=Math.pow(10,t)};C=function(e){if(e<0){return Math.ceil(e)}else{return Math.floor(e)}};b=function(e){return e-x(e)};L=false;(k=function(){var e,t,n,r,i;if(L){return}if(window.jQuery!=null){L=true;r=["html","text"];i=[];for(t=0,n=r.length;t<n;t++){e=r[t];i.push(function(e){var t;t=window.jQuery.fn[e];return window.jQuery.fn[e]=function(e){var n;if(e==null||((n=this[0])!=null?n.odometer:void 0)==null){return t.apply(this,arguments)}return this[0].odometer.update(e)}}(e))}return i}})();setTimeout(k,0);h=function(){function e(t){var n,r,i,o,u,a,c,h,p,d,v=this;this.options=t;this.el=this.options.el;if(this.el.odometer!=null){return this.el.odometer}this.el.odometer=this;h=e.options;for(r in h){o=h[r];if(this.options[r]==null){this.options[r]=o}}if((u=this.options).duration==null){u.duration=s}this.MAX_VALUES=this.options.duration/l/f|0;this.resetFormat();this.value=this.cleanValue((p=this.options.value)!=null?p:"");this.renderInside();this.render();try{d=["innerHTML","innerText","textContent"];for(a=0,c=d.length;a<c;a++){i=d[a];if(this.el[i]!=null){(function(e){return Object.defineProperty(v.el,e,{get:function(){var t;if(e==="innerHTML"){return v.inside.outerHTML}else{return(t=v.inside.innerText)!=null?t:v.inside.textContent}},set:function(e){return v.update(e)}})})(i)}}}catch(m){n=m;this.watchForMutations()}this}e.prototype.dispose=function(){this.startWatchingMutations();this.unbindTransitionEnd()};e.prototype.renderInside=function(){this.inside=document.createElement("div");this.inside.className="odometer-inside";this.el.innerHTML="";return this.el.appendChild(this.inside)};e.prototype.watchForMutations=function(){var e,t=this;if(c==null){return}try{if(this.observer==null){this.observer=new c(function(e){var n;n=t.el.innerText;t.renderInside();t.render(t.value);return t.update(n)})}this.watchMutations=true;return this.startWatchingMutations()}catch(n){e=n}};e.prototype.startWatchingMutations=function(){if(this.watchMutations){return this.observer.observe(this.el,{childList:true})}};e.prototype.stopWatchingMutations=function(){var e;return(e=this.observer)!=null?e.disconnect():void 0};e.prototype.cleanValue=function(e){var t;if(typeof e==="string"){e=e.replace((t=this.format.radix)!=null?t:".","<radix>");e=e.replace(/[.,]/g,"");e=e.replace("<radix>",".");e=parseFloat(e,10)||0}return x(e,this.format.precision)};e.prototype.bindTransitionEnd=function(){var e,t,n,r,i,s,o=this;if(this.transitionEndBound){return}this.transitionEndBound=true;t=false;i=d.split(" ");s=[];for(n=0,r=i.length;n<r;n++){e=i[n];$(this.el).on(e,function(){if(t){return true}t=true;setTimeout(function(){o.render();t=false;return N(o.el,"odometerdone")},0);return true})}return s};e.prototype.unbindTransitionEnd=function(){var e,t,n,r,i,s,o=this;if(!this.transitionEndBound){return}this.transitionEndBound=false;t=false;i=d.split(" ");for(n=0,r=i.length;n<r;n++){e=i[n];$(this.el).off(e)}};e.prototype.resetFormat=function(){var e,t,r,i,s,o,a,f;e=(a=this.options.format)!=null?a:n;e||(e="d");r=u.exec(e);if(!r){throw new Error("Odometer: Unparsable digit format")}f=r.slice(1,4),o=f[0],s=f[1],t=f[2];i=(t!=null?t.length:void 0)||0;return this.format={repeating:o,radix:s,precision:i}};e.prototype.render=function(e){var t,n,r,i,s,o,u;if(e==null){e=this.value}this.stopWatchingMutations();this.resetFormat();this.inside.innerHTML="";s=this.options.theme;t=this.el.className.split(" ");i=[];for(o=0,u=t.length;o<u;o++){n=t[o];if(!n.length){continue}if(r=/^odometer-theme-(.+)$/.exec(n)){s=r[1];continue}if(/^odometer(-|$)/.test(n)){continue}i.push(n)}i.push("odometer");if(!v){i.push("odometer-no-transitions")}if(s){i.push("odometer-theme-"+s)}else{i.push("odometer-auto-theme")}this.el.className=i.join(" ");this.ribbons={};this.formatDigits(e);return this.startWatchingMutations()};e.prototype.formatDigits=function(e){var t,n,r,i,s,o,u,a,f,l;this.digits=[];if(this.options.formatFunction){r=this.options.formatFunction(e);f=r.split("").reverse();for(s=0,u=f.length;s<u;s++){n=f[s];if(n.match(/0-9/)){t=this.renderDigit();t.querySelector(".odometer-value").innerHTML=n;this.digits.push(t);this.insertDigit(t)}else{this.addSpacer(n)}}}else{i=!this.format.precision||!b(e)||false;l=e.toString().split("").reverse();for(o=0,a=l.length;o<a;o++){t=l[o];if(t==="."){i=true}this.addDigit(t,i)}}};e.prototype.update=function(e){var t,n=this;e=this.cleanValue(e);if(!(t=e-this.value)){return}E(this.el,"odometer-animating-up odometer-animating-down odometer-animating");if(t>0){g(this.el,"odometer-animating-up")}else{g(this.el,"odometer-animating-down")}this.stopWatchingMutations();this.animate(e);this.startWatchingMutations();setTimeout(function(){n.el.offsetHeight;return g(n.el,"odometer-animating")},0);return this.value=e};e.prototype.renderDigit=function(){return y(r)};e.prototype.insertDigit=function(e,t){if(t!=null){return this.inside.insertBefore(e,t)}else if(!this.inside.children.length){return this.inside.appendChild(e)}else{return this.inside.insertBefore(e,this.inside.children[0])}};e.prototype.addSpacer=function(e,t,n){var r;r=y(o);r.innerHTML=e;if(n){g(r,n)}return this.insertDigit(r,t)};e.prototype.addDigit=function(e,t){var n,r,i,s;if(t==null){t=true}if(e==="-"){return this.addSpacer(e,null,"odometer-negation-mark")}if(e==="."){return this.addSpacer((s=this.format.radix)!=null?s:".",null,"odometer-radix-mark")}if(t){i=false;while(true){if(!this.format.repeating.length){if(i){throw new Error("Bad odometer format without digits")}this.resetFormat();i=true}n=this.format.repeating[this.format.repeating.length-1];this.format.repeating=this.format.repeating.substring(0,this.format.repeating.length-1);if(n==="d"){break}this.addSpacer(n)}}r=this.renderDigit();r.querySelector(".odometer-value").innerHTML=e;this.digits.push(r);return this.insertDigit(r)};e.prototype.animate=function(e){if(!v||this.options.animation==="count"){return this.animateCount(e)}else{return this.animateSlide(e)}};e.prototype.animateCount=function(e){var n,r,i,s,o,u=this;if(!(r=+e-this.value)){return}s=i=w();n=this.value;return(o=function(){var a,f,l;if(w()-s>u.options.duration){u.value=e;u.render();N(u.el,"odometerdone");return}a=w()-i;if(a>t){i=w();l=a/u.options.duration;f=r*l;n+=f;u.render(Math.round(n))}if(S!=null){return S(o)}else{return setTimeout(o,t)}})()};e.prototype.getDigitCount=function(){var e,t,n,r,i,s;r=1<=arguments.length?_.call(arguments,0):[];for(e=i=0,s=r.length;i<s;e=++i){n=r[e];r[e]=Math.abs(n)}t=Math.max.apply(Math,r);return Math.ceil(Math.log(t+1)/Math.log(10))};e.prototype.getFractionalDigitCount=function(){var e,t,n,r,i,s,o;i=1<=arguments.length?_.call(arguments,0):[];t=/^\-?\d*\.(\d*?)0*$/;for(e=s=0,o=i.length;s<o;e=++s){r=i[e];i[e]=r.toString();n=t.exec(i[e]);if(n==null){i[e]=0}else{i[e]=n[1].length}}return Math.max.apply(Math,i)};e.prototype.resetDigits=function(){this.digits=[];this.ribbons=[];this.inside.innerHTML="";return this.resetFormat()};e.prototype.animateSlide=function(e){var t,n,r,s,o,u,a,f,l,c,h,p,d,v,m,y,b,w,E,S,x,T,N,k,L,A,O,M;y=this.value;f=this.getFractionalDigitCount(y,e);if(f){e=e*Math.pow(10,f);y=y*Math.pow(10,f)}if(!(r=e-y)){return}this.bindTransitionEnd();s=this.getDigitCount(y,e);o=[];t=0;for(h=E=0;0<=s?E<s:E>s;h=0<=s?++E:--E){b=C(y/Math.pow(10,s-h-1));a=C(e/Math.pow(10,s-h-1));u=a-b;if(Math.abs(u)>this.MAX_VALUES){c=[];p=u/(this.MAX_VALUES+this.MAX_VALUES*t*i);n=b;while(u>0&&n<a||u<0&&n>a){c.push(Math.round(n));n+=p}if(c[c.length-1]!==a){c.push(a)}t++}else{c=function(){M=[];for(var e=b;b<=a?e<=a:e>=a;b<=a?e++:e--){M.push(e)}return M}.apply(this)}for(h=x=0,N=c.length;x<N;h=++x){l=c[h];c[h]=Math.abs(l%10)}o.push(c)}this.resetDigits();O=o.reverse();for(h=T=0,k=O.length;T<k;h=++T){c=O[h];if(!this.digits[h]){this.addDigit(" ",h>=f)}if((w=this.ribbons)[h]==null){w[h]=this.digits[h].querySelector(".odometer-ribbon-inner")}this.ribbons[h].innerHTML="";if(r<0){c=c.reverse()}for(d=A=0,L=c.length;A<L;d=++A){l=c[d];m=document.createElement("div");m.className="odometer-value";m.innerHTML=l;this.ribbons[h].appendChild(m);if(d===c.length-1){g(m,"odometer-last-value")}if(d===0){g(m,"odometer-first-value")}}}if(b<0){this.addDigit("-")}v=this.inside.querySelector(".odometer-radix-mark");if(v!=null){v.parent.removeChild(v)}if(f){return this.addSpacer(this.format.radix,this.digits[f-1],"odometer-radix-mark")}};return e}();h.options=(O=window.odometerOptions)!=null?O:{};setTimeout(function(){var e,t,n,r,i;if(window.odometerOptions){r=window.odometerOptions;i=[];for(e in r){t=r[e];i.push((n=h.options)[e]!=null?(n=h.options)[e]:n[e]=t)}return i}},0);h.init=function(){var e,t,n,r,i,s;if(document.querySelectorAll==null){return}t=document.querySelectorAll(h.options.selector||".odometer");s=[];for(n=0,r=t.length;n<r;n++){e=t[n];s.push(e.odometer=new h({el:e,value:(i=e.innerText)!=null?i:e.textContent}))}return s};if(((M=document.documentElement)!=null?M.doScroll:void 0)!=null&&document.createEventObject!=null){A=document.onreadystatechange;document.onreadystatechange=function(){if(document.readyState==="complete"&&h.options.auto!==false){h.init()}return A!=null?A.apply(this,arguments):void 0}}else{document.addEventListener("DOMContentLoaded",function(){if(h.options.auto!==false){return h.init()}},false)}if(typeof define==="function"&&define.amd){define(["jquery"],function(){return h})}else if(typeof exports!=="undefined"&&exports!==null){module.exports=h}else{window.Odometer=h}}).call(this);


/* /js/libs/knockout-2.3.0.js
 * compresion time: 0.03195 -(ms)
 * -------------------------- */
// Knockout JavaScript library v2.3.0
// (c) Steven Sanderson - http://knockoutjs.com/
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

(function() {function F(q){return function(){return q}};(function(q){var w=this||(0,eval)("this"),s=w.document,H=w.navigator,t=w.jQuery,y=w.JSON;(function(q){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?q(module.exports||exports):"function"===typeof define&&define.amd?define(["exports"],q):q(w.ko={})})(function(C){function G(b,c,d,f){a.d[b]={init:function(b){a.a.f.set(b,I,{});return{controlsDescendantBindings:!0}},update:function(b,e,m,h,k){m=a.a.f.get(b,I);e=a.a.c(e());h=!d!==!e;var l=!m.fb;if(l||c||h!==m.vb)l&&(m.fb=
a.a.Oa(a.e.childNodes(b),!0)),h?(l||a.e.P(b,a.a.Oa(m.fb)),a.Ja(f?f(k,e):k,b)):a.e.ba(b),m.vb=h}};a.g.S[b]=!1;a.e.L[b]=!0}function J(b,c,d){d&&c!==a.h.n(b)&&a.h.W(b,c);c!==a.h.n(b)&&a.q.I(a.a.Ga,null,[b,"change"])}var a="undefined"!==typeof C?C:{};a.b=function(b,c){for(var d=b.split("."),f=a,g=0;g<d.length-1;g++)f=f[d[g]];f[d[d.length-1]]=c};a.r=function(a,c,d){a[c]=d};a.version="2.3.0";a.b("version",a.version);a.a=function(){function b(a,b){for(var e in a)a.hasOwnProperty(e)&&b(e,a[e])}function c(b,
e){if("input"!==a.a.u(b)||!b.type||"click"!=e.toLowerCase())return!1;var k=b.type;return"checkbox"==k||"radio"==k}var d={},f={};d[H&&/Firefox\/2/i.test(H.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];d.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");b(d,function(a,b){if(b.length)for(var e=0,c=b.length;e<c;e++)f[b[e]]=a});var g={propertychange:!0},e=s&&function(){for(var a=3,b=s.createElement("div"),e=b.getElementsByTagName("i");b.innerHTML=
"\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",e[0];);return 4<a?a:q}();return{Ta:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],p:function(a,b){for(var e=0,c=a.length;e<c;e++)b(a[e])},k:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var e=0,c=a.length;e<c;e++)if(a[e]===b)return e;return-1},La:function(a,b,e){for(var c=0,d=a.length;c<d;c++)if(b.call(e,a[c]))return a[c];return null},ka:function(b,e){var c=a.a.k(b,e);0<=c&&
b.splice(c,1)},Ma:function(b){b=b||[];for(var e=[],c=0,d=b.length;c<d;c++)0>a.a.k(e,b[c])&&e.push(b[c]);return e},Z:function(a,b){a=a||[];for(var e=[],c=0,d=a.length;c<d;c++)e.push(b(a[c]));return e},Y:function(a,b){a=a||[];for(var e=[],c=0,d=a.length;c<d;c++)b(a[c])&&e.push(a[c]);return e},R:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var e=0,c=b.length;e<c;e++)a.push(b[e]);return a},ja:function(b,e,c){var d=b.indexOf?b.indexOf(e):a.a.k(b,e);0>d?c&&b.push(e):c||b.splice(d,1)},
extend:function(a,b){if(b)for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e]);return a},w:b,oa:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},Mb:function(b){b=a.a.N(b);for(var e=s.createElement("div"),c=0,d=b.length;c<d;c++)e.appendChild(a.H(b[c]));return e},Oa:function(b,e){for(var c=0,d=b.length,g=[];c<d;c++){var f=b[c].cloneNode(!0);g.push(e?a.H(f):f)}return g},P:function(b,e){a.a.oa(b);if(e)for(var c=0,d=e.length;c<d;c++)b.appendChild(e[c])},eb:function(b,e){var c=b.nodeType?[b]:b;if(0<
c.length){for(var d=c[0],g=d.parentNode,f=0,r=e.length;f<r;f++)g.insertBefore(e[f],d);f=0;for(r=c.length;f<r;f++)a.removeNode(c[f])}},hb:function(a,b){7>e?a.setAttribute("selected",b):a.selected=b},F:function(a){return null===a||a===q?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Wb:function(b,e){for(var c=[],d=(b||"").split(e),g=0,f=d.length;g<f;g++){var r=a.a.F(d[g]);""!==r&&c.push(r)}return c},Tb:function(a,b){a=a||"";return b.length>a.length?!1:a.substring(0,b.length)===
b},yb:function(a,b){if(b.compareDocumentPosition)return 16==(b.compareDocumentPosition(a)&16);for(;null!=a;){if(a==b)return!0;a=a.parentNode}return!1},aa:function(b){return a.a.yb(b,b.ownerDocument)},pb:function(b){return!!a.a.La(b,a.a.aa)},u:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},o:function(b,d,k){var f=e&&g[d];if(f||"undefined"==typeof t)if(f||"function"!=typeof b.addEventListener)if("undefined"!=typeof b.attachEvent){var n=function(a){k.call(b,a)},p="on"+d;b.attachEvent(p,n);
a.a.C.ia(b,function(){b.detachEvent(p,n)})}else throw Error("Browser doesn't support addEventListener or attachEvent");else b.addEventListener(d,k,!1);else{if(c(b,d)){var r=k;k=function(a,b){var e=this.checked;b&&(this.checked=!0!==b.sb);r.call(this,a);this.checked=e}}t(b).bind(d,k)}},Ga:function(a,b){if(!a||!a.nodeType)throw Error("element must be a DOM node when calling triggerEvent");if("undefined"!=typeof t){var e=[];c(a,b)&&e.push({sb:a.checked});t(a).trigger(b,e)}else if("function"==typeof s.createEvent)if("function"==
typeof a.dispatchEvent)e=s.createEvent(f[b]||"HTMLEvents"),e.initEvent(b,!0,!0,w,0,0,0,0,0,!1,!1,!1,!1,0,a),a.dispatchEvent(e);else throw Error("The supplied element doesn't support dispatchEvent");else if("undefined"!=typeof a.fireEvent)c(a,b)&&(a.checked=!0!==a.checked),a.fireEvent("on"+b);else throw Error("Browser doesn't support triggering events");},c:function(b){return a.T(b)?b():b},ya:function(b){return a.T(b)?b.t():b},ga:function(b,e,c){if(e){var d=/\S+/g,g=b.className.match(d)||[];a.a.p(e.match(d),
function(b){a.a.ja(g,b,c)});b.className=g.join(" ")}},ib:function(b,e){var c=a.a.c(e);if(null===c||c===q)c="";var d=a.e.firstChild(b);!d||3!=d.nodeType||a.e.nextSibling(d)?a.e.P(b,[s.createTextNode(c)]):d.data=c;a.a.Bb(b)},gb:function(a,b){a.name=b;if(7>=e)try{a.mergeAttributes(s.createElement("<input name='"+a.name+"'/>"),!1)}catch(c){}},Bb:function(a){9<=e&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},zb:function(a){if(e){var b=a.style.width;a.style.width=0;a.style.width=
b}},Qb:function(b,e){b=a.a.c(b);e=a.a.c(e);for(var c=[],d=b;d<=e;d++)c.push(d);return c},N:function(a){for(var b=[],e=0,c=a.length;e<c;e++)b.push(a[e]);return b},Ub:6===e,Vb:7===e,ca:e,Ua:function(b,e){for(var c=a.a.N(b.getElementsByTagName("input")).concat(a.a.N(b.getElementsByTagName("textarea"))),d="string"==typeof e?function(a){return a.name===e}:function(a){return e.test(a.name)},g=[],f=c.length-1;0<=f;f--)d(c[f])&&g.push(c[f]);return g},Nb:function(b){return"string"==typeof b&&(b=a.a.F(b))?
y&&y.parse?y.parse(b):(new Function("return "+b))():null},Ca:function(b,e,c){if(!y||!y.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return y.stringify(a.a.c(b),e,c)},Ob:function(e,c,d){d=d||{};var g=d.params||{},f=d.includeFields||this.Ta,p=e;if("object"==typeof e&&"form"===a.a.u(e))for(var p=e.action,r=f.length-1;0<=r;r--)for(var z=
a.a.Ua(e,f[r]),D=z.length-1;0<=D;D--)g[z[D].name]=z[D].value;c=a.a.c(c);var q=s.createElement("form");q.style.display="none";q.action=p;q.method="post";for(var v in c)e=s.createElement("input"),e.name=v,e.value=a.a.Ca(a.a.c(c[v])),q.appendChild(e);b(g,function(a,b){var e=s.createElement("input");e.name=a;e.value=b;q.appendChild(e)});s.body.appendChild(q);d.submitter?d.submitter(q):q.submit();setTimeout(function(){q.parentNode.removeChild(q)},0)}}}();a.b("utils",a.a);a.b("utils.arrayForEach",a.a.p);
a.b("utils.arrayFirst",a.a.La);a.b("utils.arrayFilter",a.a.Y);a.b("utils.arrayGetDistinctValues",a.a.Ma);a.b("utils.arrayIndexOf",a.a.k);a.b("utils.arrayMap",a.a.Z);a.b("utils.arrayPushAll",a.a.R);a.b("utils.arrayRemoveItem",a.a.ka);a.b("utils.extend",a.a.extend);a.b("utils.fieldsIncludedWithJsonPost",a.a.Ta);a.b("utils.getFormFields",a.a.Ua);a.b("utils.peekObservable",a.a.ya);a.b("utils.postJson",a.a.Ob);a.b("utils.parseJson",a.a.Nb);a.b("utils.registerEventHandler",a.a.o);a.b("utils.stringifyJson",
a.a.Ca);a.b("utils.range",a.a.Qb);a.b("utils.toggleDomNodeCssClass",a.a.ga);a.b("utils.triggerEvent",a.a.Ga);a.b("utils.unwrapObservable",a.a.c);a.b("utils.objectForEach",a.a.w);a.b("utils.addOrRemoveItem",a.a.ja);a.b("unwrap",a.a.c);Function.prototype.bind||(Function.prototype.bind=function(a){var c=this,d=Array.prototype.slice.call(arguments);a=d.shift();return function(){return c.apply(a,d.concat(Array.prototype.slice.call(arguments)))}});a.a.f=new function(){var b=0,c="__ko__"+(new Date).getTime(),
d={};return{get:function(b,c){var e=a.a.f.pa(b,!1);return e===q?q:e[c]},set:function(b,c,e){if(e!==q||a.a.f.pa(b,!1)!==q)a.a.f.pa(b,!0)[c]=e},pa:function(a,g){var e=a[c];if(!e||"null"===e||!d[e]){if(!g)return q;e=a[c]="ko"+b++;d[e]={}}return d[e]},clear:function(a){var b=a[c];return b?(delete d[b],a[c]=null,!0):!1}}};a.b("utils.domData",a.a.f);a.b("utils.domData.clear",a.a.f.clear);a.a.C=new function(){function b(b,c){var g=a.a.f.get(b,d);g===q&&c&&(g=[],a.a.f.set(b,d,g));return g}function c(e){var d=
b(e,!1);if(d)for(var d=d.slice(0),f=0;f<d.length;f++)d[f](e);a.a.f.clear(e);"function"==typeof t&&"function"==typeof t.cleanData&&t.cleanData([e]);if(g[e.nodeType])for(d=e.firstChild;e=d;)d=e.nextSibling,8===e.nodeType&&c(e)}var d="__ko_domNodeDisposal__"+(new Date).getTime(),f={1:!0,8:!0,9:!0},g={1:!0,9:!0};return{ia:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b(a,!0).push(c)},cb:function(e,c){var g=b(e,!1);g&&(a.a.ka(g,c),0==g.length&&a.a.f.set(e,d,q))},H:function(b){if(f[b.nodeType]&&
(c(b),g[b.nodeType])){var d=[];a.a.R(d,b.getElementsByTagName("*"));for(var h=0,k=d.length;h<k;h++)c(d[h])}return b},removeNode:function(b){a.H(b);b.parentNode&&b.parentNode.removeChild(b)}}};a.H=a.a.C.H;a.removeNode=a.a.C.removeNode;a.b("cleanNode",a.H);a.b("removeNode",a.removeNode);a.b("utils.domNodeDisposal",a.a.C);a.b("utils.domNodeDisposal.addDisposeCallback",a.a.C.ia);a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.C.cb);(function(){a.a.xa=function(b){var c;if("undefined"!=typeof t)if(t.parseHTML)c=
t.parseHTML(b)||[];else{if((c=t.clean([b]))&&c[0]){for(b=c[0];b.parentNode&&11!==b.parentNode.nodeType;)b=b.parentNode;b.parentNode&&b.parentNode.removeChild(b)}}else{var d=a.a.F(b).toLowerCase();c=s.createElement("div");d=d.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!d.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!d.indexOf("<td")||!d.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""];b="ignored<div>"+d[1]+b+d[2]+"</div>";for("function"==typeof w.innerShiv?
c.appendChild(w.innerShiv(b)):c.innerHTML=b;d[0]--;)c=c.lastChild;c=a.a.N(c.lastChild.childNodes)}return c};a.a.fa=function(b,c){a.a.oa(b);c=a.a.c(c);if(null!==c&&c!==q)if("string"!=typeof c&&(c=c.toString()),"undefined"!=typeof t)t(b).html(c);else for(var d=a.a.xa(c),f=0;f<d.length;f++)b.appendChild(d[f])}})();a.b("utils.parseHtmlFragment",a.a.xa);a.b("utils.setHtml",a.a.fa);a.s=function(){function b(c,f){if(c)if(8==c.nodeType){var g=a.s.$a(c.nodeValue);null!=g&&f.push({xb:c,Kb:g})}else if(1==c.nodeType)for(var g=
0,e=c.childNodes,m=e.length;g<m;g++)b(e[g],f)}var c={};return{va:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);c[b]=a;return"\x3c!--[ko_memo:"+b+"]--\x3e"},mb:function(a,b){var g=c[a];if(g===q)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return g.apply(null,b||[]),
!0}finally{delete c[a]}},nb:function(c,f){var g=[];b(c,g);for(var e=0,m=g.length;e<m;e++){var h=g[e].xb,k=[h];f&&a.a.R(k,f);a.s.mb(g[e].Kb,k);h.nodeValue="";h.parentNode&&h.parentNode.removeChild(h)}},$a:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}();a.b("memoization",a.s);a.b("memoization.memoize",a.s.va);a.b("memoization.unmemoize",a.s.mb);a.b("memoization.parseMemoText",a.s.$a);a.b("memoization.unmemoizeDomNodeAndDescendants",a.s.nb);a.Sa={throttle:function(b,c){b.throttleEvaluation=
c;var d=null;return a.j({read:b,write:function(a){clearTimeout(d);d=setTimeout(function(){b(a)},c)}})},notify:function(b,c){b.equalityComparer="always"==c?F(!1):a.m.fn.equalityComparer;return b}};a.b("extenders",a.Sa);a.kb=function(b,c,d){this.target=b;this.la=c;this.wb=d;a.r(this,"dispose",this.B)};a.kb.prototype.B=function(){this.Hb=!0;this.wb()};a.V=function(){this.G={};a.a.extend(this,a.V.fn);a.r(this,"subscribe",this.Da);a.r(this,"extend",this.extend);a.r(this,"getSubscriptionsCount",this.Db)};
a.V.fn={Da:function(b,c,d){d=d||"change";var f=new a.kb(this,c?b.bind(c):b,function(){a.a.ka(this.G[d],f)}.bind(this));this.G[d]||(this.G[d]=[]);this.G[d].push(f);return f},notifySubscribers:function(b,c){c=c||"change";this.G[c]&&a.q.I(function(){a.a.p(this.G[c].slice(0),function(a){a&&!0!==a.Hb&&a.la(b)})},this)},Db:function(){var b=0;a.a.w(this.G,function(a,d){b+=d.length});return b},extend:function(b){var c=this;b&&a.a.w(b,function(b,f){var g=a.Sa[b];"function"==typeof g&&(c=g(c,f))});return c}};
a.Wa=function(a){return null!=a&&"function"==typeof a.Da&&"function"==typeof a.notifySubscribers};a.b("subscribable",a.V);a.b("isSubscribable",a.Wa);a.q=function(){var b=[];return{rb:function(a){b.push({la:a,Ra:[]})},end:function(){b.pop()},bb:function(c){if(!a.Wa(c))throw Error("Only subscribable things can act as dependencies");if(0<b.length){var d=b[b.length-1];!d||0<=a.a.k(d.Ra,c)||(d.Ra.push(c),d.la(c))}},I:function(a,d,f){try{return b.push(null),a.apply(d,f||[])}finally{b.pop()}}}}();var L=
{undefined:!0,"boolean":!0,number:!0,string:!0};a.m=function(b){function c(){if(0<arguments.length)return c.equalityComparer&&c.equalityComparer(d,arguments[0])||(c.K(),d=arguments[0],c.J()),this;a.q.bb(c);return d}var d=b;a.V.call(c);c.t=function(){return d};c.J=function(){c.notifySubscribers(d)};c.K=function(){c.notifySubscribers(d,"beforeChange")};a.a.extend(c,a.m.fn);a.r(c,"peek",c.t);a.r(c,"valueHasMutated",c.J);a.r(c,"valueWillMutate",c.K);return c};a.m.fn={equalityComparer:function(a,c){return null===
a||typeof a in L?a===c:!1}};var A=a.m.Pb="__ko_proto__";a.m.fn[A]=a.m;a.qa=function(b,c){return null===b||b===q||b[A]===q?!1:b[A]===c?!0:a.qa(b[A],c)};a.T=function(b){return a.qa(b,a.m)};a.Xa=function(b){return"function"==typeof b&&b[A]===a.m||"function"==typeof b&&b[A]===a.j&&b.Eb?!0:!1};a.b("observable",a.m);a.b("isObservable",a.T);a.b("isWriteableObservable",a.Xa);a.U=function(b){b=b||[];if("object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");
b=a.m(b);a.a.extend(b,a.U.fn);return b};a.U.fn={remove:function(a){for(var c=this.t(),d=[],f="function"==typeof a?a:function(e){return e===a},g=0;g<c.length;g++){var e=c[g];f(e)&&(0===d.length&&this.K(),d.push(e),c.splice(g,1),g--)}d.length&&this.J();return d},removeAll:function(b){if(b===q){var c=this.t(),d=c.slice(0);this.K();c.splice(0,c.length);this.J();return d}return b?this.remove(function(c){return 0<=a.a.k(b,c)}):[]},destroy:function(a){var c=this.t(),d="function"==typeof a?a:function(c){return c===
a};this.K();for(var f=c.length-1;0<=f;f--)d(c[f])&&(c[f]._destroy=!0);this.J()},destroyAll:function(b){return b===q?this.destroy(F(!0)):b?this.destroy(function(c){return 0<=a.a.k(b,c)}):[]},indexOf:function(b){var c=this();return a.a.k(c,b)},replace:function(a,c){var d=this.indexOf(a);0<=d&&(this.K(),this.t()[d]=c,this.J())}};a.a.p("pop push reverse shift sort splice unshift".split(" "),function(b){a.U.fn[b]=function(){var a=this.t();this.K();a=a[b].apply(a,arguments);this.J();return a}});a.a.p(["slice"],
function(b){a.U.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}});a.b("observableArray",a.U);a.j=function(b,c,d){function f(){a.a.p(v,function(a){a.B()});v=[]}function g(){var a=m.throttleEvaluation;a&&0<=a?(clearTimeout(t),t=setTimeout(e,a)):e()}function e(){if(!n)if(l&&D())x();else{n=!0;try{var b=a.a.Z(v,function(a){return a.target});a.q.rb(function(e){var c;0<=(c=a.a.k(b,e))?b[c]=q:v.push(e.Da(g))});for(var e=p.call(c),d=b.length-1;0<=d;d--)b[d]&&v.splice(d,1)[0].B();l=!0;m.notifySubscribers(k,
"beforeChange");k=e;m.notifySubscribers(k)}finally{a.q.end(),n=!1}v.length||x()}}function m(){if(0<arguments.length){if("function"===typeof r)r.apply(c,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}l||e();a.q.bb(m);return k}function h(){return!l||0<v.length}var k,l=!1,n=!1,p=b;p&&"object"==typeof p?(d=p,p=d.read):(d=d||{},p||(p=d.read));if("function"!=typeof p)throw Error("Pass a function that returns the value of the ko.computed");
var r=d.write,z=d.disposeWhenNodeIsRemoved||d.$||null,D=d.disposeWhen||d.Qa||F(!1),x=f,v=[],t=null;c||(c=d.owner);m.t=function(){l||e();return k};m.Cb=function(){return v.length};m.Eb="function"===typeof d.write;m.B=function(){x()};m.ta=h;a.V.call(m);a.a.extend(m,a.j.fn);a.r(m,"peek",m.t);a.r(m,"dispose",m.B);a.r(m,"isActive",m.ta);a.r(m,"getDependenciesCount",m.Cb);!0!==d.deferEvaluation&&e();if(z&&h()){x=function(){a.a.C.cb(z,x);f()};a.a.C.ia(z,x);var s=D,D=function(){return!a.a.aa(z)||s()}}return m};
a.Gb=function(b){return a.qa(b,a.j)};C=a.m.Pb;a.j[C]=a.m;a.j.fn={};a.j.fn[C]=a.j;a.b("dependentObservable",a.j);a.b("computed",a.j);a.b("isComputed",a.Gb);(function(){function b(a,g,e){e=e||new d;a=g(a);if("object"!=typeof a||null===a||a===q||a instanceof Date||a instanceof String||a instanceof Number||a instanceof Boolean)return a;var m=a instanceof Array?[]:{};e.save(a,m);c(a,function(c){var d=g(a[c]);switch(typeof d){case "boolean":case "number":case "string":case "function":m[c]=d;break;case "object":case "undefined":var l=
e.get(d);m[c]=l!==q?l:b(d,g,e)}});return m}function c(a,b){if(a instanceof Array){for(var e=0;e<a.length;e++)b(e);"function"==typeof a.toJSON&&b("toJSON")}else for(e in a)b(e)}function d(){this.keys=[];this.Ha=[]}a.lb=function(c){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return b(c,function(b){for(var e=0;a.T(b)&&10>e;e++)b=b();return b})};a.toJSON=function(b,c,e){b=a.lb(b);return a.a.Ca(b,c,e)};d.prototype={save:function(b,c){var e=a.a.k(this.keys,
b);0<=e?this.Ha[e]=c:(this.keys.push(b),this.Ha.push(c))},get:function(b){b=a.a.k(this.keys,b);return 0<=b?this.Ha[b]:q}}})();a.b("toJS",a.lb);a.b("toJSON",a.toJSON);(function(){a.h={n:function(b){switch(a.a.u(b)){case "option":return!0===b.__ko__hasDomDataOptionValue__?a.a.f.get(b,a.d.options.wa):7>=a.a.ca?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case "select":return 0<=b.selectedIndex?a.h.n(b.options[b.selectedIndex]):q;default:return b.value}},W:function(b,
c){switch(a.a.u(b)){case "option":switch(typeof c){case "string":a.a.f.set(b,a.d.options.wa,q);"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__;b.value=c;break;default:a.a.f.set(b,a.d.options.wa,c),b.__ko__hasDomDataOptionValue__=!0,b.value="number"===typeof c?c:""}break;case "select":""===c&&(c=q);if(null===c||c===q)b.selectedIndex=-1;for(var d=b.options.length-1;0<=d;d--)if(a.h.n(b.options[d])==c){b.selectedIndex=d;break}1<b.size||-1!==b.selectedIndex||(b.selectedIndex=
0);break;default:if(null===c||c===q)c="";b.value=c}}}})();a.b("selectExtensions",a.h);a.b("selectExtensions.readValue",a.h.n);a.b("selectExtensions.writeValue",a.h.W);a.g=function(){function b(a,b){for(var d=null;a!=d;)d=a,a=a.replace(c,function(a,c){return b[c]});return a}var c=/\@ko_token_(\d+)\@/g,d=["true","false","null","undefined"],f=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{S:[],da:function(c){var e=a.a.F(c);if(3>e.length)return[];"{"===e.charAt(0)&&(e=e.substring(1,e.length-
1));c=[];for(var d=null,f,k=0;k<e.length;k++){var l=e.charAt(k);if(null===d)switch(l){case '"':case "'":case "/":d=k,f=l}else if(l==f&&"\\"!==e.charAt(k-1)){l=e.substring(d,k+1);c.push(l);var n="@ko_token_"+(c.length-1)+"@",e=e.substring(0,d)+n+e.substring(k+1),k=k-(l.length-n.length),d=null}}f=d=null;for(var p=0,r=null,k=0;k<e.length;k++){l=e.charAt(k);if(null===d)switch(l){case "{":d=k;r=l;f="}";break;case "(":d=k;r=l;f=")";break;case "[":d=k,r=l,f="]"}l===r?p++:l===f&&(p--,0===p&&(l=e.substring(d,
k+1),c.push(l),n="@ko_token_"+(c.length-1)+"@",e=e.substring(0,d)+n+e.substring(k+1),k-=l.length-n.length,d=null))}f=[];e=e.split(",");d=0;for(k=e.length;d<k;d++)p=e[d],r=p.indexOf(":"),0<r&&r<p.length-1?(l=p.substring(r+1),f.push({key:b(p.substring(0,r),c),value:b(l,c)})):f.push({unknown:b(p,c)});return f},ea:function(b){var e="string"===typeof b?a.g.da(b):b,c=[];b=[];for(var h,k=0;h=e[k];k++)if(0<c.length&&c.push(","),h.key){var l;a:{l=h.key;var n=a.a.F(l);switch(n.length&&n.charAt(0)){case "'":case '"':break a;
default:l="'"+n+"'"}}h=h.value;c.push(l);c.push(":");c.push(h);h=a.a.F(h);0<=a.a.k(d,a.a.F(h).toLowerCase())?h=!1:(n=h.match(f),h=null===n?!1:n[1]?"Object("+n[1]+")"+n[2]:h);h&&(0<b.length&&b.push(", "),b.push(l+" : function(__ko_value) { "+h+" = __ko_value; }"))}else h.unknown&&c.push(h.unknown);e=c.join("");0<b.length&&(e=e+", '_ko_property_writers' : { "+b.join("")+" } ");return e},Jb:function(b,c){for(var d=0;d<b.length;d++)if(a.a.F(b[d].key)==c)return!0;return!1},ha:function(b,c,d,f,k){if(b&&
a.T(b))!a.Xa(b)||k&&b.t()===f||b(f);else if((b=c()._ko_property_writers)&&b[d])b[d](f)}}}();a.b("expressionRewriting",a.g);a.b("expressionRewriting.bindingRewriteValidators",a.g.S);a.b("expressionRewriting.parseObjectLiteral",a.g.da);a.b("expressionRewriting.preProcessBindings",a.g.ea);a.b("jsonExpressionRewriting",a.g);a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.g.ea);(function(){function b(a){return 8==a.nodeType&&(g?a.text:a.nodeValue).match(e)}function c(a){return 8==a.nodeType&&
(g?a.text:a.nodeValue).match(m)}function d(a,e){for(var d=a,g=1,f=[];d=d.nextSibling;){if(c(d)&&(g--,0===g))return f;f.push(d);b(d)&&g++}if(!e)throw Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function f(a,b){var c=d(a,b);return c?0<c.length?c[c.length-1].nextSibling:a.nextSibling:null}var g=s&&"\x3c!--test--\x3e"===s.createComment("test").text,e=g?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,m=g?/^\x3c!--\s*\/ko\s*--\x3e$/:
/^\s*\/ko\s*$/,h={ul:!0,ol:!0};a.e={L:{},childNodes:function(a){return b(a)?d(a):a.childNodes},ba:function(c){if(b(c)){c=a.e.childNodes(c);for(var e=0,d=c.length;e<d;e++)a.removeNode(c[e])}else a.a.oa(c)},P:function(c,e){if(b(c)){a.e.ba(c);for(var d=c.nextSibling,g=0,f=e.length;g<f;g++)d.parentNode.insertBefore(e[g],d)}else a.a.P(c,e)},ab:function(a,c){b(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},Va:function(c,e,d){d?b(c)?c.parentNode.insertBefore(e,
d.nextSibling):d.nextSibling?c.insertBefore(e,d.nextSibling):c.appendChild(e):a.e.ab(c,e)},firstChild:function(a){return b(a)?!a.nextSibling||c(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){b(a)&&(a=f(a));return a.nextSibling&&c(a.nextSibling)?null:a.nextSibling},ob:function(a){return(a=b(a))?a[1]:null},Za:function(e){if(h[a.a.u(e)]){var d=e.firstChild;if(d){do if(1===d.nodeType){var g;g=d.firstChild;var m=null;if(g){do if(m)m.push(g);else if(b(g)){var r=f(g,!0);r?g=r:m=
[g]}else c(g)&&(m=[g]);while(g=g.nextSibling)}if(g=m)for(m=d.nextSibling,r=0;r<g.length;r++)m?e.insertBefore(g[r],m):e.appendChild(g[r])}while(d=d.nextSibling)}}}}})();a.b("virtualElements",a.e);a.b("virtualElements.allowedBindings",a.e.L);a.b("virtualElements.emptyNode",a.e.ba);a.b("virtualElements.insertAfter",a.e.Va);a.b("virtualElements.prepend",a.e.ab);a.b("virtualElements.setDomNodeChildren",a.e.P);(function(){a.M=function(){this.Na={}};a.a.extend(a.M.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=
b.getAttribute("data-bind");case 8:return null!=a.e.ob(b);default:return!1}},getBindings:function(a,c){var d=this.getBindingsString(a,c);return d?this.parseBindingsString(d,c,a):null},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.e.ob(b);default:return null}},parseBindingsString:function(b,c,d){try{var f;if(!(f=this.Na[b])){var g=this.Na,e,m="with($context){with($data||{}){return{"+a.g.ea(b)+"}}}";e=new Function("$context","$element",m);
f=g[b]=e}return f(c,d)}catch(h){throw h.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+h.message,h;}}});a.M.instance=new a.M})();a.b("bindingProvider",a.M);(function(){function b(b,e,d){for(var f=a.e.firstChild(e);e=f;)f=a.e.nextSibling(e),c(b,e,d)}function c(c,e,f){var h=!0,k=1===e.nodeType;k&&a.e.Za(e);if(k&&f||a.M.instance.nodeHasBindings(e))h=d(e,null,c,f).Sb;h&&b(c,e,!k)}function d(b,c,d,h){function k(a){return function(){return p[a]}}function l(){return p}var n=0,p,r,
z=a.a.f.get(b,f);if(!c){if(z)throw Error("You cannot apply bindings multiple times to the same element.");a.a.f.set(b,f,!0)}a.j(function(){var f=d&&d instanceof a.A?d:new a.A(a.a.c(d)),x=f.$data;!z&&h&&a.jb(b,f);if(p=("function"==typeof c?c(f,b):c)||a.M.instance.getBindings(b,f))0===n&&(n=1,a.a.w(p,function(c){var e=a.d[c];if(e&&8===b.nodeType&&!a.e.L[c])throw Error("The binding '"+c+"' cannot be used with virtual elements");if(e&&"function"==typeof e.init&&(e=(0,e.init)(b,k(c),l,x,f))&&e.controlsDescendantBindings){if(r!==
q)throw Error("Multiple bindings ("+r+" and "+c+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");r=c}}),n=2),2===n&&a.a.w(p,function(c){var e=a.d[c];e&&"function"==typeof e.update&&(0,e.update)(b,k(c),l,x,f)})},null,{$:b});return{Sb:r===q}}a.d={};a.A=function(b,c,d){c?(a.a.extend(this,c),this.$parentContext=c,this.$parent=c.$data,this.$parents=(c.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=
[],this.$root=b,this.ko=a);this.$data=b;d&&(this[d]=b)};a.A.prototype.createChildContext=function(b,c){return new a.A(b,this,c)};a.A.prototype.extend=function(b){var c=a.a.extend(new a.A,this);return a.a.extend(c,b)};var f="__ko_boundElement";a.jb=function(b,c){if(2==arguments.length)a.a.f.set(b,"__ko_bindingContext__",c);else return a.a.f.get(b,"__ko_bindingContext__")};a.Ka=function(b,c,f){1===b.nodeType&&a.e.Za(b);return d(b,c,f,!0)};a.Ja=function(a,c){1!==c.nodeType&&8!==c.nodeType||b(a,c,!0)};
a.Ia=function(a,b){if(b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||w.document.body;c(a,b,!0)};a.na=function(b){switch(b.nodeType){case 1:case 8:var c=a.jb(b);if(c)return c;if(b.parentNode)return a.na(b.parentNode)}return q};a.ub=function(b){return(b=a.na(b))?b.$data:q};a.b("bindingHandlers",a.d);a.b("applyBindings",a.Ia);a.b("applyBindingsToDescendants",a.Ja);a.b("applyBindingsToNode",a.Ka);
a.b("contextFor",a.na);a.b("dataFor",a.ub)})();var K={"class":"className","for":"htmlFor"};a.d.attr={update:function(b,c){var d=a.a.c(c())||{};a.a.w(d,function(c,d){d=a.a.c(d);var e=!1===d||null===d||d===q;e&&b.removeAttribute(c);8>=a.a.ca&&c in K?(c=K[c],e?b.removeAttribute(c):b[c]=d):e||b.setAttribute(c,d.toString());"name"===c&&a.a.gb(b,e?"":d.toString())})}};a.d.checked={init:function(b,c,d){a.a.o(b,"click",function(){var f;if("checkbox"==b.type)f=b.checked;else if("radio"==b.type&&b.checked)f=
b.value;else return;var g=c(),e=a.a.c(g);"checkbox"==b.type&&e instanceof Array?a.a.ja(g,b.value,b.checked):a.g.ha(g,d,"checked",f,!0)});"radio"!=b.type||b.name||a.d.uniqueName.init(b,F(!0))},update:function(b,c){var d=a.a.c(c());"checkbox"==b.type?b.checked=d instanceof Array?0<=a.a.k(d,b.value):d:"radio"==b.type&&(b.checked=b.value==d)}};a.d.css={update:function(b,c){var d=a.a.c(c());"object"==typeof d?a.a.w(d,function(c,d){d=a.a.c(d);a.a.ga(b,c,d)}):(d=String(d||""),a.a.ga(b,b.__ko__cssValue,!1),
b.__ko__cssValue=d,a.a.ga(b,d,!0))}};a.d.enable={update:function(b,c){var d=a.a.c(c());d&&b.disabled?b.removeAttribute("disabled"):d||b.disabled||(b.disabled=!0)}};a.d.disable={update:function(b,c){a.d.enable.update(b,function(){return!a.a.c(c())})}};a.d.event={init:function(b,c,d,f){var g=c()||{};a.a.w(g,function(e){"string"==typeof e&&a.a.o(b,e,function(b){var g,k=c()[e];if(k){var l=d();try{var n=a.a.N(arguments);n.unshift(f);g=k.apply(f,n)}finally{!0!==g&&(b.preventDefault?b.preventDefault():b.returnValue=
!1)}!1===l[e+"Bubble"]&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}};a.d.foreach={Ya:function(b){return function(){var c=b(),d=a.a.ya(c);if(!d||"number"==typeof d.length)return{foreach:c,templateEngine:a.D.sa};a.a.c(c);return{foreach:d.data,as:d.as,includeDestroyed:d.includeDestroyed,afterAdd:d.afterAdd,beforeRemove:d.beforeRemove,afterRender:d.afterRender,beforeMove:d.beforeMove,afterMove:d.afterMove,templateEngine:a.D.sa}}},init:function(b,c){return a.d.template.init(b,a.d.foreach.Ya(c))},
update:function(b,c,d,f,g){return a.d.template.update(b,a.d.foreach.Ya(c),d,f,g)}};a.g.S.foreach=!1;a.e.L.foreach=!0;a.d.hasfocus={init:function(b,c,d){function f(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(l){g=f.body}e=g===b}f=c();a.g.ha(f,d,"hasfocus",e,!0);b.__ko_hasfocusLastValue=e;b.__ko_hasfocusUpdating=!1}var g=f.bind(null,!0),e=f.bind(null,!1);a.a.o(b,"focus",g);a.a.o(b,"focusin",g);a.a.o(b,"blur",e);a.a.o(b,"focusout",e)},
update:function(b,c){var d=!!a.a.c(c());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===d||(d?b.focus():b.blur(),a.q.I(a.a.Ga,null,[b,d?"focusin":"focusout"]))}};a.d.hasFocus=a.d.hasfocus;a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.fa(b,c())}};var I="__ko_withIfBindingData";G("if");G("ifnot",!1,!0);G("with",!0,!1,function(a,c){return a.createChildContext(c)});a.d.options={init:function(b){if("select"!==a.a.u(b))throw Error("options binding applies only to SELECT elements");
for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b,c,d){function f(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function g(b,c){if(p){var d=0<=a.a.k(p,a.h.n(c[0]));a.a.hb(c[0],d)}}var e=0==b.length,m=!e&&b.multiple?b.scrollTop:null;c=a.a.c(c());var h=d(),k=h.optionsIncludeDestroyed,l={},n,p;b.multiple?p=a.a.Z(b.selectedOptions||a.a.Y(b.childNodes,function(b){return b.tagName&&"option"===a.a.u(b)&&b.selected}),function(b){return a.h.n(b)}):0<=
b.selectedIndex&&(p=[a.h.n(b.options[b.selectedIndex])]);if(c){"undefined"==typeof c.length&&(c=[c]);var r=a.a.Y(c,function(b){return k||b===q||null===b||!a.a.c(b._destroy)});"optionsCaption"in h&&(n=a.a.c(h.optionsCaption),null!==n&&n!==q&&r.unshift(l))}else c=[];d=g;h.optionsAfterRender&&(d=function(b,c){g(0,c);a.q.I(h.optionsAfterRender,null,[c[0],b!==l?b:q])});a.a.Aa(b,r,function(b,c,d){d.length&&(p=d[0].selected&&[a.h.n(d[0])]);c=s.createElement("option");b===l?(a.a.fa(c,n),a.h.W(c,q)):(d=f(b,
h.optionsValue,b),a.h.W(c,a.a.c(d)),b=f(b,h.optionsText,d),a.a.ib(c,b));return[c]},null,d);p=null;e&&"value"in h&&J(b,a.a.ya(h.value),!0);a.a.zb(b);m&&20<Math.abs(m-b.scrollTop)&&(b.scrollTop=m)}};a.d.options.wa="__ko.optionValueDomData__";a.d.selectedOptions={init:function(b,c,d){a.a.o(b,"change",function(){var f=c(),g=[];a.a.p(b.getElementsByTagName("option"),function(b){b.selected&&g.push(a.h.n(b))});a.g.ha(f,d,"selectedOptions",g)})},update:function(b,c){if("select"!=a.a.u(b))throw Error("values binding applies only to SELECT elements");
var d=a.a.c(c());d&&"number"==typeof d.length&&a.a.p(b.getElementsByTagName("option"),function(b){var c=0<=a.a.k(d,a.h.n(b));a.a.hb(b,c)})}};a.d.style={update:function(b,c){var d=a.a.c(c()||{});a.a.w(d,function(c,d){d=a.a.c(d);b.style[c]=d||""})}};a.d.submit={init:function(b,c,d,f){if("function"!=typeof c())throw Error("The value for a submit binding must be a function");a.a.o(b,"submit",function(a){var d,m=c();try{d=m.call(f,b)}finally{!0!==d&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}};
a.d.text={update:function(b,c){a.a.ib(b,c())}};a.e.L.text=!0;a.d.uniqueName={init:function(b,c){if(c()){var d="ko_unique_"+ ++a.d.uniqueName.tb;a.a.gb(b,d)}}};a.d.uniqueName.tb=0;a.d.value={init:function(b,c,d){function f(){m=!1;var e=c(),f=a.h.n(b);a.g.ha(e,d,"value",f)}var g=["change"],e=d().valueUpdate,m=!1;e&&("string"==typeof e&&(e=[e]),a.a.R(g,e),g=a.a.Ma(g));!a.a.ca||("input"!=b.tagName.toLowerCase()||"text"!=b.type||"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete)||-1!=a.a.k(g,"propertychange")||
(a.a.o(b,"propertychange",function(){m=!0}),a.a.o(b,"blur",function(){m&&f()}));a.a.p(g,function(c){var d=f;a.a.Tb(c,"after")&&(d=function(){setTimeout(f,0)},c=c.substring(5));a.a.o(b,c,d)})},update:function(b,c){var d="select"===a.a.u(b),f=a.a.c(c()),g=a.h.n(b);f!==g&&(g=function(){a.h.W(b,f)},g(),d&&setTimeout(g,0));d&&0<b.length&&J(b,f,!1)}};a.d.visible={update:function(b,c){var d=a.a.c(c()),f="none"!=b.style.display;d&&!f?b.style.display="":!d&&f&&(b.style.display="none")}};(function(b){a.d[b]=
{init:function(c,d,f,g){return a.d.event.init.call(this,c,function(){var a={};a[b]=d();return a},f,g)}}})("click");a.v=function(){};a.v.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource");};a.v.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock");};a.v.prototype.makeTemplateSource=function(b,c){if("string"==typeof b){c=c||s;var d=c.getElementById(b);if(!d)throw Error("Cannot find template with ID "+b);return new a.l.i(d)}if(1==
b.nodeType||8==b.nodeType)return new a.l.Q(b);throw Error("Unknown template type: "+b);};a.v.prototype.renderTemplate=function(a,c,d,f){a=this.makeTemplateSource(a,f);return this.renderTemplateSource(a,c,d)};a.v.prototype.isTemplateRewritten=function(a,c){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,c).data("isRewritten")};a.v.prototype.rewriteTemplate=function(a,c,d){a=this.makeTemplateSource(a,d);c=c(a.text());a.text(c);a.data("isRewritten",!0)};a.b("templateEngine",a.v);
a.Ea=function(){function b(b,c,d,m){b=a.g.da(b);for(var h=a.g.S,k=0;k<b.length;k++){var l=b[k].key;if(h.hasOwnProperty(l)){var n=h[l];if("function"===typeof n){if(l=n(b[k].value))throw Error(l);}else if(!n)throw Error("This template engine does not support the '"+l+"' binding within its templates");}}d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.g.ea(b)+" } })()},'"+d.toLowerCase()+"')";return m.createJavaScriptEvaluatorBlock(d)+c}var c=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,
d=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Ab:function(b,c,d){c.isTemplateRewritten(b,d)||c.rewriteTemplate(b,function(b){return a.Ea.Lb(b,c)},d)},Lb:function(a,g){return a.replace(c,function(a,c,d,f,l){return b(l,c,d,g)}).replace(d,function(a,c){return b(c,"\x3c!-- ko --\x3e","#comment",g)})},qb:function(b,c){return a.s.va(function(d,m){var h=d.nextSibling;h&&h.nodeName.toLowerCase()===c&&a.Ka(h,b,m)})}}}();a.b("__tr_ambtns",a.Ea.qb);(function(){a.l={};a.l.i=function(a){this.i=a};a.l.i.prototype.text=
function(){var b=a.a.u(this.i),b="script"===b?"text":"textarea"===b?"value":"innerHTML";if(0==arguments.length)return this.i[b];var c=arguments[0];"innerHTML"===b?a.a.fa(this.i,c):this.i[b]=c};a.l.i.prototype.data=function(b){if(1===arguments.length)return a.a.f.get(this.i,"templateSourceData_"+b);a.a.f.set(this.i,"templateSourceData_"+b,arguments[1])};a.l.Q=function(a){this.i=a};a.l.Q.prototype=new a.l.i;a.l.Q.prototype.text=function(){if(0==arguments.length){var b=a.a.f.get(this.i,"__ko_anon_template__")||
{};b.Fa===q&&b.ma&&(b.Fa=b.ma.innerHTML);return b.Fa}a.a.f.set(this.i,"__ko_anon_template__",{Fa:arguments[0]})};a.l.i.prototype.nodes=function(){if(0==arguments.length)return(a.a.f.get(this.i,"__ko_anon_template__")||{}).ma;a.a.f.set(this.i,"__ko_anon_template__",{ma:arguments[0]})};a.b("templateSources",a.l);a.b("templateSources.domElement",a.l.i);a.b("templateSources.anonymousTemplate",a.l.Q)})();(function(){function b(b,c,d){var f;for(c=a.e.nextSibling(c);b&&(f=b)!==c;)b=a.e.nextSibling(f),1!==
f.nodeType&&8!==f.nodeType||d(f)}function c(c,d){if(c.length){var f=c[0],g=c[c.length-1];b(f,g,function(b){a.Ia(d,b)});b(f,g,function(b){a.s.nb(b,[d])})}}function d(a){return a.nodeType?a:0<a.length?a[0]:null}function f(b,f,h,k,l){l=l||{};var n=b&&d(b),n=n&&n.ownerDocument,p=l.templateEngine||g;a.Ea.Ab(h,p,n);h=p.renderTemplate(h,k,l,n);if("number"!=typeof h.length||0<h.length&&"number"!=typeof h[0].nodeType)throw Error("Template engine must return an array of DOM nodes");n=!1;switch(f){case "replaceChildren":a.e.P(b,
h);n=!0;break;case "replaceNode":a.a.eb(b,h);n=!0;break;case "ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+f);}n&&(c(h,k),l.afterRender&&a.q.I(l.afterRender,null,[h,k.$data]));return h}var g;a.Ba=function(b){if(b!=q&&!(b instanceof a.v))throw Error("templateEngine must inherit from ko.templateEngine");g=b};a.za=function(b,c,h,k,l){h=h||{};if((h.templateEngine||g)==q)throw Error("Set a template engine before calling renderTemplate");l=l||"replaceChildren";if(k){var n=d(k);return a.j(function(){var g=
c&&c instanceof a.A?c:new a.A(a.a.c(c)),r="function"==typeof b?b(g.$data,g):b,g=f(k,l,r,g,h);"replaceNode"==l&&(k=g,n=d(k))},null,{Qa:function(){return!n||!a.a.aa(n)},$:n&&"replaceNode"==l?n.parentNode:n})}return a.s.va(function(d){a.za(b,c,h,d,"replaceNode")})};a.Rb=function(b,d,g,k,l){function n(a,b){c(b,r);g.afterRender&&g.afterRender(b,a)}function p(c,d){r=l.createChildContext(a.a.c(c),g.as);r.$index=d;var k="function"==typeof b?b(c,r):b;return f(null,"ignoreTargetNode",k,r,g)}var r;return a.j(function(){var b=
a.a.c(d)||[];"undefined"==typeof b.length&&(b=[b]);b=a.a.Y(b,function(b){return g.includeDestroyed||b===q||null===b||!a.a.c(b._destroy)});a.q.I(a.a.Aa,null,[k,b,p,g,n])},null,{$:k})};a.d.template={init:function(b,c){var d=a.a.c(c());"string"==typeof d||(d.name||1!=b.nodeType&&8!=b.nodeType)||(d=1==b.nodeType?b.childNodes:a.e.childNodes(b),d=a.a.Mb(d),(new a.l.Q(b)).nodes(d));return{controlsDescendantBindings:!0}},update:function(b,c,d,f,g){c=a.a.c(c());d={};f=!0;var n,p=null;"string"!=typeof c&&(d=
c,c=a.a.c(d.name),"if"in d&&(f=a.a.c(d["if"])),f&&"ifnot"in d&&(f=!a.a.c(d.ifnot)),n=a.a.c(d.data));"foreach"in d?p=a.Rb(c||b,f&&d.foreach||[],d,b,g):f?(g="data"in d?g.createChildContext(n,d.as):g,p=a.za(c||b,g,d,b)):a.e.ba(b);g=p;(n=a.a.f.get(b,"__ko__templateComputedDomDataKey__"))&&"function"==typeof n.B&&n.B();a.a.f.set(b,"__ko__templateComputedDomDataKey__",g&&g.ta()?g:q)}};a.g.S.template=function(b){b=a.g.da(b);return 1==b.length&&b[0].unknown||a.g.Jb(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"};
a.e.L.template=!0})();a.b("setTemplateEngine",a.Ba);a.b("renderTemplate",a.za);a.a.Pa=function(){function a(b,d,f,g,e){var m=Math.min,h=Math.max,k=[],l,n=b.length,p,r=d.length,q=r-n||1,t=n+r+1,s,v,w;for(l=0;l<=n;l++)for(v=s,k.push(s=[]),w=m(r,l+q),p=h(0,l-1);p<=w;p++)s[p]=p?l?b[l-1]===d[p-1]?v[p-1]:m(v[p]||t,s[p-1]||t)+1:p+1:l+1;m=[];h=[];q=[];l=n;for(p=r;l||p;)r=k[l][p]-1,p&&r===k[l][p-1]?h.push(m[m.length]={status:f,value:d[--p],index:p}):l&&r===k[l-1][p]?q.push(m[m.length]={status:g,value:b[--l],
index:l}):(m.push({status:"retained",value:d[--p]}),--l);if(h.length&&q.length){b=10*n;var E;for(d=f=0;(e||d<b)&&(E=h[f]);f++){for(g=0;k=q[g];g++)if(E.value===k.value){E.moved=k.index;k.moved=E.index;q.splice(g,1);d=g=0;break}d+=g}}return m.reverse()}return function(c,d,f){c=c||[];d=d||[];return c.length<=d.length?a(c,d,"added","deleted",f):a(d,c,"deleted","added",f)}}();a.b("utils.compareArrays",a.a.Pa);(function(){function b(b){for(;b.length&&!a.a.aa(b[0]);)b.splice(0,1);if(1<b.length){for(var c=
b[0],g=b[b.length-1],e=[c];c!==g;){c=c.nextSibling;if(!c)return;e.push(c)}Array.prototype.splice.apply(b,[0,b.length].concat(e))}return b}function c(c,f,g,e,m){var h=[];c=a.j(function(){var c=f(g,m,b(h))||[];0<h.length&&(a.a.eb(h,c),e&&a.q.I(e,null,[g,c,m]));h.splice(0,h.length);a.a.R(h,c)},null,{$:c,Qa:function(){return!a.a.pb(h)}});return{O:h,j:c.ta()?c:q}}a.a.Aa=function(d,f,g,e,m){function h(a,c){u=n[c];x!==c&&(E[a]=u);u.ra(x++);b(u.O);t.push(u);w.push(u)}function k(b,c){if(b)for(var d=0,e=c.length;d<
e;d++)c[d]&&a.a.p(c[d].O,function(a){b(a,d,c[d].X)})}f=f||[];e=e||{};var l=a.a.f.get(d,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===q,n=a.a.f.get(d,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],p=a.a.Z(n,function(a){return a.X}),r=a.a.Pa(p,f,e.dontLimitMoves),t=[],s=0,x=0,v=[],w=[];f=[];for(var E=[],p=[],u,B=0,y,A;y=r[B];B++)switch(A=y.moved,y.status){case "deleted":A===q&&(u=n[s],u.j&&u.j.B(),v.push.apply(v,b(u.O)),e.beforeRemove&&(f[B]=u,w.push(u)));s++;break;case "retained":h(B,
s++);break;case "added":A!==q?h(B,A):(u={X:y.value,ra:a.m(x++)},t.push(u),w.push(u),l||(p[B]=u))}k(e.beforeMove,E);a.a.p(v,e.beforeRemove?a.H:a.removeNode);for(var B=0,l=a.e.firstChild(d),C;u=w[B];B++){u.O||a.a.extend(u,c(d,g,u.X,m,u.ra));for(s=0;r=u.O[s];l=r.nextSibling,C=r,s++)r!==l&&a.e.Va(d,r,C);!u.Fb&&m&&(m(u.X,u.O,u.ra),u.Fb=!0)}k(e.beforeRemove,f);k(e.afterMove,E);k(e.afterAdd,p);a.a.f.set(d,"setDomNodeChildrenFromArrayMapping_lastMappingResult",t)}})();a.b("utils.setDomNodeChildrenFromArrayMapping",
a.a.Aa);a.D=function(){this.allowTemplateRewriting=!1};a.D.prototype=new a.v;a.D.prototype.renderTemplateSource=function(b){var c=(9>a.a.ca?0:b.nodes)?b.nodes():null;if(c)return a.a.N(c.cloneNode(!0).childNodes);b=b.text();return a.a.xa(b)};a.D.sa=new a.D;a.Ba(a.D.sa);a.b("nativeTemplateEngine",a.D);(function(){a.ua=function(){var a=this.Ib=function(){if("undefined"==typeof t||!t.tmpl)return 0;try{if(0<=t.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=
function(b,f,g){g=g||{};if(2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var e=b.data("precompiled");e||(e=b.text()||"",e=t.template(null,"{{ko_with $item.koBindingContext}}"+e+"{{/ko_with}}"),b.data("precompiled",e));b=[f.$data];f=t.extend({koBindingContext:f},g.templateOptions);f=t.tmpl(e,b,f);f.appendTo(s.createElement("div"));t.fragments={};return f};this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+
a+" })()) }}"};this.addTemplate=function(a,b){s.write("<script type='text/html' id='"+a+"'>"+b+"\x3c/script>")};0<a&&(t.tmpl.tag.ko_code={open:"__.push($1 || '');"},t.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};a.ua.prototype=new a.v;var b=new a.ua;0<b.Ib&&a.Ba(b);a.b("jqueryTmplTemplateEngine",a.ua)})()})})();
})();


/* /js/libs/koExternalTemplateEngine_all.lisandro.js
 * compresion time: 0.02503 -(ms)
 * ------------------------------------------------- */
(function($, undefined) {
/*
    TrafficCop
    Author: Jim Cowart
    License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
    Version 0.3.0
*/

var inProgress = {};
var inProgressArray = ko.observableArray();

$.trafficCop = function(url, options) {
    var reqOptions = url, key;
    if(arguments.length === 2) {
        reqOptions = $.extend(true, options, { url: url });
    }
    key = JSON.stringify(reqOptions);
    if (key in inProgress) {
        for (i in {success: 1, error: 1, complete: 1}) {
            inProgress[key][i](reqOptions[i]);
        }
    } else {
		inProgressArray.push( key );
        inProgress[key] = $.ajax(reqOptions).always(function () {
			delete inProgress[key];
			inProgressArray.remove( key );
		});
    }
    return inProgress[key];
};
	
	$.trafficCop.inProgress = inProgressArray;

})(jQuery);

(function($, global, undefined) {
/*
    infuser.js
    Author: Jim Cowart
    License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
    Version 0.2.0
*/
var hashStorage = {
    templates: {},

    storeTemplate: function(templateId, templateContent) {
        this.templates[templateId] = templateContent;
    },

    getTemplate: function(templateId) {
        return this.templates[templateId];
    },

    purge: function() {
        this.templates = {};
    }
};
var scriptStorage = {
    templateIds: [],
    storeTemplate: function(templateId, templateContent) {
        var node = document.getElementById(templateId);
        if(node === null) {
            this.templateIds.push(templateId);
            node = document.createElement("script");
            node.type = "text/html";
            node.id = templateId;
            document.body.appendChild(node);
        }
        node.text = templateContent;
    },

    getTemplate: function(templateId) {
        return document.getElementById(templateId);
    },

    purge: function() {
        for(var i = 0; i < this.templateIds.length; i++) {
            document.body.removeChild(document.getElementById(this.templateIds[i]));
        }
        this.templateIds = [];
    }
};
var errorHtml = "<div class='infuser-error'>The template <a href='{TEMPLATEURL}'>{TEMPLATEID}</a> could not be loaded. {STATUS}</div>",
    returnErrorTemplate = function(status, templateId, templatePath) {
        return errorHtml.replace('{STATUS}', status).replace('{TEMPLATEID}', templateId).replace('{TEMPLATEURL}', templatePath);
    },
    errors = [];
var helpers = {

	// modifiqu getTemplatePath para que soporte infuser aqu tambin
    getTemplatePath: function(templateOptions) {
		var result;
		if( templateOptions.getTemplatePath ){
			result = templateOptions.getTemplatePath( templateOptions );
		} else {
			var templateFile = templateOptions.templatePrefix + templateOptions.templateId + templateOptions.templateSuffix;
			result = templateOptions.templateUrl === undefined || templateOptions.templateUrl === "" ?
				templateFile : templateOptions.templateUrl + "/" + templateFile;
		}

        return result;
    },
    templateGetSuccess: function(templateId, callback) {
        return function(response) {
            infuser.store.storeTemplate(templateId, response);
            callback(infuser.store.getTemplate(templateId));
        };
    },
    templateGetError: function(templateId, templatePath, callback) {
        return function(exception) {
            if($.inArray(templateId, errors) === -1) {
                errors.push(templateId);
            }
            var templateHtml = returnErrorTemplate("HTTP Status code: " + exception.status, templateId, templatePath);
            infuser.store.storeTemplate(templateId, templateHtml);
            callback(infuser.store.getTemplate(templateId));
        };
    },

    getAjaxOptions: function(templateOptions) {

    }
},
infuserOptions = ['target','loadingTemplate','postRender','preRender','render','bindingInstruction','useLoadingTemplate','model','templateUrl','templateSuffix','templatePrefix',''];
var infuser = {
    storageOptions: {
        hash: hashStorage,
        script: scriptStorage
    },

    store: hashStorage,

    defaults: {
        // Template name conventions
        templateUrl: "",
        templateSuffix: ".html",
        templatePrefix: "",
        // AJAX Options
        ajax: {
            "async": true,
            "dataType": "html",
            "type": "GET"
        },
        // infuse() specific options - NOT used for "get" or "getSync"
        target:  function(templateId) { return "#" + templateId }, // DEFAULT MAPPING
        loadingTemplate:    {
                                content:        '<div class="infuser-loading">Loading...</div>',
                                transitionIn:   function(target, content) {
                                                    var tgt = $(target);
                                                    tgt.hide();
                                                    tgt.html(content);
                                                    tgt.fadeIn();
                                                },
                                transitionOut:  function(target) {
                                                    $(target).html("");
                                                }
                            },
        postRender:         function(targetElement) { }, // NO_OP effectively by default
        preRender:          function(targetElement, template) { }, // NO_OP effectively by default
        render:             function(target, template) {
                                var tgt = $(target);
                                if(tgt.children().length === 0) {
                                    tgt.append($(template));
                                }
                                else {
                                    tgt.children().replaceWith($(template));
                                }
                            },
        bindingInstruction:  function(template, model) { return template; }, // NO_OP effectively by default
		getTemplatePath: null,
        useLoadingTemplate: true // true/false
    },

    get: function(options, callback) {
        var templateOptions = $.extend({}, infuser.defaults, (typeof options === "object" ? options : { templateId: options })),
            template;
        templateOptions.ajax.url = helpers.getTemplatePath(templateOptions);
        template = infuser.store.getTemplate(templateOptions.ajax.url);
        if(!template || $.inArray(templateOptions.ajax.url, errors) !== -1) {
            templateOptions.ajax.success = helpers.templateGetSuccess(templateOptions.ajax.url, callback);
            templateOptions.ajax.error = helpers.templateGetError(templateOptions.templateId, templateOptions.ajax.url, callback);
            $.trafficCop(templateOptions.ajax);
        }
        else {
            callback(template);
        }
    },

    getSync: function(options) {
        var templateOptions = $.extend({}, infuser.defaults, (typeof options === "object" ? options : { templateId: options }), { ajax: { async: false } }),
            template,
            templateHtml;
        templateOptions.ajax.url = helpers.getTemplatePath(templateOptions);
        template = infuser.store.getTemplate(templateOptions.ajax.url);
        if(!template || $.inArray(templateOptions.ajax.url, errors) !== -1) {
            templateHtml = null;
            templateOptions.ajax.success = function(response) { templateHtml = response; };
            templateOptions.ajax.error = function(exception) {
                if($.inArray(templateOptions.ajax.url) === -1) {
                    errors.push(templateOptions.ajax.url);
                }
                templateHtml = returnErrorTemplate("HTTP Status code: exception.status", templateOptions.templateId, templateOptions.ajax.url);
            };
            $.ajax(templateOptions.ajax);
            if(templateHtml === null) {
                templateHtml = returnErrorTemplate("An unknown error occurred.", templateOptions.templateId, templateOptions.ajax.url);
            }
            else {
                infuser.store.storeTemplate(templateOptions.ajax.url, templateHtml);
                template = infuser.store.getTemplate(templateOptions.ajax.url);
            }
        }
        return template;
    },

    infuse: function(templateId, renderOptions) {
        var templateOptions = $.extend({}, infuser.defaults, (typeof templateId === "object" ? templateId : renderOptions), (typeof templateId === "string" ? { templateId: templateId } : undefined )),
            targetElement = typeof templateOptions.target === 'function' ? templateOptions.target(templateId) : templateOptions.target;
        if(templateOptions.useLoadingTemplate) {
            templateOptions.loadingTemplate.transitionIn(targetElement, templateOptions.loadingTemplate.content);
        }
        infuser.get(templateOptions, function(template) {
            var _template = template;
            templateOptions.preRender(targetElement, _template);
            _template = templateOptions.bindingInstruction(_template, templateOptions.model);
            if(templateOptions.useLoadingTemplate) {
                templateOptions.loadingTemplate.transitionOut(targetElement);
            }
            templateOptions.render(targetElement, _template);
            templateOptions.postRender(targetElement);
        });
    }
};
global.infuser = infuser; })(jQuery, window);


// Knockout External Template Engine
// Author: Jim Cowart
// License: MIT (http://www.opensource.org/licenses/mit-license)
// Version 2.0.4


(function ( global, ko, jQuery, infuser, undefined ) {

	var ExternalTemplateSource = function(templateId, options) {
	    var self = this, origAfterRender;
	    self.templateId = templateId;
	    self.loaded = false;
	    self.template = ko.observable(infuser.defaults.useLoadingTemplate ? infuser.defaults.loadingTemplate.content : undefined);
	    self.template.data = {};
	    self.options = ko.utils.extend({},options);
	    self.options.templateId = templateId;
	    if(self.options && self.options.afterRender) {
	        origAfterRender = self.options.afterRender;
	        self.options.afterRender = function() {
	            if(self.loaded) {
	                origAfterRender.apply(self.options, arguments);
	            }
	        }
	    }
	};
	
	ko.utils.extend(ExternalTemplateSource.prototype, {
	    data: function(key, value) {
	        if (arguments.length === 1) {
	            if(key === "precompiled") {
	                this.template();
	            }
	            return this.template.data[key];
	        }
	        this.template.data[key] = value;
	    },
	
	    text: function(value) {
			var self = this;			
	        if (!this.loaded) {
	           this.getTemplate();
	        } else {
				if( ko.isWriteableObservable( self.options.loaded ) ) {
					setTimeout(function(){
						self.options.loaded(true);
					}, 0);
				}
			}
	
	        if (arguments.length === 0) {
	            return this.template();
	        } else {
	           this.template(arguments[0]);
	        }
	    },
	
	    getTemplate: function() {
	        var self = this;
	        infuser.get(self.options, function(tmpl) {
	            self.data("precompiled",null);
	            self.template(tmpl);
	            self.loaded = true;
				if( ko.isWriteableObservable( self.options.loaded ) ) {
					setTimeout(function(){
						self.options.loaded(true);
					}, 0);
				}
	        });
	    }
	});
	var KoExternalTemplateEngine = function(koEngineType) {
	    var engine = koEngineType ? new koEngineType() : new ko.nativeTemplateEngine();
	    engine.templates = {};
	    engine.makeTemplateSource = function(template, bindingContext, options) {
	        // Named template
	        if (typeof template == "string") {
	            var elem = document.getElementById(template);
	            if (elem)
	                return new ko.templateSources.domElement(elem);
	            else {
	                if(!engine.templates[template]) {
	                    engine.templates[template] = new ExternalTemplateSource(template, options);
	                }
	                return engine.templates[template];
	            }
	        }
	        else if ((template.nodeType == 1) || (template.nodeType == 8)) {
	            // Anonymous template
	            return new ko.templateSources.anonymousTemplate(template);
	        }
	        
	    };
	
	    engine.renderTemplate = function (template, bindingContext, options) {
	        var templateSource = engine.makeTemplateSource(template, bindingContext, options);
	        return engine.renderTemplateSource(templateSource, bindingContext, options);
	    };
	
	    return engine;
	};
	
	ko.KoExternalTemplateEngine = KoExternalTemplateEngine;
	
	if (jQuery['tmpl'] && jQuery['tmpl']['tag']['tmpl']['open'].toString().indexOf('__') >= 0) {
	    ko.setTemplateEngine(new KoExternalTemplateEngine(ko.jqueryTmplTemplateEngine));
	}
	else {
	    ko.setTemplateEngine(new KoExternalTemplateEngine());
	}

})( window, ko, jQuery, infuser );


/* /js/libs/knockout.mapping-latest.js
 * compresion time: 0.02599 -(ms)
 * ----------------------------------- */
/// Knockout Mapping plugin v2.4.1 CON FIX DE https://raw.github.com/brigand/knockout.mapping/85fefadcf7918388454de970b496d25d3898fd22/knockout.mapping.js
/// (c) 2013 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
/// License: MIT (http://www.opensource.org/licenses/mit-license.php)
(function(e) {
    "function" === typeof require && "object" === typeof exports && "object" === typeof module ? e(require("knockout"), exports) : "function" === typeof define && define.amd ? define(["knockout", "exports"], e) : e(ko, ko.mapping = {})
}
)(function(e, f) {
    function S() {
        for (var b = arguments, c = b.length, a = {}, d = [], e, f, n; c--; )
            for (n = b[c],
            e = n.length; e--; )
                f = n[e],
                a[f] || (a[f] = 1,
                d.push(f));
        return d
    }
    function z(b, c) {
        var a, d;
        for (d in c)
            c.hasOwnProperty(d) && c[d] && (a = f.getType(b[d]),
            d && b[d] && "array" !== a && "string" !== a ? z(b[d], c[d]) : "array" === f.getType(b[d]) && "array" === f.getType(c[d]) ? b[d] = S(b[d], c[d]) : b[d] = c[d])
    }
    function G(b, c) {
        var a = {};
        z(a, b);
        z(a, c);
        return a
    }
    function A(b, c) {
        for (var a = G({}, b), d = L.length - 1; 0 <= d; d--) {
            var e = L[d];
            a[e] && (a[""]instanceof Object || (a[""] = {}),
            a[""][e] = a[e],
            delete a[e])
        }
        c && (a.ignore = l(c.ignore, a.ignore),
        a.include = l(c.include, a.include),
        a.copy = l(c.copy, a.copy),
        a.observe = l(c.observe, a.observe));
        a.ignore = l(a.ignore, h.ignore);
        a.include = l(a.include, h.include);
        a.copy = l(a.copy, h.copy);
        a.observe = l(a.observe, h.observe);
        a.mappedProperties = a.mappedProperties || {};
        a.copiedProperties = a.copiedProperties || {};
        return a
    }
    function l(b, c) {
        "array" !== f.getType(b) && (b = "undefined" === f.getType(b) ? [] : [b]);
        "array" !== f.getType(c) && (c = "undefined" === f.getType(c) ? [] : [c]);
        return e.utils.arrayGetDistinctValues(b.concat(c))
    }
    function T(b, c) {
        var a = e.dependentObservable;
        e.dependentObservable = function(a, c, d) {
            d = d || {};
            a && "object" == typeof a && (d = a);
            var f = d.deferEvaluation
              , k = !1
              , p = function(a) {
                var c = e.dependentObservable;
                e.dependentObservable = u;
                var d = e.isWriteableObservable(a);
                e.dependentObservable = c;
                c = u({
                    read: function() {
                        k || (e.utils.arrayRemoveItem(b, a),
                        k = !0);
                        return a.apply(a, arguments)
                    },
                    write: d && function(b) {
                        return a(b)
                    }
                    ,
                    deferEvaluation: !0
                });
                U && (c._wrapper = !0);
                c.__DO = a;
                return c
            };
            d.deferEvaluation = !0;
            a = new u(a,c,d);
            f || (a = p(a),
            b.push(a));
            return a
        }
        ;
        e.dependentObservable.fn = u.fn;
        e.computed = e.dependentObservable;
        var d = c();
        e.dependentObservable = a;
        e.computed = e.dependentObservable;
        return d
    }
    function H(b, c, a, d, g, D, n) {
        var h = "array" === f.getType(e.utils.unwrapObservable(c));
        D = D || "";
        if (f.isMapped(b)) {
            var k = e.utils.unwrapObservable(b)[p];
            a = G(k, a)
        }
        var s = n || g
          , l = function() {
            return a[d] && a[d].create instanceof Function
        }
          , w = function(b) {
            return T(I, function() {
                return e.utils.unwrapObservable(g)instanceof Array ? a[d].create({
                    data: b || c,
                    parent: s,
                    skip: M
                }) : a[d].create({
                    data: b || c,
                    parent: s
                })
            })
        }
          , v = function() {
            return a[d] && a[d].update instanceof Function
        }
          , x = function(b, f) {
            var g = {
                data: f || c,
                parent: s,
                target: e.utils.unwrapObservable(b)
            };
            e.isWriteableObservable(b) && (g.observable = b);
            return a[d].update(g)
        };
        if (n = J.get(c))
            return n;
        d = d || "";
        if (h) {
            var h = []
              , t = !1
              , m = function(a) {
                return a
            };
            a[d] && a[d].key && (m = a[d].key,
            t = !0);
            e.isObservable(b) || (b = e.observableArray([]),
            b.mappedRemove = function(a) {
                var c = "function" == typeof a ? a : function(b) {
                    return b === m(a)
                }
                ;
                return b.remove(function(a) {
                    return c(m(a))
                })
            }
            ,
            b.mappedRemoveAll = function(a) {
                var c = E(a, m);
                return b.remove(function(a) {
                    return -1 != e.utils.arrayIndexOf(c, m(a))
                })
            }
            ,
            b.mappedDestroy = function(a) {
                var c = "function" == typeof a ? a : function(b) {
                    return b === m(a)
                }
                ;
                return b.destroy(function(a) {
                    return c(m(a))
                })
            }
            ,
            b.mappedDestroyAll = function(a) {
                var c = E(a, m);
                return b.destroy(function(a) {
                    return -1 != e.utils.arrayIndexOf(c, m(a))
                })
            }
            ,
            b.mappedIndexOf = function(a) {
                var c = E(b(), m);
                a = m(a);
                return e.utils.arrayIndexOf(c, a)
            }
            ,
            b.mappedGet = function(a) {
                return b()[b.mappedIndexOf(a)]
            }
            ,
            b.mappedCreate = function(a) {
                if (-1 !== b.mappedIndexOf(a))
                    throw Error("There already is an object with the key that you specified.");
                var c = l() ? w(a) : a;
                v() && (a = x(c, a),
                e.isWriteableObservable(c) ? c(a) : c = a);
                b.push(c);
                return c
            }
            );
            n = E(e.utils.unwrapObservable(b), m).sort();
            k = E(c, m);
            t && k.sort();
            t = e.utils.compareArrays(n, k);
            n = {};
            var u, B = e.utils.unwrapObservable(c), z = {}, A = !0, k = 0;
            for (u = B.length; k < u; k++) {
                var r = m(B[k]);
                if (void 0 === r || r instanceof Object) {
                    A = !1;
                    break
                }
                z[r] = B[k]
            }
            var B = []
              , C = 0
              , k = 0;
            for (u = t.length; k < u; k++) {
                var r = t[k], q, y = D + "[" + k + "]";
                switch (r.status) {
                case "added":
                    var F = A ? z[r.value] : K(e.utils.unwrapObservable(c), r.value, m);
                    q = H(void 0, F, a, d, b, y, g);
                    l() || (q = e.utils.unwrapObservable(q));
                    y = N(e.utils.unwrapObservable(c), F, n);
                    q === M ? C++ : B[y - C] = q;
                    n[y] = !0;
                    break;
                case "retained":
                    F = A ? z[r.value] : K(e.utils.unwrapObservable(c), r.value, m);
                    q = K(b, r.value, m);
                    H(q, F, a, d, b, y, g);
                    y = N(e.utils.unwrapObservable(c), F, n);
                    B[y] = q;
                    n[y] = !0;
                    break;
                case "deleted":
                    q = K(b, r.value, m)
                }
                h.push({
                    event: r.status,
                    item: q
                })
            }
            b(B);
            a[d] && a[d].arrayChanged && e.utils.arrayForEach(h, function(b) {
                a[d].arrayChanged(b.event, b.item)
            })
        } else if (O(c)) {
            b = e.utils.unwrapObservable(b);
            if (!b) {
                if (l())
                    return t = w(),
                    v() && (t = x(t)),
                    t;
                if (v())
                    return x(t);
                b = {}
            }
            v() && (b = x(b));
            J.save(c, b);
            if (v())
                return b;
            P(c, function(d) {
                var f = D.length ? D + "." + d : d;
                if (-1 == e.utils.arrayIndexOf(a.ignore, f))
                    if (-1 != e.utils.arrayIndexOf(a.copy, f))
                        b[d] = c[d];
                    else if ("object" != typeof c[d] && "array" != typeof c[d] && 0 < a.observe.length && -1 == e.utils.arrayIndexOf(a.observe, f))
                        b[d] = c[d],
                        a.copiedProperties[f] = !0;
                    else {
                        var g = J.get(c[d])
                          , n = H(b[d], c[d], a, d, b, f, b)
                          , g = g || n;
                        if (0 < a.observe.length && -1 == e.utils.arrayIndexOf(a.observe, f))
                            b[d] = e.utils.unwrapObservable(g),
                            a.copiedProperties[f] = !0;
                        else {
                            if (e.isWriteableObservable(b[d])) {
                                if (g = e.utils.unwrapObservable(g),
                                b[d]() !== g)
                                    b[d](g)
                            } else
                                g = void 0 === b[d] ? g : e.utils.unwrapObservable(g),
                                b[d] = g;
                            a.mappedProperties[f] = !0
                        }
                    }
            })
        } else
            switch (f.getType(c)) {
            case "function":
                v() ? e.isWriteableObservable(c) ? (c(x(c)),
                b = c) : b = x(c) : b = c;
                break;
            default:
                if (e.isWriteableObservable(b))
                    return q = v() ? x(b) : e.utils.unwrapObservable(c),
                    b(q),
                    q;
                l() || v();
                b = l() ? w() : e.observable(e.utils.unwrapObservable(c));
                v() && b(x(b))
            }
        return b
    }
    function N(b, c, a) {
        for (var d = 0, e = b.length; d < e; d++)
            if (!0 !== a[d] && b[d] === c)
                return d;
        return null
    }
    function Q(b, c) {
        var a;
        c && (a = c(b));
        "undefined" === f.getType(a) && (a = b);
        return e.utils.unwrapObservable(a)
    }
    function K(b, c, a) {
        b = e.utils.unwrapObservable(b);
        for (var d = 0, f = b.length; d < f; d++) {
            var h = b[d];
            if (Q(h, a) === c)
                return h
        }
        throw Error("When calling ko.update*, the key '" + c + "' was not found!");
    }
    function E(b, c) {
        return e.utils.arrayMap(e.utils.unwrapObservable(b), function(a) {
            return c ? Q(a, c) : a
        })
    }
    function P(b, c) {
        if ("array" === f.getType(b))
            for (var a = 0; a < b.length; a++)
                c(a);
        else
            for (a in b)
                c(a)
    }
    function O(b) {
        var c = f.getType(b);
        return ("object" === c || "array" === c) && null !== b
    }
    function V() {
        var b = []
          , c = [];
        this.save = function(a, d) {
            var f = e.utils.arrayIndexOf(b, a);
            0 <= f ? c[f] = d : (b.push(a),
            c.push(d))
        }
        ;
        this.get = function(a) {
            a = e.utils.arrayIndexOf(b, a);
            return 0 <= a ? c[a] : void 0
        }
    }
    function R() {
        var b = {}
          , c = function(a) {
            var c;
            try {
                c = a
            } catch (e) {
                c = "$$$"
            }
            a = b[c];
            b.hasOwnProperty(c) || (a = new V,
            b[c] = a);
            return a
        };
        this.save = function(a, b) {
            c(a).save(a, b)
        }
        ;
        this.get = function(a) {
            return c(a).get(a)
        }
    }
    var U = !0, p = "__ko_mapping__", u = e.dependentObservable, C = 0, I, J, L = ["create", "update", "key", "arrayChanged"], M = {}, w = {
        include: ["_destroy"],
        ignore: [],
        copy: [],
        observe: []
    }, h = w;
    f.isMapped = function(b) {
        return (b = e.utils.unwrapObservable(b)) && b[p]
    }
    ;
    f.fromJS = function(b) {
        if (0 == arguments.length)
            throw Error("When calling ko.fromJS, pass the object you want to convert.");
        try {
            C++ || (I = [],
            J = new R);
            var c, a;
            2 == arguments.length && (arguments[1][p] ? a = arguments[1] : c = arguments[1]);
            3 == arguments.length && (c = arguments[1],
            a = arguments[2]);
            a && (c = G(c, a[p]));
            c = A(c);
            var d = H(a, b, c);
            a && (d = a);
            if (!--C)
                for (; I.length; ) {
                    var e = I.pop();
                    e && (e(),
                    e.__DO.throttleEvaluation = e.throttleEvaluation)
                }
            d[p] = G(d[p], c);
            return d
        } catch (f) {
            try {             
                throw C = 0,
                f;
              } catch (error) {
                // error log
              }
        }
    }
    ;
    f.fromJSON = function(b) {
        var c = e.utils.parseJson(b);
        arguments[0] = c;
        return f.fromJS.apply(this, arguments)
    }
    ;
    f.updateFromJS = function(b) {
        throw Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");
    }
    ;
    f.updateFromJSON = function(b) {
        throw Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");
    }
    ;
    f.toJS = function(b, c) {
        h || f.resetDefaultOptions();
        if (0 == arguments.length)
            throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");
        if ("array" !== f.getType(h.ignore))
            throw Error("ko.mapping.defaultOptions().ignore should be an array.");
        if ("array" !== f.getType(h.include))
            throw Error("ko.mapping.defaultOptions().include should be an array.");
        if ("array" !== f.getType(h.copy))
            throw Error("ko.mapping.defaultOptions().copy should be an array.");
        c = A(c, b[p]);
        return f.visitModel(b, function(a) {
            return e.utils.unwrapObservable(a)
        }, c)
    }
    ;
    f.toJSON = function(b, c) {
        var a = f.toJS(b, c);
        return e.utils.stringifyJson(a)
    }
    ;
    f.defaultOptions = function() {
        if (0 < arguments.length)
            h = arguments[0];
        else
            return h
    }
    ;
    f.resetDefaultOptions = function() {
        h = {
            include: w.include.slice(0),
            ignore: w.ignore.slice(0),
            copy: w.copy.slice(0),
            observe: w.observe.slice(0)
        }
    }
    ;
    f.getType = function(b) {
        if (b && "object" === typeof b) {
            if (b.constructor === Date)
                return "date";
            if (b.constructor === Array)
                return "array"
        }
        return typeof b
    }
    ;
    f.visitModel = function(b, c, a) {
        a = a || {};
        a.visitedObjects = a.visitedObjects || new R;
        var d, g = e.utils.unwrapObservable(b);
        if (O(g))
            a = A(a, g[p]),
            c(b, a.parentName),
            d = "array" === f.getType(g) ? [] : {};
        else
            return c(b, a.parentName);
        a.visitedObjects.save(b, d);
        var h = a.parentName;
        P(g, function(b) {
            if (!a.ignore || -1 == e.utils.arrayIndexOf(a.ignore, b)) {
                var l = g[b]
                  , k = a
                  , s = h || "";
                "array" === f.getType(g) ? h && (s += "[" + b + "]") : (h && (s += "."),
                s += b);
                k.parentName = s;
                if (-1 !== e.utils.arrayIndexOf(a.copy, b) || -1 !== e.utils.arrayIndexOf(a.include, b) || !g[p] || !g[p].mappedProperties || g[p].mappedProperties[b] || !g[p].copiedProperties || g[p].copiedProperties[b] || "array" === f.getType(g))
                    switch (f.getType(e.utils.unwrapObservable(l))) {
                    case "object":
                    case "array":
                    case "undefined":
                        k = a.visitedObjects.get(l);
                        d[b] = "undefined" !== f.getType(k) ? k : f.visitModel(l, c, a);
                        break;
                    default:
                        d[b] = c(l, a.parentName)
                    }
            }
        });
        return d
    }
});


/* /js/libs/accounting.min.js
 * compresion time: 0.02217 -(ms)
 * -------------------------- */
/*!
 * accounting.js v0.3.2, copyright 2011 Joss Crowcroft, MIT license, http://josscrowcroft.github.com/accounting.js
 */
(function(p,z){function q(a){return!!(""===a||a&&a.charCodeAt&&a.substr)}function m(a){return u?u(a):"[object Array]"===v.call(a)}function r(a){return"[object Object]"===v.call(a)}function s(a,b){var d,a=a||{},b=b||{};for(d in b)b.hasOwnProperty(d)&&null==a[d]&&(a[d]=b[d]);return a}function j(a,b,d){var c=[],e,h;if(!a)return c;if(w&&a.map===w)return a.map(b,d);for(e=0,h=a.length;e<h;e++)c[e]=b.call(d,a[e],e,a);return c}function n(a,b){a=Math.round(Math.abs(a));return isNaN(a)?b:a}function x(a){var b=c.settings.currency.format;"function"===typeof a&&(a=a());return q(a)&&a.match("%v")?{pos:a,neg:a.replace("-","").replace("%v","-%v"),zero:a}:!a||!a.pos||!a.pos.match("%v")?!q(b)?b:c.settings.currency.format={pos:b,neg:b.replace("%v","-%v"),zero:b}:a}var c={version:"0.3.2",settings:{currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}}},w=Array.prototype.map,u=Array.isArray,v=Object.prototype.toString,o=c.unformat=c.parse=function(a,b){if(m(a))return j(a,function(a){return o(a,b)});a=a||0;if("number"===typeof a)return a;var b=b||".",c=RegExp("[^0-9-"+b+"]",["g"]),c=parseFloat((""+a).replace(/\((.*)\)/,"-$1").replace(c,"").replace(b,"."));return!isNaN(c)?c:0},y=c.toFixed=function(a,b){var b=n(b,c.settings.number.precision),d=Math.pow(10,b);return(Math.round(c.unformat(a)*d)/d).toFixed(b)},t=c.formatNumber=function(a,b,d,i){if(m(a))return j(a,function(a){return t(a,b,d,i)});var a=o(a),e=s(r(b)?b:{precision:b,thousand:d,decimal:i},c.settings.number),h=n(e.precision),f=0>a?"-":"",g=parseInt(y(Math.abs(a||0),h),10)+"",l=3<g.length?g.length%3:0;return f+(l?g.substr(0,l)+e.thousand:"")+g.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+e.thousand)+(h?e.decimal+y(Math.abs(a),h).split(".")[1]:"")},A=c.formatMoney=function(a,b,d,i,e,h){if(m(a))return j(a,function(a){return A(a,b,d,i,e,h)});var a=o(a),f=s(r(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=x(f.format);return(0<a?g.pos:0>a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",t(Math.abs(a),n(f.precision),f.thousand,f.decimal))};c.formatColumn=function(a,b,d,i,e,h){if(!a)return[];var f=s(r(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=x(f.format),l=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,k=0,a=j(a,function(a){if(m(a))return c.formatColumn(a,f);a=o(a);a=(0<a?g.pos:0>a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",t(Math.abs(a),n(f.precision),f.thousand,f.decimal));if(a.length>k)k=a.length;return a});return j(a,function(a){return q(a)&&a.length<k?l?a.replace(f.symbol,f.symbol+Array(k-a.length+1).join(" ")):Array(k-a.length+1).join(" ")+a:a})};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)exports=module.exports=c;exports.accounting=c}else"function"===typeof define&&define.amd?define([],function(){return c}):(c.noConflict=function(a){return function(){p.accounting=a;c.noConflict=z;return c}}(p.accounting),p.accounting=c)})(this);


/* /js/libs/dtlibrary.1.1.js
 * compresion time: 0.10395 -(ms)
 * ------------------------- */
//$._replace = false;

/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);


/*
 * https://github.com/LiosK/UUID.js
 Version: v3.3.0
 The MIT License: Copyright (c) 2010-2016 LiosK.
 */
var UUID;UUID=function(g){"use strict";function f(){}function b(c){return 0>c?NaN:30>=c?0|Math.random()*(1<<c):53>=c?(0|1073741824*Math.random())+1073741824*(0|Math.random()*(1<<c-30)):NaN}function a(c,b){for(var a=c.toString(16),d=b-a.length,e="0";0<d;d>>>=1,e+=e)d&1&&(a=e+a);return a}f.generate=function(){return (a(b(32),8)+"-"+a(b(16),4)+"-"+a(16384|b(12),4)+"-"+a(32768|b(14),4)+"-"+a(b(48),12)).toUpperCase()};f.overwrittenUUID=g;return f}(UUID);

/* By James Campbell
 * http://plugins.jquery.com/project/jQS
 * By James Campbell
 * $.unserialise
 * $.getAllQueryStrings
 * $.QueryStringExist
 * $.getQueryString
 */
(function($){

	$.jQueryString = {Version:"2.0.5.lisandro-javier", Defaults:{
		URL: location.href,
		Unescape: true,
		encodeFN: encodeURIComponent, // anteriormente era encode
		decodeFN: decodeURIComponent, // anteriormente era decode
		onStart: function(Option){
		},
		onError: function(Option){
		},
		onSuccess: function(Option, Result){
		},
		callback: function(Option, Result){
		}
	}, getDefaults: function(){
		return $.extend(this.Defaults, {URL: location.href});
	}};

	/*
	$.unserialise = function(Data, Unescape){
		var Data = Data.split("&");
		var Serialised = {};
		$.each(Data, function(){
			var Properties = this.split("=");
			Serialised[Properties[0]] = (Unescape)? $.jQueryString.Defaults.decodeFN (Properties[1]):Properties[1];
		});
		return Serialised;
	};
	*/

	/**
	* versin modificada por Javier Valderrama para que soporte parmetros de tipo array[]
	 * @param {type} Data
	 * @param {type} Unescape
	 * @returns {Serialised}	 */
	$.unserialise = function(Data, Unescape){
		var Data            = Data.split("&")
		  , Serialized      = {};
		$.each(Data, function(){
			var Properties      = this.split("=")
              , propertyName    = $.jQueryString.Defaults.decodeFN (Properties[0])
              , propertyValue   = (Unescape)? $.jQueryString.Defaults.decodeFN (Properties[1]):Properties[1];

            if (propertyName.indexOf('[]') > 1) {
				if( !$.isArray( Serialized[ propertyName ] ) ){
					Serialized[ propertyName ] = $.makeArray( Serialized[ propertyName ] );
				}
                Serialized[propertyName].push(propertyValue);
            } else {
                Serialized[propertyName] = propertyValue;
            }
		});
		return Serialized;
	};


	$.getAllQueryStrings = function(Option){
		Option = $.extend($.jQueryString.getDefaults(), Option);
		var Result = {};
		try {
			var QS = Option.URL.split("?")[1].split("#")[0];
		}
		catch (e) {
			Option.callback(Option, Result);
			return Result;
		}
		Result = $.unserialise(QS, Option.Unescape);
		Option.callback(Option, Result);
		return Result;
	};
	$.QueryStringExist = function(Option){
		Option = $.extend($.jQueryString.getDefaults(), Option);
		var Result = (typeof($.getAllQueryStrings({
			URL: Option.URL
		})[Option.ID]) !=
			"undefined");
		Option.callback(Option, Result);
		return Result;
	};
	$.getQueryString = function(Option){
		Option = $.extend($.jQueryString.getDefaults(), Option);
		var Result = Option.DefaultValue;
		Option.onStart(Option);
		if ($.QueryStringExist({
			ID: Option.ID,
			URL: Option.URL
		})) {
			Result = $.getAllQueryStrings({
				URL: Option.URL
			})[Option.ID];
			Option.onSuccess(Option, Result);
		}
		else {
			Option.onError(Option);
		}
		Option.callback(Option, Result);
		return Result;
	};
})(jQuery);




/*--------------------------------------------*
 * MODIFICADO POR Lisandro Puzzolo PARA QUE SOPORTE Awesome.constructor._parent y conocer la clase desde la que hereda otra clase.
 * Info: https://github.com/kilhage/class.js
 *--------------------------------------------*
 * Copyright 2011, Emil Kilhage
 * Released under the MIT License
 *--------------------------------------------*
 * Environment-release: jQuery
 * Last Update: 2011-04-29 18:10:51
 * Version 1.1.0
 *--------------------------------------------*/
jQuery.Class = (function (undefined) {
	"use strict";

	var initializing = false,
		prefix = "Class",

		__self__ = prefix + (new Date()).getTime(),

		testFn = function () {
			this._parent();
		},

		fnSearch = /\b_parent\b/,
		parentFnSearch = fnSearch.test(testFn) ? (/\b_parent\b\./) : fnSearch = /.*/,

		toString = Object.prototype.toString,
		hasOwn = Object.prototype.hasOwnProperty,

		functionToString = toString.call(testFn),
		objectToString = toString.call({}),
		StdError = Error,

		tmpProto,

		errors = {};

	/* Define some used Errors */

	/**
	 * This is thrown whenever the input in any of the class building
	 * functions conatins something wiered.
	 */
	function InvalidClassDefinition(msg) {
		StdError.apply(this, arguments);
		this.message = prefix + "::" + msg;
	}

	tmpProto = InvalidClassDefinition.prototype = new StdError();
	errors[tmpProto.name = "InvalidClassDefinition"] = InvalidClassDefinition;

	/**
	 * Gets thrown when someone calls a parent method that don't exists
	 */
	function InvalidParentMethodCall(name) {
		StdError.apply(this, arguments);
		this.message = prefix + "::Parent Class doesn't have the method: " + name;
	}

	tmpProto = InvalidParentMethodCall.prototype = new StdError();
	errors[tmpProto.name = "InvalidParentMethodCall"] = InvalidParentMethodCall;

	/**
	 * The base Class implementation that all
	 * classes created by this library will be extended from
	 */
	function Base() {}

	/**
	 * Simple JavaScript Inheritance
	 * By John Resig http://ejohn.org/
	 * MIT Licensed.
	 *
	 * @param <object> prop: The prototype that you want the object to have
	 * @return <function>: Created class
	 */
	function Class(properties) {
		return Base.extend(properties);
	}

	/**
	 * @param <mixed> fn
	 * @return <boolean>: if fn is created by this library
	 */
	function is(fn) {
		return !!(fn && fn.extend === Base.extend);
	}

	/**
	 * makeClass - By John Resig (MIT Licensed)
	 * http://ejohn.org/
	 *
	 * Makes it possible to instantiate a
	 * class both with or without the new keyword.
	 * It also moves the constructor to a function
	 * on the prototype called "init"
	 *
	 * @return <function>
	 */
	function makeClass() {
		// The constructor will be cached
		// here and updated each time it changes
		var init;
		function Awesome(args) {
			var self = this;
			// Where the new keyword used?
			if (self instanceof Awesome) {
				if (initializing === false) {
					// Have the constructor property changed since
					// last time a new instance where made?
					if (init !== self.init) {
						// Is the constructor property a function?
						if ("init" in self &&
							toString.call(self.init) === functionToString) {
							// Update the cached constructor.
							init = self.init;
						} else {
							// The not a valid constructor.
							init = undefined;
						}
					}
					if (init !== undefined) {
						// Call the "real" constructor and apply the arguments
						init.apply(self, args && args.callee === Awesome ?
							args : arguments);
					}
				}
			} else {
				// Instantiate the class and pass the aruments
				return new Awesome(arguments);
			}
		}

		return Awesome;
	}

	function rewrite(name, current, parent, populator) {
		// Should this._parent be
		// populated with any properties
		// from the parent class?
		var populate = parentFnSearch.test(current),

			setSelf = populate,

		// Needed to wrap the original function
		// inside a new function to avoid adding
		// properties to the original function
		// when calling 'this._parent.<method name>()'
			realParent = toString.call(parent) === functionToString ? function () {
				return parent.apply(this, arguments);
			} : // Make sure to throw an error
				// when calling a method that don't exists
				function () {
					throw new InvalidParentMethodCall(name);
				};

		return function () {
			var self = this,
			// Store the content in the ._parent property
			// so we can revert the object after
			// we're done if it's needed
				tmp = self._parent,
				ret,
				name,
				fns;

			// Add a new ._parent() method that points to the parent
			// class's method with the same name
			self._parent = realParent;

			if (setSelf) {
				// Add the parent class's methods to
				// 'this._parent' which enables you
				// to call 'this._parent<method name>()'
				if (populate) {
					// We only need to do this once
					populate = false;
					// Get the parent functions and add'em
					fns = populator();
					for (name in fns) {
						if (hasOwn.call(fns, name)) {
							// Add the parent functions
							realParent[name] = fns[name];
						}
					}
				}
				// Save a reference to the class instance on the parent
				// function so the other methods from the
				// instance parent class can be called.
				// Only do this when needed, to optimize the performace
				realParent[__self__] = self;
			}

			// Execute the original function
			ret = current.apply(self, arguments);

			// Restore the context
			self._parent = tmp;

			return ret;
		};
	}

	function rewriteFn(fn) {
		return function () {
			return fn.apply(this[__self__] || this, arguments); // || this agregado por Lisandro Puzzolo para que soporte herencia de mtodos de clase
		};
	}

	function addProperties(from, reference, target) {
		var name, current, fns,
			populator = function () {
				if (fns === undefined) {
					var key;
					fns = {};
					for (key in reference) {
						if (toString.call(reference[key]) === functionToString) {
							fns[key] = rewriteFn(reference[key]);
						}
					}

				}
				return fns;
			};

		if (target === undefined) {
			target = reference;
		}

		for (name in from) {
			if (hasOwn.call(from, name)) {
				current = from[name];
				target[name] = toString.call(current) === functionToString &&
					fnSearch.test(current) ?
					rewrite(name, current, reference[name], populator) : current;
			}
		}

		/// FIX PARA toString IE8
		name = 'toString';
		if (hasOwn.call(from, name)) {
			current = from[name];
			target[name] = toString.call(current) === functionToString &&
				fnSearch.test(current) ?
				rewrite(name, current, reference[name], populator) : current;
		}
		//////////////////////////
	}

	/**
	 * Creates a new class based on the current class
	 *
	 * @param properties
	 * @return <function>
	 */
	Base.extend = function (properties) {
		// Create the new class
		var Awesome = makeClass(), name, Src = this,
			prototype, parent = Src.prototype, m;

		if (!properties || toString.call(properties) !== objectToString) {
			m = "Unable to " + (Src === Base ? "extend" : "create") + " class";
			throw new InvalidClassDefinition(m);
		}

		// Move all static properties
		for (name in Src) {
			if (hasOwn.call(Src, name)) {
				Awesome[name] = Src[name];
			}
		}

		/**
		 * Does the input contains any static properties that should be added?
		 */
		if (properties.hasOwnProperty("prototype")) {
			prototype = properties.prototype;
			if (prototype && toString.call(prototype) === objectToString) {
				delete properties.prototype;
				addProperties(properties, Src, Awesome);
				properties = properties.prototype = prototype;
			} else {
				m = "Invalid type on properties.prototype(" +
					prototype + "), literal object expected";
				throw new InvalidClassDefinition(m);
			}
		}

		// Create a shallow copy of the source prototype
		initializing = true;
		prototype = new Src();
		initializing = false;

		// Copy the properties over onto the new prototype
		addProperties(properties, parent, prototype);

		// Enforce the constructor to be what we expect
		Awesome.constructor = prototype.constructor = Awesome;

		// Add the final prototype to the created class
		Awesome.prototype = prototype;

		// addon lisando
		Awesome.constructor._parent = Src;
		// fin addon lisandro

		/**
		 * Checks if a class inherits from another class
		 *
		 * @param <function> parent
		 * @return <boolean>
		 */
		Awesome.inherits = function (parent) {
			return parent === Src || Src.inherits(parent);
		};

		return Awesome;
	};

	Base.inherits = function () {
		return false;
	};

	/**
	 * Adds properties to a Class
	 * @param <object> prop
	 */
	Base.addMethods = function (properties, proto, own_proto) {
		if (properties && toString.call(properties) === objectToString) {
			proto = properties.prototype;
			own_proto = this.prototype;

			if (proto && toString.call(proto) === objectToString) {
				addProperties(proto, own_proto);

				delete properties.prototype;
				addProperties(properties, this);
				properties.prototype = proto;

			} else {
				addProperties(properties, own_proto);
			}
		} else {
			throw new InvalidClassDefinition("Unable to add methods to class");
		}
	};

	Base.createInstance = function(){
		var theClass = this;
		var args = $.makeArray( arguments );
		//args.shift();
		args.unshift(null);
		var instance = new (Function.prototype.bind.apply( theClass, args ));
		return instance;
	}

	/**
	 * A default function on all classes that are created.
	 *
	 * Makes in possible to extend already initalized
	 * objects in an easy way
	 *
	 * @param <object> properties
	 */
	Base.prototype.addMethods = function (properties) {
		if (properties && toString.call(properties) === objectToString) {
			addProperties(properties, this);
		} else {
			throw new InvalidClassDefinition("Unable to add methods to instance");
		}
	};

	// Public helper methods
	Class.is = is;
	Class.makeClass = makeClass;

	// These are exposed to simplify the unit-testing
	// I will probably remove them later...
	Class.fnSearch = fnSearch;
	Class.parentFnSearch = parentFnSearch;
	Class.errors = errors;
	Class.version = "1.1.0";

	return Class;
}());


/**
 * https://github.com/carlo/jquery-base64
 * $.base64.encode( "this is a test" ) returns "dGhpcyBpcyBhIHRlc3Q="
 * $.base64.decode( "dGhpcyBpcyBhIHRlc3Q=" ) returns "this is a test"
 */
jQuery.base64=(function($){var _PADCHAR="=",_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_VERSION="1.0";function _getbyte64(s,i){var idx=_ALPHA.indexOf(s.charAt(i));if(idx===-1){throw"Cannot decode base64"}return idx}function _decode(s){var pads=0,i,b10,imax=s.length,x=[];s=String(s);if(imax===0){return s}if(imax%4!==0){throw"Cannot decode base64"}if(s.charAt(imax-1)===_PADCHAR){pads=1;if(s.charAt(imax-2)===_PADCHAR){pads=2}imax-=4}for(i=0;i<imax;i+=4){b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12)|(_getbyte64(s,i+2)<<6)|_getbyte64(s,i+3);x.push(String.fromCharCode(b10>>16,(b10>>8)&255,b10&255))}switch(pads){case 1:b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12)|(_getbyte64(s,i+2)<<6);x.push(String.fromCharCode(b10>>16,(b10>>8)&255));break;case 2:b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12);x.push(String.fromCharCode(b10>>16));break}return x.join("")}function _getbyte(s,i){var x=s.charCodeAt(i);if(x>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return x}function _encode(s){if(arguments.length!==1){throw"SyntaxError: exactly one argument required"}s=String(s);var i,b10,x=[],imax=s.length-s.length%3;if(s.length===0){return s}for(i=0;i<imax;i+=3){b10=(_getbyte(s,i)<<16)|(_getbyte(s,i+1)<<8)|_getbyte(s,i+2);x.push(_ALPHA.charAt(b10>>18));x.push(_ALPHA.charAt((b10>>12)&63));x.push(_ALPHA.charAt((b10>>6)&63));x.push(_ALPHA.charAt(b10&63))}switch(s.length-imax){case 1:b10=_getbyte(s,i)<<16;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt((b10>>12)&63)+_PADCHAR+_PADCHAR);break;case 2:b10=(_getbyte(s,i)<<16)|(_getbyte(s,i+1)<<8);x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt((b10>>12)&63)+_ALPHA.charAt((b10>>6)&63)+_PADCHAR);break}return x.join("")}return{decode:_decode,encode:_encode,VERSION:_VERSION}}(jQuery));

jQuery.browser = jQuery.browser || {};
/**
 * jQuery.browser.mobile (http://detectmobilebrowser.com/)
 *
 * jQuery.browser.mobile will be true if the browser is a mobile device
 *
 **/
(function(a){jQuery.browser.mobile=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);

/**
 * detect IOS
 */
(function(){
	var standalone = window.navigator.standalone,
		userAgent = window.navigator.userAgent.toLowerCase();

	$.browser.ios = $.browser.ios  || /iphone|ipod|ipad/.test( userAgent );
	$.browser.edge = /edge\//.test( userAgent );
	$.browser.macsafari = navigator.platform.substr(0,3)=='Mac' && $.browser.safari && navigator.userAgent.indexOf('Chrome')==-1;
	$.browser.supports = {
		css		: {
			display	: {
				flex	: function(){
					if( this.__flex == undefined ){
						this.__flex = $('<div>').css({'display':'flex'}).css('display') == 'flex';
					}
					return this.__flex;
				}
			}
		}
	}
})();


/**
 * Open
 *
 * Popup window utility for creating pop up windows without intrusive using any
 * intrusive code.
 * http://plugins.jquery.com/project/open
 *
 */

(function($){$.open={};$.open.defaultParams={"width":"800","height":"600","top":"0","left":"0","directories":"no","location":"no","resizeable":"yes","menubar":"no","toolbar":"no","scrollbars":"yes","status":"no"};$.open.defaultConfig={autoFocus:true};$.open.newWindow=function(href,params,config){var windowParams=$.extend($.open.defaultParams,params);var windowConfig=$.extend($.open.defaultConfig,config);var windowName=params["windowName"]||"new_window";var i,paramString="";for(i in windowParams){if(windowParams.hasOwnProperty(i)){paramString+=(paramString==="")?"":",";paramString+=i+"=";if(windowParams[i]===true||windowParams[i]===false){paramString+=(windowParams[i])?"yes":"no";}
else{paramString+=windowParams[i];}}}
	var popupWindow=window.open(href,windowName,paramString);if(windowConfig.autoFocus){popupWindow.focus();}
	return popupWindow;};$.fn.open=function(parameters,callback){var params=parameters.params||parameters;var config=parameters.config||{};this.each(function(){$(this).click(function(event){event.preventDefault();if($(this).attr("target")){params.windowName=$(this).attr("target");}
	var href;if(params.href){href=params.href;}
	else if($(this).attr("href")){href=$(this).attr("href");}
	else{return;}
	var windowObject=$.open.newWindow(href,params,config);if(callback){callback(windowObject);}});});return $;};})(jQuery);



////////////////////////////////////////////////////////////////////////////////////////////////
// jQuery.fn //
////////////////////////////////////////////////////////////////////////////////////////////////

/*!
 * .closestDescendant( selector [, findAll ] )
 * https://github.com/tlindig/jquery-closest-descendant
 *
 * v0.1.2 - 2014-02-17
 *
 * Copyright (c) 2014 Tobias Lindig
 * http://tlindig.de/
 *
 * License: MIT
 *
 * Author: Tobias Lindig <dev@tlindig.de>
 */
!function(a){a.fn.closestDescendant=function(b,c){if(!b||""===b)return a();c=c?!0:!1;var d=a();return this.each(function(){var e=a(this),f=[];for(f.push(e);f.length>0;)for(var g=f.shift(),h=g.children(),i=0;i<h.length;++i){var j=a(h[i]);if(j.is(b)){if(d.push(j[0]),!c)return!1}else f.push(j)}}),d}}(jQuery);


/**
 * @author http://css-tricks.com/snippets/jquery/serialize-form-to-json/
 * @cat plugin
 * @type jQuery
 */
$.fn.serializeObject = function()
{
	var o = {};
	var a = this.serializeArray();
	$.each(a, function() {
		if (o[this.name]) {
			if (!o[this.name].push) {
				o[this.name] = [o[this.name]];
			}
			o[this.name].push(this.value || '');
		} else {
			o[this.name] = this.value || '';
		}
	});
	return o;
};

/**
 * test if any of the items in the jquery collection returns true for the iterator function
 * @example jQuery('input').all(funcion(){return $(this}.val());
 * @cat plugin
 * @type jQuery
 */
jQuery.fn.any = function(iterator) {
	var iteratorResult = $(this).filter(iterator);
	return iteratorResult.length > 0;
};
/**
 * determina si una tabla no tiene ningn tr en su body
 */
$.extend($.expr[':'],{
	emptybody: function(a) {
		return $(a).find('tbody tr').length == 0;
	}
});


$.extend($.expr[':'], {
	hasBgColor: function(a){
		var background = $(a).css('background-color');
		return background != '' && background != 'transparent' && background != 'rgba(0, 0, 0, 0)';
	},

	hasBgImage: function( el ){
		if (el.currentStyle) {
			return ( el.currentStyle['backgroundImage'] !== 'none' );

		}
		else if (window.getComputedStyle) {
			return ( document.defaultView.getComputedStyle(el, null).getPropertyValue('background-image') !== 'none' )
		}
	},

	hasBgImageUrl: function( el ){
		var bgImage;
		if (el.currentStyle) {
			bgImage =  el.currentStyle['backgroundImage'];

		}
		else if (window.getComputedStyle) {
			bgImage = document.defaultView.getComputedStyle(el, null).getPropertyValue('background-image');
		}

		if( bgImage ){
			var re = /url\(["']?([^"'\)]*)["']?\)/ig;
			var exeq = re.exec( bgImage );
			return exeq && exeq[1];
		}

	}
});

$.expr[':'].css = function(obj, index, meta, stack) {
    var args = meta[3].split(/\s*=\s*/);
    return $(obj).css(args[0]) == args[1];
};

(function($){
	$.fn.backgroundImage = function(url){
		if( arguments.length == 0 ){
			var bgImage = $(this).css("backgroundImage");
			return $.string.getCSSBackgroundImage( bgImage );
		} else {
			$(this).css( { backgroundImage: 'url(' + url + ')' } )
		}
	}
})(jQuery);


/**
 * ordena los <options> segn una funcin de comparacin
 */
jQuery.fn.sortOptions = function(compareFn){
	$.each($(this), function(index, element){
		var options = $(element).find('option');
		options.sort(compareFn || jQuery.fn.sortOptions.defaultCompareFn);
		$(element).empty().append(options);
	});
	return this;
};
/**
 * similar a jCover pero puede haber varios
 * @author: Lisandro Puzzolo
 */
$.fn.spinner = function(options){
	$(this).each(function(){
		if(options == 'hide'){
			var _spinner = $(this).data('_spinner');
			if(_spinner){
				$(this).css('visibility', _spinner.visibility);
				$(_spinner.elements.container).remove();
				$(_spinner.elements.spinner).remove();
				$(this).removeData('_spinner');
			}
		} else {
			if($(this).data('_spinner')) {
				$(this).spinner('hide');
			}

			var containerElement = $('<div>');
			$(containerElement).height($(this).height())
				.width($(this).outerWidth())
				.addClass('spinner-container')
				.css('position', 'absolute')
				.css('marginTop', $(this).css('marginTop'))
			;

			var spinnerElement = $('<div>');
			$(spinnerElement)//.height($(this).height())
				//.width($(this).width())
				.addClass('spinner');
			//.css('position', 'absolute');


			$(this).before(containerElement);
			$(containerElement).append(spinnerElement);

			$(this).data('_spinner', {
				'visibility': $(this).css('visibility'),
				'elements': {
					'container': $(containerElement),
					'spinner': $(spinnerElement)
				}
			});
			$(this).css('visibility', 'hidden');
		}
	});
};


/**
 * test if all the items in the jquery collection returns true for the iterator function
 * @example jQuery('input').all(funcion(){return $(this}.val());
 * @cat plugin
 * @type jQuery
 */
jQuery.fn.all = function(iterator) {
	var iteratorResult = $(this).filter(iterator);
	return iteratorResult.length == $(this).length;
};


(function(jQuery){
	jQuery.fn.extend({
		relativeOffset: function( container, options ){
			var options = $.extend({
				'offsetTop'					: 0,
				'offsetBottom'				: 0,
				'offsetLeft'				: 0,
				'offsetRight'				: 0,
				'pullToVertical'			: .5, // empujar a tal porcentaje del alto del elemento
				'pullToVerticalAmount'		: 0,
				'pullToHorizontal'			: .5, // empujar a tal porcentaje del ancho del elemento
				'pullToHorizontalAmount'	: 0
			}, options );

			var container = container || window
				, offset = $(this).offset()
				, width = $(this).outerWidth()
				, height = $(this).outerHeight()
				, containerWidth = $(container).outerWidth()
				, containerHeight = $(container).outerHeight()
				, containerInnerWidth = containerWidth - options.offsetLeft - options.offsetRight
				, containerInnerHeight = containerHeight  - options.offsetTop - options.offsetBottom
				, result
				, hasMatrix = !!window.Matrix && jQuery.fn.relativeOffset.defaults.useMatrix

			var parentOffset;

			var elementMatrix;
			var containerMatrix;
			var relativeMatrix;

			if( hasMatrix ) {
				elementMatrix = containerMatrix = relativeMatrix = Matrix.IDENTITY;
			}

			if($.isWindow( $(container)[0] )){
				parentOffset = {top: $(window).scrollTop(), left: $(window).scrollLeft()};
			} else if( $(container)[0] == document ) {
				parentOffset = { top: 0, left: 0 };
			} else {
				parentOffset = $(container).offset();
			}


			if( hasMatrix ){
				elementMatrix = $(this).cumulativeTransformMatrixM();
				containerMatrix = $( container ).cumulativeTransformMatrixM();
				relativeMatrix = elementMatrix.concat( containerMatrix.inverse() );
			}

			/////////////////////
			var left = offset.left - parentOffset.left - options.offsetLeft;
			var top = offset.top - parentOffset.top - options.offsetTop;

			if( options.pullToHorizontalAmount > 0 && options.pullToVerticalAmount > 0){
				var pullCoordinates = {
					'left'	: options.pullToHorizontal * ( containerWidth - width ),
					'top'	: options.pullToVertical * ( containerHeight - height )
				};

				left  = left * ( 1- options.pullToHorizontalAmount ) + pullCoordinates.left * options.pullToHorizontalAmount;
				top = top * ( 1- options.pullToVerticalAmount ) + pullCoordinates.top * options.pullToVerticalAmount;
			}

			var scaledTop = top;
			var scaledLeft = left;
			var scaledContainerInnerWidth = containerInnerWidth;
			var scaledContainerInnerHeight = containerInnerHeight;
			var scaledWidth = width;
			var scaledHeight = height;
			var scaledOffsetRight = options.offsetRight;
			var scaledOffsetBottom = options.offsetBottom;

			if( hasMatrix ){
				scaledTop /= elementMatrix.scaleY();
				scaledLeft /= elementMatrix.scaleX();
				scaledContainerInnerWidth /= relativeMatrix.scaleX();
				scaledContainerInnerHeight /= relativeMatrix.scaleY();
				containerInnerWidth *= containerMatrix.scaleX();
				containerInnerHeight *= containerMatrix.scaleY();
				width *= elementMatrix.scaleX();
				height *= elementMatrix.scaleY();
				scaledOffsetRight /= relativeMatrix.scaleX();
				scaledOffsetBottom /= relativeMatrix.scaleY();
			}


			var scaledRight = scaledLeft + scaledWidth - scaledOffsetRight;
			var scaledBottom = scaledTop + scaledHeight- scaledOffsetBottom;
			var scaledFromBottom = scaledContainerInnerHeight - scaledBottom;
			var scaledFromRight = scaledContainerInnerWidth - scaledRight;

			var right = left + width - options.offsetRight;
			var bottom = top + height- options.offsetBottom;

			//////////////////////////////

			result = {
				'top'						: top,
				'left'						: left,
				'right'						: right,
				'bottom'					: bottom,
				'fromBottom'				: containerInnerHeight - bottom,
				'fromRight'					: containerInnerWidth - right,
				'center'					: {
					'left'					: left + width / 2,
					'top'					: top + height / 2
				},
				'dimensions'				: {
					'width'					: width,
					'height'				: height,
					'containerWidth'		: containerInnerWidth,
					'containerHeight'		: containerInnerHeight
				}
			}

			$.extend( result, {
				'percents'					: {
					'top'					: top / containerInnerHeight,
					'left'					: left / containerInnerWidth,
					'right'					: right / containerInnerWidth,
					'bottom'				: bottom / containerInnerHeight,
					'fromBottom'			: result.fromBottom / containerInnerHeight,
					'fromRight'				: result.fromRight / containerInnerWidth,
					'center'				: {
						'left'				: result.center.left / containerInnerWidth,
						'top'				: result.center.top / containerInnerHeight
					}
				}
			});

			$.extend( result, {
				'outbounds'					: {
					'top'					: result.percents.bottom < 0 ? 2 : result.percents.top < 0 ? 1 : 0,
					'left'					: result.percents.right < 0 ? 2 : result.percents.left < 0 ? 1 : 0,
					'right'					: result.percents.left > 1 ? 2 : result.percents.right > 1 ? 1 : 0,
					'bottom'				: result.percents.top > 1 ? 2 : result.percents.bottom > 1 ? 1 : 0
				}
			});

			$.extend( result, {
				'scaled'					: { // valores escalados respecto al elemento
					'top'					: scaledTop,
					'left'					: scaledLeft,
					'right'					: scaledRight,
					'bottom'				: scaledBottom,
					'fromBottom'			: scaledFromBottom,
					'fromRight'				: scaledFromRight,
					'center'				: {
						'left'				: scaledLeft + scaledWidth / 2,
						'top'				: scaledTop + scaledHeight / 2
					},
					'dimensions'			: {
						'width'				: scaledWidth,
						'height'			: scaledHeight,
						'containerWidth'	: scaledContainerInnerWidth,
						'containerHeight'	: scaledContainerInnerHeight
					}
				}
			});

			if( hasMatrix ) {
				$.extend(result, {
					'matrix': {
						'element': elementMatrix, // matrix de transformacin del elemento respecto al documento
						'container': containerMatrix, // matrix de transformacin del container respecto al documento
						'relative': relativeMatrix // matrix de transformacin del elemento respecto al container
					}
				});
			}


			// rea visible
			var outsideTop = result.percents.bottom < 0 ? height : 0;
			var outsideLeft = result.percents.right < 0 ? width : 0;
			var outsideRight = result.percents.left > 1 ? width : 0;
			var outsideBottom = result.percents.top > 1 ? height : 0;
			var visibleWidth = width;
			var visibleHeight = height;

			if( result.percents.top < 1 && result.percents.bottom > 0 ){ // verticalmente visible
				if( result.percents.top < 0 ){
					outsideTop = Math.abs( result.top );
				}
				if( result.percents.bottom > 1 ){
					outsideBottom = Math.abs( result.fromBottom );
				}
			}

			if( result.percents.left < 1 && result.percents.right > 0 ){ // verticalmente visible
				if( result.percents.left < 0 ){
					outsideLeft = Math.abs( result.left );
				}
				if( result.percents.right > 1 ){
					outsideRight = Math.abs( result.fromRight );
				}
			}

			visibleWidth -= outsideLeft + outsideRight;
			visibleHeight -= outsideTop + outsideBottom;

			$.extend( result.scaled, {
				'offscreen'		: {
					'top'		: outsideTop,
					'right'		: outsideRight,
					'bottom'	: outsideBottom,
					'left'		: outsideLeft
				},
				'onscreen'		: {
					'width'		: visibleWidth,
					'height'	: visibleHeight
				}
			});

			$.extend( result, {
				'offscreen'		: result.scaled.offscreen,
				'onscreen'		: result.scaled.onscreen
			});

			$.extend( result.percents, {
				'offscreen'		: {
					// 'top'		: result.offscreen.top / containerInnerHeight,
					// 'right'		: result.offscreen.right / containerInnerWidth,
					// 'bottom'	: result.offscreen.bottom / containerInnerHeight,
					// 'left'		: result.offscreen.left / containerInnerWidth
					'top'		: result.offscreen.top / height,
					'right'		: result.offscreen.right / width,
					'bottom'	: result.offscreen.bottom / height,
					'left'		: result.offscreen.left / width
				},
				'onscreen'		: {
					'width'		: result.onscreen.width / width,
					'height'	: result.onscreen.height / height
				}
			});

			if( hasMatrix ){
				$.extend( result.scaled, {
					'offscreen'		: {
						'top'		: result.scaled.offscreen.top / elementMatrix.scaleY(),
						'right'		: result.scaled.offscreen.right / elementMatrix.scaleX(),
						'bottom'	: result.scaled.offscreen.bottom / elementMatrix.scaleY(),
						'left'		: result.scaled.offscreen.left / elementMatrix.scaleX()
					},
					'onscreen'		: {
						'width'		: result.scaled.onscreen.width / elementMatrix.scaleX(),
						'height'	: result.scaled.onscreen.height / elementMatrix.scaleY()
					}
				});
			}




			//////////////////////////////
			return result;
		}
	});

	jQuery.fn.relativeOffset.defaults = {
		'useMatrix'	: true
	}
}(jQuery));


(function($){
	$.fn.extend({
		/**
		 * devuelve la posicin relativa de un elemento con respecto a otro, sin tener en cuenta el scroll de otherElement
		 * @param otherElement
		 * @returns {*}
		 */
		relativePosition: function( otherElement, options ){
			var options = $.extend({
					'scaled'		: false
				}, options )
				, otherElement = otherElement || window
				, hasMatrix = !!window.Matrix && jQuery.fn.relativeOffset.defaults.useMatrix

			var $otherElement = $(otherElement);
			var offset = $(this).offset()
				, relativePosition;
			if($.isWindow($(otherElement)[0])){
				relativePosition = offset;
			} else {
				var globalToLocal = $otherElement.globalCoordinatesToLocal( offset.left, offset.top );
				var scrollTop = $otherElement.scrollTop(),
					scrollLeft = $otherElement.scrollLeft(),
				relativePosition = {
					'top'		: globalToLocal.y + scrollTop,
					'left'		: globalToLocal.x + scrollLeft
				}
			}

			if(options.scaled && hasMatrix){
				var matrix = $(this).cumulativeTransformMatrixM( otherElement );
				var scaleX = matrix.scaleX();
				var scaleY = matrix.scaleY();
				$.extend(relativePosition, {
					'scaled'	: {
						'matrix'	: matrix,
						'top'		: relativePosition.top / matrix.scaleY(),
						'left'		: relativePosition.left / matrix.scaleX()
					}
				});
			}

			return relativePosition;
		},

		/**
		 * devuelve la distancia que puede recorrer el scroll vertical del elemento
		 * @returns {number}
		 */
		scrollHeightTravelDistance: function(){
			return $(this).scrollHeight() - $(this).clientHeight();
		},

		/**
		 * devuelve la distancia que puede recorrer el scroll horizontal del elemento
		 * @returns {number}
		 */
		scrollWidthTravelDistance: function(){
			return $(this).scrollWidth() - $(this).clientWidth();
		},

		/**
		 * devuelve informacin de posicin, scroll y recorrido por scroll que puede hacer un elemento respecto a otro
		 * @returns {
		 * 	'left'						: 		// posicin izquierda
		 * 	'offscreen'					:	{ 	// qu partes del elemento estn por fuera de otherElement
		 * 		'bottom'				:		// pixeles por debajo de otherElement
		 * 		'left'					: 		// pixeles a la izquierda de otherElement
		 * 		'percent'				: {		// porcentajes respecto al alto y ancho del elemento
		 *			'bottom'			: 		// porcentaje del alto del elemento debajo de otherElement
		 *			'left'				: 		// porcentaje del ancho del elemento a la izquierda de otherElement
		 *			'right'				: 		// porcentaje del ancho del elemento a la derecha de otherElement
		 *			'top'				: 		// porcentaje del alto del elemento arriba de otherElement		 *
		 * 		},
		 * 		'right'					: 		// pixeles a la derecha de otherElement
		 * 		'top'					: 		// pixeles arriba de otherElement
		 * 	},
		 * 	'offset'					: {		// posicin del elemento relativa a otherElement teniendo en cuenta el scroll de otherElement
		 * 		'centerLeft'			: 		// posicin del lado izquierdo del elemento cuando se encuentra horizontalmente centrado en otherElement
		 * 		'centerTop'				: 		// posicin del lado superior del elemento cuando se encuentra verticalmente centrado en otherElement
		 * 		'inner'					: {		// informacin de recorrido del elemento cuando es visible dentro de otherElement
		 *			'maxLeft'			: 		// posicin ms a la derecha que puede alcanzar el elemento sin salir de otherElement
		 *			'maxPossibleLeft'	: 		// posicin que podra tener el elemento al lmite interno derecho de otherElement
		 * 			'maxPossibleTop'	: 		// posicin que podra tener el elemento al lmite interno inferior de otherElement
		 * 			'maxTop'			: 		// posicin ms baja que puede alcanzar el elemento sin salir de otherElement
		 * 			'minLeft'			: 		// posicin ms a la izquierda que puede alcanzar el elemento sin salir de otherElement
		 * 			'minPossibleLeft'	: 		// posicin que podra tener el elemento al lmite interno inferior de otherElement
		 *			'minPossibleTop'	: 		// posicin que podra tener el elemento al lmite interno superior de otherElement
		 *			'minTop'			: 		// posicin ms alta que puede alcanzar el elemento sin salir de otherElement
		 *			'percent'			: {		// proporcin que alcanza del posible con respecto al centro
		 *				'maxLeft'		: 		// proporcin que alcanza a la derecha de la distancia entre el centro y el maxPossibleLeft
		 *				'maxTop'		: 		// proporcin que alcanza hacia abajo de la distancia entre el centro y el maxPossibleTop
		 *				'minLeft'		: 		// proporcin que alcanza hacia la izquierda de la distancia entre el centro y el minPossibleLeft
		 *				'maxLeft'		: 		// proporcin que alcanza hacia la derecha de la distancia entre el centro y el maxPossibleLeft
		 *			}
		 * 		},
		 * 		'left'					: 		// posicin horizontal del elemento teniendo en cuenta el scroll
		 * 		'maxleft'				: 		// mxima posicin que puede alcanzar el elemento cuando el scroll horizontal de otherElement est a la derecha
		 * 		'maxTop'				: 		// mxima posicin que puede alcanzar el elemento cuando el scroll vertical de otherElement est abajo
		 * 		'minLeft'				: 		// mnima posicin que puede alcanzar el elemento cuando el scroll horizontal de otherElement est a la izquierda
		 * 		'minTop'				: 		// mnima posicin que puede alcanzar el elemento cuando el scroll vertical de otherElement est arriba
		 * 		'outer'					: {		// informacin de recorrido del elemento desde que comienza a ser visible de un extremo hasta que deja de serlo en el otro
		 * 			'maxLeft'			:		// posicin ms a la derecha que puede alcanzar el elemento saliendo de otherElement
		 * 			'maxPossibleLeft'	: 		// posicin que podra tener el elemento al salir por el extremo derecho de otherElement
		 * 			'maxPossibletop'	: 		// posicin que podra tener el elemento al salir por el extremo inferior de otherElement
		 *			'maxTop'			: 		// posicin ms hacia arriba que puede alcanzar el elemento saliendo de otherElement
		 *			'minLeft'			: 		// posicin ms a la izquierda que puede alcanzar el elemento saliendo de otherElement
		 *			'minPossibleLeft'	: 		// posicin que podra tener el elemento al salir por el extremo izquierda de otherElement
		 *			'minPossibleTop'	: 		// posicin que podra tener el elemnto al salir por el extremo superior de otherElement
		 *			'minTop'			: 		// posicin ms alta que puede alcanzar el elemento saliendo de otherElement
		 *			'percent'			: {		// proporcin que alcanza respecto al centro
		 *				'maxLeft'		: 		// proporcin que alcanza a la derecha de la distancia entre el centro y el maxPossibleLeft
		 *				'maxTop'		: 		// proporcin que alcanza hacia abajo de la distancia entre el centro y el maxPossibleTop
		 *				'minLeft'		: 		// proporcin que alcanza hacia la izquierda de la distancia entre el centro y el minPossibleLeft
		 *				'maxLeft'		: 		// proporcin que alcanza hacia la derecha de la distancia entre el centro y el maxPossibleLeft
		 * 		},
		 * 		'scroll'				: {
		 * 			'height'				: 		// alto virtual de otherElement
		 *			'heightTravelDistance'	: 		// distancia que puede recorrer el scroll vertical
		 *			'left'					: 		// distancia del scroll horizontal recorrida
		 *			'top'					: 		// distancia del scroll vertical recorrida
		 *			'width'					: 		// ancho virtual de otherElement
		 *			'widthTravelDistance'	: 		// distancia que puede recorrer el scroll horizontal
		 *		}
		 * 		'top'					: 		// posicin vertical del elemento teniendo en cuenta el scroll
		 *	},
		 *	'scaled'					: {		// misma data que lo anterior, pero teniendo en cuenta las matrices de transformacin
		 *		...
		 *	}
		 * }
		 */

		_relativePositionScrollData: function( width, height, top, left, otherElementClientWidth, otherElementClientHeight, scrollTop, scrollLeft, scrollWidth, scrollHeight, scrollWidthTravelDistance, scrollHeightTravelDistance ){
			var result = {
				'top'		: top,
				'left'		: left
			};

			$.extend(result, {
				'scroll'					: {
					'top'					: scrollTop,
					'left'					: scrollLeft,
					'width'					: scrollWidth,
					'height'				: scrollHeight,
					'widthTravelDistance'	: scrollWidthTravelDistance,
					'heightTravelDistance'	: scrollHeightTravelDistance,
				},
				'offset'					: {
					'minTop'				: result.top - scrollHeightTravelDistance,
					'minLeft'				: result.left - scrollWidthTravelDistance,
					'maxTop'				: result.top,
					'maxLeft'				: result.left,
					'top'					: result.top - scrollTop,
					'left'					: result.left - scrollLeft,
					'centerTop'				: otherElementClientHeight / 2 - height / 2,
					'centerLeft'			: otherElementClientWidth / 2 - width / 2,
					'inner'					: {
						'minPossibleTop'	: 0,
						'maxPossibleTop'	: otherElementClientHeight - height,
						'minTop'			: result.top - Math.min( result.top , scrollHeightTravelDistance ),
						'maxTop'			: Math.min( otherElementClientHeight - height, result.top ),
						'minPossibleLeft'	: 0,
						'maxPossibleLeft'	: otherElementClientWidth - width,
						'minLeft'			: result.left - Math.min( result.left, scrollWidthTravelDistance ),
						'maxLeft'			: Math.min( otherElementClientWidth - width, result.left )
					},
					'outer'					: {
						'minPossibleTop'	: 0 - height,
						'maxPossibleTop'	: otherElementClientHeight,
						'minTop'			: result.top - Math.min( result.top + height , scrollHeightTravelDistance ),
						'maxTop'			: Math.min( otherElementClientHeight, result.top),
						'minPossibleLeft'	: 0 - width,
						'maxPossibleLeft'	: otherElementClientWidth,
						'minLeft'			: result.left - Math.min( result.left + width, scrollWidthTravelDistance ),
						'maxLeft'			: Math.min( otherElementClientWidth, result.left)
					}
				}
			});

			$.extend( true, result, {
				'offscreen': {
					'top'		: result.offset.outer.minTop < result.offset.inner.minPossibleTop ? result.offset.inner.minPossibleTop - result.offset.outer.minTop : 0,
					'bottom' 	: result.offset.outer.maxTop > result.offset.inner.maxPossibleTop ? - result.offset.inner.maxPossibleTop + result.offset.outer.maxTop : 0,
					'left'		: result.offset.outer.minLeft < result.offset.inner.minPossibleLeft ? result.offset.inner.minPossibleLeft - result.offset.outer.minLeft : 0,
					'right' 	: result.offset.outer.maxLeft > result.offset.inner.maxPossibleLeft ? - result.offset.inner.maxPossibleLeft + result.offset.outer.maxLeft : 0
				}
			});

			var distanceFromCenterTopToInnerMinTop = result.offset.centerTop - result.offset.inner.minPossibleTop;
			var distanceFromCenterTopToInnerMaxTop = result.offset.centerTop - result.offset.inner.maxPossibleTop;
			var distanceFromCenterTopToOuterMinTop = result.offset.centerTop - result.offset.outer.minPossibleTop;
			var distanceFromCenterTopToOuterMaxTop = result.offset.centerTop - result.offset.outer.maxPossibleTop;

			var distanceFromCenterLeftToInnerMinLeft = result.offset.centerLeft - result.offset.inner.minPossibleLeft;
			var distanceFromCenterLeftToInnerMaxLeft = result.offset.centerLeft - result.offset.inner.maxPossibleLeft;
			var distanceFromCenterLeftToOuterMinLeft = result.offset.centerLeft - result.offset.outer.minPossibleLeft;
			var distanceFromCenterLeftToOuterMaxLeft = result.offset.centerLeft - result.offset.outer.maxPossibleLeft;

			$.extend( true, result, {
				'offscreen'			: {
					'percent'		: {
						'top'		: result.offscreen.top / height,
						'bottom'	: result.offscreen.bottom / height,
						'left'		: result.offscreen.left / width,
						'right'		: result.offscreen.right / width
					}
				},
				'offset'			: {
					'inner'			: {
						'percent'	: {
							'minTop'	: distanceFromCenterTopToInnerMinTop == 0 ? 0 : ( result.offset.centerTop - result.offset.inner.minTop ) / distanceFromCenterTopToInnerMinTop,
							'maxTop'	: distanceFromCenterTopToInnerMaxTop == 0 ? 0 : ( result.offset.centerTop - result.offset.inner.maxTop ) / distanceFromCenterTopToInnerMaxTop,
							'minLeft'	: distanceFromCenterLeftToInnerMinLeft == 0 ? 0 : ( result.offset.centerLeft - result.offset.inner.minLeft ) / distanceFromCenterLeftToInnerMinLeft,
							'maxLeft'	: distanceFromCenterLeftToInnerMaxLeft == 0 ? 0 : ( result.offset.centerLeft - result.offset.inner.maxLeft ) / distanceFromCenterLeftToInnerMaxLeft
						}
					},
					'outer'			: {
						'percent'	: {
							'minTop'	: distanceFromCenterTopToOuterMinTop == 0 ? 0 : ( result.offset.centerTop - result.offset.outer.minTop ) / distanceFromCenterTopToOuterMinTop,
							'maxTop'	: distanceFromCenterTopToOuterMaxTop == 0 ? 0 : ( result.offset.centerTop - result.offset.outer.maxTop ) / distanceFromCenterTopToOuterMaxTop,
							'minLeft'	: distanceFromCenterLeftToOuterMinLeft == 0 ? 0 : ( result.offset.centerLeft - result.offset.outer.minLeft ) / distanceFromCenterLeftToOuterMinLeft,
							'maxLeft'	: distanceFromCenterLeftToOuterMaxLeft == 0 ? 0 : ( result.offset.centerLeft - result.offset.outer.maxLeft ) / distanceFromCenterLeftToOuterMaxLeft
						}
					}
				}
			});

			return result;
		},

		relativePositionScrollData: function( otherElement, options ){
			var otherElement = otherElement || window;
			var options = $.extend({
					'scaled'	: false
				}, options )
				, hasMatrix = !!window.Matrix && jQuery.fn.relativeOffset.defaults.useMatrix

			var $otherElement = $(otherElement);
			var result = this.relativePosition( otherElement, options );
			var scrollHeightTravelDistance = $otherElement.scrollHeightTravelDistance();
			var scrollWidthTravelDistance = $otherElement.scrollWidthTravelDistance();
			var scrollTop = $otherElement.scrollTop();
			var scrollLeft = $otherElement.scrollLeft();
			var scrollWidth = $otherElement.scrollWidth()
			var scrollHeight = $otherElement.scrollHeight()

			var width = this.outerWidth();
			var height = this.outerHeight();
			var otherElementClientWidth = $otherElement.clientWidth();
			var otherElementClientHeight = $otherElement.clientHeight();

			result = $.extend(true, result, this._relativePositionScrollData( width, height, result.top, result.left, otherElementClientWidth, otherElementClientHeight, scrollTop, scrollLeft, scrollWidth, scrollHeight, scrollWidthTravelDistance, scrollHeightTravelDistance ));


			if( options.scaled && hasMatrix ){
				var matrix = result.scaled.matrix;
				var scaleX = matrix.scaleX();
				var scaleY = matrix.scaleY();
				$.extend( true, result.scaled, this._relativePositionScrollData(
					width,
					height,
					result.scaled.top,
					result.scaled.left,
					otherElementClientWidth / scaleX ,
					otherElementClientHeight / scaleY,
					scrollTop / scaleY,
					scrollLeft / scaleX,
					scrollWidth / scaleX,
					scrollHeight / scaleY,
					scrollWidthTravelDistance / scaleX,
					scrollHeightTravelDistance / scaleY
				));
			}

			return result;
		}
	})
})(jQuery);

jQuery.fn.extend({
	/**
	 * quita la clase .expanded cuando se hace click en un elemento externo a ste
	 */
	closeWhenClickOutside: function(){
		$(this).each(function(element){
			var element = $(this);
			$(document.body).click(function(event){
				if($(element).hasClass('expanded')
					&& $(event.target).closest(element).length == 0){
					$(element).removeClass('expanded');
				}
				return $(this);
			});
		});
	},

	/**
	 * determina si un elemento es totalmente visible en la ventana del navegador
	 */
	isScrolledIntoView: function(){
		var visible = $(this).is(':visible'),
			parent = window
			, oldDisplay= $(this).inlineCss('display')

		if(!visible) {
			$(this).show();
		}

		var elem = $(this);
		var docViewTop = $(parent).scrollTop();
		var docViewBottom = docViewTop + $( parent).height();

		var elemTop = $(elem).offset().top;
		var elemBottom = elemTop + $(elem).height();

		if(!visible) {
			$(this).css({display: oldDisplay});
		}

		return ((elemBottom >= docViewTop) && (elemTop <= docViewBottom)
			&& (elemBottom <= docViewBottom) &&  (elemTop >= docViewTop) );
	},



	positionIsRighterThan: function( element ){
		return $(element)[0] && Math.abs( ( $(this).offset().left - ( $(element).offset().left + $(element).outerWidth( true ) ) ) < .5 );
	},

	positionIsLefterThan: function( element ){
		return $(element)[0] && $(element).positionIsRighterThan( $(this) );
	},

	scrollHeight: function(){
		return this.prop('scrollHeight');
	},

	scrollWidth: function(){
		return this.prop('scrollWidth');
	},

	scrollTopPercent: function(){
		var scrollHeight = this.scrollHeight();
		var outerHeight = this.outerHeight();
		var maxScrollHeight = scrollHeight - outerHeight;
		if( arguments.length > 0 ){
			var newScrollPercent = arguments[0];
			var newScroll = newScrollPercent * maxScrollHeight;
			this.scrollTop( newScroll );
			return this;
		}
		var scrollTop = this.scrollTop();
		var result = scrollTop / maxScrollHeight;
		return result;
	},

	scrollLeftPercent: function(){
		var scrollWidth = this.scrollWidth();
		var outerWidth = this.outerWidth();
		var maxScrollWidth = scrollWidth - outerWidth;
		if( arguments.length > 0 ){
			var newScrollPercent = arguments[0];
			var newScroll = newScrollPercent * maxScrollWidth;
			this.scrollLeft( newScroll );
			return this;
		}
		var scrollLeft = this.scrollLeft();
		var result = scrollLeft / maxScrollWidth;
		return result;
	},


	/**
	 * determina si un elemento entra verticalmente en la ventana del navegador
	 */
	fitsVerticallyIntoView: function(){
		return $(window).height() > $(this).outerHeight();
	},

	scrollToBottom: function(element, duration){
		var scroll = $(element).offset().top + $(element).height() - $(this).height();
		return $(this).scrollTo (scroll, duration);
	},

	scrollAtBottom: function(){
		var maxScrollTop = $(this)[0].scrollHeight - $(this).innerHeight();
		return (Math.abs($(this).scrollTop() - maxScrollTop) < 5);
	},

	/**
	 * si el elemento no est visible en la ventana, lo scrollea
	 */
	scrollToViewIfNotVisible: function(time){
		var args = $.makeArray(arguments);
		$(this).each(function(){
			if(!$(this).isScrolledIntoView()){
				var completeArgs = [$(this)].concat(args);
				$.fn.scrollTo.apply($(document.body), completeArgs);
			}
		});
	},

	/**
	 * escrolea la ventana para que el elemento sea visible
	 * @param time
	 */
	scrollToView: function(time){
		var args = $.makeArray(arguments);
		$(this).each(function(){
				var completeArgs = [$(this)].concat(args);
				$.fn.scrollTo.apply($(document.body), completeArgs);
		});
	},


	/**
	 * obtiene un array con todos los atributos de un elemento
	 */
	getAttributes: function() {
		var attributes = {};
		if(!this.length)
			return this;
		$.each(this[0].attributes || [], function(index, attr) {
			attributes[attr.name] = attr.value;
		});
		return attributes;
	},


	/**
	 * efectos
	 */
	blink: function(){
		var args = $.extend([], arguments);
		if(!args[0]) args[0] = {};
		repeat = args[0] && args[0].repeat || 3;
		args[0].duration = args[0].duration || 100;

		$(this).each(function(){
			for (var i=0 ; i< repeat ; i++){
				$.fn.fadeOut.apply($(this), args);
				$.fn.fadeIn.apply($(this), args);
			}
		});
	},


	/**
	 * min
	 * example: $([1,2,3,4]).min()
	 */
	min: function(property){
		var min = null;
		$(this).each(function(index, value){
			//console.debug(value);
			var prop = property ? $(this)[property]() : value;
			if(min === null || value < min) min = prop;
		});
		return min;
	},

	/**
	 * max
	 * example: $([1,2,3,4]).max()
	 */
	max: function(property){
		var max = null;
		$(this).each(function(index, value){
			//console.debug(value);
			var prop = property ? $(this)[property]() : value;
			if(max === null || value > max) max = prop;
		});
		return max;
	},

	/**
	 * apagar las luces y dejar encendidos ciertos elementos. Slo al apagar TODOS los elementos se va el velo
	 * iluminar: $('#mensaje').highlight();
	 * quitar ilmuniacin: $('#mensaje').highlight('off');
	 */
	highlight: function(options){
		var overlay = $('#lights-off-overlay');
		if(!overlay.length){
			overlay = $('<div>')
				.attr('id', 'lights-off-overlay')
				.hide();
			$('body')
				.css({'position': 'relative'})
				.append(overlay);
		}

		switch (options){

			case 'highlighted':
				return $(this).hasClass( 'lights-off-highlighted' );
				break;

			case 'off':
				var self = this;
				if ($('.lights-off-highlighted').not(this).length == 0){
					$(overlay).fadeOut('fast', function(){
						$(self).removeClass('lights-off-highlighted');
					});
				}
				break;

			case undefined:
				$(this).each(function(index, element){
					$(element).addClass('lights-off-highlighted');
				});
				$(overlay).fadeIn('fast');
				break;
		}
		return this;
	},

	outerHTML: function() {
		return $(this).clone().wrap('<div></div>').parent().html();
	},

	dimensionedParent: function(){
		return $($.findInCollection($(this).parents(), function( element ){
			var displayOk = $.inArray($(element).css("display"),['block', 'inline-block'] ) !== -1;
			return  displayOk && $(element).height();
		}));
	},

	localToGlobal: function( includeMargins ){
		var $element = $(this)
			, left, top, right, bottom
			, position = $element.position()
			, width = $element.outerWidth( includeMargins || false )
			, height = $element.outerHeight( includeMargins || false )
			, scrollTop = $(window).scrollTop()
			, scrollLeft = $(window).scrollLeft();
		top = position.top - scrollTop;
		left = position.left - scrollLeft;
		right = left + width;
		bottom = top + height;

		return {top: top, right: right, bottom: bottom, left: left };

	},

	betweenFloats: function(){
		return $(this).prev().css('float') === 'left'
			&& $(this).next().css('float') === 'left';
	},

	betweenInlineBlocks: function(){
		return $(this).prev().css('display') === 'inline-block'
			&& $(this).next().css('display') === 'inline-block';
	},

	getPrevNextProperty: function( property, parameters ){
		var $prev = $(this).prev()
			, $next = $(this).next()
			, prevProp = $prev[property]
			, nextProp = $next[property]
			, result = [];

		if( typeof prevProp === 'function' ) prevProp = prevProp.apply( $prev, parameters );
		if( typeof nextProp === 'function' ) nextProp = nextProp.apply( $next, parameters );

		result.push(prevProp);
		result.push(nextProp);

		result['prev'] = prevProp;
		result['next'] = nextProp;

		return result;
	},

	maxOuterHeightBetween: function( margins ){
		var outerHeights = $(this).getPrevNextProperty('outerHeight', [ margins || false ]);
		return Math.max.apply(Math, outerHeights );
	},

	maxOuterWidthBetween: function( margins ){
		var outerWidths = $(this).getPrevNextProperty('outerWidth', [ margins || false ]);
		return Math.max.apply(Math, outerWidths );
	},

	inlineCss: function( property ){
		return $(this)[0].style[ property ];
	},

	getTransformOrigin: function(){
		var width = $(this).outerWidth(true)
			, height = $(this).outerHeight(true)
			, transformOrigin = $.map( $(this).css('transformOrigin').split(' '), function( data ){ return parseFloat( data ) } )
			, transformOriginPercent = [ transformOrigin[0] / width , transformOrigin[1] / height ]
			, result = {
				left		: transformOrigin[0],
				top			: transformOrigin[1],
				leftProp	: transformOriginPercent[0],
				topProp	: transformOriginPercent[1]
			};

		return result;
	},

	/////////////////////////////////////////////////////////

	/**
	 *
	 */
	translateCoordinatesToElement: function( element, x, y ){
		var global = $(this).localCoordinatesToGlobal( x, y );
		var newRelative = $(element).globalCoordinatesToLocal( global.x, global.y );
		return newRelative;
	},

	/**
	 * transforma coordenadas globales relativas a la pantalla, a coordenadas relativas a este elemento
	 * @param x
	 * @param y
	 * @returns {{}}
	 */
	globalCoordinatesToLocal: function( x, y ){
		var position = this.offset()
			, result = {}
			, localX = x - position.left
			, localY = y - position.top;

		var width = $(this).realOuterWidth()
			, height = $(this).realOuterHeight()
			, relativeCoordinates = this.localCoordinatesToRelative( localX, localY )

		result = {
			x: localX,
			y: localY,
			relativeX: relativeCoordinates.x,
			relativeY: relativeCoordinates.y
		};
		return result;
	},

	/**
	 * transforma coordenadas relativas a este elemento, a coordenadas relativas a la pantalla
	 * @param x
	 * @param y
	 * @returns {{}}
	 */
	localCoordinatesToGlobal: function( x, y ){
		var position = this.offset()
			, result = {}
			, localX = position.left + x
			, localY = position.top + y;

		result = {
			x: localX,
			y: localY
		};
		return result;
	},

	/**
	 * transforma coordenadas relativas a las dimensiones del elemento, a coordenadas en pxeles
	 * @param x
	 * @param y
	 * @returns {{x: number, y: number}|*}
	 */
	relativeCoordinatesToLocal: function( x, y ){
		var width = $(this).realOuterWidth()
			, height = $(this).realOuterHeight()
			, x = x * width
			, y = y * height

		result = {
			x: x,
			y: y
		};
		return result;
	},

	/**
	 * transforma coordenadas en pxeles a valores relativos a las dimensiones de ste elemento.
	 * @param x
	 * @param y
	 * @returns {{x: number, y: number}|*}
	 */
	localCoordinatesToRelative: function( x, y ){
		var width = $(this).realOuterWidth()
			, height = $(this).realOuterHeight()
			, x = x / width
			, y = y / height

		result = {
			x: x,
			y: y
		};
		return result;
	},

	/**
	 * transforma coordeandas relativas a la dimensiones de ste elemento a coordenadas en pxeles relativas a la pantalla
	 * @param x
	 * @param y
	 * @returns {*|{}}
	 */
	relativeCoordinatesToGlobal: function( x, y ){
		var local = this.relativeCoordinatesToLocal(x, y )

		return this.localCoordinatesToGlobal(local.x, local.y);
	},

	dimensions: function( dimensions ){
		var self = this;
		if( arguments.length == 0 ){
			var position = $(this).position();
			dimensions = {
				top		: parseFloat( $(this).css('top') ) || position.top,
				left	: parseFloat( $(this).css('left') ) || position.left,
				width	: $(this).width(),
				height	: $(this).height()
			}
			return dimensions;
		} else {
			return $(this).each( function( index, element ){
				$.each( dimensions, function( key, value ){
					$(element)[key](value);
				});
			});
		}
	},


	/*
		similar a offset(), pero tiene en cuenta el scroll del documento. Devuelve la posicin de un elemento con respecto a la pantalla
	 */
	screenOffset: function( includeMargins ){
		if( this.length ){
			var $element = $(this);
			var position = $element.offset();
			var scroll = {
				'top'	: $(document).scrollTop(),
				'left'	: $(document).scrollLeft()
			}

			position.top -= scroll.top;
			position.left -= scroll.left;

			if( includeMargins ){
				position.top -= parseInt($element.css('marginTop'), 10);
				position.left -= parseInt($element.css('marginLeft'), 10);
			}

			return {'top': position.top, 'left' : position.left };
		}
	},



	/////////////////////////////////////////////////////////

	getMousePosition: function( evt, useOffset ){
		var mousePosition = evt;
		if( evt instanceof $.Event || evt instanceof Event ){
			var mousePosition = $.Event.getMousePosition( evt, useOffset );
		}
		return $(this).globalCoordinatesToLocal(mousePosition.x, mousePosition.y);
	},

	getAbsoluteMousePositionFromLocal: function( position ){
	}
});

(function($){
	//window.testingPerformance = $.getAllQueryStrings().testingPerformance == 1;
	var cacheOutsideWindow = true;
	cacheOutsideWindow = $.getAllQueryStrings().cacheOutsideWindow != 'false';
	var cacheDuration = 5000;

	var cacheValidDate = new Date();

	if( cacheOutsideWindow ){
		$(window).on('resize', $.debounce(100, function(){
			cacheValidDate = new Date();
		}));
	}

	$.extend($.fn,{
		/**
		 * indica si algn lado del elemento est fuera de la ventana, puede ser total (2) , o parcial (1)
		 * @returns {left: , right: , top: , bottom: , any: }
		 */

		_isRelativeOffsetData: function( data ){
			return data && data.offscreen && data.percents && data.onscreen;
		},

		_translateRelativeOffsetToOutsideWindowData: function( relativeOffset ){
			var result = {
				'absoluteBottom'			: relativeOffset.bottom,
				'absoluteLeft'				: relativeOffset.left,
				'absoluteRight'				: relativeOffset.right,
				'absoluteTop'				: relativeOffset.top,
				'absoluteVerticalMiddle'	: relativeOffset.center.top,
				'bottom'					: relativeOffset.percents.top > 1 ? 2 : relativeOffset.percents.bottom > 1 ? 1 : false,
				'coords'					: {
					'absoluteBottom'		: relativeOffset.fromBottom,
					'absoluteLeft'			: relativeOffset.left,
					'absoluteRight'			: relativeOffset.fromRight,
					'absoluteTop'			: relativeOffset.top
				},
				'left'						: relativeOffset.percents.right < 0 ? 2 : relativeOffset.percents.left < 0 ? 1 : false,
				'offscreen'					: {
					'absoluteBottom'		: relativeOffset.offscreen.bottom,
					'absoluteLeft'			: relativeOffset.offscreen.left,
					'absoluteRight'			: relativeOffset.offscreen.right,
					'absoluteTop'			: relativeOffset.offscreen.top,
					'relativeBottom'		: relativeOffset.percents.offscreen.bottom,
					'relativeLeft'			: relativeOffset.percents.offscreen.left,
					'relativeRight'			: relativeOffset.percents.offscreen.right,
					'relativeTop'			: relativeOffset.percents.offscreen.top
				},
				'onscreen'					: {
					'absoluteHeight'		: relativeOffset.onscreen.height,
					'absoluteWidth'			: relativeOffset.onscreen.width,
					'relativeHeight'		: relativeOffset.percents.onscreen.height,
					'relativeWidth'			: relativeOffset.percents.onscreen.width
				},
				'relativeBottom'			: relativeOffset.percents.bottom,
				'relativeHorizontalMiddle'	: relativeOffset.percents.center.left,
				'relativeLeft'				: relativeOffset.percents.left,
				'relativeRight'				: relativeOffset.percents.right,
				'relativeTop'				: relativeOffset.percents.top,
				'relativeVerticalMiddle'	: relativeOffset.percents.center.top,
				'right'						: relativeOffset.percents.left > 1 ? 2 : relativeOffset.percents.right > 1 ? 1 : false,
				'top'						: relativeOffset.percents.bottom < 0 ? 2 : relativeOffset.percents.top < 0 ? 1 : false
			}

			result.visible = result.left < 2 && result.right < 2 && result.top < 2  && result.bottom < 2;

			return result;
		},

		isOutsideWindow: function( containerOrOptions ){
			var relativeOffset;
			if ( this._isRelativeOffsetData( containerOrOptions ) ){
				relativeOffset = containerOrOptions;
			} else {
				var useCache = cacheOutsideWindow;
				var options, container;
				if( $.isPlainObject( containerOrOptions ) ){
					options = containerOrOptions;
					container = options.container;
				} else {
					container = containerOrOptions;
				}

				options = $.extend({
					container				: window,
					offsetTop				: 0,
					offsetBottom			: 0,
					offsetLeft				: 0,
					offsetRight				: 0,
					pullToVertical			: .5,
					pullToVerticalAmount	: 0,
					pullToHorizontal		: .5,
					pullToHorizontalAmount	: 0,

					'useRealDimensions'	:  false
				}, options );

				relativeOffset = $(this).relativeOffset( options.container, options );
			}

			return this._translateRelativeOffsetToOutsideWindowData( relativeOffset );
		}
	})
}(jQuery));

(function($){
	var canHavePositionFixed = $.getAllQueryStrings().canHavePositionFixed != '0';

	if( window.Modernizr ){
		Modernizr.addTest('canClipFixedElements', function() {
			return !!$.browser.chrome;
		});
	}

	$.extend($.fn,{
		canHavePositionFixed: function(){
			var result = canHavePositionFixed;
			if( result ){
				var $element = $(this);
				var $parent = $element.parent();
				var $body = $('body');
				if( $element.is(':visible') && $element.width() && $element.height() ){

					var parentsWithTransforms = $element.parents().filter(function(){ return $(this).css('transform')!='none' });
					if( parentsWithTransforms.length > 0 ){
						result = false;
					} else{
						var bodyPadding = $body.inlineCss('paddingTop');
						var bodyRealPadding = parseFloat( $body.css('paddingTop') );
						var $dummy = $('<div>').css({
							'width'		: '100px',
							'height'	: '1px',
							'position'	: 'fixed',
							'top'		: 0
						});
						$parent.prepend($dummy);

						var offset = $dummy.screenOffset();
						$body.css({'paddingTop' : bodyRealPadding + 1});

						result = $dummy.screenOffset().top == offset.top;

						$body.css({'paddingTop' : bodyPadding });
						$dummy.remove();
					}

				} else {
					result = false;
				}

			}

			////////////////////////////

			return result;
		}

	})
}(jQuery));

(function($){
	$.fn.objectFit = function( options ){
		$element = $(this);
		$parent = $element.parent();
		$parent.css({
			'overflow': 'hidden'
		});
		$element.css({
			'transform'	: ''
		});

		var type = options || 'contain';

		var width = $element.innerWidth();
		var height = $element.innerHeight();
		var parentWidth = $parent.innerWidth();
		var parentHeight = $parent.innerHeight();

		var elementProp = width / height;
		var parentProp = parentWidth / parentHeight;

		var marginTop = ( parentHeight - height ) / 2;
		var marginLeft = ( parentWidth - width) / 2;

		if( type == 'contain'){
			if( elementProp > parentProp ){
				var scale = parentWidth / width;
			} else {
				var scale = parentHeight / height;
			}
		} else if (type == 'cover' ){
			if( elementProp > parentProp ){
				var scale = parentHeight / height;
			} else {
				var scale = parentWidth / width;
			}
		} else if( type == 'none' ){
			scale = 1;
		}

		$element.css({
			'transform'			: {
				'translateX'	: marginLeft + 'px',
				'translateY'	: marginTop + 'px',
				'scale'			: scale
			}
		});

		$element.attr({
			'data-width'	: width,
			'data-height'	: height,
			'data-parent-width'	: parentWidth,
			'data-parent-height'	: parentHeight
		})

	};
}(jQuery));


(function($){
	function clearData( element, name ){
		var cacheName = 'cache.' + name;
		$(element).removeData( cacheName );
	}

	function setData( element, name, value ){
		var cacheName = 'cache.' + name;
		var data = $(element).data( cacheName );
		if( !data ){
			data = {};
			$(element).data( cacheName, data );
		}
		data.value = value;
		data.date = new Date();
	}

	function getData(element, name, callback, timeout) {
		var cacheName = 'cache.' + name;
		var data = $(element).data( cacheName );
		var now = new Date();
		var noTieneData = !data;
		var tieneCallback = !!callback;
		var tieneTimeout = !!timeout;
		var dataDate = $.getObjectProperty( data, 'date' );
		var cacheEsAntiguo = ( dataDate && tieneTimeout ) && ( now - dataDate ) > timeout;
		var value = $.getObjectProperty( data, 'value');
		var dataValueEsInvalido = value === undefined;

		if( cacheEsAntiguo || noTieneData || dataValueEsInvalido ){
			value = callback && callback();
			if( value !== undefined ){
				setData( element, name, value );
			}
		}
		return value;
	}

	$.extend($.fn,{
			'getCache'		: function( name, callback, timeout ){
				return getData( this, name, callback, timeout )
			},
			'setCache'		: function( name, value ){
				return setData( this, name, value )
			},
			'clearCache'	: function( name ){
				return clearData( this, name )
			}
	});
}(jQuery));

/*!
 * !important
 *   github.com/premasagar/important/
 *
 *//*
 css !important manipulator (jQuery plugin)

 by Premasagar Rose
 dharmafly.com

 license
 opensource.org/licenses/mit-license.php

 v0.1

 *//*
 creates methods
 jQuery.important()
 jQuery(elem).important()

 optionally modified the native jQuery CSS methods: css(), width(), height(), animate(), show() and hide(), allowing an optional last argument of boolean true, to pass the request through the !important function

 use jQuery.important.noConflict() to revert back to the native jQuery methods, and returns the overriding methods

 reference
 http://www.w3.org/TR/CSS2/syndata.html#tokenization

 */
(function($){
	'use strict';

	// create CSS text from property & value, optionally inserting it into the supplied CSS rule
	// e.g. declaration('width', '50%', 'margin:2em; width:auto;');
	function cssDeclaration(property, value, rules){ // if value === null, then remove from style; if style then merge with that

		// return a regular expression of a declaration, with the backreferences as the CSS property and the value
		function regexDeclaration(property){
			return new RegExp('(?:^|\\s|;)(' + property + ')\\s*:\\s*([^;]*(?:;|$))', 'i');
		}
		function find(property, rules){
			var match = rules.match(regexDeclaration(property));
			if (match){
				// a bit inelegant: remove leading semicolon if present
				match[0] = match[0].replace(/^;/, '');
			}
			return match;
		}

		var oldDeclaration, newDeclaration, makeImportant;

		rules = rules || '';
		oldDeclaration = find(property, rules);

		if (value === null){
			newDeclaration = '';
		}
		else if (typeof value === 'string'){
			newDeclaration = property + ':' + value + ' !important;';
		}

		if (oldDeclaration){
			if (typeof value === 'boolean'){
				makeImportant = value;
				newDeclaration = $.important(property + ':' + oldDeclaration[2], makeImportant);
			}
			rules = rules.replace(oldDeclaration[0], newDeclaration);
		}

		else if (typeof newDeclaration !== 'undefined'){
			rules = $.trim(rules);
			if (rules !== ''){
				if (rules.slice(-1) !== ';'){
					rules += ';';
				}
				rules += ' ';
			}
			rules += newDeclaration;
		}
		return rules;
	}


	// Add !important to CSS rules if they don't already have it
	function toImportant(rulesets, makeImportant){
		// Cache regular expression
		var re = toImportant.re;
		if (!re){
			re = toImportant.re =
				/\s*(! ?important)?[\s\r\t\n]*;/g;
			// TODO: Make this regexp handle missing semicolons at the end of a ruleset
		}
		if (makeImportant === false){
			return rulesets.replace(re, ';');
		}
		return rulesets.replace(re, function($0, $1){
			return $1 ? $0 : ' !important;';
		});
	}

	function htmlStylesToImportant(html, makeImportant){
		// Cache regular expression
		var re = htmlStylesToImportant.re;
		if (!re){
			re = htmlStylesToImportant.re =
				/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;
		}
		return html.replace(re, function($0, rulesets){
			return toImportant(rulesets, makeImportant);
		});
	}

	// **
	var
		important = false,
		original = {},
		controller = {},
		replacement = $.each(
			{
				css:
					function(property, value){
						var
							rulesHash = {},
							elem = $(this),
							rules = elem.attr('style');

						// Create object, if arg is a string
						if (typeof property === 'string'){
							// CSS lookup
							if (typeof value === 'undefined'){
								return original.css.apply(this, arguments);
							}

							rulesHash[property] = value;
						}
						else if (typeof property === 'object'){
							rulesHash = property;
						}
						else {
							return elem;
						}
						$.each(rulesHash, function(property, value){
							rules = cssDeclaration(property, value, rules);
						});
						return elem.attr('style', rules);
					}

				// TODO: other methods to be supported
			},

			function(method, fn){
				original[method] = $.fn[method];
				fn.overridden = true; // for detecting replacementn state

				controller[method] = function(){
					var
						args = $.makeArray(arguments),
						lastArg = args[args.length-1],
						elem = $(this);

					// boolean true passed as the last argument
					if (lastArg === true){
						return fn.apply(elem, args.slice(0,-1));
					}
					// $.important() === true && boolean false not passed
					else if (important && lastArg !== false){
						return fn.apply(elem, args);
					}
					// apply original, native jQuery method
					return original[method].apply(elem, args);
				};
			}
		);

	// Override the native jQuery methods with new methods
	/*
	$.extend($.fn, controller);
	*/


	var originalCSS = $.fn.css;
	$.fn.css = function( property, value ){
		if($.isPlainObject( property )){
			var self = this;
			var importants = [];
			var properties = $.extend({}, property );
			$.each( properties, function( prop, value ){
				if(typeof value == 'string' && $.string.endsWith( value, '!important')){
					importants.push( prop );
					properties[prop] = value.replace('!important', '');
				}
			});
			var args = $.makeArray( arguments );
			args[0] = properties;
			var result = originalCSS.apply( this, args );
			$.each( importants, function(index, prop ){
				$(self).important( prop );
			});
			return result;
		} else return originalCSS.apply( this, arguments );
	}



	// jQuery.important
	$.important = $.extend(
		function(){
			var
				args = $.makeArray(arguments),
				makeImportant, cacheImportant;

			if (typeof args[0] === 'string'){
				if (typeof args[1] === 'undefined' || typeof args[1] === 'boolean'){
					makeImportant = (args[1] !== false);

					return (/<\w+.*>/).test(args[0]) ?
						htmlStylesToImportant(args[0], makeImportant) :
						toImportant(args[0], makeImportant);
				}
			}

			// If a function is passed, then execute it while the !important flag is set to true
			else if ($.isFunction(args[0])){
				cacheImportant = important;
				$.important.status = important = true;
				args[0].call(this);
				$.important.status = important = cacheImportant;
			}

			else if (typeof args[0] === 'undefined' || typeof args[0] === 'boolean'){
				$.important.status = important = (args[0] !== false);
			}

			return important;
		},
		{
			status: important,

			// release native jQuery methods back to their original versions and return overriding methods
			noConflict: function(){
				$.each(original, function(method, fn){
					$.fn[method] = fn;
				});
				return replacement;
			},

			declaration: cssDeclaration
		}
	);


	// jQuery(elem).important()
	$.fn.important = function(method){
		var
			elem = $(this),
			args = $.makeArray(arguments).concat(true),
			nodeName = elem.data('nodeName'),
			property, makeImportant, fn, oldStyleElem, newStyleInsert, newStyleInsertVerb;

		// .css() is the default method, e.g. $(elem).important({border:'1px solid red'});
		if (typeof method === 'undefined' || typeof method === 'boolean'){
			// special behaviour for specific elements
			if (!nodeName){
				nodeName = elem.attr('nodeName').toLowerCase();
				elem.data('nodeName', nodeName);
			}
			// style elements
			if (nodeName === 'style'){
				makeImportant = (method !== false);

				elem.html(
					toImportant(elem.html(), makeImportant)
				);

				var stylesheet = elem.attr('sheet');
				if (stylesheet && stylesheet.cssRules){
					$.each(stylesheet.cssRules, function(i, rule){
						if (rule.type === CSSRule.STYLE_RULE){
							rule.style.cssText = $.important(rule.style.cssText, makeImportant);
						}
					});
				}
			}
			else {
				elem.attr(
					'style',
					$.important(elem.attr('style'), method)
				);
			}
			return elem;
		}
		else if (typeof method === 'object'){
			args.unshift('css');
			return elem.important.apply(this, args);
		}
		else if (typeof method === 'string'){
			if ($.isFunction(controller[method])){
				args = args.slice(1);
				controller[method].apply(elem, args);
			}
			// switch the !important statement on or off for a particular property in an element's inline styles - but instead of elem.css(property), they should directly look in the style attribute
			// e.g. $(elem).important('padding');
			// e.g. $(elem).important('padding', false);
			else if (typeof args[1] === 'undefined' || typeof args[1] === 'boolean'){
				property = method;
				makeImportant = (args[1] !== false);

				elem.attr(
					'style',
					cssDeclaration(property, makeImportant, elem.attr('style'))
				);
			}
		}
		// pass a function, which will be executed while the !important flag is set to true
		/* e.g.
		 elem.important(function(){
		 $(this).css('height', 'auto');
		 });
		 */
		else if ($.isFunction(method)){
			fn = method;
			$.important.call(this, fn);
		}

		return elem;
	};
}(jQuery));



///////////////////////////////////////////////////
/**
 agregado para que CSS permita pasar transform como un objeto.
 Ejemplo: $(element).css({
 	transform	: {
 		scale: .5,
 		rotate	: '15deg'
 	}
 })
 */

(function($){
	function mapProperty( value, property ){
		return property+'(' + value + ')'
	}

	function transformObjectToString( transformObject ){
		return $.map( transformObject, mapProperty ).join(' ');
	}

	$.cssTransform = function( transformValue ){
		var transformValueString = transformValue;
		if( typeof transformValueString != 'string' ){
			if($.isPlainObject( transformValue )){
				transformValueString = transformObjectToString( transformValue );
			} else if( $.isArray( transformValue ) ){
				transformValueString = $.map( transformValue, function( transformObject ){
					return transformObjectToString( transformObject )
				}).join(' ');
			}
		}
		return transformValueString ;
	};

	var originalCSS = $.fn.css;


	$.fn.css = function( propertyName, value){
		//var args = $.makeArray( arguments );
		var args = arguments;
		if($.isPlainObject( propertyName ) ){
			if( 'transform' in propertyName ){
				var transformValue = propertyName['transform'];
				propertyName['transform'] = $.cssTransform( transformValue );
			}
		} else if( typeof propertyName == 'string' && args.length == 2){
			if( propertyName == 'transform' ){
				args[1] = $.cssTransform( value );
			}
		}

		return originalCSS.apply( this, args );
	}

})(jQuery);


(function($){
	$.cssBackgroundPositionWithOffset = function( bgPosH, bgPosV, backgroundPositionOffsetX, backgroundPositionOffsetY ){
		if( !$.string.getNumberValueUnit(bgPosH) ) bgPosH += '%';
		if( !$.string.getNumberValueUnit(bgPosV) ) bgPosV += '%';
		backgroundPositionOffsetX = backgroundPositionOffsetX || 0;
		backgroundPositionOffsetY = backgroundPositionOffsetY || 0;

		var newBgPosHOffset = parseFloat( backgroundPositionOffsetX );
		var newBgPosH = 'calc(' + bgPosH + (newBgPosHOffset > 0 ? ' + ' : ' - ' ) + Math.abs(newBgPosHOffset) +'px)';

		var newBgPosVOffset = parseFloat( backgroundPositionOffsetY );
		var newBgPosV = 'calc(' + bgPosV + (newBgPosVOffset > 0 ? ' + ' : ' - ' ) + Math.abs(newBgPosVOffset) +'px)';

		return [newBgPosH, newBgPosV].join(' ');
	}


	function arrayToMatrixArray( arr ){
		if( arr.length > 6 ){
			return array3dToMatrix2dArray( arr );
		} else {
			return array2dToMatrixArray( arr );
		}
	}

	function array2dToMatrixArray( arr ){
		var result = $.extend([], arr );
		result.a = result[0];
		result.b = result[1];
		result.c = result[2];
		result.d = result[3];
		result.tx = result[4];
		result.ty = result[5];
		return result;
	}

	function array3dToArray2d( arr ){
		var partition = $.arrayPartition( arr ,4);
		var result = partition.map( function( e ){ return e.slice(0,2)});
		return Array.prototype.concat.apply([], result);
	}

	function array3dToMatrix2dArray( arr ){
		var array2d = array3dToArray2d( arr );
		return array2dToMatrixArray( array2d );
	}

	function matrixToArray( matrix ){
		var result = [];
		result[0] = matrix.a;
		result[1] = matrix.b;
		result[2] = matrix.c;
		result[3] = matrix.d;
		result[4] = matrix.tx;
		result[5] = matrix.ty;
		return arrayToMatrixArray( result );
	}

	$.fn.cssHasTransform = function(){
		var transform = this.css('transform');
		var hasTransform  = $.inArray( transform, ['none', '', undefined, null ] ) == -1;
		return hasTransform;
	};

	$.fn.transformMatrixValues = function(){
		var transform = $(this).css('transform');
		var transformValues = transform.match(/matrix(3d)?\((.*)\)/);
		transformValues = transformValues && transformValues[2];
		return transformValues && transformValues.match(/-?[\d\.]+/g);
	}

	$.fn.transformMatrix = function( matrix ){
		if( arguments.length == 0 ){
			var transform = $(this).css('transform');
			var transformValues = transform.match(/matrix(3d)?\((.*)\)/);
			transformValues = transformValues && transformValues[2];
			var transformArray = transformValues && transformValues.match(/-?[\d\.]+/g);
			var result = [1,0,0,1,0,0];
			if( transformArray ) {
				result = $.map( transformArray, function( value, key ){ return parseFloat( value )});
			}
			result = arrayToMatrixArray( result );
			return result;
		} else {
			$(this).css('transform', 'matrix(' + matrix.join(',') + ')');
		}
	}

	/**
	 * obtiene o establece la trasformacin del elemento
	 * @param matrix
	 * @returns Matrix
	 */
	$.fn.transformMatrixM = function( matrix ){
		var result;
		if( arguments.length > 0 ){
			result = $(this).transformMatrix( matrixToArray( matrix ) );
		} else {
			result = $(this).transformMatrix();
		}
		//var result = $(this).transformMatrix.apply( $(this), arguments);

		result = Matrix.apply( Matrix, result );
		var rad = result.rad();
		var scaleX = result.scaleX();
		var scaleY = result.scaleY();
		var rotateMatrix = Matrix.rotation( rad );
		var scaleMatrix = Matrix.scale( scaleX, scaleY );
		var resultMatrix = rotateMatrix.concat( scaleMatrix );
		resultMatrix.tx = result.tx;
		resultMatrix.ty = result.ty;

		return resultMatrix;
	};

	/**
	 * obtiene la transformacin acumulada del elemento
	 */
	$.fn.cumulativeTransformMatrixM = function( until ){
		var result = Matrix.IDENTITY;
		var cacheDuration = 100;
		var parentsWithTransform;

		var $this = $(this);
		if( !$.isWindow( $(this)[0] ) ){

			if(!until){
				parentsWithTransform = $this.getCache('cumulativeTransformMatrixM.parents', function(){
					return $this.parents().filter( function(){
						return $(this).cssHasTransform()
					});
				}, cacheDuration );
			} else {
				parentsWithTransform = $this.parentsUntil( until ).filter( function(){
					return $(this).cssHasTransform();
				});
			}


			$.each( parentsWithTransform, function( index, parent ){
				result = result.concat( $(parent).transformMatrixM() );
			});
			/*
			 var parents = $(this).parents();
			 result = $(this).transformMatrixM();
			 $.each( parents, function( index, parent ){
			 result = result.concat( $(parent).transformMatrixM() );
			 });
			 */
		}

		return result;
	};

	$.fn.relativeTransformMatrixM = function( parent ){
		var thisM = $(this).cumulativeTransformMatrixM();
		var result = thisM;
		if( !$.isWindow( $(parent)[0] ) ){
			var parentM = $(parent).cumulativeTransformMatrixM();
			result = thisM.concat( parentM.inverse() );
		}
		return result;
	};

	$.fn.toPixelPosition = function(){
		return $.each( this, function(){
			var matrix = $(this).transformMatrix();
			$(this).css({
				transform: 'none'
			});

			//var position = $(this).position();

			var top = parseFloat( $(this).css('top') ) || 0;
			var left = parseFloat( $(this).css('left') ) || 0;

			$(this).css({
				top	: top + matrix.ty + 'px',
				left: left + matrix.tx + 'px'
			});

			if( $(this).css('position') == 'static' ){
				$(this).css('position', 'relative');
			}
		});
	}

})(jQuery);



/*
 NOTES:
 http://dev.w3.org/csswg/cssom/#dom-cssstyledeclaration-getpropertypriority
 $('style')[0].sheet.cssRules[0].style.getPropertyPriority('color');
 cssText on style object possible
 */

(function($){
	$.fn.extend({
		// width without scrollbars
		'clientWidth' : function(){
			var result;
			var element = $(this)[0];
			if( element ){
				if( $.isWindow( element ) ){
					result = document.documentElement.clientWidth;
				} else {
					result =  element.clientWidth;
				}
			}
			return result;
		},

		// height without scrollbars
		'clientHeight' : function(){
			var result;
			var element = $(this)[0];
			if( element ) {
				if ($.isWindow(element)) {
					result = document.documentElement.clientHeight;
				} else {
					result = element.clientHeight;
				}
			}
			return result;
		},
	});
})(jQuery);

/**
 * fix para obtener el temao correcto de la ventana
 */
(function($){
	var width = $.fn.width;
	var height = $.fn.height;
	var innerHeight = $.fn.innerHeight;
	var innerWidth = $.fn.innerWidth;

	var viewport = {
		'width'		: 0,
		'height'	: 0
	}

	function calcViewportSize(){
		/*
		viewport = {
			'width'			: ( window.document && window.document.body && window.document.body.clientWidth ) || document.documentElement.clientWidth,
			'height'		: ( window.document && window.document.body && window.document.body.clientHeight ) || document.documentElement.clientHeight
		}*/
		viewport.width = $(window).clientWidth();
		viewport.height = $(window).clientHeight();
	}

	$(window).on('resize', calcViewportSize);
	calcViewportSize();

	function isWindow( what ){
		if( what instanceof jQuery ){
			what = what[0];
		}
		return $.isWindow(what);
	}

	if($._replace !== false ) {
		function replace(method, newFn) {
			if ($.isArray(method)) {
				$.each(method, function (i, method) {
					replace(method, newFn)
				})
			} else {
				var old = $.fn[method];
				$.fn[method] = function () {
					if ($._replace !== false && isWindow(this) && arguments.length == 0) {
						return newFn(this);
					} else {
						return old.apply(this, arguments);
					}
				}
			}
		}

		// todo: buscar la forma ms rpida de obtener el rea visible del viewport
		replace(['height', 'innerHeight', 'outerHeight'], function () {
			return viewport.height;
			//return ( window.document && window.document.body && window.document.body.clientHeight ) || document.documentElement.clientHeight;
			//return $.getObjectProperty(window,'document.body.clientHeight') || $.getObjectProperty(window,'document.documentElement.clientHeight');
		});

		replace(['width', 'innerWidth', 'outerWidth'], function () {
			return viewport.width;
			//return ( window.document && window.document.body && window.document.body.clientWidth ) || document.documentElement.clientWidth;
			//return $.getObjectProperty(window,'document.body.clientWidth') || $.getObjectProperty(window,'document.documentElement.clientWidth');
			//return document.body.clientWidth || document.documentElement.clientWidth;
		});

		replace(['scrollWidth'], function () {
			return $(document).width();
		});

		replace(['scrollHeight'], function () {
			return $(document).height();
		});
	}



})(jQuery);


$.extend($.Event, {
	getMousePosition: function( e, useOffset ){
		var x, y;

		if(useOffset){
			x = (e.offsetX != null) ? e.offsetX : e.originalEvent.layerX;
			y = (e.offsetY != null) ? e.offsetY : e.originalEvent.layerY;
		} else {
			x = e.pageX;
			y = e.pageY;

		}

		return { x: x, y: y}
	}
})

function isLandscape() {
	return (window.orientation === 90 || window.orientation === -90);
}


$.fn.ghostTo = function(target, duration, complete){
	var duration = duration || 1000;
	var transformFn = ( $.fn.ghostTo.options.transit && $.fn.transit ) && !$.browser.msie ? 'transit' : 'animate'; // IE no funciona con transit

	var target = $(target);
	var self = this;

	$(target).each(function(){
		var target = $(this);

		$(self).each(function(){
			var element = $(this);

			var source = $(element);
			var oldDisplay = $(source).css('display');
			$(source).css({display: 'block'});
			var clone = $(source).clone();
			var positionSource = $(source).offset();
			var positionTarget = $(target).offset();

			$('body').append(clone);

			var targetWidth = $(target).outerWidth();
			var targetHeight = $(target).outerHeight();

			var oldDisplay = $(source).css({display: oldDisplay});

			$(clone).css({
				top			: positionSource.top,
				left		: positionSource.left,
				width		: $(source).width(),
				height		: $(source).height(),
				position	: 'absolute',
				display		: 'block',
				opacity		: 0,
				zIndex		: 2000,
				background	: 'rgba(128,128,128,.2)'
			});
			$(clone).addClass('animating').addClass('in');

			$(clone).animate({
				opacity		: 1
			}, 300, function(arguments){
				$(clone).removeClass('in');
			})
				[transformFn]({
				top			: positionTarget.top,
				left		: positionTarget.left,
				width		: targetWidth,
				height		: targetHeight,
				opacity		: .5
			}, duration, function(arguments){
				$(clone).addClass('out');
			})
				.animate({
					opacity : 0
				}, 300, function(){
					$(clone).remove();
					complete && complete.apply(this, arguments);
				}
			);
		});

	});
	return $(this);
};
$.fn.ghostTo.options = {
	transit: false
};
////////////////////////////////////////////////////////////////////////////////



$.fn.soulUp = function(options){
	var transformFn = $.fn.transit ? 'transit' : 'animate';
	var duration = $.isNumeric(options) ? options : (options && options.duration) || 1000;
	var options = $.extend({
	}, options);

	$(this).each(function(){
		var element = $(this);
		var marginTop = 0; //parseFloat($(element).css('marginTop')) || 0;
		var marginTopDest = marginTop -  20;
		var clone = $(element).clone();
		$(clone)
			.insertBefore($(element))
			.show()
			.css({position:'absolute', opacity:0, marginTop:marginTop})
			.delay(options.delay)
			[transformFn]({opacity:1},1)
			[transformFn]({marginTop:marginTopDest, opacity:0}, duration, function(){
				$(clone).remove();
			})
	});
	return $(this);
};
$.fn.getInlineStyleAsJson = function(){
	var element = $(this);

	element = element || false;
	if(!element){
		return {};
	}

	var css = {}
	, retrievedStyleProp = $(element).attr('style')
	, i
	, pair
	, propName
	, propVal;

	retrievedStyleProp = jQuery.trim(retrievedStyleProp);

	if(retrievedStyleProp.length < 1){
		return {};
	}

	retrievedStyleProp = retrievedStyleProp.split(';');

	for(i in retrievedStyleProp){
		if(retrievedStyleProp.hasOwnProperty(i)){
			pair = retrievedStyleProp[i].split(':');

			if(pair[0] && pair[1]){
				propName = jQuery.trim(pair[0]);
				propVal = jQuery.trim(pair[1]);
				css[propName] = propVal;
			}
		}
	}

	var margin = (css.margin || '').split(' ');
	css['margin-top'] = css['margin-top'] || margin[0];
	css['margin-right'] = css['margin-right'] || margin[1] || margin[0];
	css['margin-bottom'] = css['margin-bottom'] || margin[2] || css['margin-top'];
	css['margin-left'] = css['margin-left'] || margin[3] || css['margin-right'];

	return css;
};


//////// autoscroll
(function ($) {
	AutoScroll = $.Class({
		init: function(element, options) {
			this.element = $(element)[0];
			this.options = $.extend({
				to: 'bottom',
				interval: 100,
				snap: 50
			}, options);

			this.checkInterval = null;
		},

		destroy: function() {
			this.stop();
			$(this.element).removeData('autoscroll');
		},
		////////////////////////////////////////////////////////////////////////////

		_checkForScroll: function() {
			var $element = $(this.element),
				scrollAndDelta = this._getScrollAndDelta(),
				deltaScroll = scrollAndDelta.delta,
				newScroll	= scrollAndDelta.scroll;

			if (deltaScroll < this.options.snap) {
				$element.scrollTop( newScroll );
			}
		},

		_getScrollAndDelta: function(){
			var $element = $(this.element),
					totalHeight = this.element.scrollHeight,
					visibleHeight = $element.innerHeight(),
					scrollTop = $element.scrollTop(),
					deltaBottom = totalHeight - (visibleHeight + scrollTop),
					deltaTop = scrollTop,
					deltaScroll = ( this.options.to === 'bottom' ? deltaBottom : deltaTop ),
					newScroll = ( this.options.to === 'bottom' ? totalHeight : 0 );

			return {delta: deltaScroll, scroll: newScroll};
		},

		_doScroll: function( newScroll ){
			var $element = $(this.element);

			if( newScroll === undefined ){
				newScroll = this._getScrollAndDelta().scroll;
			}
			$element.scrollTop(newScroll);
		},
		////////////////////////////////////////////////////////////////////////////

		start: function() {
			var self = this;

			this.stop();
			this._doScroll();

			this.checkInterval = setInterval(function() {
				self._checkForScroll();
			}, this.options.interval);

		},
		stop: function() {
			clearInterval(this.checkInterval);
			this.checkInterval = null;
		}
	});



	$.fn.autoscroll = function(option) {
		return this.each(function() {
			var $this = $(this)
					, data = $this.data('autoscroll')
					, options = $.extend({}, $.fn.autoscroll.defaults, $this.data(), typeof option == 'object' && option);

			if (!data)
				$this.data('autoscroll', (data = new AutoScroll(this, options)));
			if (typeof option == 'string')
				data[option]();
			else if (options.start)
				data.start();
		});
	};

	$.fn.autoscroll.defaults = {
		start: true
	};

	$.fn.autoscroll.Constructor = AutoScroll;
})(jQuery);


(function ($) {
	$.fn.printme = function () {
		return this.each(function () {
			var container = $(this);

			var hidden_IFrame = $('<iframe></iframe>').attr({
				width: '1px',
				height: '1px',
				display: 'none'
			}).appendTo(container);

			var myIframe = hidden_IFrame.get(0);

			var script_tag = myIframe.contentWindow.document.createElement("script");
			script_tag.type = "text/javascript";
			script = myIframe.contentWindow.document.createTextNode('function Print(){ window.print(); }');
			script_tag.appendChild(script);

			myIframe.contentWindow.document.body.innerHTML = container.html();
			myIframe.contentWindow.document.body.appendChild(script_tag);

			myIframe.contentWindow.Print();
			hidden_IFrame.remove();

		});
	};

	$.fn.selectText = function() {
		return this.each( function(){
			var node = $( this )[0];
			if(node.nodeName === 'INPUT'){
				$(this).select();
			} else {
				if (document.selection) {
					var range = document.body.createTextRange();
					range.moveToElementText(node);
					range.select();
				} else if (window.getSelection) {
					var range = document.createRange();
					range.selectNodeContents(node);
					window.getSelection().removeAllRanges();
					window.getSelection().addRange(range);
				}
			}
		});
	};

})(jQuery);

(function ($) {
	function fixsize(){
		$(this).width($(this).width());
	}

	function unfixsize(){
		$(this).width('');
	}

	$.extend($.fn, {
		tableFixHeaderSize: function(){
			return this.each( function(){
				$(this).find('thead tr th').each( fixsize );
			});
		},

		tableUnfixHeaderSize: function(){
			return this.each( function(){
				$(this).find('thead tr th').each( unfixsize );
			});
		},

		tableFixRowSize: function(){
			return this.each( function(){
				$(this).children().each( fixsize );
			});
		},

		tableUnfixRowSize: function(){
			return this.each( function(){
				$(this).children().each( unfixsize );
			});
		}

	})
})(jQuery);


////////////////////////////////////////////////////////////////////////////////////////////////
// jQuery //
////////////////////////////////////////////////////////////////////////////////////////////////



jQuery.JSON = jQuery.JSON || {};
jQuery.extend(jQuery.JSON, {
	/**
	 *	permite almacenar objetos en cookies
	 */
	cookie: function(name, value, options) {
		if (typeof value != 'undefined'){
			var value = value === null ? null : jQuery.toJSON(value);
			return jQuery.cookie(name, value, options);
		} else {
			var result;
			try{
				result = jQuery.parseJSON(jQuery.cookie(name));
			} catch(e){}
			return result;
		}
	}
});


(function($){$.toJSON=function(o)
{if(typeof(JSON)=='object'&&JSON.stringify)
	return JSON.stringify(o);var type=typeof(o);if(o===null)
	return"null";if(type=="undefined")
	return undefined;if(type=="number"||type=="boolean")
	return o+"";if(type=="string")
	return $.quoteString(o);if(type=='object')
{if(typeof o.toJSON=="function")
	return $.toJSON(o.toJSON());if(o.constructor===Date)
{var month=o.getUTCMonth()+1;if(month<10)month='0'+month;var day=o.getUTCDate();if(day<10)day='0'+day;var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10)hours='0'+hours;var minutes=o.getUTCMinutes();if(minutes<10)minutes='0'+minutes;var seconds=o.getUTCSeconds();if(seconds<10)seconds='0'+seconds;var milli=o.getUTCMilliseconds();if(milli<100)milli='0'+milli;if(milli<10)milli='0'+milli;return'"'+year+'-'+month+'-'+day+'T'+
	hours+':'+minutes+':'+seconds+'.'+milli+'Z"';}
	if(o.constructor===Array)
	{var ret=[];for(var i=0;i<o.length;i++)
		ret.push($.toJSON(o[i])||"null");return"["+ret.join(",")+"]";}
	var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number")
	name='"'+k+'"';else if(type=="string")
	name=$.quoteString(k);else
	continue;if(typeof o[k]=="function")
	continue;if(typeof o[k]=='undefined')
	continue;var val=$.toJSON(o[k]);pairs.push(name+":"+val);}
	return"{"+pairs.join(", ")+"}";}};$.evalJSON=function(src)
{if(typeof(JSON)=='object'&&JSON.parse)
	return JSON.parse(src);return eval("("+src+")");};$.secureEvalJSON=function(src)
{if(typeof(JSON)=='object'&&JSON.parse)
	return JSON.parse(src);var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,'@');filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']');filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,'');if(/^[\],:{}\s]*$/.test(filtered))
	return eval("("+src+")");else
	throw new SyntaxError("Error parsing JSON, source is not valid.");};$.quoteString=function(string)
{if(string.match(_escapeable))
{return'"'+string.replace(_escapeable,function(a)
{var c=_meta[a];if(typeof c==='string')return c;c=a.charCodeAt();return'\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"';}
	return'"'+string+'"';};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'};})(jQuery);


/**
 * crea namespaces sin sobreescribir los existentes
 */
jQuery.namespace = function() {
	var a=arguments, o=null, i, j, d;
	for (i=0; i<a.length; i=i+1) {
		d=a[i].split(".");
		o=window;
		for (j=0; j<d.length; j=j+1) {
			o[d[j]]=o[d[j]] || {};
			o=o[d[j]];
		}
	}
	return o;
};


/** String functions
 * @author: Lisandro Puzzolo
 */
$.extend($.namespace('$.string'), {
	startsWith: function(string, fragment){
		if( typeof string != 'string' ) return false;
		return string.substr(0, fragment.length) == fragment;
	},

	endsWith: function(string, fragment){
		if( typeof string != 'string' ) return false;

		var start = string.length - fragment.length,
			length = fragment.length;

		return string.substr( start, length ) === fragment;
	},

	trimFirst: function(string, fragment){
		if (this.startsWith(string, fragment)){
			return string.substr(fragment.length);
		}
		return string;
	},

	trimLast: function(string, fragment){
		if (this.endsWith(string, fragment)){
			return string.substr(0, string.length - fragment.length);
		}
		return string;
	},

	trimFromFirst: function(string, fragment){
		var i = string.indexOf(fragment);
		if(i != -1){
			return string.substr(0,i);
		}
		return string;
	},

	trimFromLast: function(string, fragment){
		var i = string.lastIndexOf(fragment);
		if(i != -1){
			return string.substr(0,i);
		}
		return string;
	},

	trimToFirst: function(string, fragment){
		var i = string.indexOf(fragment);
		if(i != -1){
			return string.substr(i + fragment.length);
		}
		return string;
	},

	trimToLast: function(string, fragment){
		var i = string.lastIndexOf(fragment);
		if(i != -1){
			return string.substr(i + fragment.length);
		}
		return string;
	},


	replace: function(string, find, replacement){
		return string.split(find).join(replacement);
	},



	toHTML: function( string ){
		var result = string;
		if( !this.isHTML( string ) ){
			result = $.string.replace( string, '\n', '<br/>');
		}
		return result;
	},

	capitalize: function(string){
	   return string.charAt(0).toUpperCase() + string.slice(1);
	},

	repeat: function(string, times){
		var result = [];
		var times = times !== undefined ? times : 0;
		for (var i = 0; i < times ; i++){
			result.push(string);
		}
		return result.join('');
	},

	truncate: function( string, limit, dots ){
		var dots = dots || "...",
			string = string || '';

		if(string.length > limit)
		{
		  string = string.substring(0,limit) + dots;
		}

		return string;
	},

	dasherize: function( string, dash ){
		if( dash === undefined ) dash = '-';
		return ( string || '' ).replace( /([a-z])([A-Z])/g, "$1" + dash + "$2" ).toLowerCase();
	},

	format: function(source, params) {
		if ( arguments.length === 1 )
			return function() {
				var args = $.makeArray(arguments);
				args.unshift(source);
				return $.string.format.apply( this, args );
			};
		if ( arguments.length > 2 && params.constructor !== Array  ) {
			params = $.makeArray(arguments).slice(1);
		}
		if ( params.constructor !== Array && !$.isPlainObject( params ) ) {
			params = [ params ];
		}
		$.each(params, function(i, n) {
			source = source.replace(new RegExp("\\{" + i + "\\}", "g"), n);
		});
		return source;
	},

	padNumber: function( number, digits ){
		var result = number.toString();
		result = $.string.repeat('0', digits - result.length ) + result;
		return result;
	},

	noTildes: function( string ){
		var result = string;

		result = string.replace(//g, "A").replace(//g, "E").replace(//g, "I").replace(//g, "O").replace(//g, "U")
			.replace(//g, "a").replace(//g, "e").replace(//g, "i").replace(//g, "o").replace(//g, "u");
		return result;

	},

	removeAtStart: function( string, fragment ){
		var result = string;
		if(fragment && $.string.startsWith(string, fragment)){
			string = string.substr(fragment.length);
		}
		return string;
	},

	decodeJSON: function( text ){
		try {
			return JSON.parse('"' + text + '"');
		} catch(e){
			return text;
		}
	},

	formatMeses: function(meses){
        var anios
            , meses = parseInt(meses);

        if( meses % 12 === 0){
            anios = meses / 12;
            return i18n.kot( 'global:format.meses.n_anios' , { count: anios, context: String( anios ) } );
        } else {
            return i18n.kot( 'global:format.meses.n_meses' , { count: meses, context: String( meses ) } );
        }
	},


	/*
	ejemplo: $.string.getNumberValueUnit('3px'); // 'px'
	*/
	getNumberValueUnit: function( value ){
		var result = '';

		if(typeof value == 'string'){
			var re = /(\d+(\.\d+)?)(.*)/
				, matched = ( value || '' ).match( re );

			if( matched && matched.length == 4 ){
				result = $.trim( matched[3] );
			}
		}
		return result;
	},

	getCSSBackgroundImage: function( bgImage  ){
		var re = /url\(["']?([^"'\)]*)["']?\)/ig;
		var exeq = re.exec( bgImage );
		return exeq && exeq[1];
	},

	isValidHTMLAttName: function( name ){
		return name && /^[a-zA-Z][\w:.-]*$/.test(name);
	}

});

(function($){

	var entityMap = {
		/*"&": "&amp;",
		"<": "&lt;",
		">": "&gt;",*/
		'"': '&quot;',
		"'": '&#39;',
		"/": '&#x2F;'
	};

	function escapeHtml(string) {
		return String(string).replace(/["'\/]/g, function (s) {
			return entityMap[s];
		});
	}

	$.extend($.string, {
		decodeHTML: function(string){
			return $('<div>').html(string).text();
		},

		encodeHTML: function( string ){
			var result = $('<div>').text( string ).html();
			return escapeHtml( result );
		},

		isHTML : function( string ){
			return $.string.decodeHTML( string ) != string;
		},

	
		stripTags: function (input, allowed) {
			// eslint-disable-line camelcase
			//  discuss at: http://locutus.io/php/strip_tags/
			// original by: Kevin van Zonneveld (http://kvz.io)
			// improved by: Luke Godfrey
			// improved by: Kevin van Zonneveld (http://kvz.io)
			//    input by: Pul
			//    input by: Alex
			//    input by: Marc Palau
			//    input by: Brett Zamir (http://brett-zamir.me)
			//    input by: Bobby Drake
			//    input by: Evertjan Garretsen
			// bugfixed by: Kevin van Zonneveld (http://kvz.io)
			// bugfixed by: Onno Marsman (https://twitter.com/onnomarsman)
			// bugfixed by: Kevin van Zonneveld (http://kvz.io)
			// bugfixed by: Kevin van Zonneveld (http://kvz.io)
			// bugfixed by: Eric Nagel
			// bugfixed by: Kevin van Zonneveld (http://kvz.io)
			// bugfixed by: Tomasz Wesolowski
			//  revised by: Rafa Kukawski (http://blog.kukawski.pl)
			//   example 1: strip_tags('<p>Kevin</p> <br /><b>van</b> <i>Zonneveld</i>', '<i><b>')
			//   returns 1: 'Kevin <b>van</b> <i>Zonneveld</i>'
			//   example 2: strip_tags('<p>Kevin <img src="someimage.png" onmouseover="someFunction()">van <i>Zonneveld</i></p>', '<p>')
			//   returns 2: '<p>Kevin van Zonneveld</p>'
			//   example 3: strip_tags("<a href='http://kvz.io'>Kevin van Zonneveld</a>", "<a>")
			//   returns 3: "<a href='http://kvz.io'>Kevin van Zonneveld</a>"
			//   example 4: strip_tags('1 < 5 5 > 1')
			//   returns 4: '1 < 5 5 > 1'
			//   example 5: strip_tags('1 <br/> 1')
			//   returns 5: '1  1'
			//   example 6: strip_tags('1 <br/> 1', '<br>')
			//   returns 6: '1 <br/> 1'
			//   example 7: strip_tags('1 <br/> 1', '<br><br/>')
			//   returns 7: '1 <br/> 1'

			// making sure the allowed arg is a string containing only tags in lowercase (<a><b><c>)
			allowed = (((allowed || '') + '').toLowerCase().match(/<[a-z][a-z0-9]*>/g) || []).join('')

			var tags = /<\/?([a-z][a-z0-9]*)\b[^>]*>/gi
			var commentsAndPhpTags = /<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi

			return input.replace(commentsAndPhpTags, '').replace(tags, function ($0, $1) {
				return allowed.indexOf('<' + $1.toLowerCase() + '>') > -1 ? $0 : ''
			})
		},

		stripScriptTags: function( string ){
			var re = /<\s*script[^>]*>[\s\S]*?(<\s*\/script[^>]*>|$)/ig;
			return string && string.replace(re, '');
		}
	})
})(jQuery);


$.extend($.string,{
	getIdFromYoutubeURL_legacy: function(url){
		if(!url) return;
		var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
		var match = url.match(regExp);
		if (match&&match[7].length==11){
		    return match[7];
		}else{
		    //alert("Url incorrecta");
		}
	},

	getIdFromYoutubeURL: function( videoIdString ){
		videoIdString = (videoIdString && $.trim(videoIdString)) || '';
		var youtube     = videoIdString.match(/^http[s]*:\/\/www\.youtube\.com\/.*[?&]v=([^&]+)/i) || videoIdString.match(/^http[s]*:\/\/youtu\.be\/([^?]+)/i) || videoIdString.match(/www\.youtube\.com\/embed\/([^"]+)/i);
		return youtube && youtube[1];
	},


	getIdFromVimeoURL_legacy: function(url){
		if(!url) return;
		var regExp = /https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;
		var match = url.match(regExp);
		if(match && match[2]) return match[2];
	},

	getIdFromVimeoURL: function( videoIdString ){
		videoIdString = (videoIdString && $.trim(videoIdString)) || '';
		var vimeo     = videoIdString.match(/^http[s]*:\/\/[www\.]*vimeo\.com\/([0-9]+)*.*/i) || videoIdString.match(/^http[s]*:\/\/[www\.]*player\.vimeo\.com\/video\/([0-9]+).*/i);
		return vimeo && vimeo[1];
	},

	getIdFromPixelFacebookScript: function( script ){
		var pixelFacebookId
			, idRE = /'init',\s?'[0-9]+'/
			, match;

		match = idRE.exec(script);
		match = match && match[0];
		match = match && match.replace(/'/g, '');
		match = match && match.split(',');
		match = match && match[1];
		pixelFacebookId = $.trim(match);

		return pixelFacebookId;
	},

	getIdFromFacebookURL: function( videoIdString ){
		videoIdString = (videoIdString && $.trim(videoIdString)) || '';
		var url = new $.URL(videoIdString);
		var paramString = (url && url.deparamsearch().href) || videoIdString;
		var facebook = videoIdString.match(/^http[s]*:\/\/www\.facebook\.com\/video.php[?&]v=([0-9]+)/i) || paramString.match(/^http[s]*:\/\/www\.facebook\.com\/.*\/videos\/([0-9]+)/i);
		return facebook && facebook[1];
	},

	getIdFromTwitchURL: function( videoIdString ){
		var result = '';
		var re = /^http[s]*:\/\/www\.twitch\.tv\/(\w+)/i;
		var matches = videoIdString.match( re );
		if( matches ) result = matches[1];
		else {
			re = /http[s]*:\/\/player\.twitch\.tv\/\?channel=v(\w+)/i;
			var matches = videoIdString.match( re );
			if(matches) result = matches[1];
		}
		return result;
	}
});

$.extend($.string,{
	isValidMetaTag: function(str){
		var re = /^<meta\s+name="[^"]+"\s+content="[^"]+"\s*\/>$/i;
		return re.test(str);
	},

	parseMetaTag: function( str ){
		var regexp = /^<meta\s+name="(:<name>[^"]+)"\s+content="(:<content>[^"]+)"\s*\/>$/i;
		var executed = named( regexp ).exec( str );
		var result = {
			'name'	 	: '',
			'content'	: ''
		};
		if( executed ){
			var captures = executed.captures;
			result.name = executed.captures.name && executed.captures.name[0];
			result.content = executed.captures.content && executed.captures.content[0];
		}
		return result;
	}
});

$.extend($.string,{
	isValidWhatsappNumber: function(str){
		var re = /^\+[\d]+$/i;
		return re.test(str);
	},
	isValidWhatsappNumberCollection: function(str){
		var re = /^\+[\d]+([\/|]\+[\d]+)*$/i;
		return re.test(str);
	},
        isValidDate:function(strFecha){
            if (typeof (strFecha) !== 'string') { return false; }
            
            var pattern = /^\d\d\/\d\d\/\d\d\d\d$/;
            
            if(!pattern.test(strFecha))
            {
                return false;
            }
            
            var arrayFecha = strFecha.split("/");

            var ano = arrayFecha[2];

            var mes = arrayFecha[1]-1;

            var dia = arrayFecha[0];
            
            var fecha = new Date(ano,mes,dia);

            if (!fecha.getTime())
            {
                return false;
            }

            if(fecha.getFullYear()!= ano)
            {
                return false;
            }

            if(fecha.getMonth()!= mes)
            {
                return false;
            }

            if(fecha.getDate()!= dia)
            {
                return false;
            }
            
            return true;
        },
        isValidHour:function(strHora){
            if (typeof (strHora) !== 'string') { return false; }
            
            var pattern = /^\d\d:\d\d$/;
            
            if(!pattern.test(strHora))
            {
                return false;
            }
            
            var arrayHora = strHora.split(":");

            var hora = arrayHora[0];
            var minuto = arrayHora[1];
            
            var fecha = new Date(null,null,null,hora,minuto);

            if (!fecha.getTime())
            {
                return false;
            }

            if(fecha.getHours()!= hora)
            {
                return false;
            }

            if(fecha.getMinutes()!= minuto)
            {
                return false;
            }
            
            return true;
        }
});


(function(){
	function ShorthandValue( value ){
		if( this.constructor == Function ){
			return new arguments.callee( value );
		}
		this._value = value;
		this._parse();
	}

	$.extend( ShorthandValue.prototype, {
		_parse: function(){
			var value = this._value;

			///////////////////////////////////
			/*
				var result = String( value || '').split(/\s+/);
			 */

			var re = /[#.\-\+\w]+(\([^\)]+\))?/ig;
			var result = String( value || '' ).match( re ) || [""];


			if( result.length == 1 ){
				//result[0] = result[0] || '0px';
				result[0] = result[0];
				result[1] = result[2] = result[3] = result[0];
			} else if( result.length == 2 ){
				result[0] = result[0] || '0px';
				result[1] = result[1] || '0px';
				result[2] = result[0];
				result[3] = result[1];
			} else if( result.length == 3 ){
				result[0] = result[0] || '0px';
				result[1] = result[1] || '0px';
				result[2] = result[2] || '0px';
				result[3] = result[1];
			}

			var hasColorUnits = false;
			$.each( result, function( index, value ){
				var isColor = false;
				if( $.xcolor ){
					isColor = $.xcolor.test( value );
				}
				if(isColor ){
					hasColorUnits = true;
					result[index] = isColor;
					result[index].toString = result[index].getCSS;
				} else {
					result[index] = Measure(result[index], {decimals: 0});
				}
			});

			result.top = result[0];
			result.right = result[1];
			result.bottom = result[2];
			result.left = result[3];

			if(!hasColorUnits ){
				result.horizontal	= Measure( result.left, result.left.options ).add( result.right );
				result.vertical 	= Measure( result.top, result.left.options ).add( result.bottom );
			}
			$.extend(this, result);
		},

		toString: function(){
			return $.trim( [this.top, this.right, this.bottom, this.left ].join(' ') );
		},

		isEmpty: function(){
			return !this.toString();
		},

		notNegative: function(){
			var self = this;
			$.each(['top', 'right', 'bottom', 'left'], function(index, value){
				self[value].notNegative();
			});
			return this;
		}

});

	$.ShorthandValue = ShorthandValue;

	$.extend($.string, {
		parseShorthand: function( value, options ){
			return new ShorthandValue( value );
		}}
	);

	/////////////////////////////////////////////
	function Measure( measure, options  ){
		if(this.constructor != Measure ){
			return new Measure( measure, options );
		} else {
			if( measure instanceof this.constructor ){
				measure = measure._original;
			}
			this.options = $.extend({}, options);
			this._number = null;
			this._unit = '';
			this._integer = null;
			this._decimal = null;
			this._original = measure;
			this.parse( measure );
		}
	}

	$.extend( Measure.prototype, {
		parse: function( valueAndUnit ){
			var re = /((-?\d+)(\.(\d+))?)([^\d\.]+)?/;
			if( valueAndUnit !== null && valueAndUnit != '' ){
				valueAndUnit = String(valueAndUnit);
				var parsed = valueAndUnit.match( re );
				if( parsed ){
					this['_number'] = parseFloat( parsed[1] ) || 0;
					this['_unit'] = parsed[5] || '';
					this['_integer'] = parseFloat( parsed[2] ) || 0;
					this['_decimal'] = parseFloat( parsed[3] ) || 0;
				}
			}
		},

		toString: function(){
			var result = '';
			if( this.number() !== null ){
				result = this.number() + '' + this.unit();
			}
			return result;
		},

		valueOf: function(){
			return this.number() + '' + this.unit();
		},

		add: function(b){
			var mb = Measure(b);
			this.number( this.number() + mb.number() );
			//this.unit( this.unit() || b.unit() );
			if( !this.unit() ){
				this.unit( mb.unit() );
			}
			return this;
		},

		multiply: function(b){
			this.number( this.number() * parseFloat(b));
			return this;
		},

		_transformNumber: function( value ){
			if( $.isNumeric( this.options.decimals ) && value ){
				value = +value.toFixed( this.options.decimals );
			}
			if(isNaN( value )){
				value = null;
			}
			return value;
		},

		notNegative: function(){
			if( this.number() < 0 ){
				this.number( 0 );
			}
			return this;
		}


	});

	$.each(['number', 'unit', 'integer', 'decimal'], function(key, value){
		Measure.prototype[value] = function(val){
			if( arguments.length > 0){
				this['_'+value] = val;
			}
			var result = this['_'+value];
			var transformFn = '_transform' + $.string.capitalize( value );
			if( this[ transformFn ]){
				result = this[ transformFn ]( result );
			}
			return result;
		}
	});

	$.Measure = Measure;
	/////////////////////////////////////////////

	/*
	$.extend($.string,{
		parseValue: function( valueAndUnit, options ){
			var re = /((\d+)(\.(\d+))?)([^\d\.]+)/;
			var result = {
				'value'		: null,
				'unit'		: null,
				'integer'	: null,
				'decimal'	: null
			}
			if( valueAndUnit !== null ){
				var parsed = valueAndUnit.match( re );
				result['value'] = parseFloat( parsed[1] );
				result['unit'] = parsed[5];
				result['integer'] = parseFloat( parsed[2] );
				result['decimal'] = parseFloat( parsed[3] );
				result['original']	= valueAndUnit;
			}
			return result;
		}
	})
	*/

})();


/**
 * $.number
 **/

$.extend($.namespace('$.math'), {
	/*
	 * fuerza a que number est entre el rango min y max. Si se pasa, da la vuelta. Siempre da un nmero entre min y max
	 * ejemplos:
	 * cicleToRange( 3, 0, 5) == 3
	 * cicleToRange( -1, 0, 5) == 5
	 * cicleToRange( 6, 0, 5) == 0
	 */
	cicleToRange: function( number, min, max ){
		var fnumber = number - min,
			fmax	= max - min + 1,
			inrange = fnumber % fmax;
		if( inrange < 0 ) inrange = ( fmax ) + inrange;

		return min + inrange;
	},

	isReallyNaN: function(a) { return isNaN(a) && "number" == typeof a },

	randomInt: function( min, max ){
		var range = max - min;
		return Math.round( Math.random() * range ) + min;
	},

	_obtenerMultiplicadorUnidad: function( unidad ){
		var multiplicador = 1;
		switch( unidad ){
			case 'kg':
				multiplicador = 1;
				break;

			case 'g':
				multiplicador = 0.001;
				break;

			case 'lb':
				multiplicador = 0.45359237;
				break;

			/////////////////////////////////////////////////////////////////////////

			case 'm':
				multiplicador = 1;
				break;

			case 'cm':
				multiplicador = 0.01;
				break;

			case 'mm':
				multiplicador = 0.001;
				break;

			case 'in':
				multiplicador = 0.0254;
				break;
		}

		return multiplicador;
	},

	convertirUnidad: function( valor, fromUnidad, toUnidad ){
		return valor && ( valor * this._obtenerMultiplicadorUnidad( fromUnidad ) / this._obtenerMultiplicadorUnidad( toUnidad ) ) ;
	},

	circle: function( angle, r ){
		return {
			x : Math.round(r * Math.cos(angle * Math.PI / 180 )),
			y : Math.round(r * Math.sin( angle * Math.PI / 180 ))
		}
	},

	/**
	 * translada un valor o serie de valores a otro sistema de coordenadas.
	 * ejemplos:
	 * $.math.translateCoords( 3, [2,5], [0,10]) // 5
	 * $.math.translateCoords( 3, {min: 2, max: 4}, {min: 0, max: 10}) // 5
	 * $.math.translateCoords({x: 3, y: 10}, [2,4], [0,10]) // {x: 5, y: 40}
	 * @param value
	 * @param from
	 * @param to
	 * @returns {Array}
	 */
	translateCoords: function( value, from, to ){
		var fromMin, fromMax, toMin, toMax;
		if($.isArray( from ) ){
			fromMin = from[0];
			fromMax = from[1];
		} else {
			fromMin = from.min;
			fromMax = from.max;
		}
		if($.isArray( to )){
			toMin = to[0];
			toMax = to[1];
		} else {
			toMin = to.min;
			toMax = to.max;
		}

		var fromRange = fromMax - fromMin;
		var toRange = toMax - toMin;

		var values = $.isPlainObject( value ) ? value : $.toArray( value );
		var result = $.isPlainObject( value ) ? {} : [];
		$.each( values, function( index, value ){
			var valueTo = value;
			if($.isNumeric( value ) ){
				var valueFrom = ( value - fromMin ) / fromRange;
				var valueTo = ( valueFrom * toRange ) + toMin;
			}
			result[ index ] = valueTo;
		});
		if( typeof value == 'number' ) result = result[0];
		return result;

	},

	inBounds: function( value, min, max ){
		return Math.max( Math.min( value, max ), min );
	},

	seed: function( number ){
		var result = Math.abs(Math.sin(number) + Math.sin(number*1.14123121412 + 2523847));
		result = result.toString().substr(2,10);
		result = result.split('').reverse().join("");
		result = parseInt(result)/10000000000;
		return result;
	},

	linear: function( t, p0, p1){
		return {
			x: p0.x * (1-t) + p1.x * t,
			y: p0.y * (1-t) + p1.y * t
		}
	},

	bezier: function(t, p0, p1, p2, p3){
		var cX = 3 * (p1.x - p0.x),
			bX = 3 * (p2.x - p1.x) - cX,
			aX = p3.x - p0.x - cX - bX;

		var cY = 3 * (p1.y - p0.y),
			bY = 3 * (p2.y - p1.y) - cY,
			aY = p3.y - p0.y - cY - bY;

		var x = (aX * Math.pow(t, 3)) + (bX * Math.pow(t, 2)) + (cX * t) + p0.x;
		var y = (aY * Math.pow(t, 3)) + (bY * Math.pow(t, 2)) + (cY * t) + p0.y;

		return {x: x, y: y};
	},

	getBezierControlPoints: function (t, p0, p1, p2){
		var x0 = p0.x;
		var y0 = p0.y;
		var x1 = p1.x;
		var y1 = p1.y;
		var x2 = p2.x;
		var y2 = p2.y;

		var d01=Math.sqrt(Math.pow(x1-x0,2)+Math.pow(y1-y0,2));
		var d12=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));
		var fa=t*d01/(d01+d12);   // scaling factor for triangle Ta
		var fb=t*d12/(d01+d12);   // ditto for Tb, simplifies to fb=t-fa
		var p1x=x1-fa*(x2-x0);    // x2-x0 is the width of triangle T
		var p1y=y1-fa*(y2-y0);    // y2-y0 is the height of T
		var p2x=x1+fb*(x2-x0);
		var p2y=y1+fb*(y2-y0);
		return [{x:p1x, y: p1y},{x: p2x, y: p2y}];
	},

	sum: function( values ){
		var result = 0
			, length = values.length
		for( var i = 0; i< length ; i++ ){
			result += values[i];
		}
		return result;
	},

	average: function( values ){
		return this.sum( values ) / values.length;
	},

	round: function( number, decimals ){
		if( !decimals ) decimals = 0;
		var multiplier = Math.pow( 10, decimals );
		return Math.round ( number *  multiplier ) / multiplier;
	}



});
/*
console.assert( $.math.constraintToRange( 3, 4, 6) == 6, 'debi dar 6'  );
console.assert( $.math.constraintToRange( 5, 4, 6) == 5, 'debi dar 5'  );
console.assert( $.math.constraintToRange( 7, 4, 6) == 4, 'debi dar 4'  );
*/

/**
 * detects if a value is a valid email
 **/

$.isEmail = function(email){
	var email = String(email);
	var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	return regex.test(email);
};


$.isInteger = function( n ){
	return $.isNumeric( n ) && Math.floor( n ) == n;
};

$.isExactInteger = function( n ){
	return $.isInteger( n ) && String( n ).length == String( parseInt( n ) ).length;
};

$.isPercent = function( n ){
	return $.string.endsWith(n, '%');
};


$.isPixel = function( n ){
	return $.string.endsWith(n, 'px');

};

$.isBoolean = function( n ){
	return n === true || n === false;
}

/**
 * fuerza a convertir un objeto a array si no lo es.
 * @author: Lisandro Puzzolo
 * ej:	$.toArray([1,2,3])	-> [1,2,3]
 *		$.toArray() 		-> [null]
 *		$.toArray('hola')	-> ['hola']
 */
jQuery.toArray = function(object){
	if(!$.isArray(object)) object = [object];
	return object;
};


/**
 * determina si un objeto es un elemento HTML
 */
jQuery.isHTMLElement = function(o){

	if(	typeof o == 'string' ||
		typeof o == 'number' ||
		typeof o == 'boolean' ||
		o === undefined ||
		o === null
		) return false;


    if ("HTMLElement" in window && "Comment" in window) {
        return (!!o && ( o instanceof HTMLElement || o instanceof Comment) );
    }

	var tag = o.tagName;
	try {
		o.tagName = '';  // read-only for DOM, should throw exception
		if(o.tagName!='') return true; // chrome no tira error, pero no lo cambia
		o.tagName = tag; // restore for normal objects
		return false;
	} catch (e) {
		return true;
	}
	//return (o.constructor.toString().search(/\object HTML.*Element/)>-1)?true:false;
};


jQuery.ifUndefined = function( o, defaultValue ){
	return typeof o == 'undefined' ? defaultValue : o;
}

/**
 * permite acceder al hash de document.location con sus keys = values
 * @author Lisandro Puzzolo
 */
jQuery.getAllHashes = function(){
	result = {};
	var hash = document.location.hash.replace('#','');
	var hashes = hash.split('&');
	$.each(hashes, function(index, hash){
		var pair = hash.split('=');
		var key = pair[0];
		var value = pair[1];
		if(result[key]){
			if(!$.isArray(result[key])) result[key] = [result[key]];
			result[key].push(value);
		} else {
			result[key] = value;
		}
	});
	return result;
};
jQuery.getHashQuery = function(){
	result = {};
	var hash = document.location.hash.replace('#','');
	var index = hash.indexOf('?');
	if (index==-1) return {};
	hash = hash.substr(index + 1);
	var hashes = hash.split('&');
	$.each(hashes, function(index, hash){
		var pair = hash.split('=');
		var key = pair[0];
		var value = pair[1];
		if(result[key]){
			if(!$.isArray(result[key])) result[key] = [result[key]];
			result[key].push(value);
		} else {
			result[key] = value;
		}
	});
	return result;
};
////////////// COLLECTIONS //////////////

/**
 * busca el primer elemento en una coleccin que haga que una funcin iterador devuelva verdadero.
 */
jQuery.findInCollection = function(collection, iterator){
	var result;
	$.each(collection, function(index, element){
		if(iterator(element)) {
			result = element;
			return false;
		}
	});
	return result;
};

/**
 * busca todos los elementos de una coleccin que hagan que una funcin iterador devuelva verdadero
 */
jQuery.findAllInCollection = function(collection, iterator){
	var result = [];
	$.each(collection, function(index, element){
		if(iterator(element)) {
			result.push(element);
		}
	});
	return result;
};

/**
 * encuentra la posicin de un elemento en una coleccin, o -1 si no se encuentra
 */
jQuery.indexInCollection = function(collection, iterator){
	var result = -1;
	$.each(collection, function(index, element){
		if(iterator(element)) {
			result = index;
			return false;
		}
	});
	return result;
};

/**
 * quita elementos de una coleccin que hagan que el iterador devuelva true, y devuelve un array con los elementos quitados
 */
jQuery.removeFromCollection = function(collection, iterator){
	var removedCount = 0 ;
	var removed = [];
	$.each($.extend({}, collection), function(index, element){
		if(iterator(element)) {
			removed.push(collection.splice(index - removedCount++ , 1)[0]);
		}
	});
	return removed;
};

jQuery.pluckCollection = function(collection, property){
	return $.map(collection, function(element){
		var elementProperty = element[property];
		var value = typeof elementProperty == 'function' ? elementProperty() : elementProperty;
		return value;
	})
};

jQuery.getPropertyFromCollectionIfSameValue = function( collection, property ){
	var lastValue = null;

	$.each( collection, function( index, element ){
		var currentValue = ko.unwrap( element[property] );
		if( index > 0 ){
			if( currentValue != lastValue ){
				lastValue = null;
				return false;
			}
		} else {
			lastValue = currentValue;
		}
	});

	return lastValue;

};
/**
 * quita del arrayA los elementos del arrayB
 * @param {Array} arrayA
 * @param {Array} arrayB
 * @param {Function} equallityComparer
 * @returns {Array}
 */
jQuery.arrayExclude = function(arrayA, arrayB, equallityComparer){
	var equallityComparer = equallityComparer || function(A, B){
		return A == B;
		};
	var result = [];
	$.each(arrayA, function(indexA, elementA){
		var found = false;
		$.each(arrayB, function(indexB, elementB){
			if(equallityComparer(elementA, elementB)){
				found = true;
				return false;
			}
		});
		if(!found) result.push(elementA);
	});
	return result;
};

/**
 * devuelve el ltimo elemento de un array
 * @param {Array} array
 * @returns {Object}
 */
jQuery.arrayLast = function(array){
	return array && array[array.length - 1];
};


jQuery.arrayPartition = function(array, chunkSize){
	var i,
		result = [];

	for ( i = 0 ; array[i] ; i += chunkSize ){
		result.push( array.slice( i, i + chunkSize ) );
	}

	return result;
};

// crea un nuevo array cuyos elementos son nicos en base a su key. Se pasa keyGetter para determinar el key de un objeto
jQuery.arrayUnique = function( array, keyGetter ){

	if( keyGetter === undefined ){
		return $.grep(array,function(v,k){
			return $.inArray(v,array) === k;
		});
	}

	var result = [];
	$.each( array, function( index, value ){
		var found = false;
		$.each( result, function ( resultIndex, resultValue ){
			if( keyGetter( resultValue ) == keyGetter( value ) ){
				result[ resultIndex ] = value;
				found = true;
				return false;
			}
		});
		if ( !found ){
			result.push( value );
		}
	});
	return result;
};

jQuery.arrayJoinClean = function( array, joiner ){
	var result = '';
	return $.arrayExclude( array ,['', null, undefined]).join( joiner );
};

jQuery.arrayEnumerate = function( array, joinerType, joiner ){
	var lng = 'es'
		, lastJoiner
		, result
		, lastItem
		, joiner = joiner || ', '
		, joinerType = joinerType || jQuery.arrayEnumerate.AND
		, array = $.arrayUnique( array )

	if( window.i18n ){
		lng = window.i18n.lng().split('_')[0];
	}


	var lastJoiners = {
		'es'	: {
			'jQuery.arrayEnumerate.OR'	: ' o ',
			'jQuery.arrayEnumerate.AND'	: ' y ',
			'jQuery.arrayEnumerate.ETC'	: 'etc...'
		},

		'en'	: {
			'jQuery.arrayEnumerate.OR'	: ' or ',
			'jQuery.arrayEnumerate.AND'	: ' and ',
			'jQuery.arrayEnumerate.ETC'	: 'etc...'
		},

		'pt'	: {
			'jQuery.arrayEnumerate.OR'	: ' o ',
			'jQuery.arrayEnumerate.AND'	: ' e ',
			'jQuery.arrayEnumerate.ETC'	: 'etc...'
		}
	};

	if( lastJoiners[lng]){
		lastJoiner = lastJoiners[lng][ joinerType ] || joiner;
	} else {
		lastJoiner = joiner;
	}

	if( array.length > 1 ){

		switch (joinerType){
			case jQuery.arrayEnumerate.ETC:
				array.push( lastJoiner );
				result = array.join( joiner );
				break;

			default:
				lastItem = array.pop();
				result = array.join( joiner );
				result += lastJoiner + lastItem;
				break;
		}

	} else {
		result = array.join( joiner );
	}


	return result;

};
jQuery.arrayEnumerate.OR = 'jQuery.arrayEnumerate.OR';
jQuery.arrayEnumerate.AND = 'jQuery.arrayEnumerate.AND';
jQuery.arrayEnumerate.ETC = 'jQuery.arrayEnumerate.ETC';


/**
 * http://stackoverflow.com/questions/12303989/cartesian-product-of-multiple-arrays-in-javascript
 * @param Array a
 * @returns Array
 */
jQuery.arrayCartesianProduct = function(a) { // a = array of array
	var i, j, l, m, a1, o = [];
	if (!a || a.length == 0) return a;

	a1 = a.splice(0,1);
	a = jQuery.arrayCartesianProduct(a);
	for (i = 0, l = a1[0].length; i < l; i++) {
		if (a && a.length) for (j = 0, m = a.length; j < m; j++)
			o.push([a1[0][i]].concat(a[j]));
		else
			o.push([a1[0][i]]);
	}
	return o;
};


jQuery.arrayRandomItem = function( array ) {
	var randomIndex = $.math.randomInt(0, array.length - 1);
	return array[ randomIndex ];
}

jQuery.arrayMoveItemAfter = function( array, item, itemToMoveAfter ){
	var itemToMoveAfterIndex = array.indexOf( itemToMoveAfter );
	ko.utils.arrayRemoveItem( array, item );
	var itemToMoveAfterIndex = array.indexOf( itemToMoveAfter );
	if( itemToMoveAfterIndex != -1 ){
		array.splice( itemToMoveAfterIndex + 1, 0, item );
	} else {
		array.push( item );
	}
	return array;
	/*
	var itemIndex = array.indexOf( item );
	if( itemIndex != -1 ){
		array.splice( itemIndex, 1 );
	}*/
	//array.splice()
}

jQuery.arrayFlatten = function( array ){
	return $.map( array, function recurs(n) {
		return ($.isArray(n) ? $.map(n, recurs): n);
	});
}

/**
 * all elements in collection return true for iterator
 * @type {Object}
 * @private
 */

jQuery.all = function(collection, iterator){
	var result = true;
	var iterator = iterator || function(key, value){return value};
	$.each(collection, function(key, value){
		result = result && !!iterator(key, value);
		if(!result) return false;
	});
	return result;
};
jQuery.any = function(collection, iterator){
	var result = false,
		iterator = iterator || function(key, value){ return value; };

	$.each(collection, function(key, value){
		result = result || !!iterator(key, value);
		if(result) return false;
	});
	return result;
};

jQuery.getSelectedProperties = function(source, propertiesArray){
	var result = {},
		i = 0;

	if(typeof propertiesArray == 'function'){
		$.each(source, function(key, value){
			if(propertiesArray(key, value)) result[key] = value;
		})
	} else {
		var length = propertiesArray.length;
		for (i = 0; i < length ; i++){
			var propertyName = propertiesArray[i];
			if(source.hasOwnProperty(propertyName)) result[propertyName] = source[propertyName];
		}
	}

	return result;
};

jQuery.withoutProperties = function(source, propertiesArray){
	var result = {},
		i = 0;

	if( typeof propertiesArray === 'function' ){
		$.each( source, function( key, value ){
			if( !propertiesArray(key, value) ) result[ key ] = value;
		});
	} else {
		$.each( source, function( key, value ){
			if( $.inArray( key, propertiesArray ) === -1) result[ key ] = value;
		});
	}

	return result;
};


jQuery.isEmptyVal = function (val) {
	if (val === undefined) {
		return true;
	}
	if (val === null) {
		return true;
	}
	if (val === "") {
		return true;
	}
};

jQuery.ifEmpty = function( val, otherValue ){
	return $.isEmptyVal( val ) ? otherValue : val;
}

/**
 * Busca en un objeto una propiedad de acuerdo al path de esa propiedad
 * ejemplo: jQuery.getSelectedProperty({foo: {bar: 'foobar'}, 'foo.bar') == 'foobar'
 * @param {Object} source
 * @param {String} path
 * @returns {Object}
 */



jQuery.getObjectProperty = function( source, path ){
	var splittedPath = path.split('.'),
		splittedPathLength = splittedPath.length,
		propertyName,
		currentProperty = source,
		foundComplete = true
		, i = 0;


	if( currentProperty ){
		for (var i = 0; i < splittedPathLength ; i++){
			propertyName = splittedPath[ i ];

			if( currentProperty ){
				currentProperty = currentProperty[ propertyName ];
			}

			if( $.isEmptyVal( currentProperty ) ){
				break;
			}
		}
	}

	return currentProperty;
};


jQuery.getObjectKeys = function( source ){
	return jQuery.map( source, function(value, key){return key});
};

(function($){
	function findPropertyName(obj, equals) {
		for (var a in obj)
			if (obj.hasOwnProperty(a) && obj[a] === equals)
				return a;
	}
	function findPropertyNames(obj, equals) {
		var names = [];
		for (var a in obj)
			if (obj.hasOwnProperty(a) && obj[a] === equals)
				names.push(a);
		return names;
	}
	function findSubObjectWithProperty(obj, prop) {
		for (var a in obj)
			if (obj.hasOwnProperty(a) && obj[a] && obj[a][prop])
				return obj[a];
	}

	$.extend($,{
		'findPropertyName'			: findPropertyName,
		'findPropertyNames'			: findPropertyNames,
		'findSubObjectWithProperty'	: findSubObjectWithProperty
	});

})(jQuery);


jQuery.prefixedStyle = function( style ){
	var result = {}
		, vendors = [ 'webkit', 'Moz', 'O', 'ms' ]
		, element = $('<div>')[0];

	$.each( style, function( key, value ){
		$.each( vendors, function( i, vendorPrefix ){
			if( $.string.startsWith( key, vendorPrefix ) ){
				key = $.string.trimFirst( key, vendorPrefix );
			}
		});
		var jsPropertyName = $.camelCase( key );
		if( element.style[ jsPropertyName ] === undefined ){
			$.each( vendors, function( i, vendorPrefix ){
				result[ $.camelCase( vendorPrefix + '-' + key )] = value;
			});
		}
		result[jsPropertyName] = value;
	});

	return result;
};

jQuery.createSortFN = function( fields, transformFn ){
	return function( a, b ){
		var result = 0;
		$.each( fields, function( index, field ){
			var resultSign = -1;
			if($.isArray( field ) ){
				resultSign = field[1] == 'asc' ? -1 : 1;
				field = field[0];
			}

			var fieldA = ( ko.unwrap( a[field] ) )
				, fieldB = ( ko.unwrap( b[field] ) );

			if( fieldA < fieldB ) {
				result = resultSign;
				return false;
			} else if (fieldA > fieldB ){
				result = -resultSign;
				return false;
			}
		});
		return result;
	}
};


(function( $ ){
	$.extend( $, {
		getScrollbarWidth: function() {
			var outer = document.createElement("div");
			outer.style.visibility = "hidden";
			outer.style.width = "100px";
			outer.style.msOverflowStyle = "scrollbar"; // needed for WinJS apps

			document.body.appendChild(outer);

			var widthNoScroll = outer.offsetWidth;
			// force scrollbars
			outer.style.overflow = "scroll";

			// add innerdiv
			var inner = document.createElement("div");
			inner.style.width = "100%";
			outer.appendChild(inner);

			var widthWithScroll = inner.offsetWidth;

			// remove divs
			outer.parentNode.removeChild(outer);

			return widthNoScroll - widthWithScroll;
		}
	});
})( jQuery );

////////////////////////////////////////////////////////////////////////////////////////////////
// PLUGINS y OTROS //
////////////////////////////////////////////////////////////////////////////////////////////////




//////////////// prefilter

$.ajaxPrefilter(function( options, originalOptions, jqXHR ) {

	// si la URL es la ANTIGUA url de ajax-finalizar-compra, la reemplazamos por la nueva.
	if( $.string.startsWith( options.url, 'https://donweb.com/ajax-finalizar-compra.php') ){
		options.url = $.string.replace( options.url, 'https://donweb.com/ajax-finalizar-compra.php', 'https://administracion.donweb.com/apiv3/compras/carrito/finalizarCompra' );

		jqXHR.then( function( response ){
			var newResponse;

			if( response.jsonMC ){
				newResponse = {
					root		: {
						site	: {
						}
					}
				}

				if( response.jsonMC.respuesta && response.jsonMC.respuesta.error ){
					response.jsonMC.error = response.jsonMC.respuesta.error;
				} else if( response.jsonMC.respuesta) {
					newResponse.root.site = response.jsonMC.respuesta;
				}

				if( response.jsonMC.error ){
					newResponse.root.site.error = response.jsonMC.error;
				}

			} else {
				newResponse = response;
			}

			return newResponse;
		}).promise( jqXHR );

		jqXHR.success = jqXHR.done;
		jqXHR.error = jqXHR.fail;
	}

});


$.ajaxPrefilter(function( options, originalOptions, jqXHR ) {

	if( options.parseJsonMC ){
		var parsedXHR = jqXHR.then( function( response ){
			var newResponse = $.extend({}, response);
			if( response.jsonMC ){
				var responseJSONMC = response.jsonMC;
				if( responseJSONMC.resultado ){
					if( responseJSONMC.respuesta && responseJSONMC.respuesta.error ){
						responseJSONMC.error = responseJSONMC.respuesta.error;
					} else {
						$.extend( newResponse, {
							'result'		: responseJSONMC.respuesta
						});
					}
				}
				if( responseJSONMC.error ){
					$.extend( newResponse, {
						'error'			: responseJSONMC.error
					});
					return $.Deferred().reject( newResponse );
				}
			}
			return newResponse;

		});

		parsedXHR.promise( jqXHR );
	}

	if ( options.removeRoot ) { // interceptar slo los ajax que tengan como option algn valor para parseError
		//jqXHR.parsedError = function(){};

		jqXHR.then( function( jqXHR, statusText, errorMsg ) {
			var responseNode = $.extend({}, jqXHR);
			if(responseNode.xmlroot) $.extend(responseNode, responseNode.xmlroot);
			if(responseNode.root) $.extend(responseNode, responseNode.root);
			if(responseNode.site) $.extend(responseNode, responseNode.site);
			if(responseNode.response) $.extend(responseNode, responseNode.response);

			/*if(jqXHR.xmlroot) jqXHR = jqXHR.xmlroot;
			 if(jqXHR.root) jqXHR = jqXHR.root;
			 if(jqXHR.site) jqXHR = jqXHR.site;
			 if(jqXHR.response) jqXHR = jqXHR.response;
			 */
			return $.Deferred().resolveWith( this, [ responseNode, statusText, errorMsg ]  )
		}).promise( jqXHR ); // se utiliza promise pasndole como parmetro jqXHR para que el nuevo deferred creado por then reemplace al jqXHR original
	}

	if ( options.parseError ) { // interceptar solo los ajax que tengan como option algn valor para parseError
		jqXHR.parsedError = function(){};
		jqXHR.then(
			function( jqXHR, statusText, errorMsg ) { // resolve
				var error = jqXHR.error || jqXHR.errors || (jqXHR.response && jqXHR.response.error); // || ( jqXHR.jsonMC && jqXHR.jsonMC.error ) ;
				if(error){
					errorMsg = error;
					return $.Deferred().rejectWith( this, [ jqXHR, statusText, error ]  )
				} else return $.Deferred().resolveWith( this, [ jqXHR, statusText, errorMsg ]  )
			},
			function( jqXHR, statusText, errorMsg ){ // reject
				var responseText = jqXHR.responseText;
				var error = jqXHR;
				try{
					jqXHR = (responseText && $.parseJSON(responseText )) || jqXHR;
					errorMsg = jqXHR.error || jqXHR.errors || (jqXHR.response && jqXHR.response.error); // || ( jqXHR.jsonMC && jqXHR.jsonMC.error ) || errorMsg;
				} catch (e) {
				}
				return $.Deferred().rejectWith (this, [jqXHR, statusText, errorMsg] );
			}
		).promise( jqXHR ); // se utiliza promise pasndole como parmetro jqXHR para que el nuevo deferred creado por then reemplace al jqXHR original
		/*
		jqXHR.success = jqXHR.done;
		jqXHR.error = jqXHR.fail;
		*/
	}


	// si options.chunks no es nulo ni false, en .progress() se envan fragmentos parciales de datos recibidos
	if ( options.chunks ){

        var def = $.Deferred(),
			xhrFactory = options.xhr,
            interval,
            processed = "",
            unprocessed = "",
            delimiter="",
            count=0,
            scanned = "";
        	updater =  function (responseText){
	        	if ( responseText && ( responseText.length > scanned.length ) ) {
					scanned = responseText;
					unprocessed = responseText.substr(processed.length);
	            	if (!delimiter && unprocessed.indexOf("\n") > 0){
						delimiter = unprocessed.substr(0, unprocessed.indexOf("\n") + 1);
						processed = responseText.substr(0, delimiter.length);
						return;
	            	}
	            	if (delimiter){

		updates = unprocessed.split(delimiter);
						if (jqXHR.readyState!=4) updates.pop(); // the last update is considered unfinished at least untill the request is running
	            		if (updates.length){

	                		jQuery.each(updates, function(k, v){
	                			if (jQuery.trim(v).length){
									if(originalOptions.dataType == 'json') {
										v = $.parseJSON( v );
									}
									jqXHR.notify( v );
	                				//options.progress(v)
								}
							});
							count += updates.length;
							processed += updates.join(delimiter)+delimiter;
	            		}
	            	}
	            }
			};
		var intervalFN;

        options.xhr = function() {

            var xhr = xhrFactory.apply( this, arguments );

            intervalFN = function() {

                var responseText,
                    updates;

                try {

                    updater(xhr.responseText);

                } catch(e) {
                    window.console && window.console.error && window.console.error('Hay un error en updater de $.ajax con chunks', e);
                    throw(e);

                }
			};
			interval = setInterval(intervalFN, options.progressInterval || 1 );

            return xhr;
        };

        function stop( xhr ) {
            if ( interval ) {
               intervalFN();
               clearInterval( interval );
            }
            //return $.Deferred.resolve('ok');
        }

		jqXHR.notify = def.notify;
		jqXHR.notifyWith = def.notifyWith;
		jqXHR.progress = def.progress;
        jqXHR.then( stop, stop );
        jqXHR.done(function (jx){updater(jx)})
	}

	 jqXHR.success = jqXHR.done;
	 jqXHR.error = jqXHR.fail;

});



/**
 * SimpleModal addon
 * permite obtener el elemento relacionado a un modal
 */
$.extend(jQuery.modal, {
	element: function(){
		return $('#simplemodal-container .simplemodal-wrap > *')[0];
	}
});



/*---------------------------------------------*
 * hook para que console.log, debug, info, warn y error tengan historial
 * @autor: Lisandro Puzzolo
 *---------------------------------------------*/
$.addHistoryToConsole = function(){
	$.each(['log', 'debug', 'info', 'warn'], function(index, value){
		if(window.console && window.console[value]){
			var _fn = window.console[value];
			if(typeof _fn == 'function'){
				window.console[value] = function(){
					var what = arguments.length > 1 ? arguments : arguments[0];
					//window['$$'
					window.console[value].history.unshift(what);
					window.console[value].history.splice(5);
					$.each(window.console[value].history, function(index, value){
						window['$o' + index] = value;
					});
					_fn.apply(this,arguments);
				};
				window.console[value].history = [];
			}
		}
	});
};

/*
 * this swallows backspace keys on any non-input element.
 * stops backspace -> back
 */
$.disableHistoryBackOnBackspace = function(){
	if( !$.__disabledHistoryBackOnBackspace ){
		var rx = /INPUT|SELECT|TEXTAREA/i;

		$(document).bind("keydown keypress", function(e){
			if( e.which == 8 ){ // 8 == backspace
				if( !(rx.test(e.target.tagName) || e.target.contentEditable == 'true') || e.target.disabled || e.target.readOnly ){
					e.preventDefault();
				}
			}
		});

		$.__disabledHistoryBackOnBackspace = true;
	}
}


$.decodeURIComponentNotNull = function( value ){
	if( value ) return decodeURIComponent( value );
	else return value;
};
$.encodeURIComponentNotNull = function( value ){
	if( value ) return encodeURIComponent( value );
	else return value;

};
$.toHtmlAttr = function ( obj ){
	var result = [], key;
	for (key in obj){ result.push( key + '="' + obj[key] +'"' ) }
	return result.join(' ');
};
$.extend($.namespace('$.querystring'), {
	path: {
		toObject: function(path){
			path = $.string.trimFirst(path, '#!/');
			path = $.string.trimFirst(path, '#/');
			path = $.string.trimFirst(path, '/');
			path = $.string.trimLast(path, '/');

			var querystring = path.split('?');

			path = querystring[0];

			var arr = path.split('/');
			var result = {};
			for (var i = 0 ; arr[i] && i < arr.length ; i+=2){
				result[ $.decodeURIComponentNotNull( arr[i] )] = $.decodeURIComponentNotNull( arr[i+1] );
			}

			if(querystring[1]) $.extend(result, $.unserialise(querystring[1], true));

			return result;
		},

		toMVC: function( path ){
			var toObject = this.toObject( path );
			var result = [];
			$.each( toObject, function( key, value ){
				result.push( key );
				result.push( value );
			});
			return result.join('/');
		},

		fromObject: function(object){
			var result = [];
			$.each(object, function(key, value){
				result.push( $.encodeURIComponentNotNull( key ) );
				result.push( $.encodeURIComponentNotNull( value) );
			});
			return result.join('/');
		},

		modify:  function(path, object){
			var start = '';
			if ($.string.startsWith(path, '/')) start = '/';
			if ($.string.startsWith(path, '#/')) start = '#/';
			if ($.string.startsWith(path, '#')) start = '#';
			if ($.string.startsWith(path, '#!/')) start = '#!/';

			var original = $.querystring.path.toObject(path);
			$.extend(original, object);
			return start + $.querystring.path.fromObject(original);
		}
	}
});


$.extend($.namespace('$.browser'),{
	addClasses: function(){
		if($.browser.msie){
			if($.browser.version=='7.0') $('html').addClass('ie7 ie-lte7 ie-lte8 ie-lte9');
			if($.browser.version=='8.0') $('html').addClass('ie8 ie-lte8 ie-lte9');
			if($.browser.version=='9.0') $('html').addClass('ie9 ie-lte9 ie-gte9');
		}
	}
});



// carcaza para funcin de traduccin de textos
$.__ = function(text){
	return text;
};
window.availableTop = (function() {
	var ventana = window;
	try {
		while (ventana != ventana.parent) {
			ventana.parent.title;
			ventana = ventana.parent;
		}
	} catch (e) {}
	return ventana;
})();

window.availableParent = (function() {
	var ventana = window;
	try {
		ventana.parent.title;
		ventana = ventana.parent;
	} catch (e) {}
	return ventana;
})();

window.hasAccelerometer = function(){
	return !!window.DeviceMotionEvent;
}

window.hasTouch = function(){
	return "ontouchstart" in window;
}


/**
 * ejecuta una serie de deferreds en cadena, y devuelve un nuevo Deferred que tendr las repuestas por done y por fail de cada deferred.
 * @arguments {$.Deferred} a, b, c, d
 * @returns {unresolved}
 */
$.processChain = function(){
	var deferreds = [];
	var args = $.makeArray(arguments);
	$.each(args, function(i, argument){
		deferreds = deferreds.concat($.makeArray(argument));
	});
	var result = new $.Deferred();
	var responses = {done:[], fail: []};
	var finished = 0;
	var total = deferreds.length;

	$.each(deferreds, function(i, deferred){

		deferred
			.done(function(data){
				responses.done.push(deferred);
			})
			.fail(function(data){
				responses.fail.push(deferred);
			})
			.always(function(){
				finished++;
				if(finished == total){
					result.resolve(responses);
				}
			})
	});
	return result;
};
/**
 * enlaza dest a source, de tal forma que cuando source resuelve o rechaza, lo hace dest tambin.
 * @param {$.Deferred} source
 * @param {$.Deferred} dest
 * @returns {undefined}
 */
$.linkDeferreds = function( source, dest ){
	return source.then( function(){
			dest.resolve.apply( dest, arguments );
			return dest;
		}, function(){
			dest.reject.apply( dest, arguments );
			return dest;
		});
};




Chronometer = $.Class({
	init: function(){
		this._start = new Date();
	},

	elapsed: function(){
		return new Chronometer.Lapse(new Date() - this._start);
	}
});

/**
 * dependencias: named.js
 *
 * Permite manipular lapsos de tiempo, y traducir entre formatos
 * por ejemplo traducir "3 das, 258 segundos" a "3 das 00:04:18"
 * l = new Chronometer.Lapse();
 * l.setFormat('dd das, ss segundos');
 * l.parse('3 das, 258 segundos');
 * l.setFormat('dd das hh:mm:ss');
 * l.format();
 */
Chronometer.Lapse = $.Class({
	getTimeDivisions: function(){
		var result = [
			{
				'name'		: 'milliseconds',
				//'wildcard'	: 'ms',
				'wildcards'	: ['ms','x'],
				'ratio'		: 1
			},
			{
				'name'	: 'seconds',
				//'wildcard'	: 'ss',
				'wildcards'	: ['ss','s'],
				'ratio'	: 1000
			},
			{
				'name'	: 'minutes',
				//'wildcard'	: 'mm',
				'wildcards'	: ['MM','M', 'mm', 'm'],
				'ratio'	: 1000 * 60
			},
			{
				'name'	: 'hours',
				//'wildcard'	: 'hh',
				'wildcards'	: ['HH','H', 'hh', 'h'],
				'ratio'	: 1000 * 60 * 60
			},
			{
				'name'	: 'days',
				//'wildcard'	: 'dd',
				'wildcards'	: ['DD','D', 'dd', 'd'],
				'ratio'	: 1000 * 60 * 60 * 24
			}
		]

		$.each( result, function( index, division) {
			division.prev = function(){
				return result[ index - 1 ];
			}
			division.next = function(){
				return result[ index + 1 ];
			}
		});

		return result;
	},

	getTimeDivisionByName: function( name ){
		var result = ko.utils.arrayFirst( this.getTimeDivisions(), function( division ){
			return division.name == name;
		});

		return result;
	},

	prototype: {
		init: function( value, options ){
			this.value = 0;

			this.options = $.extend({
				format: 'sg dd das hh:mm:ss'
			}, options );

			if( typeof value !== 'undefined' ) {
				if (window.named && typeof value == 'string') {
					if (this.hasValidFormat(value)) {
						this.parse(value);
					}
				} else {
					this.setValue(value)
				}
			}
		},

		getFormatRE: function(){
			var format = this.getFormat();
			var wildcards = ['sg'];
			$.each( this.constructor.getTimeDivisions(), function( index, unit){
				wildcards = wildcards.concat( unit.wildcards );
			});

			$.each( wildcards, function(index, wildcard){
				var re = new RegExp( '\\\\?' + wildcard + '(?![^<]*>)', 'g' );
				var newReString = '(:<' + wildcard + '>\\d+)';
				format = format.replace( re, function(match){
					return match.slice(0,1) == '\\' ? match : newReString;
				} );
			});

			var re = new RegExp(format,'g');
			return named( re );
		},

		hasValidFormat: function( str ){
			var format = this.getFormatRE();
			var matched = format.exec( str);
			return !!matched;
		},

		_parse: function( str ){
			var value = str;
			var result = {};

			var format = this.getFormatRE();
			var matched = format.exec( value );

			$.each( this.constructor.getTimeDivisions(), function( index, unit ){
				result[ unit.name ] = 0;
				if( matched ){
					$.each( unit.wildcards, function( index, wildcard ){
						var captured = matched.captures[ wildcard ];
						if( captured ){
							result[ unit.name ] = Number( captured );
						}
					})
				}
			});

			return result;
		},

		parse: function( string ) {
			var self = this
				, parsed = this._parse( string );

			this.value = 0;

			var timeDivisions = this.constructor.getTimeDivisions().sort( function( a, b){
				return a.ratio > b.ratio ? -1 : 1;
			});

			$.each( timeDivisions, function( index, unit ){
				self.setUnitValue( unit.name, parsed[unit.name]);
			});

			return this;
		},

		getValue: function(){
			return this.value;
		},

		setValue: function( value ){
			this.value = value;
			return this.getValue();
		},

		toValue: function(){
			return this.value;
		},

		sign: function(){
			return this.value >= 0 ? '' : '-';
		},

		////////////////////////////////////////////

		getFormat: function( format ){
			return this.options.format;
		},

		setFormat: function( format ){
			this.options.format = format;
		},

		formatHas: function( divisionName ){
			var self = this
				, division = this.constructor.getTimeDivisionByName( divisionName );
			return !!ko.utils.arrayFirst( division.wildcards, function( wildcard ){
				return self.getFormat().indexOf( wildcard ) != -1 ;
			});
		},

		formatHasDays: function(){
			return this.formatHas('days');
		},

		formatHasHours: function(){
			return this.formatHas('hours');
		},

		formatHasMinutes: function(){
			return this.formatHas('minutes');
		},

		formatHasSeconds: function(){
			return this.formatHas('seconds');
		},

		getUnitValue: function( unitName ){
			var result = 0;
			if( this.formatHas( unitName ) ){
				var division = this.constructor.getTimeDivisionByName( unitName );
				result = Math.abs(this.value);
				var currentDivision = division;
				while( currentDivision = currentDivision.next() ){
					if( this.formatHas( currentDivision.name ) ) {
						result = result % currentDivision.ratio;
					}
				}
				result = result / division.ratio;
				result = Math.floor( result );
			}
			return result;
		},

		setUnitValue: function( unitName, value ){
			if( this.formatHas( unitName ) ){
				var unit = this.constructor.getTimeDivisionByName( unitName );
				var currentValue = this.getUnitValue( unitName );
				this.value -= currentValue * unit.ratio;
				this.value += value * unit.ratio;
			}
		},

		getOrSetUnitValue: function( unitName, value ){
			var result;
			if( typeof(value) !== 'undefined' ){
				result = this.setUnitValue( unitName, value );
			} else {
				result = this.getUnitValue( unitName );
			}
			return result;
		},

		days: function( value ){
			return this.getOrSetUnitValue( 'days', value );
		},

		hours: function( value ){
			return this.getOrSetUnitValue( 'hours', value );
		},

		minutes: function( value ){
			return this.getOrSetUnitValue( 'minutes', value );
		},

		seconds: function( value ){
			return this.getOrSetUnitValue( 'seconds', value );
		},

		milliseconds: function( value ){
			return this.getOrSetUnitValue( 'milliseconds', value );
		},

		miliseconds: function( value ){
			return this.milliseconds( value );
		},

		////////////////////////////////////////////

		add: function( amount, unitName ){
			var division = this.constructor.getTimeDivisionByName( unitName );
			this.value += amount * division.ratio;
			return this;
		},

		addMilliseconds: function( amount ){
			return this.add( amount, 'milliseconds');
		},

		addSeconds: function( amount ){
			return this.add( amount, 'seconds');
		},

		addMinutes: function( amount ){
			return this.add( amount, 'minutes');
		},

		addHours: function( amount ){
			return this.add( amount, 'hours');
		},

		addDays: function( amount ){
			return this.add( amount, 'days');
		},

		////////////////////////////////////////////


		toString: function(){
			var sign = this.sign()
				, excludedValues = ['', null, 0]
				, strDias = window.i18n ? i18n.kot('global:mensajes.dias') : 'dias'
			return $.arrayExclude( [
				sign ,
				this.days() && (this.days() + ' ' + strDias),
				this.hours() && (this.hours() + 'hs') ,
				this.minutes() && ( this.minutes() + '\'') ,
				this.seconds() && ( this.seconds() + '"') ,
				this.miliseconds()
			], excludedValues ).join(' ');
		},

		format: function( formato ){
			if( !formato ) formato = this.getFormat();
			var result = formato;

			result = $.string.replace(result, 'dd', this.days());
			result = $.string.replace(result, 'd', this.days());
			result = $.string.replace(result, 'DD', this.days());
			result = $.string.replace(result, 'D', this.days());

			result = $.string.replace(result, 'hh', $.string.padNumber( this.hours(), 2 ));
			result = $.string.replace(result, 'h', this.hours());
			result = $.string.replace(result, 'HH', $.string.padNumber( this.hours(), 2 ));
			result = $.string.replace(result, 'H', this.hours());

			result = $.string.replace(result, 'mm', $.string.padNumber( this.minutes(), 2 ));
			result = $.string.replace(result, 'm', this.minutes() );
			result = $.string.replace(result, 'MM', $.string.padNumber( this.minutes(), 2 ));
			result = $.string.replace(result, 'M', this.minutes() );

			result = $.string.replace(result, 'ss', $.string.padNumber( this.seconds(), 2 ));
			result = $.string.replace(result, 's', this.seconds() );

			result = $.string.replace(result, 'ms', this.miliseconds() );
			result = $.string.replace(result, 'x', this.miliseconds() );

			result = $.string.replace(result, 'sg', this.sign());
			return result;
		}
	}

});


$.currency = function(value){
	return parseFloat(value).toFixed(2);
};

////////////////////////////////////////////////////////////////////////////////
/**
 * HashBang para manipular el fragmento de la URL luego de #!/
 */

HashBang = $.Class({
	get: function(url, query){
		return new HashBang.Result(url, query);
	},

	getObject: function(url){
		var url = url || $.param.fragment(),
			hash = $.string.replace(url, '!/', '' ),
			hash = $.string.replace(hash, '#', '' ),
			splitted = hash.split("?"),
			path = splitted[0],
			querystring = splitted[1],
			parsedPath = $.querystring.path.toObject( path ),
			parsedQuery;

		if(!$.deparam) throw ('$.hashbang requires jquery-bbq\'s $.deparm to work properly');

		parsedQuery = querystring && $.deparam(querystring, true);

		return new HashBang.Result(parsedPath, parsedQuery);

		/*
		var result = [parsedPath, parsedQuery];
		result.query = parsedQuery || {};
		result.path = parsedPath;
		return result;
		*/
	}
});
HashedArray = function(hash){
	var index = 0;
	var self = this;
	$.each(hash || {}, function(key, value){
		self[key] = value;
		self.push({key: key, value: value});
	})
};
HashedArray.prototype = Array.prototype;



HashBang.Result = $.Class({

	/**
	 * params [String | Object] path, Object query
	 *
	 */
	init: function(path, query){
		this.path = path || {};
		this.query = query || {};

		if(path == null || typeof path == 'string'){
			this.fromString(path);
		}

		if( query ) this.mergeQuery(query);
	},

	clone: function(){
		return new this.constructor($.extend({}, this.path), $.extend({}, this.query));
	},

	_splitURL: function(url){
		var url = url || $.param.fragment();
		var hash = $.string.replace(url, '!/', '' );
		var hash = $.string.replace(hash, '#', '' );
		return hash.split("?");
	},

	_parsePath: function(url){
		return $.querystring.path.toObject(url) || {};
	},

	_parseQuery: function(url){
		var parsedQuery = url && $.deparam(url) || {};
		return parsedQuery;
	},

	fromString: function(url){
		var splitted = this._splitURL(url);
		var path = splitted[0];
		var query = splitted[1];

		var parsedPath = this._parsePath(path);
		var parsedQuery = this._parseQuery(query);

		this.path = parsedPath;
		this.query = parsedQuery;

		return this;
	},

	cleanQuery: function(){
		var self = this;
		$.each(this.query, function(key, value){
			if(value === undefined) delete self.query[key];
		});
		return this.query;
	},

	cleanPath: function(){
		var self = this;
		$.each(this.path, function(key, value){
			if(value === undefined) delete self.path[key];
		});
		return this.path || {};
	},

	toURL: function(withoutHash){
		var path = $.querystring.path.fromObject(this.path);
		if(!$.string.endsWith(path, '/')) path+='/';
		var query = $.param(this.cleanQuery(), true); // no codificar parmetros
		var fullpath = $.arrayExclude([path, query || undefined], [undefined]).join('?');
		if(!$.string.startsWith(fullpath, '/')) fullpath = '/' + fullpath;
		return (withoutHash ? '' : '#!') + fullpath;
	},

	toString: function(withoutHash){
		return this.toURL(withoutHash);
	},

	/**
	 * pasar valores undefined para eliminar claves actuales
	 */
	mergeQuery: function(query){
		var self = this;
		$.each(query, function(key, value){
			self.query[key] = value;
		});
		return this;
	},

	removeQueryKey: function(key){
		delete this.query[key];
		return this;
	},

	setQuery: function(query){
		if(typeof query == 'string') query = this._parseQuery(query);
		this.query = query || {};
		return this;
	},

	inQuery: function(key){
		return key in this.cleanQuery();
	},


	mergePath: function(path){
		var self = this;
		$.each(path, function(key, value){
			self.path[key] = value;
			if(value===undefined) delete self.path[key];
		});
		return this;
	},

	removePathKey: function(key){
		delete this.path[key];
		return this;
	},

	setPath: function(path){
		if(typeof path == 'string') path = this._parsePath(path);
		this.path = path || {};
		return this;
	},

	getPath: function(){
		return new HashedArray(this.path);
	},

	reset: function(){
		this.path = {};
		this.query = {};
		return this;
	},

	navigate: function(){
		if( location.hash != this.toURL()){
			//console.log( 'desde',location.hash, 'a', this.toURL() );
			location.hash = this.toURL(); // NOTA: IE recarga la pgina entera si se utiliza location.href aunque se cambie slo el hash en determinadas ocasiones
		}
		return this;
	},

	replace: function(){
		var self = this
			, newUrl = self.toURL()
			, conTimeout = true; // anteriormente era slo para IE. O sea, usaba conTimeout = $.browser.msie

		if(location.replace){
			if( conTimeout ){
				setTimeout(function(){
					location.replace( newUrl );
				},0);
			} else {
				location.replace( newUrl );
			}
		} else this.navigate();
	},

	inPath: function(key){
		return key in this.path;
	},

	firstPathIs: function(key){
		var n = 0;
		var nPath = this.getPath()[n];
		return nPath && nPath.key == key;
	},

	isPathEmpty: function(key){
		return !this.path[key];
	},

	pathStartsWith: function( path ){
		return $.string.startsWith($.hashbang.get().toURL(true), path);
	}

});


HashBang.Result.prototype.toString = function(withoutHash){
	return this.toURL(withoutHash);
};



$.hashbang = new HashBang();


////////////////////////////////////////////////////////////////////////////////


/*
  jQuery deparam is an extraction of the deparam method from Ben Alman's jQuery BBQ
  http://benalman.com/projects/jquery-bbq-plugin/
*/
(function ($) {
  $.deparam = function (params, coerce) {
    var obj = {},
        coerce_types = { 'true': !0, 'false': !1, 'null': null };

    // Iterate over all name=value pairs.
    $.each(params.replace(/\+/g, ' ').split('&'), function (j,v) {
      var param = v.split('='),
          key = decodeURIComponent(param[0]),
          val,
          cur = obj,
          i = 0,

          // If key is more complex than 'foo', like 'a[]' or 'a[b][c]', split it
          // into its component parts.
          keys = key.split(']['),
          keys_last = keys.length - 1;

      // If the first keys part contains [ and the last ends with ], then []
      // are correctly balanced.
      if (/\[/.test(keys[0]) && /\]$/.test(keys[keys_last])) {
        // Remove the trailing ] from the last keys part.
        keys[keys_last] = keys[keys_last].replace(/\]$/, '');

        // Split first keys part into two parts on the [ and add them back onto
        // the beginning of the keys array.
        keys = keys.shift().split('[').concat(keys);

        keys_last = keys.length - 1;
      } else {
        // Basic 'foo' style key.
        keys_last = 0;
      }

      // Are we dealing with a name=value pair, or just a name?
      if (param.length === 2) {
        val = decodeURIComponent(param[1]);

        // Coerce values.
        if (coerce) {
          val = val && !isNaN(val)              ? +val              // number
              : val === 'undefined'             ? undefined         // undefined
              : coerce_types[val] !== undefined ? coerce_types[val] // true, false, null
              : val;                                                // string
        }

        if ( keys_last ) {
          // Complex key, build deep object structure based on a few rules:
          // * The 'cur' pointer starts at the object top-level.
          // * [] = array push (n is set to array length), [n] = array if n is
          //   numeric, otherwise object.
          // * If at the last keys part, set the value.
          // * For each keys part, if the current level is undefined create an
          //   object or array based on the type of the next keys part.
          // * Move the 'cur' pointer to the next level.
          // * Rinse & repeat.
          for (; i <= keys_last; i++) {
            key = keys[i] === '' ? cur.length : keys[i];
            cur = cur[key] = i < keys_last
              ? cur[key] || (keys[i+1] && isNaN(keys[i+1]) ? {} : [])
              : val;
          }

        } else {
          // Simple key, even simpler rules, since only scalars and shallow
          // arrays are allowed.

          if ($.isArray(obj[key])) {
            // val is already an array, so push on the next value.
            obj[key].push( val );

          } else if (obj[key] !== undefined) {
            // val isn't an array, but since a second value has been specified,
            // convert val into an array.
            obj[key] = [obj[key], val];

          } else {
            // val is a scalar.
            obj[key] = val;
          }
        }

      } else if (key) {
        // No value was defined, so set something meaningful.
        obj[key] = coerce
          ? undefined
          : '';
      }
    });

    return obj;
  };
})(jQuery);



////////// DEEP COPY WITHOUT ARRAYS
jQuery.extendNoDeepCopyArray = jQuery.fn.extend = function() {
	var options, name, src, copy, copyIsArray, clone,
		target = arguments[0] || {},
		i = 1,
		length = arguments.length,
		deep = false;

	// Handle a deep copy situation
	if ( typeof target === "boolean" ) {
		deep = target;
		target = arguments[1] || {};
		// skip the boolean and the target
		i = 2;
	}

	// Handle case when target is a string or something (possible in deep copy)
	if ( typeof target !== "object" && !jQuery.isFunction(target) ) {
		target = {};
	}

	// extend jQuery itself if only one argument is passed
	if ( length === i ) {
		target = this;
		--i;
	}

	for ( ; i < length; i++ ) {
		// Only deal with non-null/undefined values
		if ( (options = arguments[ i ]) != null ) {
			// Extend the base object
			for ( name in options ) {
				src = target[ name ];
				copy = options[ name ];

				// Prevent never-ending loop
				if ( target === copy ) {
					continue;
				}

				// Recurse if we're merging plain objects or arrays
				if ( deep && copy && ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) {
					if ( copyIsArray ) {
						copyIsArray = false;
						clone = src && jQuery.isArray(src) ? [] : []; // SE SOBREESCRIBEN LOS ARRAYS, NO SE AGRANDAN

					} else {
						clone = src && jQuery.isPlainObject(src) ? src : {};
					}

					// Never move original objects, clone them
					target[ name ] = jQuery.extendNoDeepCopyArray( deep, clone, copy );

				// Don't bring in undefined values
				} else if (  copy !== undefined ) {
					target[ name ] = copy;
				}
			}
		}
	}

	// Return the modified object
	return target;
};


//////// CUSTOM TRACKER, como Analytics /////////////
window.SSAQ = $.Class({
	init: function( url ){
		if( ! ( window._ssaq instanceof this ) ){
			window._ssaq = new SSAQ( window._ssaq, url);
		}
	},
	prototype: {
		_processDefaultArray: function( arr ){
			var arrLength = arr.length;
			for (var i = 0 ; i < arrLength ; i++){
				this.push( arr[i] );
			}
		},

		init: function( _ssaq, url ){
			this._url = url;
			this._processDefaultArray( _ssaq );
		},

		push: function( value ){
			var params = {
				utmsr	: [window.screen.availWidth, window.screen.availHeight].join('x'),
				utmpr	: window.devicePixelRatio || 1,
				utmhn	: document.location.hostname,
				utmr	: document.referrer
			};

			switch( value[0] ){
				case '_trackPageview': {
					params['utmp'] = value[1];

					if($.getObjectProperty(window, 'ko.NetworkInfo')){
						params['utmlt'] = ko.NetworkInfo.getInstance().loadingTime();

						params['utmticnn'] = ko.NetworkInfo.getInstance().connectionTime();
						params['utmtidns'] = ko.NetworkInfo.getInstance().dnsTime();
						params['utmtisrv'] = ko.NetworkInfo.getInstance().serverTime();
						params['utmtibrw'] = ko.NetworkInfo.getInstance().browserTime();
						params['utmtitot'] = ko.NetworkInfo.getInstance().totalTime();
						params['utmtiapp'] = ko.NetworkInfo.getInstance().appLoadingTime();
						params['utmtiatt'] = ko.NetworkInfo.getInstance().appTotalTime();
					}
				}
			}

			var src = this._url + '?' + $.param(params);
			var $img = $('<img/>')
				.attr('src', src );

		}
	}
});

window._ssaq = [];



//////// REGULAR EXPRESSIONS ////////
$.extend($, {
	'regexp' : {
		url		: /\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/
	}
});


/**
 * Paul Irish window.requestAnimationFrame polyfill
 * http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/
 */
(function() {
	var lastTime = 0;
	var vendors = ['webkit', 'moz'];
	for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
		window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
		window.cancelAnimationFrame =
			window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];
	}

	if (!window.requestAnimationFrame)
		window.requestAnimationFrame = function(callback, element) {
			var currTime = new Date().getTime();
			var timeToCall = Math.max(0, 16 - (currTime - lastTime));
			var id = window.setTimeout(function() { callback(currTime + timeToCall); },
				timeToCall);
			lastTime = currTime + timeToCall;
			return id;
		};

	if (!window.cancelAnimationFrame){
		window.cancelAnimationFrame = function(id) {
			clearTimeout(id);
		};
	}

	window.requestAnimFrame = window.requestAnimationFrame;
}());
//////////////////





$(window).keydown(function(e) {
	if (e.keyCode == 19) {
		debugger;
	}
});


////////////////////////////////////////////////////////////////////////////////
// obtener las dimensiones de un objeto oculto
/**
 * realWidth, realHeight, realOuterWidth, realOuterHeight, realInnerWidth, realInnerHeight, realOffset
 */
(function(){
	var methods = ['width', 'height', 'outerWidth', 'outerHeight', 'innerWidth', 'innerHeight', 'offset'];

	/*
	var isValidResult = function( methodName, result ){
		if( methodName === 'offset'){
			result.top !== 0 && result.left !=0;
		} else {
			return result !== 0;
		}
	};
	*/

	$.each( methods, function( index, methodName ){
		var newMethodName = 'real' + $.string.capitalize(methodName);
		window.console && console.assert && console.assert( !$.fn[newMethodName] );
		$.fn[newMethodName] = (function(){
			return function(){
				var $element = $(this)
					, element = $element[0]
					, result = $(this)[methodName].apply( this, arguments )
					, isValid = !!( element && $element.is(':visible') && element.clientHeight && element.clientWidth);

				if($._replace !== false ){
					if( !isValid ){
						var hiddenParents = $element.parents(':css(display=none)');
						hiddenParents.push( $element );

						$.each( hiddenParents, function( index, parent ){
							var parentElement = $(parent)[0];
							if( parentElement && parentElement.style ){
								var _oldDisplay = parentElement.style.display;
								$(parent).data('_oldDisplay', _oldDisplay );
								$(parent).show();
							}
						});

						result =  $element[methodName].apply( this, arguments );

						$.each( hiddenParents, function( index, parent ){
							var parentElement = $(parent)[0];
							if( parentElement && parentElement.style ){
								parentElement.style.display = $(parent).data('_oldDisplay' );
							}
						});
					}
				}

				return result;
			}
		})();
	});

})();

$(function(){
	if (navigator.userAgent.match(/msie|trident/i) ){
		$('html').removeClass('flexbox').addClass('no-flexbox');
	}
});


(function () {
	function extendAccounting(){
		if ( window.accounting && !accounting.formatMoneyDecimal ){
			accounting.formatMoneyDecimal = function ( number ){
				var decimal = Math.abs( number - parseInt(number) )
					, args = arguments;

				args[0] = decimal;
				return accounting.formatMoney.apply( accounting, args ).substr(1);
			};

			accounting.formatMoneyInt = function ( number ){
				var args = $.extend([], arguments)
					, decimal = args[4] || accounting.settings.currency.decimal

				//args[2] = 0;
				var formatedValue = accounting.formatMoney.apply( accounting, args );
				formatedValue = formatedValue.split( decimal );
				if( formatedValue.length > 1 ){
					formatedValue.pop();

				}

				return formatedValue.join( decimal );
			};

			return true;
		}
	}

	if(! extendAccounting() ){

	}

	$(function(){
		extendAccounting();
	});
})();




////////////////////////////////////////
(function($) {
	var sR = {
		defaults: {
			slideSpeed: 400,
			easing: false,
			callback: false
		},
		thisCallArgs: {
			slideSpeed: 400,
			easing: false,
			callback: false
		},
		methods: {
			up: function (arg1,arg2,arg3) {
				if(typeof arg1 == 'object') {
					for(p in arg1) {
						sR.thisCallArgs.eval(p) = arg1[p];
					}
				}else if(typeof arg1 != 'undefined' && (typeof arg1 == 'number' || arg1 == 'slow' || arg1 == 'fast')) {
					sR.thisCallArgs.slideSpeed = arg1;
				}else{
					sR.thisCallArgs.slideSpeed = sR.defaults.slideSpeed;
				}

				if(typeof arg2 == 'string'){
					sR.thisCallArgs.easing = arg2;
				}else if(typeof arg2 == 'function'){
					sR.thisCallArgs.callback = arg2;
				}else if(typeof arg2 == 'undefined') {
					sR.thisCallArgs.easing = sR.defaults.easing;
				}
				if(typeof arg3 == 'function') {
					sR.thisCallArgs.callback = arg3;
				}else if(typeof arg3 == 'undefined' && typeof arg2 != 'function'){
					sR.thisCallArgs.callback = sR.defaults.callback;
				}
				var $cells = $(this).find('td');
				$cells.wrapInner('<div class="slideRowUp" />');
				var currentPadding = $cells.css('padding');
				$cellContentWrappers = $(this).find('.slideRowUp');
				$cellContentWrappers.slideUp(sR.thisCallArgs.slideSpeed,sR.thisCallArgs.easing).parent().animate({
					paddingTop: '0px',
					paddingBottom: '0px'},{
					complete: function () {
						$(this).children('.slideRowUp').replaceWith($(this).children('.slideRowUp').contents());
						$(this).parent().css({'display':'none'});
						$(this).css({'padding': currentPadding});
					}});
				var wait = setInterval(function () {
					if($cellContentWrappers.is(':animated') === false) {
						clearInterval(wait);
						if(typeof sR.thisCallArgs.callback == 'function') {
							sR.thisCallArgs.callback.call(this);
						}
					}
				}, 100);
				return $(this);
			},
			down: function (arg1,arg2,arg3) {
				if(typeof arg1 == 'object') {
					for(p in arg1) {
						sR.thisCallArgs.eval(p) = arg1[p];
					}
				}else if(typeof arg1 != 'undefined' && (typeof arg1 == 'number' || arg1 == 'slow' || arg1 == 'fast')) {
					sR.thisCallArgs.slideSpeed = arg1;
				}else{
					sR.thisCallArgs.slideSpeed = sR.defaults.slideSpeed;
				}

				if(typeof arg2 == 'string'){
					sR.thisCallArgs.easing = arg2;
				}else if(typeof arg2 == 'function'){
					sR.thisCallArgs.callback = arg2;
				}else if(typeof arg2 == 'undefined') {
					sR.thisCallArgs.easing = sR.defaults.easing;
				}
				if(typeof arg3 == 'function') {
					sR.thisCallArgs.callback = arg3;
				}else if(typeof arg3 == 'undefined' && typeof arg2 != 'function'){
					sR.thisCallArgs.callback = sR.defaults.callback;
				}
				var $cells = $(this).find('td');
				$cells.wrapInner('<div class="slideRowDown" style="display:none;" />');
				$cellContentWrappers = $cells.find('.slideRowDown');
				$(this).show();
				$cellContentWrappers.slideDown(sR.thisCallArgs.slideSpeed, sR.thisCallArgs.easing, function() { $(this).replaceWith( $(this).contents()); });

				var wait = setInterval(function () {
					if($cellContentWrappers.is(':animated') === false) {
						clearInterval(wait);
						if(typeof sR.thisCallArgs.callback == 'function') {
							sR.thisCallArgs.callback.call(this);
						}
					}
				}, 100);
				return $(this);
			}
		}
	};

	$.fn.slideRow = function(method,arg1,arg2,arg3) {
		if(typeof method != 'undefined') {
			if(sR.methods[method]) {
				return sR.methods[method].apply(this, Array.prototype.slice.call(arguments,1));
			}
		}
	};
})(jQuery);


////////////////////////////
(function ($) {
	/**
	 * Clase para extraer partes de una URL. Por ahora solo hostname
	 * todo: realizar en el futuro otros mtodos
	 */
	$.URL = $.Class({
		hasProtocol: function( url ){
			var re = /^\w+\:\/\//;
			return re.test(url);
		},

		prototype: {
			init: function( url ){
				this._url = url || document.location.href;
				this._a = document.createElement('a');
				this._a.href = this._url;
			},

			hostname: function(){
				return this._a.hostname;
			},

			host: function(){
				return this._a.host;
			},

			protocol: function(){
				return this._a.protocol;
			},

			port: function(){
				return this._a.port;
			},

			hash: function(){
				return this._a.hash;
			},

			pathname: function(){
				return this._a.pathname;
			},

			search: function( value ){
				if(arguments.length > 0){
					if( !$.string.startsWith( value, '?' ) ){
						value = '?' + value;
					}
					this._a.search = value;
				}
				return this._a.search;
			},

			plainsearch: function( value ){
				if(arguments.length > 0){
					this.search( value );
				}
				var result = this.search();
				if( result ){
					result = result.substr(1);
				}
				return result;
			},

			deparamsearch: function( value ){
				if(arguments.length > 0){
					return this.plainsearch( $.param( value ) );
				}
				return $.deparam( this.plainsearch() );
			},

			beforeSearch: function(){
				if(arguments.length > 0){

				}
				var splitted = this._url.split('?');
				return splitted[0];
			},

			mergeSearch: function( values ){
				var deparam = $.extend( this.deparamsearch(), values );
				this.deparamsearch( deparam );
				return this;
			},

			toString: function(){
				return this._a.href;
			}
		}

	})
}(jQuery));

////////////////////////////
(function ($) {
	/**
	 */
	var FileDownloader = $.Class({
		defaultOptions: {
			cookie	: 'fileDownload',
			delay	: 500
		},

		prototype: {
			init: function( url, options ){
				this.options = $.extend( this.constructor.defaultOptions , options );
				$.removeCookie( this.options.cookie, {path: '/'} );
				this._url = url;
				this._$ifr = $('<iframe>');
				this._$ifr
					.attr("src", url )
					.hide();
				$('body').append(this._$ifr);
				var deferred = $.Deferred();
				$.extend( this, deferred );
				this._checkloadedInterval = setInterval( this._checkloaded.bind( this ), this.options.delay );
			},

			_checkloaded: function(){
				var cookieValue = $.cookie( this.options.cookie );
				if( cookieValue ){
					if( cookieValue == 'true'){
						this.resolve( { result: this._url } );
					} else {
						this.reject( { error: cookieValue } );
					}
					clearInterval( this._checkloadedInterval );
					$.removeCookie( this.options.cookie, {path: '/'} );
				}
			}
		}
	});

	$.fileDownload = function( url ){
		return new FileDownloader( url );
	}
}(jQuery));


(function() {
	var lastTime = 0;
	var vendors = ['webkit', 'moz'];
	for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
		window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
		window.cancelAnimationFrame =
			window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];
	}

	if (!window.requestAnimationFrame)
		window.requestAnimationFrame = function(callback, element) {
			var currTime = new Date().getTime();
			var timeToCall = Math.max(0, 16 - (currTime - lastTime));
			var id = window.setTimeout(function() { callback(currTime + timeToCall); },
				timeToCall);
			lastTime = currTime + timeToCall;
			return id;
		};

	if (!window.cancelAnimationFrame)
		window.cancelAnimationFrame = function(id) {
			clearTimeout(id);
		};
}());

(function($){
	var collectInterval = 5000
		, extendPlayDuration = 500  // es el tiempo por el cual se sigue calculando el parallax LUEGO de que dejaron de haber eventos
		, detectAnimationEnd = true
		, freeze = false
		, hasVerticalScroll
		, hasHorizontalScroll
		, fixFirefoxScroll = false
		, parallaxVersion = $.getAllQueryStrings().parallaxVersion;


	//, backgroundAttachment = 'initial'

	if( $.getAllQueryStrings().testingPerformance == 1) {
		//collectInterval = 1000;
	}

	if( $.getAllQueryStrings().parallaxFreeze == 1) {
		freeze = 1;
	}

	if( $.getAllQueryStrings().fixFirefoxScroll == 'true') {
		fixFirefoxScroll = true;
	}


	ParallaxHandler = $.Class({
		getInstance: function(){
			if( !this._instance ){
				this._instance = new this();
			}
			return this._instance;
		},

		prototype: {
			/**
			 * ante un evento:
			 * 	si no se pidi un tick, pedir un tick
			 *
			 *
			 */

			init: function( options ){
				var self = this;
				this._elements = [];
				this._parents = [];

				this._updateRequested = false;
				this._ticking = false;
				this._lastElementsCollectionTime = 0;

				this.options = $.extend({
					'aditionalOuter'			: $.getAllQueryStrings().aditionalOuter !== 'false',
					'aditionalOuterOptimize'	: $.getAllQueryStrings().aditionalOuterOptimize !== 'false'
				}, options );


				$(window).on('resize', $.debounce(500, function( e ){
					//console.debug('scroll parallax');
					self.updateAndPlay();
				}));


				document.addEventListener('scroll', function(){
					self.updateAndPlay();
					//console.debug('scroll')
				}, true);
				/*
				$(window).on('scroll', function( e ){
					//console.debug('scroll parallax');
					self.updateAndPlay();
				});
				*/


				///////////////////////////////////////////////////////////
				if( fixFirefoxScroll ){
					(function($){
						var isScrolling = false;
						var lastScrollData = {};
						var duration;
						var amount = 0;
						$(window).on('DOMMouseScroll', function( e ){
							var e = window.event || e.originalEvent;
							var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));
							e.preventDefault();
							if( delta * amount < 0 ) amount = 0;
							amount += delta * 100;
							var durationConsumed = 0;
							if( isScrolling && lastScrollData ){
								//durationConsumed = lastScrollData.options.duration * lastScrollData.pos;
								//console.debug(lastScrollData);
								//amount -= ( lastScrollData.now - lastScrollData.end ) / 2;
							}
							duration = 300;
							//duration = Math.max(200,  400 - durationConsumed - Math.abs( amount ) );
							var expression = ( amount < 0 ? '+' : '-' ) + '=' + Math.abs(amount)+'px';
							var easing = isScrolling ? 'easeOutSine' : 'swing';
							//console.debug( expression );
							$(window).stop().scrollTo( expression ,{
								'axis'		: 'y',
								'duration'	: duration,
								'easing'	: easing,
								'step'		: function(value, data ){
									lastScrollData = data;
									//console.debug( arguments );
								},
								'complete'	: function(){
									amount = 0;
									isScrolling = false;
								}
							});
							isScrolling = true;
						});
					})( jQuery );
				}
				///////////////////////////////////////////////////////////

				$(window).on('slide', function( e ){
					//console.debug('slide parallax');
					self.updateAndPlay();
				});

				$(window).on('sliding', function( e ){
					//console.debug('sliding parallax');
					self.updateAndPlay();
				});

				if( detectAnimationEnd ){
					$(document).on([
						'webkitAnimationStart',
						'mozAnimationStart',
						'MSAnimationStart',
						'oanimationstart',
						'animationstart'
					].join(' '), function(e) {
						//console.debug('animationstart parallax');
						self.updateAndPlay();
					});


					$(document).on([
						'webkitAnimationIteration',
						'mozAnimationIteration',
						'MSAnimationIteration',
						'oanimationiteration',
						'animationiteration'
					].join(' '), function(e) {
						//console.debug('animationiteration parallax');
						self.updateAndPlay();
					});

					$(document).on([
						'webkitAnimationEnd',
						'mozAnimationEnd',
						'MSAnimationEnd',
						'oanimationend',
						'animationend'
					].join(' '), function(e) {
						//console.debug('animationend parallax');
						self.updateAndPlay();
					});


				}

				/*
				setInterval( this.onCollectInterval.bind(this), collectInterval );
				this._requestsPerSecond = 0;
				*/

				/*
				 setInterval( function(){
				 console.debug( self._requestsPerSecond );
				 self._requestsPerSecond = 0;
				 }, 1000 );
				 */
			},

			updateAndPlay: function(){
				if( !this._ticking ){
					this._ticking = true;
					requestAnimationFrame( this._doUpdate.bind( this ) );
				}
			},

			requestUpdate: function(){
				this._lastElementsCollectionTime = 0; // se colectarn nuevamente los elementos
				this.updateAndPlay();
			},

			update: function(){
				this.requestUpdate();
			},

			_doUpdate: function(){
				var d = new Date();
				if( d - this._lastElementsCollectionTime > collectInterval ){
					//console.debug('collecting elements');
					this.collectElements();
					this._lastElementsCollectionTime = d;
				}

				this._update();
				this._ticking = false;
				if( this.isPlaying() ){
					//console.debug('extendplay parallax');
					this.updateAndPlay();
				}
			},

			state: function(){
				return this._state;
			},

			isPlaying: function(){
				return this.state() == 'play';
			},

			extendPlay: function(){
				if( extendPlayDuration ){
					var self = this;
					self._state = 'play';
					clearTimeout( self._pauseTimeout );
					self._pauseTimeout = setTimeout( function(){
						self.pause();
					}, extendPlayDuration );
				}
			},

			pause: function(){
				this._state = 'pause';
			},

			_updateElement: function( $element ){
				var self = this;
				var parallax = parseFloat( $element.attr('data-parallax') )
					, freezeAmount = $element.attr('data-parallax-freeze') || 0;

				if( !$element.is(':visible') ) return;

				if( freeze ){
					freezeAmount = 1;
				}

				parallax = (parallax * (1-freezeAmount)) + (1 * freezeAmount);

				var	$dataParallaxElement = $element.data('parallax:element')
					, parallaxType = $element.attr('data-parallax-type') || 'backgroundImage'
					, parallaxDirection = $element.attr('data-parallax-direction') || 'both'
					, backgroundPosition = $element.attr('data-background-position')
					, backgroundPositionX = $element.attr('data-background-position-x')
					, backgroundPositionY = $element.attr('data-background-position-y')
					, backgroundPositionXOffset = $element.attr('data-background-position-x-offset')
					, backgroundPositionYOffset = $element.attr('data-background-position-y-offset')
					, backgroundImage = $element.css("backgroundImage")
					//, parent = $element.closest( $element.attr('data-parallax-parent') )[0]
					//, parent = $element.data('parallax.data.parent')
					, parent = $element.data('parallax:parent')
					, backgroundAttachment = this.getBackgroundAttachment( $element, parallax )
					, parallaxOptimizeOuter = Number( $element.attr('data-parallax-optimize-outer'))
					, doParallax;

				if( isNaN(parallaxOptimizeOuter )) parallaxOptimizeOuter = 1;

				doParallax = parallax !== undefined && backgroundImage && $dataParallaxElement; // && parallax != 1; todo: agregar la ltima condicion
				if( doParallax ){
					/*
					var outside = $dataParallaxElement.isOutsideWindow( {
						container: parent
					});
					*/

					var offset = $dataParallaxElement.relativeOffset( parent );
					var outside = $dataParallaxElement.isOutsideWindow( offset );

					var lastoutside = $element.data('parallax:lastoutside');
					$element.data('parallax:lastoutside', outside );

					var relativeVerticalMiddle = outside.relativeVerticalMiddle;

					if( freeze ){
						relativeVerticalMiddle = .5;
					} else {
						if( lastoutside && outside.relativeTop != lastoutside.relativeTop ){
							// si el elemento cambi de posicion, se tira un play para que se contine el update por un rato
							self.extendPlay();
						}
					}

					////////////////////////////////////////////////////////////////////
					if( backgroundPosition ){
						backgroundPosition = backgroundPosition.split(' ');
						backgroundPositionX = backgroundPosition[0];
						backgroundPositionY = backgroundPosition[1];
					}
					if( backgroundPositionY == 'top' ) backgroundPositionY = '0%';
					if( backgroundPositionY == 'bottom' ) backgroundPositionY = '100%';
					if( backgroundPositionY == 'center' ) backgroundPositionY = '50%';
					if( backgroundPositionX == 'left' ) backgroundPositionX = '0%';
					if( backgroundPositionX == 'right' ) backgroundPositionX = '100%';
					if( backgroundPositionX == 'center' ) backgroundPositionX = '50%';

					if( backgroundPositionX === undefined ) backgroundPositionX = '50%';
					if( backgroundPositionY === undefined ) backgroundPositionY = '50%';
					////////////////////////////////////////////////////////////////////
					if( outside.top < 2 && outside.bottom < 2 ){

						if( parallaxType == 'backgroundImage' ){
							var oldRelativeVerticalMiddle = $element.data('_parallax.relativeVerticalMiddle' );
							if( relativeVerticalMiddle != oldRelativeVerticalMiddle ) {
								//console.debug( 'relativeVerticalMiddle', relativeVerticalMiddle - oldRelativeVerticalMiddle );
							}
							$element.data('_parallax.relativeVerticalMiddle', relativeVerticalMiddle );
							var backgroundPosition = self.getParallaxBackgroundPosition( parallax, relativeVerticalMiddle, $element, parent , backgroundPositionX, backgroundPositionY, backgroundPositionXOffset, backgroundPositionYOffset )
							$element.css({
								'backgroundPosition' 	: backgroundPosition/*,
								 'transition'			: '.5s linear all'*/
							});
							if($element.css('backgroundAttachment') != backgroundAttachment ) {
								$element.css({
									'backgroundAttachment': backgroundAttachment
								});
							}
						}
						else if( parallaxType = 'element'){
							var screenPositionData = outside;
							var style = this._getParallaxTypeElementStyle( parallax, offset , $element, parent , backgroundPositionX, backgroundPositionY, backgroundPositionXOffset, backgroundPositionYOffset, parallaxDirection, parallaxOptimizeOuter );
							$element.css( style );
						}
					}
				} else {
					if( parallax == 1 ){
						if( $element.css('backgroundAttachment') == 'fixed' ){
							$element.css({'backgroundAttachment': 'inherit'});
						}
					}
				}


			},

			_getParallaxTypeElementStyle: function( parallax, offset , $element, parent, bgPosH, bgPosV, backgroundPositionOffsetX, backgroundPositionOffsetY, parallaxDirection, parallaxOptimizeOuter ){
				var result = {
					/*'top' 					: 0,
					'right'					: 0,
					'bottom'				: 0,
					'left'					: 0,*/
					'transform'				: {
						'translateX'		: '0',
						'translateY'		: '0',
						'translate3D'		: '0,0,0'
					},
					'backgroundPosition'	: '',
					'position'				: 'absolute'
				};

				var $dataParallaxElement = $element.data('parallax:element')
					, $parent = parent
					, backgroundAttachment = this.getBackgroundAttachment( $element, parallax )
					, isFixed = backgroundAttachment == 'fixed'
					, hasHorizontalScroll = $.inArray( parallaxDirection, ['horizontal', 'both'] ) != -1
					, hasVerticalScroll = $.inArray( parallaxDirection, ['vertical', 'both'] ) != -1

				if( $dataParallaxElement ){


					var centerPos = {
						'top'		: hasVerticalScroll 	? offset.percents.center.top - .5	: 0,
						'left'		: hasHorizontalScroll	? offset.percents.center.left - .5	: 0
					}


					//result.transform.translateX = ( -centerPos.left * parallax * offset.scaled.dimensions.containerWidth ) + 'px';
					//result.transform.translateY = ( -centerPos.top * parallax * offset.scaled.dimensions.containerHeight) + 'px';
					result.backgroundPosition = $.cssBackgroundPositionWithOffset( bgPosH, bgPosV, backgroundPositionOffsetX, backgroundPositionOffsetY );

					if( this.options.aditionalOuter ){
						var aditionalOuter = this._getAditionalOuter(
							offset.scaled.dimensions.width,
							offset.scaled.dimensions.height,
							offset.scaled.dimensions.containerWidth,
							offset.scaled.dimensions.containerHeight,
							offset.scaled.top,
							offset.scaled.fromRight,
							offset.scaled.fromBottom,
							offset.scaled.left,
							parallax,
							hasHorizontalScroll,
							hasVerticalScroll,
							isFixed,
							$dataParallaxElement,
							$parent,
							parallaxOptimizeOuter
						);

						result.top 		= -aditionalOuter.top + 'px';
						result.bottom 	= -aditionalOuter.bottom+ 'px';
						result.left 	= -aditionalOuter.left + 'px';
						result.right 	= -aditionalOuter.right + 'px';
					}

					parallax = isFixed ? -parallax : 1 - parallax;
					result.position = backgroundAttachment == 'fixed' ? 'fixed' : 'absolute';

					result.transform = $.cssTransform([
						//{'rotate'		: -offset.matrix.element.deg() + 'deg' },
						{'translateX'	: ( -centerPos.left * parallax * offset.scaled.dimensions.containerWidth ) + 'px'},
						{'translateY'	: ( -centerPos.top * parallax * offset.scaled.dimensions.containerHeight) + 'px'},
						{'translate3D'	: '0,0,0'}//,
						//{'rotate'		: offset.matrix.element.deg() + 'deg' }
					]);

				} else {
					console.error('_getParallaxTypeElementStyle: no hay $dataParallaxElement');
				}

				return result;
			},

			/*
			_getAditionalOuter: function( elementWidth, elementHeight, containerWidth, containerHeight, top, fromRight, fromBottom, left, parallax, hasHorizontalScroll, hasVerticalScroll, isFixed ){
				var result = {
					'top'		: 0,
					'right'		: 0,
					'bottom'	: 0,
					'left'		: 0
				};

				var parallaxedElementHeight = elementHeight
					, parallaxedElementWidth = elementWidth;

				if( parallax >= 1 ){
					if( hasVerticalScroll) parallaxedElementHeight = - ( containerHeight - parallax * ( containerHeight + elementHeight ));
					if( hasHorizontalScroll) parallaxedElementWidth  =  -( containerWidth - parallax * ( containerWidth + elementWidth ));
				} else if( parallax >= 0 ){
					if( hasVerticalScroll ) parallaxedElementHeight = containerHeight - parallax * ( containerHeight - elementHeight );
					if( hasHorizontalScroll ) parallaxedElementWidth = containerWidth - parallax * (containerWidht - elementWidth );
				} else {
					if( hasVerticalScroll ) parallaxedElementHeight = containerHeight - parallax * ( containerHeight + elementHeight );
					if( hasHorizontalScroll ) parallaxedElementWidth = containerWidth - parallax * (containerWidht + elementWidth );
				}

				result['top'] 		= Math.abs( parallaxedElementHeight - elementHeight ) / 2;
				result['bottom'] 	= result['top'];
				result['left'] 		= Math.abs( parallaxedElementWidth - elementWidth ) / 2;
				result['right'] 	= result['left'];

				if( isFixed ){
					if( hasHorizontalScroll ) {
						var delta = ( containerWidth - elementWidth ) / 2;
						result['right'] -= delta;
						result['left'] -= delta;
					} else {
						result['right']-= fromRight;
						result['left']-= left;
					}
					if( hasVerticalScroll ){
						var delta = ( containerHeight - elementHeight ) / 2;
						result['top'] -= delta;
						result['bottom'] -= delta;
					} else {
						result['top']-= top;
						result['bottom']-= fromBottom;
					}
				}

				return result;
			},*/

			_scaleMultiplier: function( multiplier, amount ){
				// a,b
				// 3,1 = 3
				// 3,0 = 1
				// 3,.5 = 2
				// 0,1 = 0
				// 0,0 = 1
				// 0,.5 = .5

				return  1 + (multiplier - 1) * amount;
			},

			_getAditionalOuter: function( elementWidth, elementHeight, containerWidth, containerHeight, top, fromRight, fromBottom, left, parallax, hasHorizontalScroll, hasVerticalScroll, isFixed, $element, $parent, parallaxOptimizeOuter ){
				var result = {
					'top'		: 0,
					'right'		: 0,
					'bottom'	: 0,
					'left'		: 0
				};

				var parallaxedElementHeight = elementHeight
					, parallaxedElementWidth = elementWidth;

				var deltaHeight = containerHeight - elementHeight;
				var deltaWidth = containerWidth - elementWidth;
				var recorridoTop = Math.min( top, deltaHeight);
				var recorridoBottom = Math.min( fromBottom, deltaHeight);
				var recorridoLeft = Math.min( left, deltaWidth);
				var recorridoRight = Math.min( fromRight, deltaWidth);
				var resultTop = 0;

				var relativePositionScrollData = $element.relativePositionScrollData($parent || window, {scaled: true});
				if( relativePositionScrollData.scaled ){
					relativePositionScrollData = relativePositionScrollData.scaled;
				}

				//var aditionalOuterOptimize = this.options.aditionalOuterOptimize;
				var aditionalOuterOptimize = parallaxOptimizeOuter;


				// var maxInvisibleTop 	= aditionalOuterOptimize ? relativePositionScrollData.offset.inner.percent.minTop : 1;
				// var maxInvisibleBottom	= aditionalOuterOptimize ? relativePositionScrollData.offset.inner.percent.maxTop : 1;


				if( parallax >= 1 ){
					if( hasVerticalScroll) {
						parallaxedElementHeight = - ( containerHeight - parallax * ( containerHeight + elementHeight ));
						var offsetOuterPercentMinTop = this._scaleMultiplier(relativePositionScrollData.offset.outer.percent.minTop, aditionalOuterOptimize );
						var offsetOuterPercentMaxTop = this._scaleMultiplier(relativePositionScrollData.offset.outer.percent.maxTop, aditionalOuterOptimize );
						result['top'] 		= ( Math.abs( parallaxedElementHeight - elementHeight ) / 2 ) * offsetOuterPercentMinTop;
						result['bottom'] 	= ( Math.abs( parallaxedElementHeight - elementHeight ) / 2 ) * offsetOuterPercentMaxTop;
					}
					if( hasHorizontalScroll) {
						parallaxedElementWidth  =  -( containerWidth - parallax * ( containerWidth + elementWidth ));
						var offsetOuterPercentMinLeft = this._scaleMultiplier(relativePositionScrollData.offset.outer.percent.minLeft, aditionalOuterOptimize );
						var offsetOuterPercentMaxLeft = this._scaleMultiplier(relativePositionScrollData.offset.outer.percent.maxLeft, aditionalOuterOptimize );
						result['left'] 		= ( Math.abs( parallaxedElementWidth - elementWidth) / 2 ) * offsetOuterPercentMinLeft;
						result['right'] 	= ( Math.abs( parallaxedElementWidth - elementWidth ) / 2 ) * offsetOuterPercentMaxLeft;
					}
				} else if( parallax >= 0 ){
					if( hasVerticalScroll ) {
						parallaxedElementHeight = ( containerHeight - parallax * ( containerHeight - elementHeight ) );
						var offsetInnerPercentMinTop = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.minTop, aditionalOuterOptimize );
						var offsetInnerPercentMaxTop = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.maxTop, aditionalOuterOptimize );
						result['top'] 		= ( Math.abs( parallaxedElementHeight - elementHeight ) / 2 ) * offsetInnerPercentMinTop;
						result['bottom'] 	= ( Math.abs( parallaxedElementHeight - elementHeight ) / 2 ) * offsetInnerPercentMaxTop;
					}
					if( hasHorizontalScroll ) {
						parallaxedElementWidth = containerWidth - parallax * (containerWidht - elementWidth );
						var offsetInnerPercentMinLeft = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.minLeft, aditionalOuterOptimize );
						var offsetInnerPercentMaxLeft = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.maxLeft, aditionalOuterOptimize );
						result['left'] 		= ( Math.abs( parallaxedElementWidth - elementWidth ) / 2 ) * offsetInnerPercentMinLeft;
						result['right'] 	= ( Math.abs( parallaxedElementWidth - elementWidth ) / 2 ) * offsetInnerPercentMaxLeft;
					}
				} else {
					if( hasVerticalScroll ){
						var offsetInnerPercentMinTop = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.minTop, aditionalOuterOptimize );
						var offsetInnerPercentMaxTop = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.maxTop, aditionalOuterOptimize );

						var elementTopAtVerticalCenter = containerHeight / 2 - elementHeight / 2;
						// parte visible
						var resultTop = elementTopAtVerticalCenter - parallax * ( elementTopAtVerticalCenter );

						resultTop *= offsetInnerPercentMinTop;
						// parte fuera por arriba
						resultTop += -relativePositionScrollData.offscreen.top * parallax;
						result['top'] 		= resultTop;

						// parte visible
						var resultBottom = containerHeight - elementHeight - elementTopAtVerticalCenter - parallax * ( containerHeight - elementHeight - elementTopAtVerticalCenter );
						resultBottom *= offsetInnerPercentMaxTop;
						// parte fuera por abajo
						resultBottom += -relativePositionScrollData.offscreen.bottom * parallax;
						result['bottom'] = resultBottom;
					}
					if( hasHorizontalScroll ){
						var offsetInnerPercentMinLeft = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.minLeft, aditionalOuterOptimize );
						var offsetInnerPercentMaxLeft = this._scaleMultiplier(relativePositionScrollData.offset.inner.percent.maxLeft, aditionalOuterOptimize );

						var elementTopAtHorizontalCenter = containerWidth / 2 - elementWidth / 2;
						// parte visible
						var resultLeft = elementTopAtHorizontalCenter - parallax * ( elementTopAtHorizontalCenter );
						resultLeft *= offsetInnerPercentMinLeft;
						// parte fuera por arriba
						resultLeft += -relativePositionScrollData.offscreen.left * parallax;
						result['left'] 		= resultLeft;

						// parte visible
						var resultRight = containerWidth - elementWidth - elementTopAtHorizontalCenter - parallax * ( containerWidth - elementWidth - elementTopAtHorizontalCenter );
						resultRight *= offsetInnerPercentMaxLeft;
						// parte fuera por abajo
						resultBottom += -relativePositionScrollData.offscreen.right * parallax;
						result['right'] = resultRight;
					}
				}


				if( isFixed ){
					if( hasHorizontalScroll ) {
						var delta = ( containerWidth - elementWidth ) / 2;
						result['right'] -= delta;
						result['left'] -= delta;
					} else {
						result['right']-= fromRight;
						result['left']-= left;
					}
					if( hasVerticalScroll ){
						var delta = ( containerHeight - elementHeight ) / 2;
						result['top'] -= delta;
						result['bottom'] -= delta;
					} else {
						result['top']-= top;
						result['bottom']-= fromBottom;
					}
				}

				return result;
			},

			_update: function( element ){
				if( !this._updating ){
					this._updating = true;
					this._requestsPerSecond++;
					var self = this
						, elements = $( element || this._elements );

					hasVerticalScroll = $(document).height() != $(window).height();
					hasHorizontalScroll = $(document).width() != $(window).width();

					$.each( elements, function( index, element ){
						var $element = $(element);
						self._updateElement( $element );
					});
					this._updating = false;
				}
			},

			browserIsSafari: function(){
				if( this.__browserIsSafari === undefined ){
					this.__browserIsSafari = navigator.userAgent.toLowerCase().indexOf('safari/') !== -1 && navigator.userAgent.toLowerCase().indexOf('chrome/') === -1;
					if( $.getAllQueryStrings().userAgent == 'safari' ){
						this.__browserIsSafari = true;
					}
				}
				return this.__browserIsSafari;
			},

			getBackgroundAttachment: function( element, parallax ) {
				var canHavePositionFixed = $(element).attr('data-parallax-can-have-position-fixed' ) == 'true';
				var canClipFixedElements = window.Modernizr && Modernizr.canclipfixedelements; // dado que en firefox los elementos fixed no son "cropeados" por padres con border radius, u overflow:hidden, es preferible no utilizarlo
				//canHavePositionFixed = $(element).canHavePositionFixed();
				return ( !freeze && canHavePositionFixed && canClipFixedElements && Math.abs( parallax ) < .8 ) ? 'fixed' : 'local';
			},

			getParallaxBackgroundPosition: function( parallax, relativeVerticalMiddle, element, parent, bgPosH, bgPosV, backgroundPositionOffsetX, backgroundPositionOffsetY ){
				backgroundPositionOffsetX = backgroundPositionOffsetX || 0;
				backgroundPositionOffsetY = backgroundPositionOffsetY || 0;

				bgPosH = String( parseFloat( bgPosH ) );
				bgPosV = String( parseFloat( bgPosV ) );

				var backgroundAttachment = this.getBackgroundAttachment( element, parallax );

				var cached = $(element).data('getParallaxBackgroundPositionCached');
				if( !window.useCache || !cached || ( new Date() - cached.cachedTime ) > 1000 ){
					var  parent = parent || window
					//, parentHeight = $( parent || window ).realOuterHeight()
						, parentHeight = $( parent || window ).outerHeight()
						, parallaxBrowserOffset = backgroundAttachment == 'fixed' ? 0 : -1  //this.browserIsSafari()
						, attachmentFixedOffset = parallaxBrowserOffset == 0 ? .5 : 0
						, newBgPosH = bgPosH
					//, elementHeight = $(element).realOuterHeight()
						, elementHeight = $(element).outerHeight()
						, parallax = Number( parallax ) + parallaxBrowserOffset

						, offsetBottom = (parentHeight - elementHeight) * parallax * ( bgPosV - 50 ) / 100
						, parentHeightParallaxed = parentHeight * parallax;
					cached = {
						offsetBottom			: offsetBottom,
						attachmentFixedOffset	: attachmentFixedOffset,
						newBgPosH				: newBgPosH,
						parentHeightParallaxed	: parentHeightParallaxed,
						bgPosH					: bgPosH,
						bgPosV					: bgPosV,
						cachedTime				: new Date()
					};
					$(element).data('getParallaxBackgroundPositionCached', cached);
					//console.debug('calculated');
				}

				var  offsetBottom = cached.offsetBottom
					, attachmentFixedOffset = cached.attachmentFixedOffset
					, parentHeightParallaxed = cached.parentHeightParallaxed
					, bgPosV = cached.bgPosV
					, bgPosH = cached.bgPosH
					, relativeVerticalMiddle = relativeVerticalMiddle - .5
					, offsetParallax = - ( relativeVerticalMiddle * parentHeightParallaxed )
				//, offsetTop =  Math.round( offsetParallax + offsetBottom ) + attachmentFixedOffset - backgroundPositionOffsetY
					, offsetTop =  offsetParallax + offsetBottom + attachmentFixedOffset - backgroundPositionOffsetY
					, offsetLeft = backgroundPositionOffsetX
					, newBgPosV
					, newBgPosH;

				if( !$.string.getNumberValueUnit(bgPosH) ) bgPosH += '%';
				if( !$.string.getNumberValueUnit(bgPosV) ) bgPosV += '%';

				newBgPosH = 'calc(' + bgPosH + ' - ' + offsetLeft +'px)';
				newBgPosV = 'calc(' + bgPosV + ' - ' + offsetTop + 'px)';

				var result = [newBgPosH,  newBgPosV].join(' ');
				//console.debug( result );
				return result;
			},

			collectElements: function() {
				var self = this;
				freeze = $(window).width() < 768; // para tablets y mviles no hay parallax
				this._elements = $('[data-parallax]');
				this._parents = [];
				$.each(this._elements, function (index, element) {
					var $element = $(element)
						, parent = $element.attr('data-parallax-parent')
						, dataParallaxElement = $element.attr('data-parallax-element')
						, $dataParallaxElement = dataParallaxElement == 'parent' ? $element.parent() : $element
						, $parent = $element.closest( parent ).add(window).eq(0)

					$element.data('parallax:element', $dataParallaxElement )
					$element.data('parallax:parent', $element.closest( $element.attr('data-parallax-parent') )[0] );


					if (parent) {
						var $parent = $(parent);
						self._parents.push( $parent );
					}
				});

				/*
				requestAnimationFrame( function(){
					$.each(self._elements, function (index, element) {
						var $element = $(element)
						$element.attr({'data-parallax-can-have-position-fixed': $element.canHavePositionFixed() });
					});
				});
				*/
			}
		}

	});

	//ParallaxHandler.getInstance();

	//////////////////////////
	/*
	var ParallaxElement = ParallaxHandler.extend({
		update: function(){
			var self = this
			if( !this._updating ){
				this._updating = true;
				$.each( this._elements, function( index, element ){
					$element = $(element);
					var parallax = $element.attr('data-parallax-element')
					if( parallax !== undefined && parallax != 1){
						$element.css({
							transform: 'none'
						})
						var outside = $element.isOutsideWindow( window );
						if( outside.top < 2 && outside.bottom < 2){
							parallax = 1-parallax;
							var relativeVerticalMiddle = outside.relativeVerticalMiddle - .5;
							$element.css({
								transform: 'translateY(' + (-relativeVerticalMiddle*parallax*100) + 'vh)'
							})
						}
					}
				});
				this._updating = false;
			}
		}
	});

	 new ParallaxElement();
	 */
})(jQuery);




(function($){
	var hackID = 'scroll-flickering-hack';// + Math.round( Math.random() * 1000000000000 );
	function makeHack(){
		var $hackElement = $('#' + hackID );
		if( !$hackElement.length ){
			$hackElement = $('<div>')
				.attr('id', hackID )
				.css({
					'top'					: '-50px',
					'left'					: 0,
					'position'				: 'fixed',
					'background'			: 'url(/img/px.gif)',
					'backgroundAttachment'	: 'fixed'
				})
				.text('Hack');
			$('body').append($hackElement);
		}
	}

	function removeHack(){
		var $hackElement = $('#' + hackID );
		$hackElement.remove();
	}

	$.fixScrollFlickering = function( val ){
		if( val !== false ) makeHack();
		else {
			removeHack();
		}
	}
})(jQuery);





/////////////////////////////////////////////////////
(function($){
	var StaticPlaceholder = $.Class({
		defaultOptions: {

		},

		prototype: {
			init: function( element, options ){
				this.options = $.extend({}, this.constructor.defaultOptions, options );
				this.$element = $(element);
				this._create();
				this.update();

				if( options.updateOnResize ){
					$(window).on('resize.staticplaceholder', this.update.bind(this));
				}
			},

			destroy: function(){
				//this.$placeholder.before( this.$element );
				this.$placeholder.remove();

				this.$placeholder.removeData('staticplaceholder');
				this.$element.removeData('staticplaceholder');
				this.$element = null;
				this.options = null;
				$(window).off('resize.staticplaceholder');
			},

			_create: function(){
				var $placeholder = $('<span class="staticplaceholder">');
				$placeholder.data('staticplaceholder',this);
				this.$placeholder = $placeholder;
				this.$element.after($placeholder);
				//this.$element.remove();
			},

			update: function(){
				//this.$placeholder.after( this.$element );
				var width = this.$element.realOuterWidth( true );
				var height = this.$element.realOuterHeight( true );
				var display = this.$element.css('display');

				this.$placeholder.css({
					width: width,
					height: height,
					display: display
				});

				//this.$element.remove();
			}

		}
	});

	$.fn.staticplaceholder= function (option) {
		return this.each(function () {
			var $this = $(this)
				, data = $this.data('staticplaceholder')
				, options = typeof option == 'object' && option;
			if (!data && option != 'destroy' ) {
				$this.data('staticplaceholder', (data = new StaticPlaceholder(this, options)));
			}
			if (typeof option == 'string' && data ) data[option]()
		});
	};

})( window.jQuery );


/////////////////////////////////////////////////////
(function($){
	/**
	 * AnimDetector permite detectar cuando un elemento cambia su display, porque se dispara una animacin asociada.
	 */

	var AnimDetector = $.Class({
		defaultOptions: {

		},

		addStyle: function(){
			if( !this.styleAdded ){
				this.styleAdded = true;
				var styleBody = "\
				.typeinanimdetector {\
					-webkit-animation-duration: .1s;\
					animation-duration: .1s;\
					-webkit-animation-fill-mode: both;\
					animation-fill-mode: both;\
				}\
				@-webkit-keyframes typeinanimdetector {\
					0%, 100% {-webkit-transform: translateX(0);}\
				10%, 30%, 50%, 70%, 90% {-webkit-transform: translateX(-10px);}\
				20%, 40%, 60%, 80% {-webkit-transform: translateX(10px);}\
				}\
				@keyframes typeinanimdetector {\
					0%, 100% {transform: translateX(0);}\
				10%, 30%, 50%, 70%, 90% {transform: translateX(-10px);}\
				20%, 40%, 60%, 80% {transform: translateX(10px);}\
				}\
				.typeinanimdetector.go {\
					-webkit-animation-name: typeinanimdetector;\
					animation-name: typeinanimdetector;\
				}";

				var $style = $('<style>');
				$style.html( styleBody );
				$('head').append( $style );
			}
		},

		prototype: {
			init: function( element, options ){
				this.options = $.extend({}, this.constructor.defaultOptions, options );
				this.$element = $(element);
				this._create();
			},

			destroy: function(){
				this.$element.removeClass('typeinanimdetector');
				this.$element = null;
			},

			_create: function(){
				this.constructor.addStyle();
				this.$element.addClass('typeinanimdetector');
			}

		}
	});

	$.fn.animdetector= function (option) {
		return this.each(function () {
			var $this = $(this)
				, data = $this.data('animdetector')
				, options = typeof option == 'object' && option;
			if (!data) $this.data('animdetector', (data = new AnimDetector(this, options)));
			if (typeof option == 'string') data[option]()
		});
	};

})( window.jQuery );


//////////////////////////////////////////////////
/**
 * function decorators
 */
Function.prototype.method = function(name, func) {
	this.prototype[name] = func;
	return this;
};

Function.method('before', function(beforeFunc) {
	var that = this;
	return function() {
		beforeFunc.apply(null, arguments);
		return that.apply(null, arguments);
	};
});

Function.method('after', function(afterFunc) {
	var that = this;
	return function() {
		var result = that.apply(null, arguments);
		afterFunc.apply(null, arguments);
		return result;
	};
});

/////////////////////////////////////////////
(function($){

	function getEventDataName( eventName ){
		return '_' + eventName;
	}

	function createIframeEvent( eventName, condition ){
		function poll( $element ){
			var data = $element.data( getEventDataName( eventName ) );
			var eventData = condition( $element );
			if( eventData ) {
				$element.trigger( eventName, eventData );
			} else {
				data.timeout_id = setTimeout( poll.bind( this, $element ), 250 );
			}
		}

		/////////////////////////////////////

		jQuery.event.special[ eventName ] = {
			setup: function( data, namespaces, eventHandle ) {
				var data = {}
					, $element = $(this)
					, element = $(this)[0];

				$element.data( getEventDataName( eventName ), data );
				if( element.tagName && element.tagName.toLowerCase() == 'iframe' ){
					$element.on('load', function(){
						if( data.timeout_id ) clearTimeout( data.timeout_id );
						poll( $element );
					})
				}
				return false;
				// code
			},
			teardown: function( namespaces ) {
				var data = {}
					, $element = $(this)
					, element = $(this)[0];

				$element.data( getEventDataName( eventName ), data );
				if( element.tagName.toLowerCase() == 'iframe' ) {
					if( data.timeout_id ) clearTimeout( data.timeout_id );
				}
				return false;
			},
			add: function( handleObj ) {
				// code
			},
			remove: function( handleObj ) {
				// code
			},
			_default: function( event ) {
				// code
			}
		};
	}


	createIframeEvent( 'ready', function( $element ){
		return $element.contents();
	});

	createIframeEvent( 'jquery', function( $element ){
		var element = $element[0];
		var hasJquery = element && element.contentWindow && element.contentWindow.jQuery;
		return hasJquery ? element.contentWindow : false;
	});

})(jQuery);


(function($){
	$.createErrorType = function(name, init) {
		function E(message) {
			if (!Error.captureStackTrace)
				this.stack = (new Error()).stack;
			else
				Error.captureStackTrace(this, this.constructor);
			this.message = message;
			init && init.apply(this, arguments);
		}
		E.prototype = new Error();
		E.prototype.name = name;
		E.prototype.constructor = E;
		return E;
	}

	NameError = $.createErrorType('NameError', function (name, invalidChar) {
		this.message = 'The name ' + name + ' may not contain ' + invalidChar;
	});

	UnboundError = $.createErrorType('UnboundError', function (variableName) {
		this.message = 'Variable ' + variableName + ' is not bound';
	});

	ParamError = $.createErrorType('ParamError', function ( paramName ) {
		this.message = 'Param ' + paramName + ' is not valid';
	});


})(jQuery);


(function($){
	$.Filesize = $.Class({
		init: function( value ){
			this._value = value;
		},

		toString: function(){
			var result = '';
			if( this._value ){
				var k = 1024;
				var mega = k * 1024;
				var giga = mega * 1024;
				var tera = giga * 1024;
				if( this._value < k) {
					result = this._value + ' bytes'
				} else if( this._value < mega ) {
					result = Math.ceil(this._value / k) + ' KB';
				} else if( this._value < giga ) {
					result = Math.ceil(this._value / mega) + ' MB';
				} else if( this._value < tera ) {
					result = Math.ceil(this._value / giga) + ' GB';
				} else {
					result = Math.ceil(this._value / tera) + ' TB';
				}
			}
			return result;
		}
	})
})(jQuery);

(function($){
	function storageAvailable(type) {
		try {
			var storage = window[type],
				x = '__storage_test__';
			storage.setItem(x, x);
			storage.removeItem(x);
			return true;
		}
		catch(e) {
			return false;
		}
	}

	$.localStorage = {
		isAvailable : function(){
			return storageAvailable('localStorage');
		},

		setItem: function(key, value){
			return localStorage.setItem( key, value );
		},

		getItem: function( key ){
			return localStorage.getItem( key );
		},

		removeItem: function( key ){
			return localStorage.removeItem( key );
		},

		clear: function(){
			return localStorage.clear();
		}
	}
})(jQuery);


(function($){
	function intersection(){
		var self = this;
		var result = {};
		var args = $.makeArray( arguments );
		var first = args.shift();
		var others = args;
		$.each( first, function( key, value ){
			var intersectedValue;
			var found = false;
			if( $.isPlainObject( value ) ){
				var newArgs = [first[key]].concat( ko.utils.arrayMap(others, function(other, index){
					return other && other[key]
				}));
				intersectedValue = intersection.apply(this, newArgs );
			} else {
				if( $.all( others, function( index, other ){
					return other && other[key] === value;
				})){
					found = true;
					intersectedValue = value;
				}
			}
			if( found || !$.isEmptyObject(intersectedValue)){
				result[key] = intersectedValue;
			}
		});
		return result;
	}

	function includes( a, b ){
		var c = intersection( a, b );
		return JSON.stringify( sortKeys( b ) ) == JSON.stringify( sortKeys( c ) );
	}

	function sortKeys( object){
		if( $.isPlainObject(object)){
			var result = {};
			var keys = $.getObjectKeys( object ).sort();
			$.each( keys, function( index, key ){
				var value = object[key];
				if( $.isPlainObject( value ) ){
					value = sortKeys( value );
				}
				result[key] = value;
			})
			return result;
		} else return object;
	}

	$.extend($.namespace('$.JSON'), {
		'intersection'	: intersection,	// devuelve la interseccin de dos objetos
		'includes'		: includes, 	// indica si un objeto incluye al otro
		'sortKeys'		: sortKeys		// devuelve un objeto con las claves ordenadas alfabticamente
	});
})(jQuery);


/* /js/libs/jquery.areamask.js
 * compresion time: 0.02384 -(ms)
 * --------------------------- */
;(function( $ ){
	AreaMask = $.Class({
		init: function( options ){
			
			zIndex = ( ( options && options.zIndex ) || 0 ) + 500;
			
			this.options = $.extend({
				overlayCss	: {opacity: .8, backgroundColor: '#000', position: 'fixed', zIndex: zIndex},
				highlightedCss	: {opacity: 1, boxShadow: '#000 0px 0px 20px 5px', position: 'fixed', zIndex: zIndex},
				highlight: true
			}, options);
			
			this._id = Math.round( Math.random() * 9999999 );

			this.left = this.options.left || 0;
			this.bottom = this.options.bottom || 0;
			this.top = this.options.top || 0;
			this.right = this.options.right || 0;
			
			this.offsetTop = 0;
			this.offsetLeft = 0;
			
			this._create();						
			this.update();
			
			$( window ).on('scroll.areamask.' + this._id, this._reposition.bind( this ));
			this._reposition();
			
			this.toggleHighlight( this.options.highlight );
		},

		destroy: function(){
			//this._$container.remove();
			$( window ).off('scroll.areamask.' + this._id);
			this.options = null;
			
			this._$topBox.remove();
			this._$bottomBox.remove();
			this._$leftBox.remove();
			this._$rightBox.remove();
			this._$highlighted.remove();
			
			delete this._$topBox;
			delete this._$bottomBox;
			delete this._$leftBox;
			delete this._$rightBox;
			delete this._$highlighted;
		},
		
		toggleHighlight: function( ){
			this._$highlighted.toggle.apply( this._$highlighted, arguments );
		},
				
		_reposition: function(event){
			var scrollTop = $(window).scrollTop()
			, scrollLeft = $(window).scrollLeft();
			
			this.offsetTop = scrollTop;
			this.offsetLeft = scrollLeft;
			
			//console.debug('reposition', this.offsetTop, this.offsetLeft);
			
			/*
			this._$container.css({'marginTop'	: -this.offsetTop });
			this._$container.css({'marginLeft'	: -this.offsetLeft });
			*/
		   this.update();
		},

		_create: function(){
			this._$topBox = $('<div>').addClass('areamask-top').css( this.options.overlayCss );
			this._$bottomBox = $('<div>').addClass('areamask-bottom').css( this.options.overlayCss );
			this._$leftBox = $('<div>').addClass('areamask-left').css( this.options.overlayCss );
			this._$rightBox = $('<div>').addClass('areamask-right').css( this.options.overlayCss );
			this._$highlighted = $('<div>').addClass('areamask-highlighted').css( this.options.highlightedCss );

			//this._$container = $('<div>').addClass('areamask-container').css({position: 'fixed', top: 0, left: 0, bottom: 0, right: 0});

			$('body')
				.append( this._$topBox )
				.append( this._$bottomBox )
				.append( this._$leftBox )
				.append( this._$rightBox )
				.append( this._$highlighted );							

			//$('body').append(this._$container);			
		},
		
		update: function( coords ){
			if( coords ) {
				if( coords.top ) this.top = coords.top;
				if( coords.bottom ) this.bottom = coords.bottom;
				if( coords.left ) this.left = coords.left;
				if( coords.right ) this.right = coords.right;
			};


			this._$topBox.css({top: 0, height: ( this.top - this.offsetTop) + 'px', left: 0, right: 0 });
			this._$bottomBox.css({top: this.bottom - this.offsetTop, bottom: 0, left: 0, right: 0 });
			this._$leftBox.css({top: this.top - this.offsetTop, height: ( this.bottom - this.top ) + 'px', left: 0, width: (this.left - this.offsetLeft) + 'px'});
			this._$rightBox.css({top: this.top - this.offsetTop, height: ( this.bottom - this.top) + 'px', left: this.right - this.offsetLeft, right: 0 });
			
			this._$highlighted.css({top: this.top - this.offsetTop, height: ( this.bottom - this.top) + 'px', left: this.left - this.offsetLeft, width: (this.right - this.left) + 'px' });
		},
		
		show: function(){
			this._$topBox.show();
			this._$bottomBox.show();
			this._$leftBox.show();
			this._$rightBox.show();
			if ( this.options.highlight ) this._$highlighted.show();
		},
		
		hide: function(){
			this._$topBox.hide();
			this._$bottomBox.hide();
			this._$leftBox.hide();
			this._$rightBox.hide();
			if( this.options.highlight ) this._$highlighted.hide();
		},
		
		
		/*
		_create: function(){
			this._$topBox = $('<div>').addClass('areamask-top').css( this.options.overlayCss );
			this._$bottomBox = $('<div>').addClass('areamask-bottom').css( this.options.overlayCss );
			this._$leftBox = $('<div>').addClass('areamask-left').css( this.options.overlayCss );
			this._$rightBox = $('<div>').addClass('areamask-right').css( this.options.overlayCss );
			this._$highlighted = $('<div>').addClass('areamask-highlighted').css( this.options.highlightedCss );

			this._$container = $('<div>').addClass('areamask-container').css({position: 'fixed', top: 0, left: 0, bottom: 0, right: 0});

			this._$container
				.append( this._$topBox )
				.append( this._$bottomBox )
				.append( this._$leftBox )
				.append( this._$rightBox )
				.append( this._$highlighted );							

			$('body').append(this._$container);
		},

		update: function( coords ){
			if( coords ) {
				if( coords.top ) this.top = coords.top;
				if( coords.bottom ) this.bottom = coords.bottom;
				if( coords.left ) this.left = coords.left;
				if( coords.right ) this.right = coords.right;
			};

			this._$topBox.css({top: 0, height: ( this.top ) + 'px', left: 0, right: 0 });
			this._$bottomBox.css({top: this.bottom, bottom: 0, left: 0, right: 0 });
			this._$leftBox.css({top: this.top, height: ( this.bottom - this.top ) + 'px', left: 0, width: this.left + 'px'});
			this._$rightBox.css({top: this.top, height: ( this.bottom - this.top) + 'px', left: this.right, right: 0 });
			
			this._$highlighted.css({top: this.top, height: ( this.bottom - this.top) + 'px', left: this.left, width: (this.right - this.left) + 'px' });
		}
		*/
	});


	AreaMaskedElement = AreaMask.extend({
		init: function( element, options ){
			var self = this;

			this.element = $(element)[0];

			this._parent( $.extend({
				autoUpdate	: true,
				interval	: 100,
				zIndex		: $(this.element).zIndex()
			}, options));


			if( this.options.autoUpdate ){
				this._autoUpdateInterval = setInterval( function(){
					self.update();
				}, this.options.interval) ;
			}

		},

		destroy: function(){
			clearInterval( this._autoUpdateInterval );
			this._parent();
			$(this.element).removeData('areamask');
		},

		_calculateCoords: function(){
			var $element = $(this.element),
				offset = $element.offset();

			this.top = offset.top;
			this.left = offset.left;
			this.right = this.left + $element.outerWidth();
			this.bottom = this.top + $element.outerHeight();
		},

		update: function( coords ){
			if(!coords ) this._calculateCoords();
			this._parent.apply( this, coords );
			if( $(this.element).closest('body').length ==0 ){
				this.hide();
			} else {
				this.show();
			}
		}

	});


	$.fn.areamask = function( options, moreOptions ){
		$( this ).each(function(){
			var element = $( this ),
				areamask = $( element ).data('areamask');

			if( typeof options == 'string' ){
				if( areamask ){							
					areamask[ options ].apply( areamask, moreOptions );
				} else {
					throw( 'el elemento no tiene definido un areamask ');
				}
			} else {						
				if( !areamask ){
					$( element ).data('areamask', new AreaMaskedElement( this, options ));
				}
			}
		});
	};
	
})( jQuery );


/* /js/libs/jquery.onscreen.js
 * compresion time: 0.02313 -(ms)
 * --------------------------- */
(function($) {
	var selectors = [];

	var check_binded = false;
	var check_lock = false;
	var defaults = {
		interval: 250,
		force_process: false
	};

	var $window = $(window);
	var uid = 'appear_' + $.math.randomInt(0,999999999);

	var $prior_appeared = [];

	function process() {
		check_lock = false;
		//console.debug('processing', selectors, $prior_appeared);
		for (var index = 0, selectorsLength = selectors.length; index < selectorsLength; index++) {
			var selector = selectors[index]
				, isjQuery = selector instanceof jQuery
				, hashKey = selector;

			if(isjQuery){
				hashKey = selector.data('__onscreen:id');
			}


			//console.debug('hashKey', hashKey );
			//console.debug('prior_appeared', $prior_appeared[hashKey ], isjQuery);


			var $appeared = $(selector).filter(function() {
				return $(this).is(':onscreen');
			});

			if ($prior_appeared[hashKey]) {
				var $disappeared = $prior_appeared[hashKey].not($appeared);
				if( $disappeared.length > 0 ){
					$disappeared.trigger('leavescreen', [$disappeared]);
					//console.debug('leavescreen', $disappeared);
				}
			}
			var $newAppeared = $appeared.not($prior_appeared[hashKey]);
			if( $newAppeared.length > 0 ){
				$newAppeared.trigger('enterscreen', [$newAppeared]);
				//console.debug('enterscreen', $disappeared);
			}

			$prior_appeared[hashKey] = $appeared;
		}
	};

	function add_selector(selector) {
		//console.debug('add_selector', selector);
		selectors.push(selector);
		/*
		if( !$prior_appeared[hashKey] ){
			selectors.push(selector);
		}*/
		//process();
	}

	function remove_selector(selector){
		var isjQuery = selector instanceof jQuery
			, hashKey = selector;

		if(isjQuery){
			hashKey = selector.data('__onscreen:id');
		}

		ko.utils.arrayRemoveItem( selectors, selector );
		delete $prior_appeared[hashKey];
	}

	// "appeared" custom filter
	$.expr[':']['onscreen'] = function(element) {
		var $element = $(element);
		/*if (!$element.is(':visible')) {
		 return false;
		 }*/
		var outside = $element.isOutsideWindow( window );
		return (outside.top < 2 && outside.bottom < 2);
	};

	$.fn.extend({
		// watching for element's appearance in browser viewport
		_appear: function(options) {
			var selector = this.selector
				, onscreenID = this.data('__onscreen:id')
			if( !selector ){
				if( !onscreenID ){
					onscreenID = $.math.randomInt(1,9999999999);
				}
				this.data('__onscreen:id', onscreenID );
				selector = this;
			}


			if( options == 'destroy'){
				remove_selector( selector );
				if( selectors.length == 0){
					check_binded = false;
					$(window).off('scroll.' + uid);
				}
			} else {
				var opts = $.extend({}, defaults, options || {});
				if (!check_binded) {
					var on_check = function() {
						if (check_lock) {
							return;
						}
						check_lock = true;

						setTimeout(process, opts.interval);
					};

					//$(window).scroll(on_check).resize(on_check);
					$(window).on('scroll.' + uid, on_check);
					check_binded = true;
				}

				if (opts.force_process) {
					setTimeout(process, opts.interval);
				}
				add_selector(selector);
			}
			return $(selector);

		}
	});

	$.extend({
		// force elements's appearance check
		force_appear: function() {
			if (check_binded) {
				process();
				return true;
			}
			return false;
		}
	});


	function isAppearEventName( eventName ){
		return /^enterscreen\.?/.test( eventName );
	}

	function isDisappearEventName( eventName ){
		return /^leavescreen\.?/.test( eventName );
	}

	function isSpecialEventName( eventName ){
		return isAppearEventName( eventName ) || isDisappearEventName( eventName );
	}

	function getSpecialEventName( eventName ){
		var result = null;
		if( isAppearEventName( eventName ) ){
			return 'enterscreen';
		}else if( isDisappearEventName( eventName ) ){
			return 'leavescreen';
		}
		return result;
	}


	function replaceFn( fnName ){
		var _oldFn = $.fn[fnName];
		$.fn[fnName] = function( eventName ){
			var specialEventName = getSpecialEventName( eventName );
			if( specialEventName ){
				var totalCount = ( this.data(uid + '_count' ) || 0 ) + 1;
				var count = ( this.data(uid + '_' + specialEventName + '_count' ) || 0 ) + 1;
				if( totalCount == 1 ){
					this._appear({force_process: true});
				}
				this.data(uid + '_count', totalCount);
				this.data(uid + '_' + specialEventName + '_count', count );
			}
			return _oldFn.apply( this, arguments );
		}
	}

	replaceFn('on');
	replaceFn('one');

	var _oldOffFn = $.fn.off;
	$.fn.off = function( eventName ){
		var specialEventName = getSpecialEventName( eventName );
		if( specialEventName ){
			var totalCount = (this.data(uid + '_count' ) || 0) - 1;
			var count = ( this.data(uid + '_' + specialEventName + '_count' ) || 0 ) - 1;
			if( totalCount >= 0 ){
				if( totalCount == 0 ) this._appear('destroy');
				this.data(uid + '_count', totalCount);
				this.data(uid + '_' + specialEventName + '_count', count);
			}
		}
		return _oldOffFn.apply( this, arguments );
	};


})(function() {
	if (typeof module !== 'undefined') {
		// Node
		return require('jquery');
	} else {
		return jQuery;
	}
}());


/* /js/libs/easyzoom/src/easyzoom.js
 * compresion time: 0.02599 -(ms)
 * --------------------------------- */
(function ($) {

    'use strict';

    var dw, dh, rw, rh, lx, ly;
	var startTime, endTime, timerSmooth;

    var defaults = {

        // The text to display within the notice box while loading the zoom image.
        loadingNotice: 'Loading image',

        // The text to display within the notice box if an error occurs when loading the zoom image.
        errorNotice: 'The image could not be loaded',

        // The time (in milliseconds) to display the error notice.
        errorDuration: 2500,

        // Attribute to retrieve the zoom image URL from.
        linkAttribute: 'href',

        // Prevent clicks on the zoom image link.
        preventClicks: true,

        // Callback function to execute before the flyout is displayed.
        beforeShow: $.noop,

        // Callback function to execute before the flyout is removed.
        beforeHide: $.noop,

        // Callback function to execute when the flyout is displayed.
        onShow: $.noop,

        // Callback function to execute when the flyout is removed.
        onHide: $.noop,

        // Callback function to execute when the cursor is moved while over the image.
        onMove: $.noop

    };

    /**
     * EasyZoom
     * @constructor
     * @param {Object} target
     * @param {Object} options (Optional)
     */
    function EasyZoom(target, options) {
        this.$target = $(target);
        this.opts = $.extend({}, defaults, options, this.$target.data());

        this.isOpen === undefined && this._init();
    }

    /**
     * Init
     * @private
     */
    EasyZoom.prototype._init = function() {
        var self = this;

        this.$link   = this.$target.find('a');
        this.$image  = this.$target.find('img');

        this.$flyout = $('<div class="easyzoom-flyout" />');
        this.$notice = $('<div class="easyzoom-notice" />');

        this.$target.on({
            'mousemove.easyzoom touchmove.easyzoom': $.proxy(this._onMove, this),
            'mouseleave.easyzoom touchend.easyzoom': $.proxy(this._onLeave, this),
            'mouseenter.easyzoom touchstart.easyzoom': $.proxy(this._onEnter, this)
        });

        this.opts.preventClicks && this.$target.on('click.easyzoom', function(e) {
            e.preventDefault();
        });

        this.$flyout.on('click.easyzoom', function(e) {
            self.$link.trigger('click');
        });
    };

    /**
     * Show
     * @param {MouseEvent|TouchEvent} e
     * @param {Boolean} testMouseOver (Optional)
     */
    EasyZoom.prototype.show = function(e, testMouseOver) {
        var self = this;
	    var w1, h1, w2, h2;
	    var touches = e && e.originalEvent && e.originalEvent.touches;

        if (this.opts.beforeShow.call(this) === false) return;

        if (!this.isReady) {
            return this._loadImage(this.$link.attr(this.opts.linkAttribute), function() {
                if (self.isMouseOver || !testMouseOver) {
                    self.show(e);
                }
            });
        }

        this.$target.append(this.$flyout);

        if( isNumeric(this.opts.fade) ){
            self.$flyout.stop(true, true, false).fadeIn(this.opts.fade);
        } else {
            self.$flyout.css({display: 'block'});
        }

        w1 = this.$target.width();
        h1 = this.$target.height();

        w2 = this.$flyout.width();
        h2 = this.$flyout.height();

        dw = this.$zoom.width() - w2;
        dh = this.$zoom.height() - h2;

        // For the case where the zoom image is actually smaller than
        // the flyout.
        if (dw < 0) dw = 0;
        if (dh < 0) dh = 0;

        rw = dw / w1;
        rh = dh / h1;

        this.isOpen = true;

        this.opts.onShow.call(this, e);

	    if( touches && touches.length == 1 ) {
		    startTime = e.timeStamp;
	    }

        e && this._move(e);
    };

    /**
     * On enter
     * @private
     * @param {Event} e
     */
    EasyZoom.prototype._onEnter = function(e) {
        var touches = e.originalEvent.touches;

        this.isMouseOver = true;

        if (!touches || touches.length == 1) {
            e.preventDefault();
            this.show(e, true);
        }
    };

    /**
     * On move
     * @private
     * @param {Event} e
     */
    EasyZoom.prototype._onMove = function(e) {
        if (!this.isOpen) return;

        e.preventDefault();
        this._move(e);
    };

    /**
     * On leave
     * @private
     */
    EasyZoom.prototype._onLeave = function(e) {
        this.isMouseOver = false;
        this.isOpen && this.hide(e);
    };

    /**
     * On load
     * @private
     * @param {Event} e
     */
    EasyZoom.prototype._onLoad = function(e) {
        // IE may fire a load event even on error so test the image dimensions
        if (!this.$flyout || !e.currentTarget.width) return;

        this.isReady = true;

        this.$notice.detach();
        this.$flyout.html(this.$zoom);
        this.$target.removeClass('is-loading').addClass('is-ready');

        e.data.call && e.data();
    };

    /**
     * On error
     * @private
     */
    EasyZoom.prototype._onError = function() {
        var self = this;

        this.$notice.text(this.opts.errorNotice);
        this.$target.removeClass('is-loading').addClass('is-error');

        this.detachNotice = setTimeout(function() {
            self.$notice.detach();
            self.detachNotice = null;
        }, this.opts.errorDuration);
    };

    /**
     * Load image
     * @private
     * @param {String} href
     * @param {Function} callback
     */
    EasyZoom.prototype._loadImage = function(href, callback) {
        var zoom = new Image;

        this.$target
            .addClass('is-loading')
            .append(this.$notice.html(this.opts.loadingNotice));

        this.$zoom = $(zoom)
            .on('error', $.proxy(this._onError, this))
            .on('load', callback, $.proxy(this._onLoad, this));

        zoom.style.position = 'absolute';
        zoom.src = href;
    };

    /**
     * Move
     * @private
     * @param {Event} e
     */
    EasyZoom.prototype._move = function(e) {
		var self = this;

        if (e.type.indexOf('touch') === 0) {
            var touchlist = e.touches || e.originalEvent.touches;
            lx = touchlist[0].pageX;
            ly = touchlist[0].pageY;
        } else {
            lx = e.pageX || lx;
            ly = e.pageY || ly;
        }

        var offset  = this.$target.offset();
        var pt = ly - offset.top;
        var pl = lx - offset.left;
        var xt = Math.ceil(pt * rh);
        var xl = Math.ceil(pl * rw);

        // Close if outside
        if (xl < 0 || xt < 0 || xl > dw || xt > dh) {
            this.hide();
        } else {

	        var top = xt * -1;
	        var left = xl * -1;

	        self.$zoom.css({
		        top: top,
		        left: left
	        });

            this.opts.onMove.call(this, top, left);
        }

    };

    /**
     * Hide
     */
    EasyZoom.prototype.hide = function(e) {
        var self = this;
	    var touches = e && e.originalEvent && e.originalEvent.touches;

        if (!this.isOpen) return;
        if (this.opts.beforeHide.call(this) === false) return;

        if( isNumeric(this.opts.fade) ){
            this.$flyout.stop(true, true).fadeOut(this.opts.fade, function(){
                self.$flyout && self.$flyout.detach();
            });
        } else {
            self.$flyout.detach();
        }

	    if( touches ) {
		    endTime = e.timeStamp;
		    var time = endTime - startTime;
		    if( time < 200 ) this.$link.trigger('click');
	    }

        this.isOpen = false;

	    clearInterval(timerSmooth);

	    this.opts.onHide.call(this, e);
    };

    /**
     * Swap
     * @param {String} standardSrc
     * @param {String} zoomHref
     * @param {String|Array} srcset (Optional)
     */
    EasyZoom.prototype.swap = function(standardSrc, zoomHref, srcset) {
        this.hide();
        this.isReady = false;

        this.detachNotice && clearTimeout(this.detachNotice);

        this.$notice.parent().length && this.$notice.detach();

        this.$target.removeClass('is-loading is-ready is-error');

        this.$image.attr({
            src: standardSrc,
            srcset: $.isArray(srcset) ? srcset.join() : srcset
        });

        this.$link.attr(this.opts.linkAttribute, zoomHref);
    };

    /**
     * Teardown
     */
    EasyZoom.prototype.teardown = function() {
        this.hide();

        this.$target
            .off('.easyzoom')
            .removeClass('is-loading is-ready is-error');

        this.detachNotice && clearTimeout(this.detachNotice);

        delete this.$link;
        delete this.$zoom;
        delete this.$image;
        delete this.$notice;
        delete this.$flyout;

        delete this.isOpen;
        delete this.isReady;

    };

    // jQuery plugin wrapper
    $.fn.easyZoom = function(options) {
        return this.each(function() {
            var api = $.data(this, 'easyZoom');

            if (!api) {
                $.data(this, 'easyZoom', new EasyZoom(this, options));
            } else if (api.isOpen === undefined) {
                api._init();
            }
        });
    };

    // AMD and CommonJS module compatibility
    if (typeof define === 'function' && define.amd){
        define(function() {
            return EasyZoom;
        });
    } else if (typeof module !== 'undefined' && module.exports) {
        module.exports = EasyZoom;
    }

})(jQuery);


/* /js/libs/knockout.extensions.js
 * compresion time: 0.05794 -(ms)
 * ------------------------------- */
// JavaScript Document


////////////////////////////////////////////////////////////////////////////////
ko.utils._____UID = Math.round( Math.random()*999999 );
ko.utils.createUID = function(){
	return 'koUID_'  + ( ++ ko.utils._____UID );
};

ko.unwrap = ko.utils.unwrapObservable;

ko.peek = function( what ){
	var result = what;
	if( ko.isObservable( what ) ){
		result = what.peek();
	}
	return result;
}


/**
 * https://github.com/SteveSanderson/knockout/wiki/Asynchronous-Dependent-Observables
 * @param evaluator
 * @param owner
 * @return {*}
 */

function asyncDependentObservable(evaluator, owner, options) {
	var result = ko.observable()
		,currentDeferred;

	result.inProgress = ko.observable(false); // Track whether we're waiting for a result
	result.error = ko.observable(); // Track whether we're waiting for a result

	var co = ko.computed(function() {
		// Abort any in-flight evaluation to ensure we only notify with the latest value
		if (currentDeferred) { currentDeferred.reject(); }

		var evaluatorResult = evaluator.call(owner);
		// Cope with both asynchronous and synchronous values
		if (evaluatorResult && (typeof evaluatorResult.done == "function")) { // Async
			result.inProgress(true);
			result.error( null );
			currentDeferred = $.Deferred()
				.always( function(){
					result.inProgress(false);
				})
				.done(function(data) {
					result(data);
				})
				.fail( function( jqXHR, textStatus, errorThrown ){
					//result(undefined);
					var error;
					if( jqXHR && jqXHR.promise ) error = textStatus;
					else error = ( jqXHR && jqXHR.error ) || jqXHR;
					result.error( error );
				});
			evaluatorResult
				.done( currentDeferred.resolve )
				.fail( currentDeferred.reject );
		} else // Sync
			result(evaluatorResult);
	}, owner, options );


	var _dispose = co.dispose;
	co.dispose = function(){
		if (currentDeferred) { currentDeferred.reject(); }
		_dispose.apply( this, arguments );
	}

	return result;
}


ko.asyncComputed = function( evaluator, owner, options ){
	var currentDeferred;
	var result = ko.observable();
	var options = $.extend({}, options);
	var evaluatorResult;

	result.inProgress = ko.observable( false );
	result.error = ko.observable();

	function abort(){
		result.error(null);
		result.inProgress( false );
		$.each( [currentDeferred, evaluatorResult ], function( index, deferred ){
			if( deferred ){
				if( typeof deferred.abort == 'function' ){
					deferred.abort();
				} else if( typeof deferred.reject == 'function') {
					deferred.reject();
				}
			}
		});
	}

	var computed = ko.computed( function(){

		if( typeof options.disposeWhen == 'function' ){
			if( options.disposeWhen() ){
				result.dispose();
				return;
			}
		}

		abort();
		evaluatorResult = evaluator.call( owner );
		if( typeof evaluatorResult.done == 'function' ){
			result.inProgress( true );
			currentDeferred = $.Deferred();
			currentDeferred
				.always( function(){
					result.inProgress( false );
				})
				.done( function( value ){
					result( value );
				})
				.fail( function( jqXHR, textStatus, errorThrown ){
					var error;
					if( jqXHR && jqXHR.promise ) {
						error = textStatus;
					}
					else {
						error = ( jqXHR && jqXHR.error ) || jqXHR;
					}
					result.error( error );
				});
			evaluatorResult
				.done( currentDeferred.resolve )
				.fail( currentDeferred.reject )
		} else {
			result( evaluatorResult );
		}
	});

	if( options.disposeWhenNodeIsRemoved ){
		//console.debug('options.diposeWhenNodeIsRemoved')
		ko.utils.domNodeDisposal.addDisposeCallback(options.disposeWhenNodeIsRemoved, function() {
			result.dispose();
		});
	}

	result.dispose = function(){
		computed.dispose();
		abort();
	}


	return result;
}


ko.observableDeferred = ko.asyncComputed;


// REPEAT binding for Knockout http://knockoutjs.com/
// (c) Michael Best
// License: MIT (http://www.opensource.org/licenses/mit-license.php)
// Version 1.2.0

(function() {
	if (!ko.bindingFlags) { ko.bindingFlags = {}; }

	function findPropertyName(obj, equals) {
		for (var a in obj)
			if (obj.hasOwnProperty(a) && obj[a] === equals)
				return a;
	}

	var koProtoName = findPropertyName(ko.observable.fn, ko.observable);

	ko.bindingHandlers['repeat'] = {
		'flags': ko.bindingFlags.contentBind,
		'init': function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			// initialize optional parameters
			var repeatIndex = '$index', repeatData = '$item', repeatBind;
			var repeatParam = ko.utils.unwrapObservable(valueAccessor());
			if (typeof repeatParam == 'object') {
				if ('index' in repeatParam) repeatIndex = repeatParam['index'];
				if ('item' in repeatParam) repeatData = repeatParam['item'];
				if ('bind' in repeatParam) repeatBind = repeatParam['bind'];
			}

			// First clean the element node and remove node's binding
			ko.cleanNode(element);
			element.removeAttribute('data-bind');

			// extract and remove a data-repeat-bind attribute, if present
			if (!repeatBind) {
				repeatBind = element.getAttribute('data-repeat-bind');
				if (repeatBind)
					element.removeAttribute('data-repeat-bind');
			}

			// Make a copy of the element node to be copied for each repetition
			var cleanNode = element.cloneNode(true);
			if (typeof repeatBind == "string") {
				cleanNode.setAttribute('data-bind', repeatBind);
				repeatBind = null;
			}

			// Original element is no longer needed: delete it and create a placeholder comment
			var parent = element.parentNode, placeholder = document.createComment('ko_repeatplaceholder');
			parent.replaceChild(placeholder, element);

			// set up persistent data
			var lastRepeatCount = 0,
				notificationObservable = ko.observable(),
				repeatArray;

			var subscribable = ko.dependentObservable(function() {
				function makeArrayItemAccessor(index) {
					var f = function() {
						var item = repeatArray[index];
						if (!arguments.length) {
							notificationObservable();   // for dependency tracking
							return ko.utils.unwrapObservable(item);
						} else if (ko.isObservable(item)) {
							return item(arguments[0]);
						}
					};
					// Pretend that our accessor function is an observable
					f[koProtoName] = ko.observable;
					return f;
				}

				function makeBinding(item, index, context) {
					return repeatArray
						? function() { return repeatBind.call(viewModel, item, index, context); }
						: function() { return repeatBind.call(viewModel, index, context); }
				}

				var repeatCount = ko.utils.unwrapObservable(valueAccessor());
				if (typeof repeatCount == 'object') {
					if ('count' in repeatCount) {
						repeatCount = ko.utils.unwrapObservable(repeatCount['count']);
					} else if ('foreach' in repeatCount) {
						repeatArray = ko.utils.unwrapObservable(repeatCount['foreach']);
					} else if ('length' in repeatCount) {
						repeatArray = repeatCount;
					}
					if (repeatArray)
						repeatCount = repeatArray['length'] || 0;
				}
				// Remove nodes from end if array is shorter
				for (; lastRepeatCount > repeatCount; lastRepeatCount--) {
					ko.removeNode(placeholder.previousSibling);
				}

				// Notify existing nodes of change
				notificationObservable["notifySubscribers"]();

				// Add nodes to end if array is longer (also initially populates nodes)
				for (; lastRepeatCount < repeatCount; lastRepeatCount++) {
					// Clone node and add to document
					var newNode = cleanNode.cloneNode(true);
					parent.insertBefore(newNode, placeholder);
					newNode.setAttribute('data-repeat-index', lastRepeatCount);

					// Apply bindings to inserted node
					var newContext = ko.utils.extend(new bindingContext.constructor(), bindingContext);
					newContext[repeatIndex] = lastRepeatCount;
					if (repeatArray)
						newContext[repeatData] = makeArrayItemAccessor(lastRepeatCount);
					if (repeatBind)
						var shouldBindDescendants = ko.applyBindingsToNode(newNode, makeBinding(newContext[repeatData], lastRepeatCount, newContext), newContext).shouldBindDescendants;
					if (!repeatBind || shouldBindDescendants)
						ko.applyBindings(newContext, newNode);
				}
			}, null, {'disposeWhenNodeIsRemoved': placeholder});

			return { 'controlsDescendantBindings': true, 'subscribable': subscribable };
		}
	};
})();


/*
 SWITCH/CASE binding for Knockout http://knockoutjs.com/
 (c) Michael Best
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 2.1.0
*/
(function(b,k){"function"===typeof define&&define.amd?define(["knockout"],k):k(b.ko)})(this,function(b){function k(a,f){var c=m(f.$switchValueAccessor());return"boolean"==typeof c?a?c:!c:"boolean"==typeof a?a:a instanceof Array?-1!==b.utils.arrayIndexOf(a,c):a==c}function v(a,b){return!k(a,b)}function w(a){return function(){return a}}function h(a,f,c){var n=f?v:k;a||(a="if");c||(c=w);return{flags:d[a].flags,init:function(f,g,l,x,e){if(!e.$switchSkipNextArray)throw Error("case binding must only be used with a switch binding");
if(e.$switchIndex!==p)throw Error("case binding cannot be nested");e.$switchIndex=e.$switchSkipNextArray.push(b.observable(!1))-1;e.$caseValue=b.observable();b.computed(function(){var a=e.$switchIndex,b=a===e.$switchSkipNextArray.length-1,c,f,d;a&&e.$switchSkipNextArray[a-1]()?(c=!1,f=!0):(c=m(g()),c===e.$else?(c=e.$switchDefault()||b,f=!1):d=f=c=n(c,e));e.$caseValue(c);e.$switchSkipNextArray[a](f);d?e.$switchDefault(!1):!f&&b&&e.$switchDefault(!0)},null,{disposeWhenNodeIsRemoved:f});if(d[a].init)return d[a].init(f,
c(e.$caseValue),l,x,e)},update:function(b,f,g,n,e){if(d[a].update)return d[a].update(b,c(e.$caseValue),g,n,e)}}}function r(a,b,c){g.allowedBindings[a]&&(g.allowedBindings[c]=!0);return h(a,"casenot"===b)}function y(a,b,c){return r(b,a,c)}function s(a,b){d[a]=h("if",b);t[a]=!1;g.allowedBindings[a]=!0;d[a].makeSubkeyHandler=y;d[a].getNamespacedHandler=r}var p;if(!b.virtualElements)throw Error("Switch-case requires at least Knockout 2.1");var g=b.virtualElements,q=b.bindingFlags||{},t=b.bindingRewriteValidators||
b.jsonExpressionRewriting.bindingRewriteValidators,m=b.utils.unwrapObservable,d=b.bindingHandlers,u={};d["switch"]={flags:q.contentBind|q.canUseVirtual|q.noValue,init:function(a,f,c,d,k){var h={$switchSkipNextArray:[],$switchValueAccessor:f,$switchDefault:b.observable(!0),$default:u,$else:u},l=[];b.computed(function(){var a=m(f());h.$value=a;b.utils.arrayForEach(l,function(b){b.$value=a})},null,{disposeWhenNodeIsRemoved:a});for(c=g.firstChild(a);a=c;)switch(c=g.nextSibling(a),a.nodeType){case 1:case 8:d=
k.extend(h),d.$switchIndex=p,b.applyBindings(d,a),d.$switchIndex!==p&&l.push(d)}return{controlsDescendantBindings:!0}},preprocess:function(a){return a||"true"}};t["switch"]=!1;g.allowedBindings["switch"]=!0;s("case");s("casenot",!0);d["case.visible"]=h("visible");d["casenot.visible"]=h("visible",!0);d["switch"].makeCaseHandler=h});


/** knockout-postbox v0.2.2
 * Sincroniza observables entre s.
 * @author: (c) 2012 Ryan Niemeyer | http://www.opensource.org/licenses/mit-license
 * @source: https://github.com/rniemeyer/knockout-postbox
 * @documentation: http://www.knockmeout.net/2012/05/using-ko-native-pubsub.html
 * @example: http://jsfiddle.net/rniemeyer/mg3hj/
 *
 * a = ko.observable(6).syncWith('MyValue');
 * b = ko.observable(8).syncWith('MyValue');
 * a() == 8 ; true
 * noticias = ko.observable('las noticias de ayer').publishOn('news');
 * lector = ko.observable().subscribeTo('news', true); // el true es para que tome el ltimo valor de noticias
 * news("estas son las noticias de hoy");
 * lector() == 'estas son las noticias de hoy'); // true
 */
!(function(factory) {
	//CommonJS
	if (typeof require === "function" && typeof exports === "object" && typeof module === "object") {
		factory(require("knockout"), exports);
		//AMD
	} else if (typeof define === "function" && define.amd) {
		define(["knockout", "exports"], factory);
		//normal script tag
	} else {
		factory(ko, ko.postbox = {});
	}
}(function(ko, exports, undefined) {
	var disposeTopicSubscription, existingSubscribe;

	//create a global postbox that supports subscribing/publishing
	ko.subscribable.call(exports);

	//keep a cache of the latest value and subscribers
	exports.topicCache = {};

	//wrap notifySubscribers passing topic first and caching latest value
	exports.publish = function(topic, value) {
		if (topic) {
			//keep the value and a serialized version for comparison
			exports.topicCache[topic] = {
				value: value,
				serialized: ko.toJSON(value)
			};
			exports.notifySubscribers(value, topic);
		}
	};

	//provide a subscribe API for the postbox that takes in the topic as first arg
	existingSubscribe = exports.subscribe;
	exports.subscribe = function(topic, action, target) {
		if (topic) {
			return existingSubscribe.call(exports, action, target, topic);
		}
	};

	//by default publish when the previous cached value does not equal the new value
	exports.defaultComparer = function(newValue, cacheItem) {
		return newValue === cacheItem.value && ko.toJSON(newValue) === cacheItem.serialized;
	};

	//augment observables/computeds with the ability to automatically publish updates on a topic
	ko.subscribable.fn.publishOn = function(topic, skipInitialOrEqualityComparer, equalityComparer) {
		var skipInitialPublish;
		if (topic) {
			//allow passing the equalityComparer as the second argument
			if (typeof skipInitialOrEqualityComparer === "function") {
				equalityComparer = skipInitialOrEqualityComparer;
			} else {
				skipInitialPublish = skipInitialOrEqualityComparer;
			}

			equalityComparer = equalityComparer || exports.defaultComparer;

			//remove any existing subs
			disposeTopicSubscription.call(this, topic, "publishOn");

			//keep a reference to the subscription, so we can stop publishing
			this.postboxSubs[topic].publishOn = this.subscribe(function(newValue) {
				if (!equalityComparer.call(this, newValue, exports.topicCache[topic])) {
					exports.publish(topic, newValue);
				}
			}, this);

			//do an initial publish
			if (!skipInitialPublish) {
				exports.publish(topic, this());
			}
		}

		return this;
	};

	//handle disposing a subscription used to publish or subscribe to a topic
	disposeTopicSubscription = function(topic, type) {
		var subs = this.postboxSubs = this.postboxSubs || {};
		subs[topic] = subs[topic] || {};

		if (subs[topic][type]) {
			subs[topic][type].dispose();
		}
	};

	//discontinue automatically publishing on a topic
	ko.subscribable.fn.stopPublishingOn = function(topic) {
		disposeTopicSubscription.call(this, topic, "publishOn");

		return this;
	};

	//augment observables/computeds to automatically be updated by notifications on a topic
	ko.subscribable.fn.subscribeTo = function(topic, initializeWithLatestValueOrTransform, transform) {
		var initializeWithLatestValue, current, callback,
			self = this;

		//allow passing the filter as the second argument
		if (typeof initializeWithLatestValueOrTransform === "function") {
			transform = initializeWithLatestValueOrTransform;
		} else {
			initializeWithLatestValue = initializeWithLatestValueOrTransform;
		}

		if (topic && ko.isWriteableObservable(this)) {
			//remove any existing subs
			disposeTopicSubscription.call(this, topic, "subscribeTo");

			//if specified, apply a filter function in the subscription
			callback = function(newValue) {
				self(transform ? transform.call(self, newValue) : newValue);
			};

			//keep a reference to the subscription, so we can unsubscribe, if necessary
			this.postboxSubs[topic].subscribeTo = exports.subscribe(topic, callback);

			if (initializeWithLatestValue) {
				current = exports.topicCache[topic];

				if (current !== undefined) {
					callback(current.value);
				}
			}
		}

		return this;
	};

	//discontinue receiving updates on a topic
	ko.subscribable.fn.unsubscribeFrom = function(topic) {
		disposeTopicSubscription.call(this, topic, "subscribeTo");

		return this;
	};

	// both subscribe and publish on the same topic
	//   -allows the ability to sync an observable/writeable computed/observableArray between view models
	//   -subscribeTo should really not use a filter function, as it would likely cause infinite recursion
	ko.subscribable.fn.syncWith = function(topic, initializeWithLatestValue, skipInitialOrEqualityComparer, equalityComparer) {
		this.subscribeTo(topic, initializeWithLatestValue).publishOn(topic, skipInitialOrEqualityComparer, equalityComparer);

		return this;
	};
}));

//////////////////
//////////////////
//////////////////


/** base class for constructing a viewmodel
 * you can define your own _mapping and _defaults
*/
ko.ViewModel = $.Class({
	_defaults: {
	},
	
	_mapping: {
	},
	
	init: function(data){
		this._setMappeable();
		this._setDefaults();
		this._setMapping();
		
		this._subscriptions = [];
		this.hasData = ko.observable(false);
		this.updatingData = ko.observable(false);
		this.disposed = ko.observable(false);
		this.destroyed = ko.observable(false);
		this._resetting = false;
		this._initData = null;
		this._initializeKO(data);
		
		this.__subscribable = new ko.subscribable();
		$.extend(this, this.__subscribable );
	},
	
	_setMappeable: function(){
		this._mergeMappeable({});
	},

	_setDefaults: function(){
		this._mergeDefaults({});
	},

	_setMapping: function(){
		this._mergeMapping({});
	},

	_mergeMappeable: function(mappeable){
		this._mappeable = $.extendNoDeepCopyArray(true, {}, this._mappeable, mappeable);
	},

	_mergeMapping: function(mapping){
		this._mapping = $.extendNoDeepCopyArray(true, {}, this._mapping, mapping);
	},

	_mergeDefaults: function(defaults){
		this._defaults = $.extendNoDeepCopyArray(true, {}, this._defaults, defaults);
	},
	
	
	/*
	dispose: function(){
		if(!this.disposed()){
			this.disposed(true);
			this.disposeChildren();
			// this.__subscribable.dispose();
		}
	},
	
	disposeChildren: function(){
		$.each(this, function(key, value){
			if(value && typeof value['dispose'] == 'function'){
				value['dispose']();
			}
		})
	},
	*/

	_disposeSubscriptions: function(){
		$.each(this._subscriptions, function(index, subscription){
			subscription.dispose();
		});
	},
			
	_addDisposable: function( disposable ){
		if( !this.__disposables ) this.__disposables = [];
		this.__disposables.push( disposable );
		return disposable;
	},
			
	_disposeDisposables: function(){
		if(this.__disposables){
			$.each(this.__disposables, function(index, disposable){
				disposable.dispose();
			});			
		}
	},
	
	dispose: function(){
		this._disposeSubscriptions();
		this._disposeDisposables();
	},	
	
	
	destroy: function(){
		// llamar a este destructor cuando haga falta
		if(!this.destroyed()){
			this.destroyed(true);
			this.dispose();
			/*setTimeout(function(){
				this.___destroying = false;	
			}.bind(this),0);*/
		}
	},
	

	/**
	 * actualiza los datos desde un objeto JS
	 * @param data
	 * @param options {onlyMappeable: }
	 */
	update: function(data, options){
		if(!data) return;
		options = $.extend({}, options);
		this.updatingData(true);
		
		if( typeof data == "string" ){
			data = $.parseJSON( data );
		}
		
		if(!$.isPlainObject(data)){
			data = ko.mapping.toJS(data);
			delete data.constructor;
		}
		
		if(options.onlyMappeable) data = $.getSelectedProperties(data, this.getMappeableKeys());
		
		ko.mapping.fromJS(data, this._mapping, this);
		this.updatingData(false);
		this.hasData(!$.isEmptyObject(data)); // hasData es true SOLO si tiene datos por update. No importa al momento de la creacin.
	},
	
	getMappeableKeys: function(){
		return $.map(this._mappeable, function(value, key){return key})	
	},	

	getExportableKeys: function(){
		return $.map(this.toJS(), function(value, key){return key})	
	},	
	
	initData: function(){
		
	},

	factoryReset: function(){
		return this.reset( true );
	},

	getDefaultPropertyValue: function( /*string*/ propertyName ){
		return $.getObjectProperty( this._defaults, propertyName ) || $.getObjectProperty( this._mappeable, propertyName );
	},

	propertyHasDefaultValue: function( /*string*/ propertyName ){
		var result = true
			, currentValue = ko.unwrap( $.getObjectProperty( this, propertyName ) )
			, defaultValue = this.getDefaultPropertyValue( propertyName );

		if( currentValue || defaultValue ){
			result = currentValue == defaultValue;
		}
		return result;

	},

	getResetData: function( factoryReset ){
		var data = $.extendNoDeepCopyArray(true, {}, ko.toJS(this._mappeable), ko.toJS(this._defaults) );
		if( !factoryReset ){
			$.extendNoDeepCopyArray( data, this._initData );
		}

		return data;
	},

	/**
	 * resetea los datos al estado inicial del mapping y de los datos pasados en el constructor
	 */
	reset: function( factoryReset ){
		if(this._resetting) return;

		this._resetting = true;
		
		//var data = $.extend({}, this._mappeable, this._defaults, this._initData);
		
		var data = this.getResetData( factoryReset );
		
		ko.mapping.fromJS(data, this);
		for (prop in this){
			if( !this._excludedPropertiesFromReset || $.inArray( prop, this._excludedPropertiesFromReset ) == -1 ){
				if(this[prop] instanceof ko.ViewModel && prop!='parentViewModel'){
					this[prop].reset( factoryReset );
				}
			}
		}		
		
		////////////////////////////////////////////////////
		
		try{
			function navigateBranch(branch, reference){
				for (var key in reference){
					var node = branch[key];
					if(node && node.recordset && node.recordset.reset) {
						node.recordset.reset( factoryReset );
					}
					if($.isArray(node) || $.isPlainObject(node)) navigateBranch(node, reference[key]);
				}
			}

			navigateBranch(this, data);
		} catch(e){
			//console.error(e);
		}
		
		////////////////////////////////////////////////////

		
		try{
			this.initData();
			this.hasData(false);
			this.hasData.notifySubscribers();
			this._resetting = false;
		}catch(e){
			
		}
		if(this.errors && this.errors.showAllMessages && ko.isWriteableObservable(this.errors.showAllMessages)) this.errors.showAllMessages(false);
	},
	
	setInitData: function(data){
		$.extend(this._initData, data);
	},

	/**
	 * crea un clon de esta instancia
	 * @return {this.constructor}
	 */
	clone: function(){
		var data = ko.mapping.toJS(this)
			, thisClass = this.constructor;
		delete data.constructor;
		return new thisClass(data);
	},

	/**
	 * convierte los atributos a un JS utilizando ko.mapping.toJS
	 * @return {*}
	 */
	toJS: function( properties ){
		var options = {}
			, that = this
			, self = this
			, data;
			
		if( properties && $.isArray( properties )){
			that = $.getSelectedProperties( this, properties );
			data = ko.ViewModel.toJS( that );
		} else {
			// si se utiliz _mappeable, slo mapear a js estas propiedades y no las dems que vinieron en defaults.
			if(!$.isEmptyObject(this._mappeable)) {			
			   var that = {};
			   $.each(this._mappeable, function(key, value){
				   that[key] = ko.ViewModel.toJS(self[key]);
			   })
			}
			data = ko.mapping.toJS(that, options);
		}
		   
		delete data.constructor;
		return data;
	},
	
	toJSON: function( properties ){
		return ko.toJSON(this.toJS( properties ));
	},

	/**
	 * es llamado por el constructor para inicializar los datos
	 * @param data
	 * @private
	 */
	_initializeKO: function(data){
		var self = this;
		this._initData = $.extend({}, data);
		var data = $.extendNoDeepCopyArray(true, {}, ko.toJS(this._mappeable), ko.toJS(this._defaults), this._initData);
		ko.mapping.fromJS(data, this._mapping, this);
	},
	
	
	///////////////// VALIDATABLE //////////////////////////////////////////////
	
	/*
	 * hace que este ViewModel sea vlido cuando estas propiedades son vlidas
	 */
	/*_createValidations: function(properties, deep){
		if(!properties) properties = this;
		var validatedObservable = properties.isValid ? properties : (deep ? ko.validatedDeepObservable : ko.validatedObservable) (properties);
		this.isValid = validatedObservable.isValid;
		this.errors = validatedObservable.errors;
	}*/
	
	_isValidatable: function(o){
		var result = !! (o && o.isValid && o.isModified);
		return result;
	},
	
	_walkValidatables: function(walkable, callback){
		var self = this;
		var walkable = walkable || this._validatables || this;
		callback = callback || function(){};
		
		var unwrapped = ko.utils.unwrapObservable(walkable);

		if($.isArray(unwrapped)){
			$.each(unwrapped, function(index, value){
				self._walkValidatables(value, callback);
			});
		} 
		
		if (self._isValidatable(walkable)){
			callback (walkable);
		} 		
		
	},
	
	_createValidations: function(properties){
		// properties va a ser un array siempre de propiedades
		var self = this;
		this._makeValidatable();
		//this._validatables = $.toArray(properties);
	},
	
	_findValidatables: function(what){
		var result = [];
		var self = this;
		$.each(what, function(key, value){
			if($.isPlainObject(value)){
				Array.prototype.push.apply(result, self._findValidatables(value) );
			} else {
				if(self._isValidatable(value)) result.push(value);
			}
		});
		return result;
	},
	
	_makeValidatable: function(){
		var self = this;
		
		var validatables = ko.observableArray();
		
		///
		validatables(this._findValidatables(this));
		
		this.validatables = validatables;
		
		///
		this.firstInvalid = ko.computed( function(){
			return $.findInCollection(validatables(), function(value){
				return !value.isValid();
			});
		}, this );

		this.firstError = ko.computed( function(){
			var result = null;
			var firstInvalid = this.firstInvalid();
			if( firstInvalid ){
				return firstInvalid.error;
			}
			return result;
		}, this );

		this.isValid = ko.computed(function(){
			//console.debug('computing isValid');
			return !this.firstInvalid();
		}, this);
		
		this.isModified = ko.computed({
			read: function(){
				return !!$.findInCollection(validatables(), function(value){
					if(ko.isObservableArray(value)){
						return !!$.findInCollection(value(), function(arrayValue){
							return ko.utils.unwrapObservable(arrayValue.isModified);
						});
					} else return value.isModified();
				});
			},
			write: function(value){
				$.each(validatables(), function(index, validatable){
					validatable.isModified(value);
				})
			}
		}, this);
		
		this.modifiedFields = function(){
			return $.findAllInCollection(validatables(), function(value){
				if(ko.isObservableArray(value)){
					return $.findAllInCollection(value(), function(arrayValue){
						return ko.utils.unwrapObservable(arrayValue.isModified);
					});
				} else return value.isModified();
			});			
		};		

		this.isAnyMessageShown = ko.computed(function(){
			return !!$.findInCollection(validatables(), function(value){
				if(ko.isObservableArray(value)){
					return !!$.findInCollection(value(), function(arrayValue){
						return arrayValue.isAnyMessageShown ? arrayValue.isAnyMessageShown() : arrayValue.isModified && arrayValue.isModified() && !arrayValue.isValid();
					});
				} else return value.isAnyMessageShown ? value.isAnyMessageShown() : value.isModified() && !value.isValid();
			});
			//return this.isModified() && !this.isValid();
		}, this);
		
		
		
		this.showAllMessages = function(show){
			if (show == undefined) //default to true
				show = true;
					
			//console.debug('validatables.length', validatables().length);
			this._walkValidatables(validatables(), function(validatable){
				if(validatable.showAllMessages) validatable.showAllMessages(show);
				else if(validatable.errors && validatable.errors.showAllMessages) validatable.errors.showAllMessages(show);
				else validatable.isModified(show);
			})
		};

		/*
		this.errors = ko.computed(function(){
			var result = [];
			this._walkValidatables(validatables(), function(element){
				if(element.errors){
					var errors = ko.utils.unwrapObservable(element.errors);
					Array.prototype.push.apply(result, errors);
				} else if(element.error) result.push(element.error);
			});
			return result;
		}, this, {deferEvaluation: true});
		*/
	},

	_getSnapshotHeap: function() {
		this._snapshots = this._snapshots || [];
		return this._snapshots;
	},

	_createSnapshotData: function(){
		return $.extend({}, this.toJS());
	},

	createSnapshot: function(){
		var backup = this._createSnapshotData();
		this._getSnapshotHeap().push( backup );
	},

	restoreSnapshot: function(){
		var backup = this._getSnapshotHeap().pop();
		if( backup ){
			if( ko.toJSON( backup ) != ko.toJSON( this._createSnapshotData() ) ){
				this.update( backup );
			}
		}
	},

	clearSnapshots: function(){
		delete this._snapshots;
	}

	
});

ko.ViewModel.constructor.toString = function(){ return 'ko.ViewModel'};



ko.ViewModel.toJS = function(what){
	var what = ko.utils.unwrapObservable(what);
	if(!what) return what;
	var result;

	if (what instanceof ko.ViewModel) return what.toJS();
	else if($.isPlainObject(what)){
		result  = {};
		$.each(what, function(key, value){
			result[key] = ko.ViewModel.toJS(value);
		})
	} else if($.isArray(what)){
		result  = [];
		$.each(what, function(key, value){
			result.push(ko.ViewModel.toJS(value));
		})
		
	} else result = what;
	
	delete result.constructor;
	return result;

};
ko.ViewModel.createSubclass = function( mappingOptions, classOptions ){
	var mappingOptions = $.extend({}, mappingOptions )
		, classOptions = classOptions && classOptions.hasOwnProperty('prototype') ? classOptions : {prototype: classOptions}
		, options
		, setMappingOptions
		, legacySetMappeable	= classOptions._setMappeable
		, legacySetDefaults		= classOptions._setDefaults 
		, legacySetMapping		= classOptions._setMapping;
		
	delete classOptions._setMappeable;
	delete classOptions._setDefaults;
	delete classOptions._setMapping;
		
	setMappingOptions = {
		prototype: {
			_setMappeable: function(){
				legacySetMappeable && legacySetMappeable.apply(this, arguments);
				var mappeable = mappingOptions.mappeable;
				this._parent();
				this._mergeMappeable( mappeable );
			},

			_setDefaults: function(){
				legacySetDefaults && legacySetDefaults.apply(this, arguments);
				var defaults = mappingOptions.defaults;					
				this._parent();
				this._mergeDefaults(defaults);
			},

			_setMapping: function(){
				legacySetMapping && legacySetMapping.apply(this, arguments);
				var defaults = mappingOptions.mapping;					
				this._parent();
				this._mergeMapping(defaults);
			}
		}
	};
		
	var options = $.extendNoDeepCopyArray(true, {}, setMappingOptions, classOptions );
	var newClass = this.extend( options );		
	return newClass;
};

ko.ViewModel.createMappingMorphClassConfig = function( Clase, classTypeProperty ){
	var observable;
	 return {
		 create	: function( options ){
			 return ko.observable( null );
		 },
		 update	: function( options ){
			 var instance = options.data
				 , crearInstancia = false;

			 if( options.observable ) observable = options.observable;

			 if( options.target instanceof Clase ){
				 if( options.data ){
					 if( ko.unwrap( options.target[classTypeProperty] ) != options.data[classTypeProperty] ) crearInstancia = true;
					 else {
						 options.target.update( options.data );
						 instance = options.target;
					 }
				 } else {
					 options.observable( options.data );
					 instance = options.data;
				 }
			 } else {
				 if( options.data ) crearInstancia = true;
				 instance = options.data;
			 }

			 if( crearInstancia ){
				 instance = Clase.createInstance( options.data );
				 if(!options.observable){

				 }
			 }

			 if( observable ){
				 observable( instance );
				 if( $.isPlainObject(options.data) && !options.target ) instance = options.observable;
			 } 


			 return instance;
		 }
	 }
};


ko.ViewModel.addMethods({
	init: function(data){
		this.editables = ko.observableArray();
		this.editablesWithNames = ko.observableArray();
		this._parent.apply(this, arguments);
		this.inTransaction = this.inTransaction || ko.observable();
	},

	/**
	 * ejemplos:
	 *  makeEditable();
	 *  makeEditable('mappeable')
	 *  makeEditable(['propiedad1', 'propiedad2'])
	 *  makeEditable({fields: ['propiedad1', 'propiedad2'] })
	 *  makeEditable({fields: 'mappeable' })
	 *  makeEditable({fields: 'mappeable', exclude: ['propiedad1', 'propiedad2'] })
	 *  makeEditable({ exclude: ['propiedad1', 'propiedad2'] })
	 * @param fields
	 * @param shouldAppend
	 */

	/**
	 * fields puede ser un array de nombres de campos editables, o 'mappeable'
	 */
	makeEditable: function(fields, shouldAppend){
		var self = this
			, options = {};
		
		//if(this._editable) {
		if(this.__alreadyEditable) {
			//console.error('ko.ViewModel ya es editable');
			return;
		}



		if( $.isPlainObject( fields ) ){
			options = fields;
		} else {
			options.fields = fields;
		}


		if( options.fields == 'mappeable' ){
			options.fields = $.map(this._mappeable, function(value,key){return key});
		}

		if( options.exclude ){
			options.fields = $.arrayExclude( options.fields, options.exclude );
		}

		
		if(shouldAppend && this.editableFields) {			
			 this.editableFields = this.editableFields.concat( options.fields );
		}
		else {
			this.editableFields = options.fields;
		}

		this.editablesWithNamesFirstWithChanges = ko.computed({
			read: function(){
				var editableWithChanges = ko.utils.arrayFirst(self.editablesWithNames() || [], function ( editable ) {
					return editable.value.hasChanges();
				});
				return editableWithChanges;
			},
			deferEvaluation: true
		});

		this.hasChanges = this.hasChanges || ko.computed({
			read: function () {
				var editableWithChanges = this.editablesWithNamesFirstWithChanges();
				return editableWithChanges != null;
			},
			deferEvaluation: true
		}, this );
		
		this.__alreadyEditable = true;
	},

	addEditableField: function( fieldName ){
		this.editableFields.push( fieldName );
	},

	_makeEditable: function(){
		var self = this;
		if(this._editable) return;
		this._editable = true;
		this.editable = true;
		var fields = ko.utils.unwrapObservable( this.editableFields );
		//console.debug('fields', this.editableFields );
		var viewModel = this;

		var editables = [];
		var editablesWithNames = [];
		var banned = ['disposed', 'editables', 'constructor', 'hasData', 'makeEditable', 'beginEdit', 'hasChanges', 'updatingData', '_resetting', '_initData', '_defaults', '_mapping', '__ko_mapping__', '_parent', '_initializeKO', '_editable', 'inTransaction', 'isModified' ];

		function walk(rootObject){
			
			function checkProperty( propertyName ){
				if(ko.utils.arrayIndexOf(banned, propertyName)!=-1) return;

				if(rootObject == self && fields && ko.utils.arrayIndexOf(fields, propertyName) == -1) return;
				
				var property = rootObject[propertyName];
				if(property == rootObject.constructor.prototype[propertyName]) return;


				if(property instanceof ko.ViewModel){
					if(property.editable !== false ){
						property.makeEditable();
						editables.push(property);
						editablesWithNames.push( { name: propertyName, value: property } );
					}
				} else {
					if (ko.isWriteableObservable(property)) {
						var observable = property;
						observable.extend({
							editable: true
						});
						if (observable.editable) {
							editables.push(observable);
							editablesWithNames.push( { name: propertyName, value: observable } );
						}
					}
					else {
						property = ko.utils.unwrapObservable(property);
						if (property && typeof (property) == 'object' && property.editable !== false && !ko.isObservableArray(property)) {
							walk(property);
						}
					}
				}					
			}
			
			if(rootObject == self && fields){
				for (var i = 0 ; i < fields.length ; i++ ){
					var propertyName = fields[i];
					checkProperty(propertyName);
				}
			} else {
				for (var propertyName in rootObject){
					checkProperty(propertyName);
				}				
			}
		}

		walk(this);
		this.editables(editables);
		this.editablesWithNames( editablesWithNames );
	},

	beginEdit: function () {
		if(!this._editable) {
			if(!this.hasChanges || !this.__alreadyEditable) this.makeEditable();
			this._makeEditable();
		}
		
		if(this.inTransaction()) return;

		this.inTransaction(true);
		var editables = this.editables;

		ko.utils.arrayForEach(editables(), function (obj) {
			obj.beginEdit();
		});
		
		this.notifySubscribers(this, 'beginEdit');
	},

	commit: function () {
		if(!this.inTransaction()) return;
		this.inTransaction(false);		
		var editables = this.editables;
		ko.utils.arrayForEach(editables(), function (obj) {
			obj.commit();
		});

		if(this.hasOwnProperty('showAllMessages') && typeof this.showAllMessages == 'function') this.showAllMessages(false);
		this.notifySubscribers(this, 'commit');
	},

	rollback: function () {
		if(!this.inTransaction()) return;
		this.inTransaction(false);
		var editables = this.editables;
		ko.utils.arrayForEach(editables(), function (obj) {
			obj.rollback();
		});
		if(this.hasOwnProperty('showAllMessages') && typeof this.showAllMessages === 'function') this.showAllMessages(false);
		this.notifySubscribers(this, 'rollback');
	}
});




(function () {
	function createAttrBinding(bindingName, attrName){
		if(attrName === undefined) attrName = bindingName;
		ko.bindingHandlers[ bindingName ] = {
			init: function(element, valueAccessor){
				/*var value = ko.utils.unwrapObservable(valueAccessor()); // Get the current value of the current property we're bound to
				$(element).attr(attrName, value);
				*/
			},

			update: function(element, valueAccessor, allBindingAccessor){
				var value = valueAccessor(),
					valueUnwrapped = ko.utils.unwrapObservable(value)
					, oldValue = $(element).attr(attrName);
			
				if( oldValue != valueUnwrapped ){
					$(element).attr(attrName, valueUnwrapped);
				}
			}
		}
	}

	createAttrBinding('alt');
	createAttrBinding('title');
	createAttrBinding('src');
	createAttrBinding('href');	
	createAttrBinding('name');	
	createAttrBinding('placeholder');	
	createAttrBinding('labelfor', 'for');
	createAttrBinding('id');
	
})();








ko.bindingHandlers.hidden = {
	update: function(element, valueAccessor, allBindingsAccessor, context){
		var value = valueAccessor(), allBindings = allBindingsAccessor();
		var valueUnwrapped = ko.utils.unwrapObservable(value);
		var newValueAccessor = function(){
			return !valueUnwrapped;
		};
		ko.bindingHandlers.visible.update(element, newValueAccessor, allBindingsAccessor, context);
		
	}
};
/**
 * similar a click, pero no hace prevent default.
 */

ko.bindingHandlers['clickWithDefault'] = {
	'init': function(element, valueAccessor, allBindingsAccessor, viewModel) {
		var newValueAccessor = function(){
			return function(){
				var fn = ko.utils.unwrapObservable(valueAccessor());
				fn.apply(this, arguments); 
				return true;
			};
			
		};		
		return ko.bindingHandlers['click']['init'].call(this, element, newValueAccessor, allBindingsAccessor, viewModel);
	}
}


/*
ko.bindingHandlers['anchorenable'] = {
    'update': function (element, valueAccessor) {
        var value = ko.utils.unwrapObservable(valueAccessor());
        if (value && element.disabled) {
            element.disabled = false;
            element.removeAttribute('disabled');
            var hrefBackObject = element.getAttribute('href_back');
            if (hrefBackObject && hrefBackObject != '') {
                element.setAttribute('href', hrefBackObject);
                element.removeAttribute('href_back');
            }
        }
        else if ((!value) && (!element.disabled)) {
            element.disabled = true;
            element.setAttribute("disabled", true);
            var hrefObject = element.getAttribute('href');
            if (hrefObject && hrefObject != '') {
                element.setAttribute('href_back', hrefObject);
            }
            element.removeAttribute("href");
        }
    }
};*/

				
	
/**
	This little gem can really help reduce some clutter in your viewmodels. Often times you need to bind a click handler that simply toggles (or negates) a boolean observable. voila:
 */	
ko.bindingHandlers.toggle = {
    init: function (element, valueAccessor) {
        var value = valueAccessor();
        ko.applyBindingsToNode(element, {
            click: function () {
                value(!value());
            }
        });
    }
};

/**
* class binding handler. Same as attr:{'class':'...'} binding
*/
ko.bindingHandlers['class'] = {
    'update': function(element, valueAccessor) {
        if (element['__ko__previousClassValue__']) {
            $(element).removeClass(element['__ko__previousClassValue__']);
        }
        var value = ko.utils.unwrapObservable(valueAccessor());
        $(element).addClass(value);
        element['__ko__previousClassValue__'] = value;
    }
};

/**
 * the dom element will blink when the valueAccessor change
 * @type {Object}
 */
ko.bindingHandlers.blink = {
   update: function(element, valueAccessor, allBindingAccessor) {
		var value = ko.utils.unwrapObservable(valueAccessor()),
			allBinding = ko.utils.unwrapObservable(allBindingAccessor()),
			options = $.extend({}, allBinding.blinkOptions);
			
		if($(element).data('_previousBlinkValue') !== undefined && $(element).data('_previousBlinkValue') != value){
			$(element).blink( options );
		}
		$(element).data('_previousBlinkValue', value);
    }

};
ko.bindingHandlers.blinkClass = {
   update: function(element, valueAccessor, allBindingAccessor) {
		var value = ko.utils.unwrapObservable(valueAccessor()),
			allBinding = ko.utils.unwrapObservable(allBindingAccessor()),
			options = $.extend({
				css			: 'highlighted',
				interval	: 500,
				repeat		: 5
			}, allBinding.blinkClassOptions);
		
		$(element).unrepeat().removeClass( options.css );
		if(value){
			$(element).repeat( options.interval ).toggleClass( options.css ).until( options.repeat ).removeClass( options.css );
		}
		
    }

};
// Here's a custom Knockout binding that makes elements shown/hidden via jQuery's fadeIn()/fadeOut() methods
// Could be stored in a separate utility library
ko.bindingHandlers['fadeVisible'] = {
    'init': function(element, valueAccessor) {
        // Initially set the element to be instantly visible/hidden depending on the value
        var value = valueAccessor();
        $(element).toggle(!!ko.utils.unwrapObservable(value)); // Use "unwrapObservable" so we can handle values that may or may not be observable
    },
    'update': function(element, valueAccessor) {
        // Whenever the value subsequently changes, slowly fade the element in or out
        var value = valueAccessor();
        ko.utils.unwrapObservable(value) ? $(element).stop().fadeIn() : $(element).stop().fadeOut();
    }
};


// Here's a custom Knockout binding that makes elements shown/hidden via jQuery's fadeIn()/fadeOut() methods
// Could be stored in a separate utility library
ko.bindingHandlers.slideVisible = {
	init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
        // Initially set the element to be instantly visible/hidden depending on the value
        var value = valueAccessor()
			, allBindingsValue = ( allBindings && allBindings() || {} )
			, options = $.extend({
				autofade	: false,
				useIf		: false
			}, ko.unwrap( allBindingsValue.slideVisibleOptions )),
			ifObservableSubscription;
			
		
		var unwrappedValue = ko.utils.unwrapObservable(value);
		$(element).data('___slideVisibleValue___', unwrappedValue);
		
		ko.bindingHandlers['visible'].update.apply( ko.bindingHandlers['visible'], arguments );
		
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			var timeout = $(element).data('___slideVisibleTimeout___');
			var timeoutAutofade = $(element).data('___slideVisibleTimeoutautofade___');
			if(timeout)	clearTimeout(timeout);
			if(timeoutAutofade)	clearTimeout(timeoutAutofade);
			ifObservableSubscription && ifObservableSubscription.dispose();
		});
		

		if( options.useIf ){
			var ifObservable = ko.observable();
			function ifValueAccessor(){
				return ifObservable;
			}
			ko.utils.domData.set( element, 'ifObservable', ifObservable );				
			ko.bindingHandlers.if.init(element, ifValueAccessor, allBindings, viewModel, bindingContext);
			
			if( ko.bindingHandlers.if.update ) {
				ifObservableSubscription = ifObservable.subscribe( function( value ){
					ko.bindingHandlers.if.update(element, ifValueAccessor, allBindings, viewModel, bindingContext);
				});
			}

			
			ifObservable( unwrappedValue );
			
			return { controlsDescendantBindings: true };
		}
		
    },


	update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
		// Whenever the value subsequently changes, slowly fade the element in or out
		var value = valueAccessor()
			, allBindingsValue = ( allBindings && allBindings() || {} )
			, options = $.extend({
				autofade		: false,
				useIf			: false,
				duration		: 400,
				onInEnd			: null,
				onOutEnd		: null,

			}, ko.unwrap( allBindingsValue.slideVisibleOptions )),
			ifObservable = ko.utils.domData.get( element, 'ifObservable' ),
			$el = $(element);


		var unwrappedValue	= ko.utils.unwrapObservable(value) || false;
		var dataValue		= $el.data('___slideVisibleValue___');
		var timeout			= $el.data('___slideVisibleTimeout___');
		var timeoutAutofade = $el.data('___slideVisibleTimeoutautofade___');

		if(unwrappedValue != dataValue){
			if(timeout)	clearTimeout(timeout);

			if(!unwrappedValue){
				if( $el.css('display') != 'none'){
					var nodesToDelete = element.childNodes;
					if( options.useIf ){
						ko.utils.arrayForEach(nodesToDelete, ko.cleanNode);
					}

					//ko.cleanNode(element);
					$el.stop(true, true);
					$el.slideUp( options.duration );
					$el.promise().done( function(){
						if( !unwrappedValue ){
							ifObservable && ifObservable( false );
						}
						options.onOutEnd && options.onOutEnd( element );
					});
				}
			} else {
				timeout = setTimeout(function(){
					$(element).data('___slideVisibleTimeout___', null);
					if(!unwrappedValue){
						if( $el.css('display') != 'none'){
							$el.stop(true, true);
							$el.slideUp( options.duration );
							$el.promise().done( function(){
								if( !unwrappedValue ){
									ifObservable && ifObservable( false );
								}
								options.onOutEnd && options.onOutEnd( element );
							});
						}
					} else {
						$el.stop(true, true);
						ifObservable && ifObservable( true );
						$el.slideDown( options.duration );
						// fix para posible bug de jquery que deja el overflow en none y el display en block
						$el.promise().done( function(){
							$el.css({overflow: '', display: ''});
							options.onInEnd && options.onInEnd( element );
						});
					}
				},10);
				$el.data('___slideVisibleTimeout___', timeout);
			}
			$el.data('___slideVisibleValue___', unwrappedValue);

		} else {
			if( !unwrappedValue ){
				//ifObservable && ifObservable( false );
			}
		}

		if( value ){
			if( options.autofade ){
				if(timeoutAutofade)	clearTimeout(timeoutAutofade);
				var timeoutAutofade = setTimeout(function(){
					if( $el.css('display') !== 'none'){
						$el.slideUp();
						$el.promise().done( function(){
							if( !unwrappedValue ){
								ifObservable && ifObservable( false );
							}
							options.onOutEnd && options.onOutEnd( element );
						})
					}
				}, options.autofade);
				$el.data('___slideVisibleTimeoutautofade___', timeoutAutofade);
			}
		}

	}
};



ko.bindingHandlers.ghostTo = {
   update: function(element, valueAccessor, allBindingsAccessor, viewModel){
	   
		var value = valueAccessor(), allBindings = allBindingsAccessor();

		// Next, whether or not the supplied model property is observable, get its current value
		var valueUnwrapped = ko.utils.unwrapObservable(value); 

		// Grab some more data from another binding property
		var target = ko.utils.unwrapObservable(allBindings.ghostToTarget);

		if(valueUnwrapped){
			$(element).ghostTo(target);
		}
   }
};

ko.bindingHandlers.soulUp = {
   init: function(element, valueAccessor, allBindingsAccessor, viewModel){
	   $(element).hide();
   },
   update: function(element, valueAccessor, allBindingsAccessor, viewModel){	   
		var value = valueAccessor(), allBindings = allBindingsAccessor();
		var valueUnwrapped = ko.utils.unwrapObservable(value); 
		var options = ko.utils.unwrapObservable(allBindings.soulUpOptions);
		if(valueUnwrapped){
			$(element).soulUp(options);
		}
   }
};

/**
 * valueAccessor = { 
 *		onLoad: {Function} indica que se carg la imagen ,
 *		onError: {Function} indica que la imagen no carg, hubo un error,
 *		onAbort: {Function} indica que se abort la carga de la imagen (normalmente por el usuario)
 *		loading: {ko.observable} se pone en true mientras se carga la imagen
 *		loaded: {ko.observable} se pone en true cuando carg la imagen
 *		
 * } 
 * 
 * ejemplo1: 
 * <!-- ko withProperties: {cargandoImagen: ko.observable} -->
 * <div data-bind="visible: cargandoImagen">Cargando...</div>
 * <img data-bind="loading: cargandoImagen"/>
 * <!-- /ko -->
 * 
 * ejemplo2: 
 * <img data-bind="imgEvents: { loading: miObservableDeLoading, loaded: miObservableDeLoaded, onLoad: miFuncionDeOnLoad} "/>
 * 
 */
ko.bindingHandlers.imgEvents = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel){
		var value = valueAccessor(), allBindings = allBindingsAccessor();
		var options = $.extend({}, value);
		$(element).on('load', value.onLoad);
		$(element).on('error', value.onError);
		$(element).on('abort', value.onAbort);
		
		$(element).addClass('loading');

		$(element).on('load', function(){
			//$(element).data('__imgEvents.eventoDisparado', $(element).hasClass('loading') ? 'ok' : 'error');
			$(element).removeClass('abort');
			$(element).removeClass('error');
			$(element).removeClass('loading');
			if(ko.isWriteableObservable(options.loading)) options.loading(false);				
			if(ko.isWriteableObservable(options.loaded)) options.loaded(true);				
		});

		$(element).on('error', function(){
			//$(element).data('__imgEvents.eventoDisparado', $(element).hasClass('loading') ? 'ok' : 'error');
			$(element).addClass('error');
			$(element).removeClass('abort');
			$(element).removeClass('loading');
			if(ko.isWriteableObservable(options.loading)) options.loading(false);
			if(ko.isWriteableObservable(options.loaded)) options.loaded(false);				
		});

		$(element).on('abort', function(){
			//$(element).data('__imgEvents.eventoDisparado', $(element).hasClass('loading') ? 'ok' : 'error');
			$(element).addClass('abort');
			$(element).removeClass('error');
			$(element).removeClass('loading');
			if(ko.isWriteableObservable(options.loading)) options.loading(false);
			if(ko.isWriteableObservable(options.loaded)) options.loaded(false);				
		});

		$(element).data('__imgEvents.oldSrc',  $(element).attr('src'));
	   
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			$(element).off('load', value.onLoad); 
			$(element).off('error', value.onError); 
			$(element).off('abort', value.onAbort); 
		});
	},
   
	
   
   	update: function(element, valueAccessor, allBindingsAccessor, viewModel){
		var value = valueAccessor(), allBindings = allBindingsAccessor(),
			src = $(element).attr('src'),
			options = $.extend({}, value),
			abortOn = ko.utils.unwrapObservable(options.abortOn);
			
			if(abortOn) {
				setTimeout(function(){
					$(element).trigger('abort');
				},1);
			}

			if(src != $(element).data('__imgEvents.oldSrc')){
				//if($(element).data('__imgEvents.eventoDisparado') != 'error'){
					$(element).addClass('loading');
					$(element).removeClass('error');
					if(ko.isWriteableObservable(options.loading)) options.loading(true);				
					if(ko.isWriteableObservable(options.loaded)) options.loaded(false);				
				//}
				$(element).data('__imgEvents.oldSrc', src);
				//$(element).removeData('__imgEvents.eventoDisparado');

			}
	}
};





// disable tab on textarea
ko.bindingHandlers.disabletab = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel){
		$(element).on('keydown', function(e) {
			var keyCode = e.keyCode || e.which;

			if (keyCode == 9) {
				e.preventDefault();
				var start = $(this).get(0).selectionStart;
				var end = $(this).get(0).selectionEnd;

				// set textarea value to: text before caret + tab + text after caret
				$(this).val($(this).val().substring(0, start)
					+ "\t"
					+ $(this).val().substring(end));

				// put caret at right position again
				$(this).get(0).selectionStart =
				$(this).get(0).selectionEnd = start + 1;
			}
		});
	}
};


// lined textarea
// disable tab on textarea
ko.bindingHandlers.linedtextarea = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel){
		//var options = $.extend({});
		setTimeout(function(){
			$(element).linedtextarea();
		},3000);
			
	}
};



/**
 * type: ['alert', 'prompt', 'confirm']
 */
function createBaseModalBinding(type, defaultOptions){
	var dataAttribute = "_the" + type;
	return	{
		init: function(element, valueAccessor, allBindingsAccessor, viewModel ){
			//handle disposal (if KO removes by the template binding)
			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				var modal = $(element).data(dataAttribute);
				if( modal ) modal.close();
			});
		},

		update: function(element, valueAccessor, allBindingsAccessor, viewModel ){
			var visible = ko.utils.unwrapObservable(valueAccessor()),
				options = $.extend({}, defaultOptions, allBindingsAccessor()[ type + 'Options' ]) , // alertOptions, proptOptions, confirmOptions
				doneFn = options.done || function(){},
				failFn = options.fail || function(){},
				modal = $(element).data(dataAttribute);
			
			$(element).toggle( !!visible );
				
			if(!visible){
				if(modal){
					modal.close();
				}
			} else {
				if(!modal){
					modal = $[type](element, options)
						.always(function(){
							$(element).removeData(dataAttribute);					
							if (ko.isWriteableObservable(valueAccessor())) valueAccessor()(false);
						})
						.done(doneFn)
						.fail(failFn);

					if( options.disable !== undefined ){
						ko.computed({
							read: function(){
								var value = ko.utils.unwrapObservable(options.disable);
								modal.toggleButtons(!value);
							},
							disposeWhenNodeIsRemoved: element
						}, this);
					}

					if( options.disableAccept !== undefined ){
						ko.computed({
							read: function(){
								var value = ko.utils.unwrapObservable(options.disableAccept);
								modal.buttonAcceptDisabled && modal.buttonAcceptDisabled(value);
							},
							disposeWhenNodeIsRemoved: element
						}, this);
					}

					if( options.toggleCloseButton !== undefined ){
						ko.computed({
							read: function(){
								var value = ko.utils.unwrapObservable( options.toggleCloseButton );
								modal.toggleCloseButton(value);
							},
							disposeWhenNodeIsRemoved: element
						}, this);
					}

					if( typeof options.setDeferred === 'function' ){
						options.setDeferred( modal.deferred );
					}

					$(element).data(dataAttribute, modal);
				}
			}
		}
	}
}

ko.bindingHandlers.prompt = createBaseModalBinding('prompt');
ko.bindingHandlers.alert = createBaseModalBinding('alert');
ko.bindingHandlers.confirm = createBaseModalBinding('confirm');






/**
* http://knockoutjs.com/documentation/custom-bindings-controlling-descendant-bindings.html
* For example, you could have a binding called withProperties that attaches some extra properties to the binding context that will then be available to all descendant bindings:
*
* example
* <div data-bind="withProperties: { emotion: 'happy' }">
*	Today I feel <span data-bind="text: emotion"></span>. <!-- Displays: happy -->
* </div>
*
*/
ko.bindingHandlers.withProperties = {
    init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
        // Make a modified binding context, with a extra properties, and apply it to descendant elements
		var newProperties = valueAccessor(),
            innerBindingContext = bindingContext.extend(newProperties);
        ko.applyBindingsToDescendants(innerBindingContext, element);
 
        // Also tell KO *not* to bind the descendants itself, otherwise they will be bound twice
        return { controlsDescendantBindings: true };
        
    }
};
ko.virtualElements.allowedBindings['withProperties'] = true;


/**
 * social binding handlers
 */


ko.bindingHandlers.autoscroll = {
	init: function( element, valueAccessor ){
		var timeouthandle = setTimeout( function(){
			ko.bindingHandlers.autoscroll.update( element, valueAccessor );
		}, 0);
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			clearTimeout( ko.utils.domData.get(element, 'autoscrollTimeout') );
			clearTimeout( timeouthandle );
		$(element).stop();
		});
	},
	
	_scroll: function( element, velocity ){
		var direction = ko.utils.domData.get(element, 'autoscrollDirection')
			, scrollBottom = $(element).scrollHeight() - $(element).outerHeight();
		
		if( $(element).scrollTop() < 3 ) direction = true;
		
		$(element).stop().animate({'scrollTop': direction ? scrollBottom : 0 }, velocity, function(){
			ko.utils.domData.set(element, 'autoscrollDirection', !direction );
			ko.bindingHandlers.autoscroll._scroll( element, velocity );
		});
	},
	
	update: function( element, valueAccessor ){
		var value = ko.unwrap( valueAccessor() );
		if( value !== false ){
			var tmh = setTimeout( function(){
				ko.bindingHandlers.autoscroll._scroll( element, value );						
			}, 0);
			ko.utils.domData.set(element, 'autoscrollTimeout', tmh);
		} else {
			$(element).stop();
		}
	}
};



(function (ko) {
	var bindingName = 'extendfull';
	var defaultOptions = {
		'parent'		: window
	};
	
	ko.bindingHandlers[bindingName] = {
		init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var self = ko.bindingHandlers.extendfull;

			ko.utils.domData.set(element, bindingName + '.index', Math.random());
			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				self._resetExtendWidth( element );
			});
		},

		_doExtendWidth: function( element, side ){
			$(element).css({marginLeft: '', marginRight: ''});
			var options = ko.utils.domData.get( element, bindingName+'.options' );

			/*
				, parentLeft = options.parent == window ? 0 : $(options.parent).offset().left
				, parentRight = options.parent == window ? 0 : $(window).width() - $(options.parent).outerWidth() - parentLeft
				, elementLeft = $(element).offset().left
				, elementRight = $(window).width() - $(element).outerWidth() - elementLeft
				, marginLeft = elementLeft - parentLeft
				, marginRight = elementRight - parentRight;
			*/
			if( options ){
				var offset = $(element).relativeOffset( options.parent );
				var marginLeft = offset.scaled.left;
				var marginRight =  offset.scaled.right - offset.scaled.dimensions.width;

				$(element).css({marginLeft: - marginLeft, marginRight: -marginRight });

				ko.utils.domData.set(element, bindingName + '.active', true );
			}
		},

		_resetExtendWidth: function( element ){
			cancelAnimationFrame( ko.utils.domData.get( element, 'extendfull.timeout' ) );
			if( ko.utils.domData.get(element, 'extendfull.active' ) ){
				var index = ko.utils.domData.get(element, 'extendfull.index');
				$(window).off( 'resize.' + bindingName + '.' + index );
				$(element).css({marginLeft: '', marginRight: ''});
				ko.utils.domData.set(element, bindingName + '.active', false );			
			}
		},

		update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var value = ko.unwrap( valueAccessor() )
				, self = ko.bindingHandlers.extendfull
				, index = ko.utils.domData.get(element, bindingName + '.index')
				, options = $.extend({}, defaultOptions, ko.unwrap( allBindingsAccessor()[ bindingName+ 'Options' ] ) );

			ko.utils.domData.set( element, bindingName+'.options', options);

			self._resetExtendWidth( element );

			if( value ){
				$(window).on( 'resize.' + bindingName + '.' + index, self._doExtendWidth.bind( self, element, value ) );
				ko.utils.domData.set( element, bindingName + '.timeout', requestAnimationFrame(function(){
					self._doExtendWidth( element, value );
				}, 0 ) );
			}
		}
	};
})(ko);


(function (ko) {
	var bindingName = 'elementResize';
	
	var self = ko.bindingHandlers[bindingName] = {
		_onResize: function( element, callback ){
			var data = ko.utils.domData.get(element, bindingName + '.data');
			if( data.options.as ){
				var width = $(element).outerWidth();
				var height = $(element).outerHeight();
				data.width( width );
				data.height( height );
			}
			if( typeof callback == 'function' ){
				callback( ko.dataFor( element ), element );
			}
		},
		
		_removeResize: function( element ){
			if( ko.utils.domData.get( element, bindingName + '.enable') ){
				$(element).removeResize();			
				ko.utils.domData.set( element, bindingName + '.enable', false);
			}
		},

		destroy: function( element ){
			self._removeResize( element );
		},
		
		init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var data = {}
				, value = ko.unwrap( valueAccessor() )
				, allBindings = allBindingsAccessor()
				, options = $.extend({
					'as'	: null
				}, allBindings[bindingName+'Options']);

			ko.utils.domData.set( element, bindingName + '.data', data );
			data.options = options;

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				self.destroy( element );
			});

			if( value && options.triggerOnRender ){
				$(element).resize( self._onResize.bind( self, element, value ) );
			}

			if( options.as ){
				var newProperties = {};
				newProperties[ options.as ] = {
					'width'					: ko.observable(),
					'height'				: ko.observable()
				}
				$.extend( data, newProperties[ options.as ] );
				var innerBindingContext = bindingContext.extend(newProperties)
				ko.applyBindingsToDescendants(innerBindingContext, element);
				return { controlsDescendantBindings: true };
			}

		},
		
		update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var value = ko.unwrap( valueAccessor() );
			if( value ){
				self._removeResize( element );
				$(element).resize( self._onResize.bind( self, element, value ) );
				ko.utils.domData.set( element, bindingName + '.enable', true);
			} else {
				self._removeResize( element );
			}
		}
	};
})(ko);


FBApi = $.Class({
	prototype: {
		init: function( options ){
			this._deferred = new $.Deferred();
			$.extend(this, this._deferred);
			this.options = $.extend({}, options);

			this._setFbAsyncInit();
			this._insertScript();
		},

		_setFbAsyncInit: function(){
			var appId = this.options.appId
				, self = this;
			window.fbAsyncInit = function() {
				var options = {
					status : true, // check login status
					cookie : true, // enable cookies to allow the server to access the session
					xfbml  : true  // parse XFBML
				};
				if(appId) options.appId = appId;
				FB.init(options);
				if( appId ){
					FB.getLoginStatus(function(response){
						self._onLoad();
						FB.Canvas.setAutoResize();
					});
				} else {
					self._onLoad();
				}
			};		
		},

		_onLoad: function(){
			this.resolve('ok');
		},

		_insertScript: function(){
			//var locale = this._translateLocale( this.options.locale || 'es_LA' );
			//fix para mostrar en ingles las opciones de facebook "Me gusta". TODO cargar el idioma configurado en SS
			var locale = this._translateLocale( this.options.locale || window.navigator.userLanguage || window.navigator.language || 'es_LA' );

			setTimeout(function() {
				var e = document.createElement('script');
				e.src = document.location.protocol + '//connect.facebook.net/' + locale + '/all.js';
				e.async = true;
				document.getElementById('fb-root').appendChild(e);
			},1000);
		},

		_translateLocale: function( locale ){
			var locale = locale || ''
				, isoPais = locale.substr(3,2)
				, isoIdioma = locale.substr(0,2);

			switch( true ){
				case isoIdioma == 'en':
					locale = 'en_US';
					break;

				case isoIdioma == 'es':
					locale = 'es_LA';

				case isoPais == 'ES':
					locale = 'es_ES';
					break;

				case isoIdioma = 'pt':
					locale = 'pt_BR';

				case isoPais = 'PT':
					locale = 'pt_PT';
					break;
			}

			return locale;
		}
	},
	getInstance: function( options ){
		if(!this._instance){
			this._instance = new this( options );
		}
		return this._instance;
	}
});

TWRApi = $.Class({
	prototype: {
		init: function( options ){
			this.options = $.extend({}, options);			
			this._deferred = new $.Deferred();
			$.extend(this, this._deferred);
			this._insertScript();
		},
		
		_insertScript: function(){
			var self = this;
			setTimeout( function(){
				$.getScript('//platform.twitter.com/widgets.js', function(){
					self._onLoad();
				});
			}, 1000);
		},
		
		_onLoad: function(){
			this.resolve('ok');
		}
	},
	
	getInstance: function( options ){
		if(!this._instance){
			this._instance = new this( options );
		}
		return this._instance;
	}
});


	
			
ko.bindingHandlers['fbLike'] = {
	update: function (element, valueAccessor) {
		var options = $.extend({}, valueAccessor());
		var href = ko.utils.unwrapObservable(options.href);
		if(href) $(element).attr('data-href', href);

		$(element).attr('data-send', ko.utils.unwrapObservable(options.send));
		$(element).attr('data-layout', ko.utils.unwrapObservable(options.layout));
		$(element).attr('data-width', ko.utils.unwrapObservable(options.width));
		$(element).attr('data-show-faces', ko.utils.unwrapObservable(options.showFaces));

		FBApi.getInstance( options ).done( function(){
			window.FB && FB.XFBML.parse();			
		});
	}
};
			

ko.bindingHandlers['fbComments'] = {
	update: function (element, valueAccessor) {
		var options = $.extend({}, valueAccessor());
		var href = ko.utils.unwrapObservable(options.href);
		if(href) $(element).attr('data-href', href);

		FBApi.getInstance( options ).done( function(){
			window.FB && FB.XFBML.parse();			
		});
	}/*,
	
	update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext){
		console.debug('fbComments.update', valueAccessor(), allBindingsAccessor(), viewModel, bindingContext);
	}*/
};

ko.bindingHandlers['twButton'] = {
	update: function(element, valueAccessor){
		var options = $.extend({
			url		: document.location.href,
			lang	: 'es'
		}, valueAccessor());
		
		$(element).addClass('twitter-share-button').css({'width': '200px'});
		
		$(element).attr('data-lang', ko.utils.unwrapObservable(options.lang));
		$(element).attr('data-url', ko.utils.unwrapObservable(options.url));
		
		TWRApi.getInstance().done( function( result ){ 
			window.twttr && twttr.widgets.load();
		});		
	}
};

ko.bindingHandlers['twWidget'] = {
	update: function(element, valueAccessor){
		var options = $.extend({
			url		: document.location.href,
			lang	: 'es'
		}, valueAccessor());
		
		$(element).css({'width': '100%'});
		$(element).attr('data-lang', ko.utils.unwrapObservable(options.lang));
		$(element).attr('data-url', ko.utils.unwrapObservable(options.url));
		
		TWRApi.getInstance().done( function( result ){ 
			window.twttr && twttr.widgets.load();
		});

	}
};
ko.bindingHandlers['gplusButton'] = {
	update: function(element, valueAccessor){
		var options = $.extend({
			href	: document.location.href
		}, valueAccessor());
		$(element).attr('data-href', ko.utils.unwrapObservable(options.href));
		/*
		$(element).attr('data-lang', ko.utils.unwrapObservable(options.lang));
		$(element).attr('data-url', ko.utils.unwrapObservable(options.url));
		*/
		setTimeout(function(){
			window.gapi && gapi.plusone.render(element, options);
			//window.gapi && gapi.plusone.go(element);
		},100);
	}
};


/*
ko.bindingHandlers.smartaffix = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel){
		var value = valueAccessor();
		if(ko.utils.unwrapObservable(value)){
			$(element).smartaffix();
		} else {
			window.console && window.console.error && window.console.error('No se pudo crear smart affix', value);
		}
	}
};
*/

ko.bindingHandlers.smartaffix = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel){
		var value = valueAccessor()
			, timeoutHandle
			, allBinding = allBindingsAccessor(),
			options = $.extend({
				recalc	: null
			}, ko.utils.unwrapObservable(allBinding.smartaffixOptions));

	
		ko.computed({
			read: function(){
				var smartaffix = $(element).data('smartaffix')
					, recalc = ko.unwrap( options.recalc );

				//console.debug('smartaffix', smartaffix, 'recalc', recalc);
				
				if( smartaffix && recalc ){
					smartaffix.checkPosition();
					/*
					setTimeout( function(){
						var smartaffix = $(element).data('smartaffix')
						smartaffix.checkPosition();						
					}, 100);*/
				}
			},
			disposeWhenNodeIsRemoved: element
		});
		
		timeoutHandle = setTimeout(function(){
			if(ko.utils.unwrapObservable(value)){
				$(element).smartaffix( options );
			} else {
				//window.console && window.console.error && window.console.error('No se pudo crear smart affix', value);
			}			
		}, 0 );
		
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			clearTimeout( timeoutHandle );
			if($(element).data('smartaffix')){
				$(element).smartaffix('destroy');
			}
		});
		
	
	}
};


ko.bindingHandlers.covered = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel){
		var $element = $(element),
			value = valueAccessor(),
			$coverElement = $('<div>').css({background:'#000', opacity: 0, zIndex: 1000, position: 'absolute', display: 'block'}),
			onResize,
			timeoutResize;
		
		ko.computed({
			read: function(){
				var cover = ko.utils.unwrapObservable(value);
				if(cover){
					$element.before($coverElement);
				} else {
					ko.removeNode( $coverElement[0] );
				}
			},
			disposeWhenNodeIsRemoved: element
		});

		onResize = function(){
			var width = $element.width(), height = $element.height();
			$coverElement.width(width).height(height);
		};

		$(window).on('resize.covered.bindingHandlers', onResize);
		
		timeoutResize = setTimeout( function (){
			onResize();				
		},10);
		
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			clearTimeout( timeoutResize );
			$(window).off('resize.covered.bindingHandlers', onResize);		
		});
	}
};
ko.bindingHandlers.scrollTo = {
	init: function(element, valueAccessor, allBindingAccessor, viewModel){
		var $element = $(element),
			value = valueAccessor(),
			allBinding = allBindingAccessor(),
			uid = Math.random(),
			options = $.extend({
				delay				: 0,
				duration			: 500,
				axis				: 'y',
				parent				: window,
				onlyIfNotInViewport	: false,
				onlyIf				: null
			}, ko.utils.unwrapObservable(allBinding.scrollToOptions));


		var onScroll = function(event){
			clearTimeout(ko.bindingHandlers.scrollTo.timeoutHandle);
			ko.bindingHandlers.scrollTo.timeoutHandle = null;
			$(window).stop(true);
		};
			
		$(window).on('mousewheel.scrollTo.bindingHandlers DOMMouseScroll.scrollTo.bindingHandlers', onScroll);
		
		ko.computed({
			read: function(){
				var scroll = ko.utils.unwrapObservable(value)
					, passViewportTest	= !options.onlyIfNotInViewport || !$(element).isScrolledIntoView()
					, passOnlyIfTest	= !options.onlyIf || options.onlyIf();
					
				if( scroll && passViewportTest && passOnlyIfTest ){
					onScroll();
					ko.bindingHandlers.scrollTo.current = $element;
					$(window).stop(true);
					if( options.from == 'top') $(options.parent).scrollTo(1);
					ko.bindingHandlers.scrollTo.timeoutHandle = setTimeout(function(){
						$(window).stop(true);
						$(options.parent).scrollTo($element, options);
					}, 10 + options.delay );
				} else {
					if( ko.bindingHandlers.scrollTo.current == $element ) onScroll();
				}
			},
			disposeWhenNodeIsRemoved: element
		});
		
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			if( ko.bindingHandlers.scrollTo.current == $element ) onScroll();
			$(window).off('mousewheel.scrollTo.bindingHandlers DOMMouseScroll.scrollTo.bindingHandlers', onScroll);
		});

	}
};
ko.bindingHandlers.onrender = {
	init: function(element, valueAccessor){
		var $element = $(element);
		var value = valueAccessor();
		if(typeof value == 'function') value();
	}
};
ko.virtualElements.allowedBindings['onrender'] = true;


ko.bindingHandlers.onDomNodeDisposal = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			var callback = ko.unwrap( valueAccessor() );
			callback( element );
		});	
	}
};
ko.virtualElements.allowedBindings['onDomNodeDisposal'] = true;



/*
 * http://www.knockmeout.net/2013/06/knockout-debugging-strategies-plugin.html
 */
 ko.bindingHandlers.logger = {
	update: function(element, valueAccessor, allBindings) {
		//store a counter with this element
		var count = ko.utils.domData.get(element, "_ko_logger") || 0,
			data = ko.toJS(valueAccessor() || allBindings());

		ko.utils.domData.set(element, "_ko_logger", ++count);

		if (console && console.log) {
			console.log(count, element, data);
		}
	}
};
ko.virtualElements.allowedBindings['logger'] = true;


/**
 * 
 * Binding handler para Google's Recaptcha
 */
ko.bindingHandlers['recaptcha'] = {
	_scriptId		: 'recaptcha_script_' + ko.utils.createUID(),
	_insertScript	: function(){
		var	self = ko.bindingHandlers['recaptcha']
			, scriptId = self._scriptId
			, protocol = document.location.protocol
			, $script = $('#' + scriptId);

		if(!$script[0]){
			$script = $('<script>');
			$script.attr( 'type', 'text/javascript' );
			$script.attr( 'async', 'async' );
			$script.attr( 'defer', 'defer' );

			$script.attr( 'src', protocol + '//www.google.com/recaptcha/api/js/recaptcha_ajax.js' );					

			$script.attr( 'id', scriptId );
			$('head')[0].appendChild( $script[0] );
		}
	},

	_createRecaptcha: function( your_public_key, element, userInputObservable ){
		function recaptchaCallback(){
			/*$('[name="recaptcha_response_field"]', element)
				.attr('data-bind="value: value"')*/
		}

		Recaptcha.create(your_public_key, element, {
			theme: "clean",
			callback: recaptchaCallback 
		});
	},

	init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
		var self = ko.bindingHandlers['recaptcha']
			, detectCaptchaScriptInterval
			, value = valueAccessor()
			, public_key = ko.unwrap( value['public_key'] )
			, userInput = value.value;
		//, innerBindingContext = bindingContext.extend({value: userInput});

		ko.bindingHandlers.recaptcha._insertScript();

		detectCaptchaScriptInterval = setInterval( function(){
			if( window['Recaptcha'] ) {
				clearInterval ( detectCaptchaScriptInterval );
				self._createRecaptcha( public_key, element, value );
			}
		}, 100 );

		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			clearInterval ( detectCaptchaScriptInterval );
			if( window.Recaptcha ) window.Recaptcha.destroy();
		});

		//return { controlsDescendantBindings: true };

	}
};


/**
 * 
 * Binding handler para Google's Recaptcha V2
 */
(function(ko){
	
	window.__faspfoasudgoiuasdfaasdoupasdf = function(){
		GRecaptcha.getInstance()._onLoad();
	}
	
	var GRecaptcha = $.Class({
		prototype: {
			init: function( options ){
				this.options = $.extend({}, options);			
				this._deferred = new $.Deferred();
				$.extend(this, this._deferred);
				this._insertScript();
			},

			_insertScript: function(){
				var self = this;
				var locale = ( this.options.locale || 'es_AR' );
				var isoIdioma = locale.substr(0,2);
				setTimeout( function(){
					$.getScript('//www.google.com/recaptcha/api.js?onload=__faspfoasudgoiuasdfaasdoupasdf&render=explicit' + '&hl=' + isoIdioma );
				}, 1000);
			},

			_onLoad: function(){
				this.resolve('ok');
			}
		},

		getInstance: function( options ){
			if(!this._instance){
				this._instance = new this( options );
			}
			return this._instance;
		}
	});
	
	
	var bindingName = 'recaptchav2';
	var self = ko.bindingHandlers[bindingName] = {
		
		_onNewToken: function( element, token ){
			var data = ko.utils.domData.get(element, bindingName + '.data' );
			data.userInput(token);
			data.error(null);
		},
		
		_onExpiredToken: function( element ){
			var data = ko.utils.domData.get(element, bindingName + '.data' );
			data.userInput('');
		},
		
		_onError: function( element, error ){
			var data = ko.utils.domData.get(element, bindingName + '.data' );
			data.error( error );
		},

		init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var options = $.extend({}, valueAccessor());
			var self = ko.bindingHandlers['recaptchav2']
				, detectCaptchaScriptInterval
				, value = valueAccessor()
				, public_key = ko.unwrap( value['sitekey'] )
				, userInput = value.value
				, error = value.error
				, elementId = $(element).attr('id')
				, recaptchaCreated = false
				, eliminado = false;
				
			if(!elementId){
				elementId = ko.utils.createUID();
				$(element).attr('id', elementId);
			}
			
			userInput(null);
			
			var data = {
				'userInput': userInput,
				'error' : error
			};
			
			ko.utils.domData.set(element, bindingName + '.data', data );
			$child = $('<div>');
			$(element).append($child);
				
			GRecaptcha.getInstance(options).done(function(){
				if(!eliminado){
					recaptchaCreated = true;
					grecaptcha.render($child[0], { 
						"sitekey": public_key, 
						"theme": "clean", 
						"callback": self._onNewToken.bind(self, element),
						"expired-callback" : self._onExpiredToken.bind(self, element),
						"error-callback" : self._onError.bind(self, element)
					});					
				}
			});	
			
			
			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				eliminado = true;
				if( recaptchaCreated ){
					grecaptcha.reset($child[0]);
				}
			});

		}
	};
})(ko);




ko.bindingHandlers.areamask = {
	_list: [],
	
	_removeAreaMask: function( element ){
		var next
			, list = ko.bindingHandlers.areamask._list;
			
		if( $( element ).data('areamask') ){
			$(element).areamask('destroy');
		}
		
		ko.utils.arrayRemoveItem( list, element );
		next = $.arrayLast( list );
		if( next ){
			$( next ).areamask( $( next ).data('areamask.bindingHandler.options' ));
		}
		
	},
	
	init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			ko.bindingHandlers.areamask._removeAreaMask( element );
		});	
	},
	
	update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
		var value = valueAccessor()
			, options = $.extend({}, ko.unwrap( allBindingsAccessor().areamaskOptions ))
			, next
			, list = ko.bindingHandlers.areamask._list;
			
		if( ko.unwrap( value ) ){
			next = $.arrayLast( list );
			if( next != element ){
				if( next ) $(next).areamask( 'destroy' );
				$( element ).areamask( options );
				$( element ).data('areamask.bindingHandler.options', options );
				list.push( element );				
			}
		} else {
			ko.bindingHandlers.areamask._removeAreaMask( element );
		}
	}
};


ko.bindingHandlers.hasFocus = {
    init: function(element, valueAccessor) {
        $(element).on('focus', function() {
            var value = valueAccessor();
			if( ko.isWriteableObservable ( value ) ){
			    value(true);
			}
        });
		
        $(element).on('blur', function() {
            var value = valueAccessor();
			if( ko.isWriteableObservable ( value ) ){
	            value(false);
			}
        });
		
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			$(element).off('focus');
			$(element).off('blur');
		});
    },
    update: function(element, valueAccessor) {
        var value = valueAccessor();
        if (ko.unwrap(value))
            element.focus();
        else
            element.blur();
    }
};



/**
 * google adsense binding
 */

ko.bindingHandlers['adsbygoogle'] = {
	template: '<ins class="adsbygoogle" style="display:inline-block;width:{2};height:{3}" data-ad-client="{0}" data-ad-slot="{1}"></ins>',
	templateFormatAuto: '<ins class="adsbygoogle" style="display:block" data-ad-client="{0}" data-ad-slot="{1}" data-ad-format="auto"></ins>',

	insertScript: function( id ){
		var id = ko.utils.createUID()
			, $script
			, scriptId = 'gadsense_script_' + id
			, protocol = document.location.protocol; // (http:)

		if( id ){
			$script = $('#' + scriptId);
			if(!$script[0]){
				$script = $('<script>');
				$script.attr( 'type', 'text/javascript' );
				$script.attr( 'async', 'async' );
				$script.attr( 'defer', 'defer' );

				$script.attr( 'src', protocol + '//' + 'pagead2.googlesyndication.com/pagead/js/adsbygoogle.js' );					
				$script.attr( 'id', scriptId );
				$('head')[0].appendChild( $script[0] );
			}
		}
	},

	init: function(element, valueAccessor, allBindingsAccessor, viewModel) {								
		var self = ko.bindingHandlers['adsbygoogle']
			, options = $.extend( {
				width	: null,
				height	: null,
				client	: '',
				slot	: '',
				format	: null
			}, ko.unwrap ( valueAccessor() ) )
			, template = $.string.format( options.format == 'auto' ? self.templateFormatAuto : self.template )
			, width = $.isNumeric( ko.unwrap( options.width ) ) ? ko.unwrap( options.width ) + 'px' : parseFloat( ko.unwrap( options.width ) ) + 'px'
			, height = $.isNumeric( ko.unwrap (options.height) ) ? ko.unwrap( options.height ) + 'px' : parseFloat( ko.unwrap( options.height ) ) + 'px'
			, elementHtmlContent = template( ko.unwrap( options.client ), ko.unwrap( options.slot ), width, height );


		//console.debug('elementHtmlContent', valueAccessor() );
		$(element).html( elementHtmlContent );
		(window.adsbygoogle = window.adsbygoogle || []).push({});					
		self.insertScript();
		return { controlsDescendantBindings: true };
	},

	update: function(element, valueAccessor, allBindingsAccessor, viewModel) {			

	}
};

/**
 * 
 */

ko.bindingHandlers['ayudapopover'] = {
	template: 'ayuda-popover',
	
	reposition: function(element){
		setTimeout( function(){
			var popover = $(element).data('popover');
			if(popover){
				$(element).popover('reposition');
			}			
		}, 10);
	},

	init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {	
		 var ayuda = ko.unwrap( valueAccessor() )
			, cargado = ko.observable( false )
			, areamaskAllBindingsAccessor = function(){
				return { areaMaskOptions: {highlight: true} }
			}
			, popoverAllBindingsAccessor = function(){
				var template = allBindingsAccessor().ayudapopoverOptions.template || ko.bindingHandlers['ayudapopover'].template
					, title = ayuda && ko.unwrap( ayuda.titulo )
					, placement = allBindingsAccessor().ayudapopoverOptions.placement
					, gestorAyuda = bindingContext.$root.ayuda
					, pasos = gestorAyuda.ordenEnTipoFormateado( ayuda );
					
				//console.debug('gestorAyuda', gestorAyuda);
					
				if( gestorAyuda ){
					if( gestorAyuda.totalPorTipo( ayuda && ayuda.tipo() ) > 1 ) title = '<span class="dimmed">' + pasos + '</span> ' + title + '<button class="close" data-action="ayuda-establecer-leidas-por-tipo">&times;</button>';
				}

					
				return {
					popoverOptions: {
						template: {
							name: template,
							templateUrl: '/tpl/back/ayuda/',
							afterRender: ko.bindingHandlers['ayudapopover'].reposition.bind(this, element)
						},
						container: 'body',
						placement: placement,
						title: title,
						data: ayuda
					}
				}
			 };
		cargado.subscribe( function(){
			ko.bindingHandlers['ayudapopover'].reposition( element );
		});
		
		
		ko.computed({
			read: function(){
				var reposition = ko.unwrap(allBindingsAccessor().ayudapopoverOptions.reposition);
				if( reposition ) ko.bindingHandlers['ayudapopover'].reposition(element);
			},
			disposeWhenNodeIsRemoved: element

		});
		ko.bindingHandlers.areamask.init(element, valueAccessor, areamaskAllBindingsAccessor, viewModel, bindingContext);
		 ko.bindingHandlers.popover.init(element, valueAccessor, popoverAllBindingsAccessor, viewModel, bindingContext.extend({cargado: cargado}));
		 
	},
	
	update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {	
		 var ayuda = ko.unwrap( valueAccessor() )
			, cargado = ko.observable( false )
			, areamaskAllBindingsAccessor = function(){
				return { areaMaskOptions: {highlight: true} }
			}
			, popoverAllBindingsAccessor = function(){
				var template = allBindingsAccessor().ayudapopoverOptions.template || ko.bindingHandlers['ayudapopover'].template
					, title = ayuda && ko.unwrap( ayuda.titulo )
					, placement = allBindingsAccessor().ayudapopoverOptions.placement
					, gestorAyuda = bindingContext.$root.ayuda
					, pasos = gestorAyuda.ordenEnTipoFormateado( ayuda );
					
				//console.debug('gestorAyuda', gestorAyuda);
					
				if( gestorAyuda ){
					if( gestorAyuda.totalPorTipo( ayuda && ayuda.tipo() ) > 1 ) title = '<span class="dimmed">' + pasos + '</span> ' + title + '<button class="close" data-action="ayuda-establecer-leidas-por-tipo">&times;</button>';
				}
					
				return { popoverOptions: { template: { name: template, templateUrl: '/tpl/back/ayuda/', afterRender: ko.bindingHandlers['ayudapopover'].reposition.bind(this, element) }, container: 'body', placement: placement, title: title, data: ayuda } }
			 };
		cargado.subscribe( function(){
			ko.bindingHandlers['ayudapopover'].reposition( element );
		});
		
		 ko.bindingHandlers.areamask.update(element, valueAccessor, areamaskAllBindingsAccessor, viewModel, bindingContext);
		 ko.bindingHandlers.popover.update(element, valueAccessor, popoverAllBindingsAccessor, viewModel, bindingContext.extend({cargado: cargado}));
	}
}


;(function(ko){
	var bindingName = 'scaleToParent';
	ko.bindingHandlers[ bindingName ] = {
		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, bindingId = Math.random();
			////////////////////////////////////////////////////////////////////////
			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				var scaleToParent = $(element).scaleToParent('instance');
				scaleToParent && scaleToParent.destroy();
				//$(element).scaleToParent('destroy');
			});	
		},

		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var value = ko.unwrap( valueAccessor() )
				, options = $.extend({}, ko.unwrap( allBindings()[bindingName + 'Options'] ))
				, scaleToParent = $(element).scaleToParent('instance');
			
			if( value ){
				$(element).scaleToParent( options );
			} else {
				scaleToParent && scaleToParent.destroy();
			}
		}

	};
})( ko );

;(function(ko){
	var bindingName = 'scale';
	ko.bindingHandlers[ bindingName ] = {
		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, bindingId = Math.random();
			////////////////////////////////////////////////////////////////////////
			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				var scale = $(element).scale('instance');
				scale&& scale.destroy();
			});
		},

		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var value = ko.unwrap( valueAccessor() )
				, options = $.extend({}, ko.unwrap( allBindings()[bindingName + 'Options'] ))
				, scale= $(element).scale('instance');

			$.each( options, function( key, value ){
				options[ key ] = ko.unwrap( value );
			});

			if( value ){
				$(element).scale( options );
			} else {
				scale && scale.destroy();
			}
		}

	};
})( ko );



(function (ko) {
	var bindingName = 'textfill';
	var domdataName = '_ko_' + bindingName;

	var defaultOptions = {changeLineHeight : false};

	ko.bindingHandlers[ bindingName ] = {

		_update: function( element, options ){
			$(element).textfill && $(element).textfill( options );
		},

		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, value = ko.unwrap( valueAccessor() )
				, bindingId = Math.random()
				, resizeEventName = 'resize.' + bindingName + '.' + bindingId
				, slideEventName = 'slid.' + bindingName + '.' + bindingId
				, events = [resizeEventName, slideEventName].join(" ")
				, options = $.extend(defaultOptions, ko.unwrap(allBindings()[bindingName + 'Options']));
			/*
			if( value ) {
				var _updateTimeout = setTimeout( function(){
					self._update( element, options );
				}, 100);
			}

			$(window).on( events, function(){
				clearTimeout( _updateTimeout );
				_updateTimeout = setTimeout( function(){
					self._update( element, options );
				}, 100);
			});
			*/


			////////////////////////////////////////////////////////////////////////
			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				self._remove( element );
			});
		},

		_remove: function( element ){
			if( ko.utils.domData.get(element, domdataName )){
				ko.utils.domData.set(element, domdataName, null );
				var events = ko.utils.domData.get(element, domdataName+'.events');
				var _updateTimeout = ko.utils.domData.get(element, domdataName + '.timeout');

				$(window).off( events );
				clearTimeout( _updateTimeout );
			}

		},

		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, value = ko.unwrap( valueAccessor() )
				, bindingId = Math.random()
				, bindingNameId = bindingName + '.' + bindingId
				, resizeEventName = 'resize.' + bindingNameId
				, slideEventName = 'slid.' + bindingNameId
				, events = [resizeEventName, slideEventName].join(" ")
				, options = $.extend(defaultOptions, ko.unwrap(allBindings()[bindingName + 'Options']));
			if( value ){
				if( !ko.utils.domData.get(element, domdataName )){
					ko.utils.domData.set(element, domdataName, true );
					ko.utils.domData.set(element, domdataName+'.events', events);

					$(window).on( events, function(){
						var _updateTimeout = ko.utils.domData.get(element, domdataName + '.timeout');
						clearTimeout( _updateTimeout );
						_updateTimeout = setTimeout( function(){
							self._update( element, options );
						}, 100);
						ko.utils.domData.set(element, domdataName + '.timeout', _updateTimeout );
					});

					var _updateTimeout = setTimeout( function(){
						self._update( element, options );
					}, 100);
					ko.utils.domData.set(element, domdataName + '.timeout', _updateTimeout );
				}

				/*

				$(window).on( events, function(){
					clearTimeout( _updateTimeout );
					_updateTimeout = setTimeout( function(){
						self._update( element, options );
					}, 100);
				});

				self._update( element, options );
				*/
			} else {
				self._remove( element );
			}
		}
	};

	var self = ko.bindingHandlers[ bindingName ];


})( ko );


;(function(ko){
	var bindingName = 'hammerMenu';
	var self = ko.bindingHandlers[ bindingName ] = {
		startPosition: null,
		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var isOpen = valueAccessor()
				, options = $.extend({}, ko.unwrap( allBindings()[bindingName + 'Options'] ));

			self._create(element);

			isOpen.subscribe(function(isOpen){
				var sidenav = $(element);

				sidenav.toggleClass('md-opened', isOpen);
				sidenav.toggleClass('md-closed', !isOpen);

				self._toggleBackdrop(element, isOpen);

			});

			isOpen.notifySubscribers(isOpen());

			self._init(element, valueAccessor);

			////////////////////////////////////////////////////////////////////////
			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				var sidenav = $(element),
					sidenavContainer = sidenav.parent(),
					swipe = sidenav.next();

				var sidenavData = sidenav.data( 'hammer' );
				sidenavData && sidenavData.destroy();

				var swipeData = swipe.data( 'hammer' );
				swipeData && swipeData.destroy();

				sidenavContainer.add(sidenav).off('click');
			});

		},

		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {

		},

		_create: function( element ) {
			var sidenav = $(element).wrap( $('<div class="sidenav-container"></div>') ),
				$sidenavContainer = sidenav.parent(),
				backdrop = $('<md-backdrop class="md-sidenav-backdrop md-opaque"></md-backdrop>'),
				swipe = $('<span class="sidenav-swipe"></span>');

			backdrop.prependTo( $sidenavContainer );
			swipe.appendTo( $sidenavContainer );

		},

		_init: function( element, valueAccessor ) {
			var isOpen = valueAccessor(),
				sidenav = $(element),
				backdrop = sidenav.prev(),
				swipe = sidenav.next(),
				sidenavContainer = sidenav.parent();

			sidenav.hammer();
			swipe.hammer();

			backdrop.on('click', function (ev) {
				isOpen( false );
			});

			sidenavContainer.on('click', '.close-external-link', function (ev) {
				isOpen( false );
			});

			sidenav.on('panstart', function(ev){
				ev.preventDefault();
				self._toggleOverlay(element, true);
			});

			sidenav.add(swipe).on('panleft panright', function(ev){
				ev.preventDefault();
				self._onPan(ev, element, valueAccessor);
			});

			sidenav.add(swipe).on('panend', function(ev){
				ev.preventDefault();

				self._toggleOverlay(element, false);

				self._onPanEnd(ev, element, valueAccessor)
					.then(function(value){
						isOpen( value );
					});
			});

		},

		_getWrapperPosition: function($target) {
			var transformCss = $target.css('transform'),
				transform = {e: 0, f: 0},
				reMatrix = /matrix\(\s*-?\d+(?:\.\d+)?\s*,\s*-?\d+(?:\.\d+)?\s*,\s*-?\d+(?:\.\d+)?\s*,\s*-?\d+(?:\.\d+)?\s*,\s*(-?\d+(?:\.\d+)?)\s*,\s*(-?\d+(?:\.\d+)?)\s*\)/,
				match;

			if (transformCss) {
				match = transformCss.match(reMatrix);
				if (match) {
					transform.e = parseInt(match[1], 10);
					transform.f = parseInt(match[2], 10);
				}
			}

			return transform.e;
		},

		_toggleBackdrop: function(element, open){
			var backdrop = $(element).prev(),
				isOpen = ko.unwrap(open);

				backdrop.toggle(isOpen);
		},

		_toggleOverlay: function(element, value){
			var overlay = $(element).find('.sidenav-overlay');

			overlay.toggle(value);
		},

		_onPan: function(ev, element, valueAccessor){
			var sidenav = $(element),
				swipe = $(element).next(),
				sidenavPosition = self._getWrapperPosition(sidenav),
				startPosition = ko.bindingHandlers[bindingName].startPosition,
				isOpen = valueAccessor(),
				deltaX = ev.gesture.deltaX,
				eventType = ev.gesture.eventType,
				distance;

			if(!isOpen()) self._toggleBackdrop(element, true);


			if( !startPosition ) startPosition = ko.bindingHandlers[bindingName].startPosition = sidenavPosition;

			distance = Math.round(startPosition + deltaX);

			if( distance > 0 || eventType == 8 ) return;

			sidenav.css({
				'transition'        : 'none',
				'-webkit-transition': 'none',
				'transform'         : 'translateX('+distance+'px)',
				'-webkit-transform' : 'translateX('+distance+'px)',
			});

			swipe.css({
				'transform'         : 'translateX('+deltaX+'px)',
				'-webkit-transform' : 'translateX('+deltaX+'px)'
			});

		},

		_onPanEnd: function(ev, element, valueAccessor){
			var sidenav = $(element),
				swipe = $(element).next(),
				def = $.Deferred(),
				distance = parseInt(ev.gesture.distance),
				isOpen = valueAccessor();

			sidenav.css({
				'transition'        : '',
				'-webkit-transition': '',
				'transform'         : '',
				'-webkit-transform' : ''
			});

			swipe.css({
				'transform'         : '',
				'-webkit-transform' : ''
			});

			ko.bindingHandlers[bindingName].startPosition = null;

			if ( distance > (sidenav.innerWidth() / 4) ){
				if( Hammer.DIRECTION_LEFT == ev.gesture.direction && isOpen() ){
					def.resolve(false);
				} else if( Hammer.DIRECTION_RIGHT == ev.gesture.direction && !isOpen() ){
					def.resolve(true);
				} else {
					if( !isOpen() ) self._toggleBackdrop(element, false);
				}
			} else {
				if( !isOpen() ) self._toggleBackdrop(element, false);
			}

			return def;
		}

	};
})( ko );

/**
 *
 *
 */
(function( ko ) {
	var bindingName = 'fontsize';
	var self = ko.bindingHandlers[bindingName] = {

		_refresh: function( element ){
			var data = ko.utils.domData.get(element, bindingName + '.data');
			if( data && data.fontSize !== false ){
				$(element).css( {
				'fontSize'			: data.fontSize || '',
					'letterSpacing'	: '',
					'wordBreak'		: ''
				});

				var fontSize 		= data.fontSize || $(element).css('fontSize');
				var letterSpacing 	= data.letterSpacing || $(element).css('letterSpacing');

				// force reflow
				/*
				element.offsetHeight;
				$(element).parent()[0].offsetHeight;
				*/
				var parentInnerWidth = $(element).parent().innerWidth();
				var elementScrollWidth = $(element).scrollWidth();
				if( Math.abs( parentInnerWidth - elementScrollWidth ) > 2 ){
					var prop = parentInnerWidth / elementScrollWidth;
					if( prop < 1 ){
						var newFontSize = ( parseFloat( fontSize ) * prop );
						var newLetterSpacing = ( parseFloat( letterSpacing ) * prop );
						var wordBreak = '';
						if( newFontSize < 14 ){
							newFontSize = 14;
							wordBreak = 'break-all';
						}

						$(element).css({
							'fontSize'		: newFontSize + $.string.getNumberValueUnit( fontSize ),
							'wordBreak'		: wordBreak,
							'letterSpacing'	: letterSpacing ? newLetterSpacing + 'px' : ''
						})
					}
				}
			}
		},

		_requestRefresh: function( element ){
			var data = ko.utils.domData.get(element, bindingName + '.data');
			if( data ){
				if( !data.rAF ){
					data.rAF = requestAnimationFrame( function(){
						self._refresh( element );
						data.rAF = null;
					});
				}
			}
		},

		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var value = ko.unwrap(valueAccessor())
				, uid = ko.utils.createUID()
				, options = $.extend({}, ko.unwrap(allBindings()[bindingName + 'Options']))
				, data = {
					'uid'		: uid
				};

			ko.utils.domData.set(element, bindingName + '.data', data);

			/*
			$(window).on('resize.' + bindingName, $.throttle( 250, self._refresh.bind( self, element ) ) );
			$(element).resize( self._refresh.bind( self, element ) );
			$(element).parent().resize( self._refresh.bind( self, element ) );
			*/
			$(window).on('resize.' + uid + '.' + bindingName, $.throttle( 250, self._requestRefresh.bind( self, element ) ) );
			$(window).on('slide.' + uid + '.' + bindingName, $.throttle( 250, self._requestRefresh.bind( self, element ) ) );
			$(window).on('slid.' + uid + '.' + bindingName, $.throttle( 250, self._requestRefresh.bind( self, element ) ) );

			//$(element).resize( self._requestRefresh.bind(self, element ) );
			//$(element).parent().resize( self._requestRefresh.bind(self, element ) );
			////////////////////////////////////////////////////////////////////////
			ko.utils.domNodeDisposal.addDisposeCallback(element, self._destroy.bind(self, element));
		},

		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var value = ko.unwrap(valueAccessor())
				, options = $.extend({}, ko.unwrap(allBindings()[bindingName + 'Options']));

			var data = ko.utils.domData.get(element, bindingName + '.data');

			data.fontSize = value;

			self._requestRefresh(element);
		},

		_destroy: function (element) {
			var data = ko.utils.domData.get(element, bindingName + '.data');
			data.destroyed = true;
			data.rAF && cancelAnimationFrame( data.rAF );
			$(window).off('resize.' + data.uid + '.' + bindingName );
			$(window).off('slide.' + data.uid + '.' + bindingName );
			$(window).off('slid.' + data.uid + '.' + bindingName );
			/*
			$(window).off('resize.' + bindingName );
			$(element).removeResize();
			*/
			//$(element).removeResize();
			//$(element).parent().removeResize();
		}
	}
})(ko);

(function(ko){
	var _important = '!important';
	ko.bindingHandlers['style'] = {
		'update': function (element, valueAccessor) {
			var value = ko.utils.unwrapObservable(valueAccessor() || {});
			$.each(value, function(styleName, styleValue) {
				var addImportant = false;
				styleValue = ko.utils.unwrapObservable(styleValue);
				if(typeof styleValue == 'string' ){
					addImportant = styleValue.indexOf(_important ) != -1;
					if( addImportant ){
						styleValue = $.trim( styleValue.replace(_important, '') );
					}
				}
				element.style[styleName] = styleValue || ""; // Empty string removes the value, whereas null/undefined have no effect
				if( addImportant ) $(element).important(styleName);
			});
		}
	};
})(ko);


(function(ko) {
	var emojioneOptions = {
		callback: function(icon, options) {
			//https://cdnjs.cloudflare.com/ajax/libs/emojione/2.1.0/assets/svg/1f622.svg
			var base = 'https://cdnjs.cloudflare.com/ajax/libs/emojione/2.1.0/assets/svg/';
			var asset = icon;
			if(options.variant && variant !='\uFE0F' ){
				asset += '-' + options.variant;
			}
			return base+asset+'.svg';
		}
	}

	var defaultOptions = {
	};

	if( window.Modernizr && Modernizr.svgasimg ){
		defaultOptions = $.extend(defaultOptions, {
			folder: 'svg',
			ext: '.svg'
		});
	}

	var initialized = false;

	var nullUnicode;
	function isValidUnicode( value ) {
		if(!nullUnicode) nullUnicode = twemoji.convert.fromCodePoint('');
		return value != nullUnicode;
	}

	function isShortname( value ){
		return /:[\w-]+:/.test(value)
	}

	///////////////////
	EmojiLibrary = $.Class({
		getInstance: function( library ){
			if( library ){
				return this[$.string.capitalize( library ) ].getInstance();
			} else {
				if( !this._instance){
					this._instance = new this();
				}
				return this._instance;
			}
		},

		prototype: {
			isShortname: function( value ){
				return /:[\w-]+:/.test(value)
			},

			interpret: function( value ){
				var unicode = value
					, codePoint = value
					, shortname = value;

				if( isShortname( value )){
					unicode = emojione.shortnameToUnicode( value );
					codePoint = emojione.emojioneList[ value ];
					if($.isArray(codePoint)){
						codePoint = $.arrayLast( codePoint );
					}
				} else {
					var unicodeFromCodePoint = twemoji.convert.fromCodePoint( value );
					if(isValidUnicode( unicodeFromCodePoint ) ){
						unicode = unicodeFromCodePoint;
					} else {
						codePoint = twemoji.convert.toCodePoint( value );
					}
				}
				return { unicode: unicode, codePoint: codePoint, shortname: shortname };

			},

			getUrlFromValue: function( value, format, size ){
				var interpreted = this.interpret( value );
				return this.getUrlFromCodePoint( interpreted.codePoint, format, size );
			},

			getUrlFromCodePoint: function( codePoint, format, size){
				return '';
			}
		}
	});

	EmojiLibrary.Twemoji = EmojiLibrary.extend({
		interpret: function( value ){
			var result = this._parent.apply( this, arguments );

			var	codePoint = twemoji.convert.toCodePoint( result.unicode );
			if($.string.endsWith( codePoint, '-fe0f' )) codePoint = $.string.trimFromLast( codePoint , '-fe0f'); // fix para twemoji
			if($.string.endsWith( codePoint, '-fe0f-20e3' )) codePoint = $.string.replace( codePoint , '-fe0f-20e3', '-20e3'); // fix para twemoji

			result.codePoint = codePoint;
			return result;
		},

		getUrlFromCodePoint: function( codePoint, format, size ){
			var format = format || 'svg'
				, result = '';

			var invalidCodePoints = ['a9', 'ae', '2122'];
			if($.inArray( codePoint, invalidCodePoints ) == -1) {
				switch (format) {
					case 'svg':
						result = 'https://abs.twimg.com/emoji/v2/svg/' + codePoint + '.svg';
						break;
					case 'png':
						result = 'https://abs.twimg.com/emoji/v2/72x72/' + codePoint + '.png';
						break;
				}
			}
			return result;
		}
	});


	EmojiLibrary.Emojione = EmojiLibrary.extend({
		getUrlFromCodePoint: function( codePoint, format, size ){
			var format = format || 'svg'
				, result = ''
				, basePath = 'https://cdnjs.cloudflare.com/ajax/libs/emojione/2.1.0/assets'
				, basePath = '/components/emojione-master/assets';

			switch (format) {
				case 'svg':
					result = basePath + '/svg/' + codePoint + '.svg';
					break;
				case 'png':
					result = basePath + '/png_512x512/' + codePoint + '.png';
					break;
			}
			return result;
		}
	});


	EmojiLibrary.Emojionebw = EmojiLibrary.extend({
		getUrlFromCodePoint: function( codePoint, format, size ){
			var format = format || 'svg'
				, result = ''
				, basePath = '/components/e1-svg-bw/';

			switch (format) {
				case 'svg':
					result = basePath + codePoint + '.svg';
					break;
			}
			return result;
		}
	});

	EmojiLibrary.Noto = EmojiLibrary.extend({
		getUrlFromCodePoint: function( codePoint, format, size ){
			var format = format || 'svg'
				, result = '';

			switch (format) {
				case 'svg':
					result = '/components/noto-emoji-master/svg/emoji_u' + codePoint + '.svg'
					break;
				case 'png':
					result = '/components/noto-emoji-master/png/128/emoji_u' + codePoint + '.png'
					break;
			}
			return result;
		}
	});

	EmojiLibrary.Minemoji = EmojiLibrary.extend({
		getUrlFromCodePoint: function( codePoint, format, size ){
			var format = format || 'svg'
				, result = '';

			switch (format) {
				case 'svg':
					result = '/components/minEmoji-master/jMinEmoji-SVG/img/svg/' + codePoint + '.svg'
					result = '/components/minEmoji-master/minEmoji_iOS8/img/' + codePoint + '.png'
					break;
				case 'png':
					result = '/components/minEmoji-master/minEmoji_iOS8/img/' + codePoint + '.png'
					break;
			}
			return result;
		}
	});

	///////////////////

	(function(bindingName){
		var self = ko.bindingHandlers[bindingName] = {
			loaded	: ko.observable( false ),

			_insertScript	: function(){
				if(!initialized ){
					$.getScript('//cdn.jsdelivr.net/emojione/2.1.0/lib/js/emojione.min.js')
						.then(function(){
							return $.getScript('//twemoji.maxcdn.com/twemoji.min.js');
						})
						.done(function(){
							self.loaded( true );
							self.resolve(true);
						});

					var $style = $('<style>');
					$style.html('img.emoji {\
				height: 1em;}');
					$('head').append($style);
				}
				initialized = true;
			},

			'init' : function (element, valueAccessor, allBindings, viewModel, bindingContext) {
				self._insertScript();
				var data = {};
				ko.utils.domData.set(element, bindingName + '.data', data );
				ko.utils.domNodeDisposal.addDisposeCallback(element, self._destroy.bind(self, element));
				self.update.apply(self, arguments);
			},

			'update' : function (element, valueAccessor, allBindings, viewModel, bindingContext) {
				var value = ko.unwrap(valueAccessor())
					, uid = ko.utils.createUID()
					, options = $.extend({}, defaultOptions, ko.unwrap(allBindings()[bindingName + 'Options']))
					, data = ko.utils.domData.get(element, bindingName + '.data');


				var value = $.string.encodeHTML(value);
				if(!self.loaded()){
					//ko.bindingHandlers.html.update( element, valueAccessor, allBindings, viewModel, bindingContext );
				}
				self.done( function(){
					if(!data.destroyed){
						var interpreted = EmojiLibrary.getInstance( options.library || 'emojione').interpret( value );
						var format = window.Modernizr && Modernizr.svgasimg ? 'svg' : 'png';

						var content = self._createContent( options.library, interpreted, format );
						$(content).on('error', function(){
							if( options.library != 'emojione' ){
								var content = self._createContent( 'emojione', interpreted, format );
								$(element).html( content );
							}
						})
						$(element).html( content );

					}
				});
			},

			_createContent: function( library, interpreted, format ){
				var src = EmojiLibrary.getInstance( library || 'emojione').getUrlFromCodePoint( interpreted.codePoint, format );
				var result;
				if( src ){
					value = '<img class="emoji" draggable="false" alt="' + interpreted.unicode + '" src="' + src + '"/>';
					result = $(value);
				} else {
					result = $('<span>').text( interpreted.unicode );
				}
				return result;
			},

			_destroy: function( element ){
				var data = ko.utils.domData.get(element, bindingName + '.data');
				data.destroyed = true;
			}
		}

		self._deferred = new $.Deferred();
		$.extend(self, self._deferred);
	})('emoji');


	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	(function(bindingName){
		var self = ko.bindingHandlers[bindingName] = {
			'init' : function (element, valueAccessor, allBindings, viewModel, bindingContext) {
				ko.bindingHandlers['emoji']._insertScript();
				var data = {};
				ko.utils.domData.set(element, bindingName + '.data', data );
				ko.utils.domNodeDisposal.addDisposeCallback(element, self._destroy.bind(self, element));
				self.update.apply(self, arguments);
			},

			'update' : function (element, valueAccessor, allBindings, viewModel, bindingContext) {
				var value = ko.unwrap(valueAccessor())
					, uid = ko.utils.createUID()
					, options = $.extend(defaultOptions, ko.unwrap(allBindings()[bindingName + 'Options']))
					, data = ko.utils.domData.get(element, bindingName + '.data');


				var value = $.string.encodeHTML(value);
				if(!ko.bindingHandlers['emoji'].loaded()){
					ko.bindingHandlers.html.update( element, valueAccessor, allBindings, viewModel, bindingContext );
				}
				ko.bindingHandlers['emoji'].done( function(){
					if(!data.destroyed){
						if(window.twemoji){
							if( options.library == 'emojione' ){
								options = $.extend({}, emojioneOptions, options );
							}
							value = twemoji.parse(value, options );
						}

						valueAccessor = function(){
							return value;
						}
						ko.bindingHandlers.html.update( element, valueAccessor, allBindings, viewModel, bindingContext );
					}
				});
			},

			_destroy: function( element ){
				var data = ko.utils.domData.get(element, bindingName + '.data');
				data.destroyed = true;
			}
		}
	})('emojiText');


})(ko);



/** FIX css binding handler
 * con este fix las clases no se colocan y sacan todo el tiempo, sino cuando cambian. Esto sirve en particular
 * cuando el binding se usa junto a otro binding que se modifica constantemente, como por ejemplo al modificar el background
 * de una caja por parallax.
 * En knockout 3 no debera ser necesario
 ------------------------------ */
(function(ko){							
	if( ko.version < "3.0.0" && ko.utils.objectForEach){
		var classesWrittenByBindingKey = '__ko__cssValue';
		ko.bindingHandlers['css'] = {
			'update': function (element, valueAccessor) {
				var value = ko.utils.unwrapObservable(valueAccessor());
				if (typeof value == "object") {
					ko.utils.objectForEach(value, function(className, shouldHaveClass) {
						shouldHaveClass = ko.utils.unwrapObservable(shouldHaveClass);
						ko.utils.toggleDomNodeCssClass(element, className, shouldHaveClass);
					});
				} else {
					value = $.trim( String(value || '') ); // Make sure we don't try to store or set a non-string value
					if( element.className != value ){
						//console.debug('cambi CSS de', element.className, 'a', value);
						ko.utils.toggleDomNodeCssClass(element, element[classesWrittenByBindingKey], false);
						element[classesWrittenByBindingKey] = value;
						ko.utils.toggleDomNodeCssClass(element, value, true);
					}
				}
			}
		};
	}
}(ko));


/** EXTENDERS
------------------------ */
$.extend(ko.extenders, {
	/**
	 * only changes values when are different from the current
	 * @param target
	 * @return {*}
	 */
	preserveChange: function(target){
		var c = ko.observable();
		target.subscribe(function(newValue){
			var oldValue  = c.peek();
			//console.debug( 'old:', oldValue && oldValue.toJS(), 'new:', newValue && newValue.toJS(), 'equals:', oldValue == newValue );
			if( oldValue != newValue) c(newValue);
		});
		c(target());
		
		return ko.computed({
			'read': function(){
				return c();
			},
			'write': function(value){
				if(value != target.peek()){
					target(value);
				}
			}
		});
	},


	/**
	 * write the value as html decoded.
	 * @param target
	 * @return {*}
	 */
	decodeHTML: function(target) {
		var result = ko.computed({
			read: target,  //always return the original observables value
			write: function(newValue) {
				var current = target(),
					valueToWrite = current ? $('<textarea/>').html(current).val() : current;
	 
				//only write if it changed
				if (valueToWrite !== current) {
					target(valueToWrite);
				} else {
					if (newValue != current) {
						target.notifySubscribers(valueToWrite);
					}
				}
			}
		});
		result(target());
		return result;
	},

	/**
	 * trim value to count length;
	 * @param target
	 * @param count
	 * @return {*}
	 */
	length: function(target, count){
		var result = ko.computed({
			read: target,
			write: function(newValue){
				var current = target(),
				valueToWrite = newValue.substr(0,count);
				if( valueToWrite !== current ){
					target( valueToWrite );
				} else {
					if( newValue != current ){
						target.notifySubscribers( valueToWrite );
					}
				}
			}
		});
		result( target() );
		return result;
	},

	decay: function( target, options ){
		var options = $.extend({
				duration: 1000
			}, options)
			, _obs = ko.observable( target() )
			, timeoutHandle
			, shouldDecayFn = function( value ){
				return value;
			}
			, result;

		options.shouldDecayFn = options.shouldDecayFn || shouldDecayFn;

		target.subscribe( function( value ){
			clearTimeout( timeoutHandle );
			if( !shouldDecayFn( value ) ){
				_obs( value );
			} else {
				timeoutHandle = setTimeout( function(){
					_obs( value );
				}, options.duration );
			}
		});

		result = ko.computed({
			read : _obs,
			write   : function( value ){
				clearTimeout( timeoutHandle );
				if( !shouldDecayFn( value ) ){
					target( value );
				} else {
					timeoutHandle = setTimeout( function(){
						target( value );
					}, options.duration );
				}

			}
		});


		/*
		result = ko.computed({
			read: function(){
				return target();
			},
			write: function( value ){
				clearTimeout( timeoutHandle );
				if( !shouldDecayFn( value ) ){
					target( value );
				} else {
					timeoutHandle = setTimeout( function(){
						target( value );
					}, options.duration );
				}
			}
		});
		*/

		return result;
	}
});

/**
 * devuelve un computedo en el que se escribe slo el texto de un cdigo HTML, no los tags.
 * @param target
 * @return {*}
 */
ko.extenders.stripHTML = function(target) {
	var result = ko.computed({
		read: target,  //always return the original observables value
		write: function(newValue) {
			var current = target(),
				valueToWrite = current ? $.string.decodeHTML(current) : current;
 
			//only write if it changed
			if (valueToWrite !== current) {
				target(valueToWrite);
			} else {
				if (newValue != current) {
					target.notifySubscribers(valueToWrite);
				}
			}
		}
	});
	result(target());
 
	return result;
};

/**
 * devuelve un computed forzado a que el valor sea nmero.
 * @param target
 * @return {*}
 */
ko.extenders.toNumber = function(target, options) {
	//create a writeable computed observable to intercept writes to our observable
	var options = $.extend({
		'default': null
	}, options);
	
	var result = ko.computed({
		read: target,  //always return the original observables value
		write: function(newValue) {
			target(Number(newValue) || options['default']);
		}
	});
	result(target());
	return result;
};


ko.extenders.toFloat = function(target, options) {
	//create a writeable computed observable to intercept writes to our observable
	var options = $.extend({
		'default': null
	}, options);
	
	var result = ko.computed({
		read: target,  //always return the original observables value
		write: function(newValue) {
			var current = target(),
				valueToWrite = parseFloat(newValue);
			if(isNaN(valueToWrite)) valueToWrite = options['default'];
			
			if(valueToWrite !== current){
				target(valueToWrite);
			} else {
				if(newValue != current){
					target.notifySubscribers(valueToWrite);
				}
			}
		}
	});
	result(target());
	return result;
};



ko.extenders.toInteger = function(target, options) {
	//create a writeable computed observable to intercept writes to our observable
	var options = $.extend({
		'default'	: null,
		'min'		: null,
		'max'		: null
	}, options);
	
	var result = ko.computed({
		read: target,  //always return the original observables value
		write: function(newValue) {
			var current = target(),
				valueToWrite = parseInt(newValue);
			if (isNaN(valueToWrite)) valueToWrite = options['default'];
			else {
				if( options.min !== null ) valueToWrite = Math.max( ko.unwrap( options.min ), valueToWrite );
				if( options.max !== null ) valueToWrite = Math.min( ko.unwrap( options.max ), valueToWrite );
			}
				
			if(valueToWrite !== current){
				target(valueToWrite);
			} else {
				if(newValue != current){
					target.notifySubscribers(valueToWrite);
				}
			}
		}
	});
	
	ko.computed( function(){ 
		return ko.unwrap( options.min) + ko.unwrap( options.max );
	}).subscribe( function(){
		result( result() );
	});
	
	result(target());
	return result;
};

ko.extenders.toFixed = function(target, decimals) {
	//create a writeable computed observable to intercept writes to our observable
	var decimals = decimals || 2;
	
	var result = ko.computed({
		read: target,  //always return the original observables value
		write: function(newValue) {
			var current = target(),
				valueToWrite = parseFloat(newValue).toFixed(decimals);			
			
			if(valueToWrite !== current){
				target(valueToWrite);
			} else {
				if(newValue != current){
					target.notifySubscribers(valueToWrite);
				}
			}
		}
	});
	
	result(target());
	return result;
};

ko.extenders.asFixed = function(target, decimals) {
	var decimals = ko.utils.unwrapObservable(decimals) || 2;
	
	return ko.computed(function(){
		return parseFloat(target()).toFixed(decimals);
	});
};


ko.extenders.toAbs = function(target, options) {
	var result = ko.computed({
		read: target,  //always return the original observables value
		write: function(newValue) {
			var current = target(),
				valueToWrite = Math.abs(newValue);
			
			if(valueToWrite !== current){
				target(valueToWrite);
			} else {
				if(newValue != current){
					target.notifySubscribers(valueToWrite);
				}
			}
		}
	});
	
	result(target());
	return result;
};

ko.extenders.toLowerCase = function(target, options) {
	var result = ko.computed({
		read: target,  //always return the original observables value
		write: function(newValue) {
			var current = target(),
				valueToWrite = newValue && String( newValue ).toLowerCase();
			
			if(valueToWrite !== current){
				target(valueToWrite);
			} else {
				if(newValue != current){
					target.notifySubscribers(valueToWrite);
				}
			}
		}
	});
	
	result(target());
	return result;
};

ko.extenders.asLowerCase = function(target, options) {	
	return ko.computed(function(){
		var value = target()
			, originalValue = value;
			
		if ( value ) {
			value = String( value ).toLowerCase();
			if( value != originalValue ){
				target( value );				
			}
		}
	});
};



ko.extenders["booleanValue"] = function (target) {
    target.formattedValue = ko.computed({
        read: function () {
            if (target() === true) return "true";
            else if (target() === false) return "false";
        },
        write: function (newValue) {
            if (newValue) {
                if (newValue === "false") target(false);
                else if (newValue === "true") target(true);
            }
        }
    });

    target.formattedValue(target());
    return target;
};


ko.extenders.asUnit = function( target, options ){

	options = $.extend( {
		defaultUnit	: 'px',
		units		: ['%', 'px', 'vw', 'vh', 'pw', 'ph']
	}, options );

	if( !target.value || !target.unit ){

		function getValue( valueAndUnit ){
			var result = valueAndUnit;
			if( valueAndUnit !== null ){
				var result = parseFloat( result );
				if ( isNaN( result ) ) result = null;
			}
			return result;
		}

		function getUnit( valueAndUnit ){
			var result = ko.utils.arrayFirst( options.units, function( unit ){
				if($.string.endsWith( valueAndUnit , unit ) ){
					return true;
				}
			});
			return result;
		}

		function createValueAndUnit( value, unit ){
			var valueAndUnit = null;
			if( !isNaN( value ) && value !== null && value !== '' && value !== undefined ) {
				valueAndUnit = value + unit;
			}
			return valueAndUnit;
		}


		target.value = ko.computed({
			read: function(){
				var value = getValue( target() );
				return value;
			},

			write: function( newValue ){
				var value = getValue( newValue )
					, unit	= getUnit( newValue )
					, valueAndUnit = null;

				if( unit === null ){
					unit = target.unit();
				}

				valueAndUnit = createValueAndUnit( value, unit );
				target( valueAndUnit );

				if( target.value() != newValue ){
					target.value.notifySubscribers( value );
				}


			}
		});

		target.unit = ko.computed({
			read: function(){
				var unit = getUnit( target() );

				if( !unit ){
					unit = options.defaultUnit;
				}

				return unit;

			},
			write: function( newUnit ){
				var value = getValue( newUnit )
					, unit	= getUnit( newUnit )
					, valueAndUnit = null;

				if( value === null ){
					value = target.value();
				}

				valueAndUnit = createValueAndUnit( value, unit );
				target( valueAndUnit );

				if( target.unit() != newUnit ){
					target.unit.notifySubscribers( unit );
				}

			}
		});
	}


	return target;
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


ko.extenders.asShorthand = function( target ){
	if( !target.__asShorthand ){
		/*
		var asArray = ko.computed( function(){
			var result = String(target() || '').split(/\s+/);
			if( result.length == 1 ){
				result[0] = result[0] || '0px';
				result[1] = result[2] = result[3] = result[0];
			} else if( result.length == 2 ){
				result[0] = result[0] || '0px';
				result[1] = result[1] || '0px';
				result[2] = result[0];
				result[3] = result[1];
			} else if( result.length == 3 ){
				result[0] = result[0] || '0px';
				result[1] = result[1] || '0px';
				result[2] = result[2] || '0px';
				result[3] = result[1];
			}
			return result;
		});
			*/
		var asArray = ko.computed( function(){
			return $.string.parseShorthand( target() );
		})

		target['asArray'] = asArray;

		$.each( ['top', 'right', 'bottom', 'left'], function(index, position){
			target[position] = ko.computed({
				read: function(){
					return asArray()[index];
				},
				write: function( val ){
					var arr = asArray();
					arr[index] = val;
					target( arr.join(' ') );
				}
			}).extend({asUnit:true});
		});

		target['horizontal'] = ko.computed(function(){
			return ( target.left.value() + target.right.value() ) + target.left.unit();
		}).extend({asUnit:true});

		target['vertical'] = ko.computed(function(){
			return ( target.top.value() + target.bottom.value() ) + target.top.unit();
		}).extend({asUnit:true});

		target.__asShorthand = true;

	}

	return target;
};


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$.extend( ko.extenders, {
	'asTime'	: function( target, options ){
		if(!target.__extenders_asTime ){
			target.__extenders_asTime = true;

			options = $.extend({
				'days'			: 'days',
				'hours'			: 'hours',
				'minutes'		: 'minutes',
				'seconds'		: 'seconds',
				'milliseconds'	: 'milliseconds',
				'format'		: 'dd hh:mm:ss',
				'formatInput'	: null,
				'formatOutput'	: null
			}, options );


			function getLapseInputFormat(){
				return options.formatInput || options.format;
			}

			function getLapseOutputFormat(){
				return options.formatOutput || options.format;
			}

			function translateUnitName( unitName ){
				return options[unitName] || unitName;
			}

			$.each( Chronometer.Lapse.getTimeDivisions(), function( index, unit ){
				var unitName = unit.name;
				target[translateUnitName(unitName)] = ko.computed({
					read: function(){
						var lapse = target.lapseOutput();
						return lapse.getUnitValue( unitName );
					},

					write: function( value ){
						var lapse = target.lapseOutput();
						lapse.setUnitValue( unitName, value );
						lapse.setFormat( getLapseInputFormat() );
						target( lapse.format() );
					}
				})
			});

			
			target.totalMilliseconds = ko.computed({
				read: function(){
					return target.lapseInput().getValue();
				},
				write: function( value ){
					var lapse = target.lapseOutput();
					lapse.setValue( value );
				}
			});
			

			target.lapseInput = ko.computed( function(){
				var lapse = new Chronometer.Lapse(0, {format: getLapseInputFormat()} );
				lapse.parse( target() );
				return lapse;
			});

			target.lapseOutput= ko.computed( function(){
				var lapse = new Chronometer.Lapse(0, {format: getLapseInputFormat()} );
				lapse.parse( target() );
				lapse.setFormat( getLapseOutputFormat() );
				return lapse;
			});
		}

		return target;
	}
});
	

$.extend( ko.extenders, {
	'formatMoney'	: function( target ){
		var result = ko.computed({
			read: function(){
				var precio = target();
				if( precio !== null ){
					precio = accounting.formatMoney( precio, '');
				}
				return precio;
			},

			write: function(value){
				var decimal = accounting.settings.currency.decimal
					, numero;

				if(value == null || value=='') {
					numero = null;
				} else {
					//if(String(value).indexOf(decimal) == -1) value = String(value).replace(/\./ig, decimal);
					numero = accounting.unformat(value||0, decimal);
				}
				target(numero);					
			}
		});
		return result;
	}
});
	





/**
 * devuelve un nuevo observableArray ordenado de acuerdo a una funcin
 * @param target
 * @param sortFn
 * @return {*}
 */
ko.extenders.sort = function(target, sortFn){
	var result = ko.computed({
		read: function(){
			return target().sort(sortFn);
		},
		write: function(newValue){
			target(newValue);
		}
	});
	result(target());
	result.notifySubscribers();
	return result;
};

/**
 * devuelve un nuevo observable traducido por punycode.js
 * @requires punycode.js
 * @param target
 * @param string method 'toASCII', 'toUnicode'
 * @return {*}
 */
ko.extenders.punycode = function(target, method){
	if(!window.punycode) throw('Incluir punycode.js para utilizar <observable>.extend({punycode:"toASCII"})');
	var result = ko.computed({
		read: function(){
			var result = target();
			if(typeof result == 'string') result = punycode[method](result);
			return result;
		},
		write: function(newValue){
			target(newValue);
		}
	});

	result(target());
	return result;
};






/**
 * Devuelve un nuevo observable paginado
 * @param target
 * @param options {pageSize:5, page: 0}
 * @return un nuevo observable con propiedades computed/observables:
 * eof() // est en la ltima pgina
 * bof() // est en la primer pgina
 * fitsInPage() el array original entra todo en una pgina
 * next() // ir a la siguiente pgina
 * prev() // ir a la pgina anterior
 * first() // ir a la primer pgina
 * last() // ir a la ltima pgina
 * page() // getter/setter para establecer la pgina
 * pageSize() // getter / setter para establecer el tamano de pgina
 * pageCount() // obtener la cantidad de pginas
 * offset() // getter / setter del offset. Normalmente se utiliza dejando la page(0), y moviendo el offset. Ej, para mostrar desde el elemento 3: offset(4)
 * pageTo(element) // ir a la pgina en la que se encuentra el elemento buscado
 * offset.next() // avanzar el offset
 * offset.prev() // retroceder el offset
 * offset.first() // poner el offset en 0
 * offset.last() // poner el offset en el ltimo elemento
 *
 * Ejemplo:
 * var arr = ko.observableArray(['Ana', 'Cecilia', 'Juan', 'Mara', 'Pedro' ]);
 * arr.paginado = arr.extend({paged: {pageSize:3});
 * arr.paginado() // ['Ana', 'Cecilia', 'Juan']
 * arr.paginado.offset(1);
 * arr.paginado() // ['Cecilia', 'Juan', 'Mara']
 * arr.paginado.pageTo('Mara');
 * arr.paginado(); // ['Mara', 'Pedro ]
 */
ko.extenders.paged = function(target, options){
	options = $.extend({
		pageSize    : 5,
		page        : 0,
		offset		: 0,
		displace	: 0,
		overflow	: 'none' // none|loop
	}, options);
	
	var pageSize = options.pageSize,
		page = options.page,
		offset = ko.observable(options.offset),
		page,
		pageSize = ko.observable(pageSize);


	var pageCount = ko.computed(function(){
		return Math.ceil(target().length / pageSize());
	});

	var result;
	
	var _page = ko.observable(page);
	page = ko.computed({
		read: function(){
			return _page();
		},
		write: function( val ){
			val = parseInt( val ) || 0;
			if( val < 0 ) val = 0;
			if( val > pageCount() ) val = pageCount();
			_page( val );
		}
	});

	var getPageSize = ko.computed( function(){
		return Math.min( pageSize(), target().length );
		}),

		start = ko.computed(function(){
			return page() * getPageSize() + offset();
		}),

		end = ko.computed(function(){
			return start() + getPageSize() - 1;
		}),

		recordCount = ko.computed( function(){
			return target().length;
		});


	getDisplaced = function( displace ){
		var theResult
			, _start
			, _end;
		_start	= start();
		_end	= end();


		if( options.overflow == 'loop' ){

			var _startLooped	= $.math.cicleToRange( _start + displace, 0 , recordCount() - 1 )
				, _endLooped	= $.math.cicleToRange( _end + displace, 0 , recordCount() - 1 );

			if( _startLooped <= _endLooped ){
				theResult = target().slice( _startLooped, _endLooped + 1 );
			} else {
				theResult = target().slice( _startLooped  ).concat( target().slice( 0, _endLooped + 1 ) );
			}

			//console.debug( _start, _end, _startLooped, _endLooped, 'getPageSize()', getPageSize(), 'pageSize()', pageSize(), 'targe.length()', target().length );

		} else  {
			if(start() >= target().length){
				var lastPage = pageCount() -1 ;
				if(lastPage < 0) lastPage = 0;
				page(lastPage || 0);
			}
			theResult = target().slice(start(), end());
		}
		//console.debug( _start, _end, ko.mapping.toJSON( theResult ) );
		return theResult;
	};
	result = ko.computed( getDisplaced.bind( this, options.displace ) , this );

	result.center = ko.computed( function(){
		return Math.round( start() + ( end() - start() ) / 2 ) - 1 - options.displace;
	}, this);

	result.eof = ko.computed(function(){
		return end() > target().length - 1;
	});

	result.bof = ko.computed(function(){
		return start() == 0;
	});

	result.fitsInPage = ko.computed(function(){
		return target().length <= pageSize();
	});
	
	result.pages = ko.computed( function(){
		var result = [];
		for(var i = 0, count = pageCount(); i < count ; i++){
			result.push( i );
		}
		return result;
	});
	
	result.recordCount = recordCount;

	result.next = function(){
		if(!result.eof()) page(page() + 1);
	};

	result.prev = function(){
		if(!result.bof()) page(page() - 1);
	};

	result.last = function(){
		var lastPage = pageCount() -1 ;
		if(lastPage < 0) lastPage = 0;
		page(lastPage);
	};

	result.first = function(){
		page(0);
	};

	result.pageTo = function(element){
		var index = target.indexOf(element);
		if(index!=-1);
		var elementPage = Math.floor(index / pageSize());
		offset(0);
		page(elementPage);
	};

	offset.next = function(){
		var newOffset = offset() + 1;

		if( options.overflow == 'none' ){
			if( result.eof() ){
				newOffset = offset();
			}
		} else if( options.overflow == 'loop') {
			newOffset = $.math.cicleToRange( newOffset, 0, result.recordCount() -1 );
		}

		offset( newOffset );
	};

	offset.prev = function(){
		var newOffset = offset() - 1;

		if( options.overflow == 'none' ){
			if( result.bof() ){
				newOffset = offset();
			}
		} else if( options.overflow == 'loop') {
			newOffset = $.math.cicleToRange( newOffset, 0, result.recordCount() -1 );
		}

		offset( newOffset );
	};

	offset.first= function(){
		offset(0);
	};

	offset.last= function(){
		var lastOffset = target().length - pageSize();
		if(lastOffset<0) lastOffset = 0;
		offset(lastOffset);
	};



	result.page = page;
	result.pageSize = pageSize;
	result.pageCount = pageCount;
	result.offset = offset;

	return result;
};
/**
 * devuelve un observable con el valor negado del original
 * ejemplo: a = ko.observable(true);
 * b = a.extend({not:true});
 * b() == false ; s
 * @param target
 * @param options
 * @return {*}
 */
ko.extenders.not = function(target, options){
	var computed = ko.computed(function(){
		return !target();
	}, this);

	return computed;
};


/**
 * example: a = ko.observable('hola mundo').extend({filterText: function(e){return e.toUpperCase()}}) // a() > 'HOLA MUNDO'
 * @param target
 * @param options
 * @return {*}
 */
ko.extenders.filterText = function(target, options){
	var filter = options || function(value){return value};
	var computed = ko.computed({
		read: function(){
			return target();
		},
		write: function(value){
			var filteredValue = filter(value);
			return target(filteredValue);
		}
	});
	return computed;
};

ko.extenders.prefilter= function(target, options){
	function noop( value ){ return value };
	var filterRead, filterWrite;

	if( typeof options == 'function' ){
		options = {
			read	: options
		}
	}

	var computed = ko.computed({
		read: function(){
			return (options.read || noop)( target() );
		},
		write: function(value){
			return target( (options.write || noop) ( value ) );
		}
	});

	if( ko.isWriteableObservable( computed ) ){
		computed( target() );
	}

	return computed;
};

ko.extenders.lockValue = function( target, options ){
	var result = ko.computed({
		read: function(){
			return ko.unwrap( options );
		}
	});
	result.lockValue = true;
	return result;
}



/**
 * throttleWithDirty es como throttle, pero agrega un flag que indica si est en medio del throttle
 */
$.extend(ko.extenders, {
    'throttleWithDirty': function(target, timeout) {
        // Throttling means two things:

        // (1) For dependent observables, we throttle *evaluations* so that, no matter how fast its dependencies
        //     notify updates, the target doesn't re-evaluate (and hence doesn't notify) faster than a certain rate
        target['throttleEvaluation'] = timeout;

        // (2) For writable targets (observables, or writable dependent observables), we throttle *writes*
        //     so the target cannot change value synchronously or faster than a certain rate
        var writeTimeoutInstance = null;
		target.throttling = ko.observable( false );
        return ko.dependentObservable({
            'read': target,
            'write': function(value) {
				//if( !target.equalityComparer(target(), value)){
					clearTimeout(writeTimeoutInstance);
					target.throttling( true );
					writeTimeoutInstance = setTimeout(function() {
						target.throttling( false );
						target(value);
					}, timeout);					
				//}
            }
        });
    },
	
	/**
	 * crea una funcin que al llamarla cambia el valor del observable entre true y false
	 * @param {type} target
	 * @returns {undefined}
	 */
	'toggle': function(target){
		if( 'function' != typeof target['toggle'] ){
			target['toggle'] = function(){
				target( !target() );
			}
		}
		return target;
	},

	'toggleValue': function(target){
		if( 'function' != typeof target['toggle'] ){
			target['toggleValue'] = function( value, nullValue ){
				if( target() != value ){
					target( value );
				} else {
					target( nullValue );
				}
				//target( !target() );
			}
		}
		return target;
	}
});

/*
ko.extenders.formatMoney = function( target ){
	var result = ko.computed({
		read: function(){
			var precio = target();
			if( precio !== null ){
				precio = accounting.formatMoney( precio, '');
			}
			return precio;
		},

		write: function(value){
			var decimal = accounting.settings.currency.decimal
				, numero;

			if(value == null || value=='') {
				numero = null;
			} else {
				if(String(value).indexOf(decimal) == -1) value = String(value).replace(/\./ig, decimal);
				numero = accounting.unformat(value||0, decimal);
			}
			target(numero);					
		}
	}, this);
	
	return result;
}
*/

/* -------------------------------- */
(function(ko){
	function walk( model, snapshotName, equalityComparer ){
		var result = [];
		if( ko.isObservable( model ) ){
			result.push( {'value': model });
			value.extend({'snapshot' : {'name': snapshotName, 'equalityComparer' : equalityComparer}});
		} else if ($.isPlainObject( model )){
			$.each( model, function( propertyName, value ){
				if( $.isPlainObject( value ) ){
					var snapshot = ko.snapshotObservable(value, snapshotName );
					value = snapshot;
					model[propertyName] = value;
				}
				if( ko.isObservable( value ) ){
					result.push( {'name': propertyName, 'value': value });
					value.extend({'snapshot' : {'name': snapshotName, 'equalityComparer' : equalityComparer}});
				}
			})
		};
		return result;
	}


	ko.snapshotObservable = function( model, snapshotName, equalityComparer){
		var observables = walk( model, snapshotName, equalityComparer );
		var result = ko.observable( model );
		result.observables = ko.computed( function(){ return observables });
		result.__snapshotObservable = true;
		result.extend({snapshot: {
			'name'				: snapshotName,
			'equalityComparer'	: equalityComparer
		}});
		return result;
	}

	ko.isSnapshotObservable = function( what ){
		return !!(what && what.__snapshotObservable );
	}




	$.extend(ko.extenders, {
		'snapshot': function( target, options ) {
			options = $.extend({
			}, options);
			var equalityComparer = options.equalityComparer;
			var snapshotName = options.snapshotName;

			if( !equalityComparer ){
				equalityComparer = function(a, b){
					var result;
					if(!a && !b ){
						result = true;
					} else {
						result = ( a == b );
					}
					return result;
				}
			}
			if(!snapshotName || snapshotName === true) snapshotName = 'default';
			if( !target['snapshots'] ) target['snapshots'] = {};
			if( !target['snapshots'][snapshotName]){
				target['snapshots'][snapshotName] = {
					'value'	 : target()
				};

				if( ko.isSnapshotObservable( target ) ){
					function firstModified( snapshotName ){
						return ko.utils.arrayFirst( target.observables(), function( observable ){
							return observable.value.snapshotIsModified( snapshotName );
						});
					}

					function hasChanges( snapshotName ){
						return !!firstModified( snapshotName );
					}
					target['snapshotFirstModified'] = firstModified;

				} else {
					function getSnapshotValue( snapshotName ){
						if(!snapshotName) snapshotName = 'default';
						return target['snapshots'][snapshotName] && target['snapshots'][snapshotName].value;
					}

					function hasChanges( snapshotName ){
						var snapshotValue = getSnapshotValue( snapshotName );
						return !equalityComparer( snapshotValue, target() );
					}
					target['snapshotValue'] 		= getSnapshotValue;
				}
				target['snapshotIsModified'] 	= hasChanges;

			}
		}
	});

})(ko);


/**
 * ko.observableCookie('cookiename');
 * crea observables de cookies que permiten leerlas y escribirlas.
 * cuando la cookie cambia, el observable se entera y funciona como cualquier observable notificando al resto.
 */
(function(){
	ObservableCookie = $.Class({
		cookies: [],

		getCookie: function(name){
			return $.findInCollection(this.cookies, function(cookie){
				return cookie.name == name;
			});
		},

		createCookie: function(name, options){
			var instance = new this(name, options);
			return instance;
		},

		startChecking: function(){
			if(!this._checkingInterval){
				this._checkingInterval = setInterval($.proxy(this.checkCookies, this), 1000);
			}
		},

		stopChecking: function(){
			if(this._checkingInterval){
				clearInterval (this._checkingInterval);
				this._checkingInterval = null;
			}
		},

		checkCookies: function(){
			var self = this;
			$.each(this.cookies, function(index, cookie){
				var value = $.cookie(cookie.name);
				if(value != cookie.observable()){
					cookie.observable(value);
				}
			});
		},

		prototype:{
			init: function(name, options){
				var self = this;
				this.options = $.extend({}, options);
				this.constructor.startChecking();
				this.name = name;

				this.observable = ko.observable($.cookie(name));
				this.observable.subscribe(function(value){
					$.cookie(name, value, self.options);
				});
				if( this.observable() === undefined ){
					this.observable( this.options.defaultValue );
				}

				this.constructor.cookies.push(this);

				this.observable.clear = function(){
					self.observable(undefined);
					$.removeCookie( name )
				};

			}
		}
	});

	ko.observableCookie = function(cookieName, options){
		var instance = ObservableCookie.createCookie(cookieName, options);
		return instance.observable;
	};

	ko.observableJSONCookie = function(cookieName, options){
		var options = $.extend({}, options);

		if( options.defaultValue !== undefined ){
			options.defaultValue = $.toJSON( options.defaultValue );
		}

		var instance = ObservableCookie.createCookie(cookieName, options);
		var observable = instance.observable;
		var jsonComputed = ko.computed({
			read: function(){
				var result = undefined;
				try{
					result = $.parseJSON( observable() );
				} catch( e ){

				}
				return result;
			},
			write: function(value){
				observable($.toJSON(value));
			}
		});

		jsonComputed.clear = observable.clear;

		return jsonComputed;
	};
})();

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

(function(ko){
	/*
	ObservableStorage = $.Class({
		init: function( name ){

		}
	});
	*/
	ko.extenders.localStorage = function( target, options ){
		if( $.localStorage.isAvailable() ){
			if( typeof options == 'string' ){
				options = {
					'name'	: options
				}
			}

			var name = options.name;

			var viewModel;

			if( options.mapping ){
				if(	options.mapping.create ){
					var originalMapping = options.mapping;
					options.mapping = {};
					options.mapping.data = originalMapping;
				}
			}


			////////////////////////////////////////////////

			var ViewModel = ko.ViewModel.createSubclass({
				mappeable	: {
					'data'	: ko.unwrap( target )
				},
				mapping	: options.mapping
			});

			var viewModel = new ViewModel();

			viewModel.data = target;

			////////////////////////////////////////////////


			function updateFromStorage( newValue ){
				/*
				 if( options.mapping ){
				 ko.mapping.fromJSON( )
				 } else {
				 var parsedValue = JSON.parse( newValue );
				 if(ko.isObservableArray(target)){
				 if( !parsedValue ) parsedValue = [];
				 }
				 target( parsedValue );
				 }*/

				var parsedValue = JSON.parse( newValue );
				if(ko.isObservableArray(target)){
					if( !parsedValue ) parsedValue = [];
				}
				viewModel.update( {data: parsedValue });


			}

			updateFromStorage( $.localStorage.getItem( name ));

			$(window).on('storage', function(event){
				var originalEvent = event.originalEvent;
				if( originalEvent.key == name ){
					var value = originalEvent.newValue;
					updateFromStorage( value );
				}
			});

			target.subscribe( function( newValue ){
				var newValueJS = ko.ViewModel.toJS(newValue);
				var jsonValue = ko.mapping.toJSON( newValueJS );
				$.localStorage.setItem( name, jsonValue );
			}, this );
		}


		return target;

	}
})(ko);

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

(function( ko ){

	ko.observableTimedRefresh = function( callback, milliseconds, options ){
		var milliseconds = milliseconds || 1000;
		var refresher = ko.observable(0);
		var result = ko.computed( function(){
			var r = refresher();
			return callback.apply(this, [r]);
		}, this, options );

		result._data = {
			'interval'				: null,
			'milliseconds'			: milliseconds,
			'refresher' 			: refresher,
			'original'				: {
				'dispose'			: result.dispose
			}
		};

		ko.utils.extend(result, ko.observableTimedRefresh['fn']);
		result.start();
		return result;
	}

	ko.observableTimedRefresh['fn'] = {
		'start': function(){
			var self = this;
			self.stop();
			self._data.interval = setInterval( function(){
				self._data.refresher( self._data.refresher() + 1 );
			}, this._data.milliseconds );
		},

		'stop': function(){
			var self = this;
			clearInterval( self._data.interval );
		},

		'dispose': function(){
			this.stop();
			this._data.original.dispose && this._data.original.dispose();
			this._data.refresher.dispose && this._data.refresher.dispose();
			delete this._data;
		}
	}

	//////////////////////////////////////////////////////////////////////

	ko.observableTimer = function( milliseconds, options ){
		var callback = function( t ){ return t };
		var result = ko.observableTimedRefresh( callback, milliseconds, options );
		return result;
	}


	ko.observableSwitcher = function( states, milliseconds, options ){
		var callback = function( t ){
			var unwrappedStates = ko.unwrap( states );
			var index = t % unwrappedStates.length;
			return unwrappedStates[index];
		}
		var result = ko.observableTimedRefresh( callback, milliseconds, options );
		return result;
	}


})(ko);








(function(){
	ObservableRange = $.Class({
		prototype:{
			init: function(start, end, step){
				var _start = ko.observable(start);
				var _end = ko.observable(end);
				var _step = ko.observable(step);
				var _error = ko.observable(false);

				var computed = ko.computed(function(){
					var result = [];
					var n = 0;
					
					var start = parseFloat(_start());
					var end = parseFloat(_end());
					var step = Math.round(parseFloat(_step()) || 1);
					
					step = Math.abs(step) * (start <= end ? 1 : -1);
					
					if(!isNaN(start) && !isNaN(end) && step){
						for (var i = start; i <= end && n < 100; i += step, n++){
							result.push(i);
						}
					}
					_error(isNaN(start) || isNaN(end) || !step);

					return result;
				}, this);
				
				computed.start	= _start;
				computed.end	= _end;
				computed.step	= _step;
				computed.hasErrors = _error;

				computed.toJS = ko.computed(function(){
					var start = parseFloat(_start());
					var end = parseFloat(_end());
					var step = Math.round(parseFloat(_step()) || 1);				
					step = Math.abs(step) * (start <= end ? 1 : -1);

					return {
						start	: start,
						end		: end,
						step	: step
					};
				});
				computed.toJSON = ko.computed(function(){
					return $.toJSON(computed.toJS());
				});
				this.computed = computed;
			}
		}
	});
	ko.observableRange = function(start, end, step){
		var observableRange = new ObservableRange(start, end, step);
		return observableRange.computed;
	}
})();


ko.observableWindow = function(options){
	var options = $.extend({}, options);
	
	var trigger = ko.computed(function(){});

	var computed = ko.computed(function(){
		trigger();
		return {
			width	: $(window).width(),
			height	: $(window).height()
		}
	});
	
	
	var steps = $.map(options.steps || {}, function(value, key){
		return {
			name: key,
			maxWidth: value}
		}
	).sort(function(a,b){return a.maxWidth - b.maxWidth});

	$.each( steps, function( index, value ){
		steps[ value.name ] = value;
	})
	
	var minWidth = 0;
	for (var i = 0 ; i < steps.length ; i++){
		(function(min, max, device){
			computed['visible' + device] = ko.computed(function(){
				return computed().width > min && computed().width <= max;
			}).extend({preserveChange: true, throttle:500});

			computed['hidden' + device] = ko.computed(function(){
				return !computed['visible' + device]();
			}).extend({preserveChange: true, throttle:500});
			
		})(minWidth, steps[i].maxWidth, $.string.capitalize(steps[i].name));
		minWidth = steps[i].maxWidth;
	}
	computed.steps = steps;
	
	
	computed.refresh = function(){
		trigger.notifySubscribers();

	};
	computed.devicePixelRatio = ko.computed(function(){
		return window.devicePixelRatio || 1;
	});
	
	computed.retina = ko.computed(function(){
		return window.devicePixelRatio > 1 ? true : false;
	});
	
	

	$(window).on('resize', function(){
		computed.refresh();
	});
	
	return computed;

};
////////////////////////////////////////////////////////////////////////////////
/*
 * ko.observableHashBangResult funciona mejor con $.bbq
 */

ko.observableHashBangResult = function(options){
	var options = $.extend({}, options);
	var trigger = ko.observable();

	var computed = ko.computed(function(){
		trigger();
		var hashbang = $.hashbang.get();
		return hashbang;
	});
	
	computed.refresh = function(){
		trigger.valueHasMutated();
	};

	
	computed.computedPathKey = function( pathKey ){
		return ko.computed( function(){
			return computed().path[ pathKey ];
		}).extend( { preserveChange: true } );
	};

	
	
	$(window).bind( "hashchange", function(){
		computed.refresh();
	});
	
	return computed;
};


ko.observableHashBang = function(options){
	var options = $.extend({}, options);
	var trigger = ko.computed(function(){});
	
	var computed = ko.computed(function(){
		trigger();
		var hashbang = $.hashbang;
		return hashbang;
	});
	
	computed.refresh = function(){
		trigger.notifySubscribers();
	};
	
	computed.computedPathKey = function( pathKey ){
		return ko.computed( function(){
			return computed().get().path[ pathKey ];
		}).extend( { preserveChange: true } );
	};
	
	$(window).bind( "hashchange", function(){
		computed.refresh();
	});
	
	return computed;
};


////////////////////////////////////////////////////////////////////////////////

ko.toObservable = function( property, defaultValue ){
	var value = property;
	if( arguments.length >= 2 ){
		if(!value){
			value = defaultValue;
		}
	}
	return ko.isObservable( property ) ? property : ko.observable( value )
}

////////////////////////////////////////////////////////////////////////////////

ko.isObservableArray = function(instance){
	return instance.pop == ko.observableArray.fn.pop;

};
ko.observableArray.fn.dispose = function(){
	if(!this.___disposing){
		this.___disposing = true;
		$.each(this(), function(key, element){
			if(typeof element['dispose']=='function'){
				element.dispose();
			}
		});
		this([]);
		this.___disposing = false;
	}
};
ko.observableArray.fn.destroyItems = function(){
	var items;
	
	if(!this.___destroying){
		this.___destroying = true;
		items = $.extend([], this());
		$.each(items, function(key, element){
			if(typeof element['destroy']==='function'){
				element.destroy();
			}
		});
		this([]);
		items = null;
		this.___destroying = false;
	}
};



/**
 * http://www.wiredprairie.us/blog/index.php/archives/1565
 */
ko.observableArray.fn.withIndex = function (keyName, useName) {
    /// keyName == the name of the property used as the index
    ///            value.
    /// useName == when false, a function named findByKey 
    ///            is added to the observableArray.
    ///            when true, the function is named based
    ///            on the name of the index property &
    ///            capitalized (like id becomes findById)
    var index = ko.computed(function () {
        var list = this() || [];    // the internal array
        var keys = {};              // a place for key/value
        ko.utils.arrayForEach(list, function (v) {
            if (keyName) {          // if there is a key
                keys[v[keyName]] = v;    // use it
            } else {
                keys[v] = v;
            }
        });
        return keys;
    }, this);

    var fnName = "";
    if (useName && keyName) {
        var cap = keyName.substr(0, 1).toUpperCase();
        if (keyName.length > 1) {
            fnName = cap + keyName.substring(1);
        } else {
            fnName = cap;
        }
    } else {
        fnName = "Key";
    }

    var fnName = "findBy" + fnName;
    this[fnName] = function (key) {
        return index()[key];
    };

    return this;
};


ko.observableArray.fn.filterByProperty = function(propName, matchValue) {
    return ko.computed(function() {
        var allItems = this(), matchingItems = [];
        for (var i = 0; i < allItems.length; i++) {
            var current = allItems[i];
            if (ko.utils.unwrapObservable(current[propName]) === matchValue)
                matchingItems.push(current);
        }
        return matchingItems;
    }, this);
};
ko.observableArray.fn.pluck = function(propName){
	return $.pluckCollection( this(), propName);
};
//////////////////

ko.subscribable.fn.subscribeOnce = function (handler, owner, eventName) {
	var subscription = this.subscribe(function (newValue) {
		subscription.dispose();
		handler(newValue);
	}, owner, eventName);
	return subscription;
};

//////////////////
ko.observable.fn.withPausing = function() {
	if(!this.__withPausing){
		this.notifySubscribers = function() {
		   if (!this.pauseNotifications) {
			  ko.subscribable.fn.notifySubscribers.apply(this, arguments);
		   }
		};
		this.__withPausing = true;
	}
};
//////////////////
ko.observable.fn.animate = function( value, options ){
	var self = this;
	if( !this._animateJq ){
		this._animateJq = $({value: this()});
	}

	var options = $.extend({}, options );
	function optionsStep( val ){
		self( val );
	}
	if( options.step ){
		var step = options.step;
		options.step = function( val ){
			optionsStep( val );
			step.apply(step, arguments );
		}
	} else {
		options.step = optionsStep;
	}

	this._animateJq.animate({value: value}, options);

	return this._animateJq;
};

ko.extenders.animate = function( target, options ){
	var options = $.extend({
		duration: 500
	}, options );


	var _currentValue = target();
	var _observable = ko.observable( target() );

	function optionsStep( val ){
		_currentValue = val;
		_observable( val );
	}

	if( options.step ){
		var step = options.step;
		options.step = function( val ){
			optionsStep( val );
			step.apply(step, arguments );
		}
	} else {
		options.step = optionsStep;
	}


	var animate = $({value: target()});

	target.subscribe( function( newValue ){
		animate.stop().animate({value: newValue}, options );
	});

	var result = ko.computed({
		read: function () {
			return _observable();
		},

		write: function (value) {
			if(ko.isWriteableObservable( target ) ){
				target( value );
			}
		}
	});

	return result;

};


(function(){

	var hashMethods = {
		get: function( key, defaultValueIfNotExist ){
			var result;
			if( arguments.length == 0 ){
				result = this();
			} else {
				if( !this.hasKey(key) && arguments.length > 1 ) {
					this.set(key, defaultValueIfNotExist);
				}
				result = this._hash[key];
			}
			return result;
		},

		hasKey: function( key ){
			return key in this.get();
		},

		set: function( key, value ){
			var data = this();
			data[key] = value;
			this( data );
		},

		isEmpty: function(){
			return $.isEmptyObject( this() )
		},

		reset: function(){
			this({})
		}
	}

	var ObservableHash = $.Class({
		prototype:{
			init: function( data ){
				this.data = ko.observable( data );
				this._hash = {};
				this.createComputed();
			},

			createComputed: function(){
				var dirty = ko.observable();
				this.computed = ko.computed({
					read: function(){
						dirty();
						var result = ko.mapping.toJS( this._hash );
						$.each( result, function( key, value ){
							if( value == undefined ) delete result[key];
						})

						return result;
					},
					write: function( data ){
						var self = this;
						var result = ko.mapping.fromJS( data, {}, this._hash );
						$.each( this._hash, function( key, value ){
							if( ! (key in data) ){
								var hashValue = self._hash[key];
								if(ko.isObservable( hashValue ) ){
									hashValue( undefined );
								}
							}
						})
						this._makeEditable();
						dirty.notifySubscribers();

						return result;
					}
				}, this );
				this.computed._hash = this._hash;
				$.extend( this.computed, hashMethods );
			},

			_makeEditable: function(){
				$.each( this._hash, function( key, value ){
					if( ko.isObservable( value ) && !value.editable ){
						value.extend({editable: true});
					}
				});
			}
		}
	});

	ko.observableHash = function( data ){
		var observableHash = new ObservableHash( data );
		return observableHash.computed;
	}
})( ko );

/**
 * recordset
 */
(function(ko){
	var defaultOptions = {
		pageSize		:5,
		pagerSize		:5,
		useHashFilter	: false,
		updateFilter	: false
	}

	ko.extenders.recordset = function(target, options){
		var options = $.extend({}, ko.extenders.recordset.defaultOptions , options);

		if(!target.recordset){
			target.recordset = {};
			target.recordset.pagerSize = ko.observable(options.pagerSize);
			target.recordset.absolutePage = ko.observable(0).extend({toInteger:true});
			target.recordset.pageSize = ko.observable(options.pageSize);
			target.recordset.pageCount = ko.observable();
			target.recordset.recordCount = ko.observable();
			target.recordset.filter = options.useHashFilter ? ko.observableHash() : ko.observable();
			target.recordset.orden = ko.observableArray( options.orden || [] );

			target.recordset.bof = ko.computed(function(){
				return target.recordset.absolutePage() == 0;
			});
			target.recordset.eof = ko.computed(function(){
				var lastPage = target.recordset.pageCount() - 1
				return !lastPage || target.recordset.absolutePage() >= lastPage;
			});

			target.recordset.prev = function(){
				target.recordset.absolutePage(Math.max(target.recordset.absolutePage() - 1, 0));
			};

			target.recordset.next = function(){
				target.recordset.absolutePage(Math.min(target.recordset.absolutePage() + 1, target.recordset.pageCount() - 1));
			};

			target.recordset.first = function(){
				target.recordset.absolutePage(0);
			};

			target.recordset.last = function(){
				var lastPage = target.recordset.pageCount() - 1;
				target.recordset.absolutePage(lastPage);
			};

			target.recordset.prevPageNumber = ko.computed(function(){
				return Math.max(target.recordset.absolutePage() - 1, 0);
			});

			target.recordset.lastPageNumber = ko.computed(function(){
				return target.recordset.pageCount() - 1;
			});

			target.recordset.firstPageNumber = ko.computed(function(){
				return 0;
			});

			target.recordset.nextPageNumber = ko.computed(function(){
				return Math.min(target.recordset.absolutePage() + 1, target.recordset.lastPageNumber());
			});


			target.recordset.pagerPages = ko.computed(function(){
				var deltaLeft = Math.ceil ( (target.recordset.pagerSize() - 1) / 2);
				var min = Math.max(0, target.recordset.absolutePage() - deltaLeft);
				var max = Math.min(min + target.recordset.pagerSize() - 1, target.recordset.pageCount() - 1);
				if(max == target.recordset.pageCount() - 1) min = Math.max(target.recordset.pageCount() - target.recordset.pagerSize(), 0);
				var result = [];
				for (var i = min; i <= max ; i++) result.push(i);
				return result;
			});

			target.recordset.pagerPages.first = ko.computed(function(){
				return target.recordset.pagerPages()[0];
			});

			target.recordset.pagerPages.last = ko.computed(function(){
				return target.recordset.pagerPages()[target.recordset.pagerPages().length - 1];
			});


			target.recordset.update = function(data, options){
				var defaultOptions = $.extend( {}, ko.extenders.recordset.defaultOptions );
				if( !target.recordset.updateRecordset ) defaultOptions.exclude = 'recordset';

				options = $.extend(defaultOptions, options);
				var properties = ['absolutePage', 'pageSize', 'pageCount', 'recordCount', 'recordset', 'orden']; //$.map(data, function(value,key){return key});
				if( defaultOptions.updateFilter ){
					properties.push('filter');
				}

				if(options.exclude) properties = $.arrayExclude(properties, $.toArray(options.exclude));

				$.each(properties, function(index, propertyName){
					var value = data[propertyName];
					if(propertyName == 'recordset') target(value);
					else if(propertyName in data && ko.isWriteableObservable(target.recordset[propertyName])) target.recordset[propertyName](value);
				});

				target.recordset.loading(false);
				target.recordset.hasData(true);
			};


			target.recordset.getRows = ko.computed(function(){
				return target();
			});
			target.recordset.loading = ko.observable(false);
			target.recordset.hasData = ko.observable(false);

			target.recordset.toJS = function(){
				return {
					absolutePage: target.recordset.absolutePage(),
					pageSize: target.recordset.pageSize()
				}
			};
			target.recordset.reset = function(){
				target.recordset.loading(false);
				target.recordset.hasData(false);
				// target([]); // no se pone el target en vaco, porque podra arrancar con valores
			};
			target.recordset.removeAll = function(){
				target.removeAll();
				target.recordset.pageCount(0);
				target.recordset.recordCount(0);
				target.recordset.reset();
			};
		}
	};

	ko.extenders.recordset.defaultOptions = defaultOptions;
})( ko );



////////////////////////////////////////////////////////////////////////////////

/**
 * 
 * <h1 data-bind="i18nText: 'secciones:demo_vencida.la_demo_vencio', i18nOptions: {}, i18nParams: {count: Math.abs($root.market.dtDiasPruebaRestantes()) }">...</h1>
 */

$(function(){
	window.i18n && $.extend(i18n, {
		sections: function (text ){
			text = $.string.decodeJSON( text );
			var matches = text.match(/^\w+\.(\w+\.)*/)
				, secciones = ( matches && matches[0] ) || '';
			return secciones;
		},
		
		withoutSections: function( text ){
			text = $.string.decodeJSON( text );
			var secciones = this.sections( text );
			text = $.string.removeAtStart( text, secciones );
			return text;
		},
		
		k: function(text){
			text = $.string.decodeJSON( text ).toLowerCase();
			
			var secciones = this.sections( text );
			text = this.withoutSections( text );
			
			var noTildes = $.string.decodeHTML( $.string.noTildes(text.toLowerCase()) );
			var corregido = noTildes.replace(/^[^\w]+/, '').replace(/[^\w]+$/, '').replace(//i, 'n').replace(/(\s|\.|-)+/g, '_').replace(/[^\w]/g, '');
			
			return $.arrayExclude([secciones, corregido], ['']).join('');
		},
		
		validKey: function( text ){
			return /^[a-z0-9_]+(\.[a-z0-9_]+)*$/g.test(text);
		},
		
		validNamespace: function( text ){
			return /^[a-z0-9_]+$/g.test(text);
		},
		
		validNamespaceKey: function( text ){
			var splitted = text.split(':')
				, namespace = splitted[0]
				, key		= splitted[1];
				
			return namespace && this.validNamespace( namespace ) && key && this.validKey( key );
		}
	});
});


ko.bindingHandlers.i18nText = {	
	lng		: ko.observable(),
	
	translate: function( text, i18nParams, options){
		var params = [text || ''],
		options = $.extend({}, options ),
		translation;
	
		ko.bindingHandlers.i18nText.lng();
		
		if( !text ) return text;
		
		if( i18nParams ) {
			params.push.apply( params, $.toArray( i18nParams ) );
		}
		
		if( options.params ) {
			params.push.apply( params, $.toArray( options.params ) );
		}
		
		translation = i18n.t.apply(i18n, params);
		
		if( options.br ){
			translation = translation.split('\n').join('<br/>');
		}
		
		return translation;	
	},
	
    update: function(element, valueAccessor, allBindingsAccessor, context) {

		var newValueAccessor;
		newValueAccessor = function() {
			var allBindings = allBindingsAccessor()
				, text = ko.utils.unwrapObservable(valueAccessor())
				, i18nParams = ko.utils.unwrapObservable( allBindings.i18nParams )
				, options = $.extend({}, ko.utils.unwrapObservable( allBindings.i18nOptions ) )
				, translation;
			
			translation = ko.bindingHandlers.i18nText.translate( text, i18nParams, options );
		
			
			return translation;
		};

        ko.bindingHandlers.text.update(element, newValueAccessor);
    }
};

ko.virtualElements.allowedBindings['i18nText'] = true;

if( window.i18n ) {
//	i18n.kot = ko.bindingHandlers.i18nText.translate;
	
	i18n.kot = function( text, i18nParams, options, node ){
		var node = arguments[ arguments.length - 1 ];
		
		if( !$.isHTMLElement( node ) ) node = null;
		
		text = ko.unwrap( text );
		
		if( node ) {
			return ko.computed( function(){
				return ko.bindingHandlers.i18nText.translate( text, i18nParams, options );
			}, null, {disposeWhenNodeIsRemoved: node} );
		} else {
			return ko.bindingHandlers.i18nText.translate( text, i18nParams, options );
		}
	};

	i18n.koLng = ko.bindingHandlers.i18nText.lng;

	i18n.kotprop = function( property, obj ){
		var obj = arguments[ arguments.length - 1];
		return i18n.kot( obj[property] );
	};
}

/**
 * 
 * <h1 data-bind="i18nHtml: 'secciones:demo_vencida.la_demo_vencio', i18nParams: {count: Math.abs($root.market.dtDiasPruebaRestantes()) }">...</h1>
 */
ko.bindingHandlers.i18nHtml = {	
    update: function(element, valueAccessor, allBindingsAccessor, context) {
		var newValueAccessor;
		newValueAccessor = function() {
			var allBindings = allBindingsAccessor(),
				params = [ko.utils.unwrapObservable(valueAccessor())],
				i18nParams = ko.utils.unwrapObservable( allBindings.i18nParams ),
				options = $.extend({}, ko.utils.unwrapObservable( allBindings.i18nOptions ) ),
				translation;

			ko.bindingHandlers.i18nText.lng();

			if( i18nParams ) {
				params.push.apply( params, $.toArray( i18nParams ) );
			}
			
			if( options.params ) {
				params.push.apply( params, $.toArray( options.params ) );
			}
			
			translation = i18n.t.apply(i18n, params);
			
			if( options.br ){
				translation = translation.split('\n').join('<br/>');
			}
						
			return translation;
		};
		

        ko.bindingHandlers.html.update(element, newValueAccessor);
    }
};

ko.virtualElements.allowedBindings['i18nHtml'] = true;


/**
 * el binding safeHtml es similar a html, pero no ejecuta los tags <script>
 */
(function( ko ){
	var bindingName = 'safeHtml';
	var self = ko.bindingHandlers[ bindingName ] = {
		update: function(element, valueAccessor, allBindingsAccessor, context) {
			var newValueAccessor;
			newValueAccessor = function() {
				var allBindings = allBindingsAccessor(),
					value = ko.unwrap (valueAccessor()),
					//options = $.extend({}, ko.unwrap( allBindings [ bindingName + 'Options' ] ) ),
					translation;

				translation = $.string.stripScriptTags( value );

				return translation;
			};


			ko.bindingHandlers.html.update(element, newValueAccessor);
		}
	};
	ko.virtualElements.allowedBindings[ bindingName ] = true;

})(ko);



	
OdometerAPI = $.Class({
	getInstance: function(){
		if( !this._theInstance ){ // this['_theInstance'] 
			this._theInstance = new this();
		}
		return this._theInstance;
	}, 
	prototype: {
		init: function( options ){
			this.options = $.extend({}, options);			

			this._deferred = new $.Deferred();				
			$.extend(this, this._deferred);

			this._loadPlugin();
		},

		_onLoad: function(){
			$style = $('<style>').html('.odometer {display: none;}');
			$('head').append($style);
			this.resolve('ok');
		},

		_loadPlugin: function(){
			var self = this;
			$.getScript('/js/libs/odometer.lisandro.min.js', function(){
				self._onLoad();
			});
		}
	}
});

ko.bindingHandlers['odometer'] = {
	'themes' : ko.observableArray(),
	
	'cssFiles'	: function(){
		return ko.utils.arrayMap( this.themes(), function( theme ){
			return 'odometer-theme-' + theme + '.css';
		});
	},
	
	'useTheme': function( theme ){
		if( this.themes.indexOf( theme ) === -1 ){
			this.themes.push(theme);
		}
	},
	
	'init': function(element, valueAccessor, allBindingsAccessor, context) {
		var value = ko.utils.unwrapObservable(valueAccessor()),
			odometer,
			allBinding = ko.utils.unwrapObservable(allBindingsAccessor()),
			options = $.extend({
				el      : element,
				auto    : false,
				format  : '',
				theme   : 'default'
			}, allBinding.odometerOptions)
			, eliminado = false;

		$(element).html('cargando...');

		OdometerAPI.getInstance().done( function(){
			if( !eliminado ){
				var value = $(element).data('odometer.data');
				odometer = new Odometer( options );		
				$(element).data('odometer', odometer);
				ko.bindingHandlers['odometer'].useTheme( options.theme );
				setTimeout( function(){
					if( !eliminado && $(element).data('odometer') ) odometer.update( value );
				}, 0 );
			}
		});

		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			eliminado = true;
			odometer = $(element).data('odometer');
			if( odometer ){
				odometer.dispose();
			}		
		});

	},
	
	'update': function(element, valueAccessor, allBindingsAccessor, context) {
		var value = ko.utils.unwrapObservable(valueAccessor()),
		odometer = $(element).data('odometer');		
		if( odometer ){
			odometer.update( value );
		}
		
		$(element).data('odometer.data', value);
		
	}
};






/**
 * ms informacin sobre performance en:
 * https://varvy.com/performance/
 * https://www.html5rocks.com/en/tutorials/webperformance/basics/
 */
ko.NetworkInfo = ko.ViewModel.createSubclass({
	mappeable: {
		ping				 : 0,
		loadingTime			 : 1000,
		loadingTimeReference : 1000,
		
		appLoadComplete		: null
	}
}, {
	prototype: {
		init: function(){
			this._parent.apply(this, arguments);
			this.speed = ko.computed(function(){
				return this.loadingTimeReference() / this.loadingTime();
			}, this);
			
			this.speedName = ko.computed(function(){
				var speed = this.speed()
					, name = 'normal';
				switch( true ){
					case (speed < .25):
						name = 'slowest';
						break;
					case (speed < .5):
						name = 'slow';
						break;
					case (speed > 4):
						name = 'fastest';
						break;
					case (speed > 2):
						name = 'fast';
						break;
				}
				return name;
			}, this);

			this.speed.slow = ko.computed(function(){
				return this.speedName().indexOf('slow') !== -1;
			}, this);
			
		},

		// utmticnn : desde que comenz la primer redireccin hasta que termin el TCP
		connectionTime: function(){
			var timing = window.performance && window.performance.timing;	
			return timing && timing.navigationStart && (timing.connectEnd - timing.navigationStart);
		},

		// utmtidns : tiempo que demor el DNS
		dnsTime: function(){
			var timing = window.performance && window.performance.timing;	
			return timing && timing.domainLookupEnd - timing.domainLookupStart;
		},

		// utmtisrv : tiempo que demor el servidor en procesar el request
		serverTime: function(){
			var timing = window.performance && window.performance.timing;	
			return timing && timing.responseEnd - timing.requestStart;
		},

		// utmtibrw : tiempo que demora el browser en procesar la pgina html
		browserTime: function(){
			var timing = window.performance && window.performance.timing;	
			return timing && timing.domComplete - timing.domLoading;
		},

		// utmtitot : tiempo total desde que comenz la primer redireccin hasta que se carg el ltimo elemento del dom (script, css, imagen)
		totalTime: function(){
			var timing = window.performance && window.performance.timing;	
			return timing && timing.navigationStart && ( timing.loadEventEnd - timing.navigationStart );
		},
		
		timeFromNavigationStart: function( time ){
			var timing = window.performance && window.performance.timing;	
			return timing && timing.navigationStart && ( time - timing.navigationStart );
		},

		// utmtiapp : tiempo entre que empieza a cargar los recursos CSS y JS, y el tiempo definido por el usuario hasta que se carg la aplicacin.
		// En SS Front es el tiempo hasta que se obtuvo el carrito
		appLoadingTime: function(){
			var timing = window.performance && window.performance.timing;	
			return timing && this.appLoadComplete() && ( this.appLoadComplete() - timing.domInteractive );
		},

		// utmtiatt : tiempo total entre la primer redireccin y el tiempo definido por el usuario hasta que carg la aplicacin.
		// En SS Front es el tiempo total desde que se hizo la primer redireccin hasta que se obtuvo el carrito
		appTotalTime: function(){
			var timing = window.performance && window.performance.timing;	
			return timing && this.appLoadComplete() && timing.navigationStart && ( this.appLoadComplete() - timing.navigationStart );			
		}
		
	},

	
	getInstance: function(){
		if(!this._instance){
			this._instance = new this();
		}
		return this._instance;
	}
});


(function (ko) {
	function createRemover( fnName ){
		var args = $.makeArray( arguments );
		args.shift();
		return function(elem) {
			if (elem.nodeType === 1) {
				var newArgs = $.extend([], args );
				newArgs.push(function () {
					ko.removeNode(elem);
				});
				$(elem).css({
					'pointerEvents': 'none',
					'-webkitTouchCallout': 'none',
					'-webkitUserSelect': 'none',
					'-khtmlUserSelect': 'none',
					'-mozUserSelect': 'none',
					'-msUserSelect': 'none',
					'user-select': 'none'
				});
				$(elem)[fnName].apply($(elem), newArgs );
			}
		}
	}

	ko.nodeRemovers = {
		setup: function( options, removeName ){
			var result = $.extend({}, options);

		},
		beforeMove: function(){

		},
		afterMove: function(){

		},
		///////////////////////////////////////

		slideUp:  createRemover('slideUp'),
		fadeOut:  createRemover( 'fadeOut' ),
		slideRow: 	createRemover('slideRow', 'up')
	}
})( ko );


(function(ko){
	var Font = ko.ViewModel.createSubclass({
		mappeable: {
			fontFamily		: '',
			fontFamilyStyle	: ''
		}
	}, {
		prototype: {
			init: function( options ){
				this._parent.apply( this, arguments );
			},

			getDescriptor: function(){
				var result = this.fontFamily();
				if( this.fontFamilyStyle() ){
					result += ':' + this.fontFamilyStyle();
				}
				return result;
			}
		}
	});

	var FontGroup = ko.ViewModel.createSubclass({
		mappeable: {
			fonts: []
		},

		mapping: {
			fonts: {
				create: function( options ){
					return new Font( options.data );
				}
			}
		}

	}, {
		prototype: {
			init: function( options ){
				this._parent.apply( this, arguments );
			},

			getDescriptor: function(){
				return ko.utils.arrayMap( this.fonts(), function( font ){
					return font.getDescriptor();
				}).join('|');
			},

			addFont: function( font ){
				if( !( font instanceof Font ) ){
					var font = new Font( font );
				}
				this.fonts.push( font );
			},

			isEmpty: function(){
				return this.fonts().length == 0;
			}
		}
	});


	GFontApi = ko.ViewModel.createSubclass({
		mappeable: {
			_currentFontGroup	: 	{},
			_fontGroups			: 	[]
		},

		mapping: {
			_currentFontGroup: {
				create: function( options ){
					return new FontGroup( options.data );
				}
			}
		}
	},{
		_groupGapTime	: 100,
		prototype: {
			init: function( options ){
				this._parent.apply( this, arguments );
				$.extend( this, new $.Deferred() );
				this.options = $.extend({}, options );
				this._hashFonts = {};
				this._addFontTimeout = null;
			},

			_addFontsToGroup: function(){
				if( !this._currentFontGroup.isEmpty() ){
					this._fontGroups.push( this._currentFontGroup );
					this._currentFontGroup = new FontGroup();
				}
			},

			addFont: function( fontFamily, fontFamilyStyle ){
				var self = this;

				var font = new Font( { fontFamily: fontFamily, fontFamilyStyle: fontFamilyStyle } );
				if( !this._hashFonts[ font.getDescriptor() ] ){
					this._hashFonts[ font.getDescriptor() ] = true;
					this._currentFontGroup.addFont( font );

					clearInterval( this._addFontTimeout );
					this._addFontTimeout = setInterval( function(){
						self._addFontsToGroup();
					}, self.constructor._groupGapTime );
				}
			},

			getFontDescriptor: function( fontFamily, fontFamilyStyle ){
				var result = fontFamily;
				if( fontFamilyStyle ){
					result += ':' + fontFamilyStyle;
				}
				return result;
			},

			getLinks: function(){
				var self = this
					, result = ko.utils.arrayMap( this._fontGroups(), function( fontGroup ){
					var fontFamily = fontGroup.getDescriptor();
					return '<link href="https://fonts.googleapis.com/css?family=' + escape( fontFamily ) + '" rel="stylesheet" type="text/css">';
				});
				return result.join('\n');
			},

			getCss: function(){
				var self = this
					, result = ko.utils.arrayMap( this._fontGroups(), function( fontGroup ){
						var fontFamily = fontGroup.getDescriptor();
						return '@import url(https://fonts.googleapis.com/css?family=' + escape( fontFamily ) + ');';
					});
				return result.join('\n');
			}
		},

		getInstance: function( options ){
			if( !this._instance ){
				this._instance = new this( options );
			}
			return this._instance;
		}
	});
})(ko);


// nuevo checked similar a knockout3
(function( ko ) {
	if(!ko.utils.addOrRemoveItem) ko.utils.addOrRemoveItem = function(array, value, included) {
		var existingEntryIndex = array.indexOf ? array.indexOf(value) : ko.utils.arrayIndexOf(array, value);
		if (existingEntryIndex < 0) {
			if (included)
				array.push(value);
		} else {
			if (!included)
				array.splice(existingEntryIndex, 1);
		}
	};

	if(!ko.expressionRewriting.writeValueToProperty) ko.expressionRewriting.writeValueToProperty = function(property, allBindingsAccessor, key, value, checkIfDifferent) {
		if (!property || !ko.isObservable(property)) {
			var propWriters = allBindingsAccessor()['_ko_property_writers'];
			if (propWriters && propWriters[key])
				propWriters[key](value);
		} else if (ko.isWriteableObservable(property) && (!checkIfDifferent || property.peek() !== value)) {
			property(value);
		}
	}

	ko.bindingHandlers['checkedObject'] = {
		'init': function (element, valueAccessor, allBindingsAccessor) {
			var updateHandler = function() {
				var valueToWrite
				if (element.type == "checkbox") {
					valueToWrite = element.checked;
				} else if ((element.type == "radio") && (element.checked)) {
					valueToWrite = element.value;
				} else {
					return; // "checked" binding only responds to checkboxes and selected radio buttons
				}

				var valueData = element.value;

				if( allBindingsAccessor().checkedValue ){
					valueData = ko.unwrap( allBindingsAccessor().checkedValue );
					valueToWrite = valueData;
				}


				var modelValue = valueAccessor(), unwrappedValue = ko.utils.unwrapObservable(modelValue);
				if ((element.type == "checkbox") && ( unwrappedValue instanceof Array) ) {
					// For checkboxes bound to an array, we add/remove the checkbox value to that array
					// This works for both observable and non-observable arrays
					ko.utils.addOrRemoveItem(modelValue, valueData, element.checked);
				} else {
					ko.expressionRewriting.writeValueToProperty(modelValue, allBindingsAccessor, 'checked', valueToWrite, true);
				}
			};

			var modelValue = valueAccessor(),
				unwrappedValue = ko.utils.unwrapObservable(modelValue);
			if( ( unwrappedValue instanceof Array ) && allBindingsAccessor().checkedOptions ){
				ko.computed({
					read: function(){
						var modelValue = valueAccessor(),
							unwrappedValue = ko.utils.unwrapObservable(modelValue);

						var options = ko.unwrap( allBindingsAccessor().checkedOptions );

						$.each( unwrappedValue, function( index, value ){
							if( ko.utils.arrayIndexOf( options, value ) == -1 ){
								modelValue.remove( value );
							}
						});

						//console.debug( options, unwrappedValue );
					}
				}, this, { disposeWhenNodeIsRemoved: element } );
			}

			ko.utils.registerEventHandler(element, "click", updateHandler);

			// IE 6 won't allow radio buttons to be selected unless they have a name
			if ((element.type == "radio") && !element.name)
				ko.bindingHandlers['uniqueName']['init'](element, function() { return true });
		},
		'update': function (element, valueAccessor, allBindingsAccessor) {
			var value = ko.utils.unwrapObservable(valueAccessor());
			var valueData = element.value;

			if( allBindingsAccessor().checkedValue ){
				valueData = ko.unwrap( allBindingsAccessor().checkedValue );
			}

			if (element.type == "checkbox") {
				if (value instanceof Array) {
					// When bound to an array, the checkbox being checked represents its value being present in that array
					element.checked = ko.utils.arrayIndexOf(value, valueData ) >= 0;
				} else {
					// When bound to any other value (not an array), the checkbox being checked represents the value being trueish
					element.checked = value;
				}
			} else if (element.type == "radio") {
				element.checked = (valueData == value);
			}
		}
	};


	ko.bindingHandlers['checkedValue'] = {
		'getValue'	: function( element ){
			ko.utils.domData.get(element, 'bindingHandlers.checkedValue.value');
		},

		'setValue'	: function( element, value ){
			ko.utils.domData.set(element, 'bindingHandlers.checkedValue.value', value);

		},

		'update': function (element, valueAccessor) {
			ko.bindingHandlers['checkedValue'].setValue( element, ko.utils.unwrapObservable(valueAccessor()));
		}
	};


})(ko);

// option binding para usar con selects con groups
(function( ko ) {
	ko.bindingHandlers.option = {
		update: function(element, valueAccessor) {
			var value = ko.utils.unwrapObservable(valueAccessor());
			ko.selectExtensions.writeValue(element, value);
		}
	};
})(ko);



///////////////
(function( ko ) {
	ko.bindingHandlers.stopBindings = {
		init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {
			var value = ko.utils.unwrapObservable(valueAccessor());
			return { controlsDescendantBindings: true };
		},

		update: function(element, valueAccessor, allBindings, viewModel, bindingContext) {
			var value = ko.utils.unwrapObservable(valueAccessor());
			var data = ko.utils.domData.get( element, 'stopBindings.data' );
			if( !data ){
				data = {};
				ko.utils.domData.set( element, 'stopBindings.data', data );
			}

			if( value ){
				if( !data.binded ){
					//console.debug('creando child context');
					var childContext = bindingContext.createChildContext(viewModel);
					ko.applyBindingsToDescendants( childContext, element );
					data.binded = true;
				}
			} else {
				if( data.binded ){
					//console.debug('quitando child context');
					$(element).contents().each( function( index, element ){
						ko.cleanNode( element );
					})
					data.binded = false;

				}
			}

		}
	};
})(ko);


///////////////
(function( ko ) {
	if(!ko.dependencyDetection){
		ko.dependencyDetection = {}
	}

	if(!ko.dependencyDetection.ignore ) {
		ko.dependencyDetection.ignore = function (callback, callbackTarget, callbackArgs) {
			var result;
			ko.computed(function(){
				result = callback.apply(callbackTarget, callbackArgs || []);
			}).dispose();
			return result;
		}
	}

})(ko);


/* /js/libs/knockout.extensions.editables.js
 * compresion time: 0.02503 -(ms)
 * ----------------------------------------- */
// MODIFICADO POR LISANDRO PUZZOLO PARA QUE SOPORTE ARRAYS DE OBSERVABLES
// 
// 
// 
// ko.editables v0.9 for KnockoutJS
// https://github.com/romanych/ko.editables/
// http://romanych.github.com/ko.editables/
// editable extender and ko.editable plugin for viewModels
// (c) Roman Gomolko - rgomolko@gmail.com
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

/*
Exports: 
    ko.extenders.editable: ko.observable().extend({editable: true|false});
    ko.editable: ko.editable(objectWithObservables, boolean autoInit);

    Editable adds following methods into observables and objects:
        - beginEdit()
        - commit()
        - rollback()
        - hasChanges() - observable
		- inTransaction() - observable
*/

(function (ko, undefined) {
    var deferredDependentObservable = function (readFunction) {
        return ko.dependentObservable({read: readFunction, deferEvaluation: true});
    };

    var comparers = {
        'scalar': function (actualValue, originalValue) {
            return actualValue == originalValue;
        },
        'array': function (actualValue, originalValue) {
            actualValue = actualValue || [];
            originalValue = originalValue || [];
            if (actualValue.length != originalValue.length) {
                return false;
            }
            for (var i = 0; i < actualValue.length; i++) {
				if (actualValue[i].editable && typeof actualValue[i].hasChanges == 'function' && actualValue[i].hasChanges() ) return false;
				
                if (actualValue[i] !== originalValue[i]) {
                    return false;
                }
            }
            return true;
        }
    };

    ko.extenders['editable'] = function (target, enabledEditable) {
        enabledEditable = enabledEditable === undefined ? true : enabledEditable;
        // Protect from double initialization
        if (target.hasOwnProperty('editable')) {
            return target;
        }

        target.editable = enabledEditable;

        if (!enabledEditable) {
            return target;
        }

		
		var oldValue;
		var equalityComparer = comparers['scalar'];
        target.inTransaction = ko.observable(false);
		
		target.beginEdit = function(){
			if(target.inTransaction()) return;
			var currentValue = target();
			if(currentValue instanceof Array){
				currentValue = currentValue.slice(); // make copy
				equalityComparer = comparers['array'];
				$.each(currentValue, function(index, value){
					if (ko.isObservable(value)) {
						value.extend({editable: true});
					}
					if(value.editable !== false && typeof value.beginEdit == 'function') value.beginEdit();
				});
			}
			oldValue = currentValue;
			target.inTransaction(true);
		}
			
		target.commit = function(){
			target.inTransaction(false);
			var currentValue = target();
			if(currentValue instanceof Array){
				$.each(currentValue, function(index, value){
					if(value.editable && typeof value.commit == 'function') value.commit();
				});
			}
		};

		target.toggleEditRollback = function(){
			if( target.inTransaction() ){
				target.rollback();
			} else {
				target.beginEdit();
			}
		},

		target.rollback = function(){
			if(target.inTransaction()){
				target(oldValue);
				target.inTransaction(false);
				var currentValue = target();
				if(currentValue instanceof Array){
					$.each(currentValue, function(index, value){
						if(value.editable!==false && typeof value.rollback == 'function') value.rollback();
					});
				}
			}
		};

        target.hasChanges = deferredDependentObservable(function () {
			if(!target.inTransaction()) return;
			var hasChanges = false;
			if(ko.isObservableArray(target)){
				var current = target();
				if (!current || current.length != oldValue.length) return true;
				for (var i = 0 ; i < current.length ; i++ ){
					if(current[i] && current[i].editable!==false && typeof current[i].hasChanges == 'function' && current[i].hasChanges()) return true;
					if(current[i] != oldValue[i]) return true;
				}
			} else {
				hasChanges = target.inTransaction() && !equalityComparer(target(), oldValue);
			}
			return hasChanges;				
			
        });
		
		target.oldValue = ko.computed(function(){
			return oldValue;
		})

        return target;
    };





    ko.editable = function (viewModel, autoInit) {
        if (typeof (viewModel.beginEdit) == 'function') {
            return;
        }

        autoInit = autoInit === undefined ? true : autoInit;
        var editables = ko.observableArray();

        viewModel.beginEdit = function () {
            ko.utils.arrayForEach(editables(), function (obj) {
                obj.beginEdit();
            });
        };

        viewModel.commit = function () {
            ko.utils.arrayForEach(editables(), function (obj) {
                obj.commit();
            });
        };

        viewModel.rollback = function () {
            ko.utils.arrayForEach(editables(), function (obj) {
                obj.rollback();
            });
        };

        viewModel.addEditable = function (editable) {
            editables.push(editable.extend({editable: true}));
        };

        viewModel.hasChanges = deferredDependentObservable(function () {
            var editableWithChanges = ko.utils.arrayFirst(editables(), function (editable) {
                return editable.hasChanges();
            });
            return editableWithChanges != null;
        });

        if (autoInit) {
            (function makeEditable(rootObject) {
                for (var propertyName in rootObject) {
					var property = rootObject[propertyName];
                    if (ko.isWriteableObservable(property)) {
                        var observable = property;
                        observable.extend({editable: true});
                        // Allow to skip observables extended with { editable: false } arguments
                        if (observable.editable) {
                            editables.push(observable);
                        }
                    }
                    property = ko.utils.unwrapObservable(property);
                    if (typeof (property) == 'object') {
                        makeEditable(property);
                    }
                }
            })(viewModel);
        }
    };
})(ko);


/* /js/libs/knockout.extensions.xcolor.js
 * compresion time: 0.02289 -(ms)
 * -------------------------------------- */
ko.extenders.xColor = function(target) {
	if(!target.xcolor){
		target.xcolor = ko.computed(function(){
			return $.xcolor.test(target());
		}, this, {deferEvaluation: true});
		
		target.isDark = ko.computed(function(){
			var xcolor = target.xcolor();
			return xcolor && xcolor.getHSV().v < 60;
		}, this);
		
		target.contrastFn = ko.computed(function(){
			return target.isDark() ? 'lighten' : 'darken';
		}, this);

		target.setHSV = function(value){
			var xcolor = target.xcolor();
			if(xcolor){
				var hsv = xcolor.getHSV();
				$.extend(hsv, value)
				target( $.xcolor.test(hsv).getHex() );
			}
		};

		$.each($.xcolor, function(key, value){
			if(!target[key]) target[key] = function(){
				var args = $.makeArray(arguments);
				args.unshift(target());
				return $.xcolor[key].apply($.xcolor, args);
			}
		});
		
		$.each($.xcolor.test('#000'), function(key, value){
			if(key.indexOf('get')!=-1 && !target[key]){
				target[key] = function(){
					return target.xcolor()[key]();
				}
			}
		});
		

	}
	return target;
};


/* /js/libs/knockout.bindings.bootstrap.js
 * compresion time: 0.02384 -(ms)
 * --------------------------------------- */
/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 * 
 * <div data-bind="popover: true, popoverOptions: { template: 'hola mundo'} ">Aqu ir un popover</div>
 */


/**
 *
 * <div data-bind="popover: true, popoverOptions: { template: 'hola mundo', group: 'grupo1'} ">Aqu ir un popover</div>
 * si se abre un popover con el group "grupo1", todos los dems popovers del mismo grupo se cierran automticamente
 * en este caso, popover debe estar asignado a un writeableObservable.
 */

													
+function(ko){
	function getPopoverInstance( element ){
		return $(element).data('popover') || $(element).data('bs.popover');
	}

	ko.bindingHandlers['popover'] = {
		groups: {},

		init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {

			var uid = ko.utils.createUID()
				, allBindings = allBindingsAccessor()
				, options = $.extend(
					{
						html: true,
						trigger: 'manual'
					}, allBindings.popoverOptions)
				, groups = ko.bindingHandlers['popover'].groups;

			$(window).on('resize.bindingHandlers.popover.' + uid, function(){
				if( ko.unwrap( valueAccessor() ) ){
					$(element).popover( 'reposition' );
				}
			});

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				ko.bindingHandlers['popover']._destroyPopover( element );
				$(window).off('resize.bindingHandlers.popover.' + uid);
			});
		},

		_destroyPopover: function( element, options ) {
			var instance = getPopoverInstance(element);
			if (instance) {
				if ($.fn.removeResize) {
					var data = ko.utils.domData.get(element, 'popover.data');
					if (data && data.resizeHandle) {
						$tip = instance.tip();
						$tip.removeresize();
					}
				}
				ko.cleanNode( instance.options.content );
				$(element).popover('destroy');

				var data = ko.utils.domData.get( element, 'bindingHandlers.popover.data');
				var options = data.options;

				var groups = ko.bindingHandlers['popover'].groups;
				groups[options.group] && delete groups[options.group];
			}
		},

		update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var value = ko.unwrap(valueAccessor())
				, $popoverContentContainer
				, $popoverContent
				, allBindings = allBindingsAccessor()
				, timeoutCreate
				, options = $.extend({
					html	: true,
					trigger	: 'manual'
				}, allBindings.popoverOptions)
				, childContext
				, rawData
				, groups = ko.bindingHandlers['popover'].groups;

			var data = {
				'options' : options
			}
			ko.utils.domData.set( element, 'bindingHandlers.popover.data', data );

			var instance = getPopoverInstance( element );
			if( value) {
				if ( !instance ){
					var template = options.template
						, $tip;


					$popoverContentContainer = $('<div>');

					$.extend( options, {
						content	: $popoverContentContainer[0]
					});

					delete options.template;

					$(element).popover( options );
					$(element).popover( 'show' );
					instance = getPopoverInstance( element );

					$tip = instance.tip();

					if( $.fn.removeResize ){
						if( !data.hasResize ){
							$tip.resize( function(){
								instance.reposition();
							});
							data.hasResize = true;
						}
					}

					childContext = bindingContext;
					if( options.data ) childContext = bindingContext['createChildContext'](options.data);

					ko.applyBindingsToDescendants( childContext, $tip[0]); // para que el title tenga bindeos tambin

					ko.bindingHandlers['template']['init'](
						$popoverContentContainer[0],
						function(){
							return template
						},
						allBindingsAccessor,
						viewModel,
						childContext
					);

					ko.bindingHandlers['template']['update'](
						$popoverContentContainer[0],
						function(){
							return template } ,
						allBindingsAccessor,
						viewModel,
						childContext
					);

				}
			} else {
				if( instance ){
					ko.bindingHandlers['popover']._destroyPopover( element );
				}
			}

		}
	};


	ko.bindingHandlers['collapse'] = {
		init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var value = ko.utils.unwrapObservable(valueAccessor()),
				timeoutHandle;

			timeoutHandle = setTimeout(function(){
				//$(element).removeClass('collapse');
				$(element).collapse({toggle: false});
				ko.bindingHandlers['collapse'].update(element, valueAccessor);
			}, 0);

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				clearTimeout(timeoutHandle);
				if($(element).data('collapse')){
					$(element).removeData('collapse');
				}
			});

		},

		update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext){
			var value = ko.utils.unwrapObservable(valueAccessor());
			var collapse = $(element).data('collapse');
			if( collapse ){
				if( collapse.transitioning ){
					$(element).one( $(element).hasClass('in') ? 'shown' : 'hidden', function(){
						collapse[ value ? 'show' : 'hide']();
					})
				} else {
					collapse[ value ? 'show' : 'hide']();
				}
			}
		}
	};




	ko.bindingHandlers['carousel'] = {
		init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			// Make a modified binding context, with a extra properties, and apply it to descendant elements
			var $element = $(element),
				options = $.extend({}, valueAccessor()),
				innerBindingContext,
				timeoutHandle,
				carousel,
				newProperties = { carousel: function(){
					return carousel;
				}};


			innerBindingContext = bindingContext.extend( newProperties );

			timeoutHandle = setTimeout(function(){
				$('.carousel-indicators > *:first-child, .carousel-inner > .item:first-child', $element ).addClass( 'active' );
				$element.carousel( options );
				carousel = $element.data('carousel');
				if( options.pause === 'always' ){
					carousel.pause();
				}
			}, 0);


			ko.applyBindingsToDescendants(innerBindingContext, element);

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				clearTimeout(timeoutHandle);
				if ($element.data('carousel')) {
					$element.data('carousel').destroy && $element.data('carousel').destroy();
					$element.removeData('carousel');
				}
			});

			// Also tell KO *not* to bind the descendants itself, otherwise they will be bound twice
			return { controlsDescendantBindings: true };
		}

	};

	ko.bindingHandlers['tooltip'] = {
		init: function(element, valueAccessor, allBindingsAccessor, viewModel){
			var options = valueAccessor()
				,	allBindings = allBindingsAccessor();

			$(element).tooltip( options );

			ko.utils.domNodeDisposal.addDisposeCallback( element, function(){
				$(element).tooltip('destroy');
			});
		}
	}

	ko.bindingHandlers['ayudaTooltip'] = {
		init: function(element, valueAccessor, allBindingsAccessor, viewModel){
			var options = ko.unwrap( valueAccessor() )
				, $element = $(element)
				, uid = ko.utils.createUID()
				, icon = '<i class="mdi mdi-help-circle"></i>';

			function getPlacement() {
				var offset = $element.offset(),
					tolerance = 300,
					top = offset.top,
					left = offset.left,
					height = $(document).outerHeight(),
					width = $(document).outerWidth(),
				//vert = 0.5 * height - top,
					vert = height - top,
				//vertPlacement = vert > 0 ? 'bottom' : 'top',
					vertPlacement = top < tolerance ? 'bottom' : 'top',
				//horiz = 0.5 * width - left,
					horiz = width - left,
				//horizPlacement = horiz > 0 ? 'right' : 'left',
					horizPlacement = horiz < tolerance ? 'left' : 'right',
					placement = Math.abs(horiz) > Math.abs(vert) ?  horizPlacement : vertPlacement;

				return placement
			};

			$element.addClass('ayuda-tooltip');

			options = $.extend({
				placement   : getPlacement(),
				trigger     : 'hover',
				container   : 'body'
			}, options);

			$(element).append( icon );
			$(element).tooltip( options );

			$(window).on('resize.bindingHandlers.ayudaTooltip.' + uid, function(){

				if( options.placement != getPlacement() ){
					options.placement = getPlacement();
					$(element).tooltip('destroy');
					$(element).tooltip( options );
				}

			});


			ko.utils.domNodeDisposal.addDisposeCallback( element, function(){
				$(element).tooltip('destroy');
				$(window).off('resize.bindingHandlers.ayudaTooltip.' + uid);
				$element.removeClass('ayuda-tooltip');
			});
		}
	}
}(ko);


/* /js/libs/knockout.extensions.autosize.js
 * compresion time: 0.02694 -(ms)
 * ---------------------------------------- */
/**
 * autosize se encarga de solicitar al servidor una imagen en el tamao exacto requerida.
 * Por ahora, para poder realizarlo, primero solicita la imagen tal como fue colocada, y luego, tomando las dimensiones que ocup en el dom, solicita
 * otra con esas dimensiones, con lo cual es ms til para solicitar imagenes de mayor tamao que de menor tamao.
 * 
 * ejemplo: autosizeOptions = { width: function(w,h){ return w}, height: function(w,h){ return h} }
 * 
 */
(function(ko){
	var sizeCheckInterval = 1000; // every second
	var calculateSizeInterval = 100; //every 100 milliseconds
	//var calculateSizeInterval = 5000; //every 5 seconds

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// AUTOSIZE

	(function(ko, calculateSizeInterval ){
		var bindingName = 'autosize';

		ko.bindingHandlers[ bindingName ] = {
			init: function(element, valueAccessor, allBindingsAccessor, viewModel) {
				var value = ko.utils.unwrapObservable(valueAccessor()),
					allBindings = allBindingsAccessor(),
					width = ko.observable(),
					height = ko.observable(),
					options = $.extend({
						enable: true
					}, allBindings.autosizeOptions);

				function calculate(){
					// calcula el ancho y alto de la imagen ya colocada en el dom
					if(!ko.utils.unwrapObservable(value)) return;
					var newWidth = $(element).width(),
						newHeight = $(element).height(),
						tolerance = 5;

					if( Math.abs(newWidth - width.peek()) < tolerance ) newWidth = width.peek();
					if( Math.abs(newHeight - height.peek()) < tolerance ) newHeight = height.peek();

					width( newWidth );
					height( newHeight );
				}

				function translateSrcParameters (){
					// cambia parmetros del src de la imagen envindole a las funciones correspondientes el ancho y alto calculado del dom
					if (width() > 0 && height() > 0){
						var src = $(element).attr('src');
						var url = src.split('?');
						var params = $.deparam(url[1] || '');
						$.each(options, function(key, value){
							if(typeof value == 'function'){
								params[key] = value( width(), height() );
							}
						});
						src = url[0] + (url[1] ? '?' + $.param(params) : '');
						$(element).attr('src', src);
						$(element).css({'visibility': 'visible'});
					}
				}


				$(element).data( bindingName + '.interval',setInterval(calculate, calculateSizeInterval ));
				$(element).data( bindingName + '.width', width);

				ko.computed({
					read: function(){
						if(!ko.utils.unwrapObservable(value)) return;
						translateSrcParameters();
					},
					owner: this,
					disposeWhenNodeIsRemoved: element
				}).extend({throttle: 1000});

				ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
					clearInterval($(element).data( bindingName + '.interval' ) );
					$(element).removeData( bindingName + '.width' );
				});

			},

			update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
				var value = valueAccessor(),
					width = $(element).data( bindingName + '.width' ),
					allBindings = allBindingsAccessor(),
					options = $.extend({
						enable: true
					}, allBindings.autosizeOptions);

				if(ko.utils.unwrapObservable(value)){
					setTimeout(function(){
						width && width.valueHasMutated();
					},10);
				}
			}
		};
	})( ko, calculateSizeInterval );


	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// SRCAUTOSIZE
	(function(ko, calculateSizeInterval ){
		ko.bindingHandlers['srcautosize'] = {
			_autoRefine: true,

			_getDefaultOptions: function(){
				return {
					placeholder				: ko.NetworkInfo.getInstance().speed.slow.peek() ? 'lowres' : 'spacer', // 'spacer' | 'lowres'
					enable					: true,
					placeholdersizeratio	: 1/50
				};
			},

			_translateParams: function(width, height, params, options){
				$.each(options, function(key, value){
					if(typeof value === 'function'){
						params[key] = value( width, height );
					}
				});
			},

			_preloadPlaceholder: function(element, valueAccessor, allBindingsAccessor, viewModel){
				var	self = ko.bindingHandlers['srcautosize']
					, value = ko.unwrap(valueAccessor())
					, allBindings = allBindingsAccessor()
					, options = $.extend(self._getDefaultOptions(), ko.unwrap( allBindings.srcautosizeOptions) )

					, src = value || ''
					, srcQuery = $.string.trimToFirst(src,'?')
					, srcQueryOptions = $.deparam(srcQuery)
					, newSrcQueryOptions = $.extend( {}, srcQueryOptions )
					, originalRatio
					, newSrcQuery
					, newSrc
					, originalStyleHeight = element.style.height
					, originalPadding = element.style.padding;



				if( ! ( ko.unwrap( options.enable )
						&& srcQueryOptions.tipoEscala !== 'fit'
						&& $.isNumeric(srcQueryOptions.width)
						&& $.isNumeric(srcQueryOptions.height)
					)){
					$(element).attr('src', src);
					return;
				}

				ko.utils.domData.set(element, 'srcautosize.loadingplaceholder', true);
				ko.utils.domData.set(element, 'srcautosize.originalStyleHeight', originalStyleHeight);
				ko.utils.domData.set(element, 'srcautosize.originalPadding', originalPadding);
				ko.utils.domData.set(element, 'srcautosize.originalSrc', src);
				ko.utils.domData.set(element, 'srcautosize.originalOptions', options);
				ko.utils.domData.set(element, 'srcautosize.originalSrcQueryOptions', srcQueryOptions);
				$(element).attr('data-original-src', src );

				originalRatio = ko.utils.domData.get( element, 'srcautosize.originalRatio');

				ko.utils.domData.set( element, 'srcautosize.imgloadingstate', 'loadingplaceholder');

				if(options.placeholder === 'lowres' && srcQueryOptions.width > 100 ){
					newSrcQueryOptions.width = 32;
					newSrcQueryOptions.height = newSrcQueryOptions.width / originalRatio;
					this._translateParams(newSrcQueryOptions.width, newSrcQueryOptions.height, newSrcQueryOptions, options);
					newSrcQuery = $.param(newSrcQueryOptions);
					newSrc = $.string.trimFromFirst(src,'?') + '?' + newSrcQuery;
					this._setLowResSrc(element, newSrc);
				} else {
					newSrc = '/img/px.gif';
					this._translateParams(newSrcQueryOptions.width, newSrcQueryOptions.height, newSrcQueryOptions, options);
					this._setSpacerSrc(element, newSrc, newSrcQueryOptions.width / newSrcQueryOptions.height );
				}

			},

			_setLowResSrc: function(element, newSrc){
				$(element)
					.attr('src', newSrc);
			},

			_setSpacerSrc: function(element, newSrc, ratio){
				var ratio = ratio || ko.utils.domData.get( element, 'srcautosize.originalRatio' );

				$(element)
					.attr('src', newSrc)
					.css('height', '0px')
			},

			_getElementPreferredWidth: function( element ){
				var width
					, dimensionedParent
					, windowWidth = $(window).width()
					, srcQueryOptions = ko.utils.domData.get(element, 'srcautosize.originalSrcQueryOptions') || {}
					, devicePixelRatio = window.devicePixelRatio || 1;

				if($(element).is(":visible")){
					width =  $(element).width();
				}

				if( !$(element).is(":visible") || width < 2 ){
					dimensionedParent = $(element).dimensionedParent();
					if( dimensionedParent ) width = dimensionedParent.width();
					if( width < 2 ) width = undefined;
				}

				if( windowWidth < width || width == undefined ){
					width = windowWidth;
				}

				if( !$(element).is(":visible") && srcQueryOptions.width && srcQueryOptions.width < width ){
					width = srcQueryOptions.width;
				}

				if (!ko.NetworkInfo.getInstance().speed.slow.peek()) width *= devicePixelRatio;

				return width;
			},

			_loadImageAutoSize: function(element, src, options){
				var srcQuery = $.string.trimToFirst(src,'?')
					, srcQueryOptions = $.deparam(srcQuery)
					, newSrcQueryOptions = $.extend( {}, srcQueryOptions )
					, originalRatio = ko.utils.domData.get( element, 'srcautosize.originalRatio')
					, originalStyleHeight = ko.utils.domData.get( element, 'srcautosize.originalStyleHeight')
					, originalPadding = ko.utils.domData.get( element, 'srcautosize.originalPadding')
					, newSrcQuery
					, newSrc
					, width
					, height;


				width = this._getElementPreferredWidth(element);
				if( width == undefined ){
					width = srcQueryOptions.width;
				}

				height = width / originalRatio;
				if($.isNumeric(width) && $.isNumeric(height)){
					newSrcQueryOptions.width = width;
					newSrcQueryOptions.height = height;

					// si hay en options funciones, se las llama pasndoles width y height. Esto le permite "traducir" esos valores por otros si es necesario.
					this._translateParams(width, height, newSrcQueryOptions, options);

					newSrcQuery = $.param(newSrcQueryOptions);
					newSrc = $.string.trimFromFirst(src,'?') + '?' + newSrcQuery;


					var state = ko.utils.domData.get( element, 'srcautosize.imgloadingstate');
					ko.utils.domData.set( element, 'srcautosize.imgloadingstate', 'loadingimageautosize');

					if( state == 'placeholderloaded' || $(element).attr('src') == '/img/px.gif' ){
						var $tempImg = $('<img/>')
							.attr({'src' : newSrc})
							.css({position: 'absolute', top: -50000, left: -50000});

						$('body').append( $tempImg );

						function loadImageAfterPlaceHolderLoaded(){
							//console.debug('loadImageAfterPlaceHolderLoaded');
							if( $tempImg.width() > 0 && $tempImg.height() > 0){
								clearInterval( checkIntervalId );
								setTimeout( function(){
									$(element).removeAttr('src');
									setTimeout( function() {
										$(element).attr('src', newSrc);
										ko.utils.domData.set( element, 'srcautosize.imgloadingstate', 'loadingimageautosize');
										ko.bindingHandlers['srcautosize']._onImgLoad(element);
									},0);
									$tempImg.remove();
								}, 100 );
							}
						}

						var checkIntervalId = setInterval( loadImageAfterPlaceHolderLoaded, calculateSizeInterval );
						//loadImageAfterPlaceHolderLoaded();
						$tempImg.on('abort error', function(){
							$tempImg.remove();
							clearInterval( checkIntervalId );
						});

					} else {
						$(element).attr('src', newSrc);
					}

				}
			},

			_onImgLoad: function(element){
				var state = ko.utils.domData.get( element, 'srcautosize.imgloadingstate')
					, originalSrc = ko.utils.domData.get( element, 'srcautosize.originalSrc')
					, originalOptions = ko.utils.domData.get( element, 'srcautosize.originalOptions')
					, originalStyleHeight = ko.utils.domData.get( element, 'srcautosize.originalStyleHeight')
					, originalPadding = ko.utils.domData.get( element, 'srcautosize.originalPadding');

				switch( state ){
					case 'loadingplaceholder':
						setTimeout( function(){
							ko.bindingHandlers['srcautosize']._loadImageAutoSize(element, originalSrc, originalOptions);
						},100);
						ko.utils.domData.set( element, 'srcautosize.imgloadingstate', 'placeholderloaded');
						break;

					case 'loadingimageautosize':
						$(element)
							.css('height', originalStyleHeight )
							.css('padding', originalPadding );
						ko.utils.domData.set( element, 'srcautosize.imgloadingstate', '');
						break;
				}

				//console.debug("Img loaded", state );
			},

			_onImgError: function(element){
				var state = ko.utils.domData.get( element, 'srcautosize.imgloadingstate')
				//console.debug("Img error", state );
				ko.utils.domData.set( element, 'srcautosize.imgloadingstate', '');
			},

			_onImgAbort: function(element){
				var state = ko.utils.domData.get( element, 'srcautosize.imgloadingstate')
				//console.debug("Img abort", state );
				ko.utils.domData.set( element, 'srcautosize.imgloadingstate', '');
			},


			init: function(element, valueAccessor, allBindingsAccessor, viewModel) {
				var	self = ko.bindingHandlers['srcautosize']
					, allBindings = allBindingsAccessor()
					, options = $.extend(self._getDefaultOptions(), ko.unwrap( allBindings.srcautosizeOptions) )
					, args = arguments
					, sizeCheckIntervalId
					, shouldResizeImage = ko.observable(false);


				sizeCheckIntervalId = setInterval( function(){
					var src = $(element).attr('src') || ''
						, srcQuery = $.string.trimToFirst(src,'?')
						, srcQueryOptions = $.deparam(srcQuery)
						, actualWidth = self._getElementPreferredWidth(element);

					if( ( ko.unwrap( options.enable )
						&& srcQueryOptions.tipoEscala !== 'fit'
						&& $.isNumeric(srcQueryOptions.width)
						&& $.isNumeric(srcQueryOptions.height) )){

						if( self._autoRefine ){
							if( actualWidth > srcQueryOptions.width
								&& ko.utils.domData.get( element, 'srcautosize.imgloadingstate') == '' ){
								shouldResizeImage( true );
							}
						}
					}

				}, sizeCheckInterval);
				ko.utils.domData.set(element, 'srcautosize.interval', sizeCheckIntervalId);

				ko.computed({
					read: function(){
						var src = $(element).attr('src')
							, options = $.extend(self._getDefaultOptions(), ko.unwrap( allBindings.srcautosizeOptions) );

						if( shouldResizeImage() && !ko.utils.domData.get( element, 'srcautosize.imgloadingstate') ){
							self._loadImageAutoSize(element, src, options);
						}
						shouldResizeImage( false );
					},
					owner: this,
					disposeWhenNodeIsRemoved: element
				}).extend({throttle: 5000});


				var onLoadFn = function(){
					self._onImgLoad(element);
				}
				var onErrorFn = function(){
					self._onImgError(element);
				}
				var onAbortFn = function(){
					self._onImgAbort(element);
				}
				$(element).on('load', onLoadFn);
				$(element).on('error', onErrorFn);
				$(element).on('abort', onAbortFn);

				ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
					clearInterval ( ko.utils.domData.get(element, 'srcautosize.interval') );
					shouldResizeImage = null;
					$(element).off('load', onLoadFn);
					$(element).off('error', onErrorFn);
					$(element).off('abort', onAbortFn);
				});

			},

			update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
				var src = ko.unwrap( valueAccessor())
					, srcQuery = $.string.trimToFirst(src,'?')
					, srcQueryOptions = $.deparam(srcQuery)
					, originalRatio = srcQueryOptions.width && srcQueryOptions.height ? srcQueryOptions.width / srcQueryOptions.height : 0;

				ko.utils.domData.set( element, 'srcautosize.originalRatio', originalRatio);

				ko.bindingHandlers['srcautosize']._preloadPlaceholder.apply( ko.bindingHandlers['srcautosize'], arguments );
			}
		};
	})(ko, calculateSizeInterval );



})(ko);


/* /js/libs/knockout.extensions.imageScale.js
 * compresion time: 0.02289 -(ms)
 * ------------------------------------------ */
/**
 * imageScaleOptions: { align:, scale:, parent:, hideParentOverflow:, callback: }
 */

ko.bindingHandlers.imageScale = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel){
		var value = ko.unwrap( valueAccessor() )
			, allBindings = allBindingsAccessor()
			, $image = $(element);
		
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			if ( $image.data('ko.bindingHandlers.imageScale.value') ){
				$image.imageScale( 'destroy' );				
			}
		});	
		
	},
   
	update: function(element, valueAccessor, allBindingsAccessor, viewModel){
		var value = ko.unwrap( valueAccessor() )
			, allBindings = allBindingsAccessor()
			, $image = $(element)
			, options = $.extend({}, allBindingsAccessor().imageScaleOptions )
			, imageScale = $image.data('imageScale');
		

		if( value != $(element).data('ko.bindingHandlers.imageScale.value') ){
			if(value) {
				$image.imageScale( options );
				$image.on('load', function(){
					if( $image.data('imageScale') ) {
						$image.imageScale('recalc');
						$image.addClass('in');
					}
				});
					
			} else {
				if( $(element).data('ko.bindingHandlers.imageScale.value') === false ){
					$image.imageScale('destroy');					
				}
			}
		} else {
			if( value && imageScale ){
				if(options.scale) imageScale.options.scale = options.scale;
				if(options.align) imageScale.options.align = options.align;
				imageScale.recalc();
			}
		}
		
		$image.data('ko.bindingHandlers.imageScale.value', value);
		
	}
};


/* /js/libs/knockout.extensions.easyzoom.js
 * compresion time: 0.02217 -(ms)
 * ---------------------------------------- */
(function( $, ko ) {

	// Export the binding
	ko.bindingHandlers.easyzoom = {
		'api' : null,
		'init': function( element, valueAccessor, allBindings, viewModel ) {
			var value = ko.utils.unwrapObservable(valueAccessor())
				, options = allBindings().easyzoomOptions || {}
				, $element = $( element )
				, $container = $element.parents('a').parent()
				, startTime, endTime;

			options = $.extend({
				fade                : 500,
				loadingNotice       : '<i class="fa fa-spin fa-circle-o-notch fa-lg"></i>',
				errorNotice         : 'Error.',
				errorDuration       : 0,
				overlay             : true
			}, options);

			if( $element.is('img') ){
				if( value ){
					$container.addClass('easyzoom');
					if( options.overlay ) $container.addClass('easyzoom--overlay');
					var api = $container.easyZoom( options );
					ko.bindingHandlers.easyzoom['api'] = api.data('easyZoom');
				}
			}

			// To prevent a memory leak, ensure that the underlying element's disposal destroys it's associated editor.
			ko.utils['domNodeDisposal'].addDisposeCallback( element, function() {
				var api = ko.bindingHandlers.easyzoom['api'];
				if( api ) {
					api.teardown();
				}
			});
		},
		'update': function( element, valueAccessor, allBindings, viewModel ) {
			var value = ko.utils.unwrapObservable(valueAccessor())
				, options = allBindings().imagezoomOptions || {}
				, $element = $( element );
		}

	};

})( jQuery, ko );


/* /js/libs/knockout.extensions.onscreen.js
 * compresion time: 0.02384 -(ms)
 * ---------------------------------------- */
;(function(ko){

	/**
	 *
	 * @param callback
	 * @param name
	 * @param immediately // si est en true, se ejecuta inmediatamente, esto mejora la respuesta visual, pero puede perjudicar la performance
	 */
	function doOncePerFrame( callback, name, immediately ){
		if(!doOncePerFrame['ticks'][name]){
			doOncePerFrame['ticks'][name] = true;
			if( immediately ){
				callback();
				requestAnimationFrame(function(){
					doOncePerFrame['ticks'][name] = false;
				});
			} else {
				requestAnimationFrame(function(){
					callback();
					doOncePerFrame['ticks'][name] = false;
				});
			}
		}
	}

	doOncePerFrame['ticks'] = {};


	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	var bindingName = 'onScreen';

	var defaultOptions = {
		'parent'			: window,
		'checkImmediately'	:  false
	};
	
	var self = ko.bindingHandlers[ bindingName ] = {
		_styleSheetWasAdded: function( url ){
			return $('link').filter(function(index, link){ return $(link).attr('href') == url }).length != 0;
		},
		
		_addStyleSheet: function( url ){
			if( !self._styleSheetWasAdded( url ) ){
				var $link = $('<link>').attr('rel', 'stylesheet').attr('href', url );
				$('head').append($link);				
			}
		},
		
		_globalInit: function(){
			if( !self._globalInitialized ){
				self._addStyleSheet( '/css/landing/animations.css' );
				$.fixScrollFlickering();
				self._globalInitialized = true;				
			}
		},

		_onEnterScreen: function( element, cssClass, options ){
			var newProperties = ko.utils.domData.get( element, bindingName + '.newProperties' )
				, enterScreenTimes = ko.utils.domData.get( element, bindingName + '.enterScreenTimes' ) || 0;

			if( !ko.unwrap( options.onlyOnce ) || enterScreenTimes < 1 ){
				ko.utils.domData.set(element, bindingName, true);
				newProperties.$onScreen.active( true );
				if( cssClass ) $(element).addClass( cssClass );
			}
			if( cssClass ) $(element).addClass( 'was-' + cssClass );
			newProperties.$onScreen.wasActive( true );

			ko.utils.domData.set( element, bindingName + '.enterScreenTimes', enterScreenTimes + 1 );
		},

		_onLeaveScreen: function( element, cssClass, options ){
			var newProperties = ko.utils.domData.get( element, bindingName + '.newProperties' )
				, leaveScreenTimes = ko.utils.domData.get( element, bindingName + '.leaveScreenTimes' ) || 0
				, enterScreenTimes = ko.utils.domData.get( element, bindingName + '.enterScreenTimes' ) || 0;
				
			if( !ko.unwrap( options.onlyOnce ) || enterScreenTimes < 1 ){
				ko.utils.domData.set(element, bindingName, false);					
				newProperties.$onScreen.active( false );			
				if( cssClass ) $(element).removeClass( cssClass );
			}
			
			ko.utils.domData.set( element, bindingName + '.leaveScreenTimes', leaveScreenTimes + 1 );
		},
			
		_docheck: function( element, options ){
			var options = $.extend( { 'container' : options.parent }, options );
			var outside = $(element).isOutsideWindow( options )
				, removed = ko.utils.domData.get( element, bindingName + '.removed' )
				, newProperties = ko.utils.domData.get( element, bindingName + '.newProperties' )
				, cssClass = options.css
				, enable = ko.utils.domData.get( element, bindingName + '.enable' );
				
			if( !removed && enable ){
				newProperties.$onScreen.relativeTop( outside.relativeTop );
				newProperties.$onScreen.absoluteVerticalMiddle( outside.absoluteVerticalMiddle );
				newProperties.$onScreen.relativeVerticalMiddle( outside.relativeVerticalMiddle );
				newProperties.$onScreen.absoluteTop( outside.absoluteTop);
				newProperties.$onScreen.absoluteBottom( outside.absoluteBottom);
				newProperties.$onScreen.relativeBottom( outside.relativeBottom);

				newProperties.$offScreen.relativeTop( outside.offscreen.relativeTop);
				newProperties.$offScreen.relativeBottom( outside.offscreen.relativeBottom);

				if(outside.top < 2 && outside.bottom < 2){
					if(!ko.utils.domData.get(element, bindingName)){
						self._onEnterScreen( element, cssClass, options );
					}
				} else {						
					if(ko.utils.domData.get(element, bindingName)){
						self._onLeaveScreen( element, cssClass, options );
					}
				}

				if( options.onMove ){
					options.onMove( outside );
				}

			}
		},
		
		_check: function( element, options ){
			var data = ko.utils.domData.get( element, bindingName + '.data' );
			var bindingOptions = ko.utils.domData.get( element, bindingName + '.options' );
			if( data ){
				var executeImmediately = bindingOptions.checkImmediately;
				doOncePerFrame(function(){
					self._docheck( element, options );
				}, 'docheck:' + data.uid, executeImmediately );
				/*
				if( !data.ticking ){
					data.ticking = true;
					self._docheck( element, options );
					requestAnimationFrame( function(){
						data.ticking = false;
					});
				}*/
			}
		},


		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var bindingId = Math.random()
				, scrollEventName = 'scroll.' + bindingName + '.' + bindingId
				, slideEventName = 'slide.' + bindingName + '.' + bindingId
				, newProperties = {
					'$onScreen'		: {
						'active'					: ko.observable( false ),
						'wasActive'					: ko.observable( false ),

						'absoluteTop'				: ko.observable(),
						'relativeTop'				: ko.observable(.5),
						'absoluteVerticalMiddle' 	: ko.observable(0),
						'relativeVerticalMiddle' 	: ko.observable(.5),

						'relativeBottom'			: ko.observable(),
						'absoluteBottom'			: ko.observable()
					},
					'$offScreen'	: {
						'relativeTop'				: ko.observable(),
						'relativeBottom'			: ko.observable()
					}
				}
				, innerBindingContext = bindingContext.extend(newProperties)
				, options = $.extend( {}, defaultOptions, ko.unwrap( allBindings()[bindingName + 'Options']) )
				, data = {}

			self._globalInit();

			data['uid'] = ko.utils.createUID();
			////////////////////////////////////////////////////////////////////////

			ko.utils.domData.set( element, bindingName + '.options', options );
			ko.utils.domData.set( element, bindingName + '.data', data );
			ko.utils.domData.set( element, bindingName + '.newProperties', newProperties );
			ko.utils.domData.set( element, bindingName + '.id', bindingId );

			////////////////////////////////////////////////////////////////////////

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				self._unbind( element );
				ko.utils.domData.set( element, bindingName + '.removed', true );
			});

			////////////////////////////////////////////////////////////////////////
			ko.applyBindingsToDescendants(innerBindingContext, element);

			// Also tell KO *not* to bind the descendants itself, otherwise they will be bound twice
			return { controlsDescendantBindings: true };


		},
		
		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var value = ko.unwrap( valueAccessor() )
				, alreadyEnable = ko.utils.domData.get( element, bindingName + '.enable' ) || false
				, bindingId = ko.utils.domData.get( element, bindingName + '.id' )
				, scrollEventName = 'scroll.' + bindingName + '.' + bindingId
				//, touchmoveEventName = 'touchmove.' + bindingName + '.' + bindingId
				, slideEventName = 'slide.' + bindingName + '.' + bindingId
				, slidEventName = 'slid.' + bindingName + '.' + bindingId
				, slidingEventName = 'sliding.' + bindingName + '.' + bindingId
				, options = $.extend({
					parent			: window,
					granularity		: 100,
					css				: ''
				}, ko.unwrap( allBindings()[bindingName + 'Options']) )
				, newProperties = ko.utils.domData.get( element, bindingName + '.newProperties' )
				, data = ko.utils.domData.get( element, bindingName + '.data');

			ko.utils.domData.set( element, bindingName + '.options', options );

			if( value && !alreadyEnable ){
				//$( options.parent ).on( touchmoveEventName, self._check.bind(self, element, options ));

				data.onscroll = self._check.bind( self, element, options );
				document.addEventListener('scroll', data.onscroll , true);

				//$( options.parent ).on( scrollEventName, self._check.bind(self, element, options ));

				$( options.parent ).on( slideEventName, self._check.bind(self, element, options ));
				$( options.parent ).on( slidEventName, self._check.bind(self, element, options ));
				$( options.parent ).on( slidingEventName, self._check.bind(self, element, options ));

				setTimeout( function(){
					data.onscroll();
					$( options.parent ).trigger( scrollEventName );
				}, 10);
			}
			
			if( !value && alreadyEnable ){
				self._unbind( element );
			}
			
			ko.utils.domData.set( element, bindingName + '.enable', value );
		},

		_unbind: function( element ){
			var options = ko.utils.domData.get( element, bindingName + '.options');
			var data = ko.utils.domData.get( element, bindingName + '.data');

			$( options.parent ).off( bindingName );
			document.removeEventListener('scroll', data.onscroll , true);
		}
	};
})(ko);


/* /js/libs/knockout.extensions.onresize.js
 * compresion time: 0.02193 -(ms)
 * ---------------------------------------- */
/**
 * onresize
 */

ko.bindingHandlers['onresize'] = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
		var value = ko.utils.unwrapObservable(valueAccessor()),
			allBindings = allBindingsAccessor(),
			width = ko.observable(),
			height = ko.observable(),
			options = $.extend({
				'enable': true,
				'as'	: null
			}, allBindings.onresizeOptions),
			initTimeout;

		
		function onResize(){
			var args = $.makeArray(arguments);
			args.push(element);
			if(typeof value == 'function') value.apply($(element), args);
			width( $(element).outerWidth() );
			height( $(element).outerHeight() );
		};
		
		initTimeout = setTimeout( function(){
			if ( options.trigger ) {
				ko.computed({
					read: function() {
						ko.utils.unwrapObservable( options.trigger );
						onResize();
					},
					disposeWhenNodeIsRemoved: element
				}, this);
			} 
			onResize();				


		}, 0 );
		
		$(window).on('resize.ko-onresize', element, onResize);
					
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			clearTimeout(initTimeout);
			$(window).off('resize.ko-onresize', onResize);
		});


		////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		if( options.as ){
			var newProperties = {};
			newProperties[ options.as ] = {
				'width'					: width,
				'height'				: height
			}
			var innerBindingContext = bindingContext.extend(newProperties)
			ko.applyBindingsToDescendants(innerBindingContext, element);
			return { controlsDescendantBindings: true };
		}
	},
				
	update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
	}
};


/* /js/libs/knockout.extensions.typein.js
 * compresion time: 0.02193 -(ms)
 * -------------------------------------- */
;(function(ko) {
	var bindingName = 'typein'
		, defaultOptions = {
			speed: 100,
			animate: true
		}

	ko.bindingHandlers[bindingName] = {
		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, bindingId = Math.random()
				, $ghost = null
				, $container = $('<span>')
			////////////////////////////////////////////////////////////////////////

			$ghost = $(element)
				.clone()
				.attr({'data-bind': null})
				.animdetector()
				.on('animationstart', function(){
					self._stopAnimation( element );
				})
				.on('animationend', function(){
					self._startAnimation( element );
				});

			$container.css({
				position: 'relative',
				display	: 'inline-block'
			})
			$(element).before( $container );

			$container
				.append($(element))
				.append($ghost);

			//$(element).after( $ghost );
			ko.utils.domData.set( element, 'bindingName:ghost', $ghost );
			ko.utils.domData.set( element, 'bindingName:container', $container );

			$ghost.css({visibility: 'hidden'});
			$(element).css({position: 'absolute', top: 0, left: 0});

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				$container.remove();
				self._stopAnimation( element );
				$(element).off('enterscreen.' + bindingName);
				$(element).off('leavescreen.' + bindingName);
				$ghost.off('animationend, animationstart').remove();
			});

			////////////////////////////////////////////////////////////////////////
			//ko.bindingHandlers[bindingName].update.apply( ko.bindingHandlers[bindingName], arguments );
			return { 'controlsDescendantBindings': true };
		},

		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var typinginterval = ko.utils.domData.get( element, 'typinginterval')
				, options = $.extend( {}, defaultOptions, allBindings()[bindingName+'Options'])
				, text = self._getText( element )
				, newText = ko.unwrap( valueAccessor() )
				, animate = ko.unwrap( options.animate )
				, $ghost = ko.utils.domData.get( element, 'bindingName:ghost')
				, $container = ko.utils.domData.get( element, 'bindingName:container');

			//console.debug( options, allBindings()[bindingName+'Options'] );
			ko.utils.domData.set( element, bindingName + '_options', options );

			ko.bindingHandlers.text.update( $ghost[0], function(){ return newText } );

			if( animate == 'onscreen' ){
				$container.off('enterscreen.' + bindingName);
				$container.on('enterscreen.' + bindingName, function(){
					//console.debug('enterscreen');
					$ghost.addClass('go');
					self._setText( element, newText );
					self._startAnimationDelayed( element );
				});
				$container.off('leavescreen.' + bindingName);
				$container.on('leavescreen.' + bindingName, function(){
					//console.debug('leavescreen');
					$ghost.removeClass('go');
					self._stopAnimation( element, newText );
				});
			} else {
				if( text != newText && animate ){
					self._startAnimation( element, newText );
				}

				if( animate && !self._isAnimating( element ) ){
					self._startAnimation( element, newText );
				}

				if( !animate && self._isAnimating( element ) ){
					self._pauseAnimation( element );
				}
			}
		},

		_startAnimationDelayed: function( element ){
			var delayedstart = ko.utils.domData.get( element, bindingName + '_delayedstart');
			clearTimeout( delayedstart );
			delayedstart = setTimeout( function(){
				self._startAnimation( element );
			}, 500 );
			ko.utils.domData.set( element, bindingName + '_delayedstart', delayedstart );
		},

		_doAnimation: function( element ){
			var text = self._getText( element )
				, characterIndex = ko.utils.domData.get( element, bindingName + '_characterIndex')
				, options = ko.utils.domData.get( element, bindingName + '_options' );

			if( self._isAnimationEnded( element ) ){
				self._pauseAnimation( element );
			} else {
				characterIndex++;
				var newText = text.substr( 0, characterIndex );
				ko.bindingHandlers.text.update( element, function(){ return newText } );
				ko.utils.domData.set( element, bindingName + '_characterIndex', characterIndex );
			}
		},

		_getTextLength: function( element ){
			var text = self._getText( element );
			return (text && text.length) || 0;
		},

		_getText: function( element ){
			return ko.utils.domData.get( element, bindingName + '_text');
		},

		_isAnimationEnded: function( element ){
			var text = self._getText( element )
				, characterIndex = ko.utils.domData.get( element, bindingName + '_characterIndex');

			var textLength = self._getTextLength( element );
			return ( characterIndex >= textLength );
		},

		_stopAnimation: function( element ){
			self._pauseAnimation( element );
			ko.bindingHandlers.text.update( element, function(){ return '' } );
		},

		_pauseAnimation: function( element ){
			var typinginterval = ko.utils.domData.get( element, bindingName + '_typinginterval')
				, delayedstart = ko.utils.domData.get( element, bindingName + '_delayedstart');

			clearInterval( typinginterval );
			clearTimeout( delayedstart );
			ko.utils.domData.set( element, bindingName + '_typinginterval', null);
		},


		_isAnimating: function( element ){
			return !!ko.utils.domData.get( element, bindingName + '_typinginterval');
		},

		_startAnimation: function( element, text ){
			var typinginterval = ko.utils.domData.get( element, bindingName + '_typinginterval')
				, characterIndex = 0
				, options = ko.utils.domData.get( element, bindingName + '_options' )
				, speed = options.speed;

			self._stopAnimation( element );

			ko.utils.domData.set( element, bindingName + '_characterIndex', characterIndex );
			self._setText( element, text );
			typinginterval = setInterval( function(){
				self._doAnimation( element );
			}, speed );
			ko.utils.domData.set( element, bindingName + '_typinginterval', typinginterval );
		},

		_setText: function( element, text ){
			if( text !== undefined ) ko.utils.domData.set( element, bindingName + '_text', text);
		}
	}

	var self = ko.bindingHandlers[bindingName];
})( ko );


/* /js/libs/ko.observableDictionary-0.1.js
 * compresion time: 0.02313 -(ms)
 * --------------------------------------- */
// Knockout Observable Dictionary
// (c) James Foster
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

(function() {
    function DictionaryItem(key, value, dictionary) {
        var observableKey = new ko.observable(key);
        this.value = ko.observable(value);
        this.key = new ko.computed({
            read: observableKey,
            write: function(newKey) {
                var current = observableKey();

                if (current == newKey) return;

                // no two items are allowed to share the same key.
                dictionary.remove(newKey);

                observableKey(newKey);
            }
        });
    }

    ko.observableDictionary = function(dictionary) {
        var observable = new ko.observableArray();

        for (var key in dictionary) {
            if (dictionary.hasOwnProperty(key)) {
                observable.push(new DictionaryItem(key, dictionary[key], observable));
            }
        }
        
        observable._wrappers = {};

        ko.utils.extend(observable, ko.observableDictionary['fn']);

        return observable;
    };

    ko.observableDictionary['fn'] = {
        remove: function(valueOrPredicate) {
            var predicate = valueOrPredicate;

            if (typeof valueOrPredicate == "DictionaryItem") {
                predicate = function(item) {
                    return item.key() === valueOrPredicate.key();
                };
            }
            else if (typeof valueOrPredicate != "function") {
                predicate = function(item) {
                    return item.key() === valueOrPredicate;
                };
            }

            ko.observableArray['fn'].remove.call(this, predicate);
        },

        push: function(key, value) {
            // handle the case where only a DictionaryItem is passed in
            var item;

            if (typeof key == "DictionaryItem") {
                item = key;
                key = key.key();
                value  = key.value();
            }

            var current = this.get(key, false);
            if (current) {
                // update existing value
                current(value);
                return current;
            }

            if (!item) {
                item = new DictionaryItem(key, value, this);
            }

            return ko.observableArray['fn'].push.call(this, item);
        },

        sort: function(method) {
            if (method === undefined) {
                method = function(a, b) {
                    return defaultComparison(a.key(), b.key());
                };
            }

            return ko.observableArray['fn'].sort.call(this, method);
        },

        indexOf: function(key) {
            if (typeof key == "DictionaryItem") {
                return ko.observableArray['fn'].indexOf.call(this, key);
            }

            var underlyingArray = this();
            for (var index = 0; index < underlyingArray.length; i++) {
                if (underlyingArray[index].key() == key) return index;
            }
        },

        get: function(key, wrap) {
            if (wrap == false)
                return getValue(key, this());
            
            var wrapper = this._wrappers[key];
            
            if (wrapper == null) {
                wrapper = this._wrappers[key] = new ko.computed({
                    read: function() {
                        var value = getValue(key, this());
                        return value ? value() : null;
                    },
                    write: function(newValue) {
                        var value = getValue(key, this());

                        if (value)
                            value(newValue);
                        else
                            this.push(key, newValue);
                    }
                }, this);
            }

            return wrapper;
        },

        set: function(key, value) {
            return this.push(key, value);
        }
    };

    function getValue(key, dictionary) {
        var found = ko.utils.arrayFirst(dictionary, function(item) {
            return item.key() == key;
        })
        return found ? found.value : null;
    }
})();


// Utility methods
// ---------------------------------------------
function isNumeric(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
}

function defaultComparison(a, b) {
    if (isNumeric(a) && isNumeric(b)) return a - b;

    a = a.toString();
    b = b.toString();

    return a == b ? 0 : (a < b ? -1 : 1);
}
// ---------------------------------------------;


/* /js/libs/knockout.validation-2.0.3.lisandro.js
 * compresion time: 0.03099 -(ms)
 * ---------------------------------------------- */
/*=============================================================================
	Author:			Eric M. Barnard - @ericmbarnard								
	License:		MIT (http://opensource.org/licenses/mit-license.php)		
																				
	Description:	Validation Library for KnockoutJS							
	Version:		2.0.3											
===============================================================================
*/
/*globals require: false, exports: false, define: false, ko: false */

(function (factory) {
	// Module systems magic dance.

	if (typeof require === "function" && typeof exports === "object" && typeof module === "object") {
		// CommonJS or Node: hard-coded dependency on "knockout"
		factory(require("knockout"), exports);
	} else if (typeof define === "function" && define["amd"]) {
		// AMD anonymous module with hard-coded dependency on "knockout"
		define(["knockout", "exports"], factory);
	} else {
		// <script> tag: use the global `ko` object, attaching a `mapping` property
		factory(ko, ko.validation = {});
	}
}(function ( ko, exports ) {

	if (typeof (ko) === 'undefined') {
		throw new Error('Knockout is required, please ensure it is loaded before loading this validation plug-in');
	}

	// create our namespace object
	ko.validation = exports;

	var kv = ko.validation,
		koUtils = ko.utils,
		unwrap = koUtils.unwrapObservable,
		forEach = koUtils.arrayForEach,
		extend = koUtils.extend;
;/*global ko: false*/

var defaults = {
	registerExtenders: true,
	messagesOnModified: true,
	errorsAsTitle: true,            // enables/disables showing of errors as title attribute of the target element.
	errorsAsTitleOnModified: false, // shows the error when hovering the input field (decorateElement must be true)
	messageTemplate: null,
	insertMessages: true,           // automatically inserts validation messages as <span></span>
	parseInputAttributes: false,    // parses the HTML5 validation attribute from a form element and adds that to the object
	writeInputAttributes: false,    // adds HTML5 input validation attributes to form elements that ko observable's are bound to
	decorateInputElement: false,         // false to keep backward compatibility
	decorateElementOnModified: true,// true to keep backward compatibility
	errorClass: null,               // single class for error message and element
	errorElementClass: 'validationElement',  // class to decorate error element
	errorMessageClass: 'validationMessage',  // class to decorate error message
	allowHtmlMessages: false,		// allows HTML in validation messages
	grouping: {
		deep: false,        //by default grouping is shallow
		observable: true,   //and using observables
		live: false		    //react to changes to observableArrays if observable === true
	},
	validate: {
		// throttle: 10
	}
};

// make a copy  so we can use 'reset' later
var configuration = extend({}, defaults);

configuration.html5Attributes = ['required', 'pattern', 'min', 'max', 'step'];
configuration.html5InputTypes = ['email', 'number', 'date'];

configuration.reset = function () {
	extend(configuration, defaults);
};

kv.configuration = configuration;
;kv.utils = (function () {
	var seedId = new Date().getTime();

	var domData = {}; //hash of data objects that we reference from dom elements
	var domDataKey = '__ko_validation__';

	return {
		isArray: function (o) {
			return o.isArray || Object.prototype.toString.call(o) === '[object Array]';
		},
		isObject: function (o) {
			return o !== null && typeof o === 'object';
		},
		isNumber: function(o) {
			return !isNaN(o);	
		},
		isObservableArray: function(instance) {
			return !!instance &&
					typeof instance["remove"] === "function" &&
					typeof instance["removeAll"] === "function" &&
					typeof instance["destroy"] === "function" &&
					typeof instance["destroyAll"] === "function" &&
					typeof instance["indexOf"] === "function" &&
					typeof instance["replace"] === "function";
		},
		values: function (o) {
			var r = [];
			for (var i in o) {
				if (o.hasOwnProperty(i)) {
					r.push(o[i]);
				}
			}
			return r;
		},
		getValue: function (o) {
			return (typeof o === 'function' ? o() : o);
		},
		hasAttribute: function (node, attr) {
			return node.getAttribute(attr) !== null;
		},
		getAttribute: function (element, attr) {
			return element.getAttribute(attr);
		},
		setAttribute: function (element, attr, value) {
			return element.setAttribute(attr, value);
		},
		isValidatable: function (o) {
			return !!(o && o.rules && o.isValid && o.isModified);
		},
		insertAfter: function (node, newNode) {
			node.parentNode.insertBefore(newNode, node.nextSibling);
		},
		newId: function () {
			return seedId += 1;
		},
		getConfigOptions: function (element) {
			var options = kv.utils.contextFor(element);

			return options || kv.configuration;
		},
		setDomData: function (node, data) {
			var key = node[domDataKey];

			if (!key) {
				node[domDataKey] = key = kv.utils.newId();
			}

			domData[key] = data;
		},
		getDomData: function (node) {
			var key = node[domDataKey];

			if (!key) {
				return undefined;
			}

			return domData[key];
		},
		contextFor: function (node) {
			switch (node.nodeType) {
				case 1:
				case 8:
					var context = kv.utils.getDomData(node);
					if (context) { return context; }
					if (node.parentNode) { return kv.utils.contextFor(node.parentNode); }
					break;
			}
			return undefined;
		},
		isEmptyVal: function (val) {
			if (val === undefined) {
				return true;
			}
			if (val === null) {
				return true;
			}
			if (val === "") {
				return true;
			}
		},
		getOriginalElementTitle: function (element) {
			var savedOriginalTitle = kv.utils.getAttribute(element, 'data-orig-title'),
				currentTitle = element.title,
				hasSavedOriginalTitle = kv.utils.hasAttribute(element, 'data-orig-title');

			return hasSavedOriginalTitle ?
				savedOriginalTitle : currentTitle;
		},
		async: function (expr) {
			if (window.setImmediate) { window.setImmediate(expr); }
			else { window.setTimeout(expr, 0); }
		},
		forEach: function (object, callback) {
			if (kv.utils.isArray(object)) {
				return forEach(object, callback);
			}
			for (var prop in object) {
				if (object.hasOwnProperty(prop)) {
					callback(object[prop], prop);
				}
			}
		}
	};
}());;var api = (function () {

	var isInitialized = 0,
		configuration = kv.configuration,
		utils = kv.utils;

	function cleanUpSubscriptions(context) {
		forEach(context.subscriptions, function (subscription) {
			subscription.dispose();
		});
		context.subscriptions = [];
	}

	function dispose(context) {
		if (context.options.deep) {
			forEach(context.flagged, function (obj) {
				delete obj.__kv_traversed;
			});
			context.flagged.length = 0;
		}

		if (!context.options.live) {
			cleanUpSubscriptions(context);
		}
	}

	function runTraversal(obj, context) {
		context.validatables = [];
		cleanUpSubscriptions(context);
		traverseGraph(obj, context);
		dispose(context);
	}

	function traverseGraph(obj, context, level) {
		var objValues = [],
			val = obj.peek ? obj.peek() : obj;

		if (obj.__kv_traversed === true) {
			return;
		}

		if (context.options.deep) {
			obj.__kv_traversed = true;
			context.flagged.push(obj);
		}

		//default level value depends on deep option.
		level = (level !== undefined ? level : context.options.deep ? 1 : -1);

		// if object is observable then add it to the list
		if (ko.isObservable(obj)) {
			// ensure it's validatable but don't extend validatedObservable because it
			// would overwrite isValid property.
			if (!obj.errors && !utils.isValidatable(obj)) {
				obj.extend({ validatable: true });
			}
			context.validatables.push(obj);

			if (context.options.live && utils.isObservableArray(obj)) {
				context.subscriptions.push(obj.subscribe(function () {
					context.graphMonitor.valueHasMutated();
				}));
			}
		}

		//get list of values either from array or object but ignore non-objects
		// and destroyed objects
		if (val && !val._destroy) {
			if (utils.isArray(val)) {
				objValues = val;
			}
			else if (utils.isObject(val)) {
				objValues = utils.values(val);
			}
		}

		//process recursively if it is deep grouping
		if (level !== 0) {
			utils.forEach(objValues, function (observable) {
				//but not falsy things and not HTML Elements
				if (observable && !observable.nodeType && (!ko.isComputed(observable) || observable.rules)) {
					traverseGraph(observable, context, level + 1);
				}
			});
		}
	}

	function collectErrors(array) {
		var errors = [];
		forEach(array, function (observable) {
			// Do not collect validatedObservable errors
			if (utils.isValidatable(observable) && !observable.isValid()) {
				// Use peek because we don't want a dependency for 'error' property because it
				// changes before 'isValid' does. (Issue #99)
				errors.push(observable.error.peek());
			}
		});
		return errors;
	}

	return {
		//Call this on startup
		//any config can be overridden with the passed in options
		init: function (options, force) {
			//done run this multiple times if we don't really want to
			if (isInitialized > 0 && !force) {
				return;
			}

			//because we will be accessing options properties it has to be an object at least
			options = options || {};
			//if specific error classes are not provided then apply generic errorClass
			//it has to be done on option so that options.errorClass can override default
			//errorElementClass and errorMessage class but not those provided in options
			options.errorElementClass = options.errorElementClass || options.errorClass || configuration.errorElementClass;
			options.errorMessageClass = options.errorMessageClass || options.errorClass || configuration.errorMessageClass;

			extend(configuration, options);

			if (configuration.registerExtenders) {
				kv.registerExtenders();
			}

			isInitialized = 1;
		},

		configure: function (options) { kv.init(options); }, // ADDON LISANDRO

		getConfig: function(){ // ADDON LISANDRO PARA OBTENER LA CONFIGURACIN DESDE EL NUEVO BINDING
			return kv.configuration;
		},

		// resets the config back to its original state
		reset: kv.configuration.reset,

		// recursively walks a viewModel and creates an object that
		// provides validation information for the entire viewModel
		// obj -> the viewModel to walk
		// options -> {
		//	  deep: false, // if true, will walk past the first level of viewModel properties
		//	  observable: false // if true, returns a computed observable indicating if the viewModel is valid
		// }
		group: function group(obj, options) { // array of observables or viewModel
			options = extend(extend({}, configuration.grouping), options);

			var context = {
				options: options,
				graphMonitor: ko.observable(),
				flagged: [],
				subscriptions: [],
				validatables: []
			};

			var result = null;

			//if using observables then traverse structure once and add observables
			if (options.observable) {
				result = ko.computed(function () {
					context.graphMonitor(); //register dependency
					runTraversal(obj, context);
					return collectErrors(context.validatables);
				});
			}
			else { //if not using observables then every call to error() should traverse the structure
				result = function () {
					runTraversal(obj, context);
					return collectErrors(context.validatables);
				};
			}

			result.showAllMessages = function (show) { // thanks @heliosPortal
				if (show === undefined) {//default to true
					show = true;
				}

				result.forEach(function (observable) {
					if (utils.isValidatable(observable)) {
						observable.isModified(show);
					}
				});
			};

			result.isAnyMessageShown = function () {
				var invalidAndModifiedPresent;

				invalidAndModifiedPresent = !!result.find(function (observable) {
					return utils.isValidatable(observable) && !observable.isValid() && observable.isModified();
				});
				return invalidAndModifiedPresent;
			};

			// LISANDRO \
			result.validatables = ko.observableArray( context.validatables );
			// LISANDRO /

			result.filter = function(predicate) {
				predicate = predicate || function () { return true; };
				// ensure we have latest changes
				result();

				return koUtils.arrayFilter(context.validatables, predicate);
			};

			result.find = function(predicate) {
				predicate = predicate || function () { return true; };
				// ensure we have latest changes
				result();

				return koUtils.arrayFirst(context.validatables, predicate);
			};

			result.forEach = function(callback) {
				callback = callback || function () { };
				// ensure we have latest changes
				result();

				forEach(context.validatables, callback);
			};

			result.map = function(mapping) {
				mapping = mapping || function (item) { return item; };
				// ensure we have latest changes
				result();

				return koUtils.arrayMap(context.validatables, mapping);
			};

			/**
			 * @private You should not rely on this method being here.
			 * It's a private method and it may change in the future.
			 *
			 * @description Updates the validated object and collects errors from it.
			 */
			result._updateState = function(newValue) {
				if (!utils.isObject(newValue)) {
					throw new Error('An object is required.');
				}
				obj = newValue;
				if (options.observable) {
					context.graphMonitor.valueHasMutated();
				}
				else {
					runTraversal(newValue, context);
					return collectErrors(context.validatables);
				}
			};



			return result;
		},

		formatMessage: function (message, params, observable) {
			if (utils.isObject(params) && params.typeAttr) {
				params = params.value;
			}
			if (typeof message === 'function') {
				return message(params, observable);
			}
			var replacements = unwrap(params);
            if (replacements == null) {
                replacements = [];
            }
			if (!utils.isArray(replacements)) {
				replacements = [replacements];
			}
			return message.replace(/{(\d+)}/gi, function(match, index) {
				if (typeof replacements[index] !== 'undefined') {
					return replacements[index];
				}
				return match;
			});
		},

		// addRule:
		// This takes in a ko.observable and a Rule Context - which is just a rule name and params to supply to the validator
		// ie: kv.addRule(myObservable, {
		//		  rule: 'required',
		//		  params: true
		//	  });
		//
		addRule: function (observable, rule) {
			observable.extend({ validatable: true });

			var hasRule = !!koUtils.arrayFirst(observable.rules(), function(item) {
				return item.rule && item.rule === rule.rule;
			});

			if (!hasRule) {
				//push a Rule Context to the observables local array of Rule Contexts
				observable.rules.push(rule);
			}
			return observable;
		},

		// addAnonymousRule:
		// Anonymous Rules essentially have all the properties of a Rule, but are only specific for a certain property
		// and developers typically are wanting to add them on the fly or not register a rule with the 'kv.rules' object
		//
		// Example:
		// var test = ko.observable('something').extend{(
		//	  validation: {
		//		  validator: function(val, someOtherVal){
		//			  return true;
		//		  },
		//		  message: "Something must be really wrong!',
		//		  params: true
		//	  }
		//  )};
		addAnonymousRule: function (observable, ruleObj) {
			if (ruleObj['message'] === undefined) {
				ruleObj['message'] = 'Error';
			}

			//make sure onlyIf is honoured
			if (ruleObj.onlyIf) {
				ruleObj.condition = ruleObj.onlyIf;
			}

			//add the anonymous rule to the observable
			kv.addRule(observable, ruleObj);
		},

		addExtender: function (ruleName) {
			ko.extenders[ruleName] = function (observable, params) {
				//params can come in a few flavors
				// 1. Just the params to be passed to the validator
				// 2. An object containing the Message to be used and the Params to pass to the validator
				// 3. A condition when the validation rule to be applied
				//
				// Example:
				// var test = ko.observable(3).extend({
				//	  max: {
				//		  message: 'This special field has a Max of {0}',
				//		  params: 2,
				//		  onlyIf: function() {
				//					  return specialField.IsVisible();
				//				  }
				//	  }
				//  )};
				//
				if (params && (params.message || params.onlyIf)) { //if it has a message or condition object, then its an object literal to use
					return kv.addRule(observable, {
						rule: ruleName,
						message: params.message,
						params: utils.isEmptyVal(params.params) ? true : params.params,
						condition: params.onlyIf
					});
				} else {
					return kv.addRule(observable, {
						rule: ruleName,
						params: params
					});
				}
			};
		},

		// loops through all kv.rules and adds them as extenders to
		// ko.extenders
		registerExtenders: function () { // root extenders optional, use 'validation' extender if would cause conflicts
			if (configuration.registerExtenders) {
				for (var ruleName in kv.rules) {
					if (kv.rules.hasOwnProperty(ruleName)) {
						if (!ko.extenders[ruleName]) {
							kv.addExtender(ruleName);
						}
					}
				}
			}
		},

		//creates a span next to the @element with the specified error class
		insertValidationMessage: function (element) {
			var span = document.createElement('SPAN');
			span.className = utils.getConfigOptions(element).errorMessageClass;
			utils.insertAfter(element, span);
			return span;
		},

		// if html-5 validation attributes have been specified, this parses
		// the attributes on @element
		parseInputValidationAttributes: function (element, valueAccessor) {
			forEach(kv.configuration.html5Attributes, function (attr) {
				if (utils.hasAttribute(element, attr)) {

					var params = element.getAttribute(attr) || true;

					if (attr === 'min' || attr === 'max')
					{
						// If we're validating based on the min and max attributes, we'll
						// need to know what the 'type' attribute is set to
						var typeAttr = element.getAttribute('type');
						if (typeof typeAttr === "undefined" || !typeAttr)
						{
							// From http://www.w3.org/TR/html-markup/input:
							//   An input element with no type attribute specified represents the
							//   same thing as an input element with its type attribute set to "text".
							typeAttr = "text";
						}
						params = {typeAttr: typeAttr, value: params};
					}

					kv.addRule(valueAccessor(), {
						rule: attr,
						params: params
					});
				}
			});

			var currentType = element.getAttribute('type');
			forEach(kv.configuration.html5InputTypes, function (type) {
				if (type === currentType) {
					kv.addRule(valueAccessor(), {
						rule: (type === 'date') ? 'dateISO' : type,
						params: true
					});
				}
			});
		},

		// writes html5 validation attributes on the element passed in
		writeInputValidationAttributes: function (element, valueAccessor) {
			var observable = valueAccessor();

			if (!observable || !observable.rules) {
				return;
			}

			var contexts = observable.rules(); // observable array

			// loop through the attributes and add the information needed
			forEach(kv.configuration.html5Attributes, function (attr) {
				var ctx = koUtils.arrayFirst(contexts, function (ctx) {
					return ctx.rule && ctx.rule.toLowerCase() === attr.toLowerCase();
				});

				if (!ctx) {
					return;
				}

				// we have a rule matching a validation attribute at this point
				// so lets add it to the element along with the params
				ko.computed({
					read: function() {
						var params = ko.unwrap(ctx.params);

						// we have to do some special things for the pattern validation
						if (ctx.rule === "pattern" && params instanceof RegExp) {
							// we need the pure string representation of the RegExpr without the //gi stuff
							params = params.source;
						}

						element.setAttribute(attr, params);
					},
					disposeWhenNodeIsRemoved: element
				});
			});

			contexts = null;
		},

		//take an existing binding handler and make it cause automatic validations
		makeBindingHandlerValidatable: function (handlerName) {
			var init = ko.bindingHandlers[handlerName].init;

			ko.bindingHandlers[handlerName].init = function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {

				init(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext);

				return ko.bindingHandlers['validationCore'].init(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext);
			};
		},

		// visit an objects properties and apply validation rules from a definition
		setRules: function (target, definition) {
			var setRules = function (target, definition) {
				if (!target || !definition) { return; }

				for (var prop in definition) {
					if (!definition.hasOwnProperty(prop)) { continue; }
					var ruleDefinitions = definition[prop];

					//check the target property exists and has a value
					if (!target[prop]) { continue; }
					var targetValue = target[prop],
						unwrappedTargetValue = unwrap(targetValue),
						rules = {},
						nonRules = {};

					for (var rule in ruleDefinitions) {
						if (!ruleDefinitions.hasOwnProperty(rule)) { continue; }
						if (kv.rules[rule]) {
							rules[rule] = ruleDefinitions[rule];
						} else {
							nonRules[rule] = ruleDefinitions[rule];
						}
					}

					//apply rules
					if (ko.isObservable(targetValue)) {
						targetValue.extend(rules);
					}

					//then apply child rules
					//if it's an array, apply rules to all children
					if (unwrappedTargetValue && utils.isArray(unwrappedTargetValue)) {
						for (var i = 0; i < unwrappedTargetValue.length; i++) {
							setRules(unwrappedTargetValue[i], nonRules);
						}
						//otherwise, just apply to this property
					} else {
						setRules(unwrappedTargetValue, nonRules);
					}
				}
			};
			setRules(target, definition);
		}
	};

}());

// expose api publicly
extend(ko.validation, api);
;//Validation Rules:
// You can view and override messages or rules via:
// kv.rules[ruleName]
//
// To implement a custom Rule, simply use this template:
// kv.rules['<custom rule name>'] = {
//      validator: function (val, param) {
//          <custom logic>
//          return <true or false>;
//      },
//      message: '<custom validation message>' //optionally you can also use a '{0}' to denote a placeholder that will be replaced with your 'param'
// };
//
// Example:
// kv.rules['mustEqual'] = {
//      validator: function( val, mustEqualVal ){
//          return val === mustEqualVal;
//      },
//      message: 'This field must equal {0}'
// };
//
kv.rules = {};
kv.rules['required'] = {
	validator: function (val, required) {
		var testVal;

		if (val === undefined || val === null) {
			return !required;
		}

		testVal = val;
		if (typeof (val) === 'string') {
			if (String.prototype.trim) {
				testVal = val.trim();
			}
			else {
				testVal = val.replace(/^\s+|\s+$/g, '');
			}
		}

		if (!required) {// if they passed: { required: false }, then don't require this
			return true;
		}

		return ((testVal + '').length > 0);
	},
	message: 'This field is required.'
};

function minMaxValidatorFactory(validatorName) {
    var isMaxValidation = validatorName === "max";

    return function (val, options) {
        if (kv.utils.isEmptyVal(val)) {
            return true;
        }

        var comparisonValue, type;
        if (options.typeAttr === undefined) {
            // This validator is being called from javascript rather than
            // being bound from markup
            type = "text";
            comparisonValue = options;
        } else {
            type = options.typeAttr;
            comparisonValue = options.value;
        }

        // From http://www.w3.org/TR/2012/WD-html5-20121025/common-input-element-attributes.html#attr-input-min,
        // if the value is parseable to a number, then the minimum should be numeric
        if (!isNaN(comparisonValue) && !(comparisonValue instanceof Date)) {
            type = "number";
        }

        var regex, valMatches, comparisonValueMatches;
        switch (type.toLowerCase()) {
            case "week":
                regex = /^(\d{4})-W(\d{2})$/;
                valMatches = val.match(regex);
                if (valMatches === null) {
                    throw new Error("Invalid value for " + validatorName + " attribute for week input.  Should look like " +
                        "'2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min");
                }
                comparisonValueMatches = comparisonValue.match(regex);
                // If no regex matches were found, validation fails
                if (!comparisonValueMatches) {
                    return false;
                }

                if (isMaxValidation) {
                    return (valMatches[1] < comparisonValueMatches[1]) || // older year
                        // same year, older week
                        ((valMatches[1] === comparisonValueMatches[1]) && (valMatches[2] <= comparisonValueMatches[2]));
                } else {
                    return (valMatches[1] > comparisonValueMatches[1]) || // newer year
                        // same year, newer week
                        ((valMatches[1] === comparisonValueMatches[1]) && (valMatches[2] >= comparisonValueMatches[2]));
                }
                break;

            case "month":
                regex = /^(\d{4})-(\d{2})$/;
                valMatches = val.match(regex);
                if (valMatches === null) {
                    throw new Error("Invalid value for " + validatorName + " attribute for month input.  Should look like " +
                        "'2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min");
                }
                comparisonValueMatches = comparisonValue.match(regex);
                // If no regex matches were found, validation fails
                if (!comparisonValueMatches) {
                    return false;
                }

                if (isMaxValidation) {
                    return ((valMatches[1] < comparisonValueMatches[1]) || // older year
                        // same year, older month
                        ((valMatches[1] === comparisonValueMatches[1]) && (valMatches[2] <= comparisonValueMatches[2])));
                } else {
                    return (valMatches[1] > comparisonValueMatches[1]) || // newer year
                        // same year, newer month
                        ((valMatches[1] === comparisonValueMatches[1]) && (valMatches[2] >= comparisonValueMatches[2]));
                }
                break;

            case "number":
            case "range":
                if (isMaxValidation) {
                    return (!isNaN(val) && parseFloat(val) <= parseFloat(comparisonValue));
                } else {
                    return (!isNaN(val) && parseFloat(val) >= parseFloat(comparisonValue));
                }
                break;

            default:
                if (isMaxValidation) {
                    return val <= comparisonValue;
                } else {
                    return val >= comparisonValue;
                }
        }
    };
}

kv.rules['min'] = {
	validator: minMaxValidatorFactory("min"),
	message: 'Please enter a value greater than or equal to {0}.'
};

kv.rules['max'] = {
	validator: minMaxValidatorFactory("max"),
	message: 'Please enter a value less than or equal to {0}.'
};

kv.rules['minLength'] = {
	validator: function (val, minLength) {
		if(kv.utils.isEmptyVal(val)) { return true; }
		var normalizedVal = kv.utils.isNumber(val) ? ('' + val) : val;
		return normalizedVal.length >= minLength;
	},
	message: 'Please enter at least {0} characters.'
};

kv.rules['maxLength'] = {
	validator: function (val, maxLength) {
		if(kv.utils.isEmptyVal(val)) { return true; }
		var normalizedVal = kv.utils.isNumber(val) ? ('' + val) : val;
		return normalizedVal.length <= maxLength;
	},
	message: 'Please enter no more than {0} characters.'
};

kv.rules['pattern'] = {
	validator: function (val, regex) {
		return kv.utils.isEmptyVal(val) || val.toString().match(regex) !== null;
	},
	message: 'Please check this value.'
};

kv.rules['step'] = {
	validator: function (val, step) {

		// in order to handle steps of .1 & .01 etc.. Modulus won't work
		// if the value is a decimal, so we have to correct for that
		if (kv.utils.isEmptyVal(val) || step === 'any') { return true; }
		var dif = (val * 100) % (step * 100);
		return Math.abs(dif) < 0.00001 || Math.abs(1 - dif) < 0.00001;
	},
	message: 'The value must increment by {0}.'
};

kv.rules['email'] = {
	validator: function (val, validate) {
		if (!validate) { return true; }

		//I think an empty email address is also a valid entry
		//if one want's to enforce entry it should be done with 'required: true'
		return kv.utils.isEmptyVal(val) || (
			// jquery validate regex - thanks Scott Gonzalez
			validate && /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(val)
		);
	},
	message: 'Please enter a proper email address.'
};

kv.rules['date'] = {
	validator: function (value, validate) {
		if (!validate) { return true; }
		return kv.utils.isEmptyVal(value) || (validate && !/Invalid|NaN/.test(new Date(value)));
	},
	message: 'Please enter a proper date.'
};

kv.rules['dateISO'] = {
	validator: function (value, validate) {
		if (!validate) { return true; }
		return kv.utils.isEmptyVal(value) || (validate && /^\d{4}[-/](?:0?[1-9]|1[012])[-/](?:0?[1-9]|[12][0-9]|3[01])$/.test(value));
	},
	message: 'Please enter a proper date.'
};

kv.rules['number'] = {
	validator: function (value, validate) {
		if (!validate) { return true; }
		return kv.utils.isEmptyVal(value) || (validate && /^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(value));
	},
	message: 'Please enter a number.'
};

kv.rules['digit'] = {
	validator: function (value, validate) {
		if (!validate) { return true; }
		return kv.utils.isEmptyVal(value) || (validate && /^\d+$/.test(value));
	},
	message: 'Please enter a digit.'
};

kv.rules['phoneUS'] = {
	validator: function (phoneNumber, validate) {
		if (!validate) { return true; }
		if (kv.utils.isEmptyVal(phoneNumber)) { return true; } // makes it optional, use 'required' rule if it should be required
		if (typeof (phoneNumber) !== 'string') { return false; }
		phoneNumber = phoneNumber.replace(/\s+/g, "");
		return validate && phoneNumber.length > 9 && phoneNumber.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/);
	},
	message: 'Please specify a valid phone number.'
};

kv.rules['equal'] = {
	validator: function (val, params) {
		var otherValue = params;
		return val === kv.utils.getValue(otherValue);
	},
	message: 'Values must equal.'
};

kv.rules['notEqual'] = {
	validator: function (val, params) {
		var otherValue = params;
		return val !== kv.utils.getValue(otherValue);
	},
	message: 'Please choose another value.'
};

//unique in collection
// options are:
//    collection: array or function returning (observable) array
//              in which the value has to be unique
//    valueAccessor: function that returns value from an object stored in collection
//              if it is null the value is compared directly
//    external: set to true when object you are validating is automatically updating collection
kv.rules['unique'] = {
	validator: function (val, options) {
		var c = kv.utils.getValue(options.collection),
			external = kv.utils.getValue(options.externalValue),
			counter = 0;

		if (!val || !c) { return true; }

		koUtils.arrayFilter(c, function (item) {
			if (val === (options.valueAccessor ? options.valueAccessor(item) : item)) { counter++; }
		});
		// if value is external even 1 same value in collection means the value is not unique
		return counter < (!!external ? 1 : 2);
	},
	message: 'Please make sure the value is unique.'
};


//now register all of these!
(function () {
	kv.registerExtenders();
}());
;// The core binding handler
// this allows us to setup any value binding that internally always
// performs the same functionality
ko.bindingHandlers['validationCore'] = (function () {

	return {
		init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var config = kv.utils.getConfigOptions(element);
			var observable = valueAccessor();

			// parse html5 input validation attributes, optional feature
			if (config.parseInputAttributes) {
				kv.utils.async(function () { kv.parseInputValidationAttributes(element, valueAccessor); });
			}

			// if requested insert message element and apply bindings
			if (config.insertMessages && kv.utils.isValidatable(observable)) {

				// insert the <span></span>
				var validationMessageElement = kv.insertValidationMessage(element);

				// if we're told to use a template, make sure that gets rendered
				if (config.messageTemplate) {
					ko.renderTemplate(config.messageTemplate, { field: observable }, null, validationMessageElement, 'replaceNode');
				} else {
					ko.applyBindingsToNode(validationMessageElement, { validationMessage: observable });
				}
			}

			// write the html5 attributes if indicated by the config
			if (config.writeInputAttributes && kv.utils.isValidatable(observable)) {

				kv.writeInputValidationAttributes(element, valueAccessor);
			}

			// if requested, add binding to decorate element
			if (config.decorateInputElement && kv.utils.isValidatable(observable)) {
				ko.applyBindingsToNode(element, { validationElement: observable });
			}
		}
	};

}());

// override for KO's default 'value', 'checked', 'textInput' and selectedOptions bindings
kv.makeBindingHandlerValidatable("value");
kv.makeBindingHandlerValidatable("checked");
if (ko.bindingHandlers.textInput) {
	kv.makeBindingHandlerValidatable("textInput");
}
kv.makeBindingHandlerValidatable("selectedOptions");


ko.bindingHandlers['validationMessage'] = { // individual error message, if modified or post binding
	update: function (element, valueAccessor) {
		var obsv = valueAccessor(),
			config = kv.utils.getConfigOptions(element),
			val = unwrap(obsv),
			msg = null,
			isModified = false,
			isValid = false;

		if (obsv === null || typeof obsv === 'undefined') {
			throw new Error('Cannot bind validationMessage to undefined value. data-bind expression: ' +
				element.getAttribute('data-bind'));
		}

		isModified = obsv.isModified && obsv.isModified();
		isValid = obsv.isValid && obsv.isValid();

		var error = null;
		if (!config.messagesOnModified || isModified) {
			error = isValid ? null : obsv.error;
		}

		var isVisible = !config.messagesOnModified || isModified ? !isValid : false;
		var isCurrentlyVisible = element.style.display !== "none";

		if (config.allowHtmlMessages) {
			koUtils.setHtml(element, error);
		} else {
			ko.bindingHandlers.text.update(element, function () { return error; });
		}

		if (isCurrentlyVisible && !isVisible) {
			element.style.display = 'none';
		} else if (!isCurrentlyVisible && isVisible) {
			element.style.display = '';
		}
	}
};

ko.bindingHandlers['validationElement'] = {
	update: function (element, valueAccessor, allBindingsAccessor) {
		var obsv = valueAccessor(),
			config = kv.utils.getConfigOptions(element),
			val = unwrap(obsv),
			msg = null,
			isModified = false,
			isValid = false;

		if (obsv === null || typeof obsv === 'undefined') {
			throw new Error('Cannot bind validationElement to undefined value. data-bind expression: ' +
				element.getAttribute('data-bind'));
		}

		isModified = obsv.isModified && obsv.isModified();
		isValid = obsv.isValid && obsv.isValid();

		// create an evaluator function that will return something like:
		// css: { validationElement: true }
		var cssSettingsAccessor = function () {
			var css = {};

			var shouldShow = ((!config.decorateElementOnModified || isModified) ? !isValid : false);

			// css: { validationElement: false }
			css[config.errorElementClass] = shouldShow;

			return css;
		};

		//add or remove class on the element;
		ko.bindingHandlers.css.update(element, cssSettingsAccessor, allBindingsAccessor);
		if (!config.errorsAsTitle) { return; }

		ko.bindingHandlers.attr.update(element, function () {
			var
				hasModification = !config.errorsAsTitleOnModified || isModified,
				title = kv.utils.getOriginalElementTitle(element);

			if (hasModification && !isValid) {
				return { title: obsv.error, 'data-orig-title': title };
			} else if (!hasModification || isValid) {
				return { title: title, 'data-orig-title': null };
			}
		});
	}
};

// ValidationOptions:
// This binding handler allows you to override the initial config by setting any of the options for a specific element or context of elements
//
// Example:
// <div data-bind="validationOptions: { insertMessages: true, messageTemplate: 'customTemplate', errorMessageClass: 'mySpecialClass'}">
//      <input type="text" data-bind="value: someValue"/>
//      <input type="text" data-bind="value: someValue2"/>
// </div>
ko.bindingHandlers['validationOptions'] = (function () {
	return {
		init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var options = unwrap(valueAccessor());
			if (options) {
				var newConfig = extend({}, kv.configuration);
				extend(newConfig, options);

				//store the validation options on the node so we can retrieve it later
				kv.utils.setDomData(element, newConfig);
			}
		}
	};
}());
;// Validation Extender:
// This is for creating custom validation logic on the fly
// Example:
// var test = ko.observable('something').extend{(
//      validation: {
//          validator: function(val, someOtherVal){
//              return true;
//          },
//          message: "Something must be really wrong!',
//          params: true
//      }
//  )};
ko.extenders['validation'] = function (observable, rules) { // allow single rule or array
	forEach(kv.utils.isArray(rules) ? rules : [rules], function (rule) {
		// the 'rule' being passed in here has no name to identify a core Rule,
		// so we add it as an anonymous rule
		// If the developer is wanting to use a core Rule, but use a different message see the 'addExtender' logic for examples
		kv.addAnonymousRule(observable, rule);
	});
	return observable;
};

//This is the extender that makes a Knockout Observable also 'Validatable'
//examples include:
// 1. var test = ko.observable('something').extend({validatable: true});
// this will ensure that the Observable object is setup properly to respond to rules
//
// 2. test.extend({validatable: false});
// this will remove the validation properties from the Observable object should you need to do that.
ko.extenders['validatable'] = function (observable, options) {
	if (!kv.utils.isObject(options)) {
		options = { enable: options };
	}

	if (!('enable' in options)) {
		options.enable = true;
	}

	if (options.enable && !kv.utils.isValidatable(observable)) {
		var config = kv.configuration.validate || {};
		var validationOptions = {
			throttleEvaluation : options.throttle || config.throttle
		};

		observable.error = ko.observable(null); // holds the error message, we only need one since we stop processing validators when one is invalid

		// observable.rules:
		// ObservableArray of Rule Contexts, where a Rule Context is simply the name of a rule and the params to supply to it
		//
		// Rule Context = { rule: '<rule name>', params: '<passed in params>', message: '<Override of default Message>' }
		observable.rules = ko.observableArray(); //holds the rule Contexts to use as part of validation

		//in case async validation is occurring
		observable.isValidating = ko.observable(false);

		//the true holder of whether the observable is valid or not
		observable.__valid__ = ko.observable(true);

		observable.isModified = ko.observable(false);

		// a semi-protected observable
		observable.isValid = ko.computed(observable.__valid__);

		//manually set error state
		observable.setError = function (error) {
			var previousError = observable.error.peek();
			var previousIsValid = observable.__valid__.peek();

			observable.error(error);
			observable.__valid__(false);

			if (previousError !== error && !previousIsValid) {
				// if the observable was not valid before then isValid will not mutate,
				// hence causing any grouping to not display the latest error.
				observable.isValid.notifySubscribers();
			}
		};

		//manually clear error state
		observable.clearError = function () {
			observable.error(null);
			observable.__valid__(true);
			return observable;
		};

		//subscribe to changes in the observable
		var h_change = observable.subscribe(function () {
			observable.isModified(true);
		});

		// we use a computed here to ensure that anytime a dependency changes, the
		// validation logic evaluates
		var h_obsValidationTrigger = ko.computed(extend({
			read: function () {
				var obs = observable(),
					ruleContexts = observable.rules();

				kv.validateObservable(observable);

				return true;
			}
		}, validationOptions));

		extend(h_obsValidationTrigger, validationOptions);

		observable._disposeValidation = function () {
			//first dispose of the subscriptions
			observable.isValid.dispose();
			observable.rules.removeAll();
			h_change.dispose();
			h_obsValidationTrigger.dispose();

			delete observable['rules'];
			delete observable['error'];
			delete observable['isValid'];
			delete observable['isValidating'];
			delete observable['__valid__'];
			delete observable['isModified'];
            delete observable['setError'];
            delete observable['clearError'];
            delete observable['_disposeValidation'];
		};
	} else if (options.enable === false && observable._disposeValidation) {
		observable._disposeValidation();
	}
	return observable;
};

function validateSync(observable, rule, ctx) {
	//Execute the validator and see if its valid
	if (!rule.validator(observable(), (ctx.params === undefined ? true : unwrap(ctx.params)))) { // default param is true, eg. required = true

		//not valid, so format the error message and stick it in the 'error' variable
		observable.setError(kv.formatMessage(
					ctx.message || rule.message,
					unwrap(ctx.params),
					observable));
		return false;
	} else {
		return true;
	}
}

function validateAsync(observable, rule, ctx) {
	observable.isValidating(true);

	var callBack = function (valObj) {
		var isValid = false,
			msg = '';

		if (!observable.__valid__()) {

			// since we're returning early, make sure we turn this off
			observable.isValidating(false);

			return; //if its already NOT valid, don't add to that
		}

		//we were handed back a complex object
		if (valObj['message']) {
			isValid = valObj.isValid;
			msg = valObj.message;
		} else {
			isValid = valObj;
		}

		if (!isValid) {
			//not valid, so format the error message and stick it in the 'error' variable
			observable.error(kv.formatMessage(
				msg || ctx.message || rule.message,
				unwrap(ctx.params),
				observable));
			observable.__valid__(isValid);
		}

		// tell it that we're done
		observable.isValidating(false);
	};

	kv.utils.async(function() {
	    //fire the validator and hand it the callback
        rule.validator(observable(), ctx.params === undefined ? true : unwrap(ctx.params), callBack);
	});
}

kv.validateObservable = function (observable) {
	var i = 0,
		rule, // the rule validator to execute
		ctx, // the current Rule Context for the loop
		ruleContexts = observable.rules(), //cache for iterator
		len = ruleContexts.length; //cache for iterator

	for (; i < len; i++) {

		//get the Rule Context info to give to the core Rule
		ctx = ruleContexts[i];

		// checks an 'onlyIf' condition
		if (ctx.condition && !ctx.condition()) {
			continue;
		}

		//get the core Rule to use for validation
		rule = ctx.rule ? kv.rules[ctx.rule] : ctx;

		if (rule['async'] || ctx['async']) {
			//run async validation
			validateAsync(observable, rule, ctx);

		} else {
			//run normal sync validation
			if (!validateSync(observable, rule, ctx)) {
				return false; //break out of the loop
			}
		}
	}
	//finally if we got this far, make the observable valid again!
	observable.clearError();
	return true;
};
;
var _locales = {};
var _currentLocale;

kv.defineLocale = function(name, values) {
	if (name && values) {
		_locales[name.toLowerCase()] = values;
		return values;
	}
	return null;
};

kv.locale = function(name) {
	if (name) {
		name = name.toLowerCase();

		if (_locales.hasOwnProperty(name)) {
			kv.localize(_locales[name]);
			_currentLocale = name;
		}
		else {
			throw new Error('Localization ' + name + ' has not been loaded.');
		}
	}
	return _currentLocale;
};

//quick function to override rule messages
kv.localize = function (msgTranslations) {
	var rules = kv.rules;

	//loop the properties in the object and assign the msg to the rule
	for (var ruleName in msgTranslations) {
		if (rules.hasOwnProperty(ruleName)) {
			rules[ruleName].message = msgTranslations[ruleName];
		}
	}
};

// Populate default locale (this will make en-US.js somewhat redundant)
(function() {
	var localeData = {};
	var rules = kv.rules;

	for (var ruleName in rules) {
		if (rules.hasOwnProperty(ruleName)) {
			localeData[ruleName] = rules[ruleName].message;
		}
	}
	kv.defineLocale('en-us', localeData);
})();

// No need to invoke locale because the messages are already defined along with the rules for en-US
_currentLocale = 'en-us';
;/**
 * Possible invocations:
 * 		applyBindingsWithValidation(viewModel)
 * 		applyBindingsWithValidation(viewModel, options)
 * 		applyBindingsWithValidation(viewModel, rootNode)
 *		applyBindingsWithValidation(viewModel, rootNode, options)
 */
ko.applyBindingsWithValidation = function (viewModel, rootNode, options) {
	var node = document.body,
		config;

	if (rootNode && rootNode.nodeType) {
		node = rootNode;
		config = options;
	}
	else {
		config = rootNode;
	}

	kv.init();

	if (config) {
		config = extend(extend({}, kv.configuration), config);
		kv.utils.setDomData(node, config);
	}

	ko.applyBindings(viewModel, node);
};

//override the original applyBindings so that we can ensure all new rules and what not are correctly registered
var origApplyBindings = ko.applyBindings;
ko.applyBindings = function (viewModel, rootNode) {

	kv.init();

	origApplyBindings(viewModel, rootNode);
};

ko.validatedObservable = function (initialValue, options) {
	if (!options && !kv.utils.isObject(initialValue)) {
		return ko.observable(initialValue).extend({ validatable: true });
	}

	var obsv = ko.observable(initialValue);
	obsv.errors = kv.group(kv.utils.isObject(initialValue) ? initialValue : {}, options);
	obsv.isValid = ko.observable(obsv.errors().length === 0);

	if (ko.isObservable(obsv.errors)) {
		obsv.errors.subscribe(function(errors) {
			obsv.isValid(errors.length === 0);
		});
	}
	else {
		ko.computed(obsv.errors).subscribe(function (errors) {
			obsv.isValid(errors.length === 0);
		});
	}

	obsv.subscribe(function(newValue) {
		if (!kv.utils.isObject(newValue)) {
			/*
			 * The validation group works on objects.
			 * Since the new value is a primitive (scalar, null or undefined) we need
			 * to create an empty object to pass along.
			 */
			newValue = {};
		}
		// Force the group to refresh
		obsv.errors._updateState(newValue);
		obsv.isValid(obsv.errors().length === 0);
	});


	// LISANDRO \
	initialValue.isAnyMessageShown = obsv.errors.isAnyMessageShown;
	initialValue.errors = obsv.errors;
	initialValue.isValid = obsv.isValid;

	obsv.isAnyMessageShown = initialValue.isAnyMessageShown;
	obsv.isModified = ko.computed({
		read: function(){
			return !!$.findInCollection( ko.unwrap( obsv.errors.validatables ), function(validatable){
				return ko.utils.unwrapObservable(validatable.isModified);
			});
		},

		write: function(value){
			$.each( ko.unwrap( obsv.errors.validatables ), function(index, validatable){
				validatable.isModified && validatable.isModified(value);
			});
		}
	});

	obsv.showAllMessages = function( value ){
		if(arguments.length == 0 ) value = true;
		obsv.isModified( value );
	};
	// LISANDRO /


	return obsv;
};
;}));


/* /js/libs/knockout.validation.morerules.js
 * compresion time: 0.02789 -(ms)
 * ----------------------------------------- */
ko.validation.rules['accounting.money'] = {
	validator: function (value, decimal) {
		var decimal = (typeof decimal == 'string' && decimal )|| accounting.settings.currency.decimal;
		var unformatted = accounting.unformat(value, decimal);
		var reformatted = accounting.formatMoney(unformatted, '');
		return value == reformatted;
	},
	message: 'Please enter a money value'
};





ko.validation.rules['validChildren'] = {
	validator: function(val, validate){
		return !$.findInCollection(val, function(value){
			return value && value.isValid && !value.isValid();
		})
	},
				
	message: 'Algunos elementos son invlidos'
};


ko.validation.rules['dattaEmailPassword'] = {
	validator: function (value, validate) {
		//var re = /^[\d\w*\/@]+$/;
		var dattaEmailUser = ko.unwrap( validate );
		var result;
		if( $.isEmptyVal(value) ){
			result = true;
		} else {
			result = ( dattaEmailUser && (
				value.length >= 8 &&
				/\d/.test(value) &&
				/[A-Z]/.test(value) &&
				/[a-z]/.test(value)
				)
			);
		}
		return result;
	},
	message: '8 caracteres mnimo, con al menos una mayscula, una minscula y un nmero'
};

ko.validation.rules['dattaEmailPasswordValidCharacters'] = {
	validator: function( value, validate ){
		var re = /^[\da-zA-Z\*\/@]+$/;
		if( $.isEmptyVal(value) ){
			result = true;
		} else {
			result = re.test(value);
		}
		return result;
	},
	message: 'slo letras, nmeros, y los caracteres */@'
}


ko.validation.rules['dattaEmailPasswordNotConsecutiveNumbers'] = {
	validator: function (value, validate) {
		var dattaEmailUser = ko.unwrap( validate );
		var result;
		if( $.isEmptyVal(value) ){
			result = true;
		} else {
			result = ( dattaEmailUser && (
					!(/(012|123|234|345|456|567|678|789)/.test(value))
				)
			);
		}
		return result;
	},
	message: 'no debe contener nmeros consecutivos'
};

ko.validation.rules['dattaEmailPasswordSymbol'] = {
	validator: function (value, validate) {
		var dattaEmailUser = ko.unwrap( validate );
		var result;
		if( $.isEmptyVal(value) ){
			result = true;
		} else {
			result = ( dattaEmailUser && (
					/[\*@\/]/.test(value)
				)
			);
		}
		return result;
	},
	message: 'debe contener al menos un smbolo *@/'
};


ko.validation.rules['dattaEmailName'] = {
	validator: function (value, validate) {
		//var re = /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))$/i;
		//var re = /^\w+\w+([-+.']\w+)*$/;
		var re = /^\w+([-+.']\w+)*$/;
		return $.isEmptyVal(value) || (validate && re.test(value) );
	},
	message: 'No es un nombre de correo electrnico vlido'
};

ko.validation.rules['domain'] = {
	validator: function (value, validate) {
		var re = /^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,14}$/i;
		return $.isEmptyVal(value) || (validate && re.test(value) );
	},
	message: 'No es un nombre de dominio vlido'
};

ko.validation.rules['dattaDomain'] = {
	validator: function (value, validate) {
		var re = /^([a-zA-Z0-9--]([a-zA-Z0-9--\-]{0,61}[a-zA-Z0-9--])?){1}(\.[a-zA-Z]{2,14}){1,3}$/i;
		return $.isEmptyVal(value) || (validate && re.test(value) );
	},
	message: 'No es un nombre de dominio vlido'
};


ko.validation.rules['completeUrl'] = {
	validator: function( value, validate ){
		// now check if valid url
		// http://docs.jquery.com/Plugins/Validation/Methods/url
		// contributed by Scott Gonzalez: http://projects.scottsplayground.com/iri/
		var re = /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;
		return $.isEmptyVal(value) || (validate && re.test(value) );
	},
	message: 'No es una url web vlida'
};




ko.validation.rules['dattaPassword'] = {
	validator: function(value, validate) {
		var sValue = String(value)
			, reLetras = /[a-zA-Z]+/ig
			, reNumeros = /[0-9]+/ig;
		return $.isEmptyVal(value) || (validate && ( sValue.length >=8 && reLetras.test( sValue) && reNumeros.test( sValue) ) );
	}, 
	message: "Al menos una letra, un nmero, y 8 o ms caracteres"
};

ko.validation.rules['dattaDatabaseName'] = {
	validator: function(value, validate) {
		var sValue = String(value)
			, re = /^[a-zA-Z0-9_]{1,55}$/ig; // 55 caracteres, porque el mximo es 64 menos guin bajo, menos los 8 caracteres del nombre de usuario
			
		return $.isEmptyVal(value) || (validate && ( re.test( sValue) ) );
	}, 
	message: "Slo letras, nmeros y guin bajo hasta 55 caracteres"
};


ko.validation.rules['withoutwww'] = {
	validator: function (value, validate) {
		var re = /^www\./i;
		return $.isEmptyVal(value) || (validate && !(re.test(value)) );
	},
	message: 'No debe incluir www.'
};

ko.validation.rules['twitterUsername'] = {
	validator: function (value, validate) {
		var re = /^([a-zA-Z0-9_]){1,15}$/;
		return $.isEmptyVal(value) || (validate && (re.test(value)) );
	},
	message: 'No es un nombre de usuario de twitter vlido'
};

ko.validation.rules['facebookUsername'] = {
	validator: function (value, validate) {
		var re = /^[a-z\d.]{5,}$/i;
		return $.isEmptyVal(value) || (validate && (re.test(value)) );
	},
	message: 'No es un nombre de usuario de facebook vlido'
};

ko.validation.rules['googlePlusUsername'] = {
	validator: function (value, validate) {
		//var re = /\+[^/]+|\d{21}/i;
		var re = /^\+[a-zA-Z\d]{3,}|^[\d]{21}|plus\.google\.com\/(\+?[a-zA-Z\d]+)/ig;
		return $.isEmptyVal(value) || (validate && (re.test(value)) );
	},
	message: 'No es un nombre de usuario de google+ vlido'
};

ko.validation.rules['instagramUsername'] = {
	validator: function (value, validate) {
		var re = /^([a-zA-Z0-9_.]){1,30}$/;
		return $.isEmptyVal(value) || (validate && (re.test(value)) );
	},
	message: 'No es un nombre de usuario de instagram vlido'
};

ko.validation.rules['pinterestUsername'] = {
	validator: function (value, validate) {
		var re = /^([a-zA-Z0-9_.]){1,30}$/;
		return $.isEmptyVal(value) || (validate && (re.test(value)) );
	},
	message: 'No es un nombre de usuario de pinterest vlido'
};


ko.validation.rules['gaWebPropertyID'] = {
	validator: function( value, validate ){
		var re = /^UA-\d+-\d+$/;
		return $.isEmptyVal( value ) || ( validate && re.test( value ) );
	},
	message: 'Debe tener formato de ID de Google Analytics: UA-XXXXXXXXX-YY'
};

ko.validation.rules['integer'] = {
	validator: function (value, validate) {		
		return $.isEmptyVal(value) || (validate && ($.isInteger( value )) );
	},
	message: 'No es un nmero entero'
};

ko.validation.rules['positiveInteger'] = {
	validator: function (value, validate) {		
		return $.isEmptyVal(value) || (validate && $.isInteger( value ) && value > 0  );
	},
	message: 'No es un nmero entero positivo'
};

ko.validation.rules['positiveIntegerOrZero'] = {
	validator: function (value, validate) {		
		return $.isEmptyVal(value) || (validate && $.isInteger( value ) && value >= 0  );
	},
	message: 'No es un nmero entero positivo  cero'
};

ko.validation.rules['alphanumeric'] = {
	validator: function( value, validate ){
		var re = /^[a-zA-Z0-9]+$/;
		return $.isEmptyVal( value ) || ( validate && re.test( value ) );
	},
	message: 'Slo letras y nmeros'
};


ko.validation.rules['cuit'] = {
	validator: function( value, validate ){
		var re = /^[a-zA-Z0-9]+$/;
		if ($.isEmptyVal( value ) ) return true;

		var cuit = value;

		if( !( /^\d{2}-\d{8}-\d{1}$/.test( cuit ) ) ) return false;

		cuit = cuit.replace(/-/ig, '');
		if(cuit.length != 11) {
			return false;
		}

		var acumulado   = 0;
		var digitos     = cuit.split("");
		var digito      = digitos.pop();

		for(var i = 0; i < digitos.length; i++) {
			acumulado += digitos[9 - i] * (2 + (i % 6));
		}

		var verif = 11 - (acumulado % 11);
		if(verif == 11) {
			verif = 0;
		} else if(verif == 10) {
			verif = 9;
		}

		return digito == verif;
	},
	message: 'Ingresa un CUIT vlido en formato XX-XXXXXXXX-X (con guiones)'
};


ko.validation.rules['includes'] = {
	validator: function( value, validate ){
		var result
			, validate = ko.unwrap( validate );
		if (!validate ||$.isEmptyVal( value ) ) {
			result = true;
		} else {
			result = typeof value == 'string' && value.indexOf(validate) != -1;
		}
		return result;
	},
	message: 'El campo debe incluir {0}'
}
			
ko.validation.rules['notIncludes'] = {
	validator: function( value, validate ){
		var result
			, validate = ko.unwrap( validate );
		if (!validate || $.isEmptyVal( value ) ) {
			result = true;
		} else {
			result = ( typeof value != 'string' ) || value.toLowerCase().indexOf(String(validate).toLowerCase()) == -1;
		}
		return result;
	},
	message: 'El campo no debe incluir {0}'
}


ko.validation.rules['phoneNumberTodoPago'] = {
	validator: function (phoneNumber, validate) {
		if (typeof (phoneNumber) !== 'string') { return false; }
		if ($.isEmptyVal(phoneNumber)) { return true; } // makes it optional, use 'required' rule if it should be required
		//phoneNumber = phoneNumber.replace(/\s+/g, "");
		var re = /^[\d \(\)]{6,20}$/;
		return validate && re.test(phoneNumber);
	},
	message: 'Please specify a valid phone number'
};

ko.validation.rules['firstLastNameTodoPago'] = {
	validator: function (text, validate) {
		if (typeof (text) !== 'string') { return false; }
		if ($.isEmptyVal(text)) { return true; } // makes it optional, use 'required' rule if it should be required
		//text = text.replace(/\s+/g, "");
		var re = /^[a-zA-Z-- ]{3,60}$/;
		return validate && re.test(text);
	},
	message: 'Please specify a valid text'
};

ko.validation.rules['postalCodeTodoPago'] = {
	validator: function (text, validate) {
		if (typeof (text) !== 'string') { return false; }
		if ($.isEmptyVal(text)) { return true; } // makes it optional, use 'required' rule if it should be required
		//text = text.replace(/\s+/g, "");
		var re = /^[\w]{1,10}$/;
		return validate && re.test(text);
	},
	message: 'Please specify a valid text'
};

ko.validation.rules['cityTodoPago'] = {
	validator: function (text, validate) {
		if (typeof (text) !== 'string') { return false; }
		if ($.isEmptyVal(text)) { return true; } // makes it optional, use 'required' rule if it should be required
		//text = text.replace(/\s+/g, "");
		var re = /^[a-zA-Z--\.\- ]{1,50}$/;
		return validate && re.test(text);
	},
	message: 'Please specify a valid text'
};

ko.validation.rules['streetTodoPago'] = {
	validator: function (text, validate) {
		if (typeof (text) !== 'string') { return false; }
		if ($.isEmptyVal(text)) { return true; } // makes it optional, use 'required' rule if it should be required
		//text = text.replace(/\s+/g, "");
		var re = /^[a-zA-Z--\d\.\-\'\"\`\\(\) ]{1,60}$/;
		return validate && re.test(text);
	},
	message: 'Please specify a valid text'
};


ko.validation.rules['whatsappNumber'] = {
	validator: function (text, validate) {
		if (typeof (text) !== 'string') { return false; }
		if ($.isEmptyVal(text)) { return true; } // makes it optional, use 'required' rule if it should be required
		return validate && $.string.isValidWhatsappNumber( text );
	},
	message: 'Ingresa un nmero de whatsapp vlido'
};

ko.validation.rules['whatsappNumberCollection'] = {
	validator: function (text, validate) {
		if (typeof (text) !== 'string') { return false; }
		if ($.isEmptyVal(text)) { return true; } // makes it optional, use 'required' rule if it should be required
		return validate && $.string.isValidWhatsappNumberCollection( text );
	},
	message: 'Ingresa un nmero de whatsapp vlido, sin espacios.'
};

ko.validation.rules['isValidDate'] = {
	validator: function (fecha, validate) {
		if (typeof (fecha) !== 'string') { return false; }
		if ($.isEmptyVal(fecha)) { return true; } // makes it optional, use 'required' rule if it should be required
		
                if($.string.isValidDate( fecha ))
                {
                    return validate
                }
                
                return !validate;
	},
	message: 'Ingresa una fecha vlida'
};

ko.validation.rules['isValidHour'] = {
	validator: function (hora, validate) {
		if (typeof (hora) !== 'string') { return false; }
		if ($.isEmptyVal(hora)) { return true; } // makes it optional, use 'required' rule if it should be required
		
                if($.string.isValidHour( hora ))
                {
                    return validate
                }
                
                return !validate;
	},
	message: 'Ingresa una hora vlida'
};

ko.validation.rules['isValidDataAndHour'] = {
	validator: function (fechaYhora, validate) {
		if (typeof (fechaYhora) !== 'string') { return false; }
		if ($.isEmptyVal(fechaYhora)) { return true; } // makes it optional, use 'required' rule if it should be required
		
                var arrayfechaYhora = fechaYhora.split(" ");
                
                var fecha = arrayfechaYhora[0];
                var hora = arrayfechaYhora[1];
                
                if($.string.isValidDate( fecha ) && $.string.isValidHour( hora ))
                {
                    return validate
                }
                
                return !validate;
	},
	message: 'Ingresa fecha y hora vlidas'
};

ko.validation.registerExtenders();


////////////////////////////////////////////////////////////////////////////////



ko.validatedDeepObservable = function (initialValue, options) {
	var options = $.extend({deep: true}, options);
	
	if (!ko.validation.utils.isObject(initialValue)) {
		return ko.observable(initialValue).extend({
			validatable: true
		});
	}

	var obsv = ko.observable(initialValue);
	obsv.errors = ko.validation.group(initialValue, options);
	obsv.isValid = ko.computed(function () {
		return obsv.errors().length === 0;
	});

	return obsv;
};



(function(){
	
	// las siguientes son funciones anlogas a las originales, pero funcionan con mapping, cosa que las originales no.

	ko.bindingHandlers['validationErrorClass'] = {
		_inValidationCycle: false,
		
		update: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var obsv = valueAccessor(),
			val = ko.utils.unwrapObservable(obsv),
			isModified = false,
			isValid = false;


			isModified = obsv.isModified && obsv.isModified();
			isValid = obsv.isValid && obsv.isValid();

			// create an evaluator function that will return something like:
			// css: { validationElement: true }
			var cssSettingsAccessor = function () {
				var css = {};
				
				var shouldShow = (isModified ? !isValid : false);

				// css: { validationElement: false }
				css[ko.validation.getConfig().errorElementClass || 'error'] = shouldShow;
				return css;
			};

			//add or remove class on the element;
			ko.bindingHandlers.css.update(element, cssSettingsAccessor);

			/////////////////////////////////////
		}
	};

	ko.bindingHandlers['validationErrorMessage'] = { // individual error message, if modified or post binding
		i18n	: false, 
		
		init: function(element, valueAccessor){
			var obsv = valueAccessor(),
			val = ko.utils.unwrapObservable(obsv),
			msg = null,
			isModified = false,
			isValid = false;
			
			isModified = obsv.isModified && obsv.isModified();
			isValid = obsv.isValid && obsv.isValid();


			//toggle visibility on validation messages when validation hasn't been evaluated, or when the object isValid
			var visiblityAccessor = function () {
				return isModified ? !isValid : false;
			};

			ko.bindingHandlers.slideVisible.init(element, visiblityAccessor);	
		},
		
		
		update: function (element, valueAccessor, allBindingsAccessor, context) {
			var obsv = valueAccessor(),
			val = ko.utils.unwrapObservable(obsv),
			msg = null,
			isModified = false,
			isValid = false;

			isModified = obsv.isModified && obsv.isModified();
			isValid = obsv.isValid && obsv.isValid();
            
			// create a handler to correctly return an error message
			var errorMsgAccessor = function () {
				if (isModified) {
					return isValid ? null : ko.unwrap ( obsv.error || obsv.errors);
				} else {
					return null;
				}
			};

			//toggle visibility on validation messages when validation hasn't been evaluated, or when the object isValid
			var visiblityAccessor = function () {
				return isModified ? !isValid : false;
			};

			if( ko.bindingHandlers['validationErrorMessage'].i18n ){
				ko.bindingHandlers.i18nText.update(element, errorMsgAccessor, allBindingsAccessor, context);							
			} else {
				ko.bindingHandlers.text.update(element, errorMsgAccessor, allBindingsAccessor, context);							
			}
			ko.bindingHandlers.slideVisible.update(element, visiblityAccessor);
		}
	};


}());


// redefinimos formatMessage para i18n
ko.validation.formatMessage = function (message, params) {
	if( ko.bindingHandlers['validationErrorMessage'].i18n ) {
		message = i18n.kot(message);
	}
	return message.replace(/\{0\}/gi, ko.unwrap( params ));
},



// TRADUCCIONES
ko.validation.localize({
	'required'	: 'Este campo es obligatorio',
	'min'		: 'Por favor ingrese un valor mayor o igual que {0}.',
	'max'		: 'Por favor ingrese un valor menor o igual que {0}.',	
	'minLength'	: 'Por favor ingrese al menos {0} caracteres.',	
	'maxLength'	: 'Por favor ingrese como mximo {0} caracteres.',	
	'pattern'	: 'Por favor verifique este valor',	
	'step'		: 'El valor debe incrementarse de a {0}',	
	'email'		: 'Por favor ingrese un email vlido',	
	'date'		: 'Por favor ingrese una fecha vlida',	
	'dateISO'	: 'Por favor ingrese una fecha vlida',
    'dateTime'  : 'Por favor ingrese una fecha vlida',
	'number'	: 'Por favor ingrese un nmero',
	'digit'		: 'Por favor ingrese un dgito',	
	'phoneUS'	: 'Por favor ingrese nmero de telfono vlido',
	'phoneNumber': 'Por favor ingrese nmero de telfono vlido',
	'phoneNumberTodoPago': 'Por favor ingrese nmero de telfono vlido',
	'firstLastNameTodoPago'     : 'Este campo es invlido',
	'equal'		: 'Los valores deben ser iguales',	
	'notEqual'	: 'Por favor elija otro valor',	
	'unique'	: 'Asegrese de que el valor sea nico'       
});


/* /js/libs/knockout.validation.i18n.js
 * compresion time: 0.02289 -(ms)
 * ------------------------------------ */
if(ko.validation){
	ko.validation.configure({
		decorateElement		: true,
		errorElementClass	: 'error',
		insertMessages		: false
	});

	ko.bindingHandlers['validationErrorMessage'].i18n = true;

	ko.validation.localize({
		'required'	: 'global:validacion.regla.required',
		'min'		: 'global:validacion.regla.min',
		'max'		: 'global:validacion.regla.max',
		'minLength'	: 'global:validacion.regla.minlength',
		'maxLength'	: 'global:validacion.regla.maxlength',
		'pattern'	: 'global:validacion.regla.pattern',
		'step'		: 'global:validacion.regla.step',
		'email'		: 'global:validacion.regla.email',
		'date'		: 'global:validacion.regla.date',
		'dateISO'	: 'global:validacion.regla.dateiso',
		'number'	: 'global:validacion.regla.number',
		'digit'		: 'global:validacion.regla.digit',
		'phoneUS'	: 'global:validacion.regla.phoneus',
		'equal'		: 'global:validacion.regla.equal',
		'notEqual'	: 'global:validacion.regla.notequal',
		'unique'	: 'global:validacion.regla.unique',

		'accounting.money'								: 'global:validacion.regla.accounting.money',
		'validChildren'									: 'global:validacion.regla.validchildren',
		'dattaEmailPassword'							: 'global:validacion.regla.dattaemailpassword',
		'dattaEmailPasswordNotConsecutiveNumbers'		: 'global:validacion.regla.dattaemailpasswordnotconsecutivenumbers',
		'dattaEmailPasswordSymbol'						: 'global:validacion.regla.dattaemailpasswordsymbol',

		'includes'										: 'global:validacion.regla.includes',
		'notIncludes'									: 'global:validacion.regla.notincludes',

		'dattaEmailName'			: 'global:validacion.regla.dattaemailname',
		'domain'					: 'global:validacion.regla.domain',
		'dattaDomain'				: 'global:validacion.regla.dattadomain',
		'dattaPassword'				: 'global:validacion.regla.dattapassword',
		'dattaDatabaseName'			: 'global:validacion.regla.dattadatabasename',
		'withoutwww'				: 'global:validacion.regla.withoutwww',
		'twitterUsername'			: 'global:validacion.regla.twitterusername',
		'facebookUsername'			: 'global:validacion.regla.facebookusername',
		'googlePlusUsername'		: 'global:validacion.regla.googleplususername',
		'gaWebPropertyID'			: 'global:validacion.regla.gawebpropertyid',
		'integer'					: 'global:validacion.regla.integer',
		'positiveInteger'			: 'global:validacion.regla.positiveinteger',
		'positiveIntegerOrZero'		: 'global:validacion.regla.positiveintegerorzero',

		'alphanumeric'				: 'global:validacion.regla.alphanumeric.solo_letras_y_numeros',
		'completeUrl'               : 'global:validacion.regla.completeurl'

	});
};


/* /js/libs/knockout-sortable.lisandro.js
 * compresion time: 0.02503 -(ms)
 * -------------------------------------- */
// knockout-sortable 0.8.2 | (c) 2013 Ryan Niemeyer |  http://www.opensource.org/licenses/mit-license
;(function(factory) {
    if (typeof define === "function" && define.amd) {
        // AMD anonymous module
        define(["knockout", "jquery", "jquery.ui.sortable"], factory);
    } else {
        // No module loader (plain <script> tag) - put directly in global namespace
        factory(window.ko, jQuery);
    }
})(function(ko, $, undefined) {
    var ITEMKEY = "ko_sortItem",
        INDEXKEY = "ko_sourceIndex",
        LISTKEY = "ko_sortList",
        PARENTKEY = "ko_parentList",
        DRAGKEY = "ko_dragItem",
        unwrap = ko.utils.unwrapObservable,
        dataGet = ko.utils.domData.get,
        dataSet = ko.utils.domData.set;

    //internal afterRender that adds meta-data to children
    var addMetaDataAfterRender = function(elements, data) {
        ko.utils.arrayForEach(elements, function(element) {
            if (element.nodeType === 1) {
                dataSet(element, ITEMKEY, data);
                dataSet(element, PARENTKEY, dataGet(element.parentNode, LISTKEY));
            }
        });
    };

    //prepare the proper options for the template binding
    var prepareTemplateOptions = function(valueAccessor, dataName) {
        var result = {},
            options = unwrap(valueAccessor()),
            actualAfterRender;

        //build our options to pass to the template engine
        if (options.data) {
            result[dataName] = options.data;
            result.name = options.template;
        } else {
            result[dataName] = valueAccessor();
        }

        ko.utils.arrayForEach(["afterAdd", "afterRender", "as", "beforeRemove", "includeDestroyed", "templateEngine", "templateOptions"], function (option) {
            result[option] = options[option] || ko.bindingHandlers.sortable[option];
        });

        //use an afterRender function to add meta-data
        if (dataName === "foreach") {
            if (result.afterRender) {
                //wrap the existing function, if it was passed
                actualAfterRender = result.afterRender;
                result.afterRender = function(element, data) {
                    addMetaDataAfterRender.call(data, element, data);
                    actualAfterRender.call(data, element, data);
                };
            } else {
                result.afterRender = addMetaDataAfterRender;
            }
        }

        //return options to pass to the template binding
        return result;
    };

    var updateIndexFromDestroyedItems = function(index, items) {
        var unwrapped = unwrap(items);

        if (unwrapped) {
            for (var i = 0; i < index; i++) {
                //add one for every destroyed item we find before the targetIndex in the target array
                if (unwrapped[i] && unwrap(unwrapped[i]._destroy)) {
                    index++;
                }
            }
        }

        return index;
    };

    //connect items with observableArrays
    ko.bindingHandlers.sortable = {
        init: function(element, valueAccessor, allBindingsAccessor, data, context) {
            var $element = $(element),
                value = unwrap(valueAccessor()) || {},
                templateOptions = prepareTemplateOptions(valueAccessor, "foreach"),
                sortable = {},
                startActual, updateActual, changeActual, cloneActual; /// *** LISANDRO ***

            //remove leading/trailing non-elements from anonymous templates
            ko.utils.arrayForEach(element.childNodes, function(node) {
                if (node && node.nodeType !== 1) {
                    node.parentNode.removeChild(node);
                }
            });

            //build a new object that has the global options with overrides from the binding
            $.extend(true, sortable, ko.bindingHandlers.sortable);
            if (value.options && sortable.options) {
                ko.utils.extend(sortable.options, value.options);
                delete value.options;
            }
            ko.utils.extend(sortable, value);

            //if allowDrop is an observable or a function, then execute it in a computed observable
            if (sortable.connectClass && (ko.isObservable(sortable.allowDrop) || typeof sortable.allowDrop == "function")) {
                ko.computed({
                    read: function() {
                        var value = unwrap(sortable.allowDrop),
                            shouldAdd = typeof value == "function" ? value.call(this, templateOptions.foreach) : value;
                        ko.utils.toggleDomNodeCssClass(element, sortable.connectClass, shouldAdd);
                    },
                    disposeWhenNodeIsRemoved: element
                }, this);
            } else {
                ko.utils.toggleDomNodeCssClass(element, sortable.connectClass, sortable.allowDrop);
            }

            //wrap the template binding
            ko.bindingHandlers.template.init(element, function() { return templateOptions; }, allBindingsAccessor, data, context);

            //keep a reference to start/update functions that might have been passed in
            startActual = sortable.options.start;
            updateActual = sortable.options.update;
            changeActual = sortable.options.change; /// *** LISANDRO ***
			cloneActual	 = sortable.options.clone; /// *** LISANDRO ***

            //initialize sortable binding after template binding has rendered in update function
            var createTimeout = setTimeout(function() {
                var dragItem
					, connectClass = sortable.connectClass ? "." + sortable.connectClass : false; // *** LISANDRO ***

                $element.sortable(ko.utils.extend(sortable.options, {
					change: function( event, ui ){  /// *** LISANDRO ***
						changeActual && changeActual.apply(this, arguments ); /// *** LISANDRO ***
					}, /// *** LISADNRO ***
					
                    start: function(event, ui) {
                        //track original index
                        var el = ui.item[0];
                        dataSet(el, INDEXKEY, ko.utils.arrayIndexOf(ui.item.parent().children(), el));

                        //make sure that fields have a chance to update model
                        ui.item.find("input:focus").change();
                        if (startActual) {
                            startActual.apply(this, arguments);
                        }
                    },
                    receive: function(event, ui) {
                        dragItem = dataGet(ui.item[0], DRAGKEY);
                        if (dragItem) {
                            //copy the model item, if a clone option is provided
							if( cloneActual	){ /// *** LISANDRO ***
								dragItem = cloneActual( dragItem ); /// *** LISANDRO ***
							} else if (dragItem.clone) { /// *** LISANDRO ***
                                dragItem = dragItem.clone(); /// *** LISANDRO ***
                            } /// *** LISANDRO ***

                            //configure a handler to potentially manipulate item before drop
                            if (sortable.dragged) {
                                dragItem = sortable.dragged.call(this, dragItem, event, ui) || dragItem;
                            }
                        }
                    },
                    update: function(event, ui) {
                        var sourceParent, targetParent, sourceIndex, targetIndex, arg,
                            el = ui.item[0],
                            parentEl = ui.item.parent()[0],
                            item = dataGet(el, ITEMKEY) || dragItem;

                        dragItem = null;

                        //make sure that moves only run once, as update fires on multiple containers
                        if (item && (this === parentEl || $.contains(this, parentEl))) {
                            //identify parents
                            sourceParent = dataGet(el, PARENTKEY);
                            sourceIndex = dataGet(el, INDEXKEY);
                            targetParent = dataGet(el.parentNode, LISTKEY);
                            targetIndex = ko.utils.arrayIndexOf(ui.item.parent().children(':not(.sortable-dummy)'), el); /// *** LISANDRO ***

                            //take destroyed items into consideration
                            if (!templateOptions.includeDestroyed) {
                                sourceIndex = updateIndexFromDestroyedItems(sourceIndex, sourceParent);
                                targetIndex = updateIndexFromDestroyedItems(targetIndex, targetParent);
                            }

                            if (sortable.beforeMove || sortable.afterMove) {
                                arg = {
                                    item: item,
                                    sourceParent: sourceParent,
                                    sourceParentNode: sourceParent && ui.sender || el.parentNode,
                                    sourceIndex: sourceIndex,
                                    targetParent: targetParent,
                                    targetIndex: targetIndex,
									targetParentNode: el.parentNode, /// *** LISANDRO ***
                                    cancelDrop: false
                                };
                            }

                            if (sortable.beforeMove) {
                                sortable.beforeMove.call(this, arg, event, ui);
                                if (arg.cancelDrop) {
                                    //call cancel on the correct list
                                    if (arg.sourceParent) {
                                        $(arg.sourceParent === arg.targetParent ? this : ui.sender).sortable('cancel');
                                    }
                                    //for a draggable item just remove the element
                                    else {
                                        $(el).remove();
                                    }

                                    return;
                                }
                            }

                            if (targetIndex >= 0) {
                                if (sourceParent) {
                                    sourceParent.splice(sourceIndex, 1);

                                    //if using deferred updates plugin, force updates
                                    if (ko.processAllDeferredBindingUpdates) {
                                        ko.processAllDeferredBindingUpdates();
                                    }
                                }

                                targetParent.splice(targetIndex, 0, item);
                            }

                            //rendering is handled by manipulating the observableArray; ignore dropped element
                            dataSet(el, ITEMKEY, null);
                            ui.item.remove();

                            //if using deferred updates plugin, force updates
                            if (ko.processAllDeferredBindingUpdates) {
                                ko.processAllDeferredBindingUpdates();
                            }

                            //allow binding to accept a function to execute after moving the item
                            if (sortable.afterMove) {
                                sortable.afterMove.call(this, arg, event, ui);
                            }
                        }

                        if (updateActual) {
                            updateActual.apply(this, arguments);
                        }
                    },
									
					connectWith: connectClass /// *** LISANDRO ***

                }));

                //handle enabling/disabling sorting
                if (sortable.isEnabled !== undefined) {
                    ko.computed({
                        read: function() {
                            $element.sortable(unwrap(sortable.isEnabled) ? "enable" : "disable");
                        },
                        disposeWhenNodeIsRemoved: element
                    });
                }
            }, 0);

            //handle disposal
            ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
                //only call destroy if sortable has been created
                if ($element.data("sortable")) {
                    $element.sortable("destroy");
                }

                //do not create the sortable if the element has been removed from DOM
                clearTimeout(createTimeout);
            });

            return { 'controlsDescendantBindings': true };
        },
        update: function(element, valueAccessor, allBindingsAccessor, data, context) {
            var templateOptions = prepareTemplateOptions(valueAccessor, "foreach");

            //attach meta-data
            dataSet(element, LISTKEY, templateOptions.foreach);

            //call template binding's update with correct options
            ko.bindingHandlers.template.update(element, function() { return templateOptions; }, allBindingsAccessor, data, context);
        },
        connectClass: 'ko_container',
        allowDrop: true,
        afterMove: null,
        beforeMove: null,
        options: {}
    };

    //create a draggable that is appropriate for dropping into a sortable
    ko.bindingHandlers.draggable = {
        init: function(element, valueAccessor, allBindingsAccessor, data, context) {
            var value = unwrap(valueAccessor()) || {},
                options = value.options || {},
                draggableOptions = ko.utils.extend({}, ko.bindingHandlers.draggable.options),
                templateOptions = prepareTemplateOptions(valueAccessor, "data"),
                connectClass = value.connectClass || ko.bindingHandlers.draggable.connectClass,
                isEnabled = value.isEnabled !== undefined ? value.isEnabled : ko.bindingHandlers.draggable.isEnabled;

            value = value.data || value;

            //set meta-data
            dataSet(element, DRAGKEY, value);

            //override global options with override options passed in
            ko.utils.extend(draggableOptions, options);

            //setup connection to a sortable
            draggableOptions.connectToSortable = connectClass ? "." + connectClass : false;

            //initialize draggable
            $(element).draggable(draggableOptions);

            //handle enabling/disabling sorting
            if (isEnabled !== undefined) {
                ko.computed({
                    read: function() {
                        $(element).draggable(unwrap(isEnabled) ? "enable" : "disable");
                    },
                    disposeWhenNodeIsRemoved: element
                });
            }

            return ko.bindingHandlers.template.init(element, function() { return templateOptions; }, allBindingsAccessor, data, context);
        },
        update: function(element, valueAccessor, allBindingsAccessor, data, context) {
            var templateOptions = prepareTemplateOptions(valueAccessor, "data");

            return ko.bindingHandlers.template.update(element, function() { return templateOptions; }, allBindingsAccessor, data, context);
        },
        connectClass: ko.bindingHandlers.sortable.connectClass,
        options: {
            helper: "clone"
        }
    };

});


/* /js/libs/rad.lisandro.js
 * compresion time: 0.02098 -(ms)
 * ------------------------ */
;(function ( $, window, document, undefined ) {
    var pluginName = 'rad',
        defaults = {
            allowBiggerSizing: "false",
            maxWidth: null
        };

    function Plugin( element, options ) {
        this.element = element;
		
		Plugin._index = ( Plugin._index || 0 ) + 1;
		
		this.uid = Plugin._index;

        this.options = $.extend( {}, defaults, options) ;
        
        this._defaults = defaults;
        this._name = pluginName;

        var self = this;
        
        self.init();
        self.setScale();

		self.__setScale = $.proxy( self.setScale, self );

        $(window).on( 'resize.rad.' + this.uid + 'orientationchange.rad.' + this.uid , self.__setScale );
		/*
		$(window).resize(function(){
            self.setScale();
        });
		*/
    }

    Plugin.prototype.init = function () {
        
        this.id = this.element.id;
        var $elem = $(this.element);
        this.adWidth = $elem.width(); //save original width and height
        this.adHeight = $elem.height();
        $elem.closest('div[class^="radWrapper"]').css({position:'relative', width:this.adWidth+'px', height:this.adHeight+'px', maxWidth: '100%'});
        this.adParent = $elem.closest('div[class^="radWrapper"]').parent(); //save parent for updating container width value
        
        if(this.options.maxWidth){
            this.options.maxWidth = parseFloat(this.options.maxWidth);
        }        
        $elem.css({
            '-webkit-transform-origin':'0 0',
            '-moz-transform-origin':'0 0',
            '-ms-transform-origin':'0 0',
            '-o-transform-origin':'0 0',
            'transform-origin':'0 0',
            'position':'absolute'
        });
    };
	
	Plugin.prototype.destroy = function(){
        $(window).off( 'resize.rad.' + this.uid + 'orientationchange.rad.' + this.uid , self.__setScale );
		this.adParent = null;
		this.element = null;
	};

    //set new scale
    Plugin.prototype.setScale = function(pWidth, adWidth){ 
        $elem = $(this.element);
        var pWidth = this.adParent.width();
        //if maxWidth option set, check before rescaling
        if(this.options.maxWidth){
            if(pWidth > this.options.maxWidth){
                return false;
            }
        }
        if((pWidth < this.adWidth) || (this.options.allowBiggerSizing === "true")){
            var newScale = (pWidth / this.adWidth) -.001; //scale .001 smaller to fix a minor paint issue by the browser
            var newHeight = (pWidth * this.adHeight ) / this.adWidth;
            var newWidth = (this.adWidth * newHeight) / this.adHeight;
            // set newScale & newHeight (and pWidth if needed) to ad div
            $elem.closest('div[class^="radWrapper"]').css({
                'height': newHeight+'px',
                'width' : newWidth+'px'
            });
            $elem.css({
                '-moz-transform': 'scale(' + newScale + ')',
                '-webkit-transform': 'scale(' + newScale + ')',
                '-o-transform': 'scale(' + newScale + ')',
                '-ms-transform': 'scale(' + newScale + ')',
                'transform': 'scale(' + newScale + ')'
            });
        }
    }

    $.fn[pluginName] = function ( options ) {
        return this.each(function () {
            if (!$.data(this, 'plugin_' + pluginName)) {
                $.data(this, 'plugin_' + pluginName, 
                new Plugin( this, options ));
            }
        });
    }

})( jQuery, window, document );


/* /js/libs/knockout.extensions.rad.js
 * compresion time: 0.02098 -(ms)
 * ----------------------------------- */
/**
 * onresize
 */

ko.bindingHandlers['rad'] = {
	init: function(element, valueAccessor, allBindingsAccessor, viewModel) {
		var value = ko.utils.unwrapObservable(valueAccessor()),
			allBindings = allBindingsAccessor(),
			width = ko.observable(),
			height = ko.observable(),
			options = $.extend({
			}, allBindings.radOptions),
			initTimeout;
		
		initTimeout = setTimeout( function(){
			var $add = $(element).find('.adsbygoogle');
			$(element).addClass("radWrapper");
			$add.rad(options);
		}, 0 );
		
					
		ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			var $add = $(element).find('.adsbygoogle');
			var radplugin = $add.data('plugin_rad');
			clearTimeout(initTimeout);			
			radplugin && radplugin.destroy();
		});
		
	},
				
	update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
	}
};


/* /js/libs/modalpopup.1.1.js
 * compresion time: 0.02599 -(ms)
 * -------------------------- */
////////////// nuevos PROMPT MODAL
/**
 * options:
 *      close           : si es false, no permite cerrar el modal con botones
 *      autoclose       : cierra el formulario automticamente luego de autoclose segundos
 *      cssClass        : agrega al contenedor esta clase CSS
 *      cancel          : texto del botn cancelar
 *      accept          : texto del botn aceptar
 *      size			: '' | 'large'
 *      type			: '' | 'danger'
 *      beforeAccept    : callback que se ejecuta al presionar el botn Aceptar. Si el callback devuelve false,
 *                        no se procede con el accept. Si devuelve true, s. El callback recibe un deferred. Si el callback
 *                        no devuelve nada, puede demorar la resolucin del accept para cuando haga resolve o reject del deferred.
 *
 *
 */

(function(){
	baseModal = $.Class({
		_zIndex: 5000,

		newZindex: function(){
			return baseModal._zIndex += 2;
		},

		addModal: function(modal){
			this.openModals.push(modal);
			this._setTopClasses();
			$('html').trigger('open.modal');
		},

		removeModal: function(modal){
			$.removeFromCollection(this.openModals, function(foundModal){return foundModal == modal});
			$('html').trigger('modalremove.modal');
			if(this.openModals.length==0) $('html').trigger('modalremoveall.modal');

			this._setTopClasses();
		},

		topMostModal: function(){
			return this.openModals[this.openModals.length-1];
		},

		_setTopClasses: function(){
			$.each(this.openModals, function(index, modal){
				modal.topmost(false);
			});
			var topmostmodal = this.topMostModal();
			topmostmodal && topmostmodal.topmost(true);

			$('body').toggleClass('modal-open', this.openModals.length > 0);

		},
		
		focusModal: function( modal ){
			var _focusModalTimeout, 
				message = modal._message(),
				buttonsContainer = modal._buttonsContainer,
				focusElement;
				
			_focusModalTimeout = this._focusModalTimeout = setTimeout( function(){
				focusElement = $(':input:visible', message )[0] || $('.btn-primary', buttonsContainer )[0];
				if( $( focusElement ).closest( 'html' ).length != 0 ) {
					$( focusElement ).focus();
				}				
			}, 100);		
			
			return _focusModalTimeout;
		},

		openModals: [],

		prototype: {
			_popupBoxClass: 'popup-box',
			_type: 'base', // extender a alert , prompt y confirm
			baseClass: 'popup-box',

			init: function (message, options) {
				var self = this;
				this.options = $.extend({
					i18n		: true,
					autoClose	: false
				}, options);


				this.deferred = $.Deferred();

				this._testBootstrapVersion();

				this._zIndex = this.constructor.newZindex();

				this.resolveOnClose = true;

				this._onWindowResize = function (event) {
					self._positionModal();
				};

				this._onWindowKeyUp = $.proxy(this._onKeyUp, this); // cuando se usa proxy, en .on y .off se deben usar namespaces. ej> click.popupbox1

				if (message && message.constructor == jQuery) message = message[0];
				if ($.isPlainObject(message)) message = String(message);
				this.message = message;

				if (this.messageIsHTML()) {
					$.extend(this._messageElementOriginal = {
						parent: $(this.message).parentNode,
						nextSibling: $(this.message)[0].nextSibling
					});
				}

				this._createModal();
				this._applyBindings();

				this.constructor.addModal(this);

				this._openModal();
				this._initAutoClose();

				$.extend(this, this.deferred);
			},

			_testBootstrapVersion: function(){
				if( !$.alert.bs3 ){
					var version = $.getObjectProperty($, 'fn.alert.Constructor.VERSION');
					$.alert.bs3 = (/^3.+/).test( version );
				}
			},
			
			translate: function( text ){
				if( window.i18n && this.options.i18n ){
					if( this.options.i18n ) text = {
						'aceptar'		: 'global:btn.aceptar',
						'cancelar'		: 'global:btn.cancelar',
						'cerrar'		: 'global:btn.cerrar'
					}[text.toLowerCase()] || text;

					text = i18n.validNamespaceKey( text ) ? 
						i18n.kot ? i18n.kot( text ) : i18n.t( text )
						: text;
				}
				return text;
			},
			
			_applyBindings: function(){
				var self = this;
				$(window).on('resize scroll', this._onWindowResize);
				this._repositionHandler = setInterval($.proxy(function(){
					this._onWindowResize();
				}, this), 100);
				$(window).on('keyup.' + (10000 - this.zIndex()), this._onWindowKeyUp);

				$(this._containerElement).on('click.' + this.zIndex(), '.' + this.baseClass + '-close', $.proxy(this._onButtonClose, this));
				$(this._overlayElement).on('click.' + this.zIndex(), $.proxy(this._onButtonClose, this));

				if(this.options.insertForm) $(this._form).on('submit', $.proxy(this._onSubmit, this));
			},

			_onButtonClose: function(event){
				var self = this;
				event.preventDefault();
				if( self._buttonsDisabled() || this.options.close === false ) return;
				self._onModalClose();
			},

			_removeBindings: function(){
				$(window).off('resize scroll', this._onWindowResize);
				clearInterval(this._repositionHandler);
				$(window).off('keyup.'  + (10000 - this.zIndex()), this._onWindowKeyUp);

				$(this._containerElement).off('click.'  + this.zIndex(), '.' + this.baseClass + '-close', this._onButtonClose);
				$(this._overlayElement).off('click.' + this.zIndex(), this._onButtonClose);

				if(this.options.insertForm) $(this._form).off('submit', this._onSubmit);				
			},

			_message: function(){
				var content;
				var modalSize = this.options.size;

				if(this.messageIsHTML()){
					//$(this.message).show();
					content = ($(this.message));
				}
				else {
					content = $('<span>')
						.addClass('title')
						.text(this.message);
					$(this._messageElementContainer).addClass('plain-text');
					if( this.message.length > 1000 ){
						modalSize = 'large';
					}
					this._setModalSize( modalSize );
				}
				return content;
			},

			_onSubmit: function(event){
				event.preventDefault();
				if(this.options.close !== false) this.close();
			},

			_onKeyUp: function(event){
				if(this.constructor.topMostModal() == this){
					event.stopImmediatePropagation();
					if (event.keyCode == 13) this._onEnterKey();
					if (event.keyCode == 27) this._onEscKey();
				}
			},

			_onEscKey: function(){
				if(this._buttonsDisabled()) return;

				if(this.options.close!==false){
					this._onModalClose();
				}
			},

			_onEnterKey: function(){
			},

			_onModalClose: function(){
				if(this._closed) return;
				this._closed = true;

				this._clearAutoClose();

				this.constructor.removeModal(this);

				$(this._message()).removeClass( this.baseClass + '-message-content'  );

				this._removeBindings();
				this._restoreMessageElement();

				 this._destroyModal();

				if(this.resolveOnClose) {
					this._executeDeferred();
				}
			},

			_executeDeferred: function(){
				this.deferred.resolve('ok');
			},

			_restoreMessageElement: function(){

				if(this.messageIsHTML()){
					if(this._messageElementOriginal.nextSibling){
						$(this._messageElementOriginal.nextSibling).before(this.message);
					}
					else if(this._messageElementOriginal.parent){
						$(this._messageElementOriginal.parent).append(this.message);
					}
				}
			},

			_destroyModal: function(){
				$(this._overlayElement).remove();
				$(this._containerElement).remove();
				clearTimeout( this._focusModalTimeout );
			},

			_createIcon: function(){
				return $('<span>').addClass( this.baseClass + '-icon icon-' + this._type );
			},

			_createButtons: function(){
				var container = this._createButtonsContainer()
					, acceptText = this.translate( this.options.accept || 'Cerrar' );
				
					container
						.append(
						this._closeButton = $('<button>')
							.addClass('yes btn btn-primary ' + this.baseClass + '-close')
							.html( acceptText )
					);

				if(this.options.autoClose){
					this._closeTimerElement = $('<span>').addClass(this.baseClass + '-autoclose-remaining');
					this._closeButton.append(this._closeTimerElement);
				}

				return container;
			},

			_createButtonsContainer: function(){
				if( $.alert.bs3 ){
					return this._buttonsContainer = $('<div>').addClass( 'modal-footer' );
				} else {
					return this._buttonsContainer = $('<div>').addClass( this.baseClass + '-buttons modal-footer' );
				}
			},

			_createCloseElement: function(){
				var element = $('<a class="' + this.baseClass + '-close close" href="#">&times;</a>');
				return this._closeElement = element;
			},

			_buttonsDisabled: function(value){
				if(value===undefined){
					return $(this._containerElement).hasClass('btn-disabled');
				} else {
					$(this._containerElement).toggleClass('btn-disabled', !!value);
				}
			},

			zIndex: function(){
				return this._zIndex;
			},

			buttonsDisabled: function(value){
				return this._buttonsDisabled(value);
			},

			topmost: function(value){
				if(value===undefined){
					return this._topmost;
				} else {
					this._topmost = value;
					$(this._containerElement).toggleClass('topmost', !!value);
					$(this._overlayElement).toggleClass('topmost', !!value);
				}
			},

			_showSpinner: function(value){
				if(value===undefined){
					return this._spinnerVisible;
				} else {
					this._spinnerVisible = value;
					if (value){
						$(this._buttonsContainer).append(this._spinner);
					} else {
						$(this._spinner).remove();
					}
				}
			},

			_createBS3Modal: function(){
				var zIndex = this.zIndex();

				$modal          = $('<div class="modal fade" style="display: block"></div>');
				$modalDialog    = $('<div class="modal-dialog"></div>');
				$modalContent   = $('<div class="modal-content"></div>');
				$modalHeader    = $('<div class="modal-header"></div>');
				$modalBody      = $('<div class="modal-body"></div>');

				$modal.append( $modalDialog );
				$modalDialog.append( $modalContent);
				$modalContent.append( $modalHeader );
				$modalContent.append( $modalBody );

				///////////////////////////////////

				this._containerElement          = $modal;
				this._wrapElement               = $modalContent;
				this._form                      = $('<form>').addClass( this.baseClass + '-form');
				this._messageElementContainer	= $modalBody;
				this._spinner                   = $('<div>').addClass( this.baseClass + '-spinner' );

				//////////////////////////////////

				this._overlayElement = $('<div>').addClass( this.baseClass + '-overlay modal-backdrop fade' );
				$(this._overlayElement)
					.css({
						'z-index': zIndex
					});

				$(this._containerElement)
					.append ( this._createCloseElement() )
					.css({
						'z-index': zIndex + 1,
						'visibility': 'hidden'
					});

				$modalBody.append( this._message() );
				$modalContent.append( this._createButtons() );

			},

			_createBS2Modal: function(){
				/////////////////////////////
				var zIndex = this.zIndex();

				this._overlayElement			= $('<div>').addClass( this.baseClass + '-overlay modal-backdrop' );
				this._containerElement			= $('<div>').addClass( this.baseClass + '-container modal fade' );
				this._wrapElement				= $('<div>').addClass( this.baseClass + '-wrap' );
				this._messageElementContainer	= $('<div>').addClass( this.baseClass + '-message' );
				this._spinner                   = $('<div>').addClass( this.baseClass + '-spinner' );
				this._form                      = $('<form>').addClass( this.baseClass + '-form');

				$(this._overlayElement)
					.css({
						'z-index': zIndex
					});

				$(this._containerElement)
					.append ( this._wrapElement )
					.append ( this._createCloseElement() )
					.css({
						'z-index': zIndex + 1,
						'visibility': 'hidden'
					});

				if (this.options.insertForm) {
					$(this._wrapElement)
						.append(
							$(this._form)
								.append ( this._createIcon() )
								.append ( this._messageElementContainer )
								.append ( this._createButtons() )
						);
				} else {
					$( this._wrapElement )
						.append ( this._createIcon() )
						.append ( this._messageElementContainer )
						.append ( this._createButtons() )
				}

				$(this._messageElementContainer)
					.append(this._message());

				if (this.options.close === false) {
					$('.' + this.baseClass + '-close', this._containerElement).hide();
				}

				if (this.options.accept === false) {
					this._closeButton && this._closeButton.hide();
				}

				if (this.options.buttons === false) {
					$(this._buttonsContainer).hide();
				}

				/*
				 $(this._message())
				 .data( 'original-css-display', $(this._message()).css("display") )
				 .css( {'display' : 'block'} );
				 */
				$(this._message()).addClass(this.baseClass + '-message-content');

				this.autoToggleFooter();
			},

			_createModal: function(){
				var result;
				if( $.alert.bs3 ){
					result = this._createBS3Modal();
				} else {
					result = this._createBS2Modal();
				}

				this._setModalSize();
				this._setTypeClass();
			},

			_setModalSize: function( size ){
				if( arguments.length == 0 ){
					size = this.options.size;
				}

				$(this._containerElement)
					.toggleClass('modal-large', size == 'large')
					.addClass (this.options.cssClass || '' );
			},

			_setTypeClass: function(){
				var isDanger = this.options.type == 'danger';
				var isPrimary = !this.options.type || this.options.type == 'primary';

				$(this._containerElement)
					.toggleClass( 'modal-error', isDanger );

				$(this._closeButton)
					.toggleClass('btn-danger', isDanger )
					.toggleClass('btn-primary', isPrimary)
			},

			_openModal: function () {
				var self = this;
				$('body').css({position: 'relative'})
					.append(this._overlayElement)
					.append(
					$(this._containerElement)
				);

				if( this.options.autofocus !== false ){
					this._focusModalTimeout = this.constructor.focusModal(this);
				}

				this._positionModal();

				setTimeout(function () {
					$(self._containerElement).addClass("in");
					self._overlayElement.addClass("in");
				}, 1);

			},

			_initAutoClose: function(){
				var self = this;
				if(this.options.autoClose){
					this._autoCloseStart = new Date();
					this._autoCloseInterval = setInterval($.proxy(this._onAutoCloseInterval, this),100);
				}
				this._onAutoCloseInterval();
			},

			_onAutoCloseInterval: function(){
				var self = this;
				var elapsed = new Date() - this._autoCloseStart;
				var secondsElapsed = Math.floor(elapsed / 1000);
				var remaining = self.options.autoClose * 1000 - elapsed;
				var secondsRemaining = Math.floor(remaining / 1000);
				$(self._closeTimerElement).text('(' + secondsRemaining + ')' );
				if( remaining <= 0 ) {
					self._onAutoClose();
				}
			},

			_clearAutoClose: function(){
				if(this._autoCloseInterval) {
					clearInterval(this._autoCloseInterval);
					this._autoCloseInterval = null;
				}
			},

			_onAutoClose: function(){
				this.close();
			},

			_positionModal: function(){
				$(this._containerElement).css({
					visibility: 'visible'
				});
			},

			messageIsHTML: function(){
				return $.isHTMLElement(this.message);
			},

			close: function(){
				this._onModalClose();

			},
			
			////////////////////////////////////////////////////////////////////

			toggleCloseButton: function (toggle) {
				if (this._closeButton) {
					if (toggle === undefined) toggle = !$(this._closeButton).is(':visible');
					this._closeButton.toggle(toggle);
				}

				if ($(this._buttonsContainer).children().length <= 1) $(this._buttonsContainer).toggle(toggle);
			},

			autoToggleFooter: function () {
				var shouldDisplayFooter = $(this._buttonsContainer).children().any(function () {
					return $(this).css('display') != 'none'
				});

				if(!shouldDisplayFooter ) $(this._buttonsContainer).hide();

			}
		}
	});

	//////////////////////////////////////////////////////////////////

	var baseModalAlert = baseModal.extend({
		_type: 'alert'
	});

	////////////////////////////////////////////////////////////////////////////

	var baseModalConfirm = baseModal.extend({
		_type: 'confirm',

		init: function(message, options){
			var self = this;

			options = $.extend({}, options);

			if ( options.preset == 'yesno' ){
				options.accept = 'global:btn.si';
				options.cancel = 'global:btn.no';
			}
			
			if ( options.preset == 'custom' ){
				options.accept = options.accept;
				options.cancel = options.cancel;
			}

			this.__accept = true;
			this.__cancel = true;
			
			this._parent(message, options);
		},
		
		toggleButtons: function( value ){
			var self = this;
			if(value === undefined) value = self._buttonsDisabled();			
			this._buttonsDisabled( !value );
		},
		
		buttonAcceptDisabled: function( value ){
			return this._buttonAcceptDisabled.apply( this, arguments );
		},
		
		///////////////////////////////
		
		_executeDeferred: function(){
			if(this.deferred._shouldResolve) this.deferred.resolve('ok');
			else this.deferred.reject();
		},

		_createButtons: function(){
			var self = this
				, btn_yes, btn_no
				, container = this._createButtonsContainer()
				, textCancel = this.translate( typeof this.options.cancel == 'string' ?  this.options.cancel : 'cancelar' )
				, textAccept = this.translate( typeof this.options.accept == 'string' ? this.options.accept : 'aceptar' );

			this._btn_no = $('<button>').attr('type', 'button').addClass('no btn btn-default').html( textCancel );
			this._btn_yes = $('<button>').attr('type', 'submit').addClass('yes btn btn-primary').html( textAccept );

			container
				.append ( this._btn_no )
				.append (' ')
				.append ( this._btn_yes );

			if(this.options.close===false) $(this._btn_no).add(this._closeElement).hide();
			
			if( this.options.accept === false ) this.toggleAccept( false );
			if( this.options.cancel === false ) this.toggleCancel( false );

			this.autoToggleFooter();
			//if ( $(this._buttonsContainer).children().length <= 1) $(this._buttonsContainer).hide();


			return container;
		},

		_buttonsDisabled: function(value){
			var result = this._parent(value);
			if(value!==undefined){
				$(this._btn_no).toggleClass('disabled', !!value);
				$(this._btn_yes).toggleClass('disabled', !!value);
			}
			return result;
		},
				
		_buttonAcceptDisabled: function( value ){
			if( arguments.length == 0 ){
				return !!this.__buttonAcceptDisabled;
			} else {
				this.__buttonAcceptDisabled = value;
				$(this._btn_yes).toggleClass('disabled', !!value);
			}
		},

		_onButtonYes: function(event){
			var self = this;
			if(self._buttonsDisabled() || this.buttonAcceptDisabled() ) return;

			if(self._btn_yes_deferred) self._btn_yes_deferred.reject();
			self._btn_yes_deferred = new $.Deferred();

			if(self.options.beforeAccept){
				var result = self.options.beforeAccept.call(this, self._btn_yes_deferred );
				if(result === true)	self._btn_yes_deferred.resolve(true);
				if(result === false) self._btn_yes_deferred.reject(false);
				if(result === undefined){
					self._buttonsDisabled(true);
					self._showSpinner(true);
				}
			} else {
				self._btn_yes_deferred.resolve(true);
			}


			self._btn_yes_deferred
				.done(function(){
					self.deferred._shouldResolve = true;
					self.close();
				})
				.always(function(){
					self._buttonsDisabled(false);
					self._showSpinner(false);
				})
		},
				
		_onButtonNo: function(){
			var self = this;
			if(self._buttonsDisabled()) return;
			self.deferred._shouldResolve = false;
			self.close();
		},

		_applyBindings: function(){
			var self = this;
			this._parent();
			if(this.options.insertForm) return;

			this._btn_yes.click($.proxy(this._onButtonYes, this));
			this._btn_no.click($.proxy(this._onButtonNo, this));
			
			$(this._containerElement).on('click', '[data-modal="accept"]', $.proxy(this._onButtonYes, this) );
			$(this._containerElement).on('click', '[data-modal="cancel"]', $.proxy(this._onButtonNo, this) );
			
		},

		_removeBindings: function(){
			this._parent();
			this._btn_yes.unbind('click');
			this._btn_no.unbind('click');
			if(self._btn_yes_deferred) self._btn_yes_deferred.reject();
			
			$(this._containerElement).off('click', '[data-modal="accept"]', this._onButtonYes );
			$(this._containerElement).off('click', '[data-modal="cancel"]', this._onButtonNo );

		},

		_onSubmit: function(event){
			event.stopPropagation();
			this._onButtonYes();
		},
		
		////////////////////////////////////////////////////////////////////////
		
		toggleAccept: function( value ){
			if( arguments.length == 0 ){
				value = !this.__accept;
			}			
			this._btn_yes.toggle( value );
		},

		toggleCancel: function( value ){
			if( arguments.length == 0 ){
				value = !this.__cancel;
			}			
			this._btn_no.toggle( value );
		}

	});

	//////////////////////////////////////////////////////////////////

	var baseModalPrompt = baseModalConfirm.extend({
		_type: 'prompt',

		init: function(message, options){
			var self = this;
			options = $.extend({
				type	: 'text'
			}, options );
			this._parent(message, options);
		},

		_applyBindings: function(){
			var self = this;
			this._parent();
		},

		_removeBindings: function(){
			this._parent();
		},

		_executeDeferred: function(){
			var value = this.val();
			if(this.deferred._shouldResolve) this.deferred.resolve(value);
			else this.deferred.reject();
		},

		_createInputElement: function(){
			this._inputElement = $('<input>').attr('type', this.options.type ).addClass( this.baseClass + '-input' ).addClass("input-block-level");
			if( $.alert.bs3 ){
				this._inputElement.addClass( 'form-control' );
			}
			if( this.options.value ){
				this._inputElement.val( this.options.value );
			}
			return this._inputElement;
		},

		_createModal: function(){
			this._parent();
			$(this._messageElementContainer)
				.append(this._createInputElement())
		},

		_openModal: function(){
			this._parent();
			$(this._inputElement).focus();
		},

		val: function(){
			return $(this._inputElement).val();
		}
	});

	//////////////////////////////////////////////////////////////////

	$.alert = function(element, options){
		var dialog = new baseModalAlert(element, options);
		return dialog;
	};

	$.confirm = function(element, options){
		var dialog = new baseModalConfirm(element, options);
		return dialog;
	};

	$.prompt = function(element, options){
		var dialog = new baseModalPrompt(element, options);
		return dialog;
	}


})();


/* /js/libs/knockout.extensions.tagname.js
 * compresion time: 0.02193 -(ms)
 * --------------------------------------- */
/**
 * 
 * este binding handler permite cambiar el tagname de un elemento. Lo hace reemplazando el elemento por otro, y moviendo sus contenidos de un lado a otro.
 */

;(function(){
	var boundOriginalElementDomDataKey = '__ko_boundOriginalElement';
	ko.bindingHandlers.tagname = {
		_createTag: function( element, tagname ){
			var $element;						
			$(element).replaceWith(function(i,html) {
				var contents = $(this).contents();
				return $element = $('<' + tagname + ' />').append( contents );
			});	

			$.each( $.makeArray( element.attributes ), function(i, attrib) {
				$element.attr(attrib.name, attrib.value);
			});

			ko.utils.domData.set($element[0], boundOriginalElementDomDataKey , ko.utils.domData.get(element, boundOriginalElementDomDataKey) );
			ko.removeNode( element );
			return $element[0];
		},

		_dispose: function( element ){
			ko.utils.domData.get( element, 'tagname.subscription' ).dispose();
		},

		_createLogic: function( element, valueAccessor, bindingContext ){
			var self = this
				, comp
				, subscription
				, originalTagname = element.tagName.toLowerCase()
				, trigger = ko.observable(false);

			var comp = ko.computed( function(){
				ko.unwrap( trigger );
				return ko.unwrap( valueAccessor() );
			}, this, { disposeWhenNodeIsRemoved: element } );

			subscription = comp.subscribe( function( tagname ){
				var newElement
				if( originalTagname !== tagname ){
					//console.debug('_createTag');
					newElement = self._createTag( element, tagname );
					ko.applyBindingsToNode( newElement, null, bindingContext );
				}
			}, this );

			ko.utils.domData.set( element, 'tagname.subscription', subscription );

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
				self._dispose( element );
			});	

			trigger( true );


		},

		init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
			var self = ko.bindingHandlers.tagname
				, shouldAllowBindings = ko.utils.unwrapObservable(valueAccessor())
				, tagname = ko.unwrap( valueAccessor() )
				, changingTag = false
				, comp;

			self._createLogic( element, valueAccessor, bindingContext );

			if( !ko.utils.domData.get(element, boundOriginalElementDomDataKey) ){
				ko.utils.domData.set(element, boundOriginalElementDomDataKey , true);
				ko.applyBindingsToDescendants(bindingContext, element);								
			}

			return { controlsDescendantBindings: true };
		}
	};
})();


/* /js/libs/knockout.extensions.optionscolor.js
 * compresion time: 0.02193 -(ms)
 * -------------------------------------------- */
;(function(ko){
	var bindingName = 'optionsTypeColor';
	
	ko.bindingHandlers[ bindingName ] = {

		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, bindingId = Math.random();
			////////////////////////////////////////////////////////////////////////

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			});

			////////////////////////////////////////////////////////////////////////

			return { 'controlsDescendantBindings': true };
		},
		
		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, value = ko.unwrap( valueAccessor() )
				, options = $.extend({
				}, ko.unwrap( allBindings()[bindingName + 'Options']) )

				, optionsText		= allBindings()['optionsText']
				, optionsValue		= allBindings()['optionsValue']
				, optionsColor		= allBindings()['optionsColor']
				, selectedValue 	= allBindings()['value']
				, enable		= allBindings()['enable']
				, disable 		= allBindings()['disable'];
			enable = enable !== false && !disable;

			var $ul
				, ulClass = ['inline', 'options-color'];

			if( !enable ){
				ulClass.push('dimmed-little');
			}

			$(element).empty();
			$ul = $('<ul>')
				.addClass( ulClass.join(" "));

			$(element).append( $ul );


			function transformValue( value, property ){
				var value = ko.unwrap( value )
					, transformed = value;

				if( property && value ){
					switch( typeof property ){
						case 'string':
							transformed = value[ property ];
							break;

						case 'function':
							transformed = value( property );
					}
				}
				return ko.unwrap( transformed );
			}


			$.each( value, function( index, value ){
				var liClass = ['label-info']
					, transformedValue
					, transformedColor
					, transformedText
					, thisIsSelected
					, $li
					, liBackgroundColor
					, liOutlineColor
					, $a
					, aBackgroundColor
					, aBorderColor
					, aColor
					, $text
					, color;
				transformedValue = transformValue( value, optionsValue );
				transformedColor = transformValue( value, optionsColor );
				transformedText = transformValue( value, optionsText );


				if( typeof transformedText != 'string' ){
					transformedText = '';
				}

				color = transformedColor || '';

				thisIsSelected = ko.unwrap( selectedValue ) == transformedValue;

				if( thisIsSelected ){
					liClass.push('active');
				}

				liBackgroundColor	= $.xcolor.distance( color , '#fff') > 60 ? color : '#999';
				liOutlineColor 		= $.xcolor.distance( color , '#fff') > 60 ? '#fff' : '#000';

				$li = $('<li>')
					.addClass( liClass.join(' ') )
					.css( { backgroundColor: liBackgroundColor, outlineColor: liOutlineColor } )
					.attr( 'title', transformedText )
					.attr('data-value', transformedValue);
				aBackgroundColor	= color;
				aBorderColor		= thisIsSelected ? $.xcolor.distance( color, '#fff') > 60 ? '#fff' : '#000' : 'transparent';
				aColor				= $.xcolor.distance( color, '#fff') > 60 ? '#fff' : '#000';

				$a = $('<a>')
					.css({
						backgroundColor	: aBackgroundColor,
						borderColor		: aBorderColor,
						color			: aColor
					});

				if($.string.startsWith( color, 'image/gif;')){
					$a.css({
						backgroundImage: 'url(data:' + color + ')'
					});
				}



				if( enable ){
					$a
						.on( 'click.' + bindingName, function( event ){
							event.preventDefault();
							if( ko.isWriteableObservable( selectedValue ) ){
								selectedValue( transformedValue );
							}
						})
						.attr( 'href', '#' );
				}

				$text = $('<span>')
					.addClass('text');

				if( thisIsSelected ){
					$text.append('<i class="fa fa-check"></i>');
				}

				///////////////////////

				$li.append( $a );
				$a.append(
					$( '<span></span>' )
						.append( $text )
				);
				$ul.append($li);
				//////////////////////////

				var innerBindingContext = bindingContext.extend(valueAccessor);
				innerBindingContext.$data = value;
				//console.debug(innerBindingContext);
				ko.applyBindingsToDescendants(innerBindingContext, $li[0]);

			});

		}
	};
})(ko);




(function (ko) {
	var bindingName = 'optionsTypeLabel';

	function transformValue( value, property ){
		var value = ko.unwrap( value )
			, transformed = value;

		if( property && value ){
			switch( typeof property ){
				case 'string':
					transformed = value[ property ];
					break;

				case 'function':
					transformed = value( property );
			}
		}
		return ko.unwrap( transformed );
	}


	ko.bindingHandlers[ bindingName ] = {

		init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, bindingId = Math.random();
			////////////////////////////////////////////////////////////////////////

			ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
			});

			////////////////////////////////////////////////////////////////////////

			return { 'controlsDescendantBindings': true };
		},

		update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
			var self = ko.bindingHandlers[ bindingName ]
				, value = ko.unwrap( valueAccessor() )
				, options = $.extend({
				}, ko.unwrap( allBindings()[bindingName + 'Options']) )

				, optionsText		= allBindings()['optionsText']
				, optionsValue		= allBindings()['optionsValue']
				, optionsColor		= allBindings()['optionsColor']
				, selectedValue 	= allBindings()['value']
				, enable			= allBindings()['enable']
				, disable = allBindings()['disable'];
			enable = enable !== false && !disable;

			var $ul
				, ulClass = ['inline options-label'];

			if( !enable ){
				ulClass.push('dimmed-little');
			}

			$(element).empty();
			$ul = $('<ul>')
				.addClass( ulClass.join(" "));

			$(element).append( $ul );





			$.each( value, function( index, value ){
				var aClass = []
					, liClass = []
					, transformedValue
					, transformedColor
					, transformedText
					, thisIsSelected
					, $li
					, $a
					, $text
					, color;
				transformedValue = transformValue( value, optionsValue );
				transformedColor = transformValue( value, optionsColor );
				transformedText = transformValue( value, optionsText );


				if( typeof transformedText != 'string' ){
					transformedText = '';
				}

				color = transformedColor || '';

				thisIsSelected = ko.unwrap( selectedValue ) == transformedValue;

				if( thisIsSelected ){
					liClass.push('active');
					//aClass.push('label-info');
				} else {
					//aClass.push('label-default');
				}

				$li = $('<li>')
					.attr( 'title', transformedText )
					.addClass(liClass.join(" "));


				$a = $('<a>')
					.addClass(aClass.join(" "))
					.css({
					});

				if($.string.startsWith( color, 'image/gif;')){
					$a.css({
						backgroundImage: 'url(data:' + color + ')'
					});
				}



				if( enable ){
					$a
						.on( 'click.' + bindingName, function( event ){
							event.preventDefault();
							if( ko.isWriteableObservable( selectedValue ) ){
								selectedValue( transformedValue );
							}
						})
						.attr( 'href', '#' );
				}

				var $icon = $('<i class="fa fa-fw"></i>').addClass( thisIsSelected ? 'fa-check' : '');
				$text = $('<span>')
					.addClass('text')
					/*.append( $icon )*/
					.append( transformedText );

				/*
				if( thisIsSelected ){
					$text.append('<i class="fa fa-check"></i>');
				}*/

				///////////////////////

				$li.append( $a );
				$a.append(
					$( '<span></span>' )
						.append( $text )
				);
				$ul.append($li);
				//////////////////////////

				var innerBindingContext = bindingContext.extend(valueAccessor);
				innerBindingContext.$data = value;
				//console.debug(innerBindingContext);
				ko.applyBindingsToDescendants(innerBindingContext, $li[0]);

			});

		}
	};
})(ko);


/* /js/libs/knockout.extensions.byoutube.js
 * compresion time: 0.02193 -(ms)
 * ---------------------------------------- */
;(function(ko){

        ko.bindingHandlers.byoutube = {
		window      : ko.observableWindow({steps: {phone:767, tablet: 979, desktop: 9999}}),
		createIframe: function(element, byoutubeOptions){
			var self = ko.bindingHandlers.byoutube;
			var alreadyPlayed = false;

			var suportHtml5 = 0;
                        
                        if( document.createElement( 'video' ).canPlayType ){
				var suportHtml5 = 1;
			}
                        if( 'videoId' in byoutubeOptions ){
                            var autoplay=ko.unwrap(byoutubeOptions.paused)?0:1;

                            var mute = 1;
                            var videoId = ko.unwrap(byoutubeOptions.videoId);
                            var src = "https://www.youtube.com/embed/"+videoId+"?playlist="+videoId+"&loop=1&html5="+suportHtml5+"&version=3&mute="+mute+"&controls=0&showinfo=0&rel=0&autoplay="+autoplay+"&modestbranding=1&autohide=0";

                            $('.byoutube-iframe', element).attr("src",src);
			}
		},
                
		createPlayer: function(element){

			$(element).addClass('byoutube');

			var $wrapper = $('<div/>',{
				class: 'byoutube-wrapper'
			}).appendTo(element);

			$('<iframe/>',{
				class: 'byoutube-iframe',
                                frameborder:0,
                                allowfullscreen:true,
                                allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
			}).appendTo($wrapper);

			$('<div/>',{
				class: 'byoutube-overlay'
			}).appendTo($wrapper);
		},

		createThumbnail: function(element, byoutubeOptions){
			var id = ko.unwrap(byoutubeOptions.videoId)
				, $thumb = $(element).find('.byoutube-thumb')
				, $wrapper = $(element).find('.byoutube-wrapper');



			if( $thumb.length == 0 ){
				$thumb = $('<div>')
					.addClass('byoutube-thumb')
					.css({
						position	: 'absolute',
						top			: '0',
						left		: '0',
						right		: '0',
						bottom		: '0'
					})
				$wrapper.prepend( $thumb );
			}

			$thumb.css({
				backgroundPosition  : '50% 50%',
				backgroundSize      : 'cover'
			});

			////////////////////////////////////////////////////////////////
			var url = 'https://i.ytimg.com/vi/' + id + '/maxresdefault.jpg';
			var $img = $('<img>')
				.css({
					position	: 'absolute',
					top			: '-9999px',
					left		: '-9999px'
				})
			$('body').append($img);
			$img.attr('src', url )
				.one('load', function(){
					if($img.width() != 120 ){
						$thumb.backgroundImage(url);
					} else {
						url = 'https://i.ytimg.com/vi/' + id + '/hqdefault.jpg';
						$thumb.backgroundImage(url);
					}
					$img.remove();
				})
				.one('error', function(){
					console.debug('error');
					url = 'https://i.ytimg.com/vi/' + id + '/hqdefault.jpg';
					$thumb.backgroundImage(url);
					$img.remove();
				})

		},

		optimizeDisplay: function(element){
			var $iframe = $(element).find('.byoutube-iframe');
			var $wrapper = $(element).find('.byoutube-wrapper');
			var iframeContainer = {
				width   : $wrapper.outerWidth(),
				height  : $wrapper.outerHeight()
			};
			var margin = 24;
			var overprint = 100;
			var iframeProperties = {};

			iframeProperties.width = iframeContainer.width + ( ( iframeContainer.width * margin ) / 100 );
			//iframeProperties.height = Math.ceil( ( 3 * iframeContainer.width ) / 4 );
			iframeProperties.height = Math.ceil( ( 9 * iframeContainer.width ) / 16 );
			iframeProperties.marginTop = -( ( iframeProperties.height - iframeContainer.height ) / 2 );
			iframeProperties.marginLeft = -( ( iframeContainer.width * ( margin / 2 ) ) / 100 );
			if( iframeProperties.height < iframeContainer.height ) {
				iframeProperties.height = iframeContainer.height + ( ( iframeContainer.height * margin ) / 100 );
				//iframeProperties.width = Math.floor( ( 4 * iframeContainer.height ) / 3 );
				iframeProperties.width = Math.floor( ( 16 * iframeContainer.height ) / 9 );
				iframeProperties.marginTop = -( ( iframeContainer.height * ( margin / 2 ) ) / 100 );
				iframeProperties.marginLeft = -( ( iframeProperties.width - iframeContainer.width ) / 2 );
			}
			iframeProperties.width += overprint;
			iframeProperties.height += overprint;
			iframeProperties.marginTop -= overprint / 2;
			iframeProperties.marginLeft -= overprint / 2;

			$iframe.css({
				width: iframeProperties.width,
				height: iframeProperties.height,
				marginTop: iframeProperties.marginTop,
				marginLeft: iframeProperties.marginLeft
			});

		},
                                
                detectMobile:function()
                {
                        testExp = new RegExp('Android|webOS|iPhone|iPad|' +
                             'BlackBerry|Windows Phone|'  +
                             'Opera Mini|IEMobile|Mobile' , 
                            'i');

                        return testExp.test(navigator.userAgent);
                },
		init: function(element, valueAccessor, allBindingsAccessor, context) {
			var self = ko.bindingHandlers.byoutube;
                        var byoutubeOptions = allBindingsAccessor().byoutubeOptions;
			var allBinding = ko.utils.unwrapObservable(allBindingsAccessor())
				, resizeEventName = 'resize.byoutube-' + ko.utils.createUID()
				, beenDestroyed = false
				, options = $.extend({}, allBinding.byoutubeOptions );

			//PLAYER CONTAINER
			self.createPlayer(element);

			//THUMBNAIL O IFRAME
			self.createThumbnail(element, allBinding.byoutubeOptions);
                        
                        if( self.window.visiblePhone() || self.window.visibleTablet() || window.G_esCuttyCapt || self.detectMobile()){
                            //self.createThumbnail(element, allBinding.byoutubeOptions);
			} else {
                            
                                self.createIframe(element, allBinding.byoutubeOptions);
                                $(element).find('.byoutube-wrapper').resize(function() {
                                    self.createIframe(element, allBinding.byoutubeOptions);
                                    self.optimizeDisplay(element);
                                });
                                /*
                                $(window).on(resizeEventName, function() {
                                        self.createIframe(element, byoutubeOptions);
                                        self.optimizeDisplay(element);
                                });*/                            
                        }
		},

		update: function(element, valueAccessor, allBindingsAccessor, context) {
                        var self = ko.bindingHandlers.byoutube;
			var byoutubeOptions = allBindingsAccessor().byoutubeOptions
				, videoId = ko.unwrap(byoutubeOptions.videoId);
				
			//OPACITY
			if( 'opacity' in byoutubeOptions ){
				var opacity = ko.unwrap(byoutubeOptions.opacity);
				var oldOpacity = $(element).css('opacity');
				if( opacity != oldOpacity ) $(element).css({ opacity: opacity });
			}
                        
                        if( self.window.visiblePhone() || self.window.visibleTablet() || window.G_esCuttyCapt || self.detectMobile()){
                            //self.createThumbnail(element, allBinding.byoutubeOptions);
                        }else{
                            self.createIframe(element, byoutubeOptions);
                        }
		}
	};

})(ko);


/* /js/libs/knockout.extensions.calendario.js
 * compresion time: 0.02098 -(ms)
 * ------------------------------------------ */
;(function(ko){

    ko.bindingHandlers.calendario = {

        init: function(element, valueAccessor, allBindingsAccessor, context)
        {
            //element->dom object, se trabaja con jquery -> $(element)
            //context-> model que contiene al elemento
            var value = ko.unwrap(valueAccessor); //puede recibir cualquier tipo de objeto, sea viewmodel o no.
            var self = ko.bindingHandlers.calendario; // para metodos de clase
            var allBinding = ko.utils.unwrapObservable(allBindingsAccessor());
            var config = allBinding.calendarioConfig && $.extend( {}, allBinding.calendarioConfig);
            
            var idioma = model.data.market.localizacion.locale().split('_')[0];
            
            if(!config)
            {
                config = {
                        enableTime : false,
                        dateFormat : "d/m/Y"
                }
            }
            
            $(element).flatpickr( config );
            
            model.data.market.localizacion.locale.subscribe(function(){
                
                var idioma = model.data.market.localizacion.locale().split('_')[0];
                
                config.locale = idioma;
                
                $(element).flatpickr( config );
            });
            
            
            //este metodo se ejecuta al principo solamente
        },
        update: function(element, valueAccessor, allBindingsAccessor, context)
        {
            
        }
    };

})(ko);


/* /js/libs/moment.min.js
 * compresion time: 0.02789 -(ms)
 * ---------------------- */
//! moment.js
//! version : 2.10.3
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.moment=b()}(this,function(){"use strict";function a(){return Dc.apply(null,arguments)}function b(a){Dc=a}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function e(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function f(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function g(a,b){for(var c in b)f(b,c)&&(a[c]=b[c]);return f(b,"toString")&&(a.toString=b.toString),f(b,"valueOf")&&(a.valueOf=b.valueOf),a}function h(a,b,c,d){return za(a,b,c,d,!0).utc()}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function j(a){return null==a._pf&&(a._pf=i()),a._pf}function k(a){if(null==a._isValid){var b=j(a);a._isValid=!isNaN(a._d.getTime())&&b.overflow<0&&!b.empty&&!b.invalidMonth&&!b.nullInput&&!b.invalidFormat&&!b.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour)}return a._isValid}function l(a){var b=h(0/0);return null!=a?g(j(b),a):j(b).userInvalidated=!0,b}function m(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=j(b)),"undefined"!=typeof b._locale&&(a._locale=b._locale),Fc.length>0)for(c in Fc)d=Fc[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function n(b){m(this,b),this._d=new Date(+b._d),Gc===!1&&(Gc=!0,a.updateOffset(this),Gc=!1)}function o(a){return a instanceof n||null!=a&&null!=a._isAMomentObject}function p(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function q(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&p(a[d])!==p(b[d]))&&g++;return g+f}function r(){}function s(a){return a?a.toLowerCase().replace("_","-"):a}function t(a){for(var b,c,d,e,f=0;f<a.length;){for(e=s(a[f]).split("-"),b=e.length,c=s(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=u(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&q(e,c,!0)>=b-1)break;b--}f++}return null}function u(a){var b=null;if(!Hc[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Ec._abbr,require("./locale/"+a),v(b)}catch(c){}return Hc[a]}function v(a,b){var c;return a&&(c="undefined"==typeof b?x(a):w(a,b),c&&(Ec=c)),Ec._abbr}function w(a,b){return null!==b?(b.abbr=a,Hc[a]||(Hc[a]=new r),Hc[a].set(b),v(a),Hc[a]):(delete Hc[a],null)}function x(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Ec;if(!c(a)){if(b=u(a))return b;a=[a]}return t(a)}function y(a,b){var c=a.toLowerCase();Ic[c]=Ic[c+"s"]=Ic[b]=a}function z(a){return"string"==typeof a?Ic[a]||Ic[a.toLowerCase()]:void 0}function A(a){var b,c,d={};for(c in a)f(a,c)&&(b=z(c),b&&(d[b]=a[c]));return d}function B(b,c){return function(d){return null!=d?(D(this,b,d),a.updateOffset(this,c),this):C(this,b)}}function C(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function D(a,b,c){return a._d["set"+(a._isUTC?"UTC":"")+b](c)}function E(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=z(a),"function"==typeof this[a])return this[a](b);return this}function F(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function G(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Mc[a]=e),b&&(Mc[b[0]]=function(){return F(e.apply(this,arguments),b[1],b[2])}),c&&(Mc[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function H(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function I(a){var b,c,d=a.match(Jc);for(b=0,c=d.length;c>b;b++)Mc[d[b]]?d[b]=Mc[d[b]]:d[b]=H(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function J(a,b){return a.isValid()?(b=K(b,a.localeData()),Lc[b]||(Lc[b]=I(b)),Lc[b](a)):a.localeData().invalidDate()}function K(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Kc.lastIndex=0;d>=0&&Kc.test(a);)a=a.replace(Kc,c),Kc.lastIndex=0,d-=1;return a}function L(a,b,c){_c[a]="function"==typeof b?b:function(a){return a&&c?c:b}}function M(a,b){return f(_c,a)?_c[a](b._strict,b._locale):new RegExp(N(a))}function N(a){return a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function O(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=p(a)}),c=0;c<a.length;c++)ad[a[c]]=d}function P(a,b){O(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function Q(a,b,c){null!=b&&f(ad,a)&&ad[a](b,c._a,c,a)}function R(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function S(a){return this._months[a.month()]}function T(a){return this._monthsShort[a.month()]}function U(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=h([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function V(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),R(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function W(b){return null!=b?(V(this,b),a.updateOffset(this,!0),this):C(this,"Month")}function X(){return R(this.year(),this.month())}function Y(a){var b,c=a._a;return c&&-2===j(a).overflow&&(b=c[cd]<0||c[cd]>11?cd:c[dd]<1||c[dd]>R(c[bd],c[cd])?dd:c[ed]<0||c[ed]>24||24===c[ed]&&(0!==c[fd]||0!==c[gd]||0!==c[hd])?ed:c[fd]<0||c[fd]>59?fd:c[gd]<0||c[gd]>59?gd:c[hd]<0||c[hd]>999?hd:-1,j(a)._overflowDayOfYear&&(bd>b||b>dd)&&(b=dd),j(a).overflow=b),a}function Z(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function $(a,b){var c=!0,d=a+"\n"+(new Error).stack;return g(function(){return c&&(Z(d),c=!1),b.apply(this,arguments)},b)}function _(a,b){kd[a]||(Z(b),kd[a]=!0)}function aa(a){var b,c,d=a._i,e=ld.exec(d);if(e){for(j(a).iso=!0,b=0,c=md.length;c>b;b++)if(md[b][1].exec(d)){a._f=md[b][0]+(e[6]||" ");break}for(b=0,c=nd.length;c>b;b++)if(nd[b][1].exec(d)){a._f+=nd[b][0];break}d.match(Yc)&&(a._f+="Z"),ta(a)}else a._isValid=!1}function ba(b){var c=od.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(aa(b),void(b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b))))}function ca(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function da(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function ea(a){return fa(a)?366:365}function fa(a){return a%4===0&&a%100!==0||a%400===0}function ga(){return fa(this.year())}function ha(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=Aa(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function ia(a){return ha(a,this._week.dow,this._week.doy).week}function ja(){return this._week.dow}function ka(){return this._week.doy}function la(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function ma(a){var b=ha(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function na(a,b,c,d,e){var f,g,h=da(a,0,1).getUTCDay();return h=0===h?7:h,c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:ea(a-1)+g}}function oa(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function pa(a,b,c){return null!=a?a:null!=b?b:c}function qa(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function ra(a){var b,c,d,e,f=[];if(!a._d){for(d=qa(a),a._w&&null==a._a[dd]&&null==a._a[cd]&&sa(a),a._dayOfYear&&(e=pa(a._a[bd],d[bd]),a._dayOfYear>ea(e)&&(j(a)._overflowDayOfYear=!0),c=da(e,0,a._dayOfYear),a._a[cd]=c.getUTCMonth(),a._a[dd]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;7>b;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[ed]&&0===a._a[fd]&&0===a._a[gd]&&0===a._a[hd]&&(a._nextDay=!0,a._a[ed]=0),a._d=(a._useUTC?da:ca).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[ed]=24)}}function sa(a){var b,c,d,e,f,g,h;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=pa(b.GG,a._a[bd],ha(Aa(),1,4).year),d=pa(b.W,1),e=pa(b.E,1)):(f=a._locale._week.dow,g=a._locale._week.doy,c=pa(b.gg,a._a[bd],ha(Aa(),f,g).year),d=pa(b.w,1),null!=b.d?(e=b.d,f>e&&++d):e=null!=b.e?b.e+f:f),h=na(c,d,e,g,f),a._a[bd]=h.year,a._dayOfYear=h.dayOfYear}function ta(b){if(b._f===a.ISO_8601)return void aa(b);b._a=[],j(b).empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,k=0;for(e=K(b._f,b._locale).match(Jc)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(M(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&j(b).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),k+=d.length),Mc[f]?(d?j(b).empty=!1:j(b).unusedTokens.push(f),Q(f,d,b)):b._strict&&!d&&j(b).unusedTokens.push(f);j(b).charsLeftOver=i-k,h.length>0&&j(b).unusedInput.push(h),j(b).bigHour===!0&&b._a[ed]<=12&&b._a[ed]>0&&(j(b).bigHour=void 0),b._a[ed]=ua(b._locale,b._a[ed],b._meridiem),ra(b),Y(b)}function ua(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function va(a){var b,c,d,e,f;if(0===a._f.length)return j(a).invalidFormat=!0,void(a._d=new Date(0/0));for(e=0;e<a._f.length;e++)f=0,b=m({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],ta(b),k(b)&&(f+=j(b).charsLeftOver,f+=10*j(b).unusedTokens.length,j(b).score=f,(null==d||d>f)&&(d=f,c=b));g(a,c||b)}function wa(a){if(!a._d){var b=A(a._i);a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],ra(a)}}function xa(a){var b,e=a._i,f=a._f;return a._locale=a._locale||x(a._l),null===e||void 0===f&&""===e?l({nullInput:!0}):("string"==typeof e&&(a._i=e=a._locale.preparse(e)),o(e)?new n(Y(e)):(c(f)?va(a):f?ta(a):d(e)?a._d=e:ya(a),b=new n(Y(a)),b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b))}function ya(b){var f=b._i;void 0===f?b._d=new Date:d(f)?b._d=new Date(+f):"string"==typeof f?ba(b):c(f)?(b._a=e(f.slice(0),function(a){return parseInt(a,10)}),ra(b)):"object"==typeof f?wa(b):"number"==typeof f?b._d=new Date(f):a.createFromInputFallback(b)}function za(a,b,c,d,e){var f={};return"boolean"==typeof c&&(d=c,c=void 0),f._isAMomentObject=!0,f._useUTC=f._isUTC=e,f._l=c,f._i=a,f._f=b,f._strict=d,xa(f)}function Aa(a,b,c,d){return za(a,b,c,d,!1)}function Ba(a,b){var d,e;if(1===b.length&&c(b[0])&&(b=b[0]),!b.length)return Aa();for(d=b[0],e=1;e<b.length;++e)b[e][a](d)&&(d=b[e]);return d}function Ca(){var a=[].slice.call(arguments,0);return Ba("isBefore",a)}function Da(){var a=[].slice.call(arguments,0);return Ba("isAfter",a)}function Ea(a){var b=A(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=x(),this._bubble()}function Fa(a){return a instanceof Ea}function Ga(a,b){G(a,0,0,function(){var a=this.utcOffset(),c="+";return 0>a&&(a=-a,c="-"),c+F(~~(a/60),2)+b+F(~~a%60,2)})}function Ha(a){var b=(a||"").match(Yc)||[],c=b[b.length-1]||[],d=(c+"").match(td)||["-",0,0],e=+(60*d[1])+p(d[2]);return"+"===d[0]?e:-e}function Ia(b,c){var e,f;return c._isUTC?(e=c.clone(),f=(o(b)||d(b)?+b:+Aa(b))-+e,e._d.setTime(+e._d+f),a.updateOffset(e,!1),e):Aa(b).local();return c._isUTC?Aa(b).zone(c._offset||0):Aa(b).local()}function Ja(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Ka(b,c){var d,e=this._offset||0;return null!=b?("string"==typeof b&&(b=Ha(b)),Math.abs(b)<16&&(b=60*b),!this._isUTC&&c&&(d=Ja(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?$a(this,Va(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Ja(this)}function La(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Ma(a){return this.utcOffset(0,a)}function Na(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Ja(this),"m")),this}function Oa(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Ha(this._i)),this}function Pa(a){return a=a?Aa(a).utcOffset():0,(this.utcOffset()-a)%60===0}function Qa(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Ra(){if(this._a){var a=this._isUTC?h(this._a):Aa(this._a);return this.isValid()&&q(this._a,a.toArray())>0}return!1}function Sa(){return!this._isUTC}function Ta(){return this._isUTC}function Ua(){return this._isUTC&&0===this._offset}function Va(a,b){var c,d,e,g=a,h=null;return Fa(a)?g={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(g={},b?g[b]=a:g.milliseconds=a):(h=ud.exec(a))?(c="-"===h[1]?-1:1,g={y:0,d:p(h[dd])*c,h:p(h[ed])*c,m:p(h[fd])*c,s:p(h[gd])*c,ms:p(h[hd])*c}):(h=vd.exec(a))?(c="-"===h[1]?-1:1,g={y:Wa(h[2],c),M:Wa(h[3],c),d:Wa(h[4],c),h:Wa(h[5],c),m:Wa(h[6],c),s:Wa(h[7],c),w:Wa(h[8],c)}):null==g?g={}:"object"==typeof g&&("from"in g||"to"in g)&&(e=Ya(Aa(g.from),Aa(g.to)),g={},g.ms=e.milliseconds,g.M=e.months),d=new Ea(g),Fa(a)&&f(a,"_locale")&&(d._locale=a._locale),d}function Wa(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function Xa(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function Ya(a,b){var c;return b=Ia(b,a),a.isBefore(b)?c=Xa(a,b):(c=Xa(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function Za(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(_(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Va(c,d),$a(this,e,a),this}}function $a(b,c,d,e){var f=c._milliseconds,g=c._days,h=c._months;e=null==e?!0:e,f&&b._d.setTime(+b._d+f*d),g&&D(b,"Date",C(b,"Date")+g*d),h&&V(b,C(b,"Month")+h*d),e&&a.updateOffset(b,g||h)}function _a(a){var b=a||Aa(),c=Ia(b,this).startOf("day"),d=this.diff(c,"days",!0),e=-6>d?"sameElse":-1>d?"lastWeek":0>d?"lastDay":1>d?"sameDay":2>d?"nextDay":7>d?"nextWeek":"sameElse";return this.format(this.localeData().calendar(e,this,Aa(b)))}function ab(){return new n(this)}function bb(a,b){var c;return b=z("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Aa(a),+this>+a):(c=o(a)?+a:+Aa(a),c<+this.clone().startOf(b))}function cb(a,b){var c;return b=z("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Aa(a),+a>+this):(c=o(a)?+a:+Aa(a),+this.clone().endOf(b)<c)}function db(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function eb(a,b){var c;return b=z(b||"millisecond"),"millisecond"===b?(a=o(a)?a:Aa(a),+this===+a):(c=+Aa(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))}function fb(a){return 0>a?Math.ceil(a):Math.floor(a)}function gb(a,b,c){var d,e,f=Ia(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=z(b),"year"===b||"month"===b||"quarter"===b?(e=hb(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:fb(e)}function hb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function ib(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function jb(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():J(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):J(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function kb(b){var c=J(this,b||a.defaultFormat);return this.localeData().postformat(c)}function lb(a,b){return this.isValid()?Va({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function mb(a){return this.from(Aa(),a)}function nb(a,b){return this.isValid()?Va({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function ob(a){return this.to(Aa(),a)}function pb(a){var b;return void 0===a?this._locale._abbr:(b=x(a),null!=b&&(this._locale=b),this)}function qb(){return this._locale}function rb(a){switch(a=z(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function sb(a){return a=z(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function tb(){return+this._d-6e4*(this._offset||0)}function ub(){return Math.floor(+this/1e3)}function vb(){return this._offset?new Date(+this):this._d}function wb(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function xb(){return k(this)}function yb(){return g({},j(this))}function zb(){return j(this).overflow}function Ab(a,b){G(0,[a,a.length],0,b)}function Bb(a,b,c){return ha(Aa([a,11,31+b-c]),b,c).week}function Cb(a){var b=ha(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")}function Db(a){var b=ha(this,1,4).year;return null==a?b:this.add(a-b,"y")}function Eb(){return Bb(this.year(),1,4)}function Fb(){var a=this.localeData()._week;return Bb(this.year(),a.dow,a.doy)}function Gb(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Hb(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function Ib(a){return this._weekdays[a.day()]}function Jb(a){return this._weekdaysShort[a.day()]}function Kb(a){return this._weekdaysMin[a.day()]}function Lb(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=Aa([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b}function Mb(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Hb(a,this.localeData()),this.add(a-b,"d")):b}function Nb(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Ob(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)}function Pb(a,b){G(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Qb(a,b){return b._meridiemParse}function Rb(a){return"p"===(a+"").toLowerCase().charAt(0)}function Sb(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Tb(a){G(0,[a,3],0,"millisecond")}function Ub(){return this._isUTC?"UTC":""}function Vb(){return this._isUTC?"Coordinated Universal Time":""}function Wb(a){return Aa(1e3*a)}function Xb(){return Aa.apply(null,arguments).parseZone()}function Yb(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.call(b,c):d}function Zb(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b}function $b(){return this._invalidDate}function _b(a){return this._ordinal.replace("%d",a)}function ac(a){return a}function bc(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)}function cc(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)}function dc(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function ec(a,b,c,d){var e=x(),f=h().set(d,b);return e[c](f,a)}function fc(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return ec(a,b,c,e);var f,g=[];for(f=0;d>f;f++)g[f]=ec(a,f,c,e);return g}function gc(a,b){return fc(a,b,"months",12,"month")}function hc(a,b){return fc(a,b,"monthsShort",12,"month")}function ic(a,b){return fc(a,b,"weekdays",7,"day")}function jc(a,b){return fc(a,b,"weekdaysShort",7,"day")}function kc(a,b){return fc(a,b,"weekdaysMin",7,"day")}function lc(){var a=this._data;return this._milliseconds=Rd(this._milliseconds),this._days=Rd(this._days),this._months=Rd(this._months),a.milliseconds=Rd(a.milliseconds),a.seconds=Rd(a.seconds),a.minutes=Rd(a.minutes),a.hours=Rd(a.hours),a.months=Rd(a.months),a.years=Rd(a.years),this}function mc(a,b,c,d){var e=Va(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function nc(a,b){return mc(this,a,b,1)}function oc(a,b){return mc(this,a,b,-1)}function pc(){var a,b,c,d=this._milliseconds,e=this._days,f=this._months,g=this._data,h=0;return g.milliseconds=d%1e3,a=fb(d/1e3),g.seconds=a%60,b=fb(a/60),g.minutes=b%60,c=fb(b/60),g.hours=c%24,e+=fb(c/24),h=fb(qc(e)),e-=fb(rc(h)),f+=fb(e/30),e%=30,h+=fb(f/12),f%=12,g.days=e,g.months=f,g.years=h,this}function qc(a){return 400*a/146097}function rc(a){return 146097*a/400}function sc(a){var b,c,d=this._milliseconds;if(a=z(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+12*qc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(rc(this._months/12)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function tc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*p(this._months/12)}function uc(a){return function(){return this.as(a)}}function vc(a){return a=z(a),this[a+"s"]()}function wc(a){return function(){return this._data[a]}}function xc(){return fb(this.days()/7)}function yc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function zc(a,b,c){var d=Va(a).abs(),e=fe(d.as("s")),f=fe(d.as("m")),g=fe(d.as("h")),h=fe(d.as("d")),i=fe(d.as("M")),j=fe(d.as("y")),k=e<ge.s&&["s",e]||1===f&&["m"]||f<ge.m&&["mm",f]||1===g&&["h"]||g<ge.h&&["hh",g]||1===h&&["d"]||h<ge.d&&["dd",h]||1===i&&["M"]||i<ge.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,yc.apply(null,k)}function Ac(a,b){return void 0===ge[a]?!1:void 0===b?ge[a]:(ge[a]=b,!0)}function Bc(a){var b=this.localeData(),c=zc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function Cc(){var a=he(this.years()),b=he(this.months()),c=he(this.days()),d=he(this.hours()),e=he(this.minutes()),f=he(this.seconds()+this.milliseconds()/1e3),g=this.asSeconds();return g?(0>g?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}var Dc,Ec,Fc=a.momentProperties=[],Gc=!1,Hc={},Ic={},Jc=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Kc=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Lc={},Mc={},Nc=/\d/,Oc=/\d\d/,Pc=/\d{3}/,Qc=/\d{4}/,Rc=/[+-]?\d{6}/,Sc=/\d\d?/,Tc=/\d{1,3}/,Uc=/\d{1,4}/,Vc=/[+-]?\d{1,6}/,Wc=/\d+/,Xc=/[+-]?\d+/,Yc=/Z|[+-]\d\d:?\d\d/gi,Zc=/[+-]?\d+(\.\d{1,3})?/,$c=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,_c={},ad={},bd=0,cd=1,dd=2,ed=3,fd=4,gd=5,hd=6;G("M",["MM",2],"Mo",function(){return this.month()+1}),G("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),G("MMMM",0,0,function(a){return this.localeData().months(this,a)}),y("month","M"),L("M",Sc),L("MM",Sc,Oc),L("MMM",$c),L("MMMM",$c),O(["M","MM"],function(a,b){b[cd]=p(a)-1}),O(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[cd]=e:j(c).invalidMonth=a});var id="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),jd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),kd={};a.suppressDeprecationWarnings=!1;var ld=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,md=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],nd=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],od=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=$("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),G(0,["YY",2],0,function(){return this.year()%100}),G(0,["YYYY",4],0,"year"),G(0,["YYYYY",5],0,"year"),G(0,["YYYYYY",6,!0],0,"year"),y("year","y"),L("Y",Xc),L("YY",Sc,Oc),L("YYYY",Uc,Qc),L("YYYYY",Vc,Rc),L("YYYYYY",Vc,Rc),O(["YYYY","YYYYY","YYYYYY"],bd),O("YY",function(b,c){c[bd]=a.parseTwoDigitYear(b)}),a.parseTwoDigitYear=function(a){return p(a)+(p(a)>68?1900:2e3)};var pd=B("FullYear",!1);G("w",["ww",2],"wo","week"),G("W",["WW",2],"Wo","isoWeek"),y("week","w"),y("isoWeek","W"),L("w",Sc),L("ww",Sc,Oc),L("W",Sc),L("WW",Sc,Oc),P(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=p(a)});var qd={dow:0,doy:6};G("DDD",["DDDD",3],"DDDo","dayOfYear"),y("dayOfYear","DDD"),L("DDD",Tc),L("DDDD",Pc),O(["DDD","DDDD"],function(a,b,c){c._dayOfYear=p(a)}),a.ISO_8601=function(){};var rd=$("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=Aa.apply(null,arguments);return this>a?this:a}),sd=$("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=Aa.apply(null,arguments);return a>this?this:a});Ga("Z",":"),Ga("ZZ",""),L("Z",Yc),L("ZZ",Yc),O(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ha(a)});var td=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var ud=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,vd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Va.fn=Ea.prototype;var wd=Za(1,"add"),xd=Za(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var yd=$("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});G(0,["gg",2],0,function(){return this.weekYear()%100}),G(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Ab("gggg","weekYear"),Ab("ggggg","weekYear"),Ab("GGGG","isoWeekYear"),Ab("GGGGG","isoWeekYear"),y("weekYear","gg"),y("isoWeekYear","GG"),L("G",Xc),L("g",Xc),L("GG",Sc,Oc),L("gg",Sc,Oc),L("GGGG",Uc,Qc),L("gggg",Uc,Qc),L("GGGGG",Vc,Rc),L("ggggg",Vc,Rc),P(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=p(a)}),P(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),G("Q",0,0,"quarter"),y("quarter","Q"),L("Q",Nc),O("Q",function(a,b){b[cd]=3*(p(a)-1)}),G("D",["DD",2],"Do","date"),y("date","D"),L("D",Sc),L("DD",Sc,Oc),L("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),O(["D","DD"],dd),O("Do",function(a,b){b[dd]=p(a.match(Sc)[0],10)});var zd=B("Date",!0);G("d",0,"do","day"),G("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),G("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),G("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),G("e",0,0,"weekday"),G("E",0,0,"isoWeekday"),y("day","d"),y("weekday","e"),y("isoWeekday","E"),L("d",Sc),L("e",Sc),L("E",Sc),L("dd",$c),L("ddd",$c),L("dddd",$c),P(["dd","ddd","dddd"],function(a,b,c){var d=c._locale.weekdaysParse(a);null!=d?b.d=d:j(c).invalidWeekday=a}),P(["d","e","E"],function(a,b,c,d){b[d]=p(a)});var Ad="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Bd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Cd="Su_Mo_Tu_We_Th_Fr_Sa".split("_");G("H",["HH",2],0,"hour"),G("h",["hh",2],0,function(){return this.hours()%12||12}),Pb("a",!0),Pb("A",!1),y("hour","h"),L("a",Qb),L("A",Qb),L("H",Sc),L("h",Sc),L("HH",Sc,Oc),L("hh",Sc,Oc),O(["H","HH"],ed),O(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),O(["h","hh"],function(a,b,c){b[ed]=p(a),j(c).bigHour=!0});var Dd=/[ap]\.?m?\.?/i,Ed=B("Hours",!0);G("m",["mm",2],0,"minute"),y("minute","m"),L("m",Sc),L("mm",Sc,Oc),O(["m","mm"],fd);var Fd=B("Minutes",!1);G("s",["ss",2],0,"second"),y("second","s"),L("s",Sc),L("ss",Sc,Oc),O(["s","ss"],gd);var Gd=B("Seconds",!1);G("S",0,0,function(){return~~(this.millisecond()/100)}),G(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),Tb("SSS"),Tb("SSSS"),y("millisecond","ms"),L("S",Tc,Nc),L("SS",Tc,Oc),L("SSS",Tc,Pc),L("SSSS",Wc),O(["S","SS","SSS","SSSS"],function(a,b){b[hd]=p(1e3*("0."+a))});var Hd=B("Milliseconds",!1);G("z",0,0,"zoneAbbr"),G("zz",0,0,"zoneName");var Id=n.prototype;Id.add=wd,Id.calendar=_a,Id.clone=ab,Id.diff=gb,Id.endOf=sb,Id.format=kb,Id.from=lb,Id.fromNow=mb,Id.to=nb,Id.toNow=ob,Id.get=E,Id.invalidAt=zb,Id.isAfter=bb,Id.isBefore=cb,Id.isBetween=db,Id.isSame=eb,Id.isValid=xb,Id.lang=yd,Id.locale=pb,Id.localeData=qb,Id.max=sd,Id.min=rd,Id.parsingFlags=yb,Id.set=E,Id.startOf=rb,Id.subtract=xd,Id.toArray=wb,Id.toDate=vb,Id.toISOString=jb,Id.toJSON=jb,Id.toString=ib,Id.unix=ub,Id.valueOf=tb,Id.year=pd,Id.isLeapYear=ga,Id.weekYear=Cb,Id.isoWeekYear=Db,Id.quarter=Id.quarters=Gb,Id.month=W,Id.daysInMonth=X,Id.week=Id.weeks=la,Id.isoWeek=Id.isoWeeks=ma,Id.weeksInYear=Fb,Id.isoWeeksInYear=Eb,Id.date=zd,Id.day=Id.days=Mb,Id.weekday=Nb,Id.isoWeekday=Ob,Id.dayOfYear=oa,Id.hour=Id.hours=Ed,Id.minute=Id.minutes=Fd,Id.second=Id.seconds=Gd,Id.millisecond=Id.milliseconds=Hd,Id.utcOffset=Ka,Id.utc=Ma,Id.local=Na,Id.parseZone=Oa,Id.hasAlignedHourOffset=Pa,Id.isDST=Qa,Id.isDSTShifted=Ra,Id.isLocal=Sa,Id.isUtcOffset=Ta,Id.isUtc=Ua,Id.isUTC=Ua,Id.zoneAbbr=Ub,Id.zoneName=Vb,Id.dates=$("dates accessor is deprecated. Use date instead.",zd),Id.months=$("months accessor is deprecated. Use month instead",W),Id.years=$("years accessor is deprecated. Use year instead",pd),Id.zone=$("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",La);var Jd=Id,Kd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Ld={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},Md="Invalid date",Nd="%d",Od=/\d{1,2}/,Pd={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",
hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Qd=r.prototype;Qd._calendar=Kd,Qd.calendar=Yb,Qd._longDateFormat=Ld,Qd.longDateFormat=Zb,Qd._invalidDate=Md,Qd.invalidDate=$b,Qd._ordinal=Nd,Qd.ordinal=_b,Qd._ordinalParse=Od,Qd.preparse=ac,Qd.postformat=ac,Qd._relativeTime=Pd,Qd.relativeTime=bc,Qd.pastFuture=cc,Qd.set=dc,Qd.months=S,Qd._months=id,Qd.monthsShort=T,Qd._monthsShort=jd,Qd.monthsParse=U,Qd.week=ia,Qd._week=qd,Qd.firstDayOfYear=ka,Qd.firstDayOfWeek=ja,Qd.weekdays=Ib,Qd._weekdays=Ad,Qd.weekdaysMin=Kb,Qd._weekdaysMin=Cd,Qd.weekdaysShort=Jb,Qd._weekdaysShort=Bd,Qd.weekdaysParse=Lb,Qd.isPM=Rb,Qd._meridiemParse=Dd,Qd.meridiem=Sb,v("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===p(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=$("moment.lang is deprecated. Use moment.locale instead.",v),a.langData=$("moment.langData is deprecated. Use moment.localeData instead.",x);var Rd=Math.abs,Sd=uc("ms"),Td=uc("s"),Ud=uc("m"),Vd=uc("h"),Wd=uc("d"),Xd=uc("w"),Yd=uc("M"),Zd=uc("y"),$d=wc("milliseconds"),_d=wc("seconds"),ae=wc("minutes"),be=wc("hours"),ce=wc("days"),de=wc("months"),ee=wc("years"),fe=Math.round,ge={s:45,m:45,h:22,d:26,M:11},he=Math.abs,ie=Ea.prototype;ie.abs=lc,ie.add=nc,ie.subtract=oc,ie.as=sc,ie.asMilliseconds=Sd,ie.asSeconds=Td,ie.asMinutes=Ud,ie.asHours=Vd,ie.asDays=Wd,ie.asWeeks=Xd,ie.asMonths=Yd,ie.asYears=Zd,ie.valueOf=tc,ie._bubble=pc,ie.get=vc,ie.milliseconds=$d,ie.seconds=_d,ie.minutes=ae,ie.hours=be,ie.days=ce,ie.weeks=xc,ie.months=de,ie.years=ee,ie.humanize=Bc,ie.toISOString=Cc,ie.toString=Cc,ie.toJSON=Cc,ie.locale=pb,ie.localeData=qb,ie.toIsoString=$("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Cc),ie.lang=yd,G("X",0,0,"unix"),G("x",0,0,"valueOf"),L("x",Xc),L("X",Zc),O("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),O("x",function(a,b,c){c._d=new Date(p(a))}),a.version="2.10.3",b(Aa),a.fn=Jd,a.min=Ca,a.max=Da,a.utc=h,a.unix=Wb,a.months=gc,a.isDate=d,a.locale=v,a.invalid=l,a.duration=Va,a.isMoment=o,a.weekdays=ic,a.parseZone=Xb,a.localeData=x,a.isDuration=Fa,a.monthsShort=hc,a.weekdaysMin=kc,a.defineLocale=w,a.weekdaysShort=jc,a.normalizeUnits=z,a.relativeTimeThreshold=Ac;var je=a;return je});


/* /js/libs/momentjs-locales.js
 * compresion time: 0.04196 -(ms)
 * ---------------------------- */
// moment.js locale configuration
// locale : spanish (es)
// author : Julio Napur : https://github.com/julionc
(function (factory) {
    factory(moment);
}(function (moment) {
    var monthsShortDot = 'ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.'.split('_'),
        monthsShort = 'ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic'.split('_');
    return moment.defineLocale('es', {
        months : 'enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre'.split('_'),
        monthsShort : function (m, format) {
            if (/-MMM-/.test(format)) {
                return monthsShort[m.month()];
            } else {
                return monthsShortDot[m.month()];
            }
        },
        weekdays : 'domingo_lunes_martes_mircoles_jueves_viernes_sbado'.split('_'),
        weekdaysShort : 'dom._lun._mar._mi._jue._vie._sb.'.split('_'),
        weekdaysMin : 'Do_Lu_Ma_Mi_Ju_Vi_S'.split('_'),
        longDateFormat : {
            LT : 'H:mm',
            LTS : 'LT:ss',
            L : 'DD/MM/YYYY',
            LL : 'D [de] MMMM [de] YYYY',
            LLL : 'D [de] MMMM [de] YYYY LT',
            LLLL : 'dddd, D [de] MMMM [de] YYYY LT'
        },
        calendar : {
            sameDay : function () {
                return '[hoy a la' + ((this.hours() !== 1) ? 's' : '') + '] LT';
            },
            nextDay : function () {
                return '[maana a la' + ((this.hours() !== 1) ? 's' : '') + '] LT';
            },
            nextWeek : function () {
                return 'dddd [a la' + ((this.hours() !== 1) ? 's' : '') + '] LT';
            },
            lastDay : function () {
                return '[ayer a la' + ((this.hours() !== 1) ? 's' : '') + '] LT';
            },
            lastWeek : function () {
                return '[el] dddd [pasado a la' + ((this.hours() !== 1) ? 's' : '') + '] LT';
            },
            sameElse : 'L'
        },
        relativeTime : {
            future : 'en %s',
            past : 'hace %s',
            s : 'unos segundos',
            m : 'un minuto',
            mm : '%d minutos',
            h : 'una hora',
            hh : '%d horas',
            d : 'un da',
            dd : '%d das',
            M : 'un mes',
            MM : '%d meses',
            y : 'un ao',
            yy : '%d aos'
        },
        ordinalParse : /\d{1,2}/,
        ordinal : '%d',
        week : {
            dow : 1, // Monday is the first day of the week.
            doy : 4  // The week that contains Jan 4th is the first week of the year.
        }
    });
}));


/* /js/helpers/helper_enlace.js
 * compresion time: 0.13709 -(ms)
 * ---------------------------- */
;(function(namespace){
	/**
	 * helper para crear enlaces
	 */

	namespace.Enlace = ko.ViewModel.createSubclass({
		'mappeable'	: {
			data		: ''
		},

		'defaults'	: {
		},

		'mapping'	: {
		}
	}, {
		TIPO_URL		: 'url',
		TIPO_PAGINA		: 'pagina',
		TIPO_PRODUCTO	: 'producto',
		TIPO_CATEGORIA	: 'categoria',
		TIPO_STREAM		: 'stream',
		TIPO_ANCLA		: 'ancla',

		tipoOptions		: [
			{ 'text'	: 'URL',		value: 'url'		},
			{ 'text'	: 'Una pgina de este sitio',		value: 'pagina'		},
			{ 'text'	: 'Un ancla en la pgina actual',		value: 'ancla'		},
			{ 'text'	: 'Radio online',		value: 'stream'		},
			{ 'text'	: 'Categora de productos',	value: 'categoria'	},
			{ 'text'	: 'Producto',	value: 'producto'	}

		],

		/* helper utils */

		toSeoUrl: function( url ) {

			url = url.replace(new RegExp(/[]/g),"a");
			url = url.replace(new RegExp(/[]/g),"e");
			url = url.replace(new RegExp(/[]/g),"i");
			url = url.replace(new RegExp(//g),"n");                
			url = url.replace(new RegExp(/[]/g),"o");
			url = url.replace(new RegExp(/[]/g),"u");
	
			var encodedUrl = url.toString().toLowerCase();        
			encodedUrl = encodedUrl.split(/\&+/).join("-and-")
			encodedUrl = encodedUrl.split(/[^a-z0-9]/).join("-");       
			encodedUrl = encodedUrl.split(/-+/).join("-");
			encodedUrl = encodedUrl.trim('-'); 
		  
			return encodedUrl; 
		},

		getURI : function () {
			
			if ( model.data.urlReal ){

				var urlReal = model.data.urlReal();
				return urlReal + "/!#/";
				
			}else{

				var uri = window.location.href;
				uri = uri.split('/admin/');

				if ( model.dominios === undefined){
					uri = uri[0] + '/#!/';
				}else{
					var dominio = 'www.dominio.com';
					uri = 'http' + dominio + '/#!/';
				}

				return uri;
			}
		},

		/* end of helpers utils */
		
		getTipoOptions: function( options ){
			options = $.extend({}, options);
			var result = $.extend([], this.tipoOptions);
			if( options.exclude ){
				result = ko.utils.arrayFilter( result, function( option ){
					if( option.value in options.exclude ){
						var shouldExclude = ko.unwrap( options.exclude[option.value] );
						if( typeof shouldExclude == 'function' ) shouldExclude = shouldExclude();
						return !shouldExclude;
					} else return true;
				});
			}
			return result;
		},

		getIconCSS: function( data ){
			var tipo = data.tipo;
			var tipos = {};
			tipos[this.TIPO_URL]		= 'mdi-earth';
			tipos[this.TIPO_PAGINA]		= 'mdi-file-outline';
			tipos[this.TIPO_PRODUCTO]	= 'mdi-basket';
			tipos[this.TIPO_CATEGORIA]	= 'mdi-tag-multiple';
			tipos[this.TIPO_STREAM]		= 'mdi-headphones';
			tipos[this.TIPO_ANCLA]		= 'mdi-anchor';

			if( tipo == this.TIPO_PAGINA && data.ancla ){
				tipo = this.TIPO_ANCLA;
			}

			return tipos[tipo];
		},

		parseHref: function( str ){
                    try
                    {
                        if( str && !$.URL.hasProtocol ( str ) ){
				var hb = $.hashbang.get( str );
				var hbStr = hb.toString();
				if( /^#!\/categoria\//.test( hbStr) ){
					return {
						'tipo'			: this.TIPO_CATEGORIA,
						'idCategoria'	: hb.path.categoria
					}
				} else if( /^#!\/producto\//.test( hbStr) ){
					return {
						'tipo'			: this.TIPO_PRODUCTO,
						'idProducto'	: hb.path.producto
					}
				}
			}
                    }
                    catch(error)
                    {}
                        
		},

		getHref: function( data, options ){
			var result = ''
				, asJS = data;

			switch( ko.unwrap( asJS.tipo ) ){
				case this.TIPO_URL:
					result = ko.unwrap( asJS.url );
					/*if( result && !this._urlHasProtocol( result ) && !this._urlIsHash( result ) ){
						result = 'http://' + result;
					}*/
					result = new $.URL( asJS.url() ).toString();
					break;

				case this.TIPO_PAGINA:
					result = this.getPaginaHref($.extend( {
						'idPagina'	: ko.unwrap( asJS.idPagina ),
						'ancla'		: ko.unwrap( asJS.ancla )
					}, options ) );
					break;

				case this.TIPO_STREAM:
					result = this.getRadioHref({
						'titulo'			: ko.unwrap( asJS.titulo ),
						'url'				: ko.unwrap( asJS.url ),
						'shoutcastChannel'	: ko.unwrap( asJS.shoutcastChannel )
					});
					break;

				case this.TIPO_ANCLA:
					result = $.hashbang.get(null,{ancla: ko.unwrap( asJS.ancla ) }).toString()
					break;

				case this.TIPO_CATEGORIA:
					result = $.hashbang.get({
						'categoria'	: ko.unwrap( asJS.idCategoria ),
						'pagina'	: 0
					}).toString()
					break;

				case this.TIPO_PRODUCTO:
					result = $.hashbang.get({
						'producto'	: ko.unwrap( asJS.idProducto )
					}).toString()
					break;

			}

			return result;
		},

		getHrefParaIframe: function( data, options ){
			var result = ''
				, asJS = data;

			switch( ko.unwrap( asJS.tipo ) ){
				case this.TIPO_URL:
					result = ko.unwrap( asJS.url );
					if( result && !this._urlHasProtocol( result ) && !this._urlIsHash( result ) ){
						result = 'http://' + result;
					}
					break;

				case this.TIPO_PAGINA:
					result = this.getPaginaHref($.extend( {
						'idPagina'	: ko.unwrap( asJS.idPagina ),
						'ancla'		: ko.unwrap( asJS.ancla )
					}, options ) );
					break;
			}

			return result;
		},
		
		_urlHasProtocol: function( url ){
			return /^http(s)?:\/?/.test( url );
		},

		_urlIsHash: function( url ){
			return /^#/.test( url );
		},

		getPaginaHref: function( options ){
			var link = '#!/';
			var pagina;

			if( options.obtenerPaginaPorId ){
				pagina = options.obtenerPaginaPorId( options.idPagina );
			}
			if( pagina ) {
				if(pagina.tipo() == 'blog'){
					link = '#!/blog';
				}else{
					link += pagina.getPermalink();
				}
				
			} else {
				link += 'pagina/' + options.idPagina;
			}
			link +=  '/';

			var ancla = options.ancla;
			if( ancla ){
				var params = {};
				params[tiendasimple.Pagina.Enlace.getAnclaParamName()] = ancla;
				link += '?' + $.param( params );
			}

			return link;
		},

		getRadioHref: function( options ){
			var titulo = options.titulo;
			var url = options.url;
			var shoutcastChannel = options.shoutcastChannel || '/;stream/1';
			if( shoutcastChannel && url.indexOf( shoutcastChannel ) == -1 ) url += shoutcastChannel ;
			return 'fronttienda/radio/?' + $.param({url: url, titulo: titulo});
		},

		describe: function( data, options ){
			var result = ''
				, asJS = data
				, options = $.extend({}, options);

			switch( ko.unwrap( asJS.tipo ) ){
				case this.TIPO_URL:
					result = 'url ' + asJS.url;
					break;

				case this.TIPO_PAGINA:
					var paginaDescripcion = asJS.idPagina;
					var pagina = options.obtenerPaginaPorId && options.obtenerPaginaPorId( asJS.idPagina );
					if( pagina ) paginaDescripcion = pagina.describe();
					if( asJS.ancla ) paginaDescripcion += '#' + asJS.ancla;
					result = 'pgina ' + paginaDescripcion;
					break;

				case this.TIPO_STREAM:
					var radioDescripcion = asJS.url;
					if( asJS.titulo ) radioDescripcion = asJS.titulo;
					result = 'radio ' + radioDescripcion;
					break;

				case this.TIPO_ANCLA:
					result = 'ancla ' + asJS.ancla;
					break;

				case this.TIPO_CATEGORIA:
					result = 'categoria ' + asJS.idCategoria;
					break;

				case this.TIPO_PRODUCTO:
					result = 'producto ' + asJS.idProducto;
					break;

			}

			return result;
		},

		prototype 	: {
			init: function( data, options ){
				this._parent.apply( this, arguments );

				var properties = [
					{
						'name': 'tipo',
						'defaultValue': 'url'
					},
					{
						'name': 'idPagina',
						'defaultValue': ''
					},
					{
						'name': 'ancla',
						'defaultValue': ''
					},
					{
						'name': 'idProducto',
						'defaultValue': ''
					},
					{
						'name': 'idCategoria',
						'defaultValue': ''
					},
					{
						'name': 'url',
						'defaultValue': ''
					},
					{
						'name': 'esShowCast',
						'defaultValue': true
					},
					{
						'name': 'titulo',
						'defaultValue': ''
					},
					{
						'name': 'target',
						'defaultValue': ''
					}
				];

				this.options = $.extend({ 'properties': properties }, options );

				this._createComputed();
				this._createPropertyAccessors();
			},

			_createComputed: function(){
				this.asJS = ko.computed(function(){
					return this.parse( this.data() );
				}, this );

				this.iconCSS = ko.computed( function(){
					var data = ko.toJS( this.asJS );
					return this.constructor.getIconCSS( data );
				}, this );
			},

			_createPropertyAccessors: function(){
				var self = this;
				$.each( this.options.properties, function( index, property ){
					self.asJS[property.name] = ko.computed({
						read: function(){
							var js = self.asJS();
							var newValue = js[property.name] !== undefined ? js[property.name] : property.defaultValue;
							return newValue ;
						},
						write: function( value ){
							var js = self.asJS.peek();
							if( value != js[property.name]){
								js[property.name] = value;
								var json = self.stringify( js );
								self.data(json);
							}
						}
					}).extend({preserveChange: true});
				})
			},

			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			parse: function( str ){
				var self = this
					, selectedJS = {};

				$.each( this.options.properties, function( index, property ){
					if( property.defaultValue ){
						selectedJS[property.name] = property.defaultValue;
					}
				});

				try{
					var js = JSON.parse( str );
					$.each( this.options.properties, function( index, property ){
						selectedJS[property.name] = js[ self.translatePropertyNameToExternal( property.name ) ];
					});
				} catch( e ){
						selectedJS['url'] = str;
				}
				return $.extend( selectedJS, self.constructor.parseHref( selectedJS['url']));
			},

			stringify: function( js ){
				var self = this
					, selectedJS = {}
					, translated = {};

				$.each( this.options.properties, function( index, property ){
					var newValue = js[property.name] !== undefined ? js[property.name] : property.defaultValue;
					selectedJS[property.name] = newValue;
				});

				selectedJS = this.constrain( selectedJS );

				$.each( selectedJS, function( key, value ){
					translated[  self.translatePropertyNameToExternal( key ) ] = value;
				});

				return JSON.stringify( translated );
			},

			////////////////////////////////

			constrain: function( js ){
				var selectedProperties = ['tipo'];

				if( !js.tipo ){
					js.tipo = this.constructor.TIPO_URL;
				}

				switch( js.tipo ){
					case this.constructor.TIPO_URL:
						selectedProperties = selectedProperties.concat( ['url', 'target'] );
						break;

					case this.constructor.TIPO_PAGINA:
						selectedProperties = selectedProperties.concat( ['idPagina', 'ancla', 'target'] );
						break;

					case this.constructor.TIPO_PRODUCTO:
						selectedProperties = selectedProperties.concat( ['idProducto', 'target'] );
						break;

					case this.constructor.TIPO_CATEGORIA:
						selectedProperties = selectedProperties.concat( ['idCategoria', 'target'] );
						break;

					case this.constructor.TIPO_STREAM:
						selectedProperties = selectedProperties.concat( ['url', 'esShowCast'] );
						break;

					case this.constructor.TIPO_ANCLA:
						selectedProperties = selectedProperties.concat( ['ancla'] );
						break;
				}

				return $.getSelectedProperties(js, selectedProperties );
			},

			////////////////////////////////

			translatePropertyNameToInternal: function( propertyName ){
				return propertyName;
			},

			translatePropertyNameToExternal: function( propertyName ){
				return propertyName;
			},

			getHref: function( options ){
				var result = ''
					, asJS = this.asJS;

				return this.constructor.getHref( this.asJS, options );
			},

			getHrefParaIframe: function( options ){
				var result = ''
					, asJS = this.asJS;

				return this.constructor.getHrefParaIframe( this.asJS, options );
			},

			getTarget: function(){
				var result = null
					, asJS = this.asJS;

				switch( ko.unwrap( asJS.tipo ) ) {
					case this.constructor.TIPO_CATEGORIA:
					case this.constructor.TIPO_PRODUCTO:
					case this.constructor.TIPO_PAGINA:
					case this.constructor.TIPO_URL:
						var otraVentana = /^(https?:\/\/)?((w{3}\.)?)facebook.com(\/.*)?/i.test( ko.unwrap( asJS.url ) );
						result = otraVentana || ko.unwrap( asJS.target ) ? '_blank' : null;
						break;

					case this.constructor.TIPO_STREAM:
						result = '_blank';
						break;
				}

				return result;
			},

			describe: function( options ){
				var data = ko.toJS( this.asJS );
				return this.constructor.describe( data, options );
			},

			isEmpty: function(){
				var result = false
					, asJS = this.asJS;

				switch( ko.unwrap( asJS.tipo ) ) {
					case this.constructor.TIPO_PAGINA:
						result = !ko.unwrap( asJS.idPagina );
						break;

					/*
					case this.constructor.TIPO_ANCLA:
						result = !ko.unwrap( asJS.ancla );
						break;
						*/

					case this.constructor.TIPO_URL:
					case this.constructor.TIPO_STREAM:
						result = ! ko.unwrap( asJS.url )
						break;

					case this.constructor.TIPO_CATEGORIA:
						result = !ko.unwrap( asJS.idCategoria );
						break;

					case this.constructor.TIPO_PRODUCTO:
						result = !ko.unwrap( asJS.idProducto );
						break;

				}

				return result;
			}
		}


	});




	///////////////////////////////////////////////////////////
	// "{"url":"http://200.58.101.247:8000","esShowCast":true,"tipoHref":"stream","titulo":""}"
	// "{"idPagina":"144","tipoHref":"pagina"}"
	// "{"url":"http://google.com","nuevaVentana":true,"tipoHref":"url"}"
	namespace.EnlaceSnippet = namespace.Enlace.createSubclass({

	},{
		translatePropertyNameToInternal: function( propertyName ){
			return {
				'tipoHref'		: 'tipo',
				'nuevaVentana'	: 'target'
			}[propertyName] || propertyName;
		},

		translatePropertyNameToExternal: function( propertyName ){
			return {
				'tipo'			: 'tipoHref',
				'target'		: 'nuevaVentana'
			}[propertyName] || propertyName;
		}

	})

})($.namespace('tiendasimple.helpers'));


/* /js/helpers/helper_requestpool.js
 * compresion time: 8.93593 -(ms)
 * --------------------------------- */
;(function(namespace){
	namespace.RequestPool = $.Class({
		defaultOptions	: {
			throttle	: 1000
		},
		prototype: {
			/**
			 * @params options = {
							 * 		throttle		: 1000,
							 * 		cache			: false,
							 * 		resultFilter	: function( result, request ){},
							 * 		get				: function( params ){}
							 * }
			 */
			init: function( options ){
				this.options = $.extend( {}, this.constructor.defaultOptions, options );
				this._requests = [];
				this._timeoutHandle;
				this._cache = null;
			},

			destroy: function(){
				this._requests = null;
				clearTimeout( this._timeoutHandle );
				this.options = null;
				if( this._cache ) {
					this._cache.destroy();
					this._cache = null;
				}
			},

			get: function( newRequest ){
				if( this.options.cache ){
					return this._getCache().get( newRequest );
				} else {
					return this._get( newRequest );
				}
			},

			////////////////////////////////////////////////////////////////////////////////////////////////

			_getCache: function(){
				var self = this;
				if( !this._cache ){
					this._cache = new namespace.Cache($.extend({
						'get'		: function( key ){
							return self._get( key );
						}
					}, this.options.cache));
				}
				return this._cache;
			},

			_get: function( newRequest ){
				var key = ko.toJSON( newRequest );
				var value = newRequest;
				var request = this._getRequestByKey( key );
				if( !request ){
					request = this._addRequest( key, value );
				}
				return this._getPromise( request );
			},

			_getDeferred: function(){
				if( !this._deferred ){
					this._deferred = $.Deferred();
				}
				return this._deferred;
			},

			_getPromise: function( request ){
				var self = this;
				if( !request.promise ){
					request.promise = this._getDeferred().then( function( results ){
						return self._filterResult( results, request );
					});
				}
				return request.promise;
			},

			_filterResult: function( results, request ){
				var resultFilter = this.options.resultFilter;
				if( resultFilter ){
					result = ko.utils.arrayFirst( results, function( result ){
						return resultFilter( result, request.value );
					});
				}
				return result;
			},

			_doRequest: function(){
				var get = this.options.get;
				if( get ){
					var values = $.pluckCollection( this._requests, 'value' );
					$.linkDeferreds( get( values ), this._getDeferred() );
					this._requests = [];
					this._deferred = null;
				}
			},

			_addRequest: function(key, value ){
				var request = {
					key		: key,
					value	: value
				};
				this._requests.push( request );

				///////////
				clearTimeout( this._timeoutHandle );
				this._timeoutHandle = setTimeout( this._doRequest.bind( this ), this.options.throttle );
				///////////

				return request;
			},

			_getRequestByKey: function( key ){
				return ko.utils.arrayFirst( this._requests, function( request ){
					return request.key == key;
				});
			}

		}

	});
})($.namespace('tiendasimple.helpers'));


/* /js/helpers/helper_cache.js
 * compresion time: 7.38192 -(ms)
 * --------------------------- */
;(function(namespace){

	namespace.Cache = $.Class({
		defaultOptions	: {
			get			: null,
			key			: null,
			size		: 100,
			expires		: -1 // never
		},

		prototype 	: {
			init: function( options ){
				this.options = $.extend( {}, this.constructor.defaultOptions, options );
				this._cache	= [];

				this._autoDestroyCacheHandlers = {};
			},

			destroy: function(){
				this._cache = null;
				this.options = null;

				$.each( this._autoDestroyCacheHandlers, function( key, value ){
					clearTimeout( key );
				});

			},

			has: function( key ){
				return !! this._getItemFromCache( key );
			},

			clear: function(){
				this._cache = [];
			},

			/**
			 *
			 * @param key
			 * @returns $.Promise
			 */
			get: function( param ){
				var key = param;
				if( typeof this.options.key == 'function' ){
					key = this.options.key( key );
				}
				var itemFromCache = this._getItemFromCache( key );
				if( !itemFromCache ){
					itemFromCache = this._addItemToCache( key, param );
				}
				return itemFromCache.value;
			},

			/////////////////////
			_addItemToCache: function( key, param ){
				var self = this;
				var value = param;
				var get = this.options.get;
				if( get ){
					value = get( param );
				}
				var item = new namespace.Cache.Item( key, value );
				this._cache.push( item );

				if( this.options.expires > 0 ){
					var handler = setTimeout( function(){
						self._removeItemFromCache( item );
						delete self._autoDestroyCacheHandlers[ handler ];
					}, this.options.expires );
					this._autoDestroyCacheHandlers[ handler ] = true;
				}

				if(this._cache.length > this.options.size ){
					this._cache.shift();
				}

				return item;
			},

			_getItemFromCache: function( key ){
				var result = ko.utils.arrayFirst( this._cache, function( item ){
					return item.key == key;
				});
				return result;
			},

			_removeItemFromCache: function( item ){
				ko.utils.arrayRemoveItem( this._cache, item );
			},

			_isItemFromCacheOutOfDate: function( item ){
				var result = false;
				if( item && this.options.expires > 0  ){
					result = item.expired( new Date().addMilliseconds( -this.options.expires ) );
				}
				return result;
			}
		}
	});

	namespace.Cache.Item = $.Class({
		prototype 	: {
			init: function( key, value ){
				this.key = key;
				this.value = value;
				this.dateCreated = new Date();
			},

			expired: function( date ){
				return this.dateCreated.isBefore( date );
			}
		}
	});

})($.namespace('tiendasimple.helpers'));


/* /js/helpers/helper_utils.js
 * compresion time: 0.14687 -(ms)
 * --------------------------- */
;(function(namespace){
	/**
	 * helper generico con utilidades de parseo , manipulacin de DOM, contextos, mappers, VM, etc.
	 */

	namespace.Utils = ko.ViewModel.createSubclass({
		'mappeable'	: {
			data		: ''
		},

		'defaults'	: {
		},

		'mapping'	: {
		}
	}, {
		
        getDataByElement : function( elementId ){
            
            var element = document.getElementById( elementId );
            if (element === null) return null; 
             
            var context = ko.contextFor( element );
            var data = context.$data;
            var value = element.value;

            var info = {
                data : data,
                elementId : element.id,
                value : value,
                context : context
            };
            
            return info;
        
            },

			getIdioma : function(){
				var idioma = {
					id : 1,
					iso : 'es',
					locale : 'ar',
				};
				return idioma;
			},

			getImage : function (image){
				var url = 'galeriaimagenes/obtenerimagen/?id=';
				if ( !image ){
					url = '';
				}
				else
				{
					url = url + image;
				}
				return url;
			}, 

            getURIcharacter : function () { 
                    return '#!';
			},
			
            getFechaActual : function() {
                var f = new Date();
                var hora = f.getHours() + ':' + f.getMinutes() + ':' + f.getSeconds(); 
                var fechaActual = f.getDate() + "/" + (f.getMonth() +1) + "/" + f.getFullYear();
                return fechaActual + ' ' + hora;
            },

            getMoneda : function( item ) {

                var moneda = model.data.obtenerMonedaPorId(item.idMoneda());
                var iso = moneda && moneda.iso();
                var total = item.total;

                var options = {
                    value       : total,
                    currency    : iso
                }

                return options;

            },

            getDataProducto : function( item ) {

                var moneda = model.data.obtenerMonedaPorId(item.idMoneda());
                var iso = moneda && moneda.iso();
                var total = item.precio();
                if (typeof item.traducciones === 'function'){
                    var titulo = item.traducciones()[0].descripcion();
                }else{
                    var titulo = '';
                }
                var categoria = '';
                var id = item.id();

                var data  = {
                    value       : total,
                    currency    : iso,
                    descripcion : titulo,
                    categoria : '',
                    id : id
                }

                return data;

            },

            getDataCarrito : function (){

                var totales = model.data.carrito.totales();
                var arrTotales = [];

                arrTotales['moneda'] = [];
                arrTotales['totales'] = [];

                totales.forEach(function(total){
                  arrTotales['moneda'].push(model.data.obtenerMonedaPorId(total.idMoneda).iso());
                  arrTotales['totales'].push(total.total);
                });

                return arrTotales;

            },
            
            transformarFechaGMT : function( fecha , convertirLocal, separador ){
                
                var self = this;
                var gmt = self.obtenerGmtLocal();
                if (fecha === '' || fecha === undefined) return '';
                if (separador === null || separador === undefined ){ separador = '/'; }
                var arrFecha = fecha.split(separador);
                var dia = arrFecha[0];
                var mes = arrFecha[1];
                var horaAnio = arrFecha[2].split(' ');
                var anio = horaAnio[0];
                var minutosHoras = horaAnio[1].split(':');
                var hora = minutosHoras[0];
                var minutos = minutosHoras[1];
                var segundos = 00;
                var strHoraLocal = anio + '-' + mes + '-' + dia + ' ' + hora + ':' + minutos;
                var horaLocal = {};
                var horaArg = {};
                
                if (convertirLocal){
                    horaLocal = moment.tz(strHoraLocal, gmt);
                    horaArg = horaLocal.clone().tz('Etc/GMT+3');
                }else{
                    horaLocal = moment.tz(strHoraLocal, 'Etc/GMT+3');
                    horaArg = horaLocal.clone().tz(gmt);
                }

                var nuevoDia = horaArg.format('D');
                var nuevoMes =  horaArg.format('M');
                var nuevoAnio = horaArg.format('YYYY');
                var nuevaHora = horaArg.format('HH');
                var nuevoMinutos = horaArg.format('mm');
                
                if ( nuevoDia < 10){ nuevoDia  = '0' + nuevoDia; } 
                if ( nuevoMes < 10){ nuevoMes = '0' + nuevoMes; } 
              
                var strFecha = nuevoDia  + '/' + nuevoMes + '/' + nuevoAnio + ' ' + nuevaHora + ':' + nuevoMinutos;
                return strFecha;
            },
            
            checkJs : function ( codigoCustom )
            {
                var nErrores = 0;
                var virtualIframe = document.createElement("IFRAME");
                virtualIframe.setAttribute('id', 'virtual-iframe');
                $('body')[0].appendChild( virtualIframe );
                virtualIframe._onerror = function()
                {                                
                 nErrores = 1;
                };
                // delete virtual iframe
                var element = document. getElementById('virtual-iframe');
                element.parentNode.removeChild(element);
                return nErrores;
            },
            
            obtenerGmtLocal : function(){
                
                var gmt = model.data.obtenerLabelGMTactual();
                var simbDiff = '';

                if (gmt.indexOf('+') > -1){ 
                    simbDiff = '-';
                }else{
                    simbDiff = '+'; 
                }

                gmt = gmt.replace('+', '');
                gmt = gmt.replace('-', '');
                gmt = gmt.split(':')[0];

                var gmtNumber = parseInt(gmt);
                if (gmtNumber < 10){
                    gmt = simbDiff + gmt.replace('0', '');
                }else{
                    gmt = simbDiff + gmt;
                }

                gmt = 'Etc/GMT' + gmt;   
                return gmt;
            },
            
            generarPwd : function(){
                var result = '';
                var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                var numbers = '0123456789';
                var charactersLength = characters.length;
                for ( var i = 0; i < 7; i++ ) {
                    result += characters.charAt(Math.floor(Math.random() * charactersLength));
                }
                result += numbers.charAt(Math.floor(Math.random() * numbers.length));
                return result;
            },
            
            prototype 	: {

                    init: function( data, options ){
                            this._parent.apply( this, arguments );
                            this._createComputed();
                    },

                    _createComputed : function(){

                    },
            },
            
	});


})($.namespace('tiendasimple.helpers'));


/* /js/model_imagenes.js
 * compresion time: 0.02289 -(ms)
 * --------------------- */
;(function( namespace ){
	namespace.Imagen = ko.ViewModel.createSubclass({
		mappeable: {
			id: null
		}
	}, {
		init: function(data){
			this._parent.apply(this, arguments);
		}
	});

})($.namespace('tiendasimple'));


/* /js/model_market.js
 * compresion time: 12.51793 -(ms)
 * ------------------- */
$.namespace('tiendasimple');

tiendasimple.Market = ko.ViewModel.createSubclass(
	{
		mappeable: {
			paginas : '',
			dominio : '',
			gdpr : false,
			verificarclientemanualmente : null,
			habilitarformsfileupload	: null,
			activo						: null,
			adminPreviewKey				: null,
			idiomaPorDefecto			: null,
			isoIdioma					: null,
			idMonedaPorDefecto			: null,
			isoMoneda					: null,
			simboloMoneda				: null,
			cotizacionMoneda			: null,
			ultimaModificacion			: '',
			tieneIsotipo				: false,
			imagenIsotipo				: null,
			idMarket					: null,
			idTemplate					: null,
			idSitioCategoria			: null,
			codigoGoogleAnalytics		: null,
			codigoGoogleWebmasterTools	: null,
			codigoGoogleTagManager	: null,
			codigoJsCustom	: null,  
			valorThemeConsol : null,
			codigoJsCustomBody	: null, 
			SwichCustomScrpt         : null,
			preciosDonWeb : null,
			afipForm960NM				: null,
			pixelFacebookScript         : null,
			esReseller					: null,

			googleRemarketing			: {
				script							: '',
				google_conversion_id			: '',
				google_conversion_label 		: ''					
			},
			estadoWizard				: null,
			
			//Seccin editable: Informacin bsica
			titulo						: null,
			subtitulo					: null,
			tieneLogo					: false,
			imagenLogo					: null,
			
			//Seccin editable: Encabezado y Pie de pgina
			nombreBotonAccesoClientes	: '',
			usarBotonAccesoClientes		: true,
			social			: {
				facebook: {
					habilitado	: true
				},
				twitter: {
					habilitado	: true
				},
				googlePlus: {
					habilitado	: true
				},
				pinterest: {
					habilitado	: true
				},
				whatsapp: {
					habilitado	: true
				}
			},
			mostrarMapaDeSitio			: true,
			notaAlPie					: '',

			//Seccin editable: Datos de contacto
			emailContacto				: null,			
			mostrarEmailContacto		: true,
			telefono					: null,
			direccion					: null,
			pais						: null,
			provincia					: null,
			ciudad						: null,
			codigoPostal				: null,
			mostrarMapa					: true,
			usuarioTwitter				: null,
			usuarioFacebook				: null,
			facebookAppId				: '',
			facebookAppNameSpace		: '',
			tieneProductos				: null,
			productosTipoDeVista				: 'pequeno', // pequeno | mediano | grande | lista
			productosTipoDeEscala				: 'contain', // contain | crop
			productosMostrarDescripcion			: true,
			productosMostrarDescripcionCorta	: true,
			productosMostrarImagen				: true,
			productosCantidadPorPagina			: 6,
			productosOrden						: [],   // s o s o s o s tiene que recibir un array del servidor

			adaptarTemplateAFacebook	: false,
			cantidadEmails				: 0,
			usarCarroCompras			: true,
			dtTieneTienda				: false,
			dtTieneBlog				    : false,
			dtTieneWebhook			    : false,
			dtTieneCompraSinRegistro    : false,
			dtTieneBackup  				: false,
			compraSinRegistroHabilitada : false,
			dtTieneSitio				: true,
			dtTieneDominio				: false,
			dtEsDemo					: false,
			dtDiasPrueba				: 30,
			dtDiasPruebaRestantes		: 0,
			dtTieneChat					: null,
			chatMarcablancaDominio		: null,
			dtDominioChat				: null,
			dtTieneEmailMarketing		: false,
			esDIFM						: false,
			estadoActivacion			: '',
			idMarket					: '',
			stockActivado									: true,
			stockMostrarInexistentesEnCatalogo				: false,
			stockValidarExistencia							: true,
			stockMostrarEnProducto							: false,
			stockTipoDeCalculo								: 'enCheckout',
			timeoutCarritoConfirmado						: '', // 25:20 25hs 20min
			vigenciaOrden									: '', // horas
			timeoutCarritoConfirmadoActivado				: true,
			vigenciaOrdenActivado							: true,
			editarUnidadesVenta								: false,

			localizacion: {
				precision	: 2,
				number_format: {
					decimal	: ',',
					group	: '.'
				},
				locale		: 'es_AR'
			},
			
			sitioResponsivo: true,
			
			configuracion	: {
				items		: [
					{ 'key': 'dominios_preferido'			, 'value': '' },
					{ 'key': 'regional_politicaCookiesUE'	, 'value': false },
					{ 'key': 'regional_politicaGDPR'	, 'value': false },
					{ 'key': 'regional_politicaGDPR_label'	, 'value': '' },
					{ 'key': 'regional_politicaGDPR_url'	, 'value': '' },
				]
			}
		}, 
		mapping: {
			configuracion: {
				create: function( options ){
					return new tiendasimple.Market.Configuracion( options.data );
				}
			}
		}
	},{

	init: function(){
		this._parent.apply(this, arguments);
		this._createComputed();

	},

	_createComputed: function(){
		this.direccionParaGMaps = ko.computed(function(){
			var arr = [	this.direccion(), this.ciudad(), this.provincia(), this.pais()];
			return $.trim($.grep(arr, function(i){return i;} ).join(', ').replace(/\([^\)]+\)/ig, ''));			
		}, this);

		this.direccionCompleta = ko.computed(function(){
			var arr = [	this.direccion(), this.codigoPostal() && 'cp' + this.codigoPostal(), this.ciudad(), this.provincia(), this.pais()];
			return $.grep(arr, function(i){return i} ).join(', ');			
		}, this);

		this.direccionYCiudad = ko.computed(function(){
			var arr = [	this.direccion(), this.ciudad() ];
			return $.grep(arr, function(i){return i} ).join(', ');			
		}, this);
		
		
		this.titulo.sinNombre = ko.computed(function(){
			return 'Sitio sin nombre'
		}, this);
		
		this.productosTipoDeVistaSpan = ko.computed(function(){
			
			var resultado = 'span4';
			
			switch( this.productosTipoDeVista() ){
			
			case 'pequeno': 
				resultado = 'span4';
				break;
				
			case 'mediano': 
				resultado = 'span6';
				break;
				
			case 'grande':
			case 'lista': 
				resultado = 'span12';
				break;
			}
			
			return resultado;
			
		}, this);
		
		this.productosOrdenParaSelect = ko.computed({
			read: function(){
				var arr = this.productosOrden()
					, ret = '0'
					, orden = arr[0];
				
				if( arr.length == 0 ){
					
				} else {
					if( orden.campo() == "precio" && !orden.desc() ) ret = '1';
					if( orden.campo() == "precio" && orden.desc() ) ret = '2';
					if( orden.campo() == "descripcion" && !orden.desc() ) ret = '3';
					if( orden.campo() == "descripcion" && orden.desc() ) ret = '4';
					if( orden.campo() == "auditdatecreation" && !orden.desc() ) ret = '5';
					if( orden.campo() == "auditdatecreation" && orden.desc() ) ret = '6';
				}
				
				return ret;
			},
			
			write: function ( value ){
				var valor = null
					, arr = [];
				
				switch ( parseInt(value) ){
					case 1:
						valor = {campo: "precio", desc: false};
						break;
					case 2:
						valor = {campo: "precio", desc: true};
						break;
					case 3:
						valor = {campo: "descripcion", desc: false};
						break;
					case 4:
						valor = {campo: "descripcion", desc: true};
					case 5:
						valor = {campo: "auditdatecreation", desc: false};
						break;
					case 6:
						valor = {campo: "auditdatecreation", desc: true};
						break;
				}
				
				if( valor ) arr.push( ko.mapping.fromJS(valor));
				this.productosOrden(arr);

			}
		}, this );
		
		this.productosOrdenText = ko.computed(function(){
			var result = '';
			
			switch( this.productosOrdenParaSelect() ){
			case '0': 
				result = i18n.kot('global:orden.predeterminado');
				break;
			case '1': 
				result = i18n.kot('global:orden.menor_precio');
				break;
			case '2': 
				result = i18n.kot('global:orden.mayor_precio');
				break;
			case '3': 
				result = i18n.kot('global:orden.nombre_ascendente');
				break;
			case '4': 
				result = i18n.kot('global:orden.nombre_descendente');
				break;
			case '5': 
				result = "Fecha ascendente";
				break;
			case '6': 
				result = "Fecha descendente";
				break;
			}
			

			return result;

		}, this);
	},

	esDemoVencida: function(){
		return this.dtEsDemo() && this.dtDiasPruebaRestantes() <= 0;
	},

	esDemoVencidaHoy: function(){
		return this.dtEsDemo() && this.dtDiasPruebaRestantes() == 0;
	},

	obtenerDiasDemoVencida: function(){
		return Math.abs( this.dtDiasPruebaRestantes() );
	},

	obtenerDiasDemoRestantes: function(){		
		return Math.abs( this.dtDiasPruebaRestantes() );
	},

	getURLSnapshotEnLaptop: function( options ){
		var path = 'galeriaimagenes/obtenerimagen/';
		var options = $.extend({
			'id'		: 'sitio_snapshot',
			'ondevice'	: 'laptop_mail',
			'cache'		: false
		}, options );
		return path + '?' + $.param( options );
	}
});




tiendasimple.Market.Imagen = tiendasimple.Imagen.extend({
	init: function(data, market){
		this._mappeable = $.extend({}, this._mappeable, {
			nombre		: null
		});
		
		this.market = market;
		
		this._parent.apply(this, arguments);

		this.url = ko.computed(function(){
			var path = 'galeriaimagenes/obtenerimagen/';			
			return path + ( this.nombre() ? '?logoTemporal=' + this.nombre() : '' );
		}, this);
	},
	
	destroy: function(){
		this.market = null;
		this.url = null;
	},
	
	get: function(options){
		var options = $.extend({}, options);
		/* options.cropratio
		 * options.width
		 * options.height
		 * */
		
		var url = this.url();
		
		if( url.indexOf( 'logoTemporal' ) == -1 ) {
			options.id = 'sitio_logo';
			options.ultimaModificacion = ko.utils.unwrapObservable(this.market && this.market.ultimaModificacion);
		}
		
		var nexo = url.indexOf('?') == -1 ? '?' : '&';
		
		return url + nexo + $.param(options);
	}
});



tiendasimple.Market.EstadoWizard = {
	'WIZARD_INICIAL'						: 'wizardInicial',
	'WIZARD_CONFIGURACION_BIENVENIDO'		: 'wizardConfiguracion.bienvenido',
	'WIZARD_CONFIGURACION_NOMBRE_SITIO'		: 'wizardConfiguracion.nombreSitio',
	'WIZARD_CONFIGURACION_ACTIVIDAD'		: 'wizardConfiguracion.actividad',
	'WIZARD_CONFIGURACION_TEMPLATE'			: 'wizardConfiguracion.template',
	'WIZARD_CONFIGURACION_CONTACTO'			: 'wizardConfiguracion.contacto',
	'WIZARD_CONFIGURACION_PREVISUALIZACION'	: 'wizardConfiguracion.previsualizacion',
	'TIENDA_SIMPLE'							: 'tiendaSimple'
};


tiendasimple.Market.Configuracion = ko.ViewModel.createSubclass({
	mappeable	: {
		items	: []
	},
	
	mapping		: {
		items	: {
			create: function( options ){
				return new tiendasimple.Market.Configuracion.Item( options.data );
			},
			
			key	: function( options ){
				return ko.unwrap( options.key );
			}
		}
	}
}, {
	init: function(){
		this._parent.apply( this, arguments );
	},
	
	get: function( key, defaultValue ){
		var config = this.getByKey(key);
		if( config ){
			return ko.unwrap( config.value );
		} else {
			return defaultValue;
		}
	},
	
	set: function(key, value){
		var config;
		config = ko.utils.arrayFirst( this.items(), function( item ){
			return ko.unwrap( item.key ) === key;
		});
		
		if(!config){
			config = new tiendasimple.Market.Configuracion.Item({
				key		: key,
				value	: value
			});
			this.items.push(config);
		} else {
			config.update( {value: value} );			
		}
		
		return config && config.value();
	},
	
	getByKey: function(key){
		var config;
		config = ko.utils.arrayFirst( this.items(), function( item ){
			return ko.unwrap( item.key ) === key;
		});
		return config;
	},
	
	getByKeys: function( keys ){
		var keys = $.toArray( keys )
			, items;
		items = ko.utils.arrayFilter( this.items(), function( item ){
			return $.inArray( ko.unwrap( item.key ), keys) !== -1;
		});
		return items;		
	},

	getByKeyOrCreate: function(key, defaultValue){
		var config = this.getByKey(key);
		if(!config){
			this.set(key, defaultValue);
			config = this.getByKey(key);
		}
		return config;
	},

	updateValues: function( data ){
		var self = this;
		$.each( data, function( key, value ){
			var item = self.getByKey( key );
			if( item ){
				item.value( value );
			}
		});
	},
});

tiendasimple.Market.Configuracion.Item = ko.ViewModel.createSubclass({
	mappeable: {
		key		: '',
		type	: '',
		value	: null
	}
});


/* /js/model_traducciones.js
 * compresion time: 0.06008 -(ms)
 * ------------------------- */
$.namespace('tiendasimple');

tiendasimple.Idioma = ko.ViewModel.extend({
	_mappeable: {
		descripcion	: '',
		id			: null,
		iso			: '',
		usado		: true		
	},
	
	_defaults: {
	},
	
	init: function(data){
		this._parent.apply(this, arguments);
		
		this.flag = ko.computed(function(){
			return {
				'en' : 'us',
				'pr' : 'br'
			}[this.iso()] || this.iso();
		}, this);
		
		this.flag.css = ko.computed(function(){
			return 'flag-' + this.flag();
		}, this)
	}
});

tiendasimple.Traduccion = ko.ViewModel.extend({
	_setMappeable: function(){
		this._parent.apply( this, arguments );
		this._mergeMappeable({
			idIdioma		: null,
			iso				: null,
			descripcion		: null		   
		})
	}
});


tiendasimple.Locale = ko.ViewModel.extend({
	
});


/* /js/model_monedas.js
 * compresion time: 0.02384 -(ms)
 * -------------------- */
tiendasimple.Moneda = ko.ViewModel.extend({
	_defaults: {
		id				: null,
		iso				: null, 
		cotizacion		: null,
		simbolo			: null, 
		traducciones	: []
	},
	
	_mapping: {
		traducciones:{
			create: function(options){
				return new tiendasimple.Moneda.Traduccion(options.data);
			}
		}
	},
	
	init: function(data){
		this._parent.apply(this, arguments);
		
		this.representacion = ko.computed(function(){
			return '(' + this.iso() + ') ' + this.simbolo();
		}, this);
	}
});

tiendasimple.Moneda.Traduccion = tiendasimple.Traduccion.extend({
	init: function(data){
		this._parent.apply(this, arguments);
	},
	
	_setMappeable: function(){
		this._parent.apply(this, arguments);
		this._mergeMappeable({
			idMoneda: null			
		})
	}
});


/* /js/model_usuarios.js
 * compresion time: 0.02193 -(ms)
 * --------------------- */
$.namespace('tiendasimple');

/**
 * Usuario
 */

tiendasimple.Usuario = ko.ViewModel.createSubclass({
	mappeable:{
		id			: '',
		nombre		: '',
		email		: '',
		superadmin	: false,
		tipoLogin	: 'tiendasimple', // tiendasimple || dattatec,
		idDattatec	: '',
		idmarket	: '',
		isoPais		: null
	}
}, {
	init: function(data){
		this._parent.apply(this, arguments);
		this._createComputed();
	},
	
	_createComputed: function(){
		this.logueado = ko.computed(function(){
			return !!this.id();
		}, this);
		
		this.logueado();		
	},

	esPromoFB: function(){
		return this.email() === 'campaniafacebook@sitiosimplecampania.com';
	}
});


/* /js/model_ventana.js
 * compresion time: 0.02098 -(ms)
 * -------------------- */
$.namespace('tiendasimple');

tiendasimple.Ventana = ko.ViewModel.createSubclass({
	mappeable: {
		activa		: false,
		disable		: false,
		disableAccept	: false,
		ajaxError	: null
	},
	
	defaults: {
		_done		: '',
		_fail		: '',
		_beforeAccept: ''
	}
},{
	createInstance: function(data, tipo, ajaxHelper, parentViewModel){
		if (arguments.length == 1){
			if(typeof arguments[0] == 'string' ){
				tipo = arguments[0];
				data = {};
			}
		}
		var clase = this;
		if(tipo){
			var className = tipo.substr(0,1).toUpperCase() + tipo.substr(1); // pasar a mayscula la primer letra de tipo
			if(clase[className]) clase = clase[className];			
		}
		return new clase(data, ajaxHelper, parentViewModel);
	},
	
	prototype:{
		init: function(){
			this._parent.apply( this, arguments );			
		},

		mostrar: function( options ){
			this._deferred = $.Deferred();
			this.__options = options;
			
			if( options !== undefined ){
				this._done( options.done );
				this._fail ( options.fail );
				this._beforeAccept ( options.beforeAccept );
			}
			this.activa(true);
			
			return this.getDeferred();			
		},

		reset: function(){	
			this._parent.apply(this, arguments);
			this.ajaxError && this.ajaxError(null);
			this.errors && this.errors.showAllMessages(false);
		},

		ocultar: function(){
			this.activa(false);
		},

		toggleMostrar: function(valor){
			var valor = typeof valor == 'undefined' ? !this.activa() : valor;
			this.activa(valor);
		},
				
		setDeferred: function( deferred ){
			var self = this;
			deferred
				.done( function(){
					self.getDeferred() && self.getDeferred().resolve.apply( self, arguments );
				})
				.fail( function(){
					self.getDeferred() && self.getDeferred().reject.apply( self, arguments );
				});
		},
				
		getDeferred: function(){
			return this._deferred;
		},
				
		obtenerConfiguracion: function(){
			var result = $.extend({
					disableAccept	: this.disableAccept
				}, this.__options)
				, done = ko.unwrap( this._done )
				, fail = ko.unwrap( this._fail )
				, beforeAccept = ko.unwrap( this._beforeAccept )
				, setDeferred = this.setDeferred.bind( this );

			if( done ) result['done'] = done;
			if( fail ) result['fail'] = fail;
			if( beforeAccept ) result['beforeAccept'] = beforeAccept;
			if( setDeferred ) result['setDeferred'] = setDeferred;
			
			return result;
		}
		
	}
});


/* /js/model_pagina.js
 * compresion time: 3.17693 -(ms)
 * ------------------- */
;(function(namespace){	
	//var traduccionIndex = 0;
		
	namespace.Pagina = ko.ViewModel.extend({
		'TIPO_TEXTO'		: 'texto',
		'TIPO_CATALOGO'		: 'catalogo',
		'TIPO_BLOG'			: 'blog',
		'TIPO_CONTACTO'		: 'contacto',
		'TIPO_SNIPPETS'		: 'snippets',
		'TIPO_ENLACE'		: 'enlace',
		'TIPO_NOLINKEADA'	: 'nolinkeada',
		'TIPO_CARPETA'		: 'carpeta',

		createInstance: function(data){
			
			var data = $.extend({}, data);
			var clase = this;
			
			if( !data.tipo ) data.tipo = 'snippets';
			
			var subclase = $.string.capitalize( data.tipo );
			
			if(clase[subclase]) clase = clase[subclase];
			return new clase(data);
		},

		options: {
			useMappingKey: false	
		},

		prototype:{
			init: function(data){	
				this._parent.apply(this, arguments);

				this._createEditables();
				this._createComputed();
				this._applySubscriptions();

				this.uid = ko.observable(Math.round(Math.random()*999999999999));

				this._createValidations();
			},
			
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					id					: null,
					tipo				: null, // 'snippets' | 'catalogo' | 'texto' | 'contacto' | 'blog'  
					configuracion		: '',
					traducciones		: [],
					orden				: null,
					habilitada			: true,
					idPadre				: null,
					auxiliar			: null,
					mostrarTitulo		: true,
					mostrarDescripcion	: true,
					accesiblePublico	: true,
					accesibleClientes	: true,
					tipoFuncionalidad	: null
				});
			},
			
			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					subPaginas: []
				});
			},
			
			_setMapping: function(){
				this._parent();
				this._mergeMapping({
					traducciones: {
						create: function(options){
							
							var constructor = options.parent.constructor,
								clase;
						
							while(constructor && !(clase = constructor['Traduccion'])){
								constructor = constructor._parent;
							}
							if(!clase) clase = namespace.Pagina.Traduccion;
							
							return new clase( options.data );
						},

						key: namespace.Pagina.options.useMappingKey && function( data ){
							return ko.unwrap( data.idIdioma );
						}
					},
					
					subPaginas: {
						create: function(options){
							var backIsDefined = !!(tiendasimple.back && tiendasimple.back.Pagina);
							var frontIsDefined = !!(tiendasimple.front && tiendasimple.front.Pagina);
							var constructor = options.parent.constructor;
							var creator = tiendasimple.Pagina;
							if( backIsDefined && ( constructor.inherits( tiendasimple.back.Pagina ) || constructor._hasBackFunctionality ) ){
								creator = tiendasimple.back.Pagina;
							} else if ( frontIsDefined ){
								creator = tiendasimple.front.Pagina;
							}

							if( creator == tiendasimple.Pagina ){
								//console.debug('se usa tiendasimple.Pagina', options, this );
							}
							var pagina = creator.createInstance(options.data);
							return pagina;
						}
					}
				})
			},

			_createComputed: function(){
			},

			_applySubscriptions: function(){
				
			},

			_createEditables: function(){

			},


			traduccion: function(iso){
				var iso = iso; // || this.idiomaEdicion();
				if(!iso) return this.traducciones()[0];
				return $.findInCollection(this.traducciones(), function(traduccion){
					return traduccion.iso() == iso;
				});
			},
			
			getPermalink: function( traduccion ){
				var permalink;
				
				if( !traduccion ) traduccion = this.traducciones()[0];
				
				if( traduccion && traduccion.prettyLink() ){
					permalink = '-' + encodeURIComponent( traduccion.prettyLink() );
				} else {
					permalink = 'pagina/' + this.id();					
				}				
				return permalink;								
			},
			
			getPageHashBang: function( traduccion, options ){
				var traduccion = traduccion || this.traduccion();
				return traduccion && traduccion.enlace.getHref( options );
				/*
				return '#!/' + this.getPermalink( traduccion );
				*/
			},
			
			getPageTarget: function( traduccion ){
				return undefined;
			},
			
			tieneEstePrettyLink: function( prettyLink ){
				return !!$.findInCollection( this.traducciones(), function( traduccion ){
					return traduccion.prettyLink() == prettyLink;
				});
			},
					
			describe: function(){
				var traduccion = this.traduccion();
				return ( traduccion && traduccion.titulo() ) || ('<pagina ' + this.id() + '>');
			},

			esEnlace: function(){
				return this.tipo() == 'enlace';
			}

		}
	});


	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Traduccion = namespace.Traduccion.extend({
		init: function(data){
			this._parent.apply(this, arguments);
			this._createEditables();
			this._createValidations();
			this._setSubscribes();
			if(!this.enlace) this.enlace = new tiendasimple.helpers.Enlace();
		},

		_setMappeable: function(){
			this._parent.apply(this, arguments);
			this._mergeMappeable({
				titulo			: null,
				tituloseo      : null,
				descripcion		: null,
				metaDescription	: null,
				metaKeywords    : [],
				contenido		: null,
				iso				: null,
				idIdioma		: null,
				prettyLink: '',
				prettylinktext: '',
				preprettylink: '',
				prettyUrlPersonalizada : false,
			});
		},
		
		_setDefaults: function(){
			this._parent.apply(this, arguments);
			this._mergeDefaults({
			});
		},

		_createEditables: function(){

		},

		_toSeoUrl: function( url ) {
			
			url = url.replace(new RegExp(/[]/g),"a");
            url = url.replace(new RegExp(/[]/g),"e");
            url = url.replace(new RegExp(/[]/g),"i");
            url = url.replace(new RegExp(//g),"n");                
            url = url.replace(new RegExp(/[]/g),"o");
			url = url.replace(new RegExp(/[]/g),"u");
			       
			var encodedUrl = url.toString().toLowerCase();      
			encodedUrl = encodedUrl.split(/\&+/).join("-and-")
			encodedUrl = encodedUrl.split(/[^a-z0-9]/).join("-");       
			encodedUrl = encodedUrl.split(/-+/).join("-"); 
			encodedUrl = encodedUrl.trim('-'); 
		  
			return encodedUrl; 
		},

		_setSubscribes : function(){
		
			var self = this;
			
			this.titulo.subscribe( function ( value ){

				var url = window.location.href;
		
				if (url.indexOf('nueva') > -1){

					self.tituloseo( value );

					if ( self.prettyUrlPersonalizada() === false){
						self.prettyLink( value );
					}
				}
			});
		}
	});

	
	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Texto = namespace.Pagina.extend({
		init: function(data){
			/*this._mappeable = $.extend({}, this._mappeable, {
			});*/
			this._parent.apply(this, arguments);
		}
	});


	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Catalogo = namespace.Pagina.extend({
		init: function(data){
			this._parent.apply(this, arguments);
		},

		getPermalink : function( traduccion ){
			return 'catalogo';
		}
	});

	namespace.Pagina.Catalogo.Traduccion = namespace.Pagina.Traduccion.extend({
		init: function(data){
			this._parent.apply(this, arguments);
			this.enlace.data('#!/catalogo/');
		}
	});


	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Contacto = namespace.Pagina.extend({
		init: function(data){
			this._parent.apply(this, arguments);
		},

		getPermalink: function( traduccion ) {
			return 'contacto';
		}
	});

	namespace.Pagina.Contacto.Traduccion = namespace.Pagina.Traduccion.extend({
		init: function(data){
			this._parent.apply(this, arguments);
			this.enlace.data('#!/contacto/');
		}
	});
	////////////////////////////////////////////////////////////////////////////
	
	namespace.Pagina.Enlace = namespace.Pagina.extend({
		getAnclaParamName: function(){
			return 'ancla';
		},

		prototype: {
			init: function(data){
				this._parent.apply(this, arguments);
				this._createComputed();
			}

		}
	});

	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Enlace.Traduccion = namespace.Pagina.Traduccion.extend({
		init: function(data){
			this._parent.apply(this, arguments);
			//this._createComputed();
			var linkTarget = this.linkTarget;
			this.linkTarget = this.enlace.asJS.target;
			this.linkTarget( linkTarget() );
		},
		
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				contenido		: null,
				link			: '',
				linkTarget		: ''
			});
		},

		_setDefaults: function(){
			this._parent.apply(this, arguments);
			this._mergeDefaults({
				//seccionesCargado	: false
			})
		},

		_setMapping: function(){
			var self = this;
			this._parent();
			this._mergeMapping({
				link	: {
					create	: function( options ){
						self.enlace = new tiendasimple.helpers.Enlace( { data: options.data } );
						return self.enlace.data;
					}
				}
			})
		},

		///////////////
		/*
		_createComputed: function(){
			var self = this;

			this.tipo = ko.computed({
				read: function(){
					return this.detectarTipo();
				},
				write: function( tipo ){
					this.setTipo( tipo );
				}
			}, this );

			this.linkAsJSON = ko.computed({
				read: function(){
					return this.getLinkAsJSON();
				},
				write: function( json ){
					var tipo = this.detectarTipo();
					switch( tipo ){
						case namespace.Pagina.Enlace.TIPO_PAGINA:
							json = $.getSelectedProperties(json, ['idPagina', 'ancla']);
							break;
						case namespace.Pagina.Enlace.TIPO_PRODUCTO:
							json = $.getSelectedProperties(json, ['idProducto']);
							break;
						case namespace.Pagina.Enlace.TIPO_CATEGORIA:
							json = $.getSelectedProperties(json, ['idCategoria']);
							break;
						default:
							json = undefined;
							break;
					}
					if( json ){
						json.tipo = tipo;
					}
					var jsonString = JSON.stringify( json );
					if( this.link.peek() != jsonString ) {
						this.link( jsonString || '' );
					}
				}
			}, this );

			//////////////////

			function createLinkPropertyAccessor( propertyName ){
				self.link[ propertyName ] = ko.computed({
                    read: function(){
                        return this.linkAsJSON() && this.linkAsJSON()[ propertyName ];
                    },
                    write: function( value ){
                        var arg = {};
                        arg[ propertyName ] = value;
                        this.setLinkJSONProperties( arg );
                    }
                }, self ).extend({preserveChange: true});
			}

			$.each(['idPagina', 'ancla', 'idProducto', 'idCategoria'], function( index, propertyName ){
				createLinkPropertyAccessor( propertyName );
			});

		},

		///////////////
		getLinkAsJSON: function(){
			var json;
			try{
				json = JSON.parse( this.link() );
			} catch( e ){
			}
			return json;
		},

		setLinkJSONProperties: function( properties ){
			var json = this.linkAsJSON();
			var newJson = $.extend( {}, json, properties );

			if( JSON.stringify( json ) != JSON.stringify( newJson ) ){
				this.linkAsJSON( newJson );
			}
		},


		detectarTipo: function(){
			var result = namespace.Pagina.Enlace.TIPO_URL;
			var json = this.getLinkAsJSON();
			if( json ){
				result = json.tipo;
			}
			return result;
		},

		setTipo: function( tipo ){
			var tipoActual = this.detectarTipo();
			var newLink;
			if( tipo != tipoActual ){
				switch( tipo ){
					case namespace.Pagina.Enlace.TIPO_URL:
						newLink = '';
						break;
					case namespace.Pagina.Enlace.TIPO_PAGINA:
						newLink = JSON.stringify({'tipo': namespace.Pagina.Enlace.TIPO_PAGINA, 'idPagina': null, 'ancla': ''});
						break;
					case namespace.Pagina.Enlace.TIPO_PRODUCTO:
						newLink = JSON.stringify({'tipo': namespace.Pagina.Enlace.TIPO_PRODUCTO, 'idProducto': null});
						break;
					case namespace.Pagina.Enlace.TIPO_CATEGORIA:
						newLink = JSON.stringify({'tipo': namespace.Pagina.Enlace.TIPO_CATEGORIA, 'idCategoria': null});
						break;
				}
				//console.debug('link:', this.link.peek(),'nuevo link:', newLink);
				this.link( newLink );
			}
		},*/

		//////////////////////////////////
		/**
		 *
		 * @param options { obtenerPaginaPorId: fn }
		 * @returns {*}
		 */

		describeLink: function( options ){
			var result = this.enlace.describe( options );
			return result;
		}


	});

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/*
		slo hay UNA pgina no linkeada y sirve para colgarle pginas fuera de men
	 */
	namespace.Pagina.Nolinkeada = namespace.Pagina.extend({
		init: function(data){
			$.extend(data, {
				traducciones: [
					{
						iso		: 'es',
						titulo	: 'fuera de men'
					}
				]
			})
			this._parent.apply(this, arguments);

		},

		getPageHashBang: function(){
			return '#!/--ERROR--/';
		}
	});

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Carpeta = namespace.Pagina.extend({
		init: function(data){
			this._parent.apply(this, arguments);
		}
	});

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Blog = namespace.Pagina.extend({
		init : function(data){
			this._parent.apply(this, arguments);
		}
	});

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.SnippetsPrivado = namespace.Pagina.extend({
		init : function(data){
			this._parent.apply(this, arguments);
		}
	});

	
})($.namespace('tiendasimple'));


/* /js/model_template.js
 * compresion time: 0.02384 -(ms)
 * --------------------- */
;(function( namespace ){
	
	namespace.Template = ko.ViewModel.extend({
		_mappeable: {
			id				: null,
			idEstilo		: null,
			idLayout		: null,
			idMarketDuenio	: null,
			idTema			: null,
			nombre			: null,
			publico			: true,
			rutaEstilo		: null,
			rutaLayout		: null,
			rutaTema		: null,
			categoria		: null,
			estiloEntidad	: {},
			temaEntidad		: {},
			version			: 1,
			paginaEjemplo	: false,
			
			tipoPersonalizacion : '', // universal | personal
			seccionesExcluidasPersonalizacion: [], // site-header, site-footer
			variablesExcluidasPersonalizacion: [] // site-header, site-footer
		},
		
		_mapping: {
			estiloEntidad: { create: function(options) { return new namespace.Estilo( options.data ); } },
			temaEntidad: { create: function(options) { return new namespace.Tema( options.data ); } }
		},

		init: function(data){
			this._parent.apply(this, arguments);		
		}
	});
	
	
	namespace.Template.Categoria = ko.ViewModel.extend({
		_mappeable: {
			id			: null,
			nombre		: null,
			cantidad	: null
		}
	});
	
	
	namespace.Template.Thumbnail = namespace.Imagen.createSubclass({
		defaults: {
			forzar		: false,
			usarDemo	: false,
			unique		: null,
			loaded		: false,
			alias		: ''
		}
	}, {

		init: function(data){
			this._parent.apply(this, arguments);
			
			this.alias.subscribeTo('market.alias', true);

			this.basePath = ko.computed(function(){
				return 'https://tsimg01.ferozo.com/' + this.alias() + '/admin/';
				//return 'https://tsimg01.ferozo.com/site/';
			}, this);

			this.url = ko.computed(function(){
				return this._url( true );
			}, this, {disposeWhen: this.destroyed} ).extend({throttle: 1});
		},
		
		destroy: function(){
			this._parent.apply(this, arguments);
			this.alias.unsubscribeFrom('market.alias');
		},

		recargar: function(){
			this.unique(Math.random());
			this.forzar(true);
		},
		
		_url: function( usarMarket ){
			var basePath = usarMarket ?  this.basePath() : 'https://tsimg01.ferozo.com/site/';
			
			if(!this.id()) return '/img/px.gif';
			var result = basePath + 'templates/verthumbnail/idTemplate/' +  (this.id() || 0) + '/' ;
			var params = {};
			if(this.usarDemo()) params.demo = 1;
			if(this.forzar()) {
				params.forzar = 1;
			}
			params.unique = this.unique();
			this.forzar(false);
			
			var url = result + ($.isEmptyObject(params) ? '' : '?') + $.param(params);
			return url;			
		},

		get: function(options){
			var options = $.extend({}, options);
			/* options.cropratio
			 * options.width
			 * options.height
			 * options.forzar == 1 recarga s o s (no usa cache)
			 * */

			var conector = this.url().indexOf('?') == -1 ? '?' : '&';
			return this._url( options.usarMarket ) + conector + $.param(options);
		}		
	});
	
	
})($.namespace('tiendasimple'));


/* /js/model_apariencia.js
 * compresion time: 0.02098 -(ms)
 * ----------------------- */
!function(namespace){
	
	namespace.Estilo = namespace.Tema = ko.ViewModel.createSubclass({
		mappeable: {
			id				: null,
			css				: null,
			idMarketDuenio	: null,
			less			: null,
			nombre			: null,
			publico			: true,
			variables		: null
		},
		
		defaults: {
			
		},
	}, {
		init: function(){
			this._parent.apply(this, arguments);			
			this.makeEditable();
		}
	});
	
	namespace.Apariencia = ko.ViewModel.createSubclass({
		mappeable: {
			//templatesPersonales				: [], // DEPRECADO 30/07/2014
			templateActual					: null,
			estilos							: [],
			temas							: [],
			templates						: [],		
			personalizacionDeTemplateActual : { tipoTemplate: 'universal' }		
		},
		
		defaults: {
			templatesCargando	: false,
			templatesCargados	: false
		},
		
		mapping	: {
			templateActual: {
				create: function(options){
					return ko.observable( options.data && new namespace.Template(options.data) );
				},

				update: function(options){
					var template = options.data && new namespace.Template( options.data );
					options.observable( template );
					return template;
				}
			},
			/*
			 * // DEPRECADO 30/07/2014
			 * templatesPersonales: {
				create: function(options){
					return new tiendasimple.TemplatePersonalizable(options.data);
				}
			},*/
			
			templates: {
				create: function(options){
					return new tiendasimple.back.Template(options.data);
				}
			},
			
			personalizacionDeTemplateActual: {
				create: function( options ){
					return new tiendasimple.TemplatePersonalizable( options.data );
				}
			},

			estilos: { 
				create: function(options) {
					return new namespace.Estilo( options.data );
				}
			},
			
			temas: { 
				create: function(options) {
					return new namespace.Tema( options.data );
				}
			}
		}
	}, {		
		init: function(){
			this._parent.apply(this, arguments);

			this._createComputed();
			this.initData();
			
			// this.templatesPersonales.extend({recordset: true}); // DEPRECADO 30/07/2014
		},
		
		initData: function(){
			
		},
		
		_createComputed: function(){
			
		},
		
		obtenerTemplatePorId: function(idTemplate){
			return $.findInCollection(this.templates(), function(template){return template.id() == idTemplate});
		}
		
	});
	
}($.namespace('tiendasimple'));


/* /js/model_estructura.js
 * compresion time: 0.02098 -(ms)
 * ----------------------- */
;(function(namespace){
	namespace.Estructura = ko.ViewModel.extend({
		createInstance: function(data) {
			var Clase = this;
			return new Clase(data);
		},

		prototype: {						
			init: function(){
				this._parent.apply(this, arguments);
			},
			
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					contenido: {}
				});
			},	
			
			_setMapping: function(){
				this._parent();
				this._mergeMapping({
					contenido: {
						create:	function( options ){
							var contenedor = new tiendasimple.Snippet.Contenedor ( options.data );
							return contenedor;
						}
					}
				})
			},
					
			
			////////////////////////////////////////////////////////////////////
			// PUBLIC
			
			insertarSnippet: function(snippet){
				var nuevoSnippet = snippet.clone();
				this.contenido.insertar(nuevoSnippet);
			}
		}
	});
	
})($.namespace('tiendasimple'));


/* /js/model_lesscss.js
 * compresion time: 0.02098 -(ms)
 * -------------------- */
function clean_up_less(css){ 
	var lines = css.split('\n');
	var currentnest = 0;
	var newcss = '';
	$.each(lines, function(index, line){
		var newline = line.trim();
		newline = newline.replace(/\s\{/ig, ' {');
		newline = newline.replace(/\s\s+/ig, ' ');
		var pos = line.indexOf('}');
		if(pos > -1){
			currentnest = currentnest - 1;
		}
		var tabs = '';
		var i = 0;
		while (i < currentnest){
			tabs += '\t';
			i++;
		}
		if(line.indexOf('{') != -1){
			currentnest++;
		}
		if(currentnest > 0){
			newcss += tabs + newline + '\n';
		} else {
			newcss += newline + '\n';
		}
	});
	return newcss.trim();
}


;(function(namespace){
	namespace.LessCSS= ko.ViewModel.extend({
		_mappeable: {
			baseColor	: [],
			less		: '',
			css			: '',
			avanzado	: false,
			compilando	: false,
			parseError	: false,

			variables	: {} // variables de less
		},

		_mapping: {
			baseColor: {
				create: function(options){
					return ko.observable(options.data);
				}
			}
		},

		init: function(data){
			this._parent.apply(this, arguments);
			this._createComputed();
			this._applySubscriptions();
		},
		
		update: function(data){
			data = ko.mapping.toJS(data);
			if('variables' in data){
				if(!data.variables) delete data.variables;
				if(typeof data.variables == 'string') data.variables = JSON.parse(data.variables);
			};
			this._parent.update(data);
		},

		_parseVariables: function(variables, prefijo){
			prefijo = prefijo || '';
			var self = this;
			var result = [];
			$.each(variables, function(key, value){
				if($.isPlainObject(value)){
					Array.prototype.push.apply(result, self._parseVariables( value, 'key' ));
				} else result.push(self._parseVariable(key, value, prefijo));
			});
			return result;
		},

		_parseVariable: function(key, value, prefijo){
			prefijo = prefijo || '';
			if(key.indexOf('Image')!=-1){
				var validImage = $.inArray((value||'').substr(-4), ['.jpg', '.png', '.gif']) != -1;
				if(!value) value = 'none';
				else if (($.string.startsWith(value, 'http') && !$.string.startsWith(value, 'url(')) || validImage) value = 'url("' + value + '")';
			} 

			var newKey = prefijo ? prefijo + $.string.capitalize(key) : key;

			return '@' + newKey + ': ' + value + ';';
		},

		_createComputed: function(){
			this.variablesLess = ko.computed(function(){
				var self = this;

				var toJS = ko.toJS(this.variables);
				var result = self._parseVariables(toJS);			
				return result.join('\n');

			}, this);

		},

		_applySubscriptions: function(){
		},

		_parseLess: function(srcless){
			var response = $.Deferred();
			try{
				this.lessParser = less.Parser({
					/*paths: ['/less/bootstrap/'], */
					local:true,
					optimizations: less.optimizations
				});
				this.lessParser.parse(srcless, $.proxy(function(error, result) {
					if (!error) {
						response.resolve(result.toCSS());
					} else {
						response.reject(error.message)
					}
				}, this));
			} catch(e){
				response.reject(e.message)
			}
			return response;
		},

		////////////////////////////////////////////////////////////////////////////

		actualizarVariables: function(variables){
			if($.isPlainObject(variables)){
				this.update({variables: variables});
			} else this.reset();
		},
		
		generarColores: function(){
			
		},
		
		fixLess: function(){
			if(!this.less()) this.less(this._initData.less);
			
			var re = /@import\s+"(?!\/|customization)/ig;
			var newLess = this.less();
			newLess = newLess.replace(re, '@import "/less/bootstrap/');
			this.less(newLess);
		},

		guardarNombre: function(nombre){
			var re = /(\*\*nombre:)([^\*])*(?=\*\*)/ig;
			var newLess = this.less();
			newLess = newLess && newLess.replace(re, '$1' + nombre);
			this.less(newLess);
		},

		cleanup: function(){
			this.less(clean_up_less(this.less()));
		},

		compilar: function(){
			var self = this;
			
			this.fixLess();
			this.cleanup();
			
			var src = self.less().replace('@import "customization";', self.variablesLess() );

			self.compilando( true );
			self.parseError( null );

			setTimeout(function(){
				self._parseLess( src )
					.done( function ( css ) {
						self.css( css )
					})
					.fail ( function( error ) {
						self.parseError ( error );
					})
					.always( function() {
						self.compilando( false );
					})
			}, 100);	
		},
		
		generarColoresYCompilar: function(){
			this.generarColores();
			this.compilar();
		}
		
		
	});	
	
})($.namespace('tiendasimple'));


/* /js/front/fronttienda_model_estilo.js
 * compresion time: 0.0248 -(ms)
 * ------------------------------------- */
;(function(namespace){
	namespace.EstiloEdicion = tiendasimple.LessCSS.extend({
		init: function(data){
			this._mappeable = $.extend({}, this._mappeable, {
				variables	: {
					navbarInverse					: false,
					// Base colors
					baseColor						: ['#73076f', '#d6b67e' ,'#83b9d6'],

					// Scaffolding
					bodyBackground					: '@white',
					textColor						: '@grayDark',

					linkColor						: '#08c',
					linkColorHover					: 'darken(@linkColor, 15%)',

					// Typography
					headingSmallColor				: '@grayLight',

					// Tables
					tableBackground					: 'transparent',
					tableBackgroundAccent			: '#f9f9f9',
					tableBackgroundHover			: '#f5f5f5',
					tableBorder						: '#ddd',

					// Buttons
					btnBackground					: '@white',
					btnBackgroundHighlight			: 'darken(@white, 10%)',
					btnBorder						: '#bbb',
					btnTextColor					: '@grayDark',
					btnTextShadowColor				: 'rgba(255,255,255,.75)',

					btnPrimaryBackground			: '@linkColor',
					btnPrimaryBackgroundHighlight	: 'spin(@btnPrimaryBackground, 20%)',
					btnPrimaryTextColor				: '@bodyBackground',
					btnPrimaryTextShadowColor		: 'rgba(0,0,0,.25)',


					btnInfoBackground				: '#5bc0de',
					btnInfoBackgroundHighlight		: '#2f96b4',
					btnInfoTextColor				: '@btnPrimaryTextColor',
					btnInfoTextShadowColor			: '@btnPrimaryTextShadowColor',

					btnSuccessBackground			: '#62c462',
					btnSuccessBackgroundHighlight	: '#51a351',
					btnSuccessTextColor				: '@btnPrimaryTextColor',
					btnSuccessTextShadowColor		: '@btnPrimaryTextShadowColor',

					btnWarningBackground			: 'lighten(@orange, 15%)',
					btnWarningBackgroundHighlight	: '@orange',
					btnWarningTextColor				: '@btnPrimaryTextColor',
					btnWarningTextShadowColor		: '@btnPrimaryTextShadowColor',

					btnDangerBackground				: '#ee5f5b',
					btnDangerBackgroundHighlight	: '#bd362f',
					btnDangerTextColor				: '@btnPrimaryTextColor',
					btnDangerTextShadowColor		: '@btnPrimaryTextShadowColor',

					btnInverseBackground			: '#444',
					btnInverseBackgroundHighlight	: '@grayDarker',
					btnInverseTextColor				: '@btnPrimaryTextColor',
					btnInverseTextShadowColor		: '@btnPrimaryTextShadowColor',

					// Forms
					// -------------------------
					inputBackground					: '@white',
					inputBorder						: '#ccc',
					inputBorderRadius				: '3px',
					inputDisabledBackground			: '@grayLighter',
					formActionsBackground			: '#f5f5f5',
					placeholderText					: '@grayLight',

					// Dropdowns
					// -------------------------
					dropdownBackground				: '@white',
					dropdownBorder					: 'rgba(0,0,0,.2)',
					dropdownDividerTop				: '#e5e5e5',
					dropdownDividerBottom			: '@white',

					dropdownLinkColor				: '@grayDark',
					dropdownLinkColorHover			: '@white',
					dropdownLinkColorActive			: '@dropdownLinkColor',

					dropdownLinkBackgroundActive	: '@linkColor',
					dropdownLinkBackgroundHover		: '@dropdownLinkBackgroundActive',


					// Miscelaneous
					hrBorder						: '@grayLighter',
					wellBackground					: '#f5f5f5',


					// Navbar
					// -------------------------
					navbarCollapseWidth					: '979px',
					navbarHeight						: '40px',
					navbarBackgroundHighlight			: '#ffffff',
					navbarBackground					: 'darken(@navbarBackgroundHighlight, 5%)',
					navbarBorder						: 'darken(@navbarBackground, 12%)',

					navbarText							: '#777',
					navbarLinkColor						: '#777',
					navbarLinkColorHover				: '@grayDark',
					navbarLinkColorActive				: '@gray', 
					navbarLinkBackgroundHover			: 'transparent',
					navbarLinkBackgroundActive			: 'darken(@navbarBackground, 5%)',

					navbarBrandColor					: '@navbarLinkColor',

					// Inverted navbar
					navbarInverseBackground				: '#111111',
					navbarInverseBackgroundHighlight	: '#222222',
					navbarInverseBorder					: '#252525',

					navbarInverseText					: 'grayLight',
					navbarInverseLinkColor				: 'grayLight',
					navbarInverseLinkColorHover			: 'white',
					navbarInverseLinkColorActive		: 'navbarInverseLinkColorHover',
					navbarInverseLinkBackgroundHover	: 'transparent',
					navbarInverseLinkBackgroundActive	: 'navbarInverseBackground',

					navbarInverseSearchBackground		: 'lighten(@navbarInverseBackground, 25%)',
					navbarInverseSearchBackgroundFocus	: 'white',
					navbarInverseSearchBorder			: 'navbarInverseBackground',
					navbarInverseSearchPlaceholderColor	: '#ccc',
					navbarInverseBrandColor				: 'navbarInverseLinkColor',

					// Pagination
					// -------------------------
					paginationBackground				: '#fff',
					paginationBorder					: '#ddd',
					paginationActiveBackground			: '#f5f5f5',


					// Hero unit
					// -------------------------
					heroUnitBackground					: '@grayLighter',
					heroUnitHeadingColor				: 'inherit',
					heroUnitLeadColor					: 'inherit',


					// Form states and alerts
					// -------------------------
					warningText							: '#c09853',
					warningBackground					: '#fcf8e3',
					warningBorder						: 'darken(spin(@warningBackground, -10), 3%)',

					errorText							: '#b94a48',
					errorBackground						: '#f2dede',
					errorBorder							: 'darken(spin(@errorBackground, -10), 3%)',

					successText							: '#468847',
					successBackground					: '#dff0d8',
					successBorder						: 'darken(spin(@successBackground, -10), 5%)',

					infoText							: '#3a87ad',
					infoBackground						: '#d9edf7',
					infoBorder							: 'darken(spin(@infoBackground, -10), 7%)',


					// Tooltips and popovers
					// -------------------------
					tooltipColor						: '#fff',
					tooltipBackground					: '#000',
					tooltipArrowWidth					: '5px',
					tooltipArrowColor					: '@tooltipBackground',

					popoverBackground					: '#fff',
					popoverArrowWidth					: '10px',
					popoverArrowColor					: '#fff',
					popoverTitleBackground				: 'darken(@popoverBackground, 3%)',

					// Special enhancement for popovers
					popoverArrowOuterWidth				: '@popoverArrowWidth + 1',
					popoverArrowOuterColor				: 'rgba(0,0,0,.25)',

					// thumbnails
					thumbnailCaptionColor				: '@gray',


					// tiendasimple

					componentBackground					: 'fadeout(@textColor, 95%)',
					componentActiveBackground			: 'fadein(@componentBackground, 5%)',

					bodyContentBackground				: 'fadeout(@white, 80%)'				
				}			
			})

			this._parent.apply(this, arguments);
		},
		
		_createComputed: function(){
			this._parent.apply(this, arguments);
			
			this.variables.bodyBackground.extend({xColor: true});
			this.variables.textColor.extend({xColor: true});
			this.variables.linkColor.extend({xColor: true});				
		},

		generarColores: function(){
			var baseColor = ko.toJS(this.variables.baseColor);


			// Scaffolding
			this.variables.bodyBackground( baseColor[0] );
			this.variables.textColor( baseColor[1] );
			this.variables.linkColor( baseColor[2] );

			// Type
			this.variables.headingSmallColor( 'fadeout(@textColor, 50%)' );

			// Links
			//this.variables.linkColor( this.variables.bodyBackground.triad()[2].getHex() );

			/*
			if(!this.variables.linkColor.readable(this.variables.bodyBackground())){
			   var hsv = this.variables.linkColor.getHSV();
			   this.variables.linkColor.setHSV( {v: hsv.v < 50 ? 70 : 30} );
			}
			*/

			// Button
			this.variables.btnBackground( this.variables.bodyBackground[ this.variables.bodyBackground.isDark() ? 'lighten' : 'darken' ](.3).getHex() );
			this.variables.btnBackgroundHighlight ( 'darken(@btnBackground, 5%)' );
			//this.variables.btnTextColor(this.variables.bodyBackground.isDark() ? '@white' : '@black');
			this.variables.btnTextColor(this.variables.textColor());
			this.variables.btnTextShadowColor(this.variables.bodyBackground.isDark() ? '@black' : '@white');

			this.variables.btnPrimaryBackgroundHighlight( 'darken(@btnPrimaryBackground, 5%)' );
			this.variables.btnPrimaryTextColor( this.variables.linkColor.isDark() ? '@white' : '@black' );

			// Thumbnails
			this.variables.thumbnailCaptionColor(this.variables.textColor());

			// Pagination 
			this.variables.paginationBackground( '@componentBackground' );
			this.variables.paginationBorder ('@componentBackground'); 
			this.variables.paginationActiveBackground ( '@componentActiveBackground' );

			// Forms
			this.variables.inputBackground('lighten(@bodyBackground, 10%)');
			this.variables.inputBorder('darken(@bodyBackground, 10%)');
			this.variables.inputDisabledBackground('@bodyBackground');
			this.variables.formActionsBackground('@bodyBackground');


			// Navbar
			
			var navbarBackground = this.variables.navbarInverse () ? 'textColor' : 'bodyBackground';
			var navbarForeground = this.variables.navbarInverse () ? 'bodyBackground' : 'textColor';
			
			this.variables.navbarBackgroundHighlight( '@' + navbarBackground );
			this.variables.navbarBackground( this.variables[navbarBackground].contrastFn() + '(@navbarBackgroundHighlight, 5%)' );	
			this.variables.navbarLinkColor( '@' + navbarForeground );

			this.variables.navbarLinkBackgroundHover ( this.variables[navbarForeground].contrastFn()  + '(@navbarBackground, 5%)' );
			this.variables.navbarLinkColorHover( this.variables[navbarBackground].contrastFn() + '(@navbarLinkColor, 5%)' );

			this.variables.navbarLinkBackgroundActive ( '@navbarLinkColor' );
			this.variables.navbarLinkColorActive( '@navbarBackgroundHighlight' );

			
			// tables
			this.variables.tableBackgroundAccent ( 'lighten(@bodyBackground, 10%)' );
			this.variables.tableBackgroundHover ( 'lighten(@bodyBackground, 15%)' );
			this.variables.tableBorder ( 'fadeout(@textColor, 70%)' );


			/*
			// Navbar
			
			var navbarBackground = this.variables.bodyBackground;
			var navbarForeground = this.variables.textColor;
			
			this.variables.navbarBackgroundHighlight('@bodyBackground');
			this.variables.navbarBackground( navbarBackground.contrastFn() + '(@navbarBackgroundHighlight, 5%)' );	
			this.variables.navbarLinkColor('@textColor');

			this.variables.navbarLinkBackgroundHover ( navbarForeground.contrastFn()  + '(@navbarBackground, 5%)' );
			this.variables.navbarLinkColorHover( navbarBackground.contrastFn() + '(@navbarLinkColor, 5%)' );

			this.variables.navbarLinkBackgroundActive ( '@navbarLinkColor' );
			this.variables.navbarLinkColorActive( '@navbarBackgroundHighlight' );
			*/
			/*this.variables.navbarLinkBackgroundActive( (this.variables.textColor.isDark() ? 'lighten' : 'darken') + '(@navbarLinkColor, 10%)');
			this.variables.navbarLinkBackgroundHover('@navbarLinkColorActive');
			*/


			/*
			this.variables.navbarLinkColorActive( (this.variables.bodyBackground.isDark() ? 'lighten' : 'darken') + '(@navbarLinkColor, 10%)');
			this.variables.navbarLinkColorHover('@navbarLinkColorActive');
			*/
			
			// Miscelaneous
			this.variables.wellBackground('darken(@bodyBackground, 10%)');			

			// Tiendasimple
			//this.variables.bodyContentBackground( 'fadeout(@' + ( this.variables.bodyBackground.isDark() ? 'black' : 'white' ) + ', 80%)' );
			this.variables.bodyContentBackground( 'fadeout(@bodyBackground, 30%)' );				

		}
		
	});
})($.namespace('tiendasimple.front'));


/* /js/front/fronttienda_model_tema.js
 * compresion time: 0.02193 -(ms)
 * ----------------------------------- */
;(function(namespace){	
	namespace.TemaEdicion = tiendasimple.LessCSS.extend({
		init: function(data){
			this._mappeable = $.extend({}, this._mappeable, {
				variables	: {
					// body		
					bodyContentBackground							: 'transparent',
					bodyBackgroundImage								: '',
					bodyBackgroundRepeat							: 'no-repeat',
					bodyBackgroundPosition							: 'top left',					
					bodyBackgroundOpacity							: '1',
					bodyBackgroundSize								: 'none',

					// header
					headerDisplay								: 'block',
					headerHeight								: '120px',
					headerBackground							: 'transparent',
					headerBackgroundImage						: '',
					headerBackgroundRepeat						: 'no-repeat',
					headerBackgroundPosition					: 'top left',
					headerBackgroundOpacity						: '1',
					headerBackgroundSize						: 'none',

					// footer
					footerHeight								: '0',
					footerBackground							: 'transparent',
					footerBackgroundImage						: '',
					footerBackgroundRepeat						: 'no-repeat',
					footerBackgroundPosition					: 'top left',
					footerBackgroundOpacity						: '1',
					footerBackgroundSize						: 'none',

					// lista productos
					productListType								: 'thumnails'
				}			
			})

			this._parent.apply(this, arguments);
		},
		
		_applySubscriptions: function(){
			
		}

	});
})($.namespace('tiendasimple.front'));


/* /js/model_snippets.js
 * compresion time: 0.09704 -(ms)
 * --------------------- */
;(function(namespace){

	namespace.SnippetEvent = {
		CLICK		: 'click',
		MOUSE_ENTER	: 'mouseenter',
		MOUSE_LEAVE	: 'mouseleave'
	};

	namespace.SnippetEventBinding = ko.ViewModel.createSubclass({
		'mappeable'		: {
			'eventName'		: '',		// ejemplo click
			'emitterGUID'	: '',		// guid del emisor
			'action'		: ''		// accin a realizar
		}
	});
	
	namespace.Snippet = ko.ViewModel.extend({
		options			: {
			useMappingKey	: namespace.Pagina && namespace.Pagina.options.useMappingKey
		},

		createInstance: function(data, parent) {
			var Clase = this;
			if(data.tipo == 'textoenriquecido') data.tipo = 'textoEnriquecido'; // traductor para controles mal guardados
			var subclase = $.string.capitalize(data.tipo);
			if(Clase[subclase]) Clase = Clase[subclase];
			return new Clase(data, parent);
		},

		createSubClass: function( tipo, mappingOptions, insertPoint ){
			var nombre = $.string.capitalize( $.string.dasherize(tipo, ' '))
				, nombreClase = $.string.capitalize( tipo )
				, mappingOptions = $.extend({}, mappingOptions )
				, insertPoint = insertPoint || this;

			return insertPoint[ nombreClase ] = this.extend({
				nombre	: ko.observable( nombre ),
				prototype: {
					_setMappeable: function(){
						var mappeable = $.extendNoDeepCopyArray(true, {tipo: tipo}, mappingOptions.mappeable);
						this._parent();
						this._mergeMappeable( mappeable );
					},

					_setDefaults: function(){
						var defaults = mappingOptions.defaults;
						this._parent();
						this._mergeDefaults(defaults);
					},

					_setMapping: function(){
						var mapping = mappingOptions.mapping;
						this._parent();
						this._mergeMapping(mapping);
					}
				}
			});
		},

		collectInvisibleElements: function( root ){
			var collection = [];
			root.navigateTree( function( snippet ){
				if( snippet.estaOculto() ) collection.push( snippet );
			});
			return collection;
		},

		tipoGaleriaOptions: [
			{text: 'snippetsback:opciones.tipogaleria.grilla', value: 'galeriaModal'},
			{text: 'snippetsback:opciones.tipogaleria.slider', value: 'sliderModal'}
		],

		tipoInputOptions: [
			{text: 'snippetsback:opciones.tipocampo.texto', value: 'text'},
			{text: 'snippetsback:opciones.tipocampo.email', value: 'email'},
			{text: 'snippetsback:opciones.tipocampo.numero', value: 'number'},
			{text: 'snippetsback:opciones.tipocampo.fecha', value: 'date'},
			{text: 'snippetsback:opciones.tipocampo.contrasena', value: 'password'}
		],

		alignOptions: [
			{text: '', value: ''},
			{text: 'izquierda', value: 'left'},
			{text: 'derecha', value: 'right'},
			{text: 'centrado', value: 'center'},
			{text: 'justificado', value: 'justify'}
		],

		repeatOptions: [
			{text: 'snippetsback:opciones.repeat.no_repetir', value: 'no-repeat'},
			{text: 'snippetsback:opciones.repeat.repetir', value: 'repeat'},
			{text: 'snippetsback:opciones.repeat.repetir_horizontal', value: 'repeat-x'},
			{text: 'snippetsback:opciones.repeat.repetir_vertical', value: 'repeat-y'}
		],

		hrefOptions: [
			{text: 'snippetsback:opciones.href.url', value: 'url'},
			{text: 'snippetsback:opciones.href.una_pagina_de_mi_sitio', value: 'pagina'},
			{text: 'snippetsback:opciones.href.radio_online', value: 'stream'}
		],

		pullOptions: [
			{text: 'Ninguno', value: ''},
			{text: 'Izquierda', value: 'left'},
			{text: 'Derecha', value: 'right'}
		],

		horizontalExtendOptions: [
			{text: 'Ninguno', value: ''},
			{text: 'Izquierda', value: 'extendleft'},
			{text: 'Derecha', value: 'extendright'},
			{text: 'Ambos', value: 'extendfull'}
		],

		estiloBotonOptions: [
			{text: 'snippetsback:opciones.estiloboton.normal', value: ''},
			{text: 'snippetsback:opciones.estiloboton.primario', value: 'btn-primary'},
			{text: 'snippetsback:opciones.estiloboton.informacion', value: 'btn-info'},
			{text: 'snippetsback:opciones.estiloboton.exito', value: 'btn-success'},
			{text: 'snippetsback:opciones.estiloboton.advertencia', value: 'btn-warning'},
			{text: 'snippetsback:opciones.estiloboton.peligro', value: 'btn-danger'},
			{text: 'snippetsback:opciones.estiloboton.invertido', value: 'btn-inverse'},
			{text: 'snippetsback:opciones.estiloboton.enlace', value: 'btn-link'}
		],

		tamanoBotonOptions: [
			{text: 'snippetsback:opciones.tamanoboton.grande', value: 'btn-large'},
			{text: 'snippetsback:opciones.tamanoboton.normal', value: ''},
			{text: 'snippetsback:opciones.tamanoboton.pequeno', value: 'btn-small'},
			{text: 'snippetsback:opciones.tamanoboton.miniatura', value: 'btn-mini'}
		],

		fuenteOptions: [
			{text: 'Predeterminada', value: ''},
			{text: 'Open Sans Condensed', value: 'Open Sans Condensed'},
			{text: 'Droid Sans', value: 'Droid Sans'},
			{text: 'Lato', value: 'Lato'},
			{text: 'Arvo', value: 'Arvo'},
			{text: 'PT Sans', value: 'PT Sans'},
			{text: 'Ubuntu', value: 'Ubuntu'},
			{text: 'Josefin Slab', value: 'Josefin Slab'},
			{text: 'Droid Serif', value: 'Droid Serif'},
			{text: 'Oswald', value: 'Oswald'},
			{text: 'Abril Fatface', value: 'Abril Fatface'},
			{text: 'Kaushan Script', value: 'Kaushan Script'},
			{text: 'Kavoon', value: 'Kavoon'},
			{text: 'Orbitron', value: 'Orbitron'},
			{text: 'Signika', value: 'Signika'}
		],

		widthExtendOptions: [
			{text: 'snippetsback:campos.automatico', value: ''},
			{text: 'snippetsback:valores_campos.ajustar_fondo_al_ancho_de_la_pantalla', value: 'background-full'},
			{text: 'snippetsback:valores_campos.ajustar_contenido_al_ancho_de_la_pantalla', value: 'full'},
			{text: 'snippetsback:valores_campos.ajustar_al_contenido_del_sitio', value: 'content'},
			{text: 'Personalizado', 'value'	: 'max-width'}
		],

		/**
		 * para obtener los conos de font awesome:
		 * text = $('a', '.row.the-icons').map( function(index, i){ icon = $.trim($(i).text()); if( icon.substr(-7)=='(alias)') { return null};  return icon  }).toArray(); arr = []; $.each(text, function(i,icon){ if(icon) arr.push(icon)})
		 */

		iconNameOptions: [
			"icon-compass","icon-collapse","icon-collapse-top","icon-expand","icon-eur","icon-gbp","icon-usd","icon-inr",
			"icon-jpy","icon-cny","icon-krw","icon-btc","icon-file","icon-file-text","icon-sort-by-alphabet","icon-sort-by-alphabet-alt",
			"icon-sort-by-attributes","icon-sort-by-attributes-alt","icon-sort-by-order","icon-sort-by-order-alt","icon-thumbs-up",
			"icon-thumbs-down","icon-youtube-sign","icon-youtube","icon-xing","icon-xing-sign","icon-youtube-play","icon-dropbox",
			"icon-stackexchange","icon-instagram","icon-flickr","icon-adn","icon-bitbucket","icon-bitbucket-sign","icon-tumblr",
			"icon-tumblr-sign","icon-long-arrow-down","icon-long-arrow-up","icon-long-arrow-left","icon-long-arrow-right","icon-apple",
			"icon-windows","icon-android","icon-linux","icon-dribbble","icon-skype","icon-foursquare","icon-trello","icon-female","icon-male",
			"icon-gittip","icon-sun","icon-moon","icon-archive","icon-bug","icon-vk","icon-weibo","icon-renren","icon-adjust","icon-anchor",
			"icon-archive","icon-asterisk","icon-ban-circle","icon-bar-chart","icon-barcode","icon-beaker","icon-beer","icon-bell","icon-bell-alt",
			"icon-bolt","icon-book","icon-bookmark","icon-bookmark-empty","icon-briefcase","icon-bug","icon-building","icon-bullhorn","icon-bullseye",
			"icon-calendar","icon-calendar-empty","icon-camera","icon-camera-retro","icon-certificate","icon-check","icon-check-empty",
			"icon-check-minus","icon-check-sign","icon-circle","icon-circle-blank","icon-cloud","icon-cloud-download","icon-cloud-upload","icon-code","icon-code-fork",
			"icon-coffee","icon-cog","icon-cogs","icon-collapse","icon-collapse-alt","icon-collapse-top",
			"icon-comment","icon-comment-alt","icon-comments","icon-comments-alt","icon-compass","icon-credit-card","icon-crop","icon-dashboard",
			"icon-desktop","icon-download","icon-download-alt","icon-edit","icon-edit-sign","icon-ellipsis-horizontal","icon-ellipsis-vertical",
			"icon-envelope","icon-envelope-alt","icon-eraser","icon-exchange","icon-exclamation","icon-exclamation-sign","icon-expand","icon-expand-alt",
			"icon-external-link","icon-external-link-sign","icon-eye-close","icon-eye-open","icon-facetime-video","icon-female","icon-fighter-jet",
			"icon-film","icon-filter","icon-fire","icon-fire-extinguisher","icon-flag","icon-flag-alt","icon-flag-checkered","icon-folder-close",
			"icon-folder-close-alt","icon-folder-open","icon-folder-open-alt","icon-food","icon-frown","icon-gamepad","icon-gift","icon-glass","icon-globe",
			"icon-group","icon-hdd","icon-headphones","icon-heart","icon-heart-empty","icon-home","icon-inbox","icon-info","icon-info-sign","icon-key",
			"icon-keyboard","icon-laptop","icon-leaf","icon-legal","icon-lemon","icon-level-down","icon-level-up","icon-lightbulb","icon-location-arrow",
			"icon-lock","icon-magic","icon-magnet","icon-mail-reply-all","icon-male","icon-map-marker","icon-meh","icon-microphone","icon-microphone-off",
			"icon-minus","icon-minus-sign","icon-minus-sign-alt","icon-mobile-phone","icon-money","icon-moon","icon-move","icon-music","icon-off","icon-ok",
			"icon-ok-circle","icon-ok-sign","icon-pencil","icon-phone","icon-phone-sign","icon-picture","icon-plane","icon-plus","icon-plus-sign","icon-plus-sign-alt",
			"icon-print","icon-pushpin","icon-puzzle-piece","icon-qrcode","icon-question","icon-question-sign","icon-quote-left","icon-quote-right","icon-random",
			"icon-refresh","icon-remove","icon-remove-circle","icon-remove-sign","icon-reorder","icon-reply","icon-reply-all",
			"icon-resize-horizontal","icon-resize-vertical","icon-retweet","icon-road","icon-rocket","icon-rss","icon-rss-sign","icon-screenshot","icon-search",
			"icon-share","icon-share-alt","icon-share-sign","icon-shield","icon-shopping-cart","icon-sign-blank","icon-signal","icon-signin","icon-signout",
			"icon-sitemap","icon-smile","icon-sort","icon-sort-by-alphabet","icon-sort-by-alphabet-alt","icon-sort-by-attributes","icon-sort-by-attributes-alt",
			"icon-sort-by-order","icon-sort-by-order-alt","icon-sort-down","icon-sort-up","icon-spinner",
			"icon-star","icon-star-empty","icon-star-half","icon-star-half-empty","icon-subscript","icon-suitcase","icon-sun","icon-superscript","icon-tablet",
			"icon-tag","icon-tags","icon-tasks","icon-terminal","icon-thumbs-down","icon-thumbs-down-alt","icon-thumbs-up","icon-thumbs-up-alt","icon-ticket",
			"icon-time","icon-tint","icon-trash","icon-trophy","icon-truck","icon-umbrella","icon-unlock","icon-unlock-alt","icon-upload","icon-upload-alt","icon-user",
			"icon-volume-down","icon-volume-off","icon-volume-up","icon-warning-sign","icon-wrench","icon-zoom-in","icon-zoom-out","icon-btc","icon-cny","icon-eur","icon-gbp",
			"icon-inr","icon-jpy","icon-krw","icon-usd","icon-align-center","icon-align-justify","icon-align-left","icon-align-right","icon-bold","icon-columns",
			"icon-copy","icon-cut","icon-eraser","icon-file","icon-file-alt","icon-file-text","icon-file-text-alt","icon-font","icon-indent-left","icon-indent-right",
			"icon-italic","icon-link","icon-list","icon-list-alt","icon-list-ol","icon-list-ul","icon-paper-clip","icon-paste","icon-repeat","icon-save",
			"icon-strikethrough","icon-table","icon-text-height","icon-text-width","icon-th","icon-th-large","icon-th-list","icon-underline","icon-undo",
			"icon-unlink","icon-angle-down","icon-angle-left","icon-angle-right","icon-angle-up","icon-arrow-down","icon-arrow-left","icon-arrow-right","icon-arrow-up",
			"icon-caret-down","icon-caret-left","icon-caret-right","icon-caret-up","icon-chevron-down","icon-chevron-left","icon-chevron-right","icon-chevron-sign-down",
			"icon-chevron-sign-left","icon-chevron-sign-right","icon-chevron-sign-up","icon-chevron-up","icon-circle-arrow-down","icon-circle-arrow-left",
			"icon-circle-arrow-right","icon-circle-arrow-up","icon-double-angle-down","icon-double-angle-left","icon-double-angle-right","icon-double-angle-up",
			"icon-hand-down","icon-hand-left","icon-hand-right","icon-hand-up","icon-long-arrow-down","icon-long-arrow-left","icon-long-arrow-right","icon-long-arrow-up",
			"icon-backward","icon-eject","icon-fast-backward","icon-fast-forward","icon-forward","icon-fullscreen","icon-pause","icon-play","icon-play-circle",
			"icon-play-sign","icon-resize-full","icon-resize-small","icon-step-backward","icon-step-forward","icon-stop","icon-youtube-play","icon-adn","icon-android",
			"icon-apple","icon-bitbucket","icon-bitbucket-sign","icon-btc","icon-css3","icon-dribbble","icon-dropbox","icon-facebook","icon-facebook-sign",
			"icon-flickr","icon-foursquare","icon-github","icon-github-alt","icon-github-sign","icon-gittip","icon-google-plus","icon-google-plus-sign","icon-html5",
			"icon-instagram","icon-linkedin","icon-linkedin-sign","icon-linux","icon-maxcdn","icon-pinterest","icon-pinterest-sign","icon-renren","icon-skype",
			"icon-stackexchange","icon-trello","icon-tumblr","icon-tumblr-sign","icon-twitter","icon-twitter-sign","icon-vk","icon-weibo","icon-windows","icon-xing",
			"icon-xing-sign","icon-youtube","icon-youtube-play","icon-youtube-sign","icon-ambulance","icon-h-sign","icon-hospital","icon-medkit","icon-plus-sign-alt",
			"icon-stethoscope","icon-user-md"],

		iconSizeOptions: [
			{text: 'normal', value: ''},
			{text: '2x', value: '2x'},
			{text: '3x', value: '3x'},
			{text: '4x', value: '4x'}
		],

		iconRotateOptions: [
			{text: '0', value: ''},
			{text: '90', value: '90'},
			{text: '180', value: '180'},
			{text: '270', value: '270'}
		],

		iconFlipOptions: [
			{text: 'snippetsback:opciones.iconflip.invertir_horizontal'},
			{text: 'snippetsback:opciones.iconflip.invertir_vertical'}
		],

		imageScaleOptions: [
			{text: 'snippetsback:opciones.imagescale.encajar', value: 'best-fit'},
			{text: 'snippetsback:opciones.imagescale.rellenar', value: 'best-fill'}
		],

		nombre						: ko.observable(''),
		descripcion					: ko.observable(''),
		tituloVentanaEdicion		: ko.observable(''),
		tamanoVentanaEdicion		: 'large',
		marcaBlanca					: ko.observable(false),

		_lastUID					: 0,
		_uidIndex					: 0,
		createGUID: function(){
			return UUID.generate();
		},

		replaceUIDs: function( oldJSONData, changes ){
			var newJSONData = oldJSONData;
			$.each( changes, function( index, change ){
				if( change.old ){
					newJSONData = $.string.replace( newJSONData, change.old, change.new );
				}
			});
			return newJSONData;
		},


		prototype: {
			_mappeable: {
				tipo				: '',
				guid				: null,
				data: {
					pull		    : null,   // left || right,
					smartaffix	    : false,
					align		    : null, // left || center || right,
					oculto		    : false,
					href			: ''
				}
			},

			_defaults: {
				inlineBlock	: false,
				seleccionado: false,
				iluminado	: false,
				reordenando	: false,
				secondaryToolbarVisible: false,

				copiandoAlPortapapeles	: false,

				draggable	: true,
				removable	: true,
				selectable	: true,
				_nombre		: '',
				_descripcion	: '',
				icono		: '',

				idPagina	: null,
				resaltar	: false, // fue insertado en la pgina, no arrastrado,

				hasEditButtons	: false,

				uid			: null,

				fullscreen	: false
			},

			_setMapping: function(){
				var self = this;
				this._parent();
				this._mergeMapping({
					href	: {
						create	: function( options ){
							self.enlace = new tiendasimple.helpers.EnlaceSnippet( { data: options.data } );
							return self.enlace.data;
						}
					}
				});
			},

			init: function(data, parent){
				this._parent.apply(this, arguments);

				if( data && data.data && data.data.uid ){
					delete data.data.uid;
				}

				this.uid( ko.utils.createUID() );
				if( !this.guid() ){
					this._createDataUID();
				}

				this._excludedPropertiesFromReset = [ '__parentSnippet', '_parentContainer' ];

				this.__parentSnippet = ko.observable();
				this.setParentSnippet( parent );

				this.nombre = ko.computed({
					read: function(){
						return this._nombre() || i18n.kot( this.constructor.nombre() );
					},
					write: function( nuevoNombre ){
						this._nombre( nuevoNombre );
					}
				}, this);

				this.descripcion = ko.computed({
					read: function(){
						return this._descripcion() || i18n.kot( this.constructor.descripcion() );
					},
					write: function( nuevaDescripcion ){
						this._descripcion( nuevaDescripcion );
					}
				}, this);



				this.tituloVentanaEdicion = ko.computed(function(){
					return this.constructor.tituloVentanaEdicion();
				}, this);


				this.seleccionado.extend({editable: false});
				this.makeEditable ( ['data'] );
				if( this.data.href ) this._createHrefLogic();
			},

			destroy: function(){
				var parent = this._parentContainer;
				if( parent ){
					parent.quitarSnippet( this );
				}
				this._parent.apply( this, arguments );
				this.setParentSnippet( null );
			},

			clone: function(){
				var data = this.toJS();
				var clone = new this.constructor( data );

				/*
				var snippetsAModificar = clone.obtenerSnippets();
				snippetsAModificar.push( clone );

				if( !( root instanceof namespace.Snippet )){
					root = this.getRootSnippet() || this;
				}
				root.replaceUID( snippetsAModificar );
				*/
				/*

				clone.navigateTree( function( item ){
					item._createDataUID();
				});
				*/

				//var clone = this._parent.apply(this, arguments);
				return clone;
			},

			_createDataUID: function(){
				var newUID = this.constructor.createGUID();
				this.guid( newUID );
				return newUID;
			},

			// reemplaza el UID de un grupo de snippets actualizando todos los lugares donde se utilizaba
			/*
			createGUID: function( otherSnippets ){
				otherSnippets = $.toArray( otherSnippets );
				var result = [];
				$.each( otherSnippets, function( index, snippet ){
					var oldUID = snippet.guid();
					var newUID = snippet._createDataUID();
					result.push({old: oldUID, new: newUID});
				});
			},
			*/

			createGUID: function(){
				var result = [];
				var oldUID = this.guid();
				var newUID = this._createDataUID();
				result.push({'old': oldUID, 'new': newUID});
				$.each( this.getRelatedSnippets(), function(index, snippet){
					result = result.concat( snippet.createGUID() );
				});

				return result;
			},

			replaceUIDs: function( changes ){
				var oldJSONData = this.toJSON();
				var newJSONData = this.constructor.replaceUIDs( oldJSONData, changes );
				if( newJSONData != oldJSONData ) this.update( newJSONData );
			},

			//////////////////////////////////////////

			/**
			 * @returns {Array}
			 */
			getEventList: function(){
				return [];
			},

			getEventActionList: function(){
				return [];
			},

			addEventBinding: function(){
				var eventBinding = new namespace.SnippetEventBinding();
				this.data.eventBindings.push( eventBinding );
			},

			removeEventBinding: function( eventBinding ){
				this.data.eventBindings.remove( eventBinding );
				//console.debug( arguments );
			},

			bindEvents: function ( $element ){
				var self = this;
				if( this.data.eventBindings ){
					$.each( this.data.eventBindings(), function( index, eventBinding ){
						var eventName = 'snippet-' + eventBinding.eventName() + '.' + eventBinding.emitterGUID() + '.' + self.guid();
						$(document).on( eventName, self.onEvent.bind(self, eventBinding));
					});
					ko.utils.domNodeDisposal.addDisposeCallback( $element, function(){
						$(document).off( self.guid() );
					});
				}
			},

			onEvent: function( eventBinding ){
				var method = 'onEventAction' + $.string.capitalize( eventBinding.action() );
				this[ method ] && this[ method ] ( eventBinding );
			},

			triggerEvent: function( eventName ){
				$(document).triggerHandler('snippet-' + eventName + '.' + this.guid() );
			},

			//////////////////////////////////////////

			cssAlign: function(){
				var result;
				switch(this.data.align()){
					case 'left':
						result = 'align-left';
						break;
					case 'right':
						result = 'align-right';
						break;
					case 'center':
						result = 'align-center';
						break;
				}
				return result;
			},

			css: function(){
				var css = [];
				switch(this.data.pull()){
					case 'left':
						css.push('pull-left');
						break;
					case 'right':
						css.push('pull-right');
						break;
				}

				css.push(this.cssAlign());

				return css.join(' ');
			},

			templateName: function(){
				return 'template-' + this.tipo();
			},

			templateOfflineName: function(){
				return this.templateName() + '-offline';
			},

			templateEditName: function(){
				return this.templateName() + '-edit';
			},

			templateEditButtonsName: function(){
				return this.templateName() + '-edit-buttons';
			},

			hasEditWindow: function(){
				return $('#' + this.templateEditName()).length;
			},

			hasSecondaryToolbar: function(){
				return $('#' + this.templateSecondaryToolbarName()).length;
			},

			templateSecondaryToolbarName: function(){
				return this.templateName() + '-secondary-toolbar';
			},

			hasSidebar: function(){
				return $('#' + this.templateSidebarName()).length;
			},

			templateSidebarName: function(){
				return this.templateName() + '-sidebar';
			},

			////////////////////////////////////////////////////////////////////

			_getStyleMethodNameByRole: function( role ){
				var methodName = '_getStyleByRole' + $.string.capitalize($.camelCase(role));
				if($.string.startsWith(role, '-')) methodName = '-' + methodName;
				return methodName;
			},

			_getStyleMethodByRole: function( role ){
				var methodName = this._getStyleMethodNameByRole( role );
				var result = this[methodName];
				return result && result.bind(this);
			},

			getStyleByRoles: function(element){
				var self = this;
				var roles = $(element).attr('data-role');
				var $context = ko.contextFor(element);
				var aRoles = $.trim(roles).split(/\s+/g);

				var result = {};
				$.each( aRoles, function(index, role){
					var method = self._getStyleMethodByRole( role );
					if( method ){
						$.extend( result, method($context) );
					}
				});

				return result;
			},

			////////////////////////////////////////////////////////////////////

			obtenerIdPaginaDeHref: function(){
				var idPagina;

				try{
					idPagina = ko.utils.parseJson( this.data.href() ).idPagina;
				} catch (e) {
				}
				return idPagina;
			},


			_createHrefLogic: function(){
				return;
			},

			////////////////////////////////////////////////////////////////////

			describeTree: function( result ){
				return { tipo: this.tipo() };
			},

			getPath: function( documentRoot ){
				var path = []
					, reversePath
					, result = []
					, node = this
					, position = [];

				while( node ){
					path.push( node );
					node = node.getParentSnippet();

					if( node && ( ko.unwrap ( node.documentRoot ) || node == documentRoot ) ){
						node = null;
					}
				}

				reversePath = path.reverse();

				ko.utils.arrayForEach( reversePath, function( snippet ){
					position.push( snippet.indexInParentSnippet() + 1 );
					node = {
						'data'		: snippet,
						'position'	: position.join('-')
					};
					result.push( node );
				});

				return result;
			},

			getPathAsSnippetArray: function( documentRoot ){
				return $.pluckCollection( this.getPath( documentRoot ), 'data' );
			},

			////////////////////////////////////////////////////////////////////

			setParentSnippet: function ( parent ){
				this._parentContainer = parent;
				this.__parentSnippet( parent );
			},

			getParentSnippet: function(){
				return this.__parentSnippet();
			},

			hasParentSnippet: function(){
				return !!this._parentContainer;
			},

			getParentSnippets: function(){
				var ret = []
					, parent = this;

				while( parent.hasParentSnippet() ){
					parent = parent.getParentSnippet();
					ret.push( parent );
				}
				return ret;
			},

			getRootSnippet: function(){
				return $.arrayLast(this.getParentSnippets());
			},

			indexInParentSnippet: function(){
				var parent = this.getParentSnippet()
					, index = -1;
				if ( parent ){
					index = parent.data.snippets.indexOf( this );
				}
				return index;
			},

			_createIterator: function( iterator ){
				var theClass;
				if ( typeof iterator['inherits'] === 'function' ){
					theClass = iterator;
					iterator = function( snippet ){
						return snippet instanceof theClass;
					};
				}
				return iterator;

			},

			is: function( iterator ){
				var snippet = this
					, parent
					, result = false
					, theClass
					, iterator = this._createIterator( iterator );

				return iterator( this );
			},

			isOrIsChildOf: function ( iterator, documentRoot ){
				return this.is( iterator ) || this.isChildOf( iterator, documentRoot );
			},

			isOrHasChild: function( iterator ){
				return this.is( iterator ) || ( this.tieneSnippet && this.tieneSnippet( iterator ) );
			},

			isChildOf: function( iterator, documentRoot ){
				var snippet = this
					, parent
					, result = false
					, theClass;

				if( iterator ){
					iterator = this._createIterator( iterator );

					while ( ( parent = snippet.getParentSnippet() ) && ( documentRoot ? parent != documentRoot : !ko.unwrap( parent.documentRoot ) ) ) {
						if( parent.is( iterator ) ){
							result = true;
							break;
						} else {
							snippet = parent;
						}
					}
				}

				return result;
			},

			// indica si un snippet puede ser hijo o hijo no inmediato de otro
			/**
			 * un snippet puede ser hijo de otro si:
			 * puede ser hijo de
			 * @param snippet
			 * @returns {boolean}
			 */

			canBeChildOfSnippet: function( snippet ) {
				var self = this;
				var result = true;
				var requiredParentClasses = this._getRequiredParentClasses();
				var snippetEsContenedor = snippet instanceof namespace.Snippet.Contenedor;
				result = result && snippetEsContenedor;
				if (snippetEsContenedor) {
					var snippetEsHijoMio = snippet.isChildOf(function (parent) {
						return parent == self;
					});
					result = result && !snippetEsHijoMio;

					if( result ){
						result = result && snippet.isOrHasChild( function ( parentChild ){
							var path = parentChild.getPathAsSnippetArray();
							return self.canBeChildOfPath( path );
						});
					}
				}

				return result;
			},


					// indica si un snippet puede ser hijo inmediato de otro
			canBeInmediateChildOfSnippet: function( snippet ){
				//return snippet.canContainChildSnippet && snippet.canContainChildSnippet( this ) && this.canBeChildOfSnippet( snippet );
				var canBe = snippet.canContainChildSnippet && snippet.canContainChildSnippet( this );
				if( canBe ){
					var parents = snippet.getParentSnippets();
					parents.unshift( snippet );
					canBe = this.canBeChildOfPath( parents );
				}
				return canBe;
			},

			/**
			 * indica si este snippet puede ser hijo de un path. Puede sobreescribirse
			 * @param path
			 * @returns {*|boolean}
			 */
			canBeChildOfPath: function ( path ){
				var result = this._canBeChildOfClasses( path );
				return result;
			},

			/**
			 * indica si este snippet puede ser hijo de un path dada las clases padre admitidas en getAllowedParentClasses
			 * @param path
			 * @returns {boolean}
			 */
			_canBeChildOfClasses: function( path ){
				var path = $.extend([], path);
				var canBe = true;
				canBe = canBe && this._hasAllowedParentClasses( path );
				canBe = canBe && this._hasBannedParentClasses( path );
				canBe = canBe && this._hasRequiredParentClasses( path );

				return canBe;
			},

			_hasAllowedParentClasses: function( path ){
				var allowedParentClasses = this._getAllowedParentClasses();
				var canBe = true;
				if( allowedParentClasses ){
					var bannedParent = ko.utils.arrayFirst( path, function( snippet ){
						var isAllowed = ko.utils.arrayFirst( allowedParentClasses, function( allowedParentClass ){
							return snippet.constructor == allowedParentClass;
						});
						return !isAllowed;
					});

					canBe = !bannedParent;
				}
				return canBe;
			},

			_hasBannedParentClasses: function( path ){
				var bannedParentClasses = this._getBannedParentClasses();
				var canBe = true;
				if( bannedParentClasses ){
					var bannedParent = ko.utils.arrayFirst( path, function( snippet ){
						var isBanned = ko.utils.arrayFirst( bannedParentClasses, function( bannedParentClass ){
							return snippet instanceof bannedParentClass;
						});
						return isBanned;
					});

					canBe = canBe && !bannedParent;
				}
				return canBe;
			},

			_hasRequiredParentClasses: function( path ){
				var canBe = true;
				var requiredParentClasses = this._getRequiredParentClasses();
				if( requiredParentClasses ){
					var requiredParent = ko.utils.arrayFirst( path, function( snippet ){
						var isRequired = ko.utils.arrayFirst( requiredParentClasses, function( requiredParentClass ){
							return snippet.constructor == requiredParentClass;
						});
						return isRequired;
					});
					canBe = canBe && !!requiredParent;
				}
				return canBe;
			},

			_getAllowedParentClasses: function(){
				// sobreescribir esta funcin para devolver un array de clases permitidas para ser padres de este snippet
				return null;
			},

			_getBannedParentClasses: function() {
				// sobreescribir esta funcin para devolver un array de clases prohibidas para ser padres de este snippet
				return null;
			},

			_getRequiredParentClasses: function(){
				// sobreescribir esta funcin para devolver un array de clases requeridas para ser padres de este snippet. Al menos una de estas clases debe estar en el path padre
				return null;
			},

			navigateTree: function( iterator ){
				return iterator && iterator( this );
			},

			getTreeNodeDescription: function(){
				return '<' + ( ko.unwrap( this.nombre ) || ko.unwrap( this.tipo ) ) + '>';
			},

			getTreeNodeDescriptionHtml: function(){
				return $('<i>').html( $.string.encodeHTML( this.getTreeNodeDescription() ) ).outerHTML();
			},

			getContextDescription: function(){
				return ko.unwrap(this.nombre) || ko.unwrap(this.tipo);
			},

			isLeaf: function(){
				return !( this instanceof namespace.Snippet.Contenedor );
			},

			tieneIcono: function(){
				return true;
			},

			////////////////////////////////////////////////////////////////////

			fixColor: function( color ){
				var result;
				if( color instanceof $.xcolor ){
					result = color.getCSS();
				} else if (color instanceof $.ShorthandValue ){
					result = color.toString();
				} else {
					var xcol = color && $.xcolor.test( color );
					result = xcol && xcol.getCSS();
				}

				return result;
			},

			////////////////////////////////////////////////////////////////////

			esEliminable: function( $context ){
				return this.removable();
			},

			esDuplicable: function( $context ){
				return true; // por ahora todo snippet es duplicable
			},

			esCopiableAPortapapeles: function( $context ){
				return true; // por defecto todo snippet puede copiarse al portapapeles
			},

			canBeIndicated: function(){
				return true;
			},

			esIluminable: function(){
				return true;
			},

			estaOculto: function(){
				var result = false;
				if( this.data.oculto() ){
					result = true;
				} else {
					if( typeof this.cuantosDispositivosVisibles == 'function' ){
						if( this.cuantosDispositivosVisibles() < 3 ){
							result = true;
						}
					}
				}
				return result;
			},

			contentIsDraggable: function(){
				return true;
			},

			////////////////////////////////////////////////////////////////////

			fixBtnCss: function( css ){
				var availableCSSs = ['btn-primary', 'btn-info', 'btn-success', 'btn-warning', 'btn-danger', 'btn-inverse', 'btn-link']
					, found;

				css = css || '';

				if(this.hasBtnClass( css )){
					found = ko.utils.arrayFirst( availableCSSs, function(buttonCSS){
						return css.indexOf(buttonCSS)!= -1;
					});

					if(!found && css.indexOf('btn-default') == -1){
						css += " btn-default";
					}
				}

				return $.trim( css );
			},

			hasBtnClass: function( css ){
				var re = /(^btn$)|(^btn )|( btn )|( btn$)/ig;
				return css && re.test(css);
			},

			sortable: function(){
				return true;
			},

			getInfo: function(){
				return '';
			},

			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			//
			/**
			 * indica la complegidad de este snippet
			 * @returns {number}
			 */

			_getComplexityValue: function(){
				return 1;
			},

			getComplexityValue: function(){
				return this.data.oculto() ? 0 : this._getComplexityValue();
			},

			getComplexity: function( deep ) {
				deep = deep || 1;
				var result = {
					count	: 1,
					value	: this.getComplexityValue(),
					depth	: deep
				};

				return result;
			},

			getRelatedSnippets: function(){
				return [];
			}

		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Contenedor = namespace.Snippet.extend({
		nombre		: ko.observable( 'snippets:snippet.contenedor.grupo_de_elementos' ),
		descripcion	: ko.observable( 'snippets:snippet.contenedor.agrupa_varios_elementos_para_luego_moverlos_de_lugar_en_conjunto' ),

		prototype: {
			init: function () {
				this._parent.apply(this, arguments);
				////////////////////////////////////////////////////////////////////
				this.data.snippets.extend({
					validChildren: true
				});

				this.contentIsEmpty = ko.computed(function () {
					return this.data.snippets().length === 0;
				}, this, {deferEvaluation: true});

				this._createValidations();
			},

			_setMappeable: function () {
				this._parent();
				this._mergeMappeable({
					tipo: 'contenedor',
					data: {
						snippets: []
					}
				});
			},

			_setDefaults: function () {
				this._parent();
				this._mergeDefaults({
					icono: 'icon-snippet-group',
					documentRoot: false
				});
			},

			_setMapping: function () {
				var self = this;
				this._parent();
				this._mergeMapping({
					snippets: {
						create: function (options) {
							var data = options.data;
							return namespace.Snippet.createInstance(data, self);
						},

						key: namespace.Snippet.options.useMappingKey && function (data) {
							return ko.unwrap(data.data && data.guid);
						}
					}
				});
			},

			insertarSnippet: function (snippet, posicion) {
				if (snippet.canBeChildOfSnippet(this)) {
					/////////////////
					var root = this.getRootSnippet() || this;
					var snippetInsertado = root.obtenerSnippet( snippet );
					if( snippetInsertado ){
						snippetInsertado.quitarSnippetDePadre();
					}
					/////////////////

					if (posicion === undefined) this.data.snippets.unshift(snippet);
					else {
						this.data.snippets.splice(posicion, 0, snippet);
					}
					snippet.setParentSnippet(this);
					var newUIDs = snippet.createGUID();
					snippet.replaceUIDs( newUIDs );
				} else {
					window.console && console.warn(snippet.tipo(), 'no puede ser hijo de este', this.tipo());
				}
			},

			quitarSnippet: function (snippet) {
				this.data.snippets.remove(snippet);
			},

			quitarSnippetDePadre: function(){
				var parent = this.getParentSnippet();
				if( parent ){
					parent.quitarSnippet( this );
				}
			},

			hasInmediateChildSnippet: function (snippet) {
				return this.data.snippets().indexOf(snippet) !== -1;
			},

			canBeChildOfPath: function (path) {
				var canBe = this._parent.apply(this, arguments);
				if (canBe) {
					path = $.extend([], path);
					path.unshift(this);
					var childCantBeChildOfPath = ko.utils.arrayFirst(this.data.snippets(), function (snippet) {
						return !snippet.canBeChildOfPath(path);
					});
					canBe = !childCantBeChildOfPath;
				}
				return canBe;
			},

			/*
			 canBeInmediateChildOfSnippet: function( snippet ){
			 var canBe = this._parent.apply( this, arguments );
			 if( canBe ){
			 this.navigateSubtree( function( child ){
			 canBe = child.canBeChildOfSnippet( snippet );
			 return canBe;
			 });
			 }
			 return canBe;
			 },

			 canBeInmediateChildOfSnippet: function( snippet ){
			 var canBe = this._parent.apply( this, arguments );
			 if( canBe ){
			 var parents = snippet.getParentSnippets();
			 parents.unshift( snippet );
			 canBe = this.canBeChildOfPath( );
			 }
			 return canBe;
			 },*/

			canContainChildSnippet: function (snippet) {
				return true;
			},

			describeTree: function (result) {
				var result = this._parent.apply(this, arguments);
				result.children = $.map(this.data.snippets(), function (snippet) {
					return snippet.describeTree();
				});
				return result;
			},

			navigateTree: function (iterator) {
				this._parent.apply(this, arguments);
				return this.navigateSubtree(iterator);
			},

			navigateSubtree: function (iterator) {
				var result;
				$.each(this.data.snippets(), function (index, snippet) {
					result = snippet.navigateTree(iterator);
					return result;
				});
				return result;
			},

			////////////////////////////////////////////////////////////////////

			destroy: function () {
				this.data.snippets.destroyItems();
				this._parent.apply(this);
			},

			droppable: function () {
				return true;
			},

			////////////////////////////////////////////////////////////////////
			obtenerSnippet: function (iterator) {
				var result = null;
				if (iterator instanceof namespace.Snippet) {
					var otherSnippet = iterator;
					iterator = function (snippet) {
						return snippet == otherSnippet;
					}
				}

				this.navigateSubtree(function (snippet) {
					if (iterator(snippet)) {
						result = snippet;
						return false;
					}
				});
				return result;
			},

			tieneSnippet: function (iterator) {
				var result = false;
				return !!this.obtenerSnippet(iterator);
				return result;
			},

			obtenerSnippets: function (callback) {
				var result = [];
				if (!callback) callback = function (i) {
					return i
				};
				this.navigateSubtree(function (snippet) {
					if (callback(snippet)) result.push(snippet);
				});
				return result;
			},


			obtenerSnippetsDeTipo: function (tipo) {
				var result = [];
				this.navigateSubtree(function (snippet) {
					if (snippet.tipo() === tipo) result.push(snippet);
				});
				return result;
			},

			obtenerSnippetPorGUID: function (uid) {
				return this.obtenerSnippet(function (snippet) {
					return ko.unwrap(snippet.guid) == uid;
				});
			},

			obtenerSnippetsGUIDs: function () {
				var snippets = this.obtenerSnippets();
				return $.map(snippets, function (snippet) {
					return ko.unwrap(snippet.guid)
				});
			},

			obtenerSnippetsConGUIDDuplicados: function ( options ) {
				var snippets = this.obtenerSnippets(null, options );
				var hash = {};
				var uids = [];
				$.each(snippets, function (index, snippet) {
					var uid = ko.unwrap(snippet.guid);
					if (uid) {
						if (!hash[uid]) {
							hash[uid] = [];
						}
						hash[uid].push(snippet);
						if (hash[uid].length > 1) {
							uids.push({'uid': uid, 'snippets': hash[uid]});
						}
					}
				});
				var snippets = [];
				$.each(uids, function (index, uid) {
					snippets = snippets.concat(uid.snippets);
				});
				var result = {
					'uids': uids,
					'snippets': snippets
				}
				return result;
			},

			obtenerSnippetsEmisoresDeEventos: function(){
				var result = [];
				this.navigateSubtree( function( snippet ){
					if( snippet.getEventList().length > 0 ){
						result.push( snippet );
					}
				});
				return result;
			},

			obtenerSnippetsDeTipoImagen: function () {
				var result = [];
				this.navigateSubtree(function (snippet) {
					if (snippet.tipo() === 'imagen') result.push(snippet);
					else if (snippet.tipo() === 'caja' && snippet.data.backgroundImageSnippet.data.id()) {
						result.push(snippet.data.backgroundImageSnippet);
					}
				});
				return result;

			},

			tieneMasDeUnaImagen: function () {
				var count = 0;
				this.navigateSubtree(function (snippet) {
					if (snippet.tipo() === 'imagen') count++;
					if (count > 1) return false;
				});
				return count > 1;
			},

			tieneImagenesIgualDimension: function () {
				var _width, _height, _tipoEscala, result = false;
				this.navigateSubtree(function (snippet) {
					if (snippet.tipo() === 'imagen') {
						var width = snippet.data.width();
						var height = snippet.data.height();
						var tipoEscala = snippet.data.tipoEscala();
						if (_width && _height && _tipoEscala) {
							result = ( _width == width && _height == height && _tipoEscala == tipoEscala );
							return result;
						} else {
							_width = width;
							_height = height;
							_tipoEscala = tipoEscala;
						}
					}
				});
				return result;

			},

			igualarDimensionesImagenes: function (width, height, tipoEscala) {
				tipoEscala = tipoEscala || 'crop';
				if (!width && !height) {
					this.navigateSubtree(function (snippet) {
						if (snippet.tipo() === 'imagen') {
							width = snippet.data.width.peek();
							height = snippet.data.height.peek();
							//tipoEscala = snippet.data.tipoEscala.peek();
							return !( width && height );
						}
					});
				}

				if (width && height && tipoEscala) {
					this.navigateSubtree(function (snippet) {
						if (snippet.tipo() === 'imagen') {
							//console.debug( snippet.toJSON() );
							/*
							 if( !$.isEmptyVal( width ) ) snippet.data.width( width );
							 if( !$.isEmptyVal( height ) ) snippet.data.height( height );
							 if( !$.isEmptyVal( tipoEscala ) ) snippet.data.tipoEscala( tipoEscala );
							 */
							snippet.update({data: {width: width, height: height, tipoEscala: tipoEscala}});
						}
					});
				}
			},

			getFlexJustifyContent: function () {
				return {
					'left': 'flex-start',
					'right': 'flex-end',
					'center': 'center'
				}[ko.unwrap(this.data.align)];
			},

			tieneSnippetConAltoEnPorcentaje: function () {
				return this.tieneSnippet(function (snippet) {
					return snippet.data.height && snippet.data.height.unit && snippet.data.height.unit() == '%';
				})
			},

			//////////////////////////////

			getComplexity: function (deep) {
				deep = deep || 1;
				var result = {
					value: this.getComplexityValue(),
					count: 1,
					depth: deep,
					score: 0
				};

				if (!this.data.oculto()) {
					var newDeep = deep + 1;
					var maxDepth = newDeep;
					$.each(this.data.snippets(), function (index, snippet) {
						var partialResult = snippet.getComplexity(newDeep);
						maxDepth = Math.max(maxDepth, partialResult.depth || newDeep);
						result.count += partialResult.count;
						result.value += partialResult.value;
					});
					result.depth = maxDepth;
					var partialDepth = maxDepth - deep;
					var depthScore = ( Math.pow(1 + ( ( partialDepth  ) / 6 ), 6));
					result.score = result.value + depthScore;
				}

				return result;
			},

			//////////////////////////////

			getRelatedSnippets: function(){
				return $.extend([], this.data.snippets());
			}

		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Columna = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.columna.columna'),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'columna',
					data	: {
						span	: 1
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			indexInParentSnippet: function(){
				var parent = this.getParentSnippet()
					, index = -1;
				if ( parent ){
					index = parent.data.snippets.indexOf( this );
				}
				return index;
			},

			tieneIcono: function(){
				return false;
			},

			getTreeNodeDescription: function(){
				return '<' + ko.unwrap( this.nombre ) + ' ' + ( this.indexInParentSnippet() + 1 ) + '>'
			},

			droppable: function(){
				return true;
			},

			sortable: function(){
				return false;
			},

			esIluminable: function(){
				return false;
			},

			onElementResize: function(){
				//	console.debug('onColumnaResize');
			},

			getContextDescription: function(){
				var description = this._parent.apply( this, arguments )
					, parentSnippet = this.getParentSnippet()
					, result = [];

				result.push(description);
				if( parentSnippet ) result.push( this.indexInParentSnippet() + 1 );

				return result.join(" ");
			}

		}
	});

	namespace.Snippet.Fila = namespace.Snippet.Contenedor.extend({
		nombre		: ko.observable( 'snippets:snippet.columnas.columnas' ),
		descripcion	: ko.observable( 'snippets:snippet.columnas.divide_un_espacio_en_columnas_y_coloca_elementos_en_cada_una_de_ellas' ),

		prototype: {
			init: function(){
				
				this._parent.apply(this, arguments);
				this._createComputed();

				this._fixLegacySpanValues();

				this.resizableOptions = {
					grid		: ko.observable( 97 ),
					handles		: "e",
					helper		:  'ui-resizable-helper',
					start       : this._onResizableStart.bind( this ),
					resize      : this._onResizableResize.bind( this ),
					stop		: this._onResizableStop.bind( this ),
					zIndex		: 1

				}
			},

			_fixLegacySpanValues: function(){			
				var columnas = this.data.snippets(),
					columnasTotales = 0;
				$.each( columnas, function(index, columna){
					columnasTotales += columna.data.span() || 1;
				});

				$.each( columnas, function(index, columna){
					columna.data.span( 12 * ( columna.data.span() || 1 ) / columnasTotales );
				});			
			},

			_onResizableStart: function(event, ui){
				var $element = ui.element;

				$element
					.parent()
					.toggleClass('group-resizing', true);
			},

			_onResizableResize: function(event, ui){
				this._onResizableSnaps( event, ui );
			},

			_onResizableStop: function(event, ui){
				var $element = ui.element;

				$element
					.parent()
					.toggleClass('group-resizing', false);

				$element.css({
					width: '',
					height: '',
					left: '',
					top: '',
					right: '',
					bottom: ''
				});

				this._onResizableSnaps( event, ui );
			},

			_onResizableSnaps: function( event, ui ){
				var handlePosition = ui.size.width;
				var $columnaAnterior = ui.element;
				var $columnaSiguiente = $columnaAnterior.next();
				var columnaAnterior = ko.dataFor( $columnaAnterior[0]);
				var columnaSiguiente = ko.dataFor( $columnaSiguiente[0]);
				var totalSpan = columnaAnterior.data.span() + columnaSiguiente.data.span();
				var anchoColumnaAnterior = $columnaAnterior.innerWidth();
				var anchoColumnaSiguiente = $columnaSiguiente.innerWidth();
				var anchoGap = parseFloat( $columnaSiguiente.css('marginLeft') );
				var anchoTotal = anchoColumnaAnterior + anchoColumnaSiguiente + anchoGap;
				var gapsPosibles = totalSpan - 1;
				var anchoGapsPosibles = gapsPosibles * anchoGap;
				var anchoColumna = ( anchoTotal - anchoGapsPosibles ) / totalSpan;


				var snaps = [];
				for ( var i = 1; i <= gapsPosibles ; i++ ){
					var anchoColumnas = i * anchoColumna;
					var anchoGaps = (i-1) * anchoGap;
					var posicion = anchoColumnas + anchoGaps + anchoGap*.5;
					snaps.push( posicion );
				}

				var snap;
				var snapIndex = 0;
				$.each( snaps, function( index, position ){
					if( handlePosition <= position || index >= gapsPosibles -1){
						snap = position;
						snapIndex = index;
						return false;
					} else {
						var nextPosition = snaps[index+1];
						if( handlePosition <= nextPosition ){
							var translated = $.math.translateCoords( handlePosition, [ position, nextPosition ], [-1,1]);
							snap = translated < 0 ? position : nextPosition;
							snapIndex = translated < 0 ? index  : index + 1;
							return false;
						}
					}
				});

				var columnaAnteriorSpanAnterior = columnaAnterior.data.span();

				var columnaAnteriorSpan = snapIndex + 1;
				var columnaSiguienteSpan = totalSpan - columnaAnteriorSpan;

				if( columnaAnteriorSpanAnterior != columnaAnteriorSpan ){
					columnaAnterior.data.span( columnaAnteriorSpan );
					columnaSiguiente.data.span( columnaSiguienteSpan );
				}

			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo		: 'fila',
					data: {
						snippets: [],
						noGutters	: false
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					/*nombre		: 'Columnas',*/
					icono		: 'icon-snippet-columns',
					columnas	: 3, /* Solo para editar */
					columnasEdicion	: [],
					hasEditButtons		: true,
					filas		: [1,2,3,4,6]
				});
			},

			_setMapping: function(){
				var self = this;
				this._parent();
				this._mergeMapping({
					snippets: {
						create: function(options) {
							return new namespace.Snippet.Columna(options.data, self);
						}
					}
				});
			},

			_createComputed: function(){
			},

			truncarColumnas: function( cant ){
				var columnas = $.extend([], this.data.snippets())
					, cantColumnas = columnas.length;

				for (var i = cant; i < cantColumnas ; i++ ){
					columnas[i].destroy();
				}
			},

			establecerColumnas: function(value){
				if(value < 1 || value > 12) return;
				var self = this;
				var columnas = self.data.snippets();
				var cantColumnasActual = columnas.length;
				var cantColumnasNuevas = value;
				if( cantColumnasNuevas < cantColumnasActual){
					var ultimaColumnaDisponible = columnas[cantColumnasNuevas - 1];
					for (var i = cantColumnasNuevas ; i < cantColumnasActual ; i++){
						//ultimaColumnaDisponible.insertarSnippet( )
						var columnaActual = columnas[i];
						for (var i2 = 0; i2 < columnaActual.data.snippets().length ; i2++ ){
							var snippetActual = columnaActual.data.snippets()[i2];
							ultimaColumnaDisponible.insertarSnippet( snippetActual );
						}
						//Array.prototype.push.apply( ultimaColumnaDisponible.data.snippets(), columnas[i].data.snippets() );
					}
					self.truncarColumnas ( value );
					ultimaColumnaDisponible.data.snippets.valueHasMutated();

				} else {
					var cantColumnasQueSeAgregan = cantColumnasNuevas - cantColumnasActual;
					for (var i = 0 ; i < cantColumnasQueSeAgregan ; i++){
						columnas.push(new namespace.Snippet.Columna({}, self));
					}
				}

				if( cantColumnasActual != cantColumnasNuevas ){
					$.each( columnas, function( index, columna ){
						columna.data.span( 12 / columnas.length );
					});
				}

				self.data.snippets.valueHasMutated();
			},

			escalarColumna: function( originator, cuanto, side ){
				var columnas = this.data.snippets(),
					span = originator.data.span(),
					index = ko.utils.arrayIndexOf( columnas, originator ),
					primerColumna = ( index == 0 ),
					ultimaColumna = ( index == columnas.length ),
					columnaAnterior = columnas[ index - 1 ],
					columnaSiguiente = columnas[ index + 1 ],
					columnaAfectada = side == 'left' ? columnaAnterior : columnaSiguiente;
				if( side == 'left' && primerColumna
					|| side == 'right' && ultimaColumna) return;

				if( cuanto > 0 ) {
					cuanto = Math.min( cuanto, columnaAfectada.data.span() - 1 );
				} else {
					cuanto = -Math.min( Math.abs( cuanto ), originator.data.span() - 1  );
				}

				columnaAfectada.data.span( columnaAfectada.data.span() - cuanto );
				originator.data.span( originator.data.span() + cuanto );
			},

			getColumnClass: function(columna){
				return 'span' + columna.data.span();
			},

			beforeEdit: function(){
				var self = this;
				this.columnas ( this.data.snippets().length );

				function establecerColumnasEdicion( columnas ){
					var i
						, columnasEdicion = this.columnasEdicion()
						, cantColumnasEdicion = columnasEdicion.length;

					if( columnas < cantColumnasEdicion ) columnasEdicion.length = columnas;
					for( i = columnasEdicion.length ; i < columnas ; i++ ){
						var columnaOriginal = this.data.snippets()[i]
							, data = columnaOriginal && { data: { pull: ko.unwrap( columnaOriginal.data.pull ) } };

						columnasEdicion.push( new namespace.Snippet.Columna( data, self ) );
					}

					this.columnasEdicion.valueHasMutated();

				}

				this._columnasEdicionSubscription = this.columnas.subscribe( establecerColumnasEdicion, this );
				establecerColumnasEdicion.bind(this)( this.columnas() );

			},

			afterEdit: function(){
				var columnas;
				this.establecerColumnas ( this.columnas() );

				//console.debug("this.columnas", this.columnas(), 'snippets:', this.data.snippets().length, 'columnasEdicion.length', this.columnasEdicion().length );

				columnas = this.data.snippets();
				$.each( this.columnasEdicion(), function( index, columna ){
					var data = { data: { pull: ko.unwrap( columna.data.pull ) } };
					columnas[ index ].update( data );
				});

				this._columnasEdicionSubscription.dispose();
				this.columnasEdicion.destroyItems();
			},

			cancelar: function(){
				this._columnasEdicionSubscription.dispose();
				this.columnasEdicion.destroyItems();
			},

			cantidadColumnas: function() {
				return this.data.snippets().length;
			},

			agregarColumna: function() {
				var $index;
				this.beforeEdit();
				$index = this.filas.indexOf(this.columnas());
				if($index == -1) return;
				this.columnas( this.filas()[ $index + 1 ] );
				this.afterEdit();
			},

			eliminarColumna: function() {
				var $index;
				this.beforeEdit();
				$index = this.filas.indexOf(this.columnas());
				if($index == -1) return;
				this.columnas( this.filas()[ $index - 1 ] );
				this.afterEdit();
			},

			tieneColumnasMismoAncho: function(){
				return $.unique( ko.utils.arrayMap( this.data.snippets(), function( snippet ){ return snippet.data.span()} ) ).length == 1;
			},

			igualarAnchoColumnas: function(){
				var span = 12 / this.cantidadColumnas();
				$.each( this.data.snippets(), function( i, snippet ){
					snippet.data.span( span );
				});
			},

			editar: function(){
			},

			droppable: function(){
				return false;
			},

			canBeIndicated: function(){
				return false;
			}

		}
	});


	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Caja = namespace.Snippet.Contenedor.extend({
		nombre		: ko.observable('snippets:snippet.caja.caja'),
		descripcion	: ko.observable('snippets:snippet.caja.agrupa_elementos_pero_ademas_puedes_asignar_color_imagen_de_fondo_y_otros_atributos'),
		version 	: $.getAllQueryStrings().versionCaja || 2,

		prototype: {
			init: function(data){
				//if(data && data.overflow === undefined) data.overflow = 'visible'; // por retrocompatibilidad, los antiguos tienen visible
				this._fixOriginalData( data );

				this._parent.apply(this, arguments);

				this.style = ko.computed(function(){
					var result = {};
					result['color'] = this.fixColor( this.data.color() ) || '';

					result['height'] = '';
					result['minHeight'] = '';
					result['overflow'] = '';
					if(this.data.height()){
						if(this.data.overflow() == 'hidden'){
							result['height'] = this.data.height();
							result['overflow'] = this.data.overflow();
						} else {
							result['minHeight'] = this.data.height();
							//result['height'] = '1px'; // 2015/06/25 FIX para vertical align de flex de IE11
						}
					}

					if( this.data.overflow() == 'hidden' ){
						result['overflow'] = this.data.overflow();
					}

					result['padding'] = this.data.padding() || '';
					result['margin'] = this.data.margin() || '';
					result['borderRadius'] = this.data.borderRadius() || '';
					result['borderStyle'] = this.data.borderStyle() || '';
					result['borderColor'] =  this.data.borderColor() || '';
					result['borderWidth'] = this.data.borderWidth() || '';

					result['backgroundColor'] = this.fixColor( this.data.backgroundColor() ) || '';

					var backgroundImage = this.getBackgroundImage();
					if( backgroundImage ){
						backgroundImage = 'url(' + backgroundImage + ')';
					}
					result['backgroundImage'] = backgroundImage;

					result['backgroundRepeat'] = this.data.backgroundRepeat() || '';
					result['backgroundPosition'] = this.data.backgroundPosition() ? this.getBackgroundPositionWithOffsets() : '';
					result['backgroundSize'] = this.data.backgroundSize() || '';

					if( this.backgroundVideoId() ){
						result['position'] = 'relative';
					}


					return result;
				}, this);

				if(this.cuantosDispositivosVisibles() == 0){
					// no puede ser invisible, as que lo marcamos como visible en todos los dispositivos
					this.data.visiblePhone( true );
					this.data.visibleDesktop( true );
					this.data.visibleTablet( true );
				}

				this.data.height.extend({'asUnit' : true });
				this.data.borderWidth.extend({'asShorthand': true});
				this.data.padding.extend({'asShorthand': true});

				///////////////////////////////////////////////////////////////////
				// corregir el backgroundposition para que primero est la dimensin horizontal y luego la vertical
				var backgroundPosition = this.data.backgroundPosition;
				this.data.backgroundPosition = ko.computed({
					'read'		: function(){
						var result = backgroundPosition();
						return this._fixBackgroundPosition( result );
					},
					'write'		: function( val ){
						backgroundPosition( val );
					}
				}, this );
				///////////////////////////////////////////////////////////////////
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'caja',
					data	: {
						version				: this.constructor.version,

						boxSizing			: 'border-box',

						height				: null,
						padding				: null,
						margin				: null,
						css					: '',

						color				: null,

						backgroundColor		: null,
						backgroundImage		: null,
						backgroundImageId	: null,
						backgroundRepeat	: null,
						backgroundPosition	: null,
						backgroundSize		: null,

						backgroundPositionOffsetX: 0,
						backgroundPositionOffsetY: 0,

						backgroundImageSnippet: {},
						backgroundImageOpacity	: 1,

						visiblePhone		: true,
						visibleDesktop		: true,
						visibleTablet		: true,

						overflow			: 'visible',

						animationName		: '',
						animationDelay		: .5,
						animationDuration	: 1,
						animationOnlyOnce	: false,

						parallax				: 1,
						parallaxOptimizeOuter	: 1,

						width				: '',
						maxWidth			: '',
						alignSelfHorizontal	: '',

						borderRadius		: null,
						borderStyle         : null,
						borderColor         : null,
						borderWidth         : null,

						verticalAlign		: '',

						backgroundVideoUrl      : '',
						backgroundVideoOpacity  : 1,
						backgroundVideoSound    : false,

						rotate					: 0
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono		: 'icon-snippet-box',
					onScreen	: false,
					hasEditButtons: true,
                                        initPaused:true,
					helpers: {
						backgroundVideoButtonIcon	: 'fa-pause',
						backgroundVideoPaused		: false
					},
					animationIsPaused		: false
				});
			},

			_setMapping: function(){
				this._parent();
				this._mergeMapping({
					backgroundImageSnippet: {
						create: function( options ){
							return new namespace.Snippet.Imagen( options.data );
						}
					}
				});
			},

			_getComplexityValue: function(){
				var result = this._parent.apply( this, arguments );
				if( this.tieneParallax() ){
					result += 5;
				}
				if( this.hasBackgroundVideo()){
					result += 5;
				}
				return result;
			},

			_fixBackgroundPosition: function( backgroundPosition ){
				var verticalFirst;
				var result = backgroundPosition;
				if( result ){
					var split = result.split(' ');
					if( $.inArray(split[0], ['top', 'bottom']) != -1 ){
						verticalFirst = true;
					}
					if( $.inArray(split[1], ['left', 'right']) != -1 ){
						verticalFirst = true;
					}
					if( verticalFirst ){
						result = [split[1], split[0]].join(' ');
					}
				}
				return result;

			},

			_fixOriginalDataParallaxFixed: function( data ){
				var bgImageSnippet = data.backgroundImageSnippet;
				if( bgImageSnippet && data.parallax != 1 ){
					if( bgImageSnippet.data ){
						bgImageSnippet.data.height = Number ( bgImageSnippet.data.height ) * 1.3;
						bgImageSnippet.data.tipoEscala = 'crop';
					}
				}
			},


			_fixParallaxOptimizeOuter: function( data ){
				if( data && data.data && data.data.version < 2 ){
					data.data.parallaxOptimizeOuter = 0;
				}

				/*
				if( data && data.data && data.data.version < 2 && this.constructor.version >= 2 ){
					data.data.version = 2;
					var parallax = data.data.parallax;
					if( parallax > 1 ){
						var backgroundPosition = this._fixBackgroundPosition( data.data.backgroundPosition );
						if( backgroundPosition ){
							backgroundPosition = backgroundPosition.split(' ');
							if( backgroundPosition[1] == 'top' ) backgroundPosition[1] = 'bottom';
							if( backgroundPosition[1] == 'bottom' ) backgroundPosition[1] = 'top';
							data.data.backgroundPosition = backgroundPosition.join(' ');
						}
					} else if( parallax < 0 ){
						var backgroundPosition = this._fixBackgroundPosition( data.data.backgroundPosition );
						var height = $.Measure( data.data.height );
						if( backgroundPosition && height.unit() == 'px' ) {
							backgroundPosition = backgroundPosition.split(' ');
							var multiplier = 0;
							if( backgroundPosition[1] == 'top' ) multiplier = -1;
							if( backgroundPosition[1] == 'bottom' ) multiplier = 1;
							var backgroundPositionOffsetY = Number( data.data.backgroundPositionOffsetY ) || 0;
							data.data.backgroundPositionOffsetY = backgroundPositionOffsetY + multiplier * parallax * height.number();

						}
					}
				}
				*/
			},

			_fixMissingVersion: function( data ){
				if( data.data.version === undefined ) {
					data.data.version = 1;
				}

				if( data.data.version == 1 ){
					var hasParallax = data.data.parallax != 1;
					var hasClass = !!data.data.css;
					if( !hasParallax && !hasClass ){
						data.data.version = this.constructor.version;
					}

				}
			},

			_fixOriginalData: function( data ){
				if( data && data.data) {

					if( data.data.css ) {
						var searchedCSS = 'extendfull'
							, regExp = new RegExp('\\b' + searchedCSS + '\\b');
						if ( data.data.css.match( regExp ) ){
							var css = data.data.css;
							data.data.css = css.replace( regExp , '__DEL__' + searchedCSS );
							data.data.width = 'background-full';

							if( !data.data.parallax ){
								var dummyDiv = $('<div>').addClass(css).appendTo('body');
								var fixed = dummyDiv.css('background-attachment');
								dummyDiv.remove();
								data.data.parallax = fixed == 'fixed' ? .5 : 1;
							}

							this._fixOriginalDataParallaxFixed( data.data );
						}

						var searchedCSS = 'bigImageFixed'
							, regExp = new RegExp('\\b' + searchedCSS + '\\b')
							, regExpFix = new RegExp('\\b__FIX__' + searchedCSS + '\\b');
						if ( data.data.css.match( regExp ) && !data.data.css.match( regExpFix ) ){
							var css = data.data.css;
							data.data.css += ' __FIX__' + searchedCSS;
							//data.data.css = css.replace( regExp , '__DEL__' + searchedCSS );
							if( data.data.parallax === 0 || data.data.parallax === undefined || data.data.parallax === 1 ){
								data.data.parallax = .5;
								this._fixOriginalDataParallaxFixed( data.data );
							}
						}


					}


					if( data.data.parallax === undefined ){
						data.data.parallax = 1;
					}


					this._fixMissingVersion( data );


				}

				this._fixParallaxOptimizeOuter( data );

				return data;
			},

			esVisibleEnDispositivo: function( dispositivo ){
				var nombreDispositivos = ['phone', 'tablet', 'desktop']
					, self = this
					, result = false;

				result = !ko.utils.arrayFirst( nombreDispositivos , function( nombreDispositivo ){
					var visibilidad = 'visible' + $.string.capitalize( nombreDispositivo );
					return dispositivo[visibilidad]() && !(self.data[visibilidad]())
				});

				return result;

			},

			css: function(){
				var result = [ this._parent.apply(this, arguments) ],
					visiblePhone = this.data.visiblePhone(),
					visibleDesktop = this.data.visibleDesktop(),
					visibleTablet = this.data.visibleTablet();

				if( visiblePhone && visibleDesktop && visibleTablet ){

				} else {
					/*
					 if( visiblePhone ) result.push( 'visible-phone' );
					 if( visibleDesktop ) result.push( 'visible-desktop' );
					 if( visibleTablet ) result.push( 'visible-tablet' );
					 */
				}

				if( this.data.boxSizing() ) result.push( this.data.boxSizing() );

				if( this.data.css() ) result.push ( this.data.css() );

				if( this.shouldExtendContent() ) result.push( 'container' );

				var cssVerticalAlign = this.cssVerticalAlign();
				if( cssVerticalAlign ){
					result.push( cssVerticalAlign );
				}

				return result.join( ' ' );
			},

			cssVerticalAlign: function(){
				var result = [];
				if( this.data.verticalAlign() ){
					result.push( 'vertical-align-' + this.data.verticalAlign() );
				}
				return result.join(' ');
			},

			cssAlign: function(){
				var result = [ this._parent.apply( this, arguments ) ]
					, cssVerticalAlign = this.cssVerticalAlign();

				if( cssVerticalAlign ) result.push( cssVerticalAlign );
				return result.join(' ');
			},

			getBackgroundPositionV: function( backgroundPosition ){
				var backgroundPosition = backgroundPosition || this.data.backgroundPosition() || ''
					, backgroundPositionSplit = backgroundPosition.split(' ')
					, result = {'center': 50, 'top': 0, 'bottom': 100 } [backgroundPositionSplit[1]];

				return result !== undefined ? result : 50;
			},

			getBackgroundPositionH: function( backgroundPosition ){
				var backgroundPosition = backgroundPosition || this.data.backgroundPosition() || ''
					, backgroundPositionSplit = backgroundPosition.split(' ')
					, result = {'center': 50, 'left': 0, 'right': 100 } [backgroundPositionSplit[0]];

				return result !== undefined ? result : 50;
			},

			getBackgroundPositionWithOffsets: function(){
				var bgPosH = this.getBackgroundPositionH();
				var bgPosV = this.getBackgroundPositionV();
				var backgroundPositionOffsetX = this.data.backgroundPositionOffsetX();
				var backgroundPositionOffsetY = this.data.backgroundPositionOffsetY();
				return $.cssBackgroundPositionWithOffset( bgPosH, bgPosV, backgroundPositionOffsetX, backgroundPositionOffsetY );
			},

			cuantosDispositivosVisibles: function(){
				var cant = 0;
				if ( this.data.visiblePhone() ) cant++;
				if ( this.data.visibleDesktop() ) cant++;
				if ( this.data.visibleTablet() ) cant++;
				return cant;
			},

			toggleVisibleDispositivo: function( dispositivo ){
				var value = !dispositivo();
				if(!value && this.cuantosDispositivosVisibles() == 1) return;
				else dispositivo( value );
			},

			getAnimationStyle: function( data ){
				var data = data || this.data
					, delay = data.animationDelay();
				return $.prefixedStyle({
					'animationDelay': delay + 's',
					'animationDuration': data.animationDuration() + 's'
				});
			},

			/*
			getParallaxBackgroundPosition: function( width, height, relativeVerticalMiddle, element, data, parent ){
				var args = $.extend([], arguments);
				args.unshift( this );
				return this.constructor.getParallaxBackgroundPosition.apply( this.constructor, args );
			},
			
			getParallaxStyle: function( width, height, relativeVerticalMiddle, element, data, parent ){
				var args = $.extend([], arguments);
				args.unshift( this );
				return this.constructor.getParallaxStyle.apply( this.constructor, args );
			},
			*/

			editar: function(){},

			afterEdit: function(){
				if(this.hasBackgroundImage() && this.data.height() == null ) {
					var backgroundImageHeight = this.data.backgroundImageSnippet.data.height();
					this.data.height( '200px' );
				}
			},

			getRelatedSnippets: function(){
				var result = this._parent.apply( this, arguments );
				result.push( this.data.backgroundImageSnippet );
				return result;
			},

			////////////////////////////////////////////////////////////////////////////////

			shouldExtendFull: function( $context, documentRoot ){
				var width = this.data.width();
				return ( width === 'full' || width === 'background-full') && this.canExtendFull( $context, documentRoot );
			},

			canExtendFull: function( $context, documentRoot ){
				return !this.isChildOf( function( parent ) {
					return !( parent instanceof namespace.Snippet.Caja ) || ( parent instanceof namespace.Snippet.Caja && parent.data.width() != '');
				});
			},

			shouldExtendBackgroundFull: function( $context, $documentRoot ){
				var width = this.data.width();
				return width === 'background-full' && this.shouldExtendFull();
			},

			canExtendBackgroundFull: function( $context, documentRoot ){
				return this.canExtendFull.apply( this, arguments );
			},

			shouldExtendContent: function( $context, documentRoot ){
				return this.data.width() === 'content' && this.canExtendContent( $context, documentRoot );
			},

			canExtendContent: function( $context, documentRoot ){
				return this.isChildOf( function( parent ) {
					return ( parent instanceof namespace.Snippet.Caja && parent.shouldExtendFull() && parent.data.width() == 'full' && parent.data.width() !== 'content' );
				});
			},

			tieneParallax: function(){
				return Number( this.data.parallax() ) != 1;
			},

			shouldActivateOnScreen: function(){
				return this.data.animationName() || this.tieneParallax() || this.hasBackgroundVideo();
			},

			droppable: function(){ return true; },

			hasBackgroundImage: function(){
				return !!this.data.backgroundImageSnippet.data.id();
			},

			hasTranslucentBackgroundImage: function(){
				return this.hasBackgroundImage() && this.data.backgroundImageOpacity() != 1
			},

			backgroundVideoId: function(){
				return $.string.getIdFromYoutubeURL( this.data.backgroundVideoUrl() );
			},

			backgroundVideoImage: function(){
				var self = this
					, id = self.backgroundVideoId()
					, url = 'url("https://i.ytimg.com/vi/' + id + '/mqdefault.jpg")';
				return url;
			},

			backgroundVideoActions: function(data, event){
				var self = this
					, $element = $(event.target)
					, player = $element.parents('.byoutube-controls').prev().data('byoutube');

				event && event.preventDefault();

				if( player && player.getPlayerState() == YT.PlayerState.PLAYING ){
					player.pauseVideo();
					self.helpers.backgroundVideoButtonIcon('fa-play');
				}

				if( player && player.getPlayerState() == YT.PlayerState.PAUSED ){
					player.playVideo();
					self.helpers.backgroundVideoButtonIcon('fa-pause');
				}
			},

			backgroundVideoPauseToggle: function(){
                            this.initPaused(false);
                            this.helpers.backgroundVideoPaused( !this.helpers.backgroundVideoPaused() );
			},

			hasBackgroundVideo: function(){
				return !!this.backgroundVideoId();
			},

			getStyleOffline: function(){
				var style = this.style()
					, offlineStyle = $.extend({}, style, {
						height: '',
						minHeight: '',
						overflow: ''
					})
					, margin = style.margin.split(' ');

				if( style.height || style.minHeight ){
					offlineStyle['minHeight'] = style.height || style.minHeight;
				}

				$.each( margin, function( index, marginSide ){
					if( marginSide ){
						var value = parseFloat( marginSide );
						if( value < 0 ) value = 0;
						margin[index] = value + 'px';
					}
				});
				offlineStyle.margin = margin.join(' ');

				$.extend( offlineStyle, this.getMaxWidthStyle() );


				return offlineStyle;
			},

			getSplittedBackgroundContainerStyle: function(){
				var style = this.style()
					, offlineStyle = $.extend({
						position: 'relative'
					}, style)

				$.each( this.getBackgroundImageStyle(), function( key, value ){
					offlineStyle[key] = ''
				});

				offlineStyle['backgroundColor'] = '';

				return offlineStyle;

			},

			getBackgroundImageStyle: function(){
				var result = this.style();
				var selectedProperties = [
					'backgroundImage',
					'backgroundRepeat',
					'backgroundSize'
				];
				if( !this.tieneParallax() ){
					selectedProperties.push( 'backgroundPosition' );
				}

				result = $.getSelectedProperties(result, selectedProperties );


				return result;
			},

			_getSpacingStyle: function( options, values ){
				values = this.getPropertyForRender( values, options );
				return $.trim([ values.top, values.right , values.bottom, values.left ].join(' '));
			},

			getPropertyForRender: function( values, options ){
				var result;
				options = $.extend({}, options);
				/*
				if( property == 'margin' ){
					result = this.getMargins();
				} else if( property == 'padding' ){
					result = this.getPaddings();
				}*/
				if( typeof values == 'string' ){
					result = $.string.parseShorthand( this.data[values]() );
				} else result = values;

				if( options.window ){
					var referenceWidth = options.window.steps.tablet.maxWidth;
					if( !this.data.visibleDesktop() ){
						referenceWidth = options.window.steps.phone.maxWidth;
						if( !this.data.visibleTablet() ){
							referenceWidth = 0;
						}
					}

					if( referenceWidth ){
						var width = options.window().width
							, prop = width / referenceWidth;

						if( prop < 1 ){
							result.left.multiply( prop );
							result.right.multiply( prop );
							result.horizontal.multiply( prop );
						}
					}
				}

				return result;
			},

			getMarginStyle: function( options ){
				var result = {
					'margin'	: this._getSpacingStyle( options, this.getMargins() )
				}
				return result;
			},

			getPaddingStyle: function( options ){
				var result = {
					'padding'	: this._getSpacingStyle( options, this.getPaddings() )
				}
				return result;
			},

			getSizeStyle: function( options ){
				options = options || {};
				var style = $.extend({}, this.style());

				if( $.browser.ios ){ // en caso de problemas, reemplazar esta lnea por if( false && $.browser.ios ){
					if( options.window ){
						var viewportHeight = options.window().height;
						if( style.height ){
							var unit = $.string.getNumberValueUnit( style.height );
							if( unit == 'vh' ){
								var value = parseFloat( style.height );
								style.height = (viewportHeight * value / 100) + 'px';
							}
						}
						if( style.minHeight ){
							var unit = $.string.getNumberValueUnit( style.minHeight );
							if( unit == 'vh' ){
								var value = parseFloat( style.minHeight );
								style.minHeight = (viewportHeight * value / 100) + 'px';
							}
						}

					}
				}
				return $.getSelectedProperties( style, ['height', 'minHeight'] );
			},

			getWithoutMarginStyle: function( options ){
				var result = $.extend({}, this.style(), this.getSizeStyle( options ) );
				result.margin = '';
				return result;
			},

			getBorderRadiusStyle: function(){
				var result = this.style();
				result = $.getSelectedProperties(result, [
					'borderRadius'
				]);
				return result;
			},

			getMaxWidthStyle: function(){
				var result = {
					'maxWidth'	: ''
				};

				if( this.data.width() == 'max-width'){
					result['maxWidth'] = this.data.maxWidth() || '';
					if( this.data.maxWidth() ){
						result['margin'] = '0 !important';
						if( this.data.alignSelfHorizontal() == 'start' || this.data.alignSelfHorizontal() == 'center' ){
							result['marginRight'] = 'auto !important';
						}
						if( this.data.alignSelfHorizontal() == 'end' || this.data.alignSelfHorizontal() == 'center' ){
							result['marginLeft'] = 'auto !important';
						}
					}
				}

				return result;
			},

			getContenidoStyle: function( options ){
				var options = $.extend({}, options );
				var result = this.getWithoutMarginStyle( options );

				$.each( this.getBackgroundImageStyle(), function( key, value ){
					result[key] = ''
				});

				result['backgroundColor'] = '';

				if( this.hasMargins() || ( options.window && options.window.visiblePhone() ) ){
					result['margin'] = '0 !important';
					$.extend( result, this.getPaddingStyle( options ) );
				}

				$.extend( result, this.getMaxWidthStyle( options ) );

				if( this.tieneParallax() ){
					delete result['backgroundPosition'];
				}

				return result;
			},

			getBackgroundColorStyle: function(){
				var result = this.style();
				result = $.getSelectedProperties(result, [
					'backgroundColor'
				]);
				return result;
			},

			getBackgroundImage: function( aditionalOptions ){
				var backgroundImage = ''
					, aditionalOptions = $.extend({}, aditionalOptions )
					, forCSS = aditionalOptions.forCSS;

				delete aditionalOptions['forCSS'];

				if( this.data.backgroundImageSnippet.data.id() ){
					backgroundImage = this.data.backgroundImageSnippet.get( aditionalOptions );
				} else if( this.data.backgroundImage() ){
					backgroundImage = this.data.backgroundImage();
				} else if( this.data.backgroundImageId() ) {
					backgroundImage = 'galeriaimagenes/obtenerimagen/?id=' + this.data.backgroundImageId();
				}

				if( forCSS && backgroundImage ){
					backgroundImage = 'url(' + backgroundImage + ')';
				}
				return backgroundImage;

			},

			getBorderRadiusStyle: function(){
				var result = this.style();
				result = $.getSelectedProperties(result, [
					'borderRadius'
				]);
				return result;
			},

			getBackgroundStyle: function(){
				var result  = {
					top	: '0px',
					bottom: '0px',
					left: '0px',
					right: '0px',
					position: 'absolute',
					opacity	: this.data.backgroundImageOpacity()
				};

				$.extend(
					result,
					this.getBackgroundImageStyle(),
					this.getBorderRadiusStyle()/*,
					this.getBackgroundColorStyle()*/
				);

				return result;
			},

			_getSidedProperty: function( property, removeUnit ){
				var style = this.style();
				var value = style[property];
				var result = $.string.parseShorthand( this.style()[property] );

				$.each( ['top', 'right', 'bottom', 'left'], function( index, value ) {
					result[value + 'Value'] = result[value].number();
					result[value + 'Unit'] = result[value].unit();
					if( removeUnit ){
						result[value] = result[value].number();
					}
				});
				return result;
			},

			getMargins: function( removeUnit ){
				return this._getSidedProperty('margin', removeUnit);
			},

			hasMargins: function(){
				return !this.getMargins().isEmpty();
			},

			getPaddings: function( removeUnit ){
				return this._getSidedProperty('padding', removeUnit);
			},

			hasBorderRadius: function(){
				return !!parseInt(this.data.borderRadius());
			},

			///////////////////////////////////////////////////////////////////////////////

			///////////////////////////////////////////////////////////////////////////////
			/*
			getPreferredRenderVersion: function(){
				var ipIsInternal = false; //ko.unwrap( $.getObjectProperty(window,'model.data.request.ip.isInternal') );
				//if( ( ipIsInternal && !$.getAllQueryStrings().versionCaja == 1 ) || $.getAllQueryStrings().versionCaja == 2 ){
				if( this.constructor.version >= 2 ){
					var result = 5;
					var queryStringVersion = $.getAllQueryStrings().parallaxVersion;
					var hasVerticalHeightUnitPW = this.data.height.unit() == 'pw';
					var personalizedWidth = this.data.width() == ('max-width');
					if( !personalizedWidth  && !hasVerticalHeightUnitPW && !this.hasTranslucentBackgroundImage() && this.data.css() ){ // si tiene una clase, por las dudas usamos una version antigua.
						result = 3;
					}

					if( queryStringVersion  ){
						result = queryStringVersion;
					}

				} else {
					result = 1;
				}
				return result;
			},
			*/

			_hasV2Features: function(){
				var hasVerticalHeightUnitPW = this.data.height.unit() == 'pw';
				var hasVerticalHeightUnitPercent = this.data.height.unit() == '%';
				var hasPersonalizedWidth = this.data.width() == ('max-width');
				var hasTranslucentBackgroundImage = !!this.hasTranslucentBackgroundImage();
				return hasVerticalHeightUnitPercent || hasVerticalHeightUnitPW || hasPersonalizedWidth || hasTranslucentBackgroundImage;
			},

			_isChildOfCard: function(){
				return this.isChildOf(tiendasimple.Snippet.Card);
			},

			getPreferredRenderVersion: function(){
				var result = this.data.version() == 1 ? 1 : 5;
				if( result == 1 && ( this._hasV2Features() || this._isChildOfCard() ) ){
					result = 5;
				}
				return result;
			},

			getV2StyleOverflow: function(){
				var result = {
					'overflow'	: this.data.overflow()
				};
				return result;
			},

			getV2StyleContenido: function( options ){
				var result = {
					'zIndex'	: '0'
				};
				return result;
			},

			getV2StyleDimensions: function( options ){
				var result = {};
				return result;
			},

			getV2StylePadding: function( options ){
				return this.getPaddingStyle( options );
			},

			getV2StyleMargin: function( options ){
				return this.getMarginStyle( options );
			},

			getV2StyleBorder: function( options ){
				var result = {};
				result['borderStyle'] = this.data.borderStyle() || '';
				result['borderColor'] =  this.data.borderColor() || '';
				result['borderWidth'] = this.data.borderWidth() || '';
				return result;
			},

			getV2StyleBorderRadius: function( options ){
				return this.getBorderRadiusStyle();
			},

			getV2StyleWidth: function( options ){
				var result = {
					'boxSizing'	: 'border-box',
					'maxWidth'	: ''
				};
				switch( this.data.width() ){
					case 'max-width':
						result['maxWidth'] = this.data.maxWidth();
						break;
				}
				return result;
			},

			getV2StyleHeight: function( options ){
				var result = {
					'boxSizing'	: 'border-box'
				};

				var height = this.data.height();
				/*
				this.data.height.extend({asUnit: true});
				if( this.data.height.unit() == 'pw' ){
					height = (options.parentWidth * this.data.height.value() / 100)+'px';
				}*/


				switch( this.data.overflow() ){
					case 'hidden':
						result['height'] = height;
						break;

					default:
						result['min-height'] = height;
						break;
				}
				return result;
			},

			getV2StyleContentParent: function(){
				var result = {
					'width'			: '',
					'paddingTop'	: ''
				};
				var height = this.data.height();
				this.data.height.extend({asUnit: true});
				if( this.data.height.unit() == 'pw' ){
					result.width = '100%';
					result.paddingTop = this.data.height.value() + '%'
					//height = (options.parentWidth * this.data.height.value() / 100)+'px';
				}
				return result;
			},

			getV2StyleContentParentChild: function(){
				var result = {
					'position'	: 'relative',
					'top'		: '',
					'left'		: '',
					'right'		: '',
					'bottom'	: ''
				}
				var height = this.data.height();
				this.data.height.extend({asUnit: true});
				if( this.data.height.unit() == 'pw' ) {
					result = {
						'position'	: 'absolute',
						'top'		: '0',
						'left'		: '0',
						'right'		: '0',
						'bottom'	: '0',
						'height'	: ''
					}
				}

				return result;
			},

			getV2StyleBackgroundColor: function( options ){
				return this.getBackgroundColorStyle();
			},


			getV2StyleBackgroundImage: function( options ){
				var result = this.style();
				var selectedProperties = [
					'backgroundImage',
					'backgroundPosition',
					'backgroundRepeat',
					'backgroundSize'
				];
				result = $.getSelectedProperties(result, selectedProperties );
				return result;
			},

			getV2StyleBackgroundImageOpacity: function(){
				return {
					'opacity'	: this.data.backgroundImageOpacity() || '0'
				};
			},

			getV2StyleAlignSelfHorizontal: function(){
				result = {};
				if( this.data.width() == 'max-width'){
					if( this.data.maxWidth() ){
						result['margin'] = '0 !important';
						if( this.data.alignSelfHorizontal() == 'start' || this.data.alignSelfHorizontal() == 'center' ){
							result['marginRight'] = 'auto !important';
						}
						if( this.data.alignSelfHorizontal() == 'end' || this.data.alignSelfHorizontal() == 'center' ){
							result['marginLeft'] = 'auto !important';
						}
					}
				}
				return result;
			},

			/////////////////////////////////////

			_getV5StyleBorder: function( $context ){
				var result;
				with( this ){
					result = {
						'borderRadius'  : ko.unwrap( data.borderRadius ),
						'borderWidth'   : ko.unwrap( data.borderWidth ),
						'borderStyle'   : ko.unwrap( data.borderStyle ),
						'borderColor'   : ko.unwrap( data.borderColor )
					};
				}
				return result;
			},

			_getV5StyleBorderTransparent: function( $context ) {
				return $.extend( this._getV5StyleBorder( $context ), {
					'borderColor'		: 'transparent'
				});
			},

			_getV5StyleBorderRadius: function( $context ){
				var result;
				with( this ){
					result = {
						'borderRadius'  : ko.unwrap( data.borderRadius )
					};
				}
				return result;
			},

			_getV5StyleWidth: function( $context ){
				var result;
				var $root = $context && $context.$root;
				with( this ){
					result = {
						'width'    			: '100%',
						'maxWidth'    		: ( data.width() == 'max-width' && data.maxWidth()) || ''
					};
				}
				return result;
			},

			_getV5StyleMinWidth: function( $context ){
				var result;
				var $root = $context && $context.$root;
				with( this ){
					result = {
						'minWidth'		: getPropertyForRender('padding', $root ).horizontal.add( data.borderWidth.horizontal.value() )
					};
				}
				return result;
			},

			_getV5StyleMinHeight: function( $context ) {
				var result;
				with( this ){
					result = {
						'position'		: 'relative',
						'top'			: '',
						'left'			: '',
						'right'			: '',
						'bottom'		: '',
						//'minHeight'     : data.overflow() != 'hidden' && data.height.unit() != 'pw' ? 'calc(' + data.height() + ' - ' +  data.borderWidth.vertical() +')' : '100%'
						'minHeight'     : '100%'
					};
				}
				return result;
			},

			_getV5StyleHeight: function( $context ){
				var result = this._getV5StyleMinHeight( $context );
				var $root = $context && $context.$root;
				with( this ){
					if(  data.height() && data.overflow() == 'hidden' ){
						$.extend(result, {
							'position'   	: 'absolute',
							'top'        	: '0',
							'left'       	: '0',
							'right'      	: '0',
							'bottom'     	: '0'
						});
					}
				}
				return result;
			},

			_getV5StyleHeightSizer: function( $context, options ){
				options = $.extend({ 'replacePercentWithVh': true }, options);

				// establece el alto de la caja cuando tiene overflow hidden
				with( this ){
					var result = {
						'position'		: 'relative',
						'paddingTop'	: '',
						'float'			: 'left',
						'width'			: '0'
					};

					var paddingTop;
					//var borderWidthVertical = data.borderWidth.vertical();
					if( data.height.unit() == 'pw' ){
						paddingTop = data.height.value() + '%';
					} else if( data.height.unit() == '%') {
						if( $context.$dimensions ){
							paddingTop = ( $context.$dimensions.height() * data.height.value() / 100 ) + 'px';
						} else {
							if( options.replacePercentWithVh ){
								paddingTop = data.height.value() + 'vh';
							}
						}
					} else {
						paddingTop = data.height();
						/*
						 if( borderWidthVertical ){
						 paddingTop = 'calc( ' + paddingTop + ' - ' + borderWidthVertical + ' )';
						 }*/
					}

					var result = {
						'position'		: 'relative',
						'float'			: 'left',
						'width'			: '0',
						'paddingTop'	: paddingTop
					};

					return result;
				}
			},

			_getV5StyleHeightSizerNoPercent: function( $context ) {
				var result = this._getV5StyleHeightSizer( $context, {'replacePercentWithVh':false} );
				return result;
			},

			_getV5StyleOverflow: function( $context ){
				var forceVisible = false;

				if( $context && $context.editor ){
					forceVisible = this.isOrHasChild(function(snippet){ return snippet.iluminado()}); //$context.editor.dragging() ||
				}

				return {
					'overflow'	: forceVisible ? 'visible' : ko.unwrap( this.data.overflow )
				};
			},

			_getV5StyleMargin: function( $context ){
				var $root = $context && $context.$root;
				with( this ){
					return {
						'margin'		: getPropertyForRender('margin', $root),
						'boxSizing'		: 'border-box'
					}
				}
			},

			_getV5StyleMarginPositive: function( $context ){
				var $root = $context && $context.$root;
				with( this ){
					return {
						'margin'		: getPropertyForRender('margin', $root).notNegative(),
						'boxSizing'		: 'border-box'
					}
				}
			},


			_getV5StylePadding: function( $context ){
				var $root = $context && $context.$root;
				with( this ){
					return {
						'padding'		: getPropertyForRender('padding', $root),
						'boxSizing'		: 'border-box'
					}
				}
			},

			_getV5StyleAlignSelfHorizontal: function( $context ){
				var $root = $context && $context.$root;
				with( this ){

					var result = {
						'display'			: $.browser.supports.css.display.flex() ? 'flex' : 'inline-block',
						'marginLeft'		: '',
						'marginRight'		: ''
					};
					if( $.inArray(data.alignSelfHorizontal(), ['start', 'center'])!= -1 ) result['marginRight'] = 'auto';
					if( $.inArray(data.alignSelfHorizontal(), ['end', 'center'])!= -1 ) result['marginLeft'] = 'auto';

					return result;
				}
			},


			_getV5StyleRotate: function( $context ){
				with( this ){
					return {
						'transform'			: $.cssTransform({
							'rotate'		: data.rotate()
						})
					};
				}
			},

			_getV5StyleParallax: function( $context ){
				return $.extend( {
					'willChange': 'transform'
				}, this.getV2StyleBackgroundImage(), this.getV2StyleBackgroundImageOpacity());
			},

			_getV5StyleBackgroundContainer: function( $context ){
				return {
					'zIndex'		: '0',
					'position'  	: 'relative'
				};
			},

			_getV5StyleBackground: function( $context ){
				var $root = $context && $context.$root;
				return $.extend({}, {
					'overflow'	: 'hidden',
					'zIndex'	: '0'
				}); //, this.getV2StyleBorderRadius( $root ));
			},

			_getV5StyleContent: function( $context ){
				return {
					'float'		: 'left'
				};
			},

			_getV5StyleColor: function( $context ){
				var $root = $context && $context.$root;
				with( this ){
					return {
						'color'	: fixColor( ko.unwrap( data.color ) ) || ''
					};
				}
			},

			_getV5StyleHwAccelParallax: function(){
				with( this ){
					return {
						'willChange'	: data.parallax() !=1 ? 'transform' : ''
					}
				}
			},

			_getStyleByRoleHeightPercent: function( element ){
				var result = {};
				/*
				 if( this.data.height.unit() == '%' ){
				 $.extend(result, {
				 'height': this.data.height()
				 });
				 }
				 */
				return result;
			},

			_getV5StyleHeightPercentChild: function( element ){
				var result = {};
				/*
				 if( this.data.height.unit() == '%' ){
				 $.extend(result, {
				 'height': '100%'
				 });
				 }
				 */
				return result;
			},

			///////////////////////////

			_getV5StyleMethodNameByRole: function( role ){
				var methodName = '_getV5Style' + $.string.capitalize($.camelCase(role));
				if($.string.startsWith(role, '-')) methodName = '-' + methodName;
				return methodName;
			},

			_getV5StyleMethodByRole: function( role ){
				var methodName = this._getV5StyleMethodNameByRole( role );
				var result = this[methodName];
				return result && result.bind(this);
			},

			getV5StyleByRoles: function(element){
				var self = this;
				var roles = $(element).attr('data-role');
				var $context = ko.contextFor(element);
				var aRoles = $.trim(roles).split(/\s+/g);

				var result = {};
				$.each( aRoles, function(index, role){
					var method = self._getV5StyleMethodByRole( role );
					var methodName = self._getV5StyleMethodNameByRole( role );
					if( method ){
						$.extend( result, method($context) );
					}
				});

				return result;
			},

			getV5AttrParallax: function( element ){
				with( this ){
					return {
						'data-parallax'						: data.parallax(),
						'data-parallax-type'				: 'element',
						'data-parallax-element'				: 'parent',
						'data-parallax-direction'			: 'vertical',
						'data-background-position-x'		: getBackgroundPositionH(),
						'data-background-position-y'		: getBackgroundPositionV(),
						'data-background-position-x-offset'	: data.backgroundPositionOffsetX(),
						'data-background-position-y-offset'	: data.backgroundPositionOffsetY(),
						'data-parallax-freeze'				: 0,
						'data-parallax-parent'				: $(element).closest('.window')[0] ? '.window' : '',
						'data-parallax-optimize-outer'		: data.parallaxOptimizeOuter()
					}
				}
			},

		},

		// FIN PROTOTYPE //

			/*
		getParallaxBackgroundPosition: function( snippet, width, height, relativeVerticalMiddle, element, data, parent ){
			
			var cached = $(element).data('getParallaxBackgroundPositionCached');
			if( !window.useCache || !cached || ( new Date() - cached.cachedTime ) > 1000 ){
				var  parentHeight = $( parent || window ).realOuterHeight()
					, data = data || snippet.data
					, parallaxBrowserOffset = this.browserIsSafari() ? 0 : -1
					, attachmentFixedOffset = parallaxBrowserOffset == 0 ? .5 : 0
					, bgPosH = snippet.getBackgroundPositionH()
					, bgPosV = snippet.getBackgroundPositionV()
					, newBgPosH = bgPosH + '%'
					, elementHeight = $(element).realOuterHeight()
					, parallax = Number( data.parallax() ) + parallaxBrowserOffset

					, offsetBottom = (parentHeight - elementHeight) * parallax * ( bgPosV - 50 ) / 100
					, parentHeightParallaxed = parentHeight * parallax;
				cached = {
					offsetBottom			: offsetBottom,
					attachmentFixedOffset	: attachmentFixedOffset,
					newBgPosH				: newBgPosH,
					parentHeightParallaxed	: parentHeightParallaxed,
					bgPosH					: bgPosH,
					bgPosV					: bgPosV,
					cachedTime				: new Date()
				};
				$(element).data('getParallaxBackgroundPositionCached', cached);		
				//console.debug('calculated');
			}
			
			var  offsetBottom = cached.offsetBottom
				, attachmentFixedOffset = cached.attachmentFixedOffset
				, parentHeightParallaxed = cached.parentHeightParallaxed
				, bgPosV = cached.bgPosV
				, bgPosH = cached.bgPosH
				, relativeVerticalMiddle = relativeVerticalMiddle - .5
				, offsetParallax = - ( relativeVerticalMiddle * parentHeightParallaxed )
				, offsetTop =  Math.round( offsetParallax + offsetBottom ) + attachmentFixedOffset - ko.unwrap( data.backgroundPositionOffsetY ) 
				, offsetLeft = ko.unwrap( data.backgroundPositionOffsetX)
				, newBgPosV = 'calc(' + bgPosV + '% - ' + offsetTop + 'px)'
				, newBgPosH = 'calc(' + bgPosH + '% - ' + offsetLeft +'px)';

			return [newBgPosH,  newBgPosV].join(' ');
		},
		
		getParallaxStyle: function( snippet, width, height, relativeVerticalMiddle, element, data, parent ){
			return {
				'backgroundPosition': this.getParallaxBackgroundPosition( snippet, width, height, relativeVerticalMiddle, element, data, parent ),
				'backgroundAttachment'	: this.browserIsSafari() ? 'fixed' : 'scroll'
			};
		},*/
		
		browserIsSafari: function(){
			if( this.__browserIsSafari === undefined ){
				this.__browserIsSafari = navigator.userAgent.toLowerCase().indexOf('safari/') !== -1 && navigator.userAgent.toLowerCase().indexOf('chrome/') === -1;
			}
			return this.__browserIsSafari;
		}
	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.Card = namespace.Snippet.Contenedor.createSubClass('card', {
		mappeable: {
			'data'					: {
				'trigger'					: 'mouseover',  // mouseover || none
				'transition'				: 'slideUpOpver',
				'transitionDuration'		: 1,
				'eventBindings'				: []
			}
		},

		defaults: {
			'icono'					: 'icon-snippet-card',
			'activeSideIndex'		: 0,
			'selectedSideIndexes'	: [0],
			'editar'			: true,
			'hasEditButtons'	: true
		},

		mapping: {
			'eventBindings'			: {
				'create'			: function( options ){
					return new namespace.SnippetEventBinding( options.data );
				}
			}
		}
	}), {
		nombre				: ko.observable( 'Tarjeta' ),
		descripcion			: ko.observable( 'Permite crear dos contenidos que se revelan al pasar el mouse por encima' ),
		transitionOptions	: [
			{'text'		: 'fade'		, 'value'	: 'fade'},
			{'text'		: 'fadeOver'	, 'value'	: 'fadeOver'},
			{'text'		: 'flipX'		, 'value'	: 'flipX'},
			{'text'		: 'flipY'		, 'value'	: 'flipY'},
			{'text'		: 'slideUpOver'		, 'value'	: 'slideUpOver'},
			{'text'		: 'slideDownOver'	, 'value'	: 'slideDownOver'},
			{'text'		: 'slideLeftOver'	, 'value'	: 'slideLeftOver'},
			{'text'		: 'slideRightOver'	, 'value'	: 'slideRightOver'}
		]
	}).addMethods({
		init: function(){
			var args = $.makeArray( arguments );
			var data = args[0];
			if( !( data && data.snippets && data.snippets.length != 0) ){
				args[0] = $.extend(true, args[0], {
					'data'	: {
						'snippets'	: [
							{
								'tipo'		: 'contenedor',
								'nombre'	: 'Tarjeta - Frente'
							},
							{
								'tipo'		: 'contenedor',
								'nombre'	: 'Tarjeta - Dorso'
							}
						]
					}
				})
			}

			this._parent.apply( this, args );

			/*
			if(this.data.snippets().length == 0){
				var sideA = new namespace.Snippet.Contenedor();
				var sideB = new namespace.Snippet.Contenedor();
				this.insertarSnippet( sideA );
				this.insertarSnippet( sideB,0 );
			}

			this.data.snippets()[0].nombre('Tarjeta - Frente');
			this.data.snippets()[1].nombre('Tarjeta - Dorso');
			*/
		},

		getEventActionList: function(){
			return [
				{'name'	: 'side1'},
				{'name'	: 'side2'},
				{'name'	: 'next'}
			];
		},

		onEventActionNext: function(){
			this.toggleSide();
		},

		onEventActionSide1: function(){
			this.activeSideIndex( 0 );
		},

		onEventActionSide2: function(){
			this.activeSideIndex( 1 );
		},


		////////////////////////////////////////////////////////////////////

		_getStyleByRoleCard: function( $context ){
			var result = {
			};
			return result;
		},

		_getStyleByRoleSideList: function( $context ) {
			var result = {
				'position'				: 'relative',
				'transitionDuration'	: this.data.transitionDuration() + 's'
			}
			return result;
		},

		_getStyleByRoleSide: function( $context ) {
			var result = {
				'overflow'				: 'hidden',
				'transitionDuration'	: this.data.transitionDuration() + 's'
			};
			return result;
		},

		_getStyleByRoleSide1: function( $context ){
			var result = {
				'position'		: 'absolute',
				'top'			: '0',
				'right'			: '0',
				'bottom'		: '0',
				'left'			: '0',
				'pointerEvents'	: 'none'
			};
			return result;
		},

		getActiveSide: function(){
			return this.data.snippets()[ this.activeSideIndex() ]
		},

		activateSideByIndex: function( index ){
			this.activeSideIndex( index );
		},

		isSideIndexActive: function( index ){
			return this.activeSideIndex() == index;
		},

		toggleSide: function(){
			var activeSideIndex = this.activeSideIndex.peek();
			activeSideIndex++;
			activeSideIndex = activeSideIndex % this.getSidesCount();
			this.activeSideIndex( activeSideIndex );
		},

		getSidesCount: function(){
			return this.data.snippets().length
		},

		/////////////////////////////////////////////////////////////////////////////

		toggleEditMode: function(){
			var editMode = this.editMode();
			var editModes = ['list', 'card'];
			var index = $.inArray(editMode,editModes);
			index++;
			index = index % editModes.length;
			this.editMode(editModes[index]);
		},

		getSelectedSides: function(){
			var self = this, result = [];
			$.each( this.data.snippets(), function( index, side ){
				if( self.isSideIndexSelected( index ) ) result.push( side );
			})
			return result;
		},

		selectSideByIndex: function( index, model, event ){
			if( event.ctrlKey ){
				if(this.isSideIndexSelected( index ) ){
					if( this.selectedSideIndexes().length > 1 ) this.selectedSideIndexes.remove( index );
				} else {
					this.selectedSideIndexes.push( index );
				}
			} else {
				this.selectedSideIndexes( [index] );
			}
		},

		isSideIndexSelected: function( index ){
			return $.inArray( index, this.selectedSideIndexes()) != -1;
		},

		////////////////////////////////////////////////////////////////////////////////

		_getAllowedParentClasses: function(){
			return [
				namespace.Snippet.Contenedor,
				namespace.Snippet.Caja,
				namespace.Snippet.Columna,
				namespace.Snippet.Fila
			];
		}


	});

	////////////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Boton = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.boton.boton'),
		descripcion	: ko.observable('snippets:snippet.boton.agrega_un_link_de_tipo_boton_con_el_tamano_y_estilo_que_desees'),

		prototype: {
			init: function(){
				var self = this;

				this._parent.apply(this, arguments);
				this._createComputed();
			},
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'boton',
					data: {
						contenido	: 'Botn',
						href		: '',
						estilo		: '', // primary | warning | info
						tamano		: '',
						bloque		: false,
						icono		: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-button',
					inlineBlock	: true,
					esLinkeable	: true
				});
			},

			_createComputed: function(){
				this.inlineBlock = ko.computed( function(){
					return this.data.bloque() ? false : true;
				}, this);
			},

			getEventList: function(){
				return [
					{ 'name': namespace.SnippetEvent.CLICK },
					{ 'name': namespace.SnippetEvent.MOUSE_ENTER },
					{ 'name': namespace.SnippetEvent.MOUSE_LEAVE }
				]
			},

			////////////////////////////////////////////////////////////////////////////////

			css: function(){
				var result = [this._parent()];
				if( this.data.bloque() ) result.push('btn-block');
				result.push(this.data.estilo());
				result.push(this.data.tamano());

				result = $.arrayExclude(result, [null,'']);
				return result.join(" ");
			},

			editar: function(){},

			hasBtnClass: function(){
				return true;
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.ContenedorNoDroppable = namespace.Snippet.Contenedor.extend({
		prototype: {
			canContainChildSnippet: function( snippet ){
				return false;
			}
		}
	});

	namespace.Snippet.Galeria = namespace.Snippet.Contenedor.extend({
		nombre			: ko.observable( 'snippets:snippet.galeria.galeria_de_imagenes' ),
		descripcion		: ko.observable( 'snippets:snippet.galeria.crea_una_galeria_de_imagenes_con_diferentes_efectos_visuales' ),

		prototype:{
			init: function(){
				var self = this;
				this._parent.apply(this, arguments);

				this.altoGaleria = ko.computed(function(){
					var valor = parseFloat(this.data.alto());
					if( valor ){
						if( $.isPercent(this.data.alto()) ) valor = valor + '%';
						else {
							valor = valor + 'px';
						}
					} else valor = false;

					return valor;

					//return this.data.alto().length > 0 ? this.data.alto() + 'px' : false;
				}, this);


				this.data.alto.extend({asUnit: true});

				//event keys

				self.openModal.subscribe(function( open ){
					if(open){
						$("body").on('keydown.galeriaModal', self._onKeydown.bind(self));
						$("body").on('click', '.modal-body-galeria', self._onClickModal.bind(self));
						$("body").on('click', '.modal-body-galeria > img.in', self._onClickImage.bind(self));
					} else {
						$("body").off('keydown.galeriaModal');
						$("body").off('click', '.modal-body-galeria');
						$("body").off('click', '.modal-body-galeria > img.in');
					}
				});


			},

			_onClickImage: function(e){
				var self = this;
				e && e.stopPropagation();

				self.siguienteImagenSinFin();
			},

			_onClickModal: function(e){
				var self = this;

				self.openModal(false);
			},

			_onKeydown: function(e){
				var self = this;
				e && e.stopPropagation();

				if(e.keyCode == 37) { // left
					self.anteriorImagenSinFin();
				}
				else if(e.keyCode == 39) { // right
					self.siguienteImagenSinFin();
				}
			},

			siguienteImagenSinFin: function(){
				var self = this;
				if( self.imagenActualEOF() ){
					self.imagenActualIndex(0);
				} else {
					self.siguienteImagen();
				}
			},

			anteriorImagenSinFin: function(){
				var self = this
					, ultimoIndex = self.cantidadImagenes() - 1;
				if( self.imagenActualBOF() ){
					self.imagenActualIndex(ultimoIndex);
				} else {
					self.anteriorImagen();
				}
			},

			datosParaSlider: function(){
				var result
					, arrayDeSlides
					, self = this;

				arrayDeSlides= $.map( this.data.snippets(), function( imagen ){
					return {
						tipo	: 'carouselSlide',
						data	: {
							snippets:[]
						}
					};
				});

				result = new namespace.Snippet.Carousel({
					data: {
						snippets			: arrayDeSlides,
						autoHideControls	: this.data.autoHideControls,
						autoHideIndicators	: this.data.autoHideIndicators,
						interval			: this.data.interval
					}
				});

				$.each( result.data.snippets(), function( index, slide ){
					var imagen = self.data.snippets()[index];
					slide.data.snippets.push( imagen );
				});

				return result;

			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo    : 'galeria',
					data    : {
						snippets            : [],
						tipoGaleria         : 'galeriaModal',
						itemsPorFila		: 4,
						caption				: true,
						noGutters			: false,
						imageScale			: 'best-fit',
						imageAlign			: 'center',
						thumbBgColor		: '', // 'average' | 'dominant';

						//SliderModal
						alto				: '',
						interval			: 5, //segundos
						pause				: 'hover',
						autoHideControls	: true,
						autoHideIndicators	: true
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono			: 'icon-snippet-galeria',
					hasEditButtons	: true,
					imagenes		: 0,
					imagenActualIndex	: 0,

					//SLIDER
					slides				: 0,
					slideActualIndex	: 0,

					openModal		: false
				});
			},

			establecerImagenes: function(value){
				var self = this,
					imagenes = self.data.snippets(),
					cantImagenesActual = imagenes.length,
					cantImagenesNuevas = value;

				if( value < 0 || value > 50 ) return;

				if( cantImagenesNuevas < cantImagenesActual){
					var cantImagenesQueSeEliminan = cantImagenesActual - cantImagenesNuevas;
					for (var i = 0 ; i < cantImagenesQueSeEliminan ; i++){
						imagenes.pop();
					}
				} else {
					var cantImagenesQueSeAgregan = cantImagenesNuevas - cantImagenesActual;
					for (var i = 0 ; i < cantImagenesQueSeAgregan ; i++){
						imagenes.push(new namespace.Snippet.Imagen(null, self));
					}
				}

				self.data.snippets.valueHasMutated();
			},

			cantidadImagenes: function() {
				return this.data.snippets().length;
			},

			obtenerImagenActual: function(){
				var imagen = this.data.snippets()[ this.imagenActualIndex() ];
				return imagen;
			},

			obtenerContenedorConImagenActual: function(){
				var contenedor
					, imagen;

				contenedor = new namespace.Snippet.ContenedorNoDroppable();

				imagen = this.data.snippets()[ this.imagenActualIndex() ];
				if( imagen ) contenedor.data.snippets.push( imagen );

				return contenedor;
			},

			obtenerIndexDeImagen: function( imagen ){
				return ko.utils.arrayIndexOf( this.data.snippets(), imagen );
			},

			establecerImagenActual: function( imagen ){
				var index = this.obtenerIndexDeImagen( imagen );
				this.imagenActualIndex( index );
			},

			siguienteImagen: function(){
				if ( !this.imagenActualEOF() ) this.imagenActualIndex( this.imagenActualIndex() + 1 );
			},

			anteriorImagen: function(){
				if ( ! this.imagenActualBOF() ) this.imagenActualIndex( this.imagenActualIndex() - 1 );
			},

			imagenActualBOF: function(){
				return this.imagenActualIndex() == 0;
			},

			imagenActualEOF: function(){
				return this.imagenActualIndex() == this.cantidadImagenes()  - 1;
			},

			indicadorImagenActual: function(){
				return [ this.imagenActualIndex() + 1, '/', this.cantidadImagenes() ].join('');
			},

			///////////////////////////////////////////

			thumbStyle: function( imageSnippet ){
				var ret = { background: 'none' };
				if( this.data.thumbBgColor() == 'average'){
					var url = imageSnippet.get({width:50, height:50, dominante: true});
					$.extend(ret,{
						background: $.string.format('url({0}) repeat ')( url )
					});
				}
				return ret;
			},

			linkStyle: function(){
				var altoGaleria = ko.unwrap( this.altoGaleria )
					, style
					, percent;

				if ( altoGaleria ){ // un valor distinto de nulo o cero
					if($.isPercent(this.data.alto())){
						percent = parseFloat(this.data.alto());
						style = { padding: percent/2 + '% 0' };
					} else {
						style = { height: altoGaleria };
					}
				} else {
					style = { padding: '28.1% 0'};
				}

				return style;
			},

			///////////////////////////////////////////


			agregarImagen: function() {
				var imagenes = this.cantidadImagenes();
				this.establecerImagenes( imagenes + 1 );
			},

			eliminarImagen: function() {
				var imagenes = this.cantidadImagenes();
				this.establecerImagenes( imagenes - 1 );
			},

			beforeEdit: function(){
				this.imagenes ( this.data.snippets().length );
			},

			afterEdit: function(){
				var self = this;
				this.establecerImagenes ( this.imagenes() );
			},

			editar: function(){},

			///////////////////////////////////////////

			canContainChildSnippet: function( snippet ){
				return this._parent.apply( this, arguments ) && snippet instanceof namespace.Snippet.Imagen;
			},

			toJS: function(){
				var result = this._parent.apply( this, arguments )
					, alto;

				result.data.interval = parseInt ( result.data.interval  ) || 5;


				alto = parseFloat ( result.data.alto ) || null;
				result.data.alto = alto ? alto + ( $.isPercent( result.data.alto ) ? '%' : '' ) : alto;

				return result;
			}
		}
	});


	////////////////////////////////////////////////////////////////////////////
	namespace.Snippet.TextoEnriquecido = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.texto_enriquecido.texto_enriquecido'),
		descripcion	: ko.observable('snippets:snippet.texto_enriquecido.agrega_una_caja_de_texto_y_personaliza_el_color_tamano_de_tipografia_y_mas'),

		prototype: {
			init: function( data ){
				var args = $.extend([], arguments);
				/*
				if( !data ){
					args[0] = {
						data: {
							contenido: i18n.kot('snippets:snippet.texto_enriquecido.este_es_un_texto_enriquecido')
						}
					};
				};
				*/
				
				this._parent.apply(this, args);

				this.data.contenido.overflow = ko.computed( function(){
					return this.data.contenido().length > 30000;
				}, this );
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'textoEnriquecido',
					data: {
						contenido: i18n.kot('snippets:snippet.texto_enriquecido.este_es_un_texto_enriquecido')
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-richtext'
				});
			},

			editar: function(){
				var self = this;
				$.prompt('Contenido').done(function(data){
					self.data.contenido(data);
				});
			},

			beforeAccept: function( deferred ){
				var overflow = ko.unwrap( this.data.contenido.overflow );
				if( overflow ){
					deferred.reject(i18n.kot('snippets:snippet.texto_enriquecido.el_contenido_debe_ser_menor_a_30_000_caracteres'));
				} else {
					deferred.resolve(true);
				}
				return deferred;
			}
		}
	});


	////////////////////////////////////////////////////////////////////////////
        
        namespace.Snippet.CodigoPersonalizado = namespace.Snippet.extend({
		nombre		: ko.observable('Cdigo Personalizado'),
		descripcion	: ko.observable('Permite Ingresar Cdigo HTML'),

		prototype: {
                      
			init: function( data ){
                       
                                if (data !== undefined){
                                   
                                   var codigoCustom = data.data.contenido;
                                   
                                   try {    
                                        data.data.contenido = codigoCustom ; 
                                   }catch(error){
                                       // error cargando cdigo personalizado
                                   }
                                }
                                
				var args = $.extend([], arguments);
				this._parent.apply(this, args);
				this.data.contenido.overflow = ko.computed( function(){
					return this.data.contenido().length > 30000;
				}, this );
                                
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'codigoPersonalizado',
					data: {
						//contenido: i18n.kot('snippets:snippet.texto_enriquecido.este_es_un_texto_enriquecido')
                                                contenido: '<b>Ingrese su cdigo personalizado.</b>',
                                                contenidoSanitizado : '', 
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-iframe'
				});
			},

			editar: function(){
				var self = this;
				$.prompt('Contenido').done(function(data){
					self.data.contenido(data);
				});
			},
                            
			beforeAccept: function( deferred ){
                                
                           try {
                               var valorEditor = editor.getValue();
                                    try {

                                        if ( tiendasimple.helpers.Utils.checkJs( valorEditor ) == 0 ) {
                                            this.data.contenido( valorEditor );
                                        }else{
                                            if (valorEditor.indexOf('<!--') == -1){
                                                this.data.contenido('\n <!-- ' + valorEditor + ' -->');
                                            }else{
                                                this.data.contenido( valorEditor );
                                            }
                                        }

                                    }catch(error){
                                        this.data.contenido('\n <!-- ' + valorEditor + ' -->');
                                    } 
                                  
                           }catch(error){
                                       
                           } 
                                    
				var overflow = ko.unwrap( this.data.contenido.overflow );
                                
				if( overflow ){
					deferred.reject(i18n.kot('snippets:snippet.texto_enriquecido.el_contenido_debe_ser_menor_a_30_000_caracteres'));
				} else {
					deferred.resolve(true);
				}
                                
				return deferred;
			},
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Titulo = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.titulo.titulo'),
		descripcion	: ko.observable('snippets:snippet.titulo.agrega_una_caja_de_texto_de_tipo_titulo'),
		tamanoVentanaEdicion	: 'large',

		lineHeightOptions: [
			{ text: .5, value: 50 },
			{ text: .75, value: 75 },
			{ text: 1, value: 100},
			{ text: 1.25, value: 125},
			{ text: 1.5, value: 150},
			{ text: 2, value: 200},
			{ text: 3, value: 300}
		],

		animationNameOptions: [
			{ text: 'Sin animacin', value: '' },
			{ text: 'Mquina de escribir - lento', value: 'typein' },
			{ text: 'Mquina de escribir - moderado', value: 'typein-fast' },
			{ text: 'Mquina de escribir - rpido', value: 'typein-ultrafast' }
		],

		fontFamilyOptions: [
			{text: 'Lato', value: 'Lato', genericFamily: 'sans-serif', styles: [
				{text: 'Thin', value: '100', fontWeight: 100 },
				{text: 'Thin Italic', value: '100italic', fontWeight: 100, fontStyle:'italic' },
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Light Italic', value: '300italic', fontWeight: 300, fontStyle:'italic' },
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Normal Italic', value: '400italic', fontWeight: 400, fontStyle:'italic' },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Bold Italic', value: '700italic', fontWeight: 700, fontStyle:'italic' },
				{text: 'Ultra-Bold', value: '900', fontWeight: 900 },
				{text: 'Ultra-Bold Italic', value: '900italic', fontWeight: 900, fontStyle:'italic' }
			]},
			{text: 'Pacifico', value: 'Pacifico', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Open Sans', value: 'Open Sans', genericFamily: 'sans-serif', styles: [
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Light Italic', value: '300italic', fontWeight: 300, fontStyle:'italic' },
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Normal Italic', value: '400italic', fontWeight: 400, fontStyle:'italic' },
				{text: 'Semi-Bold', value: '600', fontWeight: 600 },
				{text: 'Semi-Bold Italic', value: '600italic', fontWeight: 600, fontStyle:'italic' },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Bold Italic', value: '700italic', fontWeight: 700, fontStyle:'italic' },
				{text: 'Extra-Bold', value: '800', fontWeight: 800 },
				{text: 'Extra-Bold Italic', value: '800italic', fontWeight: 800, fontStyle:'italic' }
			]},
			{text: 'Open Sans Condensed', value: 'Open Sans Condensed', genericFamily: 'sans-serif', styles: [
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Light Italic', value: '300italic', fontWeight: 300, fontStyle:'italic' },
				{text: 'Bold', value: '700', fontWeight: 700 }
			]},
			{text: 'Amatic SC', value: 'Amatic SC', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: '400'},
				{text: 'Bold', value: '700', fontWeight: '700'}
			]},
			{text: 'Indie Flower', value: 'Indie Flower', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: '400'}
			]},
			{text: 'Roboto Slab', value: 'Roboto Slab', genericFamily: 'serif', styles: [
				{text: 'Thin', value: '100', fontWeight: '100'},
				{text: 'Light', value: '300', fontWeight: '300'},
				{text: 'Normal', value: '400', fontWeight: '400'},
				{text: 'Bold', value: '700', fontWeight: '700'}
			]},
			{text: 'Merriweather', value: 'Merriweather', genericFamily: 'serif', styles: [
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Light Italic', value: '300italic', fontWeight: 300, fontStyle:'italic' },
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Normal Italic', value: '400italic', fontWeight: 400, fontStyle:'italic' },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Bold Italic', value: '700italic', fontWeight: 700, fontStyle:'italic' },
				{text: 'Ultra-Bold', value: '900', fontWeight: 900 },
				{text: 'Ultra-Bold Italic', value: '900italic', fontWeight: 900, fontStyle:'italic' }
			]},
			{text: 'Source Sans Pro', value: 'Source Sans Pro', genericFamily: 'sans-serif', styles: [
				{text: 'Extra-Light', value: '100', fontWeight: 100 },
				{text: 'Extra-Light Italic', value: '100italic', fontWeight: 100, fontStyle:'italic' },
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Light Italic', value: '300italic', fontWeight: 300, fontStyle:'italic' },
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Normal Italic', value: '400italic', fontWeight: 400, fontStyle:'italic' },
				{text: 'Semi-Bold', value: '600', fontWeight: 600 },
				{text: 'Semi-Bold Italic', value: '600italic', fontWeight: 600, fontStyle:'italic' },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Bold Italic', value: '700italic', fontWeight: 700, fontStyle:'italic' },
				{text: 'Ultra-Bold', value: '900', fontWeight: 900 },
				{text: 'Ultra-Bold Italic', value: '900italic', fontWeight: 900, fontStyle:'italic' }
			]},
			{text: 'Montserrat', value: 'Montserrat', genericFamily: 'sans-serif', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Bold', value: '700', fontWeight: 700 }
			]},
			{text: 'Raleway', value: 'Raleway', genericFamily: 'sans-serif', styles: [
				{text: 'Thin', value: '100', fontWeight: 100 },
				{text: 'Extra-Light', value: '200', fontWeight: 200 },
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Medium', value: '500', fontWeight: 500 },
				{text: 'Semi-Bold', value: '600', fontWeight: 600 },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Extra-Bold', value: '800', fontWeight: 800 },
				{text: 'Ultra-Bold', value: '900', fontWeight: 900 }
			]},
			{text: 'Ubuntu', value: 'Ubuntu', genericFamily: 'sans-serif', styles: [
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Light Italic', value: '300italic', fontWeight: 300, fontStyle:'italic' },
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Normal Italic', value: '400italic', fontWeight: 400, fontStyle:'italic' },
				{text: 'Medium', value: '500', fontWeight: 500 },
				{text: 'Medium Italic', value: '500italic', fontWeight: 500, fontStyle:'italic' },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Bold Italic', value: '700italic', fontWeight: 700, fontStyle:'italic' }
			]},
			{text: 'Poiret One', value: 'Poiret One', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Lobster Two', value: 'Lobster Two', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Normal Italic', value: '400italic', fontWeight: 400, fontStyle:'italic' },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Bold Italic', value: '700italic', fontWeight: 700, fontStyle:'italic' }
			]},
			{text: 'Dancing Script', value: 'Dancing Script', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Bold', value: '700', fontWeight: 700 }
			]},
			{text: 'Gloria Hallelujah', value: 'Gloria Hallelujah', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Kaushan Script', value: 'Kaushan Script', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Cinzel', value: 'Cinzel', genericFamily: 'serif', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 },
				{text: 'Bold', value: '700', fontWeight: 700 },
				{text: 'Ultra-Bold', value: '900', fontWeight: 900 }
			]},
			{text: 'Handlee', value: 'Handlee', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Fredericka the Great', value: 'Fredericka the Great', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Frijole', value: 'Frijole', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Ribeye Marrow', value: 'Ribeye Marrow', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Original Surfer', value: 'Original Surfer', genericFamily: 'cursive', styles: [
				{text: 'Normal', value: '400', fontWeight: 400 }
			]},
			{text: 'Codystar', value: 'Codystar', genericFamily: 'cursive', styles: [
				{text: 'Light', value: '300', fontWeight: 300 },
				{text: 'Normal', value: '400', fontWeight: 400 }
			]}
		].sort($.createSortFN(['text'])),

		getFontFamilyStylesOptions: function( fontFamilyName ){
			var result = [];
			var fontFamily = ko.utils.arrayFirst( this.fontFamilyOptions, function( fontFamily ){
				return fontFamily.value == fontFamilyName;
			});
			if( fontFamily && fontFamily.styles ) {
				result = fontFamily.styles;
				result.fontFamily = fontFamily;
			}
			return result;
		},

		getFontFamilyStyle: function( fontFamily, fontFamilyStyle ){
			var result
				, styleOptions = this.getFontFamilyStylesOptions( fontFamily );
			result = ko.utils.arrayFirst( styleOptions, function( styleOption ){
				return styleOption.value == fontFamilyStyle;
			});
			if( result && styleOptions) result.fontFamily = styleOptions.fontFamily;

			return result;
		},


		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
				if( this.data.tipoConfiguracion() === null ){
					if( this.estaPersonalizado() ) {
						this.data.tipoConfiguracion('local');
					} else {
						this.data.tipoConfiguracion('');
					}
				}
				this._createComputed();
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'titulo',
					data: {
						contenido	: i18n.kot('snippets:snippet.titulo.este_es_un_titulo'),
						href		: '',
						css			: '',

						tipoConfiguracion	: null, // null | 'global' | 'local'
						color				: '',
						fontFamily			: '',
						fontFamilyStyle		: '',
						fontSize			: '',
						lineHeight			: '',

						italic          : false,
						strong          : false,
						lineThrough     : false,
						underline       : false,

						animationName		: '',
						animationSpeed		: 100
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-title',
					esLinkeable	: true
				});
			},

			_createComputed: function(){

				this.formattingElements = ko.computed(function(){
					var arrayVariants = []
						, strong = this.data.strong()
						, italic = this.data.italic()
						, lineThrough = this.data.lineThrough()
						, underline = this.data.underline();

					if( strong ) arrayVariants.push('strong');
					if( italic ) arrayVariants.push('em');
					if( lineThrough ) arrayVariants.push('del');
					if( underline ) arrayVariants.push('ins');

					return arrayVariants;
				}, this);

				this.fontDescriptorThrottled = ko.computed( function(){
					return this.getFontDescriptor();
				}, this).extend({throttle: 100});

				this.data.fontSize.extend( { asUnit: { units: ['px', '%'], defaultUnit: 'px' } } );
				this.data.lineHeight.extend( { asUnit: { units: ['%'], defaultUnit: '%' } } );
			},


			editar: true,

			getTreeNodeDescription: function(){
				return ko.unwrap( this.data.contenido ) || this._parent();
			},

			getTreeNodeDescriptionHtml: function(){
				return $('<strong>').html( $.string.encodeHTML( this.getTreeNodeDescription() ) ).outerHTML();
			},

			getFontStyle: function( options ){
				var options = $.extend({
					fontSizeMultiplier : 1
				}, options )
					, data = this.data
					, result = {
					fontFamily		: '',
					fontSize		: '',
					lineHeight		: '',
					fontWeight		: '',
					fontStyle		: ''
				}
					, fontSize = '';

				if( options.defaultData ){
					data = options.defaultData
				}

				fontSize = data.fontSize();
				/*
				if( data.fontSize() && data.fontSizeResponsive() ){
					var fontSizeValue = data.fontSize.value();

					if( options.window ){
						if( options.window.visiblePhone() ){
							options.fontSizeMultiplier = .5;
						}

						if( options.window.visibleTablet() ){
							options.fontSizeMultiplier = .75;
						}
					}

					if( data.fontSize.unit() == 'px' && fontSizeValue >= this.constructor.maxFontSizeResponsive ){
						var newFontSizeValue = fontSizeValue * options.fontSizeMultiplier;
						newFontSizeValue = Math.max( this.constructor.maxFontSizeResponsive, newFontSizeValue );
						fontSize = [ newFontSizeValue , data.fontSize.unit() ].join('');
					}
				}
				*/

				result['fontFamily']	= data.fontFamily();
				result['fontSize']		= fontSize;
				result['lineHeight']	= data.lineHeight();

				var fontStyle = this.constructor.getFontFamilyStyle( data.fontFamily(), data.fontFamilyStyle() );
				if( fontStyle ){
					result['fontWeight']	= fontStyle.fontWeight;
					result['fontStyle']		= fontStyle.fontStyle;
					result['letterSpacing']	= 'initial';
					result['lineHeight']	= result['lineHeight'] || 'initial';
					if( fontStyle.fontFamily && fontStyle.fontFamily.genericFamily ){
						result['fontFamily'] += ', ' + fontStyle.fontFamily.genericFamily;
					}
				}

				if( result['fontSize'] && !result['lineHeight'] ){
					result['lineHeight'] = 'initial';
				}

				return result;
			},

			getStyle: function( options ){
				var options = $.extend( {}, options )
					,result = {
						whiteSpace		: '',
						textAlign		: '',
						color			: '',
						textTransform	: '',
						fontFamily		: '',
						fontSize		: '',
						lineHeight		: '',
						fontWeight		: '',
						fontStyle		: '',
						letterSpacing	: ''
					}
					, data = this.data;

				result['whiteSpace']	= this.data.href() && this.data.align() == 'justify' ? 'pre-line' : '';
				result['textAlign'] 	= data.align();

				if( this.data.tipoConfiguracion() ){
					if( this.data.tipoConfiguracion() == 'global' && options.defaultData ){
						data = options.defaultData;
					}
					result['color']			=  this.fixColor( data.color() ) || '';
					result['textTransform']	= data.fontFamily() ? 'initial': '';

					$.extend(result, this.getFontStyle( options ) );
				}

				return result;
			},

			getStyleOffline: function( options ){
				var options = $.extend( {}, options )
					, data = this.data
					, textDecoration = []
					, result = $.extend({
						fontWeight		: '',
						fontStyle		: '',
						textDecoration	: ''
					}, this.getStyle(options));

				result['color'] = '';
				result['fontSize'] = '';
				result['lineHeight'] = '';

				if( data.strong() ){
					result['fontWeight'] = 'bold';
				}

				if( data.italic() ){
					result['fontStyle'] = 'italic';
				}

				if( data.underline() ){
					textDecoration.push('underline');
				}

				if( data.lineThrough() ){
					textDecoration.push('line-through');
				}

				$.extend(result, {textDecoration: textDecoration.join(' ')});

				return result;
			},

			estaPersonalizado: function(){
				var self = this
					, result = false
					, camposPersonalizables = ['color', 'fontSize', 'lineHeight', 'fontFamily', 'fontFamilyStyle'];
				result = $.any( camposPersonalizables, function( key, campoPersonalizable ){
					return !self.propertyHasDefaultValue('data.' + campoPersonalizable );
				})
				return result;
			},

			getFontDescriptor: function(){
				var fontFamily = ko.unwrap( this.data.fontFamily)
					, fontFamilyStyle = ko.unwrap( this.data.fontFamilyStyle )
					, theFont = this.constructor.getFontFamilyStyle( fontFamily, fontFamilyStyle )
					, result = '';
				if( theFont ){
					result = GFontApi.getInstance().getFontDescriptor( fontFamily , fontFamilyStyle );
				}
				return result;
			},

			appendFont: function(){
				var fontFamily = ko.unwrap( this.data.fontFamily)
					, fontFamilyStyle = ko.unwrap( this.data.fontFamilyStyle )
					, theFont = this.constructor.getFontFamilyStyle( fontFamily, fontFamilyStyle );

				if( theFont ){
					GFontApi.getInstance().addFont( fontFamily , fontFamilyStyle );
				}
			},

			getInfo: function(){
				return 	this.getFontDescriptor();

			},

			isAnimationTypein: function(){
				return $.string.startsWith( this.data.animationName(), 'typein' );
			},

			getAnimationSpeed: function(){
				var result = this.data.animationSpeed()
					, animationName = this.data.animationName();
				if( this.isAnimationTypein() ) {
					if($.string.endsWith( animationName , '-fast' )){
						result = 50;
					} else if($.string.endsWith( animationName , '-ultrafast' )){
						result = 10;
					}
				}
				return result;
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Subtitulo = namespace.Snippet.Titulo.extend({
		nombre		: ko.observable('snippets:snippet.subtitulo.subtitulo'),
		descripcion	: ko.observable('snippets:snippet.subtitulo.agrega_una_caja_de_texto_de_tipo_subtitulo'),

		prototype	: {
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'subtitulo',
					data: {
						contenido	: i18n.kot('snippets:snippet.subtitulo.este_es_un_subtitulo'),
						color		: null
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-subtitle',
					esLinkeable	: true

				});
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Parrafo = namespace.Snippet.Titulo.extend({
		nombre		: ko.observable('snippets:snippet.parrafo.parrafo'),
		descripcion	: ko.observable('snippets:snippet.parrafo.agrega_una_caja_de_texto_de_tipo_parrafo'),

		prototype: {
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo : 'parrafo',
					data : {
						contenido	: i18n.kot('snippets:snippet.parrafo.este_es_un_parrafo'),
						color		: null					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-paragraph',
					esLinkeable	: true
				});
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Mapa = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.mapa.mapa'),
		descripcion	: ko.observable('snippets:snippet.mapa.agrega_un_mapa_a_tu_pagina_con_la_ubicacion_que_desees_mostrar'),

		prototype	: {
			init: function(){
				this._parent.apply(this, arguments);

				if( !this.puedeSerInteractivo() ){
					this.data.interactivo = this.data.interactivo.extend({
						prefilter: {
							write: function( value ){
								return true;
							}
						}
					});
				}
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'mapa',
					data: {
						interactivo	: true, // desde el 11-08-2016 siempre ser interactivo hasta que google vuelva a dejar de solicitar api key
						direccion	: '',
						lat			: '',
						lon			: '',
						width		: null,
						height		: null
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-map'
				});
			},

			editar: function(){
				var self = this;
				$.prompt('Direccin').done(function(value){
					self.data.direccion(value);
				});
			},

			puedeSerInteractivo: function(){
				return false;
			}
		}
	});

	////////// SNIPPET ARCHIVO /////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////
        
        namespace.Snippet.Files = namespace.Snippet.extend({
			nombre		: ko.observable('Archivo'),
			descripcion	: ko.observable('Permite publicar archivos en su sitio web.'),
		
			prototype: {
				init: function( data ){
					var args = $.extend([], arguments);
					this._parent.apply(this, args);	
					if ( model.data !== undefined ){
						if (model.data.fileUploadWindow !== undefined){
							model.data.fileUploadWindow('');
						}
					}
				},
				_setMappeable: function(){
					var snippetIsEnabled = true;
					this._parent();
					this._mergeMappeable({
						tipo: 'files',
						seccionActiva : 'mis-archivos',
						files : [],
						data: {
							contenido: '<b>Elegir Archiclearvo.</b>',
							title : '',
							description : '',
							path : '',
							hash : '',
							folder : '',
							permission : 0, // public
						},
						isEnabled : snippetIsEnabled
					});
				},
				
				_setDefaults: function(){
					this._parent();
					this._mergeDefaults({
						icono				: 'icon-snippet-image',
						hasEditButtons		: false
					});
				},
				editar: function(){
					var self = this;
				},				
				beforeAccept: function( deferred ){
					var self = this;
					/* set title */
					if (typeof self.data.title !== "function"){
						self.data.title = model.data.fileUploadSelected();
					}else{	
						if (self.data.title() == ''){
							if (document.getElementById('file-upload-nombre-archivo').value !== ''){
								self.data.title(document.getElementById('file-upload-nombre-archivo').value);
							}else{
								self.data.title(model.data.fileUploadSelected());
							}
						}
					}
					/* additional data */
					var path = '';
					var file = model.data.fileUploadSelected();
					var folder = model.data.fileUploadPath();
					folder == '' ? path = file : path = folder + '/' + file;
					self.data.folder( model.data.fileUploadPath());
					self.data.path(model.data.fileUploadSelected());
					controller.createFileUploadLink( path, self.data.permission() )
						.then(function(hash){
							self.data.hash(hash);
							deferred.resolve(true);			
							return deferred;
						}).catch(function(err){
							// err
							deferred.resolve(false);			
							return deferred
						});			
				},
			}
		});
	
	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Imagen = namespace.Snippet.extend({
		nombre		: ko.observable( 'snippets:snippet.imagen.imagen' ),
		descripcion	: ko.observable( 'snippets:snippet.imagen.agrega_una_imagen_y_personaliza_sus_propiedades' ),

		getFXDefaultValues: function(){
			return {
				blur			: 0,
				colorize		: '',
				grayscale		: false,
				brightness		: 0,
				contrast		: 0,
				saturation		: 0,
				hue				: 0,
				spread			: 0
			};
		},

		getFXValues: function( what ){
			var defaultValues = this.getFXDefaultValues()
				, result = {};
			$.each( defaultValues, function( key, value ){
				var customValue = ko.unwrap( what.data ? what.data[key] : what[key] )
				if( value != customValue ) {
					result[key] = customValue;
				}
			});
			return result;
		},


		prototype: {
			init: function(){
				this._parent.apply(this, arguments);

				this.inlineBlock = ko.computed(function(){
					return this.isInsideGaleria() ? ( this.isInsideSliderModal() ? false : true ) : !this.data.escalarAlMaximo();
				}, this);

				this.draggable = ko.computed( function(){
					return !this.isInsideSliderModal();
				}, this);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'imagen',
					data: {
						id: 0,
						escalarAlMaximo	: false,
						tipoEscala		: 'stretch',
						width			: null,
						height			: null,
						margin			: null,
						padding			: null,
						backgroundColor	: null,
						title			: '',
						alt				: '',

						fxEnable		: false,
						grayscale		: false,
						blur			: 0,
						colorize		: '',
						brightness		: 0,
						contrast		: 0,
						saturation		: 0,
						hue				: 0,
						spread			: 0,

						href			: ''
					}
				})
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono		: 'icon-snippet-picture',
					inlineBlock	: true,
					esLinkeable	: true
				})
			},

			_getComplexityValue: function(){
				var result = this._parent.apply( this, arguments );
				if( this.data.id() ){
					result += 1;
				}
				return result;
			},

			editar: true,

			get: function(options){
				var params = {
					id			: this.data.id(),
					tipoEscala	: this.data.tipoEscala(),
					width		: this.data.width() || undefined,
					height		: this.data.height() || undefined,
					padding		: this.data.padding(),
					color		:  this.fixColor( this.data.backgroundColor() ) || '',
				};

				if( this.data.fxEnable() ) {
					$.extend( params, {
						grayscale	: this.data.grayscale(),
						blur		: this.data.blur(),
						colorize	: this.data.colorize(),
						brightness	: this.data.brightness(),
						contrast	: this.data.contrast(),
						saturation	: this.data.saturation(),
						hue			: this.data.hue(),
						spread		: this.data.spread()
					});
				}

				options = $.extend( params, options );

				options = $.getSelectedProperties(options, function(propertyname, value){return value});

				return 'galeriaimagenes/obtenerimagen/?' + $.param(options);
			},
			/*
			getDominantColor: function( options ){
				options = $.extend({
					id			: this.data.id(),
					tipoEscala	: this.data.tipoEscala(),
					width		: this.data.width() || undefined,
					height		: this.data.height() || undefined,
					padding		: this.data.padding(),
					color		: this.data.backgroundColor()
				}, options);

				options = $.getSelectedProperties(options, function(propertyname, value){return value});

				return 'galeriaimagenes/obtenerdominante/?' + $.param(options);				
			},
			*/

			getScaledDimensions: function(_width, _height, tolerance) { 
				var sourceWidth = this.data.width(),
					sourceHeight = this.data.height(),
					sourceProp = sourceWidth / (sourceHeight || 1),
					destProp = _width / (_height || 1),
					destWidth = _width,
					destHeight = _height,
					dWidth, dHeight;

				if( !tolerance ) tolerance = 1;

				if(sourceWidth && sourceHeight){
					if(sourceProp < destProp){
						destHeight = destWidth / sourceProp;
					} else {
						destWidth = destHeight * sourceProp;
					}
				}

				dWidth = Math.abs( destWidth - _width );
				dHeight = Math.abs( destHeight - _height );

				if( dWidth < tolerance ) destWidth = _width;
				if( dHeight < tolerance ) destHeight = _height;

				return [ Math.ceil(destWidth), Math.ceil(destHeight) ];
			},

			esEliminable: function( $context ){
				var eliminable = this._parent.apply( this, arguments );
				return eliminable && !$context.insideSliderModal;
			},

			esDuplicable: function($context){
				var duplicable = this._parent.apply( this, arguments );
				return duplicable && !$context.insideSliderModal;
			},

			isInsideGaleria: function(){
				var parent = this.getParentSnippet();
				return parent && parent instanceof namespace.Snippet.Galeria;
			},

			isInsideGaleriaModal: function(){
				return this.isInsideGaleria() && this.getParentSnippet().data.tipoGaleria() == 'galeriaModal';
			},

			isInsideSliderModal: function(){
				return this.isInsideGaleria() && this.getParentSnippet().data.tipoGaleria() == 'sliderModal';
			},

			getFXValues: function(){
				return this.constructor.getFXValues( this );
			}
		}
	});


	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Icono = namespace.Snippet.extend({
		nombre		: ko.observable( 'snippets:snippet.icono.icono' ),
		descripcion	: ko.observable( 'snippets:snippet.icono.agrega_iconos_con_la_figura_que_mas_te_guste_y_personaliza_su_tamano_color_y_mas' ),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'icono',
					data: {
						nombre	: 'icon-heart',
						href	: '',
						color		: null,

						spin	: false,
						rotate	: null,
						flipH	: null,
						flipV	: null,
						tamano	: '4x',
						fixedWidth	: false
					}
				})
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono		: 'icon-snippet-icono',
					inlineBlock	: true,
					esLinkeable	: true
				});
			},

			editar: true,

			css: function(){
				var ret = [];
				ret.push( this.data.nombre() );
				if( this.data.tamano() ) ret.push('icon-' + this.data.tamano() );
				if( this.data.fixedWidth() ) ret.push('icon-fixed-width');
				if( this.data.flipH() ) ret.push('icon-flip-horizontal' );
				if( this.data.flipV() ) ret.push('icon-flip-vertical' );
				if( this.data.rotate() ) ret.push('icon-rotate-' + this.data.rotate() );
				if( this.data.spin() ) ret.push('icon-spin' );
				return ret.join(' ');
			}

		}
	});

	////////////////////////////////////////////////////////////////////////////


	$.extend( namespace.Snippet.createSubClass('emoji', {
		mappeable			: {
			data			: {
				library		: 'emojione',    // emojione | twemoji | emojionebw
				contenido	: '\uD83D\uDE04',
				size		: '256'
			}
		},
		defaults			: {
			icono			: 'icon-snippet-emoji',
			inlineBlock	: true,

			selectedGroup	: 'people',

			editar			: true
		},

		mapping: {

		}

	}, namespace.Snippet), {
		nombre				: ko.observable( 'Emoji' ),
		tamanoVentanaEdicion		: 'large',

		emojiLibraries: [
			{
				name		: 'emojione',
				description	: 'Emoji One'
			},
			{
				name	: 'emojionebw',
				description	: 'Emoji One BW'
			},
			{
				name	: 'twemoji',
				description	: 'Twitter Emoji'
			}
		],

		/*
		script para recuperar emojis desde la pgina http://emojione.com/demo/

		 $=jQuery;JSON.stringify($('#emoji-gallery').find('li a').map(function(element){ return {
		 description: $(this).attr('title'),
		 shortname: $(this).attr('data-shortname'),
		 codePoint: $(this).attr('id')
		 }}).toArray())

		*/

		emojisGroups: [

			{ name:'people', description: 'Smileys & People', codePoint:'1f603', emojis:
				[{"description":"grinning face","shortname":":grinning:","codePoint":"1f600"},{"description":"grimacing face","shortname":":grimacing:","codePoint":"1f62c"},{"description":"grinning face with smiling eyes","shortname":":grin:","codePoint":"1f601"},{"description":"face with tears of joy","shortname":":joy:","codePoint":"1f602"},{"description":"smiling face with open mouth","shortname":":smiley:","codePoint":"1f603"},{"description":"smiling face with open mouth and smiling eyes","shortname":":smile:","codePoint":"1f604"},{"description":"smiling face with open mouth and cold sweat","shortname":":sweat_smile:","codePoint":"1f605"},{"description":"smiling face with open mouth and tightly-closed eyes","shortname":":laughing:","codePoint":"1f606"},{"description":"smiling face with halo","shortname":":innocent:","codePoint":"1f607"},{"description":"winking face","shortname":":wink:","codePoint":"1f609"},{"description":"smiling face with smiling eyes","shortname":":blush:","codePoint":"1f60a"},{"description":"slightly smiling face","shortname":":slight_smile:","codePoint":"1f642"},{"description":"upside-down face","shortname":":upside_down:","codePoint":"1f643"},{"description":"white smiling face","shortname":":relaxed:","codePoint":"263a"},{"description":"face savouring delicious food","shortname":":yum:","codePoint":"1f60b"},{"description":"relieved face","shortname":":relieved:","codePoint":"1f60c"},{"description":"smiling face with heart-shaped eyes","shortname":":heart_eyes:","codePoint":"1f60d"},{"description":"face throwing a kiss","shortname":":kissing_heart:","codePoint":"1f618"},{"description":"kissing face","shortname":":kissing:","codePoint":"1f617"},{"description":"kissing face with smiling eyes","shortname":":kissing_smiling_eyes:","codePoint":"1f619"},{"description":"kissing face with closed eyes","shortname":":kissing_closed_eyes:","codePoint":"1f61a"},{"description":"face with stuck-out tongue and winking eye","shortname":":stuck_out_tongue_winking_eye:","codePoint":"1f61c"},{"description":"face with stuck-out tongue and tightly-closed eyes","shortname":":stuck_out_tongue_closed_eyes:","codePoint":"1f61d"},{"description":"face with stuck-out tongue","shortname":":stuck_out_tongue:","codePoint":"1f61b"},{"description":"money-mouth face","shortname":":money_mouth:","codePoint":"1f911"},{"description":"nerd face","shortname":":nerd:","codePoint":"1f913"},{"description":"smiling face with sunglasses","shortname":":sunglasses:","codePoint":"1f60e"},{"description":"hugging face","shortname":":hugging:","codePoint":"1f917"},{"description":"smirking face","shortname":":smirk:","codePoint":"1f60f"},{"description":"face without mouth","shortname":":no_mouth:","codePoint":"1f636"},{"description":"neutral face","shortname":":neutral_face:","codePoint":"1f610"},{"description":"expressionless face","shortname":":expressionless:","codePoint":"1f611"},{"description":"unamused face","shortname":":unamused:","codePoint":"1f612"},{"description":"face with rolling eyes","shortname":":rolling_eyes:","codePoint":"1f644"},{"description":"thinking face","shortname":":thinking:","codePoint":"1f914"},{"description":"flushed face","shortname":":flushed:","codePoint":"1f633"},{"description":"disappointed face","shortname":":disappointed:","codePoint":"1f61e"},{"description":"worried face","shortname":":worried:","codePoint":"1f61f"},{"description":"angry face","shortname":":angry:","codePoint":"1f620"},{"description":"pouting face","shortname":":rage:","codePoint":"1f621"},{"description":"pensive face","shortname":":pensive:","codePoint":"1f614"},{"description":"confused face","shortname":":confused:","codePoint":"1f615"},{"description":"slightly frowning face","shortname":":slight_frown:","codePoint":"1f641"},{"description":"white frowning face","shortname":":frowning2:","codePoint":"2639"},{"description":"persevering face","shortname":":persevere:","codePoint":"1f623"},{"description":"confounded face","shortname":":confounded:","codePoint":"1f616"},{"description":"tired face","shortname":":tired_face:","codePoint":"1f62b"},{"description":"weary face","shortname":":weary:","codePoint":"1f629"},{"description":"face with look of triumph","shortname":":triumph:","codePoint":"1f624"},{"description":"face with open mouth","shortname":":open_mouth:","codePoint":"1f62e"},{"description":"face screaming in fear","shortname":":scream:","codePoint":"1f631"},{"description":"fearful face","shortname":":fearful:","codePoint":"1f628"},{"description":"face with open mouth and cold sweat","shortname":":cold_sweat:","codePoint":"1f630"},{"description":"hushed face","shortname":":hushed:","codePoint":"1f62f"},{"description":"frowning face with open mouth","shortname":":frowning:","codePoint":"1f626"},{"description":"anguished face","shortname":":anguished:","codePoint":"1f627"},{"description":"crying face","shortname":":cry:","codePoint":"1f622"},{"description":"disappointed but relieved face","shortname":":disappointed_relieved:","codePoint":"1f625"},{"description":"sleepy face","shortname":":sleepy:","codePoint":"1f62a"},{"description":"face with cold sweat","shortname":":sweat:","codePoint":"1f613"},{"description":"loudly crying face","shortname":":sob:","codePoint":"1f62d"},{"description":"dizzy face","shortname":":dizzy_face:","codePoint":"1f635"},{"description":"astonished face","shortname":":astonished:","codePoint":"1f632"},{"description":"zipper-mouth face","shortname":":zipper_mouth:","codePoint":"1f910"},{"description":"face with medical mask","shortname":":mask:","codePoint":"1f637"},{"description":"face with thermometer","shortname":":thermometer_face:","codePoint":"1f912"},{"description":"face with head-bandage","shortname":":head_bandage:","codePoint":"1f915"},{"description":"sleeping face","shortname":":sleeping:","codePoint":"1f634"},{"description":"sleeping symbol","shortname":":zzz:","codePoint":"1f4a4"},{"description":"pile of poo","shortname":":poop:","codePoint":"1f4a9"},{"description":"smiling face with horns","shortname":":smiling_imp:","codePoint":"1f608"},{"description":"imp","shortname":":imp:","codePoint":"1f47f"},{"description":"japanese ogre","shortname":":japanese_ogre:","codePoint":"1f479"},{"description":"japanese goblin","shortname":":japanese_goblin:","codePoint":"1f47a"},{"description":"skull","shortname":":skull:","codePoint":"1f480"},{"description":"ghost","shortname":":ghost:","codePoint":"1f47b"},{"description":"extraterrestrial alien","shortname":":alien:","codePoint":"1f47d"},{"description":"robot face","shortname":":robot:","codePoint":"1f916"},{"description":"smiling cat face with open mouth","shortname":":smiley_cat:","codePoint":"1f63a"},{"description":"grinning cat face with smiling eyes","shortname":":smile_cat:","codePoint":"1f638"},{"description":"cat face with tears of joy","shortname":":joy_cat:","codePoint":"1f639"},{"description":"smiling cat face with heart-shaped eyes","shortname":":heart_eyes_cat:","codePoint":"1f63b"},{"description":"cat face with wry smile","shortname":":smirk_cat:","codePoint":"1f63c"},{"description":"kissing cat face with closed eyes","shortname":":kissing_cat:","codePoint":"1f63d"},{"description":"weary cat face","shortname":":scream_cat:","codePoint":"1f640"},{"description":"crying cat face","shortname":":crying_cat_face:","codePoint":"1f63f"},{"description":"pouting cat face","shortname":":pouting_cat:","codePoint":"1f63e"},{"description":"person raising both hands in celebration","shortname":":raised_hands:","codePoint":"1f64c"},{"description":"clapping hands sign","shortname":":clap:","codePoint":"1f44f"},{"description":"waving hand sign","shortname":":wave:","codePoint":"1f44b"},{"description":"thumbs up sign","shortname":":thumbsup:","codePoint":"1f44d"},{"description":"thumbs down sign","shortname":":thumbsdown:","codePoint":"1f44e"},{"description":"fisted hand sign","shortname":":punch:","codePoint":"1f44a"},{"description":"raised fist","shortname":":fist:","codePoint":"270a"},{"description":"victory hand","shortname":":v:","codePoint":"270c"},{"description":"ok hand sign","shortname":":ok_hand:","codePoint":"1f44c"},{"description":"raised hand","shortname":":raised_hand:","codePoint":"270b"},{"description":"open hands sign","shortname":":open_hands:","codePoint":"1f450"},{"description":"flexed biceps","shortname":":muscle:","codePoint":"1f4aa"},{"description":"person with folded hands","shortname":":pray:","codePoint":"1f64f"},{"description":"white up pointing index","shortname":":point_up:","codePoint":"261d"},{"description":"white up pointing backhand index","shortname":":point_up_2:","codePoint":"1f446"},{"description":"white down pointing backhand index","shortname":":point_down:","codePoint":"1f447"},{"description":"white left pointing backhand index","shortname":":point_left:","codePoint":"1f448"},{"description":"white right pointing backhand index","shortname":":point_right:","codePoint":"1f449"},{"description":"reversed hand with middle finger extended","shortname":":middle_finger:","codePoint":"1f595"},{"description":"raised hand with fingers splayed","shortname":":hand_splayed:","codePoint":"1f590"},{"description":"sign of the horns","shortname":":metal:","codePoint":"1f918"},{"description":"raised hand with part between middle and ring fingers","shortname":":vulcan:","codePoint":"1f596"},{"description":"writing hand","shortname":":writing_hand:","codePoint":"270d"},{"description":"nail polish","shortname":":nail_care:","codePoint":"1f485"},{"description":"mouth","shortname":":lips:","codePoint":"1f444"},{"description":"tongue","shortname":":tongue:","codePoint":"1f445"},{"description":"ear","shortname":":ear:","codePoint":"1f442"},{"description":"nose","shortname":":nose:","codePoint":"1f443"},{"description":"eye","shortname":":eye:","codePoint":"1f441"},{"description":"eyes","shortname":":eyes:","codePoint":"1f440"},{"description":"bust in silhouette","shortname":":bust_in_silhouette:","codePoint":"1f464"},{"description":"busts in silhouette","shortname":":busts_in_silhouette:","codePoint":"1f465"},{"description":"speaking head in silhouette","shortname":":speaking_head:","codePoint":"1f5e3"},{"description":"baby","shortname":":baby:","codePoint":"1f476"},{"description":"boy","shortname":":boy:","codePoint":"1f466"},{"description":"girl","shortname":":girl:","codePoint":"1f467"},{"description":"man","shortname":":man:","codePoint":"1f468"},{"description":"woman","shortname":":woman:","codePoint":"1f469"},{"description":"person with blond hair","shortname":":person_with_blond_hair:","codePoint":"1f471"},{"description":"older man","shortname":":older_man:","codePoint":"1f474"},{"description":"older woman","shortname":":older_woman:","codePoint":"1f475"},{"description":"man with gua pi mao","shortname":":man_with_gua_pi_mao:","codePoint":"1f472"},{"description":"man with turban","shortname":":man_with_turban:","codePoint":"1f473"},{"description":"police officer","shortname":":cop:","codePoint":"1f46e"},{"description":"construction worker","shortname":":construction_worker:","codePoint":"1f477"},{"description":"guardsman","shortname":":guardsman:","codePoint":"1f482"},{"description":"sleuth or spy","shortname":":spy:","codePoint":"1f575"},{"description":"father christmas","shortname":":santa:","codePoint":"1f385"},{"description":"baby angel","shortname":":angel:","codePoint":"1f47c"},{"description":"princess","shortname":":princess:","codePoint":"1f478"},{"description":"bride with veil","shortname":":bride_with_veil:","codePoint":"1f470"},{"description":"pedestrian","shortname":":walking:","codePoint":"1f6b6"},{"description":"runner","shortname":":runner:","codePoint":"1f3c3"},{"description":"dancer","shortname":":dancer:","codePoint":"1f483"},{"description":"woman with bunny ears","shortname":":dancers:","codePoint":"1f46f"},{"description":"man and woman holding hands","shortname":":couple:","codePoint":"1f46b"},{"description":"two men holding hands","shortname":":two_men_holding_hands:","codePoint":"1f46c"},{"description":"two women holding hands","shortname":":two_women_holding_hands:","codePoint":"1f46d"},{"description":"person bowing deeply","shortname":":bow:","codePoint":"1f647"},{"description":"information desk person","shortname":":information_desk_person:","codePoint":"1f481"},{"description":"face with no good gesture","shortname":":no_good:","codePoint":"1f645"},{"description":"face with ok gesture","shortname":":ok_woman:","codePoint":"1f646"},{"description":"happy person raising one hand","shortname":":raising_hand:","codePoint":"1f64b"},{"description":"person with pouting face","shortname":":person_with_pouting_face:","codePoint":"1f64e"},{"description":"person frowning","shortname":":person_frowning:","codePoint":"1f64d"},{"description":"haircut","shortname":":haircut:","codePoint":"1f487"},{"description":"face massage","shortname":":massage:","codePoint":"1f486"},{"description":"couple with heart","shortname":":couple_with_heart:","codePoint":"1f491"},{"description":"couple (woman,woman)","shortname":":couple_ww:","codePoint":"1f469-2764-1f469"},{"description":"couple (man,man)","shortname":":couple_mm:","codePoint":"1f468-2764-1f468"},{"description":"kiss","shortname":":couplekiss:","codePoint":"1f48f"},{"description":"kiss (woman,woman)","shortname":":kiss_ww:","codePoint":"1f469-2764-1f48b-1f469"},{"description":"kiss (man,man)","shortname":":kiss_mm:","codePoint":"1f468-2764-1f48b-1f468"},{"description":"family","shortname":":family:","codePoint":"1f46a"},{"description":"family (man,woman,girl)","shortname":":family_mwg:","codePoint":"1f468-1f469-1f467"},{"description":"family (man,woman,girl,boy)","shortname":":family_mwgb:","codePoint":"1f468-1f469-1f467-1f466"},{"description":"family (man,woman,boy,boy)","shortname":":family_mwbb:","codePoint":"1f468-1f469-1f466-1f466"},{"description":"family (man,woman,girl,girl)","shortname":":family_mwgg:","codePoint":"1f468-1f469-1f467-1f467"},{"description":"family (woman,woman,boy)","shortname":":family_wwb:","codePoint":"1f469-1f469-1f466"},{"description":"family (woman,woman,girl)","shortname":":family_wwg:","codePoint":"1f469-1f469-1f467"},{"description":"family (woman,woman,girl,boy)","shortname":":family_wwgb:","codePoint":"1f469-1f469-1f467-1f466"},{"description":"family (woman,woman,boy,boy)","shortname":":family_wwbb:","codePoint":"1f469-1f469-1f466-1f466"},{"description":"family (woman,woman,girl,girl)","shortname":":family_wwgg:","codePoint":"1f469-1f469-1f467-1f467"},{"description":"family (man,man,boy)","shortname":":family_mmb:","codePoint":"1f468-1f468-1f466"},{"description":"family (man,man,girl)","shortname":":family_mmg:","codePoint":"1f468-1f468-1f467"},{"description":"family (man,man,girl,boy)","shortname":":family_mmgb:","codePoint":"1f468-1f468-1f467-1f466"},{"description":"family (man,man,boy,boy)","shortname":":family_mmbb:","codePoint":"1f468-1f468-1f466-1f466"},{"description":"family (man,man,girl,girl)","shortname":":family_mmgg:","codePoint":"1f468-1f468-1f467-1f467"},{"description":"womans clothes","shortname":":womans_clothes:","codePoint":"1f45a"},{"description":"t-shirt","shortname":":shirt:","codePoint":"1f455"},{"description":"jeans","shortname":":jeans:","codePoint":"1f456"},{"description":"necktie","shortname":":necktie:","codePoint":"1f454"},{"description":"dress","shortname":":dress:","codePoint":"1f457"},{"description":"bikini","shortname":":bikini:","codePoint":"1f459"},{"description":"kimono","shortname":":kimono:","codePoint":"1f458"},{"description":"lipstick","shortname":":lipstick:","codePoint":"1f484"},{"description":"kiss mark","shortname":":kiss:","codePoint":"1f48b"},{"description":"footprints","shortname":":footprints:","codePoint":"1f463"},{"description":"high-heeled shoe","shortname":":high_heel:","codePoint":"1f460"},{"description":"womans sandal","shortname":":sandal:","codePoint":"1f461"},{"description":"womans boots","shortname":":boot:","codePoint":"1f462"},{"description":"mans shoe","shortname":":mans_shoe:","codePoint":"1f45e"},{"description":"athletic shoe","shortname":":athletic_shoe:","codePoint":"1f45f"},{"description":"womans hat","shortname":":womans_hat:","codePoint":"1f452"},{"description":"top hat","shortname":":tophat:","codePoint":"1f3a9"},{"description":"helmet with white cross","shortname":":helmet_with_cross:","codePoint":"26d1"},{"description":"graduation cap","shortname":":mortar_board:","codePoint":"1f393"},{"description":"crown","shortname":":crown:","codePoint":"1f451"},{"description":"school satchel","shortname":":school_satchel:","codePoint":"1f392"},{"description":"pouch","shortname":":pouch:","codePoint":"1f45d"},{"description":"purse","shortname":":purse:","codePoint":"1f45b"},{"description":"handbag","shortname":":handbag:","codePoint":"1f45c"},{"description":"briefcase","shortname":":briefcase:","codePoint":"1f4bc"},{"description":"eyeglasses","shortname":":eyeglasses:","codePoint":"1f453"},{"description":"dark sunglasses","shortname":":dark_sunglasses:","codePoint":"1f576"},{"description":"ring","shortname":":ring:","codePoint":"1f48d"},{"description":"closed umbrella","shortname":":closed_umbrella:","codePoint":"1f302"}]
			},
			{ name: 'nature', description: 'Animals & Nature', codePoint:'1f436', emojis:
				[{"description":"dog face","shortname":":dog:","codePoint":"1f436"},{"description":"cat face","shortname":":cat:","codePoint":"1f431"},{"description":"mouse face","shortname":":mouse:","codePoint":"1f42d"},{"description":"hamster face","shortname":":hamster:","codePoint":"1f439"},{"description":"rabbit face","shortname":":rabbit:","codePoint":"1f430"},{"description":"bear face","shortname":":bear:","codePoint":"1f43b"},{"description":"panda face","shortname":":panda_face:","codePoint":"1f43c"},{"description":"koala","shortname":":koala:","codePoint":"1f428"},{"description":"tiger face","shortname":":tiger:","codePoint":"1f42f"},{"description":"lion face","shortname":":lion_face:","codePoint":"1f981"},{"description":"cow face","shortname":":cow:","codePoint":"1f42e"},{"description":"pig face","shortname":":pig:","codePoint":"1f437"},{"description":"pig nose","shortname":":pig_nose:","codePoint":"1f43d"},{"description":"frog face","shortname":":frog:","codePoint":"1f438"},{"description":"octopus","shortname":":octopus:","codePoint":"1f419"},{"description":"monkey face","shortname":":monkey_face:","codePoint":"1f435"},{"description":"see-no-evil monkey","shortname":":see_no_evil:","codePoint":"1f648"},{"description":"hear-no-evil monkey","shortname":":hear_no_evil:","codePoint":"1f649"},{"description":"speak-no-evil monkey","shortname":":speak_no_evil:","codePoint":"1f64a"},{"description":"monkey","shortname":":monkey:","codePoint":"1f412"},{"description":"chicken","shortname":":chicken:","codePoint":"1f414"},{"description":"penguin","shortname":":penguin:","codePoint":"1f427"},{"description":"bird","shortname":":bird:","codePoint":"1f426"},{"description":"baby chick","shortname":":baby_chick:","codePoint":"1f424"},{"description":"hatching chick","shortname":":hatching_chick:","codePoint":"1f423"},{"description":"front-facing baby chick","shortname":":hatched_chick:","codePoint":"1f425"},{"description":"wolf face","shortname":":wolf:","codePoint":"1f43a"},{"description":"boar","shortname":":boar:","codePoint":"1f417"},{"description":"horse face","shortname":":horse:","codePoint":"1f434"},{"description":"unicorn face","shortname":":unicorn:","codePoint":"1f984"},{"description":"honeybee","shortname":":bee:","codePoint":"1f41d"},{"description":"bug","shortname":":bug:","codePoint":"1f41b"},{"description":"snail","shortname":":snail:","codePoint":"1f40c"},{"description":"lady beetle","shortname":":beetle:","codePoint":"1f41e"},{"description":"ant","shortname":":ant:","codePoint":"1f41c"},{"description":"spider","shortname":":spider:","codePoint":"1f577"},{"description":"scorpion","shortname":":scorpion:","codePoint":"1f982"},{"description":"crab","shortname":":crab:","codePoint":"1f980"},{"description":"snake","shortname":":snake:","codePoint":"1f40d"},{"description":"turtle","shortname":":turtle:","codePoint":"1f422"},{"description":"tropical fish","shortname":":tropical_fish:","codePoint":"1f420"},{"description":"fish","shortname":":fish:","codePoint":"1f41f"},{"description":"blowfish","shortname":":blowfish:","codePoint":"1f421"},{"description":"dolphin","shortname":":dolphin:","codePoint":"1f42c"},{"description":"spouting whale","shortname":":whale:","codePoint":"1f433"},{"description":"whale","shortname":":whale2:","codePoint":"1f40b"},{"description":"crocodile","shortname":":crocodile:","codePoint":"1f40a"},{"description":"leopard","shortname":":leopard:","codePoint":"1f406"},{"description":"tiger","shortname":":tiger2:","codePoint":"1f405"},{"description":"water buffalo","shortname":":water_buffalo:","codePoint":"1f403"},{"description":"ox","shortname":":ox:","codePoint":"1f402"},{"description":"cow","shortname":":cow2:","codePoint":"1f404"},{"description":"dromedary camel","shortname":":dromedary_camel:","codePoint":"1f42a"},{"description":"bactrian camel","shortname":":camel:","codePoint":"1f42b"},{"description":"elephant","shortname":":elephant:","codePoint":"1f418"},{"description":"goat","shortname":":goat:","codePoint":"1f410"},{"description":"ram","shortname":":ram:","codePoint":"1f40f"},{"description":"sheep","shortname":":sheep:","codePoint":"1f411"},{"description":"horse","shortname":":racehorse:","codePoint":"1f40e"},{"description":"pig","shortname":":pig2:","codePoint":"1f416"},{"description":"rat","shortname":":rat:","codePoint":"1f400"},{"description":"mouse","shortname":":mouse2:","codePoint":"1f401"},{"description":"rooster","shortname":":rooster:","codePoint":"1f413"},{"description":"turkey","shortname":":turkey:","codePoint":"1f983"},{"description":"dove of peace","shortname":":dove:","codePoint":"1f54a"},{"description":"dog","shortname":":dog2:","codePoint":"1f415"},{"description":"poodle","shortname":":poodle:","codePoint":"1f429"},{"description":"cat","shortname":":cat2:","codePoint":"1f408"},{"description":"rabbit","shortname":":rabbit2:","codePoint":"1f407"},{"description":"chipmunk","shortname":":chipmunk:","codePoint":"1f43f"},{"description":"paw prints","shortname":":feet:","codePoint":"1f43e"},{"description":"dragon","shortname":":dragon:","codePoint":"1f409"},{"description":"dragon face","shortname":":dragon_face:","codePoint":"1f432"},{"description":"cactus","shortname":":cactus:","codePoint":"1f335"},{"description":"christmas tree","shortname":":christmas_tree:","codePoint":"1f384"},{"description":"evergreen tree","shortname":":evergreen_tree:","codePoint":"1f332"},{"description":"deciduous tree","shortname":":deciduous_tree:","codePoint":"1f333"},{"description":"palm tree","shortname":":palm_tree:","codePoint":"1f334"},{"description":"seedling","shortname":":seedling:","codePoint":"1f331"},{"description":"herb","shortname":":herb:","codePoint":"1f33f"},{"description":"shamrock","shortname":":shamrock:","codePoint":"2618"},{"description":"four leaf clover","shortname":":four_leaf_clover:","codePoint":"1f340"},{"description":"pine decoration","shortname":":bamboo:","codePoint":"1f38d"},{"description":"tanabata tree","shortname":":tanabata_tree:","codePoint":"1f38b"},{"description":"leaf fluttering in wind","shortname":":leaves:","codePoint":"1f343"},{"description":"fallen leaf","shortname":":fallen_leaf:","codePoint":"1f342"},{"description":"maple leaf","shortname":":maple_leaf:","codePoint":"1f341"},{"description":"ear of rice","shortname":":ear_of_rice:","codePoint":"1f33e"},{"description":"hibiscus","shortname":":hibiscus:","codePoint":"1f33a"},{"description":"sunflower","shortname":":sunflower:","codePoint":"1f33b"},{"description":"rose","shortname":":rose:","codePoint":"1f339"},{"description":"tulip","shortname":":tulip:","codePoint":"1f337"},{"description":"blossom","shortname":":blossom:","codePoint":"1f33c"},{"description":"cherry blossom","shortname":":cherry_blossom:","codePoint":"1f338"},{"description":"bouquet","shortname":":bouquet:","codePoint":"1f490"},{"description":"mushroom","shortname":":mushroom:","codePoint":"1f344"},{"description":"chestnut","shortname":":chestnut:","codePoint":"1f330"},{"description":"jack-o-lantern","shortname":":jack_o_lantern:","codePoint":"1f383"},{"description":"spiral shell","shortname":":shell:","codePoint":"1f41a"},{"description":"spider web","shortname":":spider_web:","codePoint":"1f578"},{"description":"earth globe americas","shortname":":earth_americas:","codePoint":"1f30e"},{"description":"earth globe europe-africa","shortname":":earth_africa:","codePoint":"1f30d"},{"description":"earth globe asia-australia","shortname":":earth_asia:","codePoint":"1f30f"},{"description":"full moon symbol","shortname":":full_moon:","codePoint":"1f315"},{"description":"waning gibbous moon symbol","shortname":":waning_gibbous_moon:","codePoint":"1f316"},{"description":"last quarter moon symbol","shortname":":last_quarter_moon:","codePoint":"1f317"},{"description":"waning crescent moon symbol","shortname":":waning_crescent_moon:","codePoint":"1f318"},{"description":"new moon symbol","shortname":":new_moon:","codePoint":"1f311"},{"description":"waxing crescent moon symbol","shortname":":waxing_crescent_moon:","codePoint":"1f312"},{"description":"first quarter moon symbol","shortname":":first_quarter_moon:","codePoint":"1f313"},{"description":"waxing gibbous moon symbol","shortname":":waxing_gibbous_moon:","codePoint":"1f314"},{"description":"new moon with face","shortname":":new_moon_with_face:","codePoint":"1f31a"},{"description":"full moon with face","shortname":":full_moon_with_face:","codePoint":"1f31d"},{"description":"first quarter moon with face","shortname":":first_quarter_moon_with_face:","codePoint":"1f31b"},{"description":"last quarter moon with face","shortname":":last_quarter_moon_with_face:","codePoint":"1f31c"},{"description":"sun with face","shortname":":sun_with_face:","codePoint":"1f31e"},{"description":"crescent moon","shortname":":crescent_moon:","codePoint":"1f319"},{"description":"white medium star","shortname":":star:","codePoint":"2b50"},{"description":"glowing star","shortname":":star2:","codePoint":"1f31f"},{"description":"dizzy symbol","shortname":":dizzy:","codePoint":"1f4ab"},{"description":"sparkles","shortname":":sparkles:","codePoint":"2728"},{"description":"comet","shortname":":comet:","codePoint":"2604"},{"description":"black sun with rays","shortname":":sunny:","codePoint":"2600"},{"description":"white sun with small cloud","shortname":":white_sun_small_cloud:","codePoint":"1f324"},{"description":"sun behind cloud","shortname":":partly_sunny:","codePoint":"26c5"},{"description":"white sun behind cloud","shortname":":white_sun_cloud:","codePoint":"1f325"},{"description":"white sun behind cloud with rain","shortname":":white_sun_rain_cloud:","codePoint":"1f326"},{"description":"cloud","shortname":":cloud:","codePoint":"2601"},{"description":"cloud with rain","shortname":":cloud_rain:","codePoint":"1f327"},{"description":"thunder cloud and rain","shortname":":thunder_cloud_rain:","codePoint":"26c8"},{"description":"cloud with lightning","shortname":":cloud_lightning:","codePoint":"1f329"},{"description":"high voltage sign","shortname":":zap:","codePoint":"26a1"},{"description":"fire","shortname":":fire:","codePoint":"1f525"},{"description":"collision symbol","shortname":":boom:","codePoint":"1f4a5"},{"description":"snowflake","shortname":":snowflake:","codePoint":"2744"},{"description":"cloud with snow","shortname":":cloud_snow:","codePoint":"1f328"},{"description":"snowman","shortname":":snowman2:","codePoint":"2603"},{"description":"snowman without snow","shortname":":snowman:","codePoint":"26c4"},{"description":"wind blowing face","shortname":":wind_blowing_face:","codePoint":"1f32c"},{"description":"dash symbol","shortname":":dash:","codePoint":"1f4a8"},{"description":"cloud with tornado","shortname":":cloud_tornado:","codePoint":"1f32a"},{"description":"fog","shortname":":fog:","codePoint":"1f32b"},{"description":"umbrella","shortname":":umbrella2:","codePoint":"2602"},{"description":"umbrella with rain drops","shortname":":umbrella:","codePoint":"2614"},{"description":"droplet","shortname":":droplet:","codePoint":"1f4a7"},{"description":"splashing sweat symbol","shortname":":sweat_drops:","codePoint":"1f4a6"},{"description":"water wave","shortname":":ocean:","codePoint":"1f30a"}]
			},
			{ name:'food', description: 'Food & Drink', codePoint: '1f34f', emojis:
				[{"description":"green apple","shortname":":green_apple:","codePoint":"1f34f"},{"description":"red apple","shortname":":apple:","codePoint":"1f34e"},{"description":"pear","shortname":":pear:","codePoint":"1f350"},{"description":"tangerine","shortname":":tangerine:","codePoint":"1f34a"},{"description":"lemon","shortname":":lemon:","codePoint":"1f34b"},{"description":"banana","shortname":":banana:","codePoint":"1f34c"},{"description":"watermelon","shortname":":watermelon:","codePoint":"1f349"},{"description":"grapes","shortname":":grapes:","codePoint":"1f347"},{"description":"strawberry","shortname":":strawberry:","codePoint":"1f353"},{"description":"melon","shortname":":melon:","codePoint":"1f348"},{"description":"cherries","shortname":":cherries:","codePoint":"1f352"},{"description":"peach","shortname":":peach:","codePoint":"1f351"},{"description":"pineapple","shortname":":pineapple:","codePoint":"1f34d"},{"description":"tomato","shortname":":tomato:","codePoint":"1f345"},{"description":"aubergine","shortname":":eggplant:","codePoint":"1f346"},{"description":"hot pepper","shortname":":hot_pepper:","codePoint":"1f336"},{"description":"ear of maize","shortname":":corn:","codePoint":"1f33d"},{"description":"roasted sweet potato","shortname":":sweet_potato:","codePoint":"1f360"},{"description":"honey pot","shortname":":honey_pot:","codePoint":"1f36f"},{"description":"bread","shortname":":bread:","codePoint":"1f35e"},{"description":"cheese wedge","shortname":":cheese:","codePoint":"1f9c0"},{"description":"poultry leg","shortname":":poultry_leg:","codePoint":"1f357"},{"description":"meat on bone","shortname":":meat_on_bone:","codePoint":"1f356"},{"description":"fried shrimp","shortname":":fried_shrimp:","codePoint":"1f364"},{"description":"cooking","shortname":":egg:","codePoint":"1f373"},{"description":"hamburger","shortname":":hamburger:","codePoint":"1f354"},{"description":"french fries","shortname":":fries:","codePoint":"1f35f"},{"description":"hot dog","shortname":":hotdog:","codePoint":"1f32d"},{"description":"slice of pizza","shortname":":pizza:","codePoint":"1f355"},{"description":"spaghetti","shortname":":spaghetti:","codePoint":"1f35d"},{"description":"taco","shortname":":taco:","codePoint":"1f32e"},{"description":"burrito","shortname":":burrito:","codePoint":"1f32f"},{"description":"steaming bowl","shortname":":ramen:","codePoint":"1f35c"},{"description":"pot of food","shortname":":stew:","codePoint":"1f372"},{"description":"fish cake with swirl design","shortname":":fish_cake:","codePoint":"1f365"},{"description":"sushi","shortname":":sushi:","codePoint":"1f363"},{"description":"bento box","shortname":":bento:","codePoint":"1f371"},{"description":"curry and rice","shortname":":curry:","codePoint":"1f35b"},{"description":"rice ball","shortname":":rice_ball:","codePoint":"1f359"},{"description":"cooked rice","shortname":":rice:","codePoint":"1f35a"},{"description":"rice cracker","shortname":":rice_cracker:","codePoint":"1f358"},{"description":"oden","shortname":":oden:","codePoint":"1f362"},{"description":"dango","shortname":":dango:","codePoint":"1f361"},{"description":"shaved ice","shortname":":shaved_ice:","codePoint":"1f367"},{"description":"ice cream","shortname":":ice_cream:","codePoint":"1f368"},{"description":"soft ice cream","shortname":":icecream:","codePoint":"1f366"},{"description":"shortcake","shortname":":cake:","codePoint":"1f370"},{"description":"birthday cake","shortname":":birthday:","codePoint":"1f382"},{"description":"custard","shortname":":custard:","codePoint":"1f36e"},{"description":"candy","shortname":":candy:","codePoint":"1f36c"},{"description":"lollipop","shortname":":lollipop:","codePoint":"1f36d"},{"description":"chocolate bar","shortname":":chocolate_bar:","codePoint":"1f36b"},{"description":"popcorn","shortname":":popcorn:","codePoint":"1f37f"},{"description":"doughnut","shortname":":doughnut:","codePoint":"1f369"},{"description":"cookie","shortname":":cookie:","codePoint":"1f36a"},{"description":"beer mug","shortname":":beer:","codePoint":"1f37a"},{"description":"clinking beer mugs","shortname":":beers:","codePoint":"1f37b"},{"description":"wine glass","shortname":":wine_glass:","codePoint":"1f377"},{"description":"cocktail glass","shortname":":cocktail:","codePoint":"1f378"},{"description":"tropical drink","shortname":":tropical_drink:","codePoint":"1f379"},{"description":"bottle with popping cork","shortname":":champagne:","codePoint":"1f37e"},{"description":"sake bottle and cup","shortname":":sake:","codePoint":"1f376"},{"description":"teacup without handle","shortname":":tea:","codePoint":"1f375"},{"description":"hot beverage","shortname":":coffee:","codePoint":"2615"},{"description":"baby bottle","shortname":":baby_bottle:","codePoint":"1f37c"},{"description":"fork and knife","shortname":":fork_and_knife:","codePoint":"1f374"},{"description":"fork and knife with plate","shortname":":fork_knife_plate:","codePoint":"1f37d"}]
			},
			{ name: 'activity', description: 'Activity', codePoint: '26bd', emojis:
				[{"description":"soccer ball","shortname":":soccer:","codePoint":"26bd"},{"description":"basketball and hoop","shortname":":basketball:","codePoint":"1f3c0"},{"description":"american football","shortname":":football:","codePoint":"1f3c8"},{"description":"baseball","shortname":":baseball:","codePoint":"26be"},{"description":"tennis racquet and ball","shortname":":tennis:","codePoint":"1f3be"},{"description":"volleyball","shortname":":volleyball:","codePoint":"1f3d0"},{"description":"rugby football","shortname":":rugby_football:","codePoint":"1f3c9"},{"description":"billiards","shortname":":8ball:","codePoint":"1f3b1"},{"description":"flag in hole","shortname":":golf:","codePoint":"26f3"},{"description":"golfer","shortname":":golfer:","codePoint":"1f3cc"},{"description":"table tennis paddle and ball","shortname":":ping_pong:","codePoint":"1f3d3"},{"description":"badminton racquet","shortname":":badminton:","codePoint":"1f3f8"},{"description":"ice hockey stick and puck","shortname":":hockey:","codePoint":"1f3d2"},{"description":"field hockey stick and ball","shortname":":field_hockey:","codePoint":"1f3d1"},{"description":"cricket bat and ball","shortname":":cricket:","codePoint":"1f3cf"},{"description":"ski and ski boot","shortname":":ski:","codePoint":"1f3bf"},{"description":"skier","shortname":":skier:","codePoint":"26f7"},{"description":"snowboarder","shortname":":snowboarder:","codePoint":"1f3c2"},{"description":"ice skate","shortname":":ice_skate:","codePoint":"26f8"},{"description":"bow and arrow","shortname":":bow_and_arrow:","codePoint":"1f3f9"},{"description":"fishing pole and fish","shortname":":fishing_pole_and_fish:","codePoint":"1f3a3"},{"description":"rowboat","shortname":":rowboat:","codePoint":"1f6a3"},{"description":"swimmer","shortname":":swimmer:","codePoint":"1f3ca"},{"description":"surfer","shortname":":surfer:","codePoint":"1f3c4"},{"description":"bath","shortname":":bath:","codePoint":"1f6c0"},{"description":"person with ball","shortname":":basketball_player:","codePoint":"26f9"},{"description":"weight lifter","shortname":":lifter:","codePoint":"1f3cb"},{"description":"bicyclist","shortname":":bicyclist:","codePoint":"1f6b4"},{"description":"mountain bicyclist","shortname":":mountain_bicyclist:","codePoint":"1f6b5"},{"description":"horse racing","shortname":":horse_racing:","codePoint":"1f3c7"},{"description":"man in business suit levitating","shortname":":levitate:","codePoint":"1f574"},{"description":"trophy","shortname":":trophy:","codePoint":"1f3c6"},{"description":"running shirt with sash","shortname":":running_shirt_with_sash:","codePoint":"1f3bd"},{"description":"sports medal","shortname":":medal:","codePoint":"1f3c5"},{"description":"military medal","shortname":":military_medal:","codePoint":"1f396"},{"description":"reminder ribbon","shortname":":reminder_ribbon:","codePoint":"1f397"},{"description":"rosette","shortname":":rosette:","codePoint":"1f3f5"},{"description":"ticket","shortname":":ticket:","codePoint":"1f3ab"},{"description":"admission tickets","shortname":":tickets:","codePoint":"1f39f"},{"description":"performing arts","shortname":":performing_arts:","codePoint":"1f3ad"},{"description":"artist palette","shortname":":art:","codePoint":"1f3a8"},{"description":"circus tent","shortname":":circus_tent:","codePoint":"1f3aa"},{"description":"microphone","shortname":":microphone:","codePoint":"1f3a4"},{"description":"headphone","shortname":":headphones:","codePoint":"1f3a7"},{"description":"musical score","shortname":":musical_score:","codePoint":"1f3bc"},{"description":"musical keyboard","shortname":":musical_keyboard:","codePoint":"1f3b9"},{"description":"saxophone","shortname":":saxophone:","codePoint":"1f3b7"},{"description":"trumpet","shortname":":trumpet:","codePoint":"1f3ba"},{"description":"guitar","shortname":":guitar:","codePoint":"1f3b8"},{"description":"violin","shortname":":violin:","codePoint":"1f3bb"},{"description":"clapper board","shortname":":clapper:","codePoint":"1f3ac"},{"description":"video game","shortname":":video_game:","codePoint":"1f3ae"},{"description":"alien monster","shortname":":space_invader:","codePoint":"1f47e"},{"description":"direct hit","shortname":":dart:","codePoint":"1f3af"},{"description":"game die","shortname":":game_die:","codePoint":"1f3b2"},{"description":"slot machine","shortname":":slot_machine:","codePoint":"1f3b0"},{"description":"bowling","shortname":":bowling:","codePoint":"1f3b3"}]
			},
			{ name: 'travel', description: 'Travel & Places',codePoint: '1f697', emojis:
				[{"description":"automobile","shortname":":red_car:","codePoint":"1f697"},{"description":"taxi","shortname":":taxi:","codePoint":"1f695"},{"description":"recreational vehicle","shortname":":blue_car:","codePoint":"1f699"},{"description":"bus","shortname":":bus:","codePoint":"1f68c"},{"description":"trolleybus","shortname":":trolleybus:","codePoint":"1f68e"},{"description":"racing car","shortname":":race_car:","codePoint":"1f3ce"},{"description":"police car","shortname":":police_car:","codePoint":"1f693"},{"description":"ambulance","shortname":":ambulance:","codePoint":"1f691"},{"description":"fire engine","shortname":":fire_engine:","codePoint":"1f692"},{"description":"minibus","shortname":":minibus:","codePoint":"1f690"},{"description":"delivery truck","shortname":":truck:","codePoint":"1f69a"},{"description":"articulated lorry","shortname":":articulated_lorry:","codePoint":"1f69b"},{"description":"tractor","shortname":":tractor:","codePoint":"1f69c"},{"description":"racing motorcycle","shortname":":motorcycle:","codePoint":"1f3cd"},{"description":"bicycle","shortname":":bike:","codePoint":"1f6b2"},{"description":"police cars revolving light","shortname":":rotating_light:","codePoint":"1f6a8"},{"description":"oncoming police car","shortname":":oncoming_police_car:","codePoint":"1f694"},{"description":"oncoming bus","shortname":":oncoming_bus:","codePoint":"1f68d"},{"description":"oncoming automobile","shortname":":oncoming_automobile:","codePoint":"1f698"},{"description":"oncoming taxi","shortname":":oncoming_taxi:","codePoint":"1f696"},{"description":"aerial tramway","shortname":":aerial_tramway:","codePoint":"1f6a1"},{"description":"mountain cableway","shortname":":mountain_cableway:","codePoint":"1f6a0"},{"description":"suspension railway","shortname":":suspension_railway:","codePoint":"1f69f"},{"description":"railway car","shortname":":railway_car:","codePoint":"1f683"},{"description":"tram car","shortname":":train:","codePoint":"1f68b"},{"description":"monorail","shortname":":monorail:","codePoint":"1f69d"},{"description":"high-speed train","shortname":":bullettrain_side:","codePoint":"1f684"},{"description":"high-speed train with bullet nose","shortname":":bullettrain_front:","codePoint":"1f685"},{"description":"light rail","shortname":":light_rail:","codePoint":"1f688"},{"description":"mountain railway","shortname":":mountain_railway:","codePoint":"1f69e"},{"description":"steam locomotive","shortname":":steam_locomotive:","codePoint":"1f682"},{"description":"train","shortname":":train2:","codePoint":"1f686"},{"description":"metro","shortname":":metro:","codePoint":"1f687"},{"description":"tram","shortname":":tram:","codePoint":"1f68a"},{"description":"station","shortname":":station:","codePoint":"1f689"},{"description":"helicopter","shortname":":helicopter:","codePoint":"1f681"},{"description":"small airplane","shortname":":airplane_small:","codePoint":"1f6e9"},{"description":"airplane","shortname":":airplane:","codePoint":"2708"},{"description":"airplane departure","shortname":":airplane_departure:","codePoint":"1f6eb"},{"description":"airplane arriving","shortname":":airplane_arriving:","codePoint":"1f6ec"},{"description":"sailboat","shortname":":sailboat:","codePoint":"26f5"},{"description":"motorboat","shortname":":motorboat:","codePoint":"1f6e5"},{"description":"speedboat","shortname":":speedboat:","codePoint":"1f6a4"},{"description":"ferry","shortname":":ferry:","codePoint":"26f4"},{"description":"passenger ship","shortname":":cruise_ship:","codePoint":"1f6f3"},{"description":"rocket","shortname":":rocket:","codePoint":"1f680"},{"description":"satellite","shortname":":satellite_orbital:","codePoint":"1f6f0"},{"description":"seat","shortname":":seat:","codePoint":"1f4ba"},{"description":"anchor","shortname":":anchor:","codePoint":"2693"},{"description":"construction sign","shortname":":construction:","codePoint":"1f6a7"},{"description":"fuel pump","shortname":":fuelpump:","codePoint":"26fd"},{"description":"bus stop","shortname":":busstop:","codePoint":"1f68f"},{"description":"vertical traffic light","shortname":":vertical_traffic_light:","codePoint":"1f6a6"},{"description":"horizontal traffic light","shortname":":traffic_light:","codePoint":"1f6a5"},{"description":"chequered flag","shortname":":checkered_flag:","codePoint":"1f3c1"},{"description":"ship","shortname":":ship:","codePoint":"1f6a2"},{"description":"ferris wheel","shortname":":ferris_wheel:","codePoint":"1f3a1"},{"description":"roller coaster","shortname":":roller_coaster:","codePoint":"1f3a2"},{"description":"carousel horse","shortname":":carousel_horse:","codePoint":"1f3a0"},{"description":"building construction","shortname":":construction_site:","codePoint":"1f3d7"},{"description":"foggy","shortname":":foggy:","codePoint":"1f301"},{"description":"tokyo tower","shortname":":tokyo_tower:","codePoint":"1f5fc"},{"description":"factory","shortname":":factory:","codePoint":"1f3ed"},{"description":"fountain","shortname":":fountain:","codePoint":"26f2"},{"description":"moon viewing ceremony","shortname":":rice_scene:","codePoint":"1f391"},{"description":"mountain","shortname":":mountain:","codePoint":"26f0"},{"description":"snow capped mountain","shortname":":mountain_snow:","codePoint":"1f3d4"},{"description":"mount fuji","shortname":":mount_fuji:","codePoint":"1f5fb"},{"description":"volcano","shortname":":volcano:","codePoint":"1f30b"},{"description":"silhouette of japan","shortname":":japan:","codePoint":"1f5fe"},{"description":"camping","shortname":":camping:","codePoint":"1f3d5"},{"description":"tent","shortname":":tent:","codePoint":"26fa"},{"description":"national park","shortname":":park:","codePoint":"1f3de"},{"description":"motorway","shortname":":motorway:","codePoint":"1f6e3"},{"description":"railway track","shortname":":railway_track:","codePoint":"1f6e4"},{"description":"sunrise","shortname":":sunrise:","codePoint":"1f305"},{"description":"sunrise over mountains","shortname":":sunrise_over_mountains:","codePoint":"1f304"},{"description":"desert","shortname":":desert:","codePoint":"1f3dc"},{"description":"beach with umbrella","shortname":":beach:","codePoint":"1f3d6"},{"description":"desert island","shortname":":island:","codePoint":"1f3dd"},{"description":"sunset over buildings","shortname":":city_sunset:","codePoint":"1f307"},{"description":"cityscape at dusk","shortname":":city_dusk:","codePoint":"1f306"},{"description":"cityscape","shortname":":cityscape:","codePoint":"1f3d9"},{"description":"night with stars","shortname":":night_with_stars:","codePoint":"1f303"},{"description":"bridge at night","shortname":":bridge_at_night:","codePoint":"1f309"},{"description":"milky way","shortname":":milky_way:","codePoint":"1f30c"},{"description":"shooting star","shortname":":stars:","codePoint":"1f320"},{"description":"firework sparkler","shortname":":sparkler:","codePoint":"1f387"},{"description":"fireworks","shortname":":fireworks:","codePoint":"1f386"},{"description":"rainbow","shortname":":rainbow:","codePoint":"1f308"},{"description":"house buildings","shortname":":homes:","codePoint":"1f3d8"},{"description":"european castle","shortname":":european_castle:","codePoint":"1f3f0"},{"description":"japanese castle","shortname":":japanese_castle:","codePoint":"1f3ef"},{"description":"stadium","shortname":":stadium:","codePoint":"1f3df"},{"description":"statue of liberty","shortname":":statue_of_liberty:","codePoint":"1f5fd"},{"description":"house building","shortname":":house:","codePoint":"1f3e0"},{"description":"house with garden","shortname":":house_with_garden:","codePoint":"1f3e1"},{"description":"derelict house building","shortname":":house_abandoned:","codePoint":"1f3da"},{"description":"office building","shortname":":office:","codePoint":"1f3e2"},{"description":"department store","shortname":":department_store:","codePoint":"1f3ec"},{"description":"japanese post office","shortname":":post_office:","codePoint":"1f3e3"},{"description":"european post office","shortname":":european_post_office:","codePoint":"1f3e4"},{"description":"hospital","shortname":":hospital:","codePoint":"1f3e5"},{"description":"bank","shortname":":bank:","codePoint":"1f3e6"},{"description":"hotel","shortname":":hotel:","codePoint":"1f3e8"},{"description":"convenience store","shortname":":convenience_store:","codePoint":"1f3ea"},{"description":"school","shortname":":school:","codePoint":"1f3eb"},{"description":"love hotel","shortname":":love_hotel:","codePoint":"1f3e9"},{"description":"wedding","shortname":":wedding:","codePoint":"1f492"},{"description":"classical building","shortname":":classical_building:","codePoint":"1f3db"},{"description":"church","shortname":":church:","codePoint":"26ea"},{"description":"mosque","shortname":":mosque:","codePoint":"1f54c"},{"description":"synagogue","shortname":":synagogue:","codePoint":"1f54d"},{"description":"kaaba","shortname":":kaaba:","codePoint":"1f54b"},{"description":"shinto shrine","shortname":":shinto_shrine:","codePoint":"26e9"}]
			},
			{ name: 'objects', description: 'Objects', codePoint: '1f4a1', emojis:
				[{"description":"watch","shortname":":watch:","codePoint":"231a"},{"description":"mobile phone","shortname":":iphone:","codePoint":"1f4f1"},{"description":"mobile phone with rightwards arrow at left","shortname":":calling:","codePoint":"1f4f2"},{"description":"personal computer","shortname":":computer:","codePoint":"1f4bb"},{"description":"keyboard","shortname":":keyboard:","codePoint":"2328"},{"description":"desktop computer","shortname":":desktop:","codePoint":"1f5a5"},{"description":"printer","shortname":":printer:","codePoint":"1f5a8"},{"description":"three button mouse","shortname":":mouse_three_button:","codePoint":"1f5b1"},{"description":"trackball","shortname":":trackball:","codePoint":"1f5b2"},{"description":"joystick","shortname":":joystick:","codePoint":"1f579"},{"description":"compression","shortname":":compression:","codePoint":"1f5dc"},{"description":"minidisc","shortname":":minidisc:","codePoint":"1f4bd"},{"description":"floppy disk","shortname":":floppy_disk:","codePoint":"1f4be"},{"description":"optical disc","shortname":":cd:","codePoint":"1f4bf"},{"description":"dvd","shortname":":dvd:","codePoint":"1f4c0"},{"description":"videocassette","shortname":":vhs:","codePoint":"1f4fc"},{"description":"camera","shortname":":camera:","codePoint":"1f4f7"},{"description":"camera with flash","shortname":":camera_with_flash:","codePoint":"1f4f8"},{"description":"video camera","shortname":":video_camera:","codePoint":"1f4f9"},{"description":"movie camera","shortname":":movie_camera:","codePoint":"1f3a5"},{"description":"film projector","shortname":":projector:","codePoint":"1f4fd"},{"description":"film frames","shortname":":film_frames:","codePoint":"1f39e"},{"description":"telephone receiver","shortname":":telephone_receiver:","codePoint":"1f4de"},{"description":"black telephone","shortname":":telephone:","codePoint":"260e"},{"description":"pager","shortname":":pager:","codePoint":"1f4df"},{"description":"fax machine","shortname":":fax:","codePoint":"1f4e0"},{"description":"television","shortname":":tv:","codePoint":"1f4fa"},{"description":"radio","shortname":":radio:","codePoint":"1f4fb"},{"description":"studio microphone","shortname":":microphone2:","codePoint":"1f399"},{"description":"level slider","shortname":":level_slider:","codePoint":"1f39a"},{"description":"control knobs","shortname":":control_knobs:","codePoint":"1f39b"},{"description":"stopwatch","shortname":":stopwatch:","codePoint":"23f1"},{"description":"timer clock","shortname":":timer:","codePoint":"23f2"},{"description":"alarm clock","shortname":":alarm_clock:","codePoint":"23f0"},{"description":"mantlepiece clock","shortname":":clock:","codePoint":"1f570"},{"description":"hourglass with flowing sand","shortname":":hourglass_flowing_sand:","codePoint":"23f3"},{"description":"hourglass","shortname":":hourglass:","codePoint":"231b"},{"description":"satellite antenna","shortname":":satellite:","codePoint":"1f4e1"},{"description":"battery","shortname":":battery:","codePoint":"1f50b"},{"description":"electric plug","shortname":":electric_plug:","codePoint":"1f50c"},{"description":"electric light bulb","shortname":":bulb:","codePoint":"1f4a1"},{"description":"electric torch","shortname":":flashlight:","codePoint":"1f526"},{"description":"candle","shortname":":candle:","codePoint":"1f56f"},{"description":"wastebasket","shortname":":wastebasket:","codePoint":"1f5d1"},{"description":"oil drum","shortname":":oil:","codePoint":"1f6e2"},{"description":"money with wings","shortname":":money_with_wings:","codePoint":"1f4b8"},{"description":"banknote with dollar sign","shortname":":dollar:","codePoint":"1f4b5"},{"description":"banknote with yen sign","shortname":":yen:","codePoint":"1f4b4"},{"description":"banknote with euro sign","shortname":":euro:","codePoint":"1f4b6"},{"description":"banknote with pound sign","shortname":":pound:","codePoint":"1f4b7"},{"description":"money bag","shortname":":moneybag:","codePoint":"1f4b0"},{"description":"credit card","shortname":":credit_card:","codePoint":"1f4b3"},{"description":"gem stone","shortname":":gem:","codePoint":"1f48e"},{"description":"scales","shortname":":scales:","codePoint":"2696"},{"description":"wrench","shortname":":wrench:","codePoint":"1f527"},{"description":"hammer","shortname":":hammer:","codePoint":"1f528"},{"description":"hammer and pick","shortname":":hammer_pick:","codePoint":"2692"},{"description":"hammer and wrench","shortname":":tools:","codePoint":"1f6e0"},{"description":"pick","shortname":":pick:","codePoint":"26cf"},{"description":"nut and bolt","shortname":":nut_and_bolt:","codePoint":"1f529"},{"description":"gear","shortname":":gear:","codePoint":"2699"},{"description":"chains","shortname":":chains:","codePoint":"26d3"},{"description":"pistol","shortname":":gun:","codePoint":"1f52b"},{"description":"bomb","shortname":":bomb:","codePoint":"1f4a3"},{"description":"hocho","shortname":":knife:","codePoint":"1f52a"},{"description":"dagger knife","shortname":":dagger:","codePoint":"1f5e1"},{"description":"crossed swords","shortname":":crossed_swords:","codePoint":"2694"},{"description":"shield","shortname":":shield:","codePoint":"1f6e1"},{"description":"smoking symbol","shortname":":smoking:","codePoint":"1f6ac"},{"description":"skull and crossbones","shortname":":skull_crossbones:","codePoint":"2620"},{"description":"coffin","shortname":":coffin:","codePoint":"26b0"},{"description":"funeral urn","shortname":":urn:","codePoint":"26b1"},{"description":"amphora","shortname":":amphora:","codePoint":"1f3fa"},{"description":"crystal ball","shortname":":crystal_ball:","codePoint":"1f52e"},{"description":"prayer beads","shortname":":prayer_beads:","codePoint":"1f4ff"},{"description":"barber pole","shortname":":barber:","codePoint":"1f488"},{"description":"alembic","shortname":":alembic:","codePoint":"2697"},{"description":"telescope","shortname":":telescope:","codePoint":"1f52d"},{"description":"microscope","shortname":":microscope:","codePoint":"1f52c"},{"description":"hole","shortname":":hole:","codePoint":"1f573"},{"description":"pill","shortname":":pill:","codePoint":"1f48a"},{"description":"syringe","shortname":":syringe:","codePoint":"1f489"},{"description":"thermometer","shortname":":thermometer:","codePoint":"1f321"},{"description":"label","shortname":":label:","codePoint":"1f3f7"},{"description":"bookmark","shortname":":bookmark:","codePoint":"1f516"},{"description":"toilet","shortname":":toilet:","codePoint":"1f6bd"},{"description":"shower","shortname":":shower:","codePoint":"1f6bf"},{"description":"bathtub","shortname":":bathtub:","codePoint":"1f6c1"},{"description":"key","shortname":":key:","codePoint":"1f511"},{"description":"old key","shortname":":key2:","codePoint":"1f5dd"},{"description":"couch and lamp","shortname":":couch:","codePoint":"1f6cb"},{"description":"sleeping accommodation","shortname":":sleeping_accommodation:","codePoint":"1f6cc"},{"description":"bed","shortname":":bed:","codePoint":"1f6cf"},{"description":"door","shortname":":door:","codePoint":"1f6aa"},{"description":"bellhop bell","shortname":":bellhop:","codePoint":"1f6ce"},{"description":"frame with picture","shortname":":frame_photo:","codePoint":"1f5bc"},{"description":"world map","shortname":":map:","codePoint":"1f5fa"},{"description":"umbrella on ground","shortname":":beach_umbrella:","codePoint":"26f1"},{"description":"moyai","shortname":":moyai:","codePoint":"1f5ff"},{"description":"shopping bags","shortname":":shopping_bags:","codePoint":"1f6cd"},{"description":"balloon","shortname":":balloon:","codePoint":"1f388"},{"description":"carp streamer","shortname":":flags:","codePoint":"1f38f"},{"description":"ribbon","shortname":":ribbon:","codePoint":"1f380"},{"description":"wrapped present","shortname":":gift:","codePoint":"1f381"},{"description":"confetti ball","shortname":":confetti_ball:","codePoint":"1f38a"},{"description":"party popper","shortname":":tada:","codePoint":"1f389"},{"description":"japanese dolls","shortname":":dolls:","codePoint":"1f38e"},{"description":"wind chime","shortname":":wind_chime:","codePoint":"1f390"},{"description":"crossed flags","shortname":":crossed_flags:","codePoint":"1f38c"},{"description":"izakaya lantern","shortname":":izakaya_lantern:","codePoint":"1f3ee"},{"description":"envelope","shortname":":envelope:","codePoint":"2709"},{"description":"envelope with downwards arrow above","shortname":":envelope_with_arrow:","codePoint":"1f4e9"},{"description":"incoming envelope","shortname":":incoming_envelope:","codePoint":"1f4e8"},{"description":"e-mail symbol","shortname":":e-mail:","codePoint":"1f4e7"},{"description":"love letter","shortname":":love_letter:","codePoint":"1f48c"},{"description":"postbox","shortname":":postbox:","codePoint":"1f4ee"},{"description":"closed mailbox with lowered flag","shortname":":mailbox_closed:","codePoint":"1f4ea"},{"description":"closed mailbox with raised flag","shortname":":mailbox:","codePoint":"1f4eb"},{"description":"open mailbox with raised flag","shortname":":mailbox_with_mail:","codePoint":"1f4ec"},{"description":"open mailbox with lowered flag","shortname":":mailbox_with_no_mail:","codePoint":"1f4ed"},{"description":"package","shortname":":package:","codePoint":"1f4e6"},{"description":"postal horn","shortname":":postal_horn:","codePoint":"1f4ef"},{"description":"inbox tray","shortname":":inbox_tray:","codePoint":"1f4e5"},{"description":"outbox tray","shortname":":outbox_tray:","codePoint":"1f4e4"},{"description":"scroll","shortname":":scroll:","codePoint":"1f4dc"},{"description":"page with curl","shortname":":page_with_curl:","codePoint":"1f4c3"},{"description":"bookmark tabs","shortname":":bookmark_tabs:","codePoint":"1f4d1"},{"description":"bar chart","shortname":":bar_chart:","codePoint":"1f4ca"},{"description":"chart with upwards trend","shortname":":chart_with_upwards_trend:","codePoint":"1f4c8"},{"description":"chart with downwards trend","shortname":":chart_with_downwards_trend:","codePoint":"1f4c9"},{"description":"page facing up","shortname":":page_facing_up:","codePoint":"1f4c4"},{"description":"calendar","shortname":":date:","codePoint":"1f4c5"},{"description":"tear-off calendar","shortname":":calendar:","codePoint":"1f4c6"},{"description":"spiral calendar pad","shortname":":calendar_spiral:","codePoint":"1f5d3"},{"description":"card index","shortname":":card_index:","codePoint":"1f4c7"},{"description":"card file box","shortname":":card_box:","codePoint":"1f5c3"},{"description":"ballot box with ballot","shortname":":ballot_box:","codePoint":"1f5f3"},{"description":"file cabinet","shortname":":file_cabinet:","codePoint":"1f5c4"},{"description":"clipboard","shortname":":clipboard:","codePoint":"1f4cb"},{"description":"spiral note pad","shortname":":notepad_spiral:","codePoint":"1f5d2"},{"description":"file folder","shortname":":file_folder:","codePoint":"1f4c1"},{"description":"open file folder","shortname":":open_file_folder:","codePoint":"1f4c2"},{"description":"card index dividers","shortname":":dividers:","codePoint":"1f5c2"},{"description":"rolled-up newspaper","shortname":":newspaper2:","codePoint":"1f5de"},{"description":"newspaper","shortname":":newspaper:","codePoint":"1f4f0"},{"description":"notebook","shortname":":notebook:","codePoint":"1f4d3"},{"description":"closed book","shortname":":closed_book:","codePoint":"1f4d5"},{"description":"green book","shortname":":green_book:","codePoint":"1f4d7"},{"description":"blue book","shortname":":blue_book:","codePoint":"1f4d8"},{"description":"orange book","shortname":":orange_book:","codePoint":"1f4d9"},{"description":"notebook with decorative cover","shortname":":notebook_with_decorative_cover:","codePoint":"1f4d4"},{"description":"ledger","shortname":":ledger:","codePoint":"1f4d2"},{"description":"books","shortname":":books:","codePoint":"1f4da"},{"description":"open book","shortname":":book:","codePoint":"1f4d6"},{"description":"link symbol","shortname":":link:","codePoint":"1f517"},{"description":"paperclip","shortname":":paperclip:","codePoint":"1f4ce"},{"description":"linked paperclips","shortname":":paperclips:","codePoint":"1f587"},{"description":"black scissors","shortname":":scissors:","codePoint":"2702"},{"description":"triangular ruler","shortname":":triangular_ruler:","codePoint":"1f4d0"},{"description":"straight ruler","shortname":":straight_ruler:","codePoint":"1f4cf"},{"description":"pushpin","shortname":":pushpin:","codePoint":"1f4cc"},{"description":"round pushpin","shortname":":round_pushpin:","codePoint":"1f4cd"},{"description":"triangular flag on post","shortname":":triangular_flag_on_post:","codePoint":"1f6a9"},{"description":"waving white flag","shortname":":flag_white:","codePoint":"1f3f3"},{"description":"waving black flag","shortname":":flag_black:","codePoint":"1f3f4"},{"description":"closed lock with key","shortname":":closed_lock_with_key:","codePoint":"1f510"},{"description":"lock","shortname":":lock:","codePoint":"1f512"},{"description":"open lock","shortname":":unlock:","codePoint":"1f513"},{"description":"lock with ink pen","shortname":":lock_with_ink_pen:","codePoint":"1f50f"},{"description":"lower left ballpoint pen","shortname":":pen_ballpoint:","codePoint":"1f58a"},{"description":"lower left fountain pen","shortname":":pen_fountain:","codePoint":"1f58b"},{"description":"black nib","shortname":":black_nib:","codePoint":"2712"},{"description":"memo","shortname":":pencil:","codePoint":"1f4dd"},{"description":"pencil","shortname":":pencil2:","codePoint":"270f"},{"description":"lower left crayon","shortname":":crayon:","codePoint":"1f58d"},{"description":"lower left paintbrush","shortname":":paintbrush:","codePoint":"1f58c"},{"description":"left-pointing magnifying glass","shortname":":mag:","codePoint":"1f50d"},{"description":"right-pointing magnifying glass","shortname":":mag_right:","codePoint":"1f50e"}]
			},
			{ name: 'symbols', description: 'Symbols', codePoint:'1f523', emojis:
				[{"description":"heavy black heart","shortname":":heart:","codePoint":"2764"},{"description":"yellow heart","shortname":":yellow_heart:","codePoint":"1f49b"},{"description":"green heart","shortname":":green_heart:","codePoint":"1f49a"},{"description":"blue heart","shortname":":blue_heart:","codePoint":"1f499"},{"description":"purple heart","shortname":":purple_heart:","codePoint":"1f49c"},{"description":"broken heart","shortname":":broken_heart:","codePoint":"1f494"},{"description":"heavy heart exclamation mark ornament","shortname":":heart_exclamation:","codePoint":"2763"},{"description":"two hearts","shortname":":two_hearts:","codePoint":"1f495"},{"description":"revolving hearts","shortname":":revolving_hearts:","codePoint":"1f49e"},{"description":"beating heart","shortname":":heartbeat:","codePoint":"1f493"},{"description":"growing heart","shortname":":heartpulse:","codePoint":"1f497"},{"description":"sparkling heart","shortname":":sparkling_heart:","codePoint":"1f496"},{"description":"heart with arrow","shortname":":cupid:","codePoint":"1f498"},{"description":"heart with ribbon","shortname":":gift_heart:","codePoint":"1f49d"},{"description":"heart decoration","shortname":":heart_decoration:","codePoint":"1f49f"},{"description":"peace symbol","shortname":":peace:","codePoint":"262e"},{"description":"latin cross","shortname":":cross:","codePoint":"271d"},{"description":"star and crescent","shortname":":star_and_crescent:","codePoint":"262a"},{"description":"om symbol","shortname":":om_symbol:","codePoint":"1f549"},{"description":"wheel of dharma","shortname":":wheel_of_dharma:","codePoint":"2638"},{"description":"star of david","shortname":":star_of_david:","codePoint":"2721"},{"description":"six pointed star with middle dot","shortname":":six_pointed_star:","codePoint":"1f52f"},{"description":"menorah with nine branches","shortname":":menorah:","codePoint":"1f54e"},{"description":"yin yang","shortname":":yin_yang:","codePoint":"262f"},{"description":"orthodox cross","shortname":":orthodox_cross:","codePoint":"2626"},{"description":"place of worship","shortname":":place_of_worship:","codePoint":"1f6d0"},{"description":"ophiuchus","shortname":":ophiuchus:","codePoint":"26ce"},{"description":"aries","shortname":":aries:","codePoint":"2648"},{"description":"taurus","shortname":":taurus:","codePoint":"2649"},{"description":"gemini","shortname":":gemini:","codePoint":"264a"},{"description":"cancer","shortname":":cancer:","codePoint":"264b"},{"description":"leo","shortname":":leo:","codePoint":"264c"},{"description":"virgo","shortname":":virgo:","codePoint":"264d"},{"description":"libra","shortname":":libra:","codePoint":"264e"},{"description":"scorpius","shortname":":scorpius:","codePoint":"264f"},{"description":"sagittarius","shortname":":sagittarius:","codePoint":"2650"},{"description":"capricorn","shortname":":capricorn:","codePoint":"2651"},{"description":"aquarius","shortname":":aquarius:","codePoint":"2652"},{"description":"pisces","shortname":":pisces:","codePoint":"2653"},{"description":"squared id","shortname":":id:","codePoint":"1f194"},{"description":"atom symbol","shortname":":atom:","codePoint":"269b"},{"description":"squared cjk unified ideograph-7a7a","shortname":":u7a7a:","codePoint":"1f233"},{"description":"squared cjk unified ideograph-5272","shortname":":u5272:","codePoint":"1f239"},{"description":"radioactive sign","shortname":":radioactive:","codePoint":"2622"},{"description":"biohazard sign","shortname":":biohazard:","codePoint":"2623"},{"description":"mobile phone off","shortname":":mobile_phone_off:","codePoint":"1f4f4"},{"description":"vibration mode","shortname":":vibration_mode:","codePoint":"1f4f3"},{"description":"squared cjk unified ideograph-6709","shortname":":u6709:","codePoint":"1f236"},{"description":"squared cjk unified ideograph-7121","shortname":":u7121:","codePoint":"1f21a"},{"description":"squared cjk unified ideograph-7533","shortname":":u7533:","codePoint":"1f238"},{"description":"squared cjk unified ideograph-55b6","shortname":":u55b6:","codePoint":"1f23a"},{"description":"squared cjk unified ideograph-6708","shortname":":u6708:","codePoint":"1f237"},{"description":"eight pointed black star","shortname":":eight_pointed_black_star:","codePoint":"2734"},{"description":"squared vs","shortname":":vs:","codePoint":"1f19a"},{"description":"circled ideograph accept","shortname":":accept:","codePoint":"1f251"},{"description":"white flower","shortname":":white_flower:","codePoint":"1f4ae"},{"description":"circled ideograph advantage","shortname":":ideograph_advantage:","codePoint":"1f250"},{"description":"circled ideograph secret","shortname":":secret:","codePoint":"3299"},{"description":"circled ideograph congratulation","shortname":":congratulations:","codePoint":"3297"},{"description":"squared cjk unified ideograph-5408","shortname":":u5408:","codePoint":"1f234"},{"description":"squared cjk unified ideograph-6e80","shortname":":u6e80:","codePoint":"1f235"},{"description":"squared cjk unified ideograph-7981","shortname":":u7981:","codePoint":"1f232"},{"description":"negative squared latin capital letter a","shortname":":a:","codePoint":"1f170"},{"description":"negative squared latin capital letter b","shortname":":b:","codePoint":"1f171"},{"description":"negative squared ab","shortname":":ab:","codePoint":"1f18e"},{"description":"squared cl","shortname":":cl:","codePoint":"1f191"},{"description":"negative squared latin capital letter o","shortname":":o2:","codePoint":"1f17e"},{"description":"squared sos","shortname":":sos:","codePoint":"1f198"},{"description":"no entry","shortname":":no_entry:","codePoint":"26d4"},{"description":"name badge","shortname":":name_badge:","codePoint":"1f4db"},{"description":"no entry sign","shortname":":no_entry_sign:","codePoint":"1f6ab"},{"description":"cross mark","shortname":":x:","codePoint":"274c"},{"description":"heavy large circle","shortname":":o:","codePoint":"2b55"},{"description":"anger symbol","shortname":":anger:","codePoint":"1f4a2"},{"description":"hot springs","shortname":":hotsprings:","codePoint":"2668"},{"description":"no pedestrians","shortname":":no_pedestrians:","codePoint":"1f6b7"},{"description":"do not litter symbol","shortname":":do_not_litter:","codePoint":"1f6af"},{"description":"no bicycles","shortname":":no_bicycles:","codePoint":"1f6b3"},{"description":"non-potable water symbol","shortname":":non-potable_water:","codePoint":"1f6b1"},{"description":"no one under eighteen symbol","shortname":":underage:","codePoint":"1f51e"},{"description":"no mobile phones","shortname":":no_mobile_phones:","codePoint":"1f4f5"},{"description":"heavy exclamation mark symbol","shortname":":exclamation:","codePoint":"2757"},{"description":"white exclamation mark ornament","shortname":":grey_exclamation:","codePoint":"2755"},{"description":"black question mark ornament","shortname":":question:","codePoint":"2753"},{"description":"white question mark ornament","shortname":":grey_question:","codePoint":"2754"},{"description":"double exclamation mark","shortname":":bangbang:","codePoint":"203c"},{"description":"exclamation question mark","shortname":":interrobang:","codePoint":"2049"},{"description":"hundred points symbol","shortname":":100:","codePoint":"1f4af"},{"description":"low brightness symbol","shortname":":low_brightness:","codePoint":"1f505"},{"description":"high brightness symbol","shortname":":high_brightness:","codePoint":"1f506"},{"description":"trident emblem","shortname":":trident:","codePoint":"1f531"},{"description":"fleur-de-lis","shortname":":fleur-de-lis:","codePoint":"269c"},{"description":"part alternation mark","shortname":":part_alternation_mark:","codePoint":"303d"},{"description":"warning sign","shortname":":warning:","codePoint":"26a0"},{"description":"children crossing","shortname":":children_crossing:","codePoint":"1f6b8"},{"description":"japanese symbol for beginner","shortname":":beginner:","codePoint":"1f530"},{"description":"black universal recycling symbol","shortname":":recycle:","codePoint":"267b"},{"description":"squared cjk unified ideograph-6307","shortname":":u6307:","codePoint":"1f22f"},{"description":"chart with upwards trend and yen sign","shortname":":chart:","codePoint":"1f4b9"},{"description":"sparkle","shortname":":sparkle:","codePoint":"2747"},{"description":"eight spoked asterisk","shortname":":eight_spoked_asterisk:","codePoint":"2733"},{"description":"negative squared cross mark","shortname":":negative_squared_cross_mark:","codePoint":"274e"},{"description":"white heavy check mark","shortname":":white_check_mark:","codePoint":"2705"},{"description":"diamond shape with a dot inside","shortname":":diamond_shape_with_a_dot_inside:","codePoint":"1f4a0"},{"description":"cyclone","shortname":":cyclone:","codePoint":"1f300"},{"description":"double curly loop","shortname":":loop:","codePoint":"27bf"},{"description":"globe with meridians","shortname":":globe_with_meridians:","codePoint":"1f310"},{"description":"circled latin capital letter m","shortname":":m:","codePoint":"24c2"},{"description":"automated teller machine","shortname":":atm:","codePoint":"1f3e7"},{"description":"squared katakana sa","shortname":":sa:","codePoint":"1f202"},{"description":"passport control","shortname":":passport_control:","codePoint":"1f6c2"},{"description":"customs","shortname":":customs:","codePoint":"1f6c3"},{"description":"baggage claim","shortname":":baggage_claim:","codePoint":"1f6c4"},{"description":"left luggage","shortname":":left_luggage:","codePoint":"1f6c5"},{"description":"wheelchair symbol","shortname":":wheelchair:","codePoint":"267f"},{"description":"no smoking symbol","shortname":":no_smoking:","codePoint":"1f6ad"},{"description":"water closet","shortname":":wc:","codePoint":"1f6be"},{"description":"negative squared latin capital letter p","shortname":":parking:","codePoint":"1f17f"},{"description":"potable water symbol","shortname":":potable_water:","codePoint":"1f6b0"},{"description":"mens symbol","shortname":":mens:","codePoint":"1f6b9"},{"description":"womens symbol","shortname":":womens:","codePoint":"1f6ba"},{"description":"baby symbol","shortname":":baby_symbol:","codePoint":"1f6bc"},{"description":"restroom","shortname":":restroom:","codePoint":"1f6bb"},{"description":"put litter in its place symbol","shortname":":put_litter_in_its_place:","codePoint":"1f6ae"},{"description":"cinema","shortname":":cinema:","codePoint":"1f3a6"},{"description":"antenna with bars","shortname":":signal_strength:","codePoint":"1f4f6"},{"description":"squared katakana koko","shortname":":koko:","codePoint":"1f201"},{"description":"squared ng","shortname":":ng:","codePoint":"1f196"},{"description":"squared ok","shortname":":ok:","codePoint":"1f197"},{"description":"squared up with exclamation mark","shortname":":up:","codePoint":"1f199"},{"description":"squared cool","shortname":":cool:","codePoint":"1f192"},{"description":"squared new","shortname":":new:","codePoint":"1f195"},{"description":"squared free","shortname":":free:","codePoint":"1f193"},{"description":"keycap digit zero","shortname":":zero:","codePoint":"0030-20e3"},{"description":"keycap digit one","shortname":":one:","codePoint":"0031-20e3"},{"description":"keycap digit two","shortname":":two:","codePoint":"0032-20e3"},{"description":"keycap digit three","shortname":":three:","codePoint":"0033-20e3"},{"description":"keycap digit four","shortname":":four:","codePoint":"0034-20e3"},{"description":"keycap digit five","shortname":":five:","codePoint":"0035-20e3"},{"description":"keycap digit six","shortname":":six:","codePoint":"0036-20e3"},{"description":"keycap digit seven","shortname":":seven:","codePoint":"0037-20e3"},{"description":"keycap digit eight","shortname":":eight:","codePoint":"0038-20e3"},{"description":"keycap digit nine","shortname":":nine:","codePoint":"0039-20e3"},{"description":"keycap ten","shortname":":ten:","codePoint":"1f51f"},{"description":"input symbol for numbers","shortname":":1234:","codePoint":"1f522"},{"description":"black right-pointing triangle","shortname":":arrow_forward:","codePoint":"25b6"},{"description":"double vertical bar","shortname":":pause_button:","codePoint":"23f8"},{"description":"black right-pointing double triangle with double vertical bar","shortname":":play_pause:","codePoint":"23ef"},{"description":"black square for stop","shortname":":stop_button:","codePoint":"23f9"},{"description":"black circle for record","shortname":":record_button:","codePoint":"23fa"},{"description":"black right-pointing double triangle with vertical bar","shortname":":track_next:","codePoint":"23ed"},{"description":"black left-pointing double triangle with vertical bar","shortname":":track_previous:","codePoint":"23ee"},{"description":"black right-pointing double triangle","shortname":":fast_forward:","codePoint":"23e9"},{"description":"black left-pointing double triangle","shortname":":rewind:","codePoint":"23ea"},{"description":"twisted rightwards arrows","shortname":":twisted_rightwards_arrows:","codePoint":"1f500"},{"description":"clockwise rightwards and leftwards open circle arrows","shortname":":repeat:","codePoint":"1f501"},{"description":"clockwise rightwards and leftwards open circle arrows with circled one overlay","shortname":":repeat_one:","codePoint":"1f502"},{"description":"black left-pointing triangle","shortname":":arrow_backward:","codePoint":"25c0"},{"description":"up-pointing small red triangle","shortname":":arrow_up_small:","codePoint":"1f53c"},{"description":"down-pointing small red triangle","shortname":":arrow_down_small:","codePoint":"1f53d"},{"description":"black up-pointing double triangle","shortname":":arrow_double_up:","codePoint":"23eb"},{"description":"black down-pointing double triangle","shortname":":arrow_double_down:","codePoint":"23ec"},{"description":"black rightwards arrow","shortname":":arrow_right:","codePoint":"27a1"},{"description":"leftwards black arrow","shortname":":arrow_left:","codePoint":"2b05"},{"description":"upwards black arrow","shortname":":arrow_up:","codePoint":"2b06"},{"description":"downwards black arrow","shortname":":arrow_down:","codePoint":"2b07"},{"description":"north east arrow","shortname":":arrow_upper_right:","codePoint":"2197"},{"description":"south east arrow","shortname":":arrow_lower_right:","codePoint":"2198"},{"description":"south west arrow","shortname":":arrow_lower_left:","codePoint":"2199"},{"description":"north west arrow","shortname":":arrow_upper_left:","codePoint":"2196"},{"description":"up down arrow","shortname":":arrow_up_down:","codePoint":"2195"},{"description":"left right arrow","shortname":":left_right_arrow:","codePoint":"2194"},{"description":"anticlockwise downwards and upwards open circle arrows","shortname":":arrows_counterclockwise:","codePoint":"1f504"},{"description":"rightwards arrow with hook","shortname":":arrow_right_hook:","codePoint":"21aa"},{"description":"leftwards arrow with hook","shortname":":leftwards_arrow_with_hook:","codePoint":"21a9"},{"description":"arrow pointing rightwards then curving upwards","shortname":":arrow_heading_up:","codePoint":"2934"},{"description":"arrow pointing rightwards then curving downwards","shortname":":arrow_heading_down:","codePoint":"2935"},{"description":"keycap number sign","shortname":":hash:","codePoint":"0023-20e3"},{"description":"keycap asterisk","shortname":":asterisk:","codePoint":"002a-20e3"},{"description":"information source","shortname":":information_source:","codePoint":"2139"},{"description":"input symbol for latin letters","shortname":":abc:","codePoint":"1f524"},{"description":"input symbol for latin small letters","shortname":":abcd:","codePoint":"1f521"},{"description":"input symbol for latin capital letters","shortname":":capital_abcd:","codePoint":"1f520"},{"description":"input symbol for symbols","shortname":":symbols:","codePoint":"1f523"},{"description":"musical note","shortname":":musical_note:","codePoint":"1f3b5"},{"description":"multiple musical notes","shortname":":notes:","codePoint":"1f3b6"},{"description":"wavy dash","shortname":":wavy_dash:","codePoint":"3030"},{"description":"curly loop","shortname":":curly_loop:","codePoint":"27b0"},{"description":"heavy check mark","shortname":":heavy_check_mark:","codePoint":"2714"},{"description":"clockwise downwards and upwards open circle arrows","shortname":":arrows_clockwise:","codePoint":"1f503"},{"description":"heavy plus sign","shortname":":heavy_plus_sign:","codePoint":"2795"},{"description":"heavy minus sign","shortname":":heavy_minus_sign:","codePoint":"2796"},{"description":"heavy division sign","shortname":":heavy_division_sign:","codePoint":"2797"},{"description":"heavy multiplication x","shortname":":heavy_multiplication_x:","codePoint":"2716"},{"description":"heavy dollar sign","shortname":":heavy_dollar_sign:","codePoint":"1f4b2"},{"description":"currency exchange","shortname":":currency_exchange:","codePoint":"1f4b1"},{"description":"copyright sign","shortname":":copyright:","codePoint":"00a9"},{"description":"registered sign","shortname":":registered:","codePoint":"00ae"},{"description":"trade mark sign","shortname":":tm:","codePoint":"2122"},{"description":"end with leftwards arrow above","shortname":":end:","codePoint":"1f51a"},{"description":"back with leftwards arrow above","shortname":":back:","codePoint":"1f519"},{"description":"on with exclamation mark with left right arrow abo","shortname":":on:","codePoint":"1f51b"},{"description":"top with upwards arrow above","shortname":":top:","codePoint":"1f51d"},{"description":"soon with rightwards arrow above","shortname":":soon:","codePoint":"1f51c"},{"description":"ballot box with check","shortname":":ballot_box_with_check:","codePoint":"2611"},{"description":"radio button","shortname":":radio_button:","codePoint":"1f518"},{"description":"medium white circle","shortname":":white_circle:","codePoint":"26aa"},{"description":"medium black circle","shortname":":black_circle:","codePoint":"26ab"},{"description":"large red circle","shortname":":red_circle:","codePoint":"1f534"},{"description":"large blue circle","shortname":":large_blue_circle:","codePoint":"1f535"},{"description":"small orange diamond","shortname":":small_orange_diamond:","codePoint":"1f538"},{"description":"small blue diamond","shortname":":small_blue_diamond:","codePoint":"1f539"},{"description":"large orange diamond","shortname":":large_orange_diamond:","codePoint":"1f536"},{"description":"large blue diamond","shortname":":large_blue_diamond:","codePoint":"1f537"},{"description":"up-pointing red triangle","shortname":":small_red_triangle:","codePoint":"1f53a"},{"description":"black small square","shortname":":black_small_square:","codePoint":"25aa"},{"description":"white small square","shortname":":white_small_square:","codePoint":"25ab"},{"description":"black large square","shortname":":black_large_square:","codePoint":"2b1b"},{"description":"white large square","shortname":":white_large_square:","codePoint":"2b1c"},{"description":"down-pointing red triangle","shortname":":small_red_triangle_down:","codePoint":"1f53b"},{"description":"black medium square","shortname":":black_medium_square:","codePoint":"25fc"},{"description":"white medium square","shortname":":white_medium_square:","codePoint":"25fb"},{"description":"black medium small square","shortname":":black_medium_small_square:","codePoint":"25fe"},{"description":"white medium small square","shortname":":white_medium_small_square:","codePoint":"25fd"},{"description":"black square button","shortname":":black_square_button:","codePoint":"1f532"},{"description":"white square button","shortname":":white_square_button:","codePoint":"1f533"},{"description":"speaker","shortname":":speaker:","codePoint":"1f508"},{"description":"speaker with one sound wave","shortname":":sound:","codePoint":"1f509"},{"description":"speaker with three sound waves","shortname":":loud_sound:","codePoint":"1f50a"},{"description":"speaker with cancellation stroke","shortname":":mute:","codePoint":"1f507"},{"description":"cheering megaphone","shortname":":mega:","codePoint":"1f4e3"},{"description":"public address loudspeaker","shortname":":loudspeaker:","codePoint":"1f4e2"},{"description":"bell","shortname":":bell:","codePoint":"1f514"},{"description":"bell with cancellation stroke","shortname":":no_bell:","codePoint":"1f515"},{"description":"playing card black joker","shortname":":black_joker:","codePoint":"1f0cf"},{"description":"mahjong tile red dragon","shortname":":mahjong:","codePoint":"1f004"},{"description":"black spade suit","shortname":":spades:","codePoint":"2660"},{"description":"black club suit","shortname":":clubs:","codePoint":"2663"},{"description":"black heart suit","shortname":":hearts:","codePoint":"2665"},{"description":"black diamond suit","shortname":":diamonds:","codePoint":"2666"},{"description":"flower playing cards","shortname":":flower_playing_cards:","codePoint":"1f3b4"},{"description":"thought balloon","shortname":":thought_balloon:","codePoint":"1f4ad"},{"description":"right anger bubble","shortname":":anger_right:","codePoint":"1f5ef"},{"description":"speech balloon","shortname":":speech_balloon:","codePoint":"1f4ac"},{"description":"clock face one oclock","shortname":":clock1:","codePoint":"1f550"},{"description":"clock face two oclock","shortname":":clock2:","codePoint":"1f551"},{"description":"clock face three oclock","shortname":":clock3:","codePoint":"1f552"},{"description":"clock face four oclock","shortname":":clock4:","codePoint":"1f553"},{"description":"clock face five oclock","shortname":":clock5:","codePoint":"1f554"},{"description":"clock face six oclock","shortname":":clock6:","codePoint":"1f555"},{"description":"clock face seven oclock","shortname":":clock7:","codePoint":"1f556"},{"description":"clock face eight oclock","shortname":":clock8:","codePoint":"1f557"},{"description":"clock face nine oclock","shortname":":clock9:","codePoint":"1f558"},{"description":"clock face ten oclock","shortname":":clock10:","codePoint":"1f559"},{"description":"clock face eleven oclock","shortname":":clock11:","codePoint":"1f55a"},{"description":"clock face twelve oclock","shortname":":clock12:","codePoint":"1f55b"},{"description":"clock face one-thirty","shortname":":clock130:","codePoint":"1f55c"},{"description":"clock face two-thirty","shortname":":clock230:","codePoint":"1f55d"},{"description":"clock face three-thirty","shortname":":clock330:","codePoint":"1f55e"},{"description":"clock face four-thirty","shortname":":clock430:","codePoint":"1f55f"},{"description":"clock face five-thirty","shortname":":clock530:","codePoint":"1f560"},{"description":"clock face six-thirty","shortname":":clock630:","codePoint":"1f561"},{"description":"clock face seven-thirty","shortname":":clock730:","codePoint":"1f562"},{"description":"clock face eight-thirty","shortname":":clock830:","codePoint":"1f563"},{"description":"clock face nine-thirty","shortname":":clock930:","codePoint":"1f564"},{"description":"clock face ten-thirty","shortname":":clock1030:","codePoint":"1f565"},{"description":"clock face eleven-thirty","shortname":":clock1130:","codePoint":"1f566"},{"description":"clock face twelve-thirty","shortname":":clock1230:","codePoint":"1f567"},{"description":"eye in speech bubble","shortname":":eye_in_speech_bubble:","codePoint":"1f441-1f5e8"}]
			},
			{ name: 'flags', description: 'Flags', codePoint: '1f3f3', emojis:
				[{"description":"ascension","shortname":":flag_ac:","codePoint":"1f1e6-1f1e8"},{"description":"afghanistan","shortname":":flag_af:","codePoint":"1f1e6-1f1eb"},{"description":"albania","shortname":":flag_al:","codePoint":"1f1e6-1f1f1"},{"description":"algeria","shortname":":flag_dz:","codePoint":"1f1e9-1f1ff"},{"description":"andorra","shortname":":flag_ad:","codePoint":"1f1e6-1f1e9"},{"description":"angola","shortname":":flag_ao:","codePoint":"1f1e6-1f1f4"},{"description":"anguilla","shortname":":flag_ai:","codePoint":"1f1e6-1f1ee"},{"description":"antigua and barbuda","shortname":":flag_ag:","codePoint":"1f1e6-1f1ec"},{"description":"argentina","shortname":":flag_ar:","codePoint":"1f1e6-1f1f7"},{"description":"armenia","shortname":":flag_am:","codePoint":"1f1e6-1f1f2"},{"description":"aruba","shortname":":flag_aw:","codePoint":"1f1e6-1f1fc"},{"description":"australia","shortname":":flag_au:","codePoint":"1f1e6-1f1fa"},{"description":"austria","shortname":":flag_at:","codePoint":"1f1e6-1f1f9"},{"description":"azerbaijan","shortname":":flag_az:","codePoint":"1f1e6-1f1ff"},{"description":"the bahamas","shortname":":flag_bs:","codePoint":"1f1e7-1f1f8"},{"description":"bahrain","shortname":":flag_bh:","codePoint":"1f1e7-1f1ed"},{"description":"bangladesh","shortname":":flag_bd:","codePoint":"1f1e7-1f1e9"},{"description":"barbados","shortname":":flag_bb:","codePoint":"1f1e7-1f1e7"},{"description":"belarus","shortname":":flag_by:","codePoint":"1f1e7-1f1fe"},{"description":"belgium","shortname":":flag_be:","codePoint":"1f1e7-1f1ea"},{"description":"belize","shortname":":flag_bz:","codePoint":"1f1e7-1f1ff"},{"description":"benin","shortname":":flag_bj:","codePoint":"1f1e7-1f1ef"},{"description":"bermuda","shortname":":flag_bm:","codePoint":"1f1e7-1f1f2"},{"description":"bhutan","shortname":":flag_bt:","codePoint":"1f1e7-1f1f9"},{"description":"bolivia","shortname":":flag_bo:","codePoint":"1f1e7-1f1f4"},{"description":"bosnia and herzegovina","shortname":":flag_ba:","codePoint":"1f1e7-1f1e6"},{"description":"botswana","shortname":":flag_bw:","codePoint":"1f1e7-1f1fc"},{"description":"brazil","shortname":":flag_br:","codePoint":"1f1e7-1f1f7"},{"description":"brunei","shortname":":flag_bn:","codePoint":"1f1e7-1f1f3"},{"description":"bulgaria","shortname":":flag_bg:","codePoint":"1f1e7-1f1ec"},{"description":"burkina faso","shortname":":flag_bf:","codePoint":"1f1e7-1f1eb"},{"description":"burundi","shortname":":flag_bi:","codePoint":"1f1e7-1f1ee"},{"description":"cape verde","shortname":":flag_cv:","codePoint":"1f1e8-1f1fb"},{"description":"cambodia","shortname":":flag_kh:","codePoint":"1f1f0-1f1ed"},{"description":"cameroon","shortname":":flag_cm:","codePoint":"1f1e8-1f1f2"},{"description":"canada","shortname":":flag_ca:","codePoint":"1f1e8-1f1e6"},{"description":"cayman islands","shortname":":flag_ky:","codePoint":"1f1f0-1f1fe"},{"description":"central african republic","shortname":":flag_cf:","codePoint":"1f1e8-1f1eb"},{"description":"chad","shortname":":flag_td:","codePoint":"1f1f9-1f1e9"},{"description":"chile","shortname":":flag_cl:","codePoint":"1f1e8-1f1f1"},{"description":"china","shortname":":flag_cn:","codePoint":"1f1e8-1f1f3"},{"description":"colombia","shortname":":flag_co:","codePoint":"1f1e8-1f1f4"},{"description":"the comoros","shortname":":flag_km:","codePoint":"1f1f0-1f1f2"},{"description":"the republic of the congo","shortname":":flag_cg:","codePoint":"1f1e8-1f1ec"},{"description":"the democratic republic of the congo","shortname":":flag_cd:","codePoint":"1f1e8-1f1e9"},{"description":"costa rica","shortname":":flag_cr:","codePoint":"1f1e8-1f1f7"},{"description":"croatia","shortname":":flag_hr:","codePoint":"1f1ed-1f1f7"},{"description":"cuba","shortname":":flag_cu:","codePoint":"1f1e8-1f1fa"},{"description":"cyprus","shortname":":flag_cy:","codePoint":"1f1e8-1f1fe"},{"description":"the czech republic","shortname":":flag_cz:","codePoint":"1f1e8-1f1ff"},{"description":"denmark","shortname":":flag_dk:","codePoint":"1f1e9-1f1f0"},{"description":"djibouti","shortname":":flag_dj:","codePoint":"1f1e9-1f1ef"},{"description":"dominica","shortname":":flag_dm:","codePoint":"1f1e9-1f1f2"},{"description":"the dominican republic","shortname":":flag_do:","codePoint":"1f1e9-1f1f4"},{"description":"ecuador","shortname":":flag_ec:","codePoint":"1f1ea-1f1e8"},{"description":"egypt","shortname":":flag_eg:","codePoint":"1f1ea-1f1ec"},{"description":"el salvador","shortname":":flag_sv:","codePoint":"1f1f8-1f1fb"},{"description":"equatorial guinea","shortname":":flag_gq:","codePoint":"1f1ec-1f1f6"},{"description":"eritrea","shortname":":flag_er:","codePoint":"1f1ea-1f1f7"},{"description":"estonia","shortname":":flag_ee:","codePoint":"1f1ea-1f1ea"},{"description":"ethiopia","shortname":":flag_et:","codePoint":"1f1ea-1f1f9"},{"description":"falkland islands","shortname":":flag_fk:","codePoint":"1f1eb-1f1f0"},{"description":"faroe islands","shortname":":flag_fo:","codePoint":"1f1eb-1f1f4"},{"description":"fiji","shortname":":flag_fj:","codePoint":"1f1eb-1f1ef"},{"description":"finland","shortname":":flag_fi:","codePoint":"1f1eb-1f1ee"},{"description":"france","shortname":":flag_fr:","codePoint":"1f1eb-1f1f7"},{"description":"french polynesia","shortname":":flag_pf:","codePoint":"1f1f5-1f1eb"},{"description":"gabon","shortname":":flag_ga:","codePoint":"1f1ec-1f1e6"},{"description":"the gambia","shortname":":flag_gm:","codePoint":"1f1ec-1f1f2"},{"description":"georgia","shortname":":flag_ge:","codePoint":"1f1ec-1f1ea"},{"description":"germany","shortname":":flag_de:","codePoint":"1f1e9-1f1ea"},{"description":"ghana","shortname":":flag_gh:","codePoint":"1f1ec-1f1ed"},{"description":"gibraltar","shortname":":flag_gi:","codePoint":"1f1ec-1f1ee"},{"description":"greece","shortname":":flag_gr:","codePoint":"1f1ec-1f1f7"},{"description":"greenland","shortname":":flag_gl:","codePoint":"1f1ec-1f1f1"},{"description":"grenada","shortname":":flag_gd:","codePoint":"1f1ec-1f1e9"},{"description":"guam","shortname":":flag_gu:","codePoint":"1f1ec-1f1fa"},{"description":"guatemala","shortname":":flag_gt:","codePoint":"1f1ec-1f1f9"},{"description":"guinea","shortname":":flag_gn:","codePoint":"1f1ec-1f1f3"},{"description":"guinea-bissau","shortname":":flag_gw:","codePoint":"1f1ec-1f1fc"},{"description":"guyana","shortname":":flag_gy:","codePoint":"1f1ec-1f1fe"},{"description":"haiti","shortname":":flag_ht:","codePoint":"1f1ed-1f1f9"},{"description":"honduras","shortname":":flag_hn:","codePoint":"1f1ed-1f1f3"},{"description":"hong kong","shortname":":flag_hk:","codePoint":"1f1ed-1f1f0"},{"description":"hungary","shortname":":flag_hu:","codePoint":"1f1ed-1f1fa"},{"description":"iceland","shortname":":flag_is:","codePoint":"1f1ee-1f1f8"},{"description":"india","shortname":":flag_in:","codePoint":"1f1ee-1f1f3"},{"description":"indonesia","shortname":":flag_id:","codePoint":"1f1ee-1f1e9"},{"description":"iran","shortname":":flag_ir:","codePoint":"1f1ee-1f1f7"},{"description":"iraq","shortname":":flag_iq:","codePoint":"1f1ee-1f1f6"},{"description":"ireland","shortname":":flag_ie:","codePoint":"1f1ee-1f1ea"},{"description":"israel","shortname":":flag_il:","codePoint":"1f1ee-1f1f1"},{"description":"italy","shortname":":flag_it:","codePoint":"1f1ee-1f1f9"},{"description":"cte divoire","shortname":":flag_ci:","codePoint":"1f1e8-1f1ee"},{"description":"jamaica","shortname":":flag_jm:","codePoint":"1f1ef-1f1f2"},{"description":"japan","shortname":":flag_jp:","codePoint":"1f1ef-1f1f5"},{"description":"jersey","shortname":":flag_je:","codePoint":"1f1ef-1f1ea"},{"description":"jordan","shortname":":flag_jo:","codePoint":"1f1ef-1f1f4"},{"description":"kazakhstan","shortname":":flag_kz:","codePoint":"1f1f0-1f1ff"},{"description":"kenya","shortname":":flag_ke:","codePoint":"1f1f0-1f1ea"},{"description":"kiribati","shortname":":flag_ki:","codePoint":"1f1f0-1f1ee"},{"description":"kosovo","shortname":":flag_xk:","codePoint":"1f1fd-1f1f0"},{"description":"kuwait","shortname":":flag_kw:","codePoint":"1f1f0-1f1fc"},{"description":"kyrgyzstan","shortname":":flag_kg:","codePoint":"1f1f0-1f1ec"},{"description":"laos","shortname":":flag_la:","codePoint":"1f1f1-1f1e6"},{"description":"latvia","shortname":":flag_lv:","codePoint":"1f1f1-1f1fb"},{"description":"lebanon","shortname":":flag_lb:","codePoint":"1f1f1-1f1e7"},{"description":"lesotho","shortname":":flag_ls:","codePoint":"1f1f1-1f1f8"},{"description":"liberia","shortname":":flag_lr:","codePoint":"1f1f1-1f1f7"},{"description":"libya","shortname":":flag_ly:","codePoint":"1f1f1-1f1fe"},{"description":"liechtenstein","shortname":":flag_li:","codePoint":"1f1f1-1f1ee"},{"description":"lithuania","shortname":":flag_lt:","codePoint":"1f1f1-1f1f9"},{"description":"luxembourg","shortname":":flag_lu:","codePoint":"1f1f1-1f1fa"},{"description":"macau","shortname":":flag_mo:","codePoint":"1f1f2-1f1f4"},{"description":"macedonia","shortname":":flag_mk:","codePoint":"1f1f2-1f1f0"},{"description":"madagascar","shortname":":flag_mg:","codePoint":"1f1f2-1f1ec"},{"description":"malawi","shortname":":flag_mw:","codePoint":"1f1f2-1f1fc"},{"description":"malaysia","shortname":":flag_my:","codePoint":"1f1f2-1f1fe"},{"description":"maldives","shortname":":flag_mv:","codePoint":"1f1f2-1f1fb"},{"description":"mali","shortname":":flag_ml:","codePoint":"1f1f2-1f1f1"},{"description":"malta","shortname":":flag_mt:","codePoint":"1f1f2-1f1f9"},{"description":"the marshall islands","shortname":":flag_mh:","codePoint":"1f1f2-1f1ed"},{"description":"mauritania","shortname":":flag_mr:","codePoint":"1f1f2-1f1f7"},{"description":"mauritius","shortname":":flag_mu:","codePoint":"1f1f2-1f1fa"},{"description":"mexico","shortname":":flag_mx:","codePoint":"1f1f2-1f1fd"},{"description":"micronesia","shortname":":flag_fm:","codePoint":"1f1eb-1f1f2"},{"description":"moldova","shortname":":flag_md:","codePoint":"1f1f2-1f1e9"},{"description":"monaco","shortname":":flag_mc:","codePoint":"1f1f2-1f1e8"},{"description":"mongolia","shortname":":flag_mn:","codePoint":"1f1f2-1f1f3"},{"description":"montenegro","shortname":":flag_me:","codePoint":"1f1f2-1f1ea"},{"description":"montserrat","shortname":":flag_ms:","codePoint":"1f1f2-1f1f8"},{"description":"morocco","shortname":":flag_ma:","codePoint":"1f1f2-1f1e6"},{"description":"mozambique","shortname":":flag_mz:","codePoint":"1f1f2-1f1ff"},{"description":"myanmar","shortname":":flag_mm:","codePoint":"1f1f2-1f1f2"},{"description":"namibia","shortname":":flag_na:","codePoint":"1f1f3-1f1e6"},{"description":"nauru","shortname":":flag_nr:","codePoint":"1f1f3-1f1f7"},{"description":"nepal","shortname":":flag_np:","codePoint":"1f1f3-1f1f5"},{"description":"the netherlands","shortname":":flag_nl:","codePoint":"1f1f3-1f1f1"},{"description":"new caledonia","shortname":":flag_nc:","codePoint":"1f1f3-1f1e8"},{"description":"new zealand","shortname":":flag_nz:","codePoint":"1f1f3-1f1ff"},{"description":"nicaragua","shortname":":flag_ni:","codePoint":"1f1f3-1f1ee"},{"description":"niger","shortname":":flag_ne:","codePoint":"1f1f3-1f1ea"},{"description":"nigeria","shortname":":flag_ng:","codePoint":"1f1f3-1f1ec"},{"description":"niue","shortname":":flag_nu:","codePoint":"1f1f3-1f1fa"},{"description":"north korea","shortname":":flag_kp:","codePoint":"1f1f0-1f1f5"},{"description":"norway","shortname":":flag_no:","codePoint":"1f1f3-1f1f4"},{"description":"oman","shortname":":flag_om:","codePoint":"1f1f4-1f1f2"},{"description":"pakistan","shortname":":flag_pk:","codePoint":"1f1f5-1f1f0"},{"description":"palau","shortname":":flag_pw:","codePoint":"1f1f5-1f1fc"},{"description":"palestinian authority","shortname":":flag_ps:","codePoint":"1f1f5-1f1f8"},{"description":"panama","shortname":":flag_pa:","codePoint":"1f1f5-1f1e6"},{"description":"papua new guinea","shortname":":flag_pg:","codePoint":"1f1f5-1f1ec"},{"description":"paraguay","shortname":":flag_py:","codePoint":"1f1f5-1f1fe"},{"description":"peru","shortname":":flag_pe:","codePoint":"1f1f5-1f1ea"},{"description":"the philippines","shortname":":flag_ph:","codePoint":"1f1f5-1f1ed"},{"description":"poland","shortname":":flag_pl:","codePoint":"1f1f5-1f1f1"},{"description":"portugal","shortname":":flag_pt:","codePoint":"1f1f5-1f1f9"},{"description":"puerto rico","shortname":":flag_pr:","codePoint":"1f1f5-1f1f7"},{"description":"qatar","shortname":":flag_qa:","codePoint":"1f1f6-1f1e6"},{"description":"romania","shortname":":flag_ro:","codePoint":"1f1f7-1f1f4"},{"description":"russia","shortname":":flag_ru:","codePoint":"1f1f7-1f1fa"},{"description":"rwanda","shortname":":flag_rw:","codePoint":"1f1f7-1f1fc"},{"description":"saint helena","shortname":":flag_sh:","codePoint":"1f1f8-1f1ed"},{"description":"saint kitts and nevis","shortname":":flag_kn:","codePoint":"1f1f0-1f1f3"},{"description":"saint lucia","shortname":":flag_lc:","codePoint":"1f1f1-1f1e8"},{"description":"saint vincent and the grenadines","shortname":":flag_vc:","codePoint":"1f1fb-1f1e8"},{"description":"samoa","shortname":":flag_ws:","codePoint":"1f1fc-1f1f8"},{"description":"san marino","shortname":":flag_sm:","codePoint":"1f1f8-1f1f2"},{"description":"so tom and prncipe","shortname":":flag_st:","codePoint":"1f1f8-1f1f9"},{"description":"saudi arabia","shortname":":flag_sa:","codePoint":"1f1f8-1f1e6"},{"description":"senegal","shortname":":flag_sn:","codePoint":"1f1f8-1f1f3"},{"description":"serbia","shortname":":flag_rs:","codePoint":"1f1f7-1f1f8"},{"description":"the seychelles","shortname":":flag_sc:","codePoint":"1f1f8-1f1e8"},{"description":"sierra leone","shortname":":flag_sl:","codePoint":"1f1f8-1f1f1"},{"description":"singapore","shortname":":flag_sg:","codePoint":"1f1f8-1f1ec"},{"description":"slovakia","shortname":":flag_sk:","codePoint":"1f1f8-1f1f0"},{"description":"slovenia","shortname":":flag_si:","codePoint":"1f1f8-1f1ee"},{"description":"the solomon islands","shortname":":flag_sb:","codePoint":"1f1f8-1f1e7"},{"description":"somalia","shortname":":flag_so:","codePoint":"1f1f8-1f1f4"},{"description":"south africa","shortname":":flag_za:","codePoint":"1f1ff-1f1e6"},{"description":"korea","shortname":":flag_kr:","codePoint":"1f1f0-1f1f7"},{"description":"spain","shortname":":flag_es:","codePoint":"1f1ea-1f1f8"},{"description":"sri lanka","shortname":":flag_lk:","codePoint":"1f1f1-1f1f0"},{"description":"sudan","shortname":":flag_sd:","codePoint":"1f1f8-1f1e9"},{"description":"suriname","shortname":":flag_sr:","codePoint":"1f1f8-1f1f7"},{"description":"swaziland","shortname":":flag_sz:","codePoint":"1f1f8-1f1ff"},{"description":"sweden","shortname":":flag_se:","codePoint":"1f1f8-1f1ea"},{"description":"switzerland","shortname":":flag_ch:","codePoint":"1f1e8-1f1ed"},{"description":"syria","shortname":":flag_sy:","codePoint":"1f1f8-1f1fe"},{"description":"the republic of china","shortname":":flag_tw:","codePoint":"1f1f9-1f1fc"},{"description":"tajikistan","shortname":":flag_tj:","codePoint":"1f1f9-1f1ef"},{"description":"tanzania","shortname":":flag_tz:","codePoint":"1f1f9-1f1ff"},{"description":"thailand","shortname":":flag_th:","codePoint":"1f1f9-1f1ed"},{"description":"timor-leste","shortname":":flag_tl:","codePoint":"1f1f9-1f1f1"},{"description":"togo","shortname":":flag_tg:","codePoint":"1f1f9-1f1ec"},{"description":"tonga","shortname":":flag_to:","codePoint":"1f1f9-1f1f4"},{"description":"trinidad and tobago","shortname":":flag_tt:","codePoint":"1f1f9-1f1f9"},{"description":"tunisia","shortname":":flag_tn:","codePoint":"1f1f9-1f1f3"},{"description":"turkey","shortname":":flag_tr:","codePoint":"1f1f9-1f1f7"},{"description":"turkmenistan","shortname":":flag_tm:","codePoint":"1f1f9-1f1f2"},{"description":"tuvalu","shortname":":flag_tv:","codePoint":"1f1f9-1f1fb"},{"description":"uganda","shortname":":flag_ug:","codePoint":"1f1fa-1f1ec"},{"description":"ukraine","shortname":":flag_ua:","codePoint":"1f1fa-1f1e6"},{"description":"the united arab emirates","shortname":":flag_ae:","codePoint":"1f1e6-1f1ea"},{"description":"great britain","shortname":":flag_gb:","codePoint":"1f1ec-1f1e7"},{"description":"united states","shortname":":flag_us:","codePoint":"1f1fa-1f1f8"},{"description":"u.s. virgin islands","shortname":":flag_vi:","codePoint":"1f1fb-1f1ee"},{"description":"uruguay","shortname":":flag_uy:","codePoint":"1f1fa-1f1fe"},{"description":"uzbekistan","shortname":":flag_uz:","codePoint":"1f1fa-1f1ff"},{"description":"vanuatu","shortname":":flag_vu:","codePoint":"1f1fb-1f1fa"},{"description":"the vatican city","shortname":":flag_va:","codePoint":"1f1fb-1f1e6"},{"description":"venezuela","shortname":":flag_ve:","codePoint":"1f1fb-1f1ea"},{"description":"vietnam","shortname":":flag_vn:","codePoint":"1f1fb-1f1f3"},{"description":"wallis and futuna","shortname":":flag_wf:","codePoint":"1f1fc-1f1eb"},{"description":"western sahara","shortname":":flag_eh:","codePoint":"1f1ea-1f1ed"},{"description":"yemen","shortname":":flag_ye:","codePoint":"1f1fe-1f1ea"},{"description":"zambia","shortname":":flag_zm:","codePoint":"1f1ff-1f1f2"},{"description":"zimbabwe","shortname":":flag_zw:","codePoint":"1f1ff-1f1fc"},{"description":"runion","shortname":":flag_re:","codePoint":"1f1f7-1f1ea"},{"description":"land islands","shortname":":flag_ax:","codePoint":"1f1e6-1f1fd"},{"description":"tristan da cunha","shortname":":flag_ta:","codePoint":"1f1f9-1f1e6"},{"description":"british indian ocean territory","shortname":":flag_io:","codePoint":"1f1ee-1f1f4"},{"description":"caribbean netherlands","shortname":":flag_bq:","codePoint":"1f1e7-1f1f6"},{"description":"christmas island","shortname":":flag_cx:","codePoint":"1f1e8-1f1fd"},{"description":"cocos (keeling) islands","shortname":":flag_cc:","codePoint":"1f1e8-1f1e8"},{"description":"guernsey","shortname":":flag_gg:","codePoint":"1f1ec-1f1ec"},{"description":"isle of man","shortname":":flag_im:","codePoint":"1f1ee-1f1f2"},{"description":"mayotte","shortname":":flag_yt:","codePoint":"1f1fe-1f1f9"},{"description":"norfolk island","shortname":":flag_nf:","codePoint":"1f1f3-1f1eb"},{"description":"pitcairn","shortname":":flag_pn:","codePoint":"1f1f5-1f1f3"},{"description":"saint barthlemy","shortname":":flag_bl:","codePoint":"1f1e7-1f1f1"},{"description":"saint pierre and miquelon","shortname":":flag_pm:","codePoint":"1f1f5-1f1f2"},{"description":"south georgia","shortname":":flag_gs:","codePoint":"1f1ec-1f1f8"},{"description":"tokelau","shortname":":flag_tk:","codePoint":"1f1f9-1f1f0"},{"description":"bouvet island","shortname":":flag_bv:","codePoint":"1f1e7-1f1fb"},{"description":"heard island and mcdonald islands","shortname":":flag_hm:","codePoint":"1f1ed-1f1f2"},{"description":"svalbard and jan mayen","shortname":":flag_sj:","codePoint":"1f1f8-1f1ef"},{"description":"united states minor outlying islands","shortname":":flag_um:","codePoint":"1f1fa-1f1f2"},{"description":"canary islands","shortname":":flag_ic:","codePoint":"1f1ee-1f1e8"},{"description":"ceuta, melilla","shortname":":flag_ea:","codePoint":"1f1ea-1f1e6"},{"description":"clipperton island","shortname":":flag_cp:","codePoint":"1f1e8-1f1f5"},{"description":"diego garcia","shortname":":flag_dg:","codePoint":"1f1e9-1f1ec"},{"description":"american samoa","shortname":":flag_as:","codePoint":"1f1e6-1f1f8"},{"description":"antarctica","shortname":":flag_aq:","codePoint":"1f1e6-1f1f6"},{"description":"british virgin islands","shortname":":flag_vg:","codePoint":"1f1fb-1f1ec"},{"description":"cook islands","shortname":":flag_ck:","codePoint":"1f1e8-1f1f0"},{"description":"curaao","shortname":":flag_cw:","codePoint":"1f1e8-1f1fc"},{"description":"european union","shortname":":flag_eu:","codePoint":"1f1ea-1f1fa"},{"description":"french guiana","shortname":":flag_gf:","codePoint":"1f1ec-1f1eb"},{"description":"french southern territories","shortname":":flag_tf:","codePoint":"1f1f9-1f1eb"},{"description":"guadeloupe","shortname":":flag_gp:","codePoint":"1f1ec-1f1f5"},{"description":"martinique","shortname":":flag_mq:","codePoint":"1f1f2-1f1f6"},{"description":"northern mariana islands","shortname":":flag_mp:","codePoint":"1f1f2-1f1f5"},{"description":"sint maarten","shortname":":flag_sx:","codePoint":"1f1f8-1f1fd"},{"description":"south sudan","shortname":":flag_ss:","codePoint":"1f1f8-1f1f8"},{"description":"turks and caicos islands","shortname":":flag_tc:","codePoint":"1f1f9-1f1e8"},{"description":"saint martin","shortname":":flag_mf:","codePoint":"1f1f2-1f1eb"}]
			}

		
		],

		getGroupByName: function( name ){
			return ko.utils.arrayFirst( this.emojisGroups, function(emojiGroup){
				return emojiGroup.name == name;
			});
		},

		getGroupEmojis: function( name ){
			var result = [];
			var group = this.getGroupByName( name );
			if(group){
				result = group.emojis;
			}
			return result;
		}

	}).addMethods({
		init: function () {
			this._parent.apply(this, arguments);
			this._createComputed();
			//this._createValidations();
		},

		_createComputed: function(){
			//this.data.fontSize.extend( { asUnit: { units: ['px', '%'], defaultUnit: 'px' } } );
		},

		editar: true
	});
	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Producto = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.producto.producto'),
		descripcion	: ko.observable('snippets:snippet.producto.agrega_un_producto_de_tu_catalogo'),

		prototype	: {
			init: function(){
				this._parent.apply(this, arguments);

				if( !this.enlace ){
					this.enlace = new tiendasimple.helpers.Enlace();
				}
				this.enlace.asJS.tipo( tiendasimple.helpers.Enlace.TIPO_PRODUCTO );
				this.enlace.asJS.idProducto( this.data.id() );
				this.data.id = this.enlace.asJS.idProducto;
			},

			_setMappeable: function(){
				this._parent();

				this._mergeMappeable({
					tipo: 'producto',
					data: {
						id					: 0
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-product'
				});
			},

			_setMapping: function(){
				this._parent();
				this._mergeMapping({
				});
			},

			editar: function(){}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.GaleriaProductos = namespace.Snippet.Contenedor.extend({
		nombre		: ko.observable('snippets:snippet.galeriaproductos.galeriaproductos'),
		descripcion	: ko.observable('snippets:snippet.galeriaproductos.agrega_productos_de_tu_catalogo'),

		TIPO_CATALOGO	: 'catalogo',
		TIPO_BLOG    	: 'blog',
		TIPO_PRODUCTOS	: 'productos',
		TIPO_CATEGORIA	: 'categoria',
		TIPO_MAS_VENDIDOS	: 'mas_vendidos',

		CANTIDAD_MAXIMA	: 20,

		tipoOptions	: [
			{'text'	: 'Todo el catlogo', value: 'catalogo' },
			{'text'	: 'Productos seleccionados', value: 'productos' },
			{'text'	: 'Categora', value: 'categoria' }/*,
			 {'text'	: 'Productos ms vendidos', value: 'mas_vendidos' }*/
		],

		displayOptions: [
			{ 'text'	: '1x1', 'value' : '1x1', pageSize: 1, cols: 1 },
			{ 'text'	: '2x1', 'value' : '2x1', pageSize: 2, cols: 2 },
			{ 'text'	: '3x1', 'value' : '3x1', pageSize: 3, cols: 3 },
			{ 'text'	: '4x1', 'value' : '4x1', pageSize: 4, cols: 4 },
			{ 'text'	: '2x2', 'value' : '2x2', pageSize: 4, cols: 2 },
			{ 'text'	: '3x2', 'value' : '3x2', pageSize: 6, cols: 3 },
			{ 'text'	: '4x2', 'value' : '4x2', pageSize: 8, cols: 4 },
			{ 'text'	: '3x3', 'value' : '3x3', pageSize: 9, cols: 3 },
			{ 'text'	: '4x3', 'value' : '4x3', pageSize: 12, cols: 4 }

		],

		getDisplayOptionByValue: function( value ){
			return ko.utils.arrayFirst( this.displayOptions, function( displayOption ){
				return displayOption.value == value;
			});
		},

		prototype	: {
			init: function(){
				this._parent.apply(this, arguments);

				this.productos.extend({recordset: true});

				this._createSubscriptions();

				this._establecerCantProductos( this.data.cantidad() );
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'galeriaProductos',
					data: {
						tipo		: 'catalogo',
						idCategoria	: null,
						snippets	: [],

						cantidad	: -1,
						display		: '3x1'
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-galeria-productos',

					productos	: []
				});
			},

			_setMapping: function(){
				this._parent();
				this._mergeMapping({
					'productos'		: {
						'create'	: function( options ){
							var factory = $.getObjectProperty( tiendasimple, 'front.Producto' ) || $.getObjectProperty( tiendasimple, 'back.Producto' );
							return factory.createInstance( options.data );
						}
					}
				});
			},


			isLeaf: function(){
				return true;
			},


			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			obtenerProductosComputed: function( model, options ){
				var self = this;

				var id = ko.utils.createUID();

				var result = ko.observableDeferred( function(){
					return this.obtenerProductos( model, id );
				}, this, options );

				result.inProgress.subscribe( function( value ){
					self.productos.recordset.loading( value );
				});

				result.subscribe( function( response ){
					if( response ){
						self.update({productos: response.result.recordset});
						self.productos.recordset.update( response.result );
					} else {
						self.update({productos: []});
						self.productos.recordset.update({
						});
					}
				});

				result.valueHasMutated();

				this._addDisposable( result );
				return result;
			},

			obtenerProductos: function( model, id ){
				var result
					, self = this;
				this.productos.recordset.loading( true );

				switch( this.data.tipo() ){
					case this.constructor.TIPO_PRODUCTOS:
						result = this._obtenerProductosSeleccionados( model, id );
						break;

					case this.constructor.TIPO_CATALOGO:
					case this.constructor.TIPO_CATEGORIA:
						result = this._obtenerProductosDeCatalogo( model, id );
						break;
				}

				if(!result) result = $.Deferred().resolve({
					'response'			: {
						'pageCount'		: 0,
						'absolutePage'	: 0,
						'pageSize'		: 0,
						'recordset'		: []
					}
				});

				return result.always( function(){
					self.productos.recordset.loading( false );
				});
			},


			_obtenerProductosSeleccionados: function( model, id ){
				var ids				= this._getProductosIds()
					, ids			= $.arrayExclude(ids,[null,'',0,undefined])
					, absolutePage	= this.productos.recordset.absolutePage()
					, pageSize		= this.getPageSize()
					, orden			= []
					, firstRecord	 = absolutePage * pageSize

				var productos = [];
				var result;

				var deferreds = $.map( ids, function( id ){
					return model.obtenerProductosPorIdDeCache( id );
				});

				result = $.when.apply( $, deferreds ).then( function(){
					$.each( arguments, function( index, producto ){
						if( producto ) productos.push( producto );
					});
					var recordCount = productos.length;
					var pageCount = Math.ceil( recordCount / pageSize );
					var recordset = productos.slice( firstRecord, firstRecord + pageSize );
					return ({
						'result'		: {
							'pageCount'		: pageCount,
							'absolutePage'	: absolutePage,
							'pageSize'		: pageSize,
							'recordset'		: recordset
						}
					});
				});

				return result;
			},

			_obtenerProductosDeCatalogo: function( model, id ){
				var idCategoria = this.data.idCategoria()
					, absolutePage	 = this.productos.recordset.absolutePage()
					, pageSize		= this.getPageSize()
					, orden			= []
					, limit			= this.data.cantidad()
					, result;

				var options = {
					'filter'	: {
						'idCategoria'	: idCategoria
					},
					'absolutePage'		: absolutePage,
					'pageSize'			: pageSize,
					'limit'				: limit,
					'orden'				: orden
				};

				if( !idCategoria || this.data.tipo() == this.constructor.TIPO_CATALOGO ) delete options.filter.idCategoria;

				result = model.ajaxHelper.obtenerProductos( options )
				return result;

			},

			getPageSize: function(){
				var result = 1
					, displayOption = this.constructor.getDisplayOptionByValue( this.data.display() )
					, cantidad = this.data.cantidad()

				if( displayOption ){
					result = displayOption.pageSize;
					if( cantidad > 0 ) {
						result = Math.min( result, cantidad );
					}

				}

				return result;
			},

			getCols: function(){
				var result = 1;
				displayOption = this.constructor.getDisplayOptionByValue( this.data.display() );
				if( displayOption ){
					result = displayOption.cols;
				}

				return result;
			},

			getRows: function(){
				var result = 1;
				displayOption = this.constructor.getDisplayOptionByValue( this.data.display() );
				if( displayOption ){
					result = Math.ceil( displayOption.pageSize / displayOption.cols );
				}

				return result;
			},

			scrollIntoViewCatalago: function(){
				var target = document.querySelector('#catalogo-snippet');
				/* 
				scroll to top catalogo
				**/
				target.scrollIntoView(top)
  			},

			prevPage: function(){
				this.productos.recordset.prev();
			},

			nextPage: function(){
				this.productos.recordset.next();
			},

			getDisplayOptions: function(){
				var cantidad = this.data.cantidad();
				return ko.utils.arrayFilter( this.constructor.displayOptions, function( displayOption ){
					return cantidad == -1 || !displayOption.pageSize  || displayOption.pageSize <= cantidad;
				});
			},

			getCantidadOptions: function(){
				var result = [];
				if( this.data.tipo() != this.constructor.TIPO_PRODUCTOS ){
					result.push({'text' : 'todos', 'value': -1 });
				}
				for( var i = 1; i <= this.constructor.CANTIDAD_MAXIMA ; i ++ ){
					result.push({'text': i, 'value': i });
				}
				return result;
			},

			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			_createSubscriptions: function(){

				var c = ko.computed( function(){
					var tipo = this.data.tipo();
					var cantidad = this.data.cantidad();
					return [tipo, cantidad];
				}, this );
				this._addDisposable( c );

				var subscription = c.subscribe( function(){
					var cantidad = this.data.cantidad();
					this._establecerCantProductos( cantidad );
				}, this );

				this._addDisposable( subscription );
			},

			_establecerCantProductos: function( cantidad ){
				if( this.data.tipo() == this.constructor.TIPO_PRODUCTOS ){
					var productos = this.data.snippets();
					this.data.snippets.valueWillMutate();
					productos.splice(cantidad);
					for( var i = this.data.snippets().length ; i < cantidad ; i ++ ){
						productos.push( new namespace.Snippet.Producto() );
					}
					this.data.snippets.valueHasMutated();
				}
			},

			_getProductosIds: function(){
				return ko.utils.arrayMap( this.data.snippets(), function( producto ){
					return producto.data.id();
				});
			},

			editar: function(){}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Video = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.video.video'),
		descripcion	: ko.observable('snippets:snippet.video.agrega_videos_de_youtube_y_vimeo_a_tu_pagina'),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);

				this.style = ko.computed(function(){
					var result = {},
						width = this.data.width(),
						height = this.data.height();

					if( width && $.isNumeric( width )) width += 'px';
					if( height && $.isNumeric( height )) height += 'px';

					result['height'] = height || '';
					result['width'] = width || '';

					return result;
				}, this);
				this._addDisposable( this.style );
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'video',
					data: {
						url			: '',
						width		: '',
						height		: '',

						rel			: true,
						controls	: true,
						showinfo	: false,
						autoplay	: false,
						autohide	: true
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono			: 'icon-snippet-video',
					parseURLError	: ''
				});
			},

			editar: function(){
			},

			origen: function(){
				var url = this.data.url();
				if( $.string.getIdFromYoutubeURL( url ) ) return 'youtube';
				if( $.string.getIdFromVimeoURL( url ) ) return 'vimeo';
				if( $.string.getIdFromFacebookURL(url) ) return 'facebook';
				if( $.string.getIdFromTwitchURL(url) ) return 'twitch';
			},


			id: function(){
				var url = this.data.url(),
					id;

				this.parseURLError('');

				id = $.string.getIdFromYoutubeURL(url) || $.string.getIdFromVimeoURL(url) || $.string.getIdFromFacebookURL(url) || $.string.getIdFromTwitchURL(url);

				if(url && !id && !this.parseURLError()) this.parseURLError( i18n.kot('snippets:mensajes.no_es_una_url_conocida') );

				return id;
			},

			_getyoutubeSrc: function(){
				var params = {
                                        
					wmode	: 'opaque',
					rel		: this.data.rel() ? 1 : 0,
					controls: this.data.controls() ? 1 : 0,
					showinfo: this.data.showinfo() ? 1 : 0,
					autoplay: this.data.autoplay() ? 1 : 0,
					autohide: this.data.autohide() ? 1 : 0
                                        
				};
                                if(this.data.autoplay())
                                {
                                    params.mute = $.getAllQueryStrings().notrack != 1 ? window._autoplayMuted : 1;
                                }

				return 'https://www.youtube.com/embed/' + this.id() + '?' + $.param( $.withoutProperties( params, function(key,value){return value === undefined } ) );
			},

			_getvimeoSrc: function(){
				return '//player.vimeo.com/video/' + this.id() + '?portrait=0&amp;badge=0&amp;color=ff6666';
			},

			_getfacebookSrc: function(){
				return 'https://www.facebook.com/video.php?v=' + this.id();
			},

			_gettwitchSrc: function(){
				var params = {
					'channel'	: this.id(),
					'autoplay'	: this.data.autoplay()
				}
				return 'https://player.twitch.tv/?' + $.param( params );
			},

			getSrc: function(){
				var src = '';
				switch (this.origen()){
					case 'youtube':
						src = this._getyoutubeSrc();
						break;

					case 'vimeo':
						src = this._getvimeoSrc();
						break;

					case 'facebook':
						src = this._getfacebookSrc();
						break;

					case 'twitch':
						src = this._gettwitchSrc();
						break;
				}

				return src;
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('soundcloud', {
		mappeable			: {
			data			: {
				use			: 'url', // embed|url
				embed		: '',
				url			: '',
				oembedData	: null
			}
		},

		mapping				: {
			oembedData		: {
				create		: function( options ){
					return ko.observable( null );
				},

				update	: function( options ){
					var instance = options.data
						, observable = options.observable;

					if( observable ){
						observable( instance );
						if( $.isPlainObject(options.data) && !options.target ) instance = options.observable;
					}

					return instance;
				}
			}
		},

		defaults				: {
			editar				: true,
			parseEmbedError		: null,
			icono				: 'icon-snippet-soundcloud',
			obteniendoOembed	: false,
			obtenerOembedError	: null,
			oembedUrl			: 'proxy/oembed/',
			oembedFormat		: 'json'
		}
	}), {

		nombre		: ko.observable('snippets:snippet.soundcloud.soundcloud'),
		descripcion	: ko.observable('snippets:snippet.soundcloud.inserta_musica_de_soundcloud_en_tus_paginas'),
		useOembedCache	: false // usar o no el dato cacheado en nuestros servidores de oembed

	}).addMethods({
		init: function( data ){
			var self = this
				, args = arguments;

			if( !this.constructor.useOembedCache ){
				if( data && data.data && data.data.oembedData ) data.data.oembedData = null;
			}

			this._parent.apply( this, args );

			this.procesando = ko.computed( function(){
				return !!( this.data.use() === 'url' && this.obteniendoOembed() );
			}, this);

			this.configuradoCorrectamente = ko.computed(function(){
				return !!( !this.procesando() && !!( this.data.use() === 'embed' && this.getSrc() ) || ( this.data.use() === 'url' && this.data.oembedData() ));
			}, this);

			this.disableAccept = ko.computed( function(){
				return this.procesando() || !this.configuradoCorrectamente();
			}, this);

			this.nuevaUrl = ko.computed({
				read: function(){
					return this.data.url();
				},
				write: function( value ){
					this.data.url( value );
					this.getOembedDataFromServer();
				}
			}, this);

		},

		getSrc: function(){
			var embed = this.data.embed()
				, match
				, result
				, parseEmbedError = false
				, re = /src="(https\:\/\/w\.soundcloud.com\/player\/\?.*url=[^"]+)"/;
			if( embed ){
				match = embed.match(re);
				if( match && match[1] ) result = match[1];
				else parseEmbedError = true;
			}
			this.parseEmbedError( parseEmbedError ? i18n.kot('snippets:mensajes.el_codigo_embed_es_incorrecto') : '');
			return result;
		},

		getOembedData: function(){
			var oembedData = this.data.oembedData()
				, self = this;

			if( oembedData ) return self.filterOembedData( oembedData );
			else {
				setTimeout( function(){
					self.getOembedDataFromServer();
				},10);
			}
		},

		filterOembedData: function( oembedData ){
			return oembedData;
		},

		getOembedDataFromServer: function(){
			var self = this
				, url = $.trim(self.data.url.peek())
				, obteniendoOembed = self.obteniendoOembed.peek();

			if(url && url != self._ultimaUrlConError && !obteniendoOembed ){
				self.obteniendoOembed( true );
				return $.ajax({
					url			: this.oembedUrl.peek(),
					dataType	: "json",
					data		: $.extend(this.oembedRequestData, {
						service	: self.tipo.peek(),
						format	: self.oembedFormat.peek(),
						url		: url,
						iframe	: true
					})
				}).done( function( data ){
					self.data.oembedData(data);
					self.obtenerOembedError(null);
				}).fail( function(){
					self._ultimaUrlConError = url;
					self.data.oembedData(null);
					self.obtenerOembedError(i18n.kot('global:validacion.mensaje.url_incorrecta'));
				}).always( function(){
					self.obteniendoOembed( false );
				});
			}
		}


	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.Soundcloud.createSubClass('instagram', {
		mappeable			: {
			data			: {
			}
		},

		mapping				: {
		},

		defaults			: {
			editar			: true,
			icono			: 'icon-snippet-instagram',
			oembedFormat		: 'json'
		}
	}, namespace.Snippet), {
		nombre		: ko.observable('snippets:snippet.instagram.instagram'),
		descripcion	: ko.observable('snippets:snippet.instagram.agrega_imagenes_y_videos_de_instagram_en_tus_paginas'),

		scriptLoaded: ko.observable( false ),

		_insertScript: function(){
			var self = this;
			if( !this._insertingScript ){
				this._insertingScript = true;
				setTimeout( function(){
					$.getScript('//platform.instagram.com/en_US/embeds.js', function(){
						self.scriptLoaded( true );
					});
				}, 1000);
			}
		}


	}).addMethods({
		oembedRequestData: {
			omitscript: true
		},

		init: function(){
			this._parent.apply(this, arguments);
			this.oembedMediaType = ko.computed(function(){
				var ext = this.data.oembedData() && this.data.oembedData().url && this.data.oembedData().url.substr(-4)
					, result;
				switch ( ext ){
					case '.jpg':
						result = 'photo';
						break;
					case '.gif':
						result = 'photo';
						break;
					case '.mp4':
						result = 'video';
						break;
				}

				if( this.data.oembedData() && this.data.oembedData().type == 'rich' ) result = 'rich';

				return result;
			}, this);
		},

		getOembedDataFromServer: function(){
			this._parent.apply( this, arguments );
			this.constructor._insertScript();
		},

		getSrc: function(){
			var embed = this.data.embed()
				, match
				, result
				, parseEmbedError = false
				, re = /src="(\/\/instagram\.com\/p\/[\w-]+\/embed\/)"/;
			if( embed ){
				match = embed.match(re);
				if( match && match[1] ) result = match[1];
				else parseEmbedError = true;
			}
			this.parseEmbedError( parseEmbedError ? i18n.kot( 'snippets:mensajes.el_codigo_embed_es_incorrecto' ) : '');
			return result;
		},

		translateURL: function( originalUrl ){
			var newUrl = originalUrl;
			newUrl = newUrl.replace(/^http:\/\/images\.ak\.instagram\.com(.*)$/, '//distillery.s3.amazonaws.com$1');
			newUrl = newUrl.replace(/^http:\/\/distilleryimage([0-9]*)\.ak\.instagram\.com(.*)$/, '//distilleryimage$1.s3.amazonaws.com$2');
			newUrl = newUrl.replace(/^http:\/\/origincache-([a-z]*)\.fbcdn\.net(.*)$/, '//origincache-$1.fbcdn.net$2');
			newUrl = newUrl.replace(/^http:\/\/distilleryimage([0-9]*)\.s3\.amazonaws\.com(.*)$/, '//distilleryimage$1.s3.amazonaws.com$2');

			return newUrl;
		},

		scriptLoaded: function(){
			return this.constructor.scriptLoaded()
		}
	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.Soundcloud.createSubClass('ustream', {
		mappeable			: {
			data			: {
			}
		},

		mapping				: {
		},

		defaults			: {
			editar			: true,
			icono			: 'icon-snippet-ustream',
			oembedFormat		: 'json'
		}
	}, namespace.Snippet), {
		nombre		: ko.observable('snippets:snippet.ustream.ustream__tv_online'),
		descripcion	: ko.observable('snippets:snippet.ustream.agrega_una_transmision_de_audio_o_video_ustream')
	}).addMethods({
		init: function(){
			this._parent.apply(this, arguments);
		},

		getSrc: function(){
			/**
			 <iframe width="480" height="302" src="https://www.ustream.tv/embed/14031537?v=3&amp;wmode=direct" scrolling="no" frameborder="0" style="border: 0px none transparent;"></iframe>
			 <br /><a href="https://www.ustream.tv" style="font-size: 12px; line-height: 20px; font-weight: normal; text-align: left;" target="_blank">Broadcast live streaming video on Ustream</a>
			 */

			var embed = this.data.embed()
				, match
				, result
				, parseEmbedError = false
				, re = /src="(http(s)?:\/\/www.ustream.tv\/embed\/\w+)/;
			if( embed ){
				match = embed.match(re);
				if( match && match[1] ) result = match[1];
				else parseEmbedError = true;
			}
			this.parseEmbedError( parseEmbedError ? i18n.kot( 'snippets:mensajes.el_codigo_embed_es_incorrecto' ) : '');
			result = result + "?html5ui";
			return result;
		},

		translateURL: function( originalUrl ){
			if(location.protocol == 'https:'){
				return $.string.replace( originalUrl, 'http://', location.protocol + '//');
			} else {
				return $.string.replace( originalUrl, 'https://', location.protocol + '//');
			}
		},

		filterOembedData: function( oembedData){
			var self = this;
			$.each(oembedData, function(key, value){
				if(typeof value == 'string'){
					oembedData[key] = self.translateURL( value );
				}
			});
			return oembedData;
		}
	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('gettyimages', {
		mappeable			: {
			data			: {
				embed		: ''
			}
		},
		defaults			: {
			editar			: true,
			parseEmbedError	: null,
			icono			: 'icon-snippet-gettyimages'
		}
	}), {

	}).addMethods({
		getSrc: function(){
			var embed = this.data.embed()
				, match
				, result
				, parseEmbedError = false
				, re = /src="(https\:\/\/w\.soundcloud.com\/player\/\?url=[^"]+)"/;

			if( embed ){
				match = embed.match(re);
				if( match && match[1] ) result = match[1];
				else parseEmbedError = true;
			}
			this.parseEmbedError( parseEmbedError ? i18n.kot( 'snippets:mensajes.el_codigo_embed_es_incorrecto' ) : '');
			return result;
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Separador = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.separador.separador_horizontal'),
		descripcion	: ko.observable('snippets:snippet.separador.espacio_transparente_que_separa_contenidos_como_texto_imagenes_y_mas'),

		prototype	: {
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'separador'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					nombre	: 'Separador Horizontal',
					icono	: 'icon-snippet-horizontal-separator'
				});
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Divisor = namespace.Snippet.extend({
		nombre		: ko.observable("snippets:snippet.divisor.divisor_horizontal"),
		descripcion	: ko.observable("snippets:snippet.divisor.linea_divisora_que_separa_contenidos_como_texto_imagenes_y_mas"),

		prototype	: {
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'divisor'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-horizontal-divider'
				});
			}
		}
	});

	////////////////////////////////////////////////////////////////

	namespace.Snippet.Formulario = namespace.Snippet.Contenedor.extend({
		nombre		: ko.observable("snippets:snippet.formulario.formulario"),
		descripcion	: ko.observable("snippets:snippet.formulario.formulario_vacio_disenado_para_agregar_los_campos_que_desees"),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo		: 'formulario',
					data		: {
						titulo	: '',
						emailDestino : '',
						adjuntarArchivo : false,
						adjuntarArchivoUsuarioRegistrado : true,
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					estado	: '',
					icono	: 'icon-snippet-form'
				});
			},

			editar: function(){
				var self = this;
			},

			enviado: function(){
				this.estado( 'enviado' );
			},

			enviando: function(){
				this.estado( 'enviando' );
			},

			error: function( error ){
				this.estado( 'error-envio' );
			},

			reiniciarEstado: function(vm, event){
				this.navigateTree( function( snippet ){
					if (snippet instanceof namespace.Snippet.FormularioInput ){
						snippet.value('');
					}
				});
				this.estado( '' );
				this.showAllMessages(false);
			},

			/*
			 canBeChildOfPath: function( path ){
			 var canBe = !ko.utils.arrayFirst( path, function( snippet ){
			 return snippet instanceof namespace.Snippet.Formulario;
			 });

			 return canBe && this._parent.apply( this, arguments );
			 },*/
			_getBannedParentClasses: function(){
				return [ namespace.Snippet.Formulario ];
			},

			obtenerSnippetsDeTipoInput: function(){
				return this.obtenerSnippets( function( snippet) { return snippet instanceof tiendasimple.Snippet.FormularioInput } );
			},

			obtenerSnippetsDeTipoInputEmail: function(){
				return this.obtenerSnippets( function( snippet) {
					var result = false;
					var esInput = snippet instanceof tiendasimple.Snippet.FormularioInput;
					if( esInput ){
						result = snippet.data.type() == 'email';
					}
					return result;
				});
			},

			obtenerSnippetsDestinatarios: function(){
				var inputs = this.obtenerSnippetsDeTipoInput();
				var result = [];
				$.each( inputs, function( index, snippet ){
					if( snippet.data.type() == 'email' ){
						result.push({ 'importance': 1, 'snippet': snippet });
					} else {
						var value = $.trim(snippet.value());
						if( $.isEmail( value ) ){
							result.push({ 'importance': 2, 'snippet': snippet });
						}
					}
				});

				result.sort( function( a, b ){
					return a.importance < b.importance ? -1 : 1;
				});

				return $.pluckCollection( result, 'snippet' );
			},

			obtenerEmailsDestinatarios: function(){
				var result = $.pluckCollection( this.obtenerSnippetsDestinatarios(), 'value' );
				result = $.arrayExclude( result, ["",null,undefined]);
				return result;
			}
		}
	});

	namespace.Snippet.FormularioInput = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.formulario_input.campo_de_texto'),
		descripcion	: ko.observable('snippets:snippet.formulario_input.campo_de_texto_para_arrastrar_en_un_formulario'),
		tamanoVentanaEdicion		: 'small',
		prototype	: {
			init: function(){
				var self = this;
				this._parent.apply(this, arguments);


				this.value.extend({
					required: {
						value: true,
						onlyIf: this.data.required
					},

					email: {
						value: true,
						onlyIf: function(){ return self.data.type() === 'email'; }
					},

					number: {
						value: true,
						onlyIf: function(){ return self.data.type() === 'number'; }
					}
				});

				this._createValidations();

				this._createComputed();
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'formularioInput',
					data: {
						label			: i18n.kot('snippets:snippet.formulario_input.un_campo_de_texto'),
						type			: 'text', // text|email|number
						required		: false,
						inputBlockLevel	: false
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-form-input',
					value	: ''
				});
			},

			_createComputed: function(){
				this.disableAccept = ko.computed( function(){
					return !$.trim( this.data.label() );
				}, this );
			},

			editar: true,

			css: function(){
				var result = [ this._parent() ];
				if( this.data.inputBlockLevel() ) result.push("input-block-level");
				return result.join(" ");
			},

			/*
			 canBeChildOfPath: function( path ){
			 return !!ko.utils.arrayFirst( path, function( snippet ){
			 return snippet instanceof namespace.Snippet.Formulario && ( ! (snippet instanceof namespace.Snippet.FormEnvialoSimple ) );
			 });
			 },
			 */

			_getRequiredParentClasses: function(){
				return [namespace.Snippet.Formulario];
			},


			/*
			canBeChildOfSnippet: function ( snippet ){
				var result = this._parent.apply( this, arguments );
				result = result && snippet.tieneSnippet( function( snippet) {
						return snippet instanceof namespace.Snippet.Formulario && ( ! (snippet instanceof namespace.Snippet.FormEnvialoSimple ) );
					});
				return result;
			},
			*/


			/*
			canBeInmediateChildOfSnippet: function ( snippet ){
				return snippet.isOrIsChildOf( function( parent ){
					return parent instanceof namespace.Snippet.Formulario && ( ! ( parent instanceof namespace.Snippet.FormEnvialoSimple ) );
				});
			}*/


			beforeAccept: function( deferred ){
				if( !$.trim(this.data.label()) ){
					deferred.reject();
				} else {
					deferred.resolve();
				}
			}


		}
	});



	namespace.Snippet.FormularioTextarea = namespace.Snippet.FormularioInput.extend({
		nombre		: ko.observable('snippets:snippet.formulario_textarea.campo_de_texto_largo'),
		descripcion	: ko.observable('snippets:snippet.formulario_textarea.campo_de_texto_con_mas_espacio_para_arrastrar_en_un_formulario'),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'formularioTextarea'
				});
				this._mappeable.data.label = i18n.kot('snippets:snippet.formulario_textarea.un_campo_de_texto_largo');
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-form-textarea'
				});
			}
		}
	});


	namespace.Snippet.FormularioSelect = namespace.Snippet.FormularioInput.extend({
		nombre		: ko.observable('snippets:snippet.formulario_select.campo_de_seleccion'),
		descripcion	: ko.observable('snippets:snippet.formulario_select.campo_de_opciones_precargadas_para_arrastrar_en_un_formulario'),

		prototype	: {
			init: function(){
				this._parent.apply(this, arguments);


				this.unselectedOption = new namespace.Snippet.FormularioSelect.Option({text: '-----', value: ''});
				this.data.options.withNull = ko.computed(function(){
					var result = [].concat( this.data.options() );
					result.unshift( this.unselectedOption );
					return result;
				}, this);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'formularioSelect',
					value: undefined
				});
				this._mappeable.data.label = i18n.kot('snippets:snippet.formulario_select.un_campo_de_opciones');
				this._mappeable.data.options = [];
			},

			_setMapping: function(){
				this._parent();
				this._mergeMapping({
					options: {
						create: function( options ){
							return new namespace.Snippet.FormularioSelect.Option( options.data );
						}
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-form-select'
				});
			},

			removeOption: function( option ){
				this.data.options.remove( option );
			},

			addOption: function(){
				var option = new namespace.Snippet.FormularioSelect.Option();
				this.data.options.push(option);
			}
		}
	});

	namespace.Snippet.FormularioSelect.Option = ko.ViewModel.extend({
		init: function(){
			this._parent.apply( this, arguments );

			this.text.subscribe( function( value ){
				this.value( value );
			}, this);

		},
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				text	: '',
				value	: ''
			});
		}
	});

	////////////////////////////////////////////////////////////////////////////
        
         // GDPR SNIPPET //
        
        namespace.Snippet.FormularioGDPR = namespace.Snippet.extend({
		nombre		: ko.observable('Aceptacin uso de datos (GDPR)'),
		descripcion	: ko.observable('En los formularios personalizados podrs incluir una casilla de verificacin, manualmente.'),
		validDisplays	: [],
                
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
				this._settearTipoEnlace( this.data.enlace() );        
				this._fixLegacy();
                                
				this.parseEmbedError = ko.computed( function(){
					var result = '';
					if( this.isBadConfigured()){
						result = 'por favor ingresa un cdigo widget vlido';
					}
					return result;
				}, this );
                                
                this._createComputed();
                                
			},
			
			_getRequiredParentClasses: function(){
				return [namespace.Snippet.Formulario];
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'formularioGDPR',
					data: {
						embed	: '',
						user	: '',
						search	: '',
						hashtag	: '',
						label : '',
						gdpr : '',
						options: [],
						gdpr_label : '',
						contenido: '',
						enlace : '',
						texto_enlace : '',
						tiene_pagina : false,
						mostrar_combo : true,
						mostrar_url : false,
						tipo_de_enlace : '',
						pagina : '',
					}
				});

				
				if (model.data != undefined){
				
					var market = model.data.market;
					
					this._mappeable.data.gdpr = market.configuracion.get('regional_politicaGDPR');
					
					if (this._mappeable.data.gdpr){

						// gdpr habilitado
						if (market.configuracion.get('regional_politicaGDPR_label')){
							this._mappeable.data.gdpr_label = market.configuracion.get('regional_politicaGDPR_label');
							this._mappeable.data.contenido = market.configuracion.get('regional_politicaGDPR_label');
							this._mappeable.data.texto_enlace = 'Poltica de Privacidad.'; // i18
						}else{
							//i18
							this._mappeable.data.gdpr_label = ko.observable('');
						}

						if (market.configuracion.get('regional_politicaGDPR_url')){
							this._mappeable.data.gdpr_url = market.configuracion.get('regional_politicaGDPR_url');
							this._mappeable.data.enlace = market.configuracion.get('regional_politicaGDPR_url');
						}else{
							this._mappeable.data.gdpr_url = ko.observable('');
							this._mappeable.data.enlace = ko.observable('');
						}

					}else{

						// gdpr no habilitado
						this._mappeable.data.gdpr = '';
						this._mappeable.data.gdpr_url = '';
						//i18
						this._mappeable.data.gdpr_label = 'Acepto que mis datos sern utilizados con el objetivo de brindarme servicios, productos y asistencia, conformes a la poltica de uso de datos.';
						this._mappeable.data.contenido = 'Acepto que mis datos sern utilizados con el objetivo de brindarme servicios, productos y asistencia, conformes a la poltica de uso de datos.';
						this._mappeable.data.enlace = '';
						this._mappeable.data.texto_enlace = 'Poltica de Privacidad.';
					}
					
				}else{
					// model undefined
					this._mappeable.data.gdpr = '';
					this._mappeable.data.gdpr_url = '';
					this._mappeable.data.gdpr_label = 'Acepto GDPRque mis datos sern utilizados con el objetivo de brindarme servicios, productos y asistencia, conformes a la poltica de uso de datos.';
					this._mappeable.data.contenido = 'Acepto que mis datos sern utilizados con el objetivo de brindarme servicios, productos y asistencia, conformes a la poltica de uso de datos.';
					this._mappeable.data.enlace = '';
					this._mappeable.data.texto_enlace = 'Poltica de Privacidad.';
				}

			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-gdpr',
					editar	: true
				})
			},

			_getComplexityValue: function(){
				return this._parent.apply( this, arguments ) + 10;
			},

			_settearTipoEnlace: function( enlace ){

				if (enlace){
					if (enlace.indexOf('/#!/') == -1){
						this.data.tipo_de_enlace = 'externa';
						this.data.mostrar_combo = ko.observable( false );
						this.data.mostrar_url = ko.observable ( true );
					}else{
						this.data.tipo_de_enlace = 'misitio';
						this.data.mostrar_combo =  ko.observable ( true );
						this.data.mostrar_url = ko.observable( false );
					}
				}else{
					this.data.tipo_de_enlace = 'misitio';
					this.data.mostrar_combo =  ko.observable ( true );
					this.data.mostrar_url = ko.observable( false );
				}
			},

			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			_fixLegacy: function(){
				
			},

			getHTML: function(){
				
			},

			isConfigured: function(){
				return this.data.embed();
			},

			isWellConfigured: function(){
				var html = this.getHTML();
				var tagName = html && $(html)[0] && String($(html)[0].tagName).toLowerCase();
				var tagNameIsA = tagName == 'a';
				return tagNameIsA && this.getDisplayType();
			},

			isBadConfigured: function(){
				return this.isConfigured() && !this.isWellConfigured();
			},

			getDisplayType: function(){
				var $a = $(this.getHTML());
				var result = false;
				return ko.utils.arrayFirst( this.constructor.validDisplays, function( display ){
					return $a.hasClass('twitter-' + display);
				});
			},
			
			_createComputed: function(){

			},

			editar: true,
                        
                        getTreeNodeDescription: function(){
                            return ko.unwrap( this.data.contenido ) || this._parent();
			},

			getTreeNodeDescriptionHtml: function(){
				return $('<strong>').html( $.string.encodeHTML( this.getTreeNodeDescription() ) ).outerHTML();
			},
		}
	});
  
	/*
	namespace.Snippet.Flickr = namespace.Snippet.extend({
		nombre	: ko.observable('lbum de Flickr'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'flickr',
					data: {
						id			: 0,
						username	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-flickr-album'
				});
			},

			editar: function(){
				var self = this;
				$.prompt('Nombre de usuario').done(function(value){
					self.data.username(value);
					model.obtenerIdFlickr(value).done(function(response){
						self.data.id(response.result.user.id);
					});
				});
			}	
		}
	});
	*/
	
	////////////////////////////////////////////////////////////////////////////
	
	namespace.Snippet.FBLike = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.fblike.facebook_me_gusta'),
		descripcion	: ko.observable('snippets:snippet.fblike.herramienta_de_facebook_para_que_tus_visitantes_compartan_y_den_me_gusta_a_tu_pagina'),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'fBLike',
					data: {
						id		: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono		: 'icon-snippet-facebook-like'
				});
			},

			_getComplexityValue: function(){
				return this._parent.apply( this, arguments ) + 10;
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.FBComments = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.fbcomments.facebook_comentarios'),
		descripcion	: ko.observable('snippets:snippet.fbcomments.herramienta_de_facebook_para_agregar_comentarios_de_tus_visitantes_en_tu_pagina'),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'fBComments',
					data: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					nombre: 'Facebook - Comentarios',
					icono	: 'icon-snippet-facebook-comments'
				});
			},

			_getComplexityValue: function(){
				return this._parent.apply( this, arguments ) + 10;
			}

		}
	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('fBPage', {
		mappeable			: {
			data			: {
				embed		: ''
			}
		},
		defaults			: {
			icono				: 'icon-snippet-facebook-page',
			editar			: true
		}
	}), {
		nombre				: ko.observable( 'Facebook - Page' ),
		tamanoVentanaEdicion		: 'large'
	}).addMethods({
		init: function(){
			this._parent.apply(this, arguments);

			this._addDisposable(
				this.disableAccept = ko.computed(function () {
					return this.isBadConfigured();
				}, this)
			);
		},

		isWellConfigured: function(){
			var html = this.getHTML();
			return $(html).attr('class') == 'fb-page';
		},

		isBadConfigured: function(){
			return !this.isWellConfigured();
		},

		getHTML: function(){
			var $div = $($.parseHTML( this.data.embed() ));
			var attributes = $div.getAttributes();
			var $result = $('<div>');
			$.each( attributes, function( attr, value ){
				if( $.string.isValidHTMLAttName( attr ) ){
					$result.attr( attr, value );
				}
			});
			return $result.outerHTML();
		},

		_getComplexityValue: function(){
			return this._parent.apply( this, arguments ) + 10;
		}


	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.TwitterTimeline = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.twittertimeline.twitter_linea_de_tiempo'),
		descripcion	: ko.observable('snippets:snippet.twittertimeline.herramienta_de_twitter_para_agregar_una_linea_de_tiempo_en_tu_pagina'),

		validDisplays	: ['timeline', 'grid', 'tweet', 'follow-button', 'mention-button', 'hashtag-button'],

		prototype: {
			init: function(){
			
				this._parent.apply(this, arguments);

				this._fixLegacy();

				this.disableAccept = ko.computed( function(){
					return !this.isWellConfigured();
				}, this);


				this.parseEmbedError = ko.computed( function(){
					var result = '';
					if( this.isBadConfigured() ){
						result = 'por favor ingresa un cdigo widget vlido';
					}
					return result;
				}, this );

				/*
				this.tipoTimeline = ko.computed(function(){
					var tipo;				
					if(this.data.search())	tipo = 'search';
					if(this.data.user())	tipo = 'user';
					if(this.data.hashtag()) tipo = 'hashtag';
					return tipo;
				}, this);
				*/
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'twitterTimeline',
					data: {
						embed	: '',
						//id		: '',
						user	: '',
						search	: '',
						hashtag	: ''//,
						//list	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-twitter-timeline',
					editar	: true
				})
			},

			_getComplexityValue: function(){
				return this._parent.apply( this, arguments ) + 10;
			},

			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			_fixLegacy: function(){
				var embed = this.data.embed();
				if( !embed ){
					if( this.data.user() ){
						embed = '<a class="twitter-timeline" href="https://twitter.com/' + this.data.user() + '">Tweets by User</a>';
					}

					if( this.data.search() ){
						embed = '<a class="twitter-timeline" href="https://twitter.com/search?' + $.param({'q' : this.data.search()}) + '">Tweets by Search</a>';
					}

					if( this.data.hashtag() ){
						embed = '<a class="twitter-timeline" href="https://twitter.com/hashtag/"' + this.data.hashtag() + '">Tweets by Hashtag</a>';
					}

					if( embed ){
						embed += ' <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>';
						this.data.embed( embed );
						this.update({
							'data'	: {
								'user'		: '',
								'search'	: '',
								'hashtag'	: ''
							}
						})
					}
				}
			},

			getHTML: function(){
				var $a = $($.parseHTML( $.trim( this.data.embed() ) ));
				var node = $a[0];
				var result = '';
				if( node && String(node.tagName).toLowerCase() == 'a' ){

					var attributes = $a.getAttributes();
					var $result = $('<a>');
					$.each( attributes, function( attr, value ){
						if( $.string.isValidHTMLAttName( attr ) ){
							$result.attr( attr, value );
						}
					});
					result = $result.outerHTML();
				}
				return result;
			},

			isConfigured: function(){
				return this.data.embed();
			},

			isWellConfigured: function(){
				var html = this.getHTML();
				var tagName = html && $(html)[0] && String($(html)[0].tagName).toLowerCase();
				var tagNameIsA = tagName == 'a';
				return tagNameIsA && this.getDisplayType();
			},

			isBadConfigured: function(){
				return this.isConfigured() && !this.isWellConfigured();
			},

			getDisplayType: function(){
				var $a = $(this.getHTML());
				var result = false;
				return ko.utils.arrayFirst( this.constructor.validDisplays, function( display ){
					return $a.hasClass('twitter-' + display);
				});
			}
			/*,

			editar: function(){
				var self = this;
				$.prompt( i18n.kot('snippets:snippet.twittertimeline.ingresa_el_codigo_de_tu_widget') ).done(function(value){
					var id = ((/data-widget-id="(\d+)"/).exec(value) || []) [1];
					var user = ((/https:\/\/twitter\.com\/(\w+)"/ig).exec(value) || []) [1];
					var search = ((/https:\/\/twitter\.com\/search\?q=([^"]+)"/ig).exec(value) || []) [1];
					var hashtag = ((/https:\/\/twitter\.com\/hashtag\/(\w+)"/ig).exec(value) || []) [1];
					self.data.id(id || '');
					self.data.user(user || '');
					self.data.search(search || '');
					self.data.hashtag(hashtag || '');
				});
			}*/
		}
	});


	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Navbar = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.navbar.barra_de_navegacion'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'navbar',
					data	: {
						css		: '',
						positionClass: 'navbar-static-top',
						snippets : [
							{
								tipo: 'fixedContainer',
								data: {
									snippets: [
										{tipo: 'brand'},
										{
											tipo: 'nav',
											data: {
												pull:	'right',
												snippets: [
													{tipo: 'ajaxSpinner'},
													{tipo: 'dattachat'},
													{tipo: 'cartCount'},
													{tipo: 'userMenu'}
												]
											}
										},
										{tipo: 'btnNavbar'},
										{tipo: 'navCollapse',
											data: {
												snippets: [
													{tipo: 'navMain'}
												]
											}
										}
									]
								}
							}

						]
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					/*nombre	: 'Navbar'*/
				})
			},

			css: function(){
				var css = [this._parent()];
				css.push(this.data.positionClass());
				css.push(this.data.css());
				return css.join(' ');
			},

			editar: function(){

			}
		}
	});


	namespace.Snippet.Nav = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.nav.navegacion'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'nav',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					/*nombre	: 'Nav'*/
				});
			},

			editar: function(){}
		}
	});

	namespace.Snippet.NavCollapse = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.navcollapse.navegacion_colapsable'),
		prototype : {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'navCollapse',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});


	namespace.Snippet.BtnNavbar = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.btnnavbar.boton_responsivo_navbar'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'btnNavbar',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});



	namespace.Snippet.NavMain = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.navmain.menu_del_sitio'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'navMain',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});



	namespace.Snippet.Brand = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.brand.brand'),
		prototype	: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'brand'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});



	namespace.Snippet.TituloSitio = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.titulositio.nombre_del_sitio'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'tituloSitio'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});

	namespace.Snippet.SubtituloSitio = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.subtitulositio.eslogan'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'subtituloSitio'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});





	namespace.Snippet.CartCount = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.cartcount.carrito'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'cartCount',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});


	namespace.Snippet.UserMenu = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.usermenu.menu_de_usuario'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'userMenu',
					data	: {
						dropdown: 'right'  // '' | 'left' | 'right'
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			editar: function(){}
		}
	});


	namespace.Snippet.AjaxSpinner = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.ajaxspinner.spinner_ajax'),
		prototype: {
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'ajaxSpinner'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});


	namespace.Snippet.SiteMap = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.sitemap.mapa_del_sitio'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'siteMap'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});




	namespace.Snippet.SocialSharer = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.socialsharer.compartir_social'),
		prototype: {
			init: function( data ){
				this._fixLegacy( data );
				this._parent.apply(this, arguments);
			},

			_fixLegacy: function( data ){
				if( data ){
					if( data.data ){
						if( data.data.mostrarTitulo === undefined ){
							data.data.mostrarTitulo = true;
						}

						if( data.data.tipoConfiguracion  === undefined ){
							data.data.tipoConfiguracion = 'global';
						}
					}
				}
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'socialSharer',
					data	: {
						tipoConfiguracion 	: 'global',
						mostrarTitulo	: true
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono		: 'icon-snippet-socialsharer'
				});
			}
		}
	});


	namespace.Snippet.ContactInfoEmail = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfoemail.email_de_contacto'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoEmail'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});

	namespace.Snippet.ContactInfoAddress = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfoaddress.direccion'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoAddress'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});

	namespace.Snippet.ContactInfoPhone = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfophone.telefono'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoPhone'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});


	namespace.Snippet.ContactInfoTwitter = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfotwitter.perfil_en_twitter'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoTwitter',
					data	: {
						usuario	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getProfile: function(defaultValue){
				return 'http://twitter.com/' + ( this.data.usuario() || defaultValue );
			},

			editar: true
		}
	});


	namespace.Snippet.ContactInfoFacebook = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfofacebook.perfil_en_facebook'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoFacebook',
					data	: {
						usuario	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getProfile: function(defaultValue){
				return 'https://www.facebook.com/' + ( this.data.usuario() || defaultValue );
			}
		}
	});

	namespace.Snippet.ContactInfoGooglePlus = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfogoogleplus.perfil_en_google_plus'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoGooglePlus',
					data	: {
						usuario	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getProfile: function(defaultValue){
				return 'https://plus.google.com/' + ( this.data.usuario() || defaultValue );
			},

			getNombre: function(defaultValue){
				var usuario = /^\+[a-zA-Z\d]{3,}/i;
				return usuario.test( defaultValue ) ? defaultValue : 'Google+';
			}
		}
	});


	namespace.Snippet.ContactInfoInstagram = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfoinstagram.perfil_en_instagram'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoInstagram',
					data	: {
						usuario	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getProfile: function(defaultValue){
				return 'https://instagram.com/' + ( this.data.usuario() || defaultValue );
			},

			getNombre: function(defaultValue){
				return defaultValue ? defaultValue : 'Instagram';
			}
		}
	});

	namespace.Snippet.ContactInfoPinterest = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contactinfopinterest.perfil_en_pinterest'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoPinterest',
					data	: {
						usuario	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getProfile: function(defaultValue){
				return 'https://pinterest.com/' + ( this.data.usuario() || defaultValue );
			},

			getNombre: function(defaultValue){
				return defaultValue ? defaultValue : 'Pinterest';
			}
		}
	});

	namespace.Snippet.ContactInfoSkype = namespace.Snippet.extend({
		nombre	: ko.observable('skype'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'contactInfoSkype',
					data	: {
						usuario	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getProfile: function(defaultValue){
				return 'skype:' + ( this.data.usuario() || defaultValue ) + '?call';
			},

			getNombre: function(defaultValue){
				return defaultValue ? defaultValue : 'Skype';
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////
	
	namespace.Snippet.GoogleReviews = namespace.Snippet.extend({
		nombre		: ko.observable('Reseas de Google'),
		descripcion	: ko.observable('Permite mostrar las reseas de tu negocio, en tu sitio web.'),
		prototype: {
			init: function( data ){
				if ( data !== undefined && data.data.placeId ){
					if ( model.data.getGoogleReviews === undefined){
						// FRONT 
						model.data.snippets.getGoogleReviews( data.data.placeId, data.data.calificacionMinima );
					}else{
						// EDITOR
						model.data.getGoogleReviews( data.data.placeId, data.data.calificacionMinima );
					}
				}
				var args = $.extend([], arguments);
				this._parent.apply(this, args);
				this.data.contenido.overflow = ko.computed( function(){
					return this.data.contenido().length > 30000;
				}, this );     
			},
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo: 'googleReviews',
					data: {
						contenido: '<b>Reseas de Google</b>', 
						placeId : '',
						linkReviews : false,
						calificacionMinima : 3,
						estado : false,
					}
				});
			},
			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono	: 'icon-snippet-google-adsense'
				});
			},
			editar: function(){
				var self = this;
			},    
			beforeAccept: function( deferred ){
				var error = false;
				/* validations */
				var placeId = ko.unwrap( this.data.placeId );
				if( !placeId ){
					error = true;
				} 
				var calificacionMinima = ko.unwrap( this.data.calificacionMinima );
				if( !calificacionMinima ){
					error = true;
				}else{
					if (calificacionMinima < 1 || calificacionMinima > 5){
						error = true;
					}
				}
				if (error){
					deferred.reject();
					$.confirm($("#google-reviews-error-message"))
						.then( function(response){
						})
						.done(function(){
						})	
					return;
				}
				/* end of validations */

				if (this.data.placeId !== ''){
					model.data.chequearMarketIdPlace( this.data.placeId(), this.data.calificacionMinima() )
						.then(function(response){
							if ( response.result.name !== undefined && response.result.name !== null ){
								this.data.estado = true;
								model.data.googleReviewsState( true );
								model.data.googleReviews(response.result);
									deferred.resolve(true);
									return deferred;
							}else{
								$.confirm($("#google-reviews-error-message"))
									.then( function(response){
									})
									.done(function(){
									})	
								this.data.estado = false;
								model.data.googleReviewsState( false );
								model.data.googleReviews([]);
								deferred.reject();
							}
						}).catch(function(e){
							this.data.estado = false;
							model.data.googleReviewsState( false );
							model.data.googleReviews([]);
							deferred.reject();
						});
				}
			},
		}
	});

	/////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.ContadorDeVisitas = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.contadordevisitas.contador_de_visitas'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
				this._createComputed();
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo    : 'contadorDeVisitas',
					data    : {
						visitas             : 0,
						tema                : 'default', //train-station, car
						valorInicial		: 0,
						habilitado          : true
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({

				});
			},

			_createComputed: function(){
				this.data.visitasTotales = ko.computed( function(){
					return parseInt( this.data.visitas() ) + parseInt( this.data.valorInicial() );
				}, this);
			}
		}
	});

	/////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.Site = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.site.sitio'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo		: 'site',
					data		: {
						tieneMargen: false,
						snippets: [
							{tipo: 'contenedor'},
							{tipo: 'contenedor'}
						]
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getWrappedContent: function(){
				return this.data.snippets()[0];
			},

			getFooterContent: function(){
				return this.data.snippets()[1];
			},

			insertar: function(snippet){
				this.getWrappedContent().insertar(snippet);
			}
		}
	});


	namespace.Snippet.SiteHeader = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.siteheader.cabecera_de_sitio'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'siteHeader',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});

	namespace.Snippet.SiteBody = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.sitebody.cuerpo_de_sitio'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'siteBody',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});


	namespace.Snippet.SitePageContent = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.sitepagecontent.contenido_de_pagina'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'sitePageContent',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});

	namespace.Snippet.SiteFooter = namespace.Snippet.Contenedor.extend({
		nombre	: ko.observable('snippets:snippet.sitefooter.pie_de_sitio'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'siteFooter',
					data	: {

					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});


	namespace.Snippet.FixedContainer = namespace.Snippet.Contenedor.extend({ // este es el que tiene la clase .container y sirve para contenidos centrados
		nombre	: ko.observable('snippets:snippet.fixedcontainer.contenedor_centrado'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'fixedContainer',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});


	namespace.Snippet.FluidContainer = namespace.Snippet.Contenedor.extend({ // este es el que tiene la clase .container y sirve para contenidos fluidos
		nombre	: ko.observable('snippets:snippet.fluidcontainer.contenedor_fluido'),
		prototype: {

			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'fluidContainer',
					data	: {
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			}
		}
	});



	////////////////////////////////////////////////////////////////////////////
	// DATTACHAT

	ko.bindingHandlers['dattachatstatus'] = {
		init: function( element, valueAccessor, allBindingsAccessor, viewModel, bindingContext ){
			bindingContext.dattachatonline = ko.observable();

			var timeout = setInterval( function(){
				if( window.dcJs ){
					bindingContext.dattachatonline( window.dcJs.statusOperators );
				}
			}, 1000);

			ko.utils.domNodeDisposal.addDisposeCallback( element, function() {
				clearInterval( timeout );
			});
		}
	};

	ko.virtualElements.allowedBindings.dattachatstatus = true;

	
	
	
	namespace.Snippet.Dattachat = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.dattachat.dattachat'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo	: 'dattachat',
					data	: {
						id					: '',
						usarEstiloOriginal	: false
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			insertScript: function( id, dominioDattachat ){
				var $script
					, scriptId = 'script' + id
					, dominioDattachatDefault = 'dattachat.com'
					, protocol = document.location.protocol; // (http:)

				if( id ){
					$script = $('#' + scriptId);
					if(!$script[0]){
						if( !dominioDattachat || protocol === 'https:'){
							dominioDattachat = dominioDattachatDefault;
						}

						$script = $('<script>');
						$script.attr( 'type', 'text/javascript' );
						$script.attr( 'async', 'async' );
						$script.attr( 'defer', 'defer' );

						if(location.search === '?debug_dattachat=1'){
							$script.attr( 'src', '//dc.w3desarrollos.com.ar/chat/cargar/wid/' + id );
						} else {
							$script.attr( 'src', protocol + '//' + dominioDattachat + '/chat/cargar/wid/' + id );
						}

						$script.attr( 'id', scriptId );
						$('head')[0].appendChild( $script[0] );
					}
				}

				return !!id;
			},

			getId: function(){
				return this.data.id() || ( model.data.market.dtTieneChat && model.data.market.dtTieneChat() ) || '';
			}
		}
	});


	////////////////////////////////////////////////////////////////////////////
	// AFIP

	namespace.Snippet.AfipForm960NM = namespace.Snippet.extend({
		nombre	: ko.observable('snippets:snippet.afipform960nm.formulario_afip_960'),
		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo			: 'afipForm960NM',
					data			: {
						valor		: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
				});
			},

			getHref: function(){
				return this.data.valor() || ( model.data.market.afipForm960NM && model.data.market.afipForm960NM() ) || '';
			}
		}
	});





	////////////////////////////////////////////////////////////////////////////
	namespace.Snippet.CarouselSlide = namespace.Snippet.Contenedor.extend({
		nombre		: ko.observable('snippets:snippet.carouselslide.slide'),
		descripcion	: ko.observable('snippets:snippet.carouselslide.cada_slide_de_un_carousel'),

		prototype: {
			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo		: 'carouselSlide'
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono		: 'icon-snippet-carouselslide'
				});
			},

			getTreeNodeDescription: function(){
				return '<' + ko.unwrap( this.nombre ) + ' ' + ( this.indexInParentSnippet() + 1 ) + '>'
			},

			tieneIcono: function(){ return false }
		}

	});

	namespace.Snippet.Carousel = namespace.Snippet.Contenedor.extend({
		nombre		: ko.observable('snippets:snippet.carousel.slider'),
		descripcion	: ko.observable('snippets:snippet.carousel.crea_banners_y_sliders_de_imagenes_videos_y_otros_elementos'),

		pauseOptions: [
			{ text: 'Al pasar el mouse sobre el slider', value: 'hover' },
			{ text: 'Nunca', value: 'never' },
			{ text: 'Siempre', value: 'always' }
		],

		transitionOptions: [
			{ text: 'deslizar'		, value: 'slide'},
			{ text: 'fundido'	, value: 'fade'},
			{ text: 'esfumado'	, value: 'fadeout'},
			{ text: 'deslizar izquierda'		, value: 'slideleft'},
			{ text: 'deslizar derecha'		, value: 'slideright'},
			{ text: 'deslizar arriba'		, value: 'slideup'},
			{ text: 'deslizar abajo'		, value: 'slidedown'},
			{ text: 'deslizar en perspectiva'		, value: 'slide-perspective'},
			{ text: 'voltear horizontal 3D'		, value: 'rotate-3d-horizontal'},
			{ text: 'rotar en el sentido del reloj'		, value: 'rotate-clockwise'},
			{ text: 'latido'		, value: 'heartbeat'},
			{ text: 'zoom-in'		, value: 'zoom-in'},
			{ text: 'cubo horizontal'		, value: 'cube-horizontal'},
			{ text: 'cubo vertical'			, value: 'cube-vertical'},
			{ text: 'cubo diagonal'			, value: 'cube-diagonal'},
			{ text: 'cubo horizontal interior'		, value: 'cube-horizontal-inner'},
			{ text: 'cubo vertical interior'			, value: 'cube-vertical-inner'},
			{ text: 'cubo diagonal interior'			, value: 'cube-diagonal-inner'},
			{ text: 'aleatorio'			, value: 'random'}
		],

		heightOptions:[
			{ text: 'fijo', value: 'fixed' },
			{ text: 'animado', value: 'animateDuringSlide' }
		],

		prototype: {
			init: function( data ){
				if( data && data.data && !$.isBoolean( data.data.showControls ) ){
					data.data.showControls = true;
				}
				if( data && data.data && !$.isBoolean( data.data.showIndicators ) ){
					data.data.showIndicators = true;
				}

				if( data && data.data && !$.getObjectProperty(data, 'data.height') ){
					data.data.height = 'animateDuringSlide'
				}

				this._parent.apply(this, arguments);
				this._createComputed();

				this.beforeEdit();
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo		: 'carousel',
					data: {
						interval				: 5, //segundos
						pause					: 'hover',
						showControls			: true,
						showIndicators			: true,
						autoHideControls		: true,
						autoHideIndicators		: true,
						snippets				: [],
						transition				: 'slide',
						height					: 'fixed',
						eventBindings			: [],
						indicatorsPosition		: 'right top'
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono				: 'icon-snippet-carousel',
					slides				: 0,
					slideActualIndex	: 0,
					hasEditButtons		: true,
					randomTransitionIndex: 0
				});
			},

			_setMapping: function(){
				var self = this;
				this._parent();
				this._mergeMapping({
					snippets: {
						create: function(options) {
							return new namespace.Snippet.CarouselSlide(options.data, self);
						}
					}
				});
			},

			_createComputed: function(){
				this.slideActual = ko.computed( function(){
					return this.data.snippets()[ this.slideActualIndex() ];
				}, this);


				this.currentSlideIsEmpty = ko.computed( function(){
					var index = this.slideActualIndex();
					return this.slideIsEmpty( index );
				}, this);
			},

			getEventActionList: function(){
				return [
					{'name'	: 'prev'},
					{'name'	: 'next'}
				];
			},

			onEventActionNext: function(){
				this.slideNext( true );
			},

			onEventActionPrev: function(){
				this.slidePrev( true );
			},

			////////////////////////////////

			establecerSlides: function( value ){
				var self = this,
					slides = self.data.snippets(),
					cantSlidesActual = slides.length,
					cantSlidesNuevos = value,
					i = 0;
				if( value < 1 || value > 50 ) return;

				if ( cantSlidesNuevos < cantSlidesActual ){
					slides.length = cantSlidesNuevos;
				}

				for ( i  = cantSlidesActual ; i < cantSlidesNuevos ; i++ ){
					slides.push( new namespace.Snippet.CarouselSlide(null, self) );
				}

				if( this.slideActualIndex() > slides.length - 1 ){
					this.slideActualIndex( slides.length - 1 );
				}

				self.data.snippets.valueHasMutated();
			},

			beforeEdit: function(){
				this.slides ( this.data.snippets().length );
			},

			afterEdit: function(){
				this.establecerSlides ( this.slides() );
			},

			editar: function(){
			},

			////////////////////////////////////////////////////////////////////////
			hasOneSlide: function(){
				return this.slides() == 1;
			},

			slideEof	: function(){
				return this.slideActualIndex() == this.slides() - 1;
			},

			slideBof	: function(){
				return this.slideActualIndex() == 0;
			},

			slideFirst: function(){
				this.slideActualIndex( 0 );
			},

			slideLast: function(){
				this.slideActualIndex( this.slides() - 1 );
			},

			slideNext: function( loop ){
				if( this.slideEof() ){
					if( loop ) this.slideFirst();
				} else {
					this.slideActualIndex( this.slideActualIndex() + 1 );
				}
			},

			slidePrev: function( loop ){
				if( this.slideBof() ){
					if( loop ) this.slideLast();
				} else {
					this.slideActualIndex( this.slideActualIndex() - 1 );
				}
			},

			slideContentCount: function( slideOrIndex ){
				var index = $.isNumeric ( slideOrIndex ) ? slideOrIndex : null,
					slide = slideOrIndex instanceof namespace.Snippet.CarouselSlide ? slideOrIndex : this.data.snippets() [ index ];

				return slide && slide.data.snippets().length;
			},

			slideIsEmpty: function( slideOrIndex ){
				return this.slideContentCount( slideOrIndex ) === 0;
			},

			getTransitionsCount: function(){
				return this.constructor.transitionOptions.length - 1;
			},

			nextRandomTransition: function(){
				var index = this.randomTransitionIndex();
				index++;
				if( index >= this.getTransitionsCount() ) index = 0;
				this.randomTransitionIndex( index );
			},

			getTransitionValue: function(){
				var result = this.data.transition();
				if($.browser.msie && parseFloat( $.browser.version ) < 11 ){
					if( result != 'slide' ) result = 'fade';
				} else {
					if( result == 'random' ){
						result = this.constructor.transitionOptions[ this.randomTransitionIndex()].value;
					}
				}
				return result;
			},

			css: function(){
				var result = [];
				if( this.data.autoHideControls() ) result.push('auto-hide-controls');
				if( this.data.autoHideIndicators() ) result.push('auto-hide-indicators');

				switch( this.data.transition() ){
					/*case 'slide':
					 break;
					 */
					default:
						result.push( 'carousel-reset' );
						result.push('carousel-' + this.getTransitionValue() );
						break;
				}
				result.push('indicators-position-' + this.data.indicatorsPosition().replace(' ', '-') );

				return result.join(" ");
			},

			_obtenerTransitionIndex: function(){
				var transition = this.data.transition()
					, index = $.indexInCollection( this.constructor.transitionOptions, function( transitionOption ){ return transitionOption.value == transition } );

				return index;
			},

			_ajustarTransitionIndex: function( index ){
				return index % this.constructor.transitionOptions.length;
			},

			_establecerTransicionPorIndice: function( index ){
				this.data.transition( this.constructor.transitionOptions[ index].value );
			},

			transitionNext: function(){
				var index = this._ajustarTransitionIndex( this._obtenerTransitionIndex() + 1);
				this._establecerTransicionPorIndice( index );
			},

			transitionPrev: function(){
				var index = this._ajustarTransitionIndex( this._obtenerTransitionIndex() - 1);
				this._establecerTransicionPorIndice( index );
			},

			////////////////////

			areControlsVisible: function(){
				return !this.hasOneSlide() && ( this.data.pause() == 'always' || this.data.showControls() );
			},


			areIndicatorsVisible: function(){
				return !this.hasOneSlide() && this.data.showIndicators();
			},

			//////////////////////////////////////////////////////////

			canBeChildOfPath: function( path ){
				var canBe = !ko.utils.arrayFirst( path, function( snippet ){
					return snippet instanceof namespace.Snippet.Carousel;
				});

				return canBe && this._parent.apply( this, arguments );
			}

		}

	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Snippet.FormEnvialoSimple = namespace.Snippet.Formulario.extend({
		nombre		: ko.computed( function(){
			var key = namespace.Snippet.marcaBlanca() ? 'snippets:snippet.formenvialosimple.form.emailmarketing' : 'snippets:snippet.formenvialosimple.formulario_envialo_simple';
			return key;
		}),

		descripcion	: ko.observable('snippets:snippet.formenvialosimple.inserta_un_formulario_de_suscripcion_a_una_lista_de_emailmarketing'),

		tituloVentanaEdicion	: ko.observable( i18n.kot("snippets:snippet.formenvialosimple.edicion_de_formulario_de_suscripcion_email_marketing") ),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
				this._createComputed();

				this.beforeEdit();
				this._obtenerHtmlWidget();

			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo		: 'formEnvialoSimple',
					data: {
						url			: '',
						usarCSS		: false
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono				: 'icon-snippet-form-envialosimple',
					hasEditButtons		: false,
					htmlWidgetOriginal	: ''
				});
			},

			_setMapping: function(){
				this._parent();
				this._mergeMapping({
				});
			},

			_createComputed: function(){
				var self = this
					, administratorIdRE = /AdministratorID\/(\d+)\//i
					, formIdRE = /FormID\/(\d+)/i;


				this.administratorID = ko.computed( function(){
					var match = this.data.url().match(administratorIdRE);
					return match && match[1];
				}, this);

				this.formID = ko.computed( function(){
					var match = this.data.url().match(formIdRE);
					return match && match[1];
				}, this);

				this.urlValida = ko.computed( function(){
					return this.formID() && this.administratorID();
				}, this);

				this.widgetVersion = ko.computed( function(){
					var result = null;
					if( this.urlValida() ){
						var re = /https?:\/\/v([^.]*)/;
						var match = this.data.url().match( re );
						result = match && match[1];
					}
					return result;
				}, this );

				this.requestFormWidgetURL = ko.computed( function(){
					//var dominioMarcaBlanca = 'email-marketing.ferozo.com';
					var dominioMarcaBlanca = 'v2.esmsv.com';
					return 'https://' + dominioMarcaBlanca + '/form/show/AdministratorID/' + this.administratorID() + '/FormID/' + this.formID() + '/format/jsonpwidget';
				}, this);

				this.allowRestyling = ko.computed( function(){
					return this.widgetVersion() != 3;
				}, this );

				this.htmlWidget = ko.computed( function(){
					var htmlWidget = this.htmlWidgetOriginal() || ''
						, uid = ko.utils.createUID();

					htmlWidget = htmlWidget.replace(/formID/g, 'formID_' + uid );
					htmlWidget = htmlWidget.replace(/(subscription-form-\d+-\d+)/g, '$1_' + uid );


					if( !this.data.usarCSS() && this.allowRestyling() ){
						var newStyle = '';
						/*
						 if( this.widgetVersion() == '3' ){
						 var idNumber = htmlWidget.match(/id="subscription-(.*)"/);
						 idNumber = idNumber && idNumber[1];
						 var elementId = 'subscription-' + idNumber;

						 newStyle = '\
						 #' + elementId + ' .subscription-form-feedback {\
						 display: none;\
						 }\
						 #' + elementId + ' .subscription-form-feedback.subscription-form-feedback-active {\
						 display: block;\
						 }';
						 newStyle = '<style>\n' + newStyle + '\n</style>';
						 }*/

						htmlWidget = htmlWidget.replace(/<style[^>]*>(.|\n)+<\/style>/ig, newStyle ); // le quita los estilos


						htmlWidget = htmlWidget.replace(/<div class="[^"]*emailMarketingSubscriptionFormContainer[^"]*">(.*)<\/div>/g, '<div>$1</div>'); // le quita las clases

						htmlWidget= htmlWidget.replace(/<input type="submit"([^\/>]+)\/>/ig, function( found ){
							var classAttr = 'class="btn btn-primary"';

							var newInput = found.replace(/class="([^"]*)"/ig, function(){return classAttr }); // reemplaza el submit por un primary

							if ( !( (/class="/).test( newInput ) ) ) {
								newInput = newInput.replace( />/g, classAttr+'>' );
							}

							newInput = newInput.replace( /style="[^"]+"/ig, '' );
							return [ '<div class="form-actions">', newInput , '</div>' ].join('');
						});


						var re = /<div class="subscription-form-control"[^>]*>/g;

						htmlWidget= htmlWidget.replace( re, function( found ){
							found = found.replace( /style="[^"]+"/ig, '' );
							return found;
						});

						htmlWidget = $.string.replace( htmlWidget, '.submit-button', '.btn.btn-primary'); // reemplazar en el javascript para que pueda encontrar el botn de submit


						htmlWidget = htmlWidget.replace(/subscription-form-control/ig, 'control-group');

						htmlWidget = htmlWidget.replace(/subscription-form-placeholder/ig, 'control-label');

						htmlWidget = htmlWidget.replace(/_initPlaceholders\(\);/, '');

						htmlWidget = htmlWidget.replace(/alert\(/ig, '$.alert('); //reemplaza el alert por el $.alert

						htmlWidget = htmlWidget.replace(/<br\s*\/>/ig, ''); //limpia todos los br

						htmlWidget = htmlWidget.replace(/<label\b\s*class="emailMarketingFormTitle"[^>]*>(.*?)<\/label>/ig, '<legend>$1</legend>'); // reemplaza label por legend
						htmlWidget = htmlWidget.replace(/<p\b\s*class="emailMarketingFormDescription"[^>]*>(.*?)<\/p>/ig, '<h4>$1</h4>'); //reemplaza el parrafo por un ttulo

					}


					return htmlWidget;
				}, this);

				var _currentRequest;
				ko.computed( function(){
					return[ this.formID(), this.requestFormWidgetURL() ].join('|');
				}, this).extend({throttle:100}).subscribe( function(){
					this._obtenerHtmlWidget();
				}, this);

			},

			_obtenerHtmlWidget: function(){
				var self = this;
				if( self._currentHtmlWidgetAjax ) self._currentHtmlWidgetAjax.abort();
				if( self.urlValida() ){
					self._currentHtmlWidgetAjax = model.getUrl( self.requestFormWidgetURL() )
					.done( function( response ){
						self.htmlWidgetOriginal( response.result );
					})
					.error( function( response ){
						window.console && window.console.error && window.console.error( response.error );
					})
					.always( function(){
						self._currentHtmlWidgetAjax = null;
					});
				}
			},

			beforeEdit: function(){
			},

			afterEdit: function(){
			},

			editar: function(){
			}
		}
	});


	////////////////////////////////////////////////////////////////////////////
	namespace.Snippet.GoogleAdSense = namespace.Snippet.extend({
		nombre		: ko.observable('snippets:snippet.googleadsense.google_adsense'),
		descripcion	: ko.observable('snippets:snippet.googleadsense.inserta_anuncios_de_google_adsense'),

		prototype: {
			init: function(){
				this._parent.apply(this, arguments);
				this._createComputed();
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					tipo		: 'googleAdSense',
					data: {
						width	: '',
						height	: '',
						client	: '',
						slot	: '',
						codigoScript	: ''
					}
				});
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					icono				: 'icon-snippet-google-adsense',
					hasEditButtons		: false
				});
			},

			_setMapping: function(){
				this._parent();
				this._mergeMapping({
				});
			},

			_createComputed: function(){
				this.configuradoCorrectamente = ko.computed( function(){
					return !! (this.data.slot() && this.data.client() );
				}, this);

				this.data.codigoScript.subscribe( function(){
					this._parseScript();
				}, this);
			},

			_parseScript: function(){
				var re = /<script async/,
					match = this.data.codigoScript().match( re );

				if( match ){
					this._parseAsynchronousScript();
				} else {
					this._parseSynchronousScript();
				}
			},

			_parseSynchronousScript: function(){
				var codigoScript = this.data.codigoScript()
					, reSlot = /google_ad_slot\s+=\s+"([^"]+)";/
					, reClient = /google_ad_client\s+=\s+"([^"]+)";/
					, reWidth	 = /google_ad_width\s+=\s+([^;]+);/
					, reHeight	 = /google_ad_height\s+=\s+([^;]+);/
					, match;

				match = codigoScript.match( reSlot );
				this.data.slot( ( match && match[1] ) || '' );

				match = codigoScript.match( reClient );
				this.data.client( ( match && match[1] ) || '' );

				match = codigoScript.match( reWidth );
				this.data.width( ( match && match[1] ) || '' );

				match = codigoScript.match( reHeight );
				this.data.height( ( match && match[1] ) || '' );
			},

			_parseAsynchronousScript: function(){
				var codigoScript = this.data.codigoScript()
					, reSlot = /data-ad-slot\s*=\s*"([^"]+)"/
					, reClient = /data-ad-client\s*=\s*"([^"]+)"/
					, reWidth	 = /style=".+width:([^;]+).+"/
					, reHeight	 = /style=".+height:([^;"]+)/
					, match;

				match = codigoScript.match( reSlot );
				this.data.slot( ( match && match[1] ) || '' );

				match = codigoScript.match( reClient );
				this.data.client( ( match && match[1] ) || '' );

				match = codigoScript.match( reWidth );
				this.data.width( ( match && match[1] ) || '' );

				match = codigoScript.match( reHeight );
				this.data.height( ( match && match[1] ) || '' );

			},

			editar: function(){
			},

			//////////////////////////////////////////////////////

			tieneDimensiones: function(){
				return this.data.width() && this.data.height();
			}
		}
	});



	////////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////
	////// NIPPET DE DATOS
	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('dato', {
		mappeable			: {
			data			: {
				origenDato	: '',
				tagName		: 'span'
			}
		},
		defaults			: {
			editar			: true
		}
	}), {
		nombre				: ko.observable('snippets:snippet.dato.dato'),

		origenDatoOptions: [
			{ text	: '-- ninguno --',					value:		''									},
			{ text	: 'sitefooter-nota',				value:		'sitefooter-nota'					},
			{ text	: 'producto-nombre',				value:		'producto-nombre'					},
			{ text	: 'producto-id',					value:		'producto-id'						},
			{ text	: 'producto-codigo',				value:		'producto-codigo'					},
			{ text	: 'producto-descripcionCorta',		value:		'producto-descripcionCorta'			},
			{ text	: 'producto-descripcionLarga',		value:		'producto-descripcionLarga'			},
			{ text	: 'producto-precio-moneda-iso',		value:		'producto-precio-moneda-iso'		},
			{ text	: 'producto-precio-moneda-simbolo',	value:		'producto-precio-moneda-simbolo'	},
			{ text	: 'producto-precio-importe',		value:		'producto-precio-importe'			}
		]
	}).addMethods({
		getDato: function( $context ){
			var origenDato = ko.unwrap ( this.data.origenDato )
				, text;

			if ( $.string.startsWith( origenDato, 'producto-' )	){
				text = this._getDatoProducto( $context, origenDato );
			} else if ( $.string.startsWith( origenDato, 'sitefooter-' )	){
				text = this._getDatoSiteFooter( $context, origenDato );
			}
			return text || '';
		},

		_getDatoProducto: function( $context, origenDato ){
			var model = ko.unwrap( $context.productoSeleccionado ) || $context
				, text;

			switch( origenDato ){
				case 'producto-nombre':
				case 'producto-descripcionCorta':
				case 'producto-descripcionLarga':
					model = model && ko.unwrap ( model.traduccion );
					break;
			}

			if( model ){
				switch( origenDato ){
					case 'producto-nombre':
						text = ko.unwrap ( model.descripcion );
						break;

					case 'producto-codigo':
						text = ko.unwrap ( model.codigo );
						break;

					case 'producto-id':
						text = ko.unwrap ( model.id );
						break;

					case 'producto-descripcionCorta':
						text = ko.unwrap ( model.descripcionCorta );
						break;

					case 'producto-descripcionLarga':
						text = ko.unwrap ( model.descripcionLarga );
						break;
				}
			} else {
				text = '[' + origenDato + ']';
			}
			return text;
		},

		_getDatoSiteFooter: function( $context ){
			return ko.unwrap( $context.$root.market.notaAlPie );
		},

		datoEsHTML: function(){
			var origenDato = ko.unwrap ( this.data.origenDato )
				, result = false;

			if ( origenDato === 'producto-descripcionLarga' ) result = true;
			if ( origenDato === 'sitefooter-nota' ) result = true;

			return result;
		},

		css	: function(){
			var result = this._parent.apply( this, arguments );

			return [this.data.origenDato(), result].join(' ');
		}
	});


	////////////////////////////////////////////////////////////////////////////
	////// IFRAME
	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('iframe', {
		mappeable			: {
			data			: {
				aceptoCondiciones	: false,
				embed				: '',
				prop				: '0',

				esResponsive		: true,

				escala			: '' // '' | 'scale' | 'underscale' | 'prop'
			}
		},
		defaults			: {
			icono				: 'icon-snippet-iframe',

			editar			: true,
			detectandoHttps	: false,
			hasHttps		: false,

			idEjemplo		: 0
		}
	}), {
		nombre				: ko.observable( 'Iframe' ),
		tamanoVentanaEdicion		: 'large',

		sizeOptions			: [
			{
				'text'			: 'snippets:snippet.iframe.sizeoptions.tamano_original',
				'value'			: 0
			},
			{
				'text'			: '1:1',
				'value'			: 1
			},
			{
				'text'			: '2:1',
				'value'			: 2
			},
			{
				'text'			: '1:2',
				'value'			: .5
			},
			{
				'text'			: '16:9',
				'value'			: 16/9
			},
			{
				'text'			: '4:3',
				'value'			: 4/3
			},
			{
				'text'			: '3:2',
				'value'			: 3/2
			}
		],
		escalaOptions		: [
			{
				'text'			: 'snippets:snippet.iframe.escalaoptions.fluido',
				'value'			: ''
			},
			{
				'text'			: 'snippets:snippet.iframe.escalaoptions.fluido_agrandar_al_ancho_disponible',
				'value'			: 'prop'
			},
			{
				'text'			: 'snippets:snippet.iframe.escalaoptions.escalar',
				'value'			: 'underscale'
			},
			{
				'text'			: 'snippets:snippet.iframe.escalaoptions.escalar_agrandar_al_ancho_disponible',
				'value'			: 'scale'
			}
		],

		exampleOptions			: [
			{
				'id'			: 5,
				'name'			: 'Forecast.io / Weather',
				'embed'			: '<iframe id="forecast_embed" type="text/html" frameborder="0" height="245" width="100%" src="https://forecast.io/embed/#lat=42.3583&lon=-71.0603&name=Downtown Boston"> </iframe>',
				'source'		: 'http://blog.forecast.io/forecast-embeds/'
			},/*
			{
				'id'			: 6,
				'name'			: 'themoneyconverter.com',
				'embed'			: '<iframe id="tmcmini" src="http://themoneyconverter.com/ES/MoneyConverter.aspx?from=EUR&amp;to=USD" style="width: 175px; height: 202px; border: none; background-color: #ffffff;" scrolling="no" marginwidth="0" marginheight="0"></iframe>',
				'source'		: 'http://themoneyconverter.com/ES/WebTools.aspx'
			},*/
			{
				'id'			: 7,
				'name'			: 'bandcamp.com / Online Music',
				'embed'			: '<iframe style="border: 0; width: 350px; height: 350px;" src="https://bandcamp.com/EmbeddedPlayer/album=2594684326/size=large/bgcol=ffffff/linkcol=0687f5/minimal=true/transparent=true/" seamless><a href="http://fadedpaperfigures.bandcamp.com/album/the-matter">The Matter by Faded Paper Figures</a></iframe>',
				'source'		: 'https://bandcamp.com/'
			},/*
			{
				'id'			: 4,
				'name'			: 'Streaming Raddios / Online Radio',
				'embed'			: '<iframe style="padding: 0px;" src="http://streamingraddios.com/repro/raddiosdisco/index.php" width="358" height="240" frameborder="0" scrolling="No" align="center"></iframe>',
				'source'		: 'http://streamingraddios.com/'
			},*/
			{
				'id'			: 8,
				'name'			: 'mixcloud.com / Online Radio',
				'embed'			: '<iframe width="100%" height="60" src="https://www.mixcloud.com/widget/iframe/?embed_type=widget_standard&amp;embed_uuid=d75c7c8b-7916-4afd-a265-c2f6aba37ff2&amp;feed=https%3A%2F%2Fwww.mixcloud.com%2FCarlCox%2Fcarl-cox-global-629%2F&amp;hide_cover=1&amp;hide_tracklist=1&amp;mini=1&amp;replace=0" frameborder="0"></iframe><div style="clear: both; height: 3px; width: auto;"></div><p style="display: block; font-size: 11px; font-family: \'Open Sans\', Helvetica, Arial, sans-serif; margin: 0px; padding: 3px 4px; color: rgb(153, 153, 153); width: auto;"><a href="https://www.mixcloud.com/CarlCox/carl-cox-global-629/?utm_source=widget&amp;utm_medium=web&amp;utm_campaign=base_links&amp;utm_term=resource_link" target="_blank" style="color:#808080; font-weight:bold;">Carl Cox Global 629</a><span> by </span><a href="https://www.mixcloud.com/CarlCox/?utm_source=widget&amp;utm_medium=web&amp;utm_campaign=base_links&amp;utm_term=profile_link" target="_blank" style="color:#808080; font-weight:bold;">Carl Cox</a><span> on </span><a href="https://www.mixcloud.com/?utm_source=widget&amp;utm_medium=web&amp;utm_campaign=base_links&amp;utm_term=homepage_link" target="_blank" style="color:#808080; font-weight:bold;"> Mixcloud</a></p><div style="clear: both; height: 3px; width: auto;"></div>',
				'source'		: 'https://www.mixcloud.com/'
			},
			{
				'id'			: 10,
				'name'			: 'tunein.com / Online Radio',
				'embed'			: '<iframe src="https://tunein.com/embed/player/s105767/" style="width:100%;height:100px;" scrolling="no" frameborder="no"></iframe>',
				'source'		: 'http://tunein.com/'
			},
			{
				'id'			: 9,
				'name'			: 'bambuser.com / Video Broadcast',
				'embed'			: '<iframe src="https://embed.bambuser.com/broadcast/1866190" width="320" height="276" frameborder="0"></iframe>',
				'source'		: 'http://bambuser.com/api/embed_htmlplayer'
			},
			{
				'id'			: 12,
				'name'			: 'Spotify / Play Button',
				'embed'			: '<iframe src="https://embed.spotify.com/?uri=spotify%3Atrack%3A4th1RQAelzqgY7wL53UGQt" width="300" height="380" frameborder="0" allowtransparency="true"></iframe>',
				'source'		: 'https://developer.spotify.com/technologies/widgets/spotify-play-button/'
			},
			{
				'id'			: 13,
				'name'			: 'Deezer / Music',
				'embed'			: '<iframe scrolling="no" frameborder="0" allowTransparency="true" src="https://www.deezer.com/plugins/player?format=classic&autoplay=false&playlist=true&width=700&height=350&color=007FEB&layout=dark&size=medium&type=playlist&id=30595446&title=&app_id=1" width="700" height="240"></iframe>',
				'source'		: 'https://developers.deezer.com/musicplugins/player'
			},
			{
				'id'			: 1,
				'name'			: 'Yahoo! Screen / Video',
				'embed'			: '<iframe width="640" height="360" scrolling="no" frameborder="0" src="https://es.screen.yahoo.com/el-ataque-risa-un-beb-130300661.html?format=embed" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',
				'source'		: 'https://es.screen.yahoo.com'
			},
			{
				'id'			: 3,
				'name'			: 'Vine / Video',
				'embed'			: '<iframe src="https://vine.co/v/euxZKLeubaL/embed/simple" width="600" height="600" frameborder="0"></iframe><script src="https://platform.vine.co/static/scripts/embed.js"></script>',
				'source'		: 'https://vine.co'
			},
			{
				'id'			: 11,
				'name'			: 'GettyImages / Image Bank',
				'embed'			: '<iframe src="//embed.gettyimages.com/embed/468971393?et=Py2PKDA_SuZ_qFu7Bd-Kwg&sig=iImjyZs7B5EXPGtnTE8iPp3-cktLXBniXHo_-yMJzWI=" width="552" height="310" scrolling="no" frameborder="0" style="display:inline-block;position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>',
				'source'		: 'https://gettyimages.com'
			}


		]

	}).addMethods({
		init				: function(){
			this._parent.apply( this, arguments );

			// si no se puede usar el scale, entonces el contenido debe ser responsive
			this._addDisposable( ko.computed( function(){
				var canScaleToParent = this.canScaleToParent();
				if (!canScaleToParent ){
					this.data.esResponsive( true );
				}
			}, this ) );
		},

		isConfigured		: function( embed ){
			var embed = embed || this.data.embed()
				, re = /<iframe\s*((.*=".*")\s*)*>.*<\/iframe>/;
			return embed.match( re );
		},

		isHttps: function(){
			var attributes = this.getEmbedAttributes()
				, src = attributes.src
				, result = false;

			if( $.string.startsWith( src, 'https:') ){
				result = true;
			}

			return result;
		},

		getEmbedSrcProtocol: function(){
			var attributes = this.getEmbedAttributes()
				, src = attributes.src
				, result = '';

			if( $.string.startsWith( src, 'https:') ) result = 'https:';
			else if( $.string.startsWith( src, 'http:') ) result = 'http:';

			if( result === '' ) result = location.protocol;

			return result;
		},

		hasMixedContent: function(){
			return location.protocol == 'https:' && location.protocol != this.getEmbedSrcProtocol();
		},

		getEmbedIframe: function( embed ){
			var embed = embed || this.data.embed()
				, re = /<iframe.*>.*<\/iframe>/
				, match = embed && embed.match( re )
				, result = '';

			result = ( match && match[0] ) || '';

			result = $($.parseHTML( result )).outerHTML() || '';
			//result = result.replace(/(\w+\s*=\s*)'([^']+)'/g, '$1"$2"'); // cambiar atributos con comilla simple por atributos con comilla doble

			return result;
		},

		getEmbedAttributes	: function( embed ){
			var embed =this.getEmbedIframe( embed )
				, re = /\w+="[^"]+"/g
				, result = {};

			var attributes = embed.match( re ) || [];
			$.each( attributes, function( index, attribute ){
				var key = attribute.match(/\w+/)
					, value = attribute.match(/\w+="([^"]+)"/)[1];

				result[key] = $.string.decodeHTML( value );
			});

			return result;
		},

		getEmbedAttributesWithoutDimensions: function( embed ){
			var result = this.getEmbedAttributes( embed );
			delete result.width;
			delete result.height;
			delete result.id;
			return result;
		},

		getIframeSrc: function( embed ){
			var result = this.getEmbedAttributes( embed )
				, src = result.src;

			return src;
		},

		isEmbedSrcInsecure: function( embed ){
			var result = this.getEmbedAttributes( embed );
			return $.string.startsWith( result.src, 'http://' );
		},

		getIframeAttr: function( embed ){
			var result = this.getEmbedAttributes( embed );
			delete result.width;
			delete result.height;
			delete result.style;
			delete result.src;
			return result;
		},

		getStyle: function(){
			return {

			};
		},

		getEmbedStyle: function(){
			var style = this.getEmbedAttributes().style || ''
				, arrStyle = style.split(/\s*;\s*/)
				, result = {};

			$.each( arrStyle, function( index, styleRule ){
				styleRule = styleRule.split(':');
				if( styleRule[0] ){
					result[styleRule[0]] = $.trim(styleRule[1]);
				}
			});

			return result;
		},

		getEmbedDimmensions: function(){
			var attributes = this.getEmbedAttributes()
				, embedStyle
				, width = attributes.width
				, height = attributes.height;

			if( width === undefined || height === undefined	){
				embedStyle = this.getEmbedStyle();
				if( width === undefined ) width = embedStyle.width;
				if( height === undefined ) height = embedStyle.height;
			}

			if( width !== undefined ) width = $.string.trimLast( width, 'px' );
			if( height !== undefined ) height = $.string.trimLast( height, 'px' );

			return { width: width, height: height } ;
		},

		hasEmbedDimmensions: function(){
			var embedDimmensions = this.getEmbedDimmensions();
			return !!( embedDimmensions.width && embedDimmensions.height );
		},

		_propertyUnit: function( prop ){
			if( prop ){
				if( parseFloat( prop ) == prop ) return '';
				if( $.string.endsWith( prop, 'px') ) return 'px';
				if( $.string.endsWith( prop, '%') ) return '%';
			} else return '';
		},

		hasEmbedWidthInPx: function(){
			var embedDimmensions = this.getEmbedDimmensions();
			return $.isNumeric( embedDimmensions.width ) && ( this._propertyUnit( embedDimmensions.width ) == '' || this._propertyUnit( embedDimmensions.width ) == 'px' );
		},

		hasEmbedHeightInPx: function(){
			var embedDimmensions = this.getEmbedDimmensions();
			return $.isNumeric( embedDimmensions.height ) && ( this._propertyUnit( embedDimmensions.height ) == '' || this._propertyUnit( embedDimmensions.height ) == 'px' );
		},

		hasEmbedBothDimmensionsInPx: function(){
			return this.hasEmbedWidthInPx() && this.hasEmbedHeightInPx();
		},

		hasEmbedWidthInPercent: function(){
			return this._propertyUnit( this.getEmbedDimmensions().width ) == '%';
		},

		hasEmbedWidth100Percent: function(){
			return this.getEmbedDimmensions().width == '100%';
		},

		getProportion: function(){
			var prop = this.data.prop() > 0 ? 1/this.data.prop() : .5;
			return prop;
		},

		usarTamaoOriginal: function(){
			return this.data.prop() == 0
		},

		getContainerStyle: function(){
			var style = {
				height: '',
				width: '',
				paddingTop	: ''
			};


			if( this.usarTamaoOriginal() && this.hasEmbedWidth100Percent() && this.hasEmbedHeightInPx()){
				style = $.extend(style, {
					height	: this.getEmbedDimmensions().height + 'px',
					width	: this.getEmbedDimmensions().width
				})
			} else {
				if( this.usarTamaoOriginal() && this.hasEmbedBothDimmensionsInPx() ){
					var dimmensions = this.getEmbedDimmensions()
						, width = parseFloat( dimmensions.width )
						, height = parseFloat( dimmensions.height )
						, prop = height / width;
				} else {
					prop = this.getProportion()
				}

				var padding = prop * 100;

				style = $.extend({
					height: 0,
					width: '100%',
					paddingTop	: padding + '%',
				});
			}

			return style;
		},

		getScaledContainerStyle: function(){
			var style = {}
				, width
				, height;

			if ( this.shouldScaleToParent() ){
				if( this.hasEmbedBothDimmensionsInPx() ){
					var dimmensions = this.getEmbedDimmensions();
					width = dimmensions.width;
					height = dimmensions.height;
				}

				style.width = width + 'px';
				style.height = height + 'px';
			}

			return style;
		},

		getWdgStyle: function(){
			var style = {
				width : '',
				maxWidth: ''
			};

			if( this.data.prop() == 0 && ( this.data.escala() == '' || this.data.escala() == 'underscale' ) && this.hasEmbedBothDimmensionsInPx() ){
				style.width = '100%';
				style.maxWidth = this.getEmbedDimmensions().width + 'px';
			}

			return style;
		},

		getPreviewSnippetContainerStyle: function(){
			var style = {
				width	: '',
				height	: '',
				background	: '#ddd'
			}
				, width = 800;

			if( this.hasEmbedWidthInPx() ){
				width = ( this.getEmbedDimmensions().width * 1.2);
			}

			style.width = width  + 'px';
			style.height = width  + 'px';

			return style;
		},

		canScaleToParent: function(){
			return this.hasEmbedBothDimmensionsInPx() && this.data.prop() == 0;
		},

		shouldScaleToParent: function(){
			return this.canScaleToParent() && this.data.escala() == 'scale' || this.data.escala() == 'underscale';
		},

		getResponsiveOptions: function(){
			var options = $.extend([], this.constructor.escalaOptions );


			if( !this.canScaleToParent() ){
				$.removeFromCollection( options, function( i ){
					return i.value !== '';
				});
			}

			if( !this.hasEmbedBothDimmensionsInPx() ){
				$.removeFromCollection( options, function( i ){
					return i.value === 'prop';
				});
			}



			if( this.data.esResponsive() ){
				$.removeFromCollection( options, function( i ){
					return $.inArray( i.value, ['prop', ''] ) == -1;
				});
			}

			if( !this.data.esResponsive() ){
				$.removeFromCollection( options, function( i ){
					return $.inArray( i.value, ['prop', ''] ) != -1;
				});
			}


			return options;
		},

		corregirResponsive: function(){
			this.data.prop( 0 );
			this.data.esResponsive( false );
			this.data.escala( 'scale' );
		},

		getSizeOptions: function(){
			var options = $.extend([], this.constructor.sizeOptions );

			if( !this.hasEmbedDimmensions() ){
				$.removeFromCollection( options, function( i ){
					return i.value == 0;
				})
			}
			return options;
		},

		makeEmbedCodeHttps: function(){
			var embed = this.data.embed();
			this._fixingEmbedCodeHttps = true;
			embed = $.string.replace( embed, 'http://', 'https://' );
			this.data.embed( embed );
			this._fixingEmbedCodeHttps = false;
		},

		detectHttps: function(){
			var url = this.getIframeSrc()
				, self = this;

			if( url ){
				url = url.replace(/\s/ig, '+');
			}

			if( ! this._fixingEmbedCodeHttps ){
				this.detectandoHttps( true );
				this.hasHttps( false );
				this._detectHttpsAjax && this._detectHttpsAjax.abort();
				if( true || this.isEmbedSrcInsecure() ){
					this._detectHttpsAjax = $.ajax({
						url			: 'paginas/detectarhttps',
						dataType	: "json",
						data		: {
							url		: url
						}
					}).done( function( response ){
						self.hasHttps( response.result.hasHttps );

						if( response.result.hasHttps && self.isEmbedSrcInsecure() ){
							self.makeEmbedCodeHttps();
						}
					}).always( function(){
						self.detectandoHttps( false );
					});
				} else {
					self.hasHttps( true );
					self.detectandoHttps( false );
				}
			}

		},

		obtenerEjemploPorId: function( id ){
			return ko.utils.arrayFirst( this.constructor.exampleOptions, function( option ){
				return option.id === id;
			});
		},

		obtenerEjemploSeleccionado: function(){
			return this.obtenerEjemploPorId( this.idEjemplo() );
		},

		insertarEjemploSeleccionado: function(){
			var ejemplo = this.obtenerEjemploSeleccionado();
			if( ejemplo ){
				this.data.embed( ejemplo.embed );
			}
		}
	});


	////////////////////////////////////////////////////////////////////////////



	////////////////////////////////////////////////////////////////////////////
	////// TRIPADVISOR
	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('tripAdvisor', {
		mappeable			: {
			data			: {
				embed		: ''
			}
		},
		defaults			: {
			icono				: 'icon-snippet-tripadvisor',
			editar			: true
		}
	}), {
		nombre				: ko.observable( 'TripAdvisor' ),
		tamanoVentanaEdicion		: 'large',
		useOriginalScript			: false,
		useProxy					: false,
		nofollow					: true,


		_custom_taAddValidator: function(){
			var self = namespace.Snippet.TripAdvisor;
			var result = self._old_taAddValidator && self._old_taAddValidator.apply( window, arguments );
			window.taValidate && window.taValidate();
			return result;
		},

		_fix_taAddValidator: function(){
			var self = namespace.Snippet.TripAdvisor;
			if( window.taAddValidator && window.taAddValidator !== self._custom_taAddValidator ){
				self._old_taAddValidator = window.taAddValidator;
				window.taAddValidator = self._custom_taAddValidator;
			}
		}


	}).addMethods({
		init				: function(){
			this._parent.apply( this, arguments );

			this._addDisposable(
				this.disableAccept = ko.computed( function(){
					return this.isBadConfigured();
				}, this )
			);
		},

		_isValidSrc: function( value ){
			var value = value.replace(/^https?\:/, '')
				, dominio = value.match(/^\/\/([^/]+)/)
				, dominio = dominio && dominio[1]
				, dominiosValidos = ['www.jscache.com', 'jscache.com', 'www.tripadvisor.com', 'tripadvisor.com'];

			return $.inArray( dominio, dominiosValidos ) != -1;
		},

		_getScripts: function( embed ){
			var embed = embed || this.data.embed();
			return embed.match(/<script.*>.*<\/script>/ig)
		},

		_getScriptsSrc: function( embed ){
			var self = this
				, embed = embed || this.data.embed();
			var scripts =  self._getScripts( embed )
				, re = re = /src="([^"]*)"/ig
				, result = [];
			if( scripts ){
				$.each( scripts, function( index, script ){
					var src = re.exec( script );
					if( src && src[1] && self._isValidSrc( src[1] ) ) {
						var theSrc = src[1];
						theSrc = theSrc.replace(/^https?\:/, '' );
						result.push( $.string.decodeHTML( theSrc ) );
					}
				});
			}
			return result;
		},

		_getScriptSrc: function( embed ){
			var embed = embed || this.data.embed()
				, scriptsSrc = this._getScriptsSrc( embed )
				, scriptSrc = scriptsSrc && scriptsSrc[0];

			return scriptSrc;
		},


		_getElementId: function( embed ){
			var embed = embed || this.data.embed(),
				matches = embed.match(/id="(\w+)"/);
			return matches && matches[1];
		},

		_getElementIdWithoutNumber: function( embed ){
			var self = this
				, elementId = self._getElementId( embed );

			if( elementId ){
				elementId = elementId.replace( /\d+/, '');
			}
			return elementId;
		},

		// para evitar el document.write, traducimos directamente del script original al que termina llamando
		_getFinalScriptSrc: function( value, type ){
			var value = value || this._getScriptSrc()
				, type = type || this._getWidgetType();

			if( this.constructor.useProxy ) {
				value = value.replace( /^\/\/www\.jscache\.com\/wejs/, 'proxy/tripadvisor/?url=/WidgetEmbed-' + type);
			} else {
				value = value.replace( /^\/\/www\.jscache\.com\/wejs/, '//www.tripadvisor.com/WidgetEmbed-' + type);
			}


			//value = value.replace( /&amp;/, '&');
			return value;
		},

		_getWidgetType: function( embed ){
			var embed = embed || this.data.embed()
				, value = this._getElementIdWithoutNumber();
			return value && value.replace(/^TA_/, '');
		},

		getElementId: function( uid ){
			var embed = this.data.embed()
				, elementId = this._getElementIdWithoutNumber( embed );

			return elementId && ( elementId + ( uid ? uid : '' ) );
		},

		isConfigured: function(){
			var embed = this.data.embed()
				, isConfigured = !!embed;
			if ( embed ){
				var scriptSrc = this._getScriptSrc()
					, elementId = this.getElementId( 'xxx' )
					, widgetType = this._getWidgetType();

				isConfigured = !!scriptSrc && !!elementId && !!widgetType;
			}
			return isConfigured;
		},

		isBadConfigured: function(){
			return this.data.embed() && !this.isConfigured()
		},

		_getIframeSrc: function(){
			return 'proxy/tripadvisoriframe/';
		},

		createIframeContent: function( uid, locale, element ){
			var self = this
				, embed = this.data.embed()
				, scriptSrc = self._getScriptSrc( embed )
				, widgetType = this._getWidgetType()
				, $iframe = $(element).find('iframe');

			$iframe.attr('src', this._getIframeSrc() )
				.css({
					border: 'none',
					width	: '100%',
					height	: '100%'
				});

			////////////////////////////////////////////////////////////////////
			scriptSrc = scriptSrc.replace(/uniq=(\d+)/, 'uniq=' + uid );
			if( locale ) scriptSrc = scriptSrc.replace(/lang=(\w+_\w+)/, 'lang=' + locale );

			if( !self.constructor.useOriginalScript ){
				scriptSrc = self._getFinalScriptSrc( scriptSrc, widgetType );
				document.write = function( what ){
					// console.debug( 'Algn script est tratando de hacer document.write de ', what );
				}
			} else {
				document.write = function( what ){
					$('body').append( what );
				}
			}
			////////////////////////////////////////////////////////////////////

			$iframe[0].onload = function(){
				//console.debug('onload');
				var iframeWindow	= $iframe[0].contentWindow
					, iframe$		= iframeWindow && iframeWindow.$;

				var $contents = $iframe.contents()
					, contentContainer = $('<div>')
					, tripadvisorWidget = $('<div></div>').attr('id', self.getElementId( uid ));

				contentContainer.append( tripadvisorWidget );
				$contents.find('body').html( contentContainer );

				var $script = $('<script>').attr('src', scriptSrc )
					, script = $script[0];

				$contents.find('head')[0].appendChild( script );

				script.onload = function(){
					$(tripadvisorWidget).css({position:'absolute'});

					iframe$( contentContainer ).resize( function(){
						setTimeout( function(){
							$(contentContainer)
								.width( 600 )
								.height( 600 );

							var width = $(tripadvisorWidget).width()
								, height = $(tripadvisorWidget).height();

							$(contentContainer)
								.width( width )
								.height( 'auto' );

							$iframe
								.width( width )
								.height( height );

							//console.debug('resize', width, height);
						},100);
					});


					iframeWindow.taValidate();
				};
			};

		},

		beforeAccept: function( deferred ){
			if( this.isBadConfigured() ){
				deferred.reject();
			} else {
				deferred.resolve();
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('qrCode', {
		mappeable			: {
			data			: {
				tipo		: 'url',
				url			: ''
			}
		},
		defaults			: {
			icono				: 'icon-snippet-qrcode',
			editar			: true
		}
	}), {
		nombre				: ko.observable( 'QR' ),
		tamanoVentanaEdicion		: 'large'
	}).addMethods({
		init	: function(){
			this._parent.apply( this, arguments );

			this._createValidations();
		},

		_createValidations: function(){
			this.data.url.extend({ completeUrl: true });
			this._parent.apply( this, arguments );
		},

		getImgSrc: function(){
			var queryString = $.param({
				data	: this.data.url() || location.href,
				size	: '100x100',
				margin	: 0,
				ecc		: 'L',
				qzone	: 0
			});
			//<img src="http://api.qrserver.com/v1/create-qr-code/?color=000000&amp;bgcolor=FF147A&amp;data=QR+Code&amp;qzone=0&amp;margin=0&amp;size=500x500&amp;ecc=L" alt="qr code" />

			// https://chart.googleapis.com/chart?cht=qr&chs=440x440chld=Lchl=Hello+world

			return 'https://api.qrserver.com/v1/create-qr-code/?' + queryString;
		},

		isConfigured: function(){
			return true;
		},

		isBadConfigured: function(){
			return !this.data.url.isValid();
		},

		beforeAccept: function( deferred ){
			if( this.isBadConfigured() ){
				deferred.reject();
			} else {
				deferred.resolve();
			}
		}
	});

////////////////////////////////////////////////////////////////////////////


	$.extend( namespace.Snippet.createSubClass('radio', {
		mappeable			: {
			data			: {
				tipo		: 'shoutcast',
				url			: '',

				mostrarAbrirEnVentana	: true,
				mostrarReproductor		: true
			}
		},
		defaults			: {
			icono				: 'icon-snippet-radio',
			editar			: true,

			openedInNewWindow	: false
		}
	}), {
		nombre				: ko.observable( 'Radio' ),
		tamanoVentanaEdicion		: 'large',
		tipoOptions			: [
			{ 'text' : 'Shoutcast', 'value': 'shoutcast' }
		]
	}).addMethods({
		init	: function(){
			this._parent.apply( this, arguments );
			ko.computed( function(){
				var url = this.data.url();
				this.enlace.asJS.tipo( tiendasimple.helpers.Enlace.TIPO_STREAM );
				this.enlace.asJS.url( url );
			}, this );
			this._createValidations();
		},

		_createValidations: function(){
			this.data.url.extend({ completeUrl: true });
			this._parent.apply( this, arguments );
		},

		isConfigured: function(){
			return ko.unwrap( this.data.url );
		},

		isWellConfigured: function(){
			return this.isConfigured() && !this.isBadConfigured();
		},

		isBadConfigured: function(){
			return !this.data.url.isValid();
		},
		
		isMixedContent: function(){
			if ( this.isConfigured() && !this.isBadConfigured() ) {
				return model.data.urlActual().substring(0,5) != this.data.url().substring(0,5);
			} else {
				return false
			}
		},
                
		beforeAccept: function( deferred ){
			if( this.isBadConfigured() ){
				deferred.reject();
			} else {
				deferred.resolve();
			}
		},

		/////////////////////////////////////

		getRadioUrl: function( $context ){
			/*
			 var url = ko.unwrap( this.data.url )
			 , titulo = ''
			 , shoutcastChannel = '/;stream/1';

			 return this.createRadioUrl( $context, url, titulo, shoutcastChannel )
			 */
			return this.enlace.getHref();
		},

		getIframeSrc: function( $context ){
			return this.getRadioUrl( $context );
		},

		isMixedContent: function(){
			if ( this.isConfigured() && !this.isBadConfigured() ) {
				return model.data.urlActual().substring(0,5) != this.data.url().substring(0,5);
			} else {
				return false
			}
		}

	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.createSubClass('ancla', {
		mappeable			: {
			data			: {
				nombre		: ''
			}
		},
		defaults			: {
			icono				: 'icon-snippet-ancla',
			editar			: true
		}
	}, namespace.Snippet ), {
		nombre				: ko.observable('Ancla'),
		getActiveTopPosition: function(){
			var offsetTop = $('[class*="affix-"]').height();
			return offsetTop || 0;
		}
	}).addMethods({
		init: function(){
			this._parent.apply( this, arguments );
			this._createComputed();
		},

		_createComputed: function(){
			this.disableAccept = ko.computed( function(){
				return !this.configuradoCorrectamente();
			}, this);

			//this._parent.apply(this, arguments);
		},

		configuradoCorrectamente: function(){
			return !!ko.unwrap( this.data.nombre );
		},

		beforeAccept: function( deferred ){
			var nombre = ko.unwrap( this.data.nombre );
			if( !nombre ){
				deferred.reject('El nombre no debe estar vaco');
			} else {
				deferred.resolve(true);
			}
			return deferred;
		}
	});

	////////////////////////////////////////////////////////////////////////////

	$.extend( namespace.Snippet.Contenedor.createSubClass('scene3d', {
		mappeable			: {
			data			: {
				height		: '100vh',


				perspective	: 300,
				autoScale	: 1,
				distanceBetweenLayers: 100,

				/*
				 scrollTilt	: 0,
				 scrollMove	: 0,
				 */
				cameraPan			: 0,
				cameraTilt			: 0,
				////////////////////////
				mouseZ		: 0,
				mouseMove	: 30,
				////////////////////////
				autoCameraAmplitude	:30,
				autoCameraSpeed		:20,
				////////////////////////
				accelAmplitude		: 100,
				////////////////////////
				fieldDepth			: 0,
				light				: 0,
				////////////////////////
				sceneWidth	: 800,
				sceneHeight	: 800,
				proportional	: true,
				size		:  'cover', // 'cover' || 'contain'
				////////////////////////

				zoom		: 1
			}
		},
		defaults			: {
			icono			: 'icon-snippet-scene3d',
			currentLayerUID		: null,
			positioningLayer	: false,
			currentLayerMode	: 'position', // edit | position

			highlightedLayerUID	: null,

			selectedPanel		: 'capas'
		},

		mapping: {

		}

	}, namespace.Snippet), {
		nombre				: ko.observable( 'Escena 3D' ),
		tamanoVentanaEdicion		: 'large',

		sizeOptions			: [
			{	text: 'Cubrir', value: 'cover' },
			{	text: 'Contener', value: 'contain' },
			{	text: 'Adaptar', value: 'adapt' }
		]
	}).addMethods({
		init	: function(){
			this._parent.apply( this, arguments );
			this._createComputed();
			this._createValidations();
			//this.layerFirst();

		},

		////////////////////////////////////////
		contentIsDraggable: function(){
			return false;
		},
		////////////////////////////////////////

		_createComputed: function(){

			this.switches = {
				movement: ko.computed( function(){
					return !this.fullscreen() || !this.selectedPanel() || this.selectedPanel() == 'movimiento' || this.selectedPanel() == 'canvas'	 ? 1 : 0;
				}, this ).extend({
					animate: {
						duration: 500
					}
				}),

				camera : ko.computed( function(){
					return this.isCurrentLayerSelected()	 ? 0 : 1;
				}, this ).extend({
					animate: {
						duration: 500
					}
				}),


				shaders: ko.computed( function(){
					return this.isCurrentLayerSelected()	 ? 0 : 1;
				}, this )
			};

			this.zoom = ko.computed({
				read: function(){
					//return this.secondaryToolbarVisible() && this.currentLayer() ? .5 : 1;
					return 1;

				},
				write: function( value ){
					this.data.zoom( value );
				}
			}, this);

			this.fullscreen.subscribe(function(fullscreen){
				if( !fullscreen ){
					this.layerEditNone();
				}
			}, this );
		},

		_createValidations: function(){
			this._parent.apply( this, arguments );
		},

		isConfigured: function(){
			return true;
		},

		isBadConfigured: function(){
			return false;
		},

		beforeAccept: function( deferred ){
			if( this.isBadConfigured() ){
				deferred.reject();
			} else {
				deferred.resolve();
			}
		},

		editar: function(){
			this.fullscreen( !this.fullscreen() );
		},

		hasEditWindow: function(){
			false;
		},

		isLeaf: function(){
			return !this.fullscreen();
		},

		//////////////////////////////////////////////
		layerGetByUID: function( uid ){
			return ko.utils.arrayFirst( this.data.snippets(), function( snippet ){
				return snippet.uid() == uid;
			});
		},

		layerGetIndexByUID: function( uid ){
			var layer = this.layerGetByUID( uid );
			return ko.utils.arrayIndexOf( this.data.snippets(), layer );
		},

		isCurrentLayerSelected: function(){
			return this.currentLayerUID();
		},

		currentLayer: function( layer ){
			if( arguments.length == 0 ){
				return this.layerGetByUID( this.currentLayerUID() );
			} else {
				this.currentLayerUID( layer && layer.uid() )
			}
		},

		currentLayerIndex: function( newIndex ){
			if( arguments.length == 0 ){
				return this.layerGetIndexByUID( this.currentLayerUID() );
			} else {
				var layer = this.data.snippets()[newIndex];
				if( layer ) {
					var uid = layer.uid();
					this.currentLayerUID( uid );
				} else {
					this.currentLayerUID( null );
				}
			}
		},

		layersGetInDepthOrder: function(){
			return $.extend([], this.data.snippets()).reverse();
		},

		layersBelowCurrent: function(){
			var index = this.currentLayerIndex();
			return this.data.snippets.slice( parseInt( this.currentLayerIndex() ) + 1 );
		},

		layersAboveCurrent: function(){
			var index = parseInt( this.currentLayerIndex() ) || 0;
			if( index == -1) return [];
			else {
				return this.data.snippets.slice( 0, index );
			}
		},

		layersWithoutCurrent: function(){
			return this.layersAboveCurrent().concat( this.layersBelowCurrent() );
		},

		layerIsBelowCurrent: function( layer ){
			var currentLayerIndex = this.currentLayerIndex();
			return this.layerGetIndexByUID( layer.uid() ) > currentLayerIndex;
		},

		layerIsCurrentOrBelow: function( layer ){
			var currentLayerIndex = this.currentLayerIndex();
			return this.currentLayerUID() == layer.uid() || this.layerGetIndexByUID( layer.uid() ) > currentLayerIndex;
		},

		layerIsCurrent: function( layer ){
			return this.currentLayerUID() == layer.uid();
		},

		layerCount: function(){
			return this.data.snippets().length;
		},

		layerNext: function(){
			if(!this.layerEof()) this.currentLayerIndex( parseInt( this.currentLayerIndex() ) + 1 );
		},

		layerPrev: function(){
			if(!this.layerBof()) this.currentLayerIndex( parseInt( this.currentLayerIndex() ) - 1 );
		},

		layerFirst: function(){
			this.currentLayerIndex( 0 );
		},

		layerBof: function(){
			return this.currentLayerIndex() <= 0;
		},

		layerEof: function(){
			return parseInt( this.currentLayerIndex() ) >= this.layerCount() - 1;
		},


		currentLayerIsEmpty: function(){
			currentLayer = this.currentLayer();
			return currentLayer && currentLayer.contentIsEmpty();
		},

		layerNew: function(){
			var newLayer = new namespace.Snippet.Scene3dLayer({
				data	: {
					snippets: [
						{ tipo: 'imagen' }
					]
				}
			});
			var nombre = 'Capa ' + (this.layerCount()+1);
			newLayer.data.nombre( nombre );
			this.data.snippets.unshift( newLayer );

			/*
			 this.currentLayerUID( newLayer.uid() );
			 */
			this.layerBeginEdit( newLayer );
		},

		getLayerDepth: function( layer){
			var index = ko.utils.arrayIndexOf( this.data.snippets(), layer );
			return index;
		},

		layerDeleteCurrent: function(){
			var layer = this.currentLayer();
			this.data.snippets.remove( layer );
			this.layerEditNone();
		},

		layerEditNone: function(){
			this.currentLayerMode('position');
			this.currentLayer( null );
		},

		layerBeginEdit: function( layer ){
			if( this.fullscreen() ){
				this.currentLayerMode('position');
				this.currentLayerUID( layer.uid() );
			}
		},

		layerBeginEditContents: function( layer ){
			if( this.fullscreen() ){
				this.layerBeingEdit( layer );
				this.currentLayerMode('edit');
			}
		},

		///////////////////////
		/*
		getLayerStyle: function( layer, offlineMode ){
			var result = {
				opacity : this.currentLayer() == layer && offlineMode ? .1 : 1
			};

			if( this.secondaryToolbarVisible() ){
				result.opacity = this.currentLayer() == layer ? 1 : this.currentLayer() ? .3 : 1
			}

			if( this.positioningLayer() ){
				result.opacity = this.currentLayer() == layer ? 1  : .1
			}

			return result;
		},
		*/

		getContainerStyle: function(){
			var result = {
				'overflow'	: 'hidden',
				'position'	: 'relative',
				'width'		: '100%',
				'height'	: '',
				'padding'	: ''
			}

			if( this.data.proportional() ){
				var paddingTop = 100 * this.data.sceneHeight() / this.data.sceneWidth();
				result.paddingTop = paddingTop + '%';
			} else {
				result.height = this.data.height()
			}

			return result;
		},

		getSceneStyle: function(){
			var result = {
				'position'	: 'absolute'/*,
				 'width'		: this.data.sceneWidth() + 'px',
				 'height'	: this.data.sceneHeight() + 'px'*/
			};

			if( this.data.size() == 'adapt' ){
				result.width = '100%';
				result.height = '100%';
			}

			return result;
		}
	});


	$.extend( namespace.Snippet.Contenedor.createSubClass('scene3dLayer', {
		mappeable			: {
			data			: {
				nombre		: '',

				depth		: 0,
				top			: 0,
				left		: 0,
				scaleX		: 1,
				scaleY		: 1,
				rotateX		: 0,
				rotateY		: 0,
				rotateZ		: 0
			}
		},
		defaults			: {
			editar			: true,
			hasEditButtons	: true,
			uid				: null
		},

		mapping: {
		}
	}, namespace.Snippet), {
		nombre				: ko.observable( 'Escena 3D - Layer' ),
		tamanoVentanaEdicion		: 'large'
	}).addMethods({
		init	: function(){
			this._parent.apply( this, arguments );
			this._createValidations();
		},

		_createValidations: function(){
			this._parent.apply( this, arguments );
		},

		isConfigured: function(){
			return true;
		},

		isBadConfigured: function(){
			return false;
		},

		beforeAccept: function( deferred ){
			if( this.isBadConfigured() ){
				deferred.reject();
			} else {
				deferred.resolve();
			}
		},

		canContainChildSnippet: function( snippet ){
			return snippet instanceof tiendasimple.Snippet.Titulo;
		}
	});


	////////////////////////////////////////////////////////////////////////////

})($.namespace('tiendasimple'));

//////////////////////////////////////;


/* /js/model_pagina_snippets.js
 * compresion time: 1.1189 -(ms)
 * ---------------------------- */
;(function(namespace){


	ko.bindingHandlers.snippetClickEnlace = {
		init: function(element, valueAccessor, allBindingsAccessor, data, context) {
			var enlace = valueAccessor();
			var $root = context.$root;
			var $data = data;

			var clickValueAccessor = function() {
				return function() {
					var enlace = ko.unwrap( valueAccessor() );
					if( enlace && view.navegarAEnlace ) {
						return view.navegarAEnlace( enlace );
					}
					else return true;
				};
			};

			var attrValueAccessor = function(){
				var enlace = ko.unwrap( valueAccessor() );
				return {
					'href'		: enlace && enlace.getHref( {'obtenerPaginaPorId': $root.obtenerPaginaPorId.bind($root)}),
					'target'	: enlace && enlace.getTarget()
				}
			}

			ko.computed( function(){
				var value = attrValueAccessor();
				ko.bindingHandlers.attr.update(element, attrValueAccessor, allBindingsAccessor, data, context);
			})


			ko.bindingHandlers.click.init(element, clickValueAccessor, allBindingsAccessor, data, context);

		}
	};

	ko.bindingHandlers.trimObservable = { 
		update: function(element, valueAccessor) {
			  var trimmedString = $.trim(ko.utils.unwrapObservable(valueAccessor()));
			  valueAccessor()(trimmedString);
		}
	};
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	namespace.Pagina.Snippets = namespace.Pagina.extend({
		init: function(data){				
			this._parent.apply(this, arguments);

			ko.computed( function(){
				var idPagina = this.id();
				ko.utils.arrayForEach(this.traducciones(), function( traduccion ){
					traduccion.enlace.asJS.tipo('pagina');
					traduccion.enlace.asJS.idPagina( idPagina );
				})
			}, this );

			this.id.notifySubscribers();
		}
	});

	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Snippets.Traduccion = namespace.Pagina.Traduccion.extend({
		init: function(data){			
			this._parent.apply(this, arguments);
		},
				
		destroy: function(){
			this.contenido.destroy();
			this._parent.apply( this, arguments );
		},
		
		_setMappeable: function(){
			this._parent();
			this._mappeable.contenido = {};
			this._mappeable.anclas = [];
		},

		_setDefaults: function(){
	        this._parent.apply(this, arguments);
	        this._mergeDefaults({
				anclasCargado: false
	        });
	    },

		
		_setMapping: function(){
			this._parent();
			this._mapping.contenido = {
				create: function(options){
					var data = $.extend({documentRoot: true}, options.data );
					return new namespace.Snippet.Contenedor( data );
				},

				key: namespace.Pagina.options.useMappingKey && function( data ){
					return ko.unwrap( data.data && data.guid );
				}
			};
		}
	});
	
})($.namespace('tiendasimple'));


/* /js/front/fronttienda_model_pagina.js
 * compresion time: 0.02599 -(ms)
 * ------------------------------------- */
;(function(namespace){
	namespace.Pagina = tiendasimple.Pagina.extend({	
		prototype:{
			init: function(data){
				this._parent.apply(this, arguments);
			},
			
			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					cargado			: false,
					cargando		: false,
					habilitado		: true
				})
			},

			_createEditables: function(){
				this.makeEditable($.map(this._mappeable, function(value,key){return key}));
			},

			_createComputed: function(){
				this.deshabilitado = this.habilitado.extend({not:true});
				this.descripcion = ko.computed(function(){
					var traduccion = this.traduccion();
					if(traduccion) return traduccion.titulo();
				}, this);
			}
		}
	});

	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Traduccion = tiendasimple.Pagina.Traduccion.extend({
		_createEditables: function(){
			this.makeEditable('mappeable');
		},

		_createValidations: function(){
			this.titulo.extend({required: true});
			this.descripcion.extend({required: true});

			ko.validatedObservable(this);
		}
	});
	
	namespace.Pagina.Texto = namespace.Pagina.extend({});
	
	namespace.Pagina.Snippets = tiendasimple.Pagina.Snippets.extend({
		_setDefaults: function(){
			this._parent();
			this._mergeDefaults({
				cargado			: false,
				cargando		: false
			});
		}
	});
	

	////////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Catalogo = tiendasimple.Pagina.Catalogo.extend({
		init: function(data){
			this._parent.apply(this, arguments);
		},
		
		_setDefaults: function(){
			this._parent();
			this._mergeDefaults({
				cargado		: false,
				cargando	: false
			});
		},
		
		getPageHashBang: function(){
			return '#!/catalogo/';
		}
	});
	
	////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Contacto = tiendasimple.Pagina.Contacto.extend({
		init: function(data){
			this._parent.apply(this, arguments);
		},
		
		_setDefaults: function(){
			this._parent();
			this._mergeDefaults({
				cargado		: false,
				cargando	: false
			});
		},
		
		getPageHashBang: function(){
			return '#!/contacto/';
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.Pagina.Enlace = tiendasimple.Pagina.Enlace.extend({


		prototype: {
			init: function(data){
				this._parent.apply(this, arguments);
			},

			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					cargado		: false,
					cargando	: false
				});
			},


			getPageURL: function( options ){
				var options = $.extend({}, options);
				var traduccion = this.traduccion();
				var link = ko.unwrap( ( traduccion || {} ).link );
				//var pagina;

				link = traduccion.enlace.getHref( options );

				switch( traduccion && traduccion.enlace.asJS.tipo() ){
					case namespace.Pagina.Enlace.TIPO_PAGINA:

						/*
						link = tiendasimple.helpers.Enlace.getPaginaHref({
							'obtenerPaginaPorId'	: options.obtenerPaginaPorId,
							'idPagina'				: traduccion.link.idPagina(),
							'ancla'					: traduccion.link.ancla()
						})
						*/
						/*
						link = '#!/';
						var idPagina = traduccion.link.idPagina();
						if( options.obtenerPaginaPorId ){
							pagina = options.obtenerPaginaPorId( idPagina );
						}
						if( pagina ) {
							link += pagina.getPermalink();
						} else {
							link += 'pagina/' + idPagina;
						}
						link +=  '/';
						//link = '#!/pagina/' + traduccion.link.idPagina() + '/';
						var ancla = traduccion.link.ancla();
						if( ancla ){
							var params = {};
							params[this.constructor.getAnclaParamName()] = ancla;
							link += '?' + $.param( params );
						}*/
						break;
				}
				return link;
			},

			getPageHashBang: function( traduccion, options ){
				var url = this.getPageURL( options )
					/*, tieneHashBang = $.string.startsWith( url, '#!')

				if ( !this.esPaginaExterna() && !tieneHashBang ){
					url = '#!/' + url;
				}*/

				return url;
			},

			getPageTarget: function(){
				var result = '';
				if( this.traduccion() ){
					result = this.traduccion().enlace.getTarget();
				}
				return result;
			},

			esPaginaExterna: function(){
				var url = this.getPageURL();
				return $.string.startsWith( url, 'http');
			},

			esPaginaInterna: function(){
				return !this.esPaginaExterna();
			},

			getPaginaInternaPermalink: function(){
				var url = this.getPageURL();
				var hb = $.hashbang.get( url );
				var firstPath = hb.getPath()[0];
				return firstPath && firstPath.key;
			}
		}
	});
	
})($.namespace('tiendasimple.front'));


/* /js/front/fronttienda_model_cliente.js
 * compresion time: 0.02384 -(ms)
 * -------------------------------------- */
$.namespace('tiendasimple.front');

tiendasimple.front.Cliente = tiendasimple.Usuario.createSubclass({
	mappeable: {
		nombre		    : '',
		apellido	    : '',
		telefono        : '',
		passwordActual  : '',
		habilitado	    : true,
		direcciones	    : [],
		ajaxError       : null,
		field1          : '',
		field2          : '',
		field3          : '',
		field4          : '',
		field5          : '',
		field6          : '',
		field7          : '',
		field8          : '',
		campos          : [],
		guest			: ''
	},
	defaults: {
		alwaysEdit	    : true
	},
	mapping: {
		direcciones	: {
			create: function( options ){
				return new tiendasimple.front.Cliente.Direccion( options.data );
			},

			key: function( data ){
				return ko.unwrap( data.id );
			}
		}
	}
	
},{
	init: function(data){
		this._parent.apply(this, arguments);
		this.makeEditable(['nombre','apellido','telefono','email', 'ajaxError', 'campos']);
		if(this.alwaysEdit()) this.beginEdit();
		this._createValidations();
	},
	
	update: function(data){
		if( data.direcciones === null ) data.direcciones = [];
		this._parent.apply(this, arguments);
	},

	guardar: function(data){
		if(data) this.update(data, {onlyMappeable: true});
		this.commit();
		if( ko.utils.unwrapObservable(this.alwaysEdit) ) this.beginEdit();
	},

	cancelar: function(){
		this.rollback();
		if( ko.utils.unwrapObservable(this.alwaysEdit) ) this.beginEdit();
	},

	_createValidations: function(){
		var self = this;

		self.nombre.extend({required: true});
		self.email.extend({required: true, email: true});

		self.passwordActual.extend({
			required	: {
				onlyIf: function(){
					return self.email.hasChanges();
				}
			}
		});

		ko.validatedObservable(this);
	},

	_createComputed: function(){
		var self = this;
		
		this._parent.apply(this, arguments);
		
		this.direcciones.seleccionado = ko.observable();

		this.direcciones.seleccionado.id = ko.computed({
			read: function(){
				return this.direcciones.seleccionado() && this.direcciones.seleccionado().id()
			},
			
			write: function(id){
				var direccion = $.findInCollection(this.direcciones(), function(direccion){
					return direccion.id() == id;
				});
				this.direcciones.seleccionado(direccion);
			}
		}, this);

		// sto hace que si cambia las direcciones, la seleccionada sea la primera. por qu?
		// encima, al cambiar this.direcciones.seleccionado.id, hace que this.direcciones.seleccionado sea la nueva direccin
		this.direcciones.subscribe(function(value){
			var nuevoId = value[0] && value[0].id();
			var id = self.direcciones.seleccionado.id.peek();

			if( id ){
				var direccion = ko.utils.arrayFirst( value, function( direccion ){
					return ko.unwrap( direccion.id ) == id;
				});
				if( direccion ){ // se mantiene la direccin que tena
					nuevoId = id;
				}
			}

			self.direcciones.seleccionado.id( nuevoId );

		}, this);

		this.direcciones.creandoNueva = ko.computed(function(){
			return this.obtenerDireccionNueva();
		}, this);

		this.direcciones.tieneDireccion = ko.computed(function(){
			return !!this.direcciones.seleccionado.id();
		}, this);

		this.nombreApellido = ko.computed(function(){
			var result = [];
			if( this.nombre() ) result.push(this.nombre());
			if( this.apellido() ) result.push(this.apellido());
			return this.invitado() ? 'Invitado' : result.join(' ');
		}, this);

		this.invitado = ko.computed(function(){
			
			var result = ( this.guest() != 0 && this.guest() !== null ? true : false );
			return result;
		}, this);
	},
	
	obtenerDireccionNueva: function(){
		return $.findInCollection(this.direcciones(), function(direccion){
			return !direccion.id()
		});	
	},
	
	nuevaDireccion: function(){
		var nuevaDireccion = this.obtenerDireccionNueva();
		
		if(!nuevaDireccion) {
			nuevaDireccion = new tiendasimple.front.Cliente.Direccion({id:0});
			this.direcciones.push(nuevaDireccion);
			this.notifySubscribers( nuevaDireccion, 'nuevaDireccion');
		}

		//this.direcciones.seleccionado.id(0);
	},

	obtenerDireccionPorId: function(id){
		return $.findInCollection(this.direcciones(), function(direccion){
			return direccion.id() == id;
		})
	},

	obtenerDireccionDeEnvio: function() {
		var oDireccion = null,
		idDireccionDeEnvio = model.data.carrito.idDireccionEnvio();

		if (idDireccionDeEnvio != null) {
			oDireccion = this.obtenerDireccionPorId(idDireccionDeEnvio);
		}

		return oDireccion;
	},
});



tiendasimple.front.Cliente.Direccion = ko.ViewModel.extend({
	_mappeable: {
		direccion		: null,
		codigoPostal	: null,
		ciudad          : null,
		provincia		: null,
		pais			: null,
		telefono		: '', // varChar 50
		idCliente    	: null,
		id				: null		
	},
	
	init: function(data){	
	
		this._parent.apply(this, arguments);

		this._createComputed();
		
		this.makeEditable(['direccion','codigoPostal','ciudad','provincia','pais', 'telefono']);
		this._createValidations();
	},
	
	_createComputed: function(){
		this.descripcion = ko.computed({
			read: function(){
				var result = [];
				this.codigoPostal() && result.push('cp ' + this.codigoPostal());
				this.ciudad() && result.push(this.ciudad());
				this.provincia() && result.push(this.provincia());
				this.pais() && result.push(this.pais());
				return result.join(' | ');
			},
			dispose: this.disposed
		}, this);

		this.direccionCompleta = ko.computed(function(){
			var direccionCompleta = null
				, arr = [];

			//if( this.isValid() ){
				arr = [	this.direccion(), this.codigoPostal() && 'cp' + this.codigoPostal(), this.ciudad(), this.provincia(), this.pais()];
				direccionCompleta = $.grep(arr, function(i){return i} ).join(', ');
			//}
			return direccionCompleta;
		}, this);

		this.direccionParcial = ko.computed(function(){
			var direccionParcial = null
				, arr = [];

			arr = [	this.direccion(), this.ciudad() ];
			direccionParcial = $.grep(arr, function(i){return i} ).join(', ');
			return direccionParcial;
		}, this);

	},
	
	_createValidations: function(){
		if(ko.validation.disabled) return;
		
		this.direccion.extend({required:true});
		this.codigoPostal.extend({required:true});
		this.ciudad.extend({required:true});
		this.provincia.extend({required:true});
		this.pais.extend({required:true});
		
		this._parent.apply( this, arguments );
		
		//ko.validatedObservable(this);
	}
	
});


/* /js/front/fronttienda_model_ventana.js
 * compresion time: 0.02599 -(ms)
 * -------------------------------------- */
$.namespace('tiendasimple.front');

tiendasimple.front.Ventana = tiendasimple.Ventana.createSubclass({
});


tiendasimple.front.Ventana.Login = tiendasimple.Ventana.createSubclass({
	mappeable: {
		usuario		: '',
		password	: '',
		ajaxError	: null			
	}	
},	{
	init: function(data){
		this._parent.apply(this, arguments);

		this._createValidations();
	},

	_createValidations: function(){
		this.usuario.extend({required: true});
		this.password.extend({required: true});
		ko.validatedObservable(this);
	}
});

tiendasimple.front.Ventana.Registro = tiendasimple.Ventana.createSubclass({
	mappeable: {
		email		: '',
		password	: '',
		password2	: '',
		nombre		: '',
		apellido	: '',
		ajaxError	: null,
		gdpr        : null,
		field1      : '',
		field2      : '',
		field3      : '',
		field4      : '',
		field5      : '',
		field6      : '',
		field7      : '',
		field8      : '',
	}
},{
	init: function(data){		
		var self = this;
		this._parent.apply(this, arguments);
		this._createValidations();
	},
	
	_createValidations: function(){

		this.field1 = ko.observable();
		this.field2 = ko.observable();
		this.field3 = ko.observable();
		this.field4 = ko.observable();
		this.field5 = ko.observable();
		this.field6 = ko.observable();
		this.field7 = ko.observable();
		this.field8 = ko.observable();

		this.nombre.extend({required: true});
		this.apellido.extend({required: true});
		this.email.extend({required: true});
		this.email.extend({email:true});
		this.password.extend({required: true});
		this.password2.extend({equal: this.password});
		
		setTimeout(function()  {
			if (model.data.camposPersonalizados !== undefined && model.data.ventanas.registro.activa() ){
				var campos = model.data.camposPersonalizados.campos();
				if (campos.length >= 1){
				var field = '';
					campos.forEach(function (campo) {
						if (campo.requerido == 'true'){
							switch(campo.field) {
								case 'field1':
									model.data.ventanas.registro.field1.extend({required: true});
								break;
								case 'field2':
									model.data.ventanas.registro.field2.extend({required: true});
								break;
								case 'field3':
									model.data.ventanas.registro.field3.extend({required: true});
								break;
								case 'field4':
									model.data.ventanas.registro.field4.extend({required: true});
								break;
								case 'field5':
									model.data.ventanas.registro.field5.extend({required: true});
								break;
								case 'field6':
									model.data.ventanas.registro.field6.extend({required: true});
								break;
								case 'field7':
									model.data.ventanas.registro.field7.extend({required: true});
								break;
								case 'field8':
									model.data.ventanas.registro.field8.extend({required: true});
								break;
							}
						}
					});
				}
			}
		}, 2000);
		
		ko.validatedObservable(this);
	},

	mappearDatosCamposPersonalizados : function(obj){
		this.field1(obj.field1);
		this.field2(obj.field2);
		this.field3(obj.field3);
		this.field4(obj.field4);
		this.field5(obj.field5);
		this.field6(obj.field6);
		this.field7(obj.field7);
		this.field8(obj.field8);
	}

});



tiendasimple.front.Ventana.ValidarEmail = tiendasimple.Ventana.createSubclass({
	mappeable: {
		usuario		: '',
		codigo		: '',
		ajaxError	: null	
	}
},{
	init: function(data){
		this._parent.apply(this, arguments);
		
		this._createValidations();
		
		this.usuario.subscribeTo('usuario_email');
	},
	
	_createValidations: function(){
		this.usuario.extend({required: true});
		this.codigo.extend({required: true});
		ko.validatedObservable(this);
	}
});


tiendasimple.front.Ventana.Contacto = tiendasimple.Ventana.createSubclass({
	mappeable: {
		nombre		: '',
		email		: '',
		mensaje		: '',
		enviando	: false,
        gdpr        : null,
        ajaxError	: null
	}
},{
	init: function(data){
		this._parent.apply(this, arguments);
		this._createValidations();
	},
	
	_createValidations: function(){
		this.nombre.extend({required: true});
		this.email.extend({required: true, email: true});
		this.mensaje.extend({required: true});
		ko.validatedObservable(this);
	}
});


/**
 * 
 */
tiendasimple.front.Ventana.RecordarPassword = tiendasimple.front.Ventana.createSubclass({
	mappeable: {
		usuario			: '',
		ajaxError		: null
	}
},{
	init: function(data){
		this._parent(data);		
		this._createValidations();
	},
	
	_createValidations: function(){
		this.usuario.extend( {required: true} );
		ko.validatedObservable(this);
	}
});


/**
 *
 */
tiendasimple.front.Ventana.CambiarPassword = tiendasimple.front.Ventana.createSubclass({
	mappeable: {
		passwordActual			: '',
		passwordNuevo			: '',
		passwordNuevo2			: '',
		enviarPassword			: false,
		ajaxError				: null,
	},
	defaults: {
		alwaysEdit              : false
	}
},{
	init: function(data){
		this._parent.apply(this, arguments);
		this.makeEditable(['passwordActual', 'passwordNuevo', 'passwordNuevo2', 'enviarPassword', 'ajaxError']);
		this._createValidations();
	},

	toggleEditar: function(){
		if( this.inTransaction() && !this.hasChanges() ) this.cancelar();
		else this.editar();
	},

	editar: function(data){
		if(data) this.update(data, {onlyMappeable: true});
		if(!this.inTransaction()) this.beginEdit();

		this.activa(true);
	},

	guardar: function(data){
		if(data) this.update(data, {onlyMappeable: true});
		this.commit();
		if( ko.utils.unwrapObservable(this.alwaysEdit) ) this.beginEdit();
	},

	cancelar: function(){
		this.rollback();
		if( ko.utils.unwrapObservable(this.alwaysEdit) ) this.beginEdit();

		this.errors.showAllMessages(false);
		this.activa(false);
	},

	_createValidations: function(){
		this.passwordActual.extend( {required:true} );
		this.passwordNuevo.extend( {required:true} );
		this.passwordNuevo2.extend( {required:true} );
		this.passwordNuevo2.extend({equal: this.passwordNuevo});

		ko.validatedObservable(this);
	}
});

/**
 * 
 */
tiendasimple.front.Ventana.RecordarPasswordEnviado = tiendasimple.front.Ventana.createSubclass({
});

tiendasimple.front.Ventana.ErrorConfirmarCarro = tiendasimple.front.Ventana.createSubclass({
});

tiendasimple.front.Ventana.ModificarItemsCarro = tiendasimple.front.Ventana.createSubclass({
});

tiendasimple.front.Ventana.EliminarOrdenCompra = tiendasimple.front.Ventana.createSubclass({
});

tiendasimple.front.Ventana.EliminarItemsCarro = tiendasimple.front.Ventana.createSubclass({
});


/**
 * 
 */
tiendasimple.front.Ventana.Apariencia = tiendasimple.front.Ventana.createSubclass({
	mappeable: {
		estilo				: {},
		tema				: {}	
	},
	mapping: {				
		estilo: {
			create: function(options){
				return new tiendasimple.front.EstiloEdicion(options.data);
			}
		},

		tema: {
			create: function(options){
				return new tiendasimple.front.TemaEdicion(options.data);
			}
		}
	}
}, {
	init: function(data){
		var self = this;
		
		////////////////////////////////////////////////////////////////////////

		$.ajax('/less/estilo.less').done(function(response){
			self.estilo.less(response);
			self.estilo.setInitData({less: response});
		});

		$.ajax('/less/tema.less').done(function(response){
			self.tema.less(response);
			self.tema.setInitData({less: response});
		});
		
		////////////////////////////////////////////////////////////////////////


		this._parent(data);
		
		this._createValidations();
		this._createComputed();
		
	},
	
	_createComputed: function(){
		this.compilando = ko.computed(function(){
			return this.estilo.compilando() || this.tema.compilando();
		}, this);
	},

	compilarEstilo: function(){
		this.estilo.compilar();
	},
	
	generarColoresEstilo: function(){
		this.estilo.generarColores();
	},

	generarColoresEstiloYCompilar: function(){
		this.generarColoresEstilo();
		this.compilarEstilo();
	},

	compilarTema: function(){
		this.tema.compilar();	
	},	

	_createValidations: function(){
		/*
		this.usuario.extend( {required: true} );
		ko.validatedObservable(this);
		*/
	}
});



//////////////////////////////////////////////////////////
tiendasimple.front.Ventana.ProductoElegirOpcion = tiendasimple.front.Ventana.createSubclass({
	mappeable: {
		producto	: null
	}
});


/**
 *
 */
tiendasimple.front.Ventana.NuevaDireccion = tiendasimple.front.Ventana.createSubclass({
	mappeable: {
		direccion: null
	}
},{
	init: function(data){
		this._parent(data);
	}
});

tiendasimple.front.Ventana.DatosAdicionales = tiendasimple.Ventana.createSubclass({
	mappeable: {
		nombre                  : '',
		apellido                : '',
		telefono                : '',
		ciudad                  : '',
		direccion               : '',
		codigoPostal            : ''
	},
	defaults: {
		ajaxError	            : null,
		formatoTodoPago         : true,

		validarCliente          : false,
		validarDatosEnvio       : false
	}
},{
	init: function(data){
		this._parent.apply(this, arguments);

		this._createValidations();
	},

	_createValidations: function(){
		var self = this;

		self.nombre.extend({
			required                : {
				onlyIf: function(){
					return self.validarCliente();
				}
			},
			firstLastNameTodoPago   : this.formatoTodoPago
		});

		self.apellido.extend({
			required                : {
				onlyIf: function(){
					return self.validarCliente();
				}
			},
			firstLastNameTodoPago   : this.formatoTodoPago
		});

		self.telefono.extend({
			required            : {
				onlyIf: function(){
					return self.validarCliente();
				}
			},
			phoneNumberTodoPago : this.formatoTodoPago
		});

		self.ciudad.extend({
			required            : {
				onlyIf: function(){
					return self.validarDatosEnvio();
				}
			},
			cityTodoPago : this.formatoTodoPago
		});

		self.direccion.extend({
			required            : {
				onlyIf: function(){
					return self.validarDatosEnvio();
				}
			},
			streetTodoPago : this.formatoTodoPago
		});

		self.codigoPostal.extend({
			required            : {
				onlyIf: function(){
					return self.validarDatosEnvio();
				}
			},
			postalCodeTodoPago : this.formatoTodoPago
		});

		ko.validatedObservable(self);
	},

	getDatosCliente: function(){
		var propiedadesSeleccionadas = ['nombre', 'apellido', 'telefono'];
		return this.toJS( propiedadesSeleccionadas );
	},

	getDatosDireccion: function(){
		var propiedadesSeleccionadas = ['ciudad', 'direccion', 'codigoPostal'];
		return this.toJS( propiedadesSeleccionadas );
	}

});

tiendasimple.front.Ventana.GaleriaZoom = tiendasimple.Ventana.createSubclass({
	mappeable: {
            item : null
	},
	defaults: {
            
	}
},{
	init: function(data){
		this._parent.apply(this, arguments);
	}
});


///////////////////////////////////////////////////////////////////////////
///// VENTANA BOTON FORMULARIO DE CONSULTA

tiendasimple.front.Ventana.FormularioConsulta = tiendasimple.Ventana.createSubclass({
	mappeable: {
		data : '',
	},
	defaults: {
	}
},{
	init: function(data){
		this._parent.apply(this, arguments);
		this._createValidations();
	},
	_createValidations: function(){
		var self = this;
	},
});


tiendasimple.front.Ventana.Invitado = tiendasimple.Ventana.createSubclass({
	mappeable: {
		email		: '',
		password	: '',
		password2	: '',
		nombre		: '',
		apellido	: '',
		ajaxError	: null,
		gdpr        : null,
		recomendarRegistro: false,
		recaptcha	: '',
		enProcesoDeRegistro	: false,
	}
},{
	init: function(data){		
		var self = this;
		this._parent.apply(this, arguments);
		this._createValidations();
	},
	
	_createValidations: function(){

		this.nombre.extend({required: true});
		this.apellido.extend({required: true});
		this.email.extend({required: true});
		this.email.extend({email:true});
		this.password2.extend({equal: this.password});
		
		//this.recaptcha.extend({required: true });

		ko.validatedObservable(this);
	},	
	
});

tiendasimple.front.Ventana.fileuploaderror = tiendasimple.Ventana.createSubclass({
	mappeable: {
		data : '',
	},
	defaults: {
	}
},{
	init: function(data){
		this._parent.apply(this, arguments);
		this._createValidations();
	},
	_createValidations: function(){
		var self = this;
	},
});


/* /js/front/fronttienda_model_market.js
 * compresion time: 0.02193 -(ms)
 * ------------------------------------- */
$.namespace('tiendasimple.front');

tiendasimple.front.Market = tiendasimple.Market.createSubclass({
	},{
		init: function(){
			this._parent.apply(this, arguments);
			this.imagenLogo = new tiendasimple.Market.Imagen(null, this);
		}
});


/* /js/front/fronttienda_model_carrito.js
 * compresion time: 0.02789 -(ms)
 * -------------------------------------- */
; (function( namespace ){
	namespace.Carrito = ko.ViewModel.createSubclass({
		mappeable: {
				comentario			: null,
                                cupon : '',
                                aplicandoCupon:null,
                                eliminandoCupon:false,
                                cuponInexistente:null,                                
				id					: null,
				idCliente			: null,
				idDireccionEnvio	: null,
				idEstado			: null,
				idEstadoOrden		: null,
				idEstadoMotivo		: null,
				idMetodoEnvio		: null,
				idEstadoEnvio		: null,

				idCotizacionEnvio   		: null,

				idMetodoPago		: null,
				detalle				: [],
				signature			: '', // identificador que valida una orden de compras ante un mtodo de pago, por ejemplo payU

				timeoutRestante		: 5 * 60, // 5 minutos
				vigenciaRestante	: 5 * 60 * 60 * 24, // 5 das
                                alcances:'',
                                montoFinalCalculado : 0.00,
                                // descuentos -->
                                descuentosAplicados : [],
                                descuentosActivos : [],
                                descuentosGeneral : false,
                                tieneDescuentos : false,
                                htmlDescuentosActivos : '',
                                idMetodoDePagoDescuentos : null,
                                strDiferentesDescuentosMediosDePago : null,
                                nDescuentos : 0,
                                mensajeCupon : '',
		},

		defaults: {
                        
                        estadoCupon:"aplicar",
			abriendoGatewayDePago	: false,
			confirmando				: false,
			estadosDeCompra         : ['datos_de_envio', 'metodo_de_envio', 'metodo_de_pago', 'confirmar'],
			estadoActualDeCompra    : 'datos_de_envio',
			envioCotizado			: false,
			cotizandoEnvio			: false,

			idCotizacionEnvioPadre   	: null,

			direccionEnvio			: {}

		},

		mapping	: {
			detalle:{
				create: function(options){
					return new tiendasimple.front.Carrito.Item(options.data);
				},

				key: function( option ){
					return ko.unwrap( option.id );
				}
			},

			direccionEnvio: {
				create: function( options ){
					return new tiendasimple.front.Cliente.Direccion( options.data );
				}
			}
		}
	},{

		estados: {
			CARRO_INCOMPLETO		: 1,
			CARRO_CONFIRMADO		: 2,
			ESPERANDO_APROBACION	: 3,
			INICIANDO_PAGO_ONLINE	: 4,
			PAGO_ONLINE_OK			: 5,
			PAGO_ONLINE_ERROR		: 6,
			COBRADO					: 7,
			CANCELADO				: 8
		},

		estadosEnvio: {
			PENDIENTE				: 1,
			DESPACHADO				: 2,
			ENTREGADO				: 3
		},

		metodosPago: {
			CONTRA_REEMBOLSO			: 1,
			A_CONVENIR					: 7,
			DEPOSITO_TRANSFERENCIA		: 5
		},

		init: function(data){
                    
			var self = this;

			this._parent.apply(this, arguments);
			this.makeEditable(['detalle']);		
			this._createComputed();
			this._createValidations();


			this._decrementarTimeoutRestanteInterval = setInterval( function(){
				var transcurrido = this.timeoutRestante.transcurrido() + 1
					, calculado = this.timeoutRestante() - transcurrido;

				this.timeoutRestante.transcurrido( transcurrido );

				if( !this.timeoutRestante.estimado.pausado() ){
					this.timeoutRestante.estimado( calculado );

					if( calculado <= 0 && !this.timeoutRestante._notificado ){
						this.timeoutRestante._notificado = true;
						self.notifySubscribers( calculado , 'vencioTimeout' );
					}
				}

			}.bind( this ), 1000 );
		},

		_createValidations: function(){
			this.idMetodoPago.extend({required: true});
			this._parent.apply( this, arguments );
		},

		reset: function(){
			this._parent.apply( this, arguments );
			this.showAllMessages( false );
		},

		_createComputed: function(){
			var self = this;

			this._addDisposable( this.procesando = ko.computed( function(){
				return this.confirmando();
			}, this));

			this.cantidad = ko.computed({
				read: function(){
					var total = 0;
					$.each(this.detalle(), function(index, item){
						total += item.cantidad();
					});
					return total;
				},

				deferEvaluation: true
			}, this);

			this.totales = ko.computed({
				read: function(){
					return self.obtenerTotalesPorTipo();
				},

				deferEvaluation: true				
			}, this);
                        
			/*
			ko.computed(function(){
				$.each(this.detalle(), function(index, item){
					if(typeof item.cantidad.__oldValue != 'undefined' && item.cantidad() != item.cantidad.__oldValue){
						self.notifySubscribers(item, 'itemCambioCantidad' );					
					}
					item.cantidad.__oldValue = item.cantidad();
				});
			}, this);
			*/

			ko.computed(function(){
				$.each(this.detalle(), function(index, item){
					if(typeof item.cantidad.nuevoValor.__oldValue != 'undefined' && item.cantidad.nuevoValor() != item.cantidad.nuevoValor.__oldValue){
						self.notifySubscribers(item, 'itemCambioCantidadNuevoValor' );					
					}
					item.cantidad.nuevoValor.__oldValue = item.cantidad.nuevoValor();
				});
			}, this);


			this.detalle.flatten = ko.computed(function(){
				var i, result = [];

				$.each( this.detalle(), function( index, item ){
					for ( i = 0 ; i < item.cantidad() ; i++ ){
						result.push( item );
					}
				});

				return result;
			}, this, {deferEvaluation : true} );

			/*
			this.timeoutRestante.subscribe( function( value ){
				this.restartTimeoutRestanteEstimado();
			}, this );
			*/


			this._timeoutRestante = this.timeoutRestante;

			this.timeoutRestante = ko.computed({
				read: function(){
					return this._timeoutRestante();
				},
				write: function( value ){
					this._timeoutRestante( value );
					this.restartTimeoutRestanteEstimado();
				}			
			}, this);


			this.timeoutRestante.estimado = ko.observable( Number( this.timeoutRestante() ) );
			this.timeoutRestante.transcurrido = ko.observable( 0 );

			this.timeoutRestante.estimado.esPoco = ko.computed( function(){
				return this.timeoutRestante.estimado() < 10;
			}, this );

			this.timeoutRestante.estimado.esMuyPoco = ko.computed( function(){
				return this.timeoutRestante.estimado() < 3;
			}, this );

			this.timeoutRestante.estimado.pausado = ko.observable( false );

			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			this.estado = {
				cobrado			: ko.computed( function(){
					return this.idEstadoOrden() == this.estados.COBRADO;
				}, this ),

				cancelado		: ko.computed( function(){
					return this.idEstadoOrden() == this.estados.CANCELADO;
				}, this ),

				requiereAccion	: ko.computed( function(){
					return this.idEstadoOrden() == this.estados.ESPERANDO_APROBACION;
				}, this ),

				carrito			: ko.computed( function(){
					return this.idEstadoOrden() == 	this.estados.CARRO_INCOMPLETO;
				}, this )
			};

			this.metodoPago = {
				contraReembolso: ko.computed( function(){
					return this.idMetodoPago() == this.metodosPago.CONTRA_REEMBOLSO;
				}, this),

				aConvenir: ko.computed( function(){
					return this.idMetodoPago() == this.metodosPago.A_CONVENIR;
				}, this),

				depositoTransferencia: ko.computed( function(){
					return this.idMetodoPago() == this.metodosPago.DEPOSITO_TRANSFERENCIA;

				}, this)
			};

			this.estadoEnvio = {
				pendiente			: ko.computed( function(){
					return this.idEstadoEnvio() == this.estadosEnvio.PENDIENTE;
				}, this ),

				despachado			: ko.computed( function(){
					return this.idEstadoEnvio() == this.estadosEnvio.DESPACHADO;
				}, this ),

				entregado			: ko.computed( function(){
					return this.idEstadoEnvio() == this.estadosEnvio.ENTREGADO;
				}, this ),

				permiteCambio		: ko.computed( function(){
					return this.estado.cobrado() || this.metodoPago.contraReembolso() || this.metodoPago.aConvenir() || this.metodoPago.depositoTransferencia()
				}, this )
			};
		},

		restartTimeoutRestanteEstimado: function(){
			var value = this.timeoutRestante();
			this.timeoutRestante.estimado( Number( value ) );
			this.timeoutRestante.transcurrido( 0 );
			this.timeoutRestante._notificado = false;		
		},

		update: function(data){
			if(data.detalle){
				this.detalle.dispose();
			}

			this._parent.apply(this, arguments);
		},

		quitarItem: function(item){
			this.detalle.remove(item);
			item.dispose();
		},

		revertCantidades: function(){
			$.each( this.detalle(), function( index, item){
				item.revertCantidad();
			});
		},
                
                settearDescuentosEnCarrito : function( descuentos ){
                    var self = this;
                    model.data.carrito.descuentosAplicados(descuentos);
                    model.data.carrito.descuentosGeneral(descuentos.general);
                    model.data.carrito.tieneDescuentos(descuentos.tieneDescuentos);
                    model.data.carrito.nDescuentos(descuentos.nDescuentos);
                    self.settearMensajeDescuentosConDifMediosDePago(descuentos.mediosDePagoConDescuentos);
                    self.obtenerDescuentoEnCarrito(self.idMetodoPago());
                    model.data.carrito.totales().forEach(function( total ){
                        self.tieneDescuentoPorMoneda( total.total, total.idMoneda);
                    });
                },
                
                settearMensajeDescuentosConDifMediosDePago : function( mediosDePago ){
                    var self = this;
                    var strMetodosDePago = '';
                    if (mediosDePago.length == 0){
                        model.data.carrito.strDiferentesDescuentosMediosDePago(null);
                        return;
                    }else{
                        mediosDePago.forEach(function( id ){
                            if(model.data.obtenerMetodoPagoPorId(id)){
                                strMetodosDePago += i18n.kot('app.metodospago.' + model.data.obtenerMetodoPagoPorId(id).descripcion()) + ' , ';
                            }
                        });
                        strMetodosDePago = strMetodosDePago.substring(0, strMetodosDePago.length - 2);
                        var mensaje = '<div class="alert alert-success">';
                        if (model.data.carrito.nDescuentos() == 1){
                            mensaje += 'El descuento solo aplica con los siguientes medio de pago (' + strMetodosDePago + ').';
                        }else{
                            mensaje += 'Pueden aplicar otros descuento seleccionando algunos de estos medios de pago (' + strMetodosDePago + ') en los prximos pasos.';
                        }
                        mensaje += '</div>';
                        model.data.carrito.strDiferentesDescuentosMediosDePago(mensaje);
                    }
                },
                
                obtenerDescuentoEnCarrito : function(metodoDePago){
                    metodoDePago = 0;
                    var self = this;
                    
                    var arrDescuentoActivo = {};
                    if (model.data.carrito.descuentosAplicados().descuentos === undefined){
                        self.resetMontosDescuentosCarrito();
                        return;
                    }
                    
                    var descuento = model.data.carrito.descuentosAplicados().descuentos;
                  
                    if (descuento === undefined){
                        self.resetMontosDescuentosCarrito();
                        return;
                    }
                    
                    if (descuento.length >= 1){
                        model.data.carrito.descuentosActivos([]);
                        descuento.forEach(function(descuento){
                        descuento = descuento[0];
                        arrDescuentoActivo = {
                            descripcion : descuento.descripcion,
                            monto : descuento.montoDescuento,
                            moneda : descuento.moneda,
                        };
                        model.data.carrito.descuentosActivos().push(arrDescuentoActivo);
                        });
                    }
                    self.renderizarDescuentosActivos();
                },
                
                tieneDescuentoPorMoneda : function(subtotal, moneda){
   
                var self = this;
                var totalDescuento = 0;
                var idSinDescuento = '#totales-sin-descuento-' + moneda;
                var idConDescuento = '#totales-con-descuento-' + moneda;
                var medioDePago = self.obtenerMedioDePagoActual();
                var htmlDescuento = '';
                var diferencia = 0;
                    
                if (model.data.carrito.descuentosAplicados().descuentos === undefined){
                    return;
                }
                var descuento = model.data.carrito.descuentosAplicados().descuentos;
                if (descuento === undefined){
                    model.data.carrito.descuentosActivos([]);
                    return;
                }
                if (descuento.length >= 1){
                    descuento.forEach(function(descuento){
                        descuento = descuento[0];
                        if (descuento.moneda == moneda){
                          totalDescuento = totalDescuento + descuento.montoDescuento;
                        }
                    });
                }
             
                if (totalDescuento > 0){
                    diferencia = subtotal - totalDescuento;
                    $(idSinDescuento).addClass('precio-original-carrito');
                    htmlDescuento += '<strong>';
                    htmlDescuento += '<span> ' + model.data.obtenerSimboloMonedaPorId(moneda) + ' ' + accounting.formatMoney(diferencia, '')  + '</span>';
                    htmlDescuento += '</strong>';
                    $(idConDescuento).html(htmlDescuento);
                    $(idConDescuento).show();
                }else{
                    $(idSinDescuento).show();
                    $(idSinDescuento).removeClass('precio-original-carrito');
                    $(idConDescuento).html('');
                    $(idConDescuento).hide();
                }
                  
                },
                
                obtenerDescuentosPorMoneda : function(moneda){
                    var self = this;
                    var arrDescuentoActivo = {};
                    var totalDescuento = 0;
                    var descuento = model.data.carrito.descuentosAplicados().descuentos[self.idMetodoPago()];
                    if (descuento.length >= 1){
                        descuento.forEach(function(descuento){
                            if (descuento.moneda == moneda){
                                totalDescuento += descuento.montoDescuento;
                            }
                        });
                    }
                    totalDescuento = accounting.formatMoney(descuento.monto);
                },
                
                renderizarDescuentosActivos : function(){
                    var self = this;
                    var strRet = '';
                    var descuentosActivos = model.data.carrito.descuentosActivos();
                    var strDescuento = '';
                    descuentosActivos.forEach(function( descuento ){
                        strDescuento = accounting.formatMoney(descuento.monto);
                        strDescuento = strDescuento.replace('$', '', strDescuento);
                        strRet += '<tr>';
                        strRet += '<td colspan="3" class="align-left"><i class="fa fa-gift"></i>';
                        strRet += '<span class="titulo-descuento-carrito">' + descuento.descripcion + '</span>';
                        strRet += '</td>';      
                        strRet += '<td class="condensed align-right">';      
                        strRet += '- ' + model.data.obtenerSimboloMonedaPorId(descuento.moneda) + ' ' + strDescuento;
                        strRet += '</td>';
                        strRet += '<td></td>';
                        strRet += '<tr/>';
                    });
                    model.data.carrito.htmlDescuentosActivos( strRet );
                    $('#descuentos-activos-en-carrito').html('');
                    $('#descuentos-activos-en-carrito').append( strRet );
                    // totales
                    model.data.carrito.totales().forEach(function(total){
                        self.tieneDescuentoPorMoneda(total.total, total.idMoneda);
                    });
                },
                
                obtenerMedioDePagoActual : function(){
                    var self = this;
                    if (self.idMetodoPago() === null){
                        return 0;
                    }else{
                        return self.idMetodoPago();
                    }
                },
                
                resetMontosDescuentosCarrito : function(moneda){
                   var self = this;
                   $('.total-con-descuento').hide();
                   $('.total-sin-descuento').show();
                   $('#descuentos-activos-en-carrito').html('');
                   model.data.carrito.descuentosActivos([]);
                   model.data.carrito.htmlDescuentosActivos('');
                   self.renderizarDescuentosActivos();
                },
                
                obtenerTotalDescuentos : function(){
                    var totalDescuento = 0;
                    var moneda = 0;
                    model.data.carrito.obtenerTotalesDeTipoCupon().forEach(function( total, i ){
                        if (i == 0) moneda = total.idMoneda;
                        if (total.idMoneda == moneda){
                            totalDescuento += total.total;
                        }
                    });
                    return Math.abs(totalDescuento);
                },
                
                settearMensajeErrorCupon : function (err){
                    if (err == '' || err === undefined ) return '';
                    var data = err;
                    if (err.indexOf('|') > -1){
                        data = err.split('|');
                        err = err.split('|')[0];
                    }
                    var mensaje = '';
                    switch (err) {
                        case 'montominimo':
                            mensaje = 'El monto mnimo para aplicar este cupn es de ' + model.data.obtenerSimboloMonedaPorId(data[2]) + ' ' + data[1];
                        break;
                        default:
                            mensaje = '';
                        break;
                    }
                    return mensaje;
                },
		
		///////////////////////////////////////////////////////
		///////////////// BOTON CONSULTAR

		tieneFormularioDeConsulta : function(){
			var blnTiene = false;
			if (model.data.market.configuracion.get('tiene_formulario_de_consulta') && model.data.market.configuracion.get('tiene_formulario_de_consulta') != '0') {
				blnTiene = true;
			}
			return blnTiene;
		},
		
		gotoTop : function(){
			if($(window).scrollTop() > 0) {
				$(window).animate({
					scrollTop:0
				}, {});
			};
		},

		
		mostrarBotonComprar : function(){
			var mostrar = false;
			if ( model.data.market.configuracion.get('mostrar_boton_comprar') == 1 || model.data.market.configuracion.get('mostrar_boton_comprar') === undefined ){
				mostrar = true;
			}
			return mostrar;
		},

		mostrarBotonConsulta : function(){
			var mostrar = false;
			if ( ( model.data.market.configuracion.get('mostrar_boton_consultar') === true &&
				   model.data.market.configuracion.get('mostrar_boton_consultar') !== undefined )
				   && model.data.market.configuracion.get('tiene_formulario_de_consulta') !== undefined
				) {
				mostrar = true;
			}
			return mostrar;
		},

		getTextoBotonComprar : function (){
			var self = this;
			var texto = '';
			if ( model.data.market.configuracion.get('texto_boton_comprar') != '') texto = model.data.market.configuracion.get('texto_boton_comprar');
			if (texto === undefined) texto = '';
			return texto;
		},

		getTextoBotonConsultar : function (){
			var self = this;
			var texto = '';
			if ( model.data.market.configuracion.get('texto_boton_consultar') != '' && self.tieneFormularioDeConsulta()) texto = model.data.market.configuracion.get('texto_boton_consultar');
			if (texto === undefined) texto = '';
			return texto;
		},

		sePuedeConfirmar: function(){
			return this.detalle().length > 0;
		},

		esOrdenDeCompras: function(){
			return !this.esCarrito();
		},

		esCarrito: function(){
			return !ko.unwrap( this.idEstadoOrden ) || ko.unwrap( this.idEstadoOrden ) == 1;
		},

		sePuedeModificarDetalle: function(){
			return this.esCarrito();
		},

		completandoDatos: function(){
			return ko.unwrap( this.idEstadoOrden ) == this.estados.CARRO_CONFIRMADO;
		},

		enPortalDePagos: function(){
			return ko.unwrap( this.idEstadoOrden ) == this.estados.INICIANDO_PAGO_ONLINE;
		},

		enPortalDePagosConError: function(){
			return ko.unwrap( this.idEstadoOrden ) == this.estados.PAGO_ONLINE_ERROR;
		},

		esperandoAprobacion: function(){
			return ko.unwrap( this.idEstadoOrden ) == this.estados.ESPERANDO_APROBACION;
		},

		cancelado: function(){
			return ko.unwrap( this.idEstadoOrden ) == this.estados.CANCELADO;
		},

		canceladoPorTimeout: function(){
			return this.cancelado() && ko.unwrap( this.idEstadoMotivo ) ==  2;
		},

		canceladoPorVigencia: function(){
			return this.cancelado() && ko.unwrap( this.idEstadoMotivo ) ==  10;		
		},

		canceladoPorVencimiento: function(){
			return this.canceladoPorTimeout() || this.canceladoPorVigencia();
		},

		////////////////////////
		cantidadTotal: function(){
			var total = 0;
			$.each(this.detalle(), function( index, item ){
				total += item.cantidad();
			});

			return total;
		},

		descripcion: function(){
			var detalle = this.detalle()
				, primerProducto = detalle[0]
				, result = []
				, cantidadRestante;

			if( detalle.length == 0 ) {
				result.push('sin productos');
			} else {			
				result.push([primerProducto.cantidad(), primerProducto.descripcion()].join(' '));
				if( detalle.length > 1 ){
					cantidadRestante = this.cantidadTotal() - primerProducto.cantidad();
					result.push('y ' + cantidadRestante + ' producto' + (cantidadRestante > 1 ? 's': '') + ' ms');
				}
			}

			return result.join(" ");
		},
		
		filtrarDetallesPorTipo: function( tipo ){
			var detalle = this.detalle();
			return ko.utils.arrayFilter( detalle, function( item ){
				return item.tipo() == tipo;
			});
		},

		filtrarDetallesTipoProducto: function(){
			return this.filtrarDetallesPorTipo('PRO');
		},
		
		filtrarDetallesTipoEnvio: function(){
			return this.filtrarDetallesPorTipo('ENV');
		},
		
		filtrarDetallesTipoCupon: function(){
			return this.filtrarDetallesPorTipo('CUP');
		},                
		/////////////////////////////////////////////////////
		cambiarEstadosDeCompra: function(estado){
			var self = this;
			if( self.estadosDeCompra.indexOf(estado) < self.estadosDeCompra.indexOf(self.estadoActualDeCompra()) ) {
				self.estadoActualDeCompra(estado);
			}
		},

		obtenerTotalesPorTipo: function( tipo ){
			var monedas = {};

			$.each(this.detalle(), function(index, item){
				if( !tipo || item.tipo() == tipo ){
					var idMoneda = item.idMoneda();
					var parcial = monedas[idMoneda];
					if(!parcial) {
						monedas[idMoneda] = 0;
						parcial = 0;
					}
					parcial += item.total();
					monedas[idMoneda] = parcial;
				}
			});

			return $.map(monedas, function(value, key){
				return [{
					idMoneda	: key,
					total		: value
				}];
			});
		},
		
		
		obtenerTotalesDeTipoProducto: function(){
			return this.obtenerTotalesPorTipo('PRO');
		},
		
		obtenerTotalesDeTipoEnvio: function(){
			return this.obtenerTotalesPorTipo('ENV');
		},
                
                obtenerTotalesDeTipoCupon: function(){
			return this.obtenerTotalesPorTipo('CUP');
		},

		obtenerCantidadDeTipoProducto: function(){
			var cantidad = 0;
			$.each(this.detalle(), function(index, item){
				if( item.tipo() == 'PRO' ){
					cantidad += item.cantidad();
				}
			});
			return cantidad;
		},
		
		obtenerItemsPorTipo: function( tipo, options ){
			return ko.utils.arrayFilter( this.detalle(), function(item){
				var coincideTipo = ( !tipo || item.tipo() == tipo )
					, coincideOptions = true;
				if( coincideTipo && options) {
					coincideOptions = $.all( options, function( key, value ){
						return ko.unwrap( item[key] ) == ko.unwrap( value );
					});
				}
				return coincideTipo && coincideOptions;
			});
		},
		
                aplicarDescuentosCarritoItem : function( descuento, id ){
                    var self = this;
                    var valorItem = null;
                    this.detalle().forEach( function ( item, i ){
                        if (item.id() == id){
                            var producto = model.data.carrito.detalle()[i];
                            if (producto.descuentos().indexOf(self.formatiarDescuentoItemCarrito(descuento.descuento, descuento.tipo, descuento.formaDePago)) == -1){
                               model.data.carrito.detalle()[i].tieneDescuento( true );
                                model.data.carrito.detalle()[i].precioSinDescuento( descuento.precioSinDescuento * model.data.carrito.detalle()[i].cantidad());
                                model.data.carrito.detalle()[i].precioOriginal( descuento.precioSinDescuento );
                                if (producto.descuentos().length == 0 && descuento.formaDePago[0] == ''){
                                    model.data.carrito.detalle()[i].precio( descuento.precioConDescuento );
                                    model.data.carrito.detalle()[i].modificarCarrito( true );
                                }
                                producto.descuentos.push( self.formatiarDescuentoItemCarrito(descuento.descuento, descuento.tipo, descuento.formaDePago));
                                model.data.carrito.descuentosAplicados.push(descuento);  
                            }
                        }
                    });
                },
                
		obtenerItemsDeTipoProductoEnviable: function(){
			return this.obtenerItemsPorTipo('PRO', {enviable: true});
		},

		obtenerDatosMetodoEnvioNombreCotizacion: function(){
			var result = ''
				, metodoEnvio = ko.unwrap( $.getObjectProperty(this, 'datosMetodoEnvio.metodoEnvio') )
				, cotizacion = ko.unwrap( $.getObjectProperty(this, 'datosMetodoEnvio.cotizacion') );

			if( cotizacion ){
				//result = cotizacion.descripcion();

				if( metodoEnvio && metodoEnvio.tipo() == 'oca' ){
					result = ko.unwrap( $.getObjectProperty( cotizacion, 'dataAdicional.operativa.nombre' ) );
				}
			}

			return result;

		},
                
                ///////////////////////////////////////////////////////////////////////////
                ////////////////////////////// Cupones
        
                buscarDescuentosDisponiblesCarrito : function ( options ){
                    var self = this;
                    options = options || {};
					controller.buscarDescuentosDisponiblesCarrito( options );
					self.gotoTop();
                },

	});

	namespace.Carrito.Item = ko.ViewModel.extend({
		_mappeable:{
			cantidad			: null,
			descripcion			: null,
			id					: null,
			idMoneda			: null, 
			idProducto			: null,
			precio				: null,
                        precioSinDescuento              : null,
                        precioOriginal                  : null,
                        tieneDescuento                  : false,
                        modificarCarrito                : false,
			producto			: null,
                        descuentos                      : [],
		},

		_defaults: {
			quitando: false
		},

		_mapping:{
			cantidad:{
				create: function(options){
					return ko.observable(options.data)
						.extend({toInteger:{'default':0}, toAbs:true})
				}
			},

			producto:{
				create: function(options){
					return tiendasimple.front.ProductoBase.createInstance( options.data );
				}
			}
		},

		init: function(data){
			this._parent.apply(this, arguments);
			//this.cantidad = ko.observable(this.cantidad()).extend({toInteger:{'default':0}});

			this.makeEditable(['cantidad']);
			//console.assert(this.cantidad.beginEdit, 'Cantidad no es editable');
			this._createComputed();		
		},

		destroy: function(){
			delete this.cantidad.nuevoValor;
		},

		_createComputed: function(){
			this.total = ko.computed({
				read: function(){
					return this.precio() * this.cantidad();
				},
				deferEvaluation: true
			}, this);

			this.cantidad.nuevoValor = ko.observable();
			this._addDisposable( this.cantidad.subscribe( function( cantidad ){
				this.cantidad.nuevoValor( cantidad );
			}, this ));
			this.cantidad.notifySubscribers();
		},

		revertCantidad: function(){
			this.cantidad.nuevoValor( this.cantidad() );
		},

		tieneProductoHabilitado: function(){
			return ko.unwrap( this.idProducto ) && this.producto && ko.unwrap( this.producto.id );
		}
	});

	////////////////////////////////////////////////////////////////////////////

	namespace.MetodoEnvio = ko.ViewModel.createSubclass({
		mappeable: {
			id			: '',
			nombre		: '',
			descripcion	: '',
			tipo		: '',
			cotizaciones: []
		},
		
		mapping: {
			cotizaciones: {
				create	: function( options ){
					return new namespace.CotizacionEnvio( options.data );
				}
			}
		}
	}, {
		createInstance: function( data ){
			return new this( data );
		}, 
		prototype: {
			
		}
	});

	namespace.CotizacionEnvio = ko.ViewModel.createSubclass({
		mappeable: {
			id					: '',
			descripcion			: '',
			precios				: [],
			plazoDeEntrega		: null,
			ambito				: null,
			dataAdicional		: {},
			cotizaciones		: []				// una cotizacin puede tener subcotizaciones, ejemplo: sucursales
		},

		defaults: {
			idCotizacionEnvioSeleccionada	: null		// si una cotozacin tiene subcotizaciones, esta es la seleccionada
		},

		mapping: {
			precios: {
				create: function( options ){
					return new namespace.CotizacionEnvio.Precio( options.data );
				}
			},

			cotizaciones: {
				create: function( options ){
					return new namespace.CotizacionEnvio( options.data );
				}
			}
		}
	},{
		prototype: {
			obtenerCotizacionEnvioPorId: function( idCotizacionEnvio ){
				return ko.utils.arrayFirst( this.cotizaciones(), function( cotizacionEnvio ){
					return cotizacionEnvio.id() == idCotizacionEnvio;
				});
			},

			obtenerCotizacionEnvioSeleccionada: function(){
				if( this.cotizaciones().length > 0 ){
					return this.obtenerCotizacionEnvioPorId( this.idCotizacionEnvioSeleccionada() ) || this.cotizaciones()[0];
				} else return this;
			},

			tienePrecio: function(){
				var total = 0;
				$.each( this.precios(), function( index, precio ){
					total += precio.importe();
				});

				return total>0;
			}

		}
	});

	namespace.CotizacionEnvio.Precio = ko.ViewModel.createSubclass({
		mappeable: {
			idMoneda	: null,
			importe		: null
		}
	});
})($.namespace('tiendasimple.front'));


/* /js/front/fronttienda_model_categoria.js
 * compresion time: 0.02289 -(ms)
 * ---------------------------------------- */
$.namespace('tiendasimple.front');

tiendasimple.front.Categoria = ko.ViewModel.extend({
	_mappeable: {
		id						: null,
		pathCategoria			: null,
		pathCategoriaDesc		: null,
		cantidadSubcategorias	: 0,
		cantidadProductos		: null,
		traducciones			: []
	},
	
	_mapping:{
		traducciones: {
			create: function(options){
				return new tiendasimple.front.Categoria.Traduccion(options.data);
			}
		}
	},
	
	init: function(data){
		this._parent.apply(this, arguments);
		this._createComputed();
	},
	
	_createComputed: function(){
		this.traduccion = ko.computed(function(){
			return this.traducciones()[0];
		}, this);
		
		this.descripcion = ko.computed(function(){
			return this.traduccion() && this.traduccion().descripcion();
		}, this);
	}
});


tiendasimple.front.Categoria.Traduccion = tiendasimple.Traduccion.extend({
	init: function(data){
		this._parent.apply(this, arguments);
	},
	
	_setMappeable: function(){
		this._parent.apply(this, arguments);
		this._mergeMappeable({
			descripcion			: null,
			descripcionCorta	: null,
			descripcionLarga	: null
		})
	}
});


/* /js/back/backtienda_model_productos.js
 * compresion time: 0.03815 -(ms)
 * -------------------------------------- */
$.namespace('tiendasimple.back');

//ko.validation.disabled = true;


tiendasimple.back.ProductoBase = ko.ViewModel.createSubclass({
	mappeable: {
		id					: null,
		codigo				: null,
		habilitado			: true,
		precio				: null,
		precioSinDescuento	: null,
		stock				: 0,
		stockInicial		: null, // es el valor de stock que tena este producto cuando comenz la edicin. Si se modific, significa que pudo haber
									// una compra, y por lo tanto se actualiza el stock y se permite que el vendedor lo vuelva a modificar

		idYoutube			: null,
		imagenes			: []
	},

	defaults: {
		openModal: false,
		imagenActualIndex: 0,

		imagenesConErrores  : [],
		ajaxError           : null
	},

	mapping: {
		imagenes: {
			create: function (options) {
				return new tiendasimple.back.Producto.Imagen(options.data);
			},

			key: function( imagen ){
				return ko.unwrap( imagen.id ) || ko.unwrap( imagen.nombre )
			}
		}
	}
}, {

	createInstance: function( data ){
		var theClass = tiendasimple.back.Producto;
		if( data && data.idPadre ){
			theClass = tiendasimple.back.Producto.Opcion;
		}
		return new theClass( data );

	},

	obtenerHashDeAtributos: function( atributos ){
		return ko.utils.arrayMap( atributos, function( atributo ) {
			return [ ko.unwrap( atributo.id ), ko.unwrap( atributo.valor.id )].join('-')
		} ).join('|');
	},

	prototype: {
		init: function( data ){
			this._parent.apply( this, arguments );
			if( data && 'stock' in data ) this.setearStockInicial();

		},

		_createComputed: function(){
			// PRECIO //
			this.precio.formateado = this.precio.extend({formatMoney: true });
			this.precioSinDescuento.formateado = this.precioSinDescuento.extend({formatMoney: true });

			this.imagenes.vacia = new tiendasimple.back.Producto.Imagen();
			this.imagenes.principal = ko.computed(function(){
				return $.findInCollection(this.imagenes(), function(imagen){
					return imagen.principal();
				});
			}, this);

			this.imagenes.principal.uid = (function(){
				var uid = ko.observable();
				return ko.computed({
					read: function(){
						var imagen = $.findInCollection(this.imagenes(), function(imagen){
							return imagen.principal() && imagen.principal();
						});
						return imagen && imagen.uid();
					},

					write: function(value){
						uid(value);
						$.each(this.imagenes(), function(index, imagen){
							imagen.principal( value && imagen.uid() == value );
						});
					}
				}, this);
			}.bind(this))();

			this._addDisposable(
				this.imagenes.ordenadas = ko.computed( function(){
					var imagenPrincipal = this.imagenes.principal()
						, result = this.imagenes();

					if( imagenPrincipal ){
						ko.utils.arrayRemoveItem( result, imagenPrincipal );
						result.unshift( imagenPrincipal );
					}
					return result;
				}, this, { deferEvaluation : true } )
			);

			this._addDisposable(
				this.imagenes.subscribe( function( imagenes ){
					if( !this.imagenes.principal() ){
						var primerImagen = this.imagenes()[0];
						if( primerImagen ){
							primerImagen.principal( true );
						}
					}
				}, this )
			)

		},

		puedeEditarMoneda: function(){
			return true;
		},

		obtenerPrecioMinimo: function(){
			return this.precio();
		},

		obtenerPrecioMinimoSinDescuento: function(){
			return this.precioSinDescuento();
		},

		obtenerPrecioMaximo: function(){
			return this.precio();
		},

		obtenerPrecioMaximoSinDescuento: function(){
			return this.precioSinDescuento();
		},

		tieneVariosPrecios: function(){
			return false;
		},

		tieneDescuento: function(){
			var precioMinimo = this.obtenerPrecioMinimo()
				, precioMinimoSinDescuento = this.obtenerPrecioMinimoSinDescuento();

			return precioMinimo && precioMinimoSinDescuento && precioMinimo != precioMinimoSinDescuento;
		},

		tienePrecio: function(){
			return this.obtenerPrecioMinimo() > 0;
		},

		setearStockInicial: function(){
			this.stockInicial ( this.stock() );
		},

		establecerStock: function( stock ){
			this.stock( stock );
			this.setearStockInicial();
		},

		///////////// imagenes
		tieneImagenes: function(){
			return this.imagenes().length > 0;
		},

		obtenerImagenPorId: function( id ){
			return ko.utils.arrayFirst( this.imagenes(), function( imagen ){
				return imagen.id() == id;
			});
		},

		obtenerImagenPorIdONombre: function( data ){
			var id = ko.unwrap( data.id )
				, nombre = ko.unwrap( data.nombre )
				, buscarPorId = !!id;

			return ko.utils.arrayFirst( this.imagenes(), function( imagen ){
				return buscarPorId ? ( imagen.id() == id ) : ( imagen.nombre() == nombre );
			});
		},

		quitarImagenPorIdONombre: function( data ){
			var imagen = this.obtenerImagenPorIdONombre( data );
			if( imagen ){
				this.imagenes.remove( imagen );
			}
		},

		agregarImagenPorIdONombre: function( data ){
			var imagen = this.obtenerImagenPorIdONombre( data );
			if( !imagen ){
				this.imagenes.push( data.clone() );
			}
		},

		quitarOAgregarImagenPorIdONombre: function( data ){
			var imagen = this.obtenerImagenPorIdONombre( data );
			if( imagen ){
				this.quitarImagenPorIdONombre( data );
			} else {
				this.agregarImagenPorIdONombre( data );
			}
		},

		eliminarImagen: function(imagen){
			var imagen = this.obtenerImagenPorIdONombre( imagen );
			this.imagenes.remove( imagen );
		},

		agregarImagenURL: function(url){
			var imagen = this._mapping.imagenes.create({data:{
				path	: url,
				nombre	: url
			}});
			this.imagenes.push(imagen);
			return imagen;
		},

		_onFileUpload: function(data){
			var self = this
				, error = $.getObjectProperty(data, 'error') || $.getObjectProperty(data, 'result.error')
				, nombreImagen = data.files[0].name
				, result = [];

			if(error){
				self.imagenesConErrores.push({
					mensaje: error.data.message,
					nombre: nombreImagen
				})
			} else{
				this.fileUpload.error([]);
				var imagenes = $.toArray(data.result.result || []);
				$.each( imagenes, function(index, data){
					if(data.error){
					} else {
						var imagen  = new tiendasimple.back.Producto.Imagen( {nombre:data.name} );
						self.imagenes.push(imagen);
						result.push( imagen );
					}
				});
			}

			return result;

		},

		_onFileAdd: function(data){
			var self = this
				, fileCount = data.originalFiles.length
				, maxFiles = self.fileUpload.options.maxFiles;

			this.fileUpload.error([]);
			this.imagenesConErrores([]);

			if (fileCount > maxFiles) {
				this.fileUpload.error.push({
					mensaje: i18n.kot('back:imagenes.upload.error.backimagenes_upload_error_la_cantidad_maxima_de_imagenes_a_subir_simultaneamente_es_n', {maxFiles: maxFiles}),
					nombre: "Error"
				});
			}
		},

		_createBlueImpFileUpload: function(){
			var self = this;
			this.fileUpload = {
				draggingOver: ko.observable(false),
				progressall	: ko.observable(0),
				enable		: ko.observable(true),
				files		: ko.observableArray(),
				cancel		: function(data){
					this.files.remove(data);
				},
				error       : ko.observableArray(),
				done		: self._onFileUpload.bind(self),
				add         : self._onFileAdd.bind(self),
				options: {
					url             : 'productos/subirimagentemporal/?typeimg=catalog',
					dataType        : 'json',
					maxFileSize     : 8000000,
					acceptFileTypes : /(\.|\/)(gif|jpe?g|png)$/i,
					maxFiles        : 5,
					process: [
						{
							action: 'load',
							fileTypes: /^image\/(gif|jpeg|png)$/,
							maxFileSize: 8000000 // 8MB
						}
					]
				}

			};
			this.fileUpload.files.subscribe(function( imagen ){
				if( this.fileUpload.files().length == 0 ){
					this.fileUpload.error( self.imagenesConErrores() );
				}
			}, this);
		},

		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		getUrl: function(){
			return $.hashbang.get({catalogo:'productos', pagina: 0}, {'id': this.id()});
		}
	}


});


tiendasimple.back.Producto = tiendasimple.back.ProductoBase.createSubclass({
	mappeable: {
		stockMinimo			: null,
		unidadesVenta		: null, // valores posibles: {min:3, max: 10, step: 2}  [1,3,4,7,10] // mximos valores 500
		idMoneda			: null,
		traducciones		: [],
		categorias			: [],
		ordenEnListado		: null,

		stockActivado									: false,
		stockMostrarInexistentesEnCatalogo				: false,
		stockValidarExistencia							: false,
		stockMostrarEnProducto							: false,
		stockTipoDeCalculo								: 'enCheckout',
		stockConfiguracionPersonalizada					: false,

		enviable                : false,
		pesoUnidad              : 'gr',
		pesoValor               : null,
		dimensionUnidad         : 'cm',
		dimensionAlto           : null,
		dimensionAncho          : null,
		dimensionProfundidad    : null,

		opciones				: []
	},
	
	defaults: {
		seleccionado		: false,
		expandido			: false,
		guardando			: false,
		eliminando			: false,
		clonando			: false,
		obteniendoDatos		: false,
		tabActivo			: '',

		dimensionUnidades   : [
			{ unidad: 'mm', text: 'Milmetros'	, multiplicador: '10' },
			{ unidad: 'cm', text: 'Centmetros'	, multiplicador: '1' },
			{ unidad: 'm',  text: 'Metros'		, multiplicador: '0.01' },
			{ unidad: 'in', text: 'Inches'		, multiplicador: '2.54' }
		],

		mostrarPrecioAuto		: false,
		mostrarStockAuto		: false,

		opcionesCargado			: true,
		opcionesCantidad		: 0,

		opcionIluminadaIndex	: 0
	},

	mapping: {
		
		categorias: {
			create: function(options){
				return new tiendasimple.back.Categoria(options.data);
			},
			key: function(item){
				return ko.utils.unwrapObservable(item.id);
			}
		},
				
		traducciones: {
			create: function(options){
				return new tiendasimple.back.Producto.Traduccion(options.data);
			}
		},
		
		imagenes: {
			create: function(options){
				return new tiendasimple.back.Producto.Imagen(options.data);
			}
		},

		opciones: {
			create: function( options ){
				var opcion = new tiendasimple.back.Producto.Opcion(options.data, options.parent );
				//setTimeout( function(){ opcion.productoPadre( options.parent ); }, 0 );
				return opcion;
			},

			key: function ( data ){
				return ko.unwrap( data.id );
			}
		}
	}
	
}, {
	cantMaximaOpciones: 100,

	prototype: {
		init: function(data){
			
			var self = this;
			
			this._parent(data);

			this.uid = ko.observable(Math.round(Math.random()*999999999999));
			this.makeEditable($.map(this._mappeable, function(value,key){return key}));
			this.stockConfiguracionPersonalizada.extend({booleanValue: true});

			this._createComputed();
			this._createValidations();	

			this._applySubscriptions();

            this._createBlueImpFileUpload();

			this.tabActivo( this.determinarTabActivoPorDefecto() );
			
			if (data){
				//this._crearAtributoScopeLocal( data.opcionesAtributos );
			}
		},

		_createValidations: function(){
			var self = this;
			if(ko.validation.disabled) return;

			this.precio.extend({
				number: true,
				min: 0
				//'accounting.money'	: true
			});

			this.pesoValor.extend({
				number: true,
				min: 0
			});

			this.dimensionAlto.extend({
				number: true,
				min: 0
			});

			this.dimensionAncho.extend({
				number: true,
				min: 0
			});

			this.dimensionProfundidad.extend({
				number: true,
				min: 0
			});

			this.traducciones.extend({
				validChildren: true
			});
			
			this.stock.extend({
				required	: {
					onlyIf: function(){
						return self.stockActivado();
					}
				},

				integer		: {
					onlyIf	: function(){
						return self.stockActivado();
					}
				}
			});

			this.validaciones = {
				datosPrincipales: ko.validatedObservable({
					traducciones	: this.traducciones,				
					precio			: this.precio
				}),
				
				stock			: ko.validatedObservable({
					stock		: this.stock
				}),

				envio           : ko.validatedObservable({
					pesoValor               : this.pesoValor,
					dimensionAlto           : this.dimensionAlto,
					dimensionAncho          : this.dimensionAncho,
					dimensionProfundidad    : this.dimensionProfundidad
				}),
				
				unidadesVenta: ko.validatedObservable({
					unidVentaRangoStart: this.unidadesVentaRango && this.unidadesVentaRango.start,
					unidVentaRangoEnd: this.unidadesVentaRango && this.unidadesVentaRango.end,
					unidVentaRangoStep: this.unidadesVentaRango && this.unidadesVentaRango.step				
				})

			};
			

			this._parent();

		},

		toggleExpandido: function(){
			this.expandido(!this.expandido());
		},

		_createComputed: function(){
			this._parent.apply( this, arguments );

			this.deshabilitado = this.habilitado.extend({not:true});
                        
			this.descripcionVacia = ko.computed(function(){
				var result = []
					, texto = this.id() ? 'back:secciones.catalogo.productos.producto_sin_nombre_id' : 'back:secciones.catalogo.productos.producto_sin_nombre_nuevo';
					
				result.push ('<' + i18n.kot( texto, {id: this.id()} ) + '>');
				return result.join(' ');
			}, this);

			this.procesando = ko.computed(function(){
				return this.guardando() || this.eliminando() || this.clonando();
			}, this);

			////////////////////////////////////////////////////////////////////////

			this.puedeGuardar = ko.computed(function(){
				var hasChanges	= this.hasChanges();
				var procesando	= this.procesando();
				var isValid	= true; // this.isValid();
				return hasChanges && !procesando && isValid;
			}, this);

			////////////////////////////////////////////////////////////////////////

			this.imagenes.youtube = new tiendasimple.back.Producto.Imagen();

			ko.computed(function(){
				this.imagenes.youtube.path('https://i.ytimg.com/vi/' + this.idYoutube() + '/mqdefault.jpg' );
			}, this);

			this.imagenes.representativa = ko.computed(function(){
				var imagen = this.imagenes.principal() || this.imagenes()[0];
				if(!imagen && this.idYoutube()) imagen = this.imagenes.youtube;
				if(!imagen){
					imagen = this.opcionesObtenerImagenes()[0];
				}
				if(!imagen) imagen = this.imagenes.vacia;
				return  imagen;
			}, this);


			///////////////////////////////////////////////////////

			var cantidadPrincipales = 1;

			this.categorias.principales = ko.computed(function(){
				return this.categorias().slice(0,cantidadPrincipales);
			}, this);

			this.categorias.restantes = ko.computed(function(){
				return this.categorias().slice(cantidadPrincipales);
			}, this);

			this.categorias.ids = ko.observable();
			this.categorias.ids.subscribe(function(newVal){
				if(this.___updating) return;

				var ids = newVal;
				var categoriasLegacy = $.findAllInCollection(model.data.arbolCategorias.legacy() || [], function(categoriaLegacy){return $.inArray( categoriaLegacy.id, ids)!=-1 });
				var categorias = $.map(categoriasLegacy, function(categoriaLegacy){
					return new tiendasimple.back.Categoria({id: categoriaLegacy.id, descripcion: categoriaLegacy.text});
				});

				var idsOriginal = $.pluckCollection(this.categorias(), 'id');
				var idsNuevos = $.pluckCollection(categorias, 'id') ;

				var iguales = ko.toJSON(idsOriginal) == ko.toJSON(idsNuevos);
				if(!iguales) {
					this.___updating = true;
					this.categorias(categorias);
					delete this.___updating;
				}

			}, this);

			this.categorias.subscribe(function(newVal){
				if(this.___updating) return;

				var ids = $.map(newVal, function(categoria){
					return categoria.id();
				});

				this.___updating = true;
				this.categorias.ids(ids);
				delete this.___updating;
			}, this);

			this.categorias(this.categorias());

			/*
			var _data = ko.observable();
			this.categorias.data = ko.computed({
				read: function(){
					return $.map(this.categorias(), function(categoria){
						return {id: categoria.id(), text: categoria.descripcion()}
					});
				},

				write: function(value){
					if(this.____writingData) return;
					this.____writingData = true;

					var categorias = [];
					$.each($.toArray(value), function(key, categoria){
						if($.isNumeric(categoria.id)) categorias.push(new tiendasimple.back.Categoria({id: categoria.id, descripcion: categoria.text}));
					});
					var idsOriginal = $.pluckCollection(this.categorias(), 'id');
					var idsNuevos = $.pluckCollection(categorias, 'id') ;

					var iguales = ko.toJSON(idsOriginal) == ko.toJSON(idsNuevos);
					if(!iguales) {
						console.log('categorias.data', categorias)
						this.categorias(categorias);
					}
					delete this.____writingData;
				}
			}, this);
			*/

			////////////////////////////////////////////////////////////////////////
			// STOCK //

			////////////////////////////////////////////////////////////////////////
			// UNIDADES DE VENTA //				

			this.unidadesVentaTipo = ko.observable( 'rango' ); // rango | personalizado
			this.unidadesVentaPersonalizado = ko.observable();

			this.unidadesVentaRango = function(){
				var rango = ko.observableRange(1,10,1);

				rango.start.extend({min:1, number:true});
				rango.end.extend({min:1, number:true});
				rango.step.extend({min:1, number:true});

				rango.group = ko.validation.group([rango.start, rango.end, rango.step]);

				return rango;
			}();

			////////////////////////////////////////////////////////////////////////
			var toJS = function(str){
				var result;
				try{
					result = $.parseJSON(str);
				} catch(e){
					result = str.split(/[;\s,]+/ig);
				}
				return result;
			};
			var tipoDetectado = function(str){
				var js = toJS(str),
					result = 'error';
				if(js){
					if($.isArray(js)) result = 'personalizado';
					else if(js.start && js.end) result = 'rango';
				}
				return result;
			};
			var valorPersonalizadoToArray = function(str){
				var result = $.toArray(toJS(str));

				result = $.map(result || [], function(value){
					var toInt = parseInt(value);
					return isNaN(toInt) ? null : toInt;
				});

				result = $.arrayExclude(result || [], ["", undefined, null]);
				return result;
			};

			this.unidadesVenta.toJS = ko.computed(function(){
				var result;
				try{
					result = $.parseJSON(this.unidadesVenta());
				} catch(e){
					result = this.unidadesVenta().split(/[;\s,]+/ig);
				}
				return result;
			}, this);

			this.unidadesVenta.tipoDetectado = ko.computed(function(){
				return tipoDetectado(this.unidadesVenta());
			}, this);

			////////////////////////////////////////////////////////////////////////

			this.unidadesVenta.tipoDetectado.subscribe(function(tipo){
				if(tipo!='error' && this.unidadesVentaTipo() != tipo ) this.unidadesVentaTipo(tipo);
			}, this);

			////////////////////////////////////////////////////////////////////////

			var unidadesVentaPersonalizadoJS = ko.computed(function(){
				return valorPersonalizadoToArray(this.unidadesVentaPersonalizado());
			}, this);

			this.unidadesVentaPersonalizado.toJS = ko.observable();
			var _oldunidadesVentaPersonalizadoJS;
			unidadesVentaPersonalizadoJS.subscribe(function(value){
				var valueJSON = $.toJSON(value);
				if(  valueJSON != _oldunidadesVentaPersonalizadoJS ) {
					this.unidadesVentaPersonalizado.toJS(value);
					_oldunidadesVentaPersonalizadoJS  = valueJSON;
				}
			}, this);

			this.unidadesVentaPersonalizado.toJSON = ko.computed(function(){
				return $.toJSON(this.unidadesVentaPersonalizado.toJS());
			}, this);

			////////////////////////////////////////////////////////////////////////

			this.unidadesVenta.valores = ko.computed(function(){
				if(!this.inTransaction()) return; // no computar si no est en modo edicin.
				var tipo = this.unidadesVentaTipo();
				if(tipo == 'rango') return this.unidadesVentaRango();
				else if(tipo == 'personalizado') return this.unidadesVentaPersonalizado.toJS();
				else return [];
			}, this);

			////////////////////////////////////////////////////////////////////////

			ko.computed(function(){ // si cambia unidadesVentaTipo  cambian los valores de los inputs, se graba el resultado en unidadesVenta
				if(!this.inTransaction()) return; // no computar si no est en modo edicin.
				var tipo = this.unidadesVentaTipo(),
					jsonValue;
				if(tipo == 'rango' && !this.unidadesVentaRango.hasErrors()) jsonValue = this.unidadesVentaRango.toJSON();
				else if(tipo == 'personalizado') jsonValue = this.unidadesVentaPersonalizado.toJSON();

				if(jsonValue) this.unidadesVenta(jsonValue);
			}, this);

			this.unidadesVenta.subscribe(function(value){
				var tipoDetectadoValue = tipoDetectado(value);
				var unidadesVentaJS = toJS(value);
				//console.debug('cambi unidadesVenta', value, unidadesVentaJS, tipoDetectadoValue);
				if(tipoDetectadoValue == 'personalizado'){
					var theValue = $.isArray( unidadesVentaJS ) ? unidadesVentaJS.join(', ') : value;
					if(theValue != this.unidadesVentaPersonalizado.toJSON()) this.unidadesVentaPersonalizado( theValue );
				} else if(tipoDetectadoValue == 'rango'){
					if(this.unidadesVentaRango.toJSON() != value){
						//console.debug('unidadesVentaJS', unidadesVentaJS, this.unidadesVentaRango.toJSON(), value);
						this.unidadesVentaRango.start(unidadesVentaJS.start);
						this.unidadesVentaRango.end(unidadesVentaJS.end);
						this.unidadesVentaRango.step(unidadesVentaJS.step);					
					}
				}
			}, this);

			this.unidadesVenta.notifySubscribers(this.unidadesVenta());

			/////////////////////////// PESO Y DIMENSIONES ///////////////////////////////////

			this.pesoValor.formateado = ko.computed({
				read: function(){
					var pesoValor = this.pesoValor();

					if( pesoValor !== null ){
						pesoValor = accounting.formatMoney(this.pesoValor(), '', 2);
					}

					return pesoValor;
				},
				write: function(value){
					var decimal = accounting.settings.currency.decimal
						, numero;

					if(value == null || value=='') {
						numero = null;
					} else {
						if(String(value).indexOf(decimal) == -1) value = String(value).replace(/\./ig, decimal);
						numero = accounting.unformat(value||0, decimal);
					}
					this.pesoValor(numero);
				}
			}, this);

			this.dimensionAlto.formateado = ko.computed({
				read: function(){
					var dimensionAlto = this.dimensionAlto();

					if( dimensionAlto !== null ){
						dimensionAlto = accounting.formatMoney(this.dimensionAlto(), '', 2);
					}

					return dimensionAlto;
				},
				write: function(value){
					var decimal = accounting.settings.currency.decimal
						, numero;

					if(value == null || value=='') {
						numero = null;
					} else {
						if(String(value).indexOf(decimal) == -1) value = String(value).replace(/\./ig, decimal);
						numero = accounting.unformat(value||0, decimal);
					}
					this.dimensionAlto(numero);
				}
			}, this);

			this.dimensionAncho.formateado = ko.computed({
				read: function(){
					var dimensionAncho = this.dimensionAncho();

					if( dimensionAncho !== null ){
						dimensionAncho = accounting.formatMoney(this.dimensionAncho(), '', 2);
					}

					return dimensionAncho;
				},
				write: function(value){
					var decimal = accounting.settings.currency.decimal
						, numero;

					if(value == null || value=='') {
						numero = null;
					} else {
						if(String(value).indexOf(decimal) == -1) value = String(value).replace(/\./ig, decimal);
						numero = accounting.unformat(value||0, decimal);
					}
					this.dimensionAncho(numero);
				}
			}, this);

			this.dimensionProfundidad.formateado = ko.computed({
				read: function(){
					var dimensionProfundidad = this.dimensionProfundidad();

					if( dimensionProfundidad !== null ){
						dimensionProfundidad = accounting.formatMoney(this.dimensionProfundidad(), '', 2);
					}

					return dimensionProfundidad;
				},
				write: function(value){
					var decimal = accounting.settings.currency.decimal
						, numero;

					if(value == null || value=='') {
						numero = null;
					} else {
						if(String(value).indexOf(decimal) == -1) value = String(value).replace(/\./ig, decimal);
						numero = accounting.unformat(value||0, decimal);
					}
					this.dimensionProfundidad(numero);
				}
			}, this);

			this._createComputedBox3D();

			this.volumen = ko.computed( function(){
				var profundidad = this.dimensionProfundidad()
					, ancho = this.dimensionAncho()
					, alto = this.dimensionAlto()
					, result = 0;

				if( ancho > 0 && alto > 0 && profundidad > 0 ){
					result = ancho * alto * profundidad;
				}

				return result;
			}, this, {deferEvaluation: true} );

			this.volumen.formateado = ko.computed( function(){
				var volumen = this.volumen();

				if( volumen !== null ){
					volumen = accounting.formatMoney( volumen, '', 2 );
				}

				return volumen;
			}, this, {deferEvaluation: true} );
		},

		_createComputedBox3D: function(){
			this.styleCara1 = ko.computed(function(){
				var result = []
					, width = this.obtenerProporcionCaraCubo( this.dimensionProfundidad() )
					, height = this.obtenerProporcionCaraCubo( this.dimensionAncho() )
					, transform = parseInt( this.obtenerProporcionCaraCubo( this.dimensionAlto() ) / 2 );

				result.push('width: ' + width + 'px');
				result.push('height: ' + height + 'px');
				result.push('transform: translateZ(' + transform + 'px)');
				result.push('-webkit-transform: translateZ(' + transform + 'px)');
				result.push('-moz-transform: translateZ(' + transform + 'px)');
				result.push('-o-transform: translateZ(' + transform + 'px)');
				result.push('-ms-transform: translateZ(' + transform + 'px)');
				return result.join(';');
			}, this);

			this.styleCara2 = ko.computed(function(){
				var result = []
					, width = this.obtenerProporcionCaraCubo( this.dimensionAlto() )
					, height = this.obtenerProporcionCaraCubo( this.dimensionAncho() )
					, transform = this.obtenerProporcionCaraCubo( this.dimensionProfundidad() ) - parseInt( width / 2 );

				result.push('width: ' + width + 'px');
				result.push('height: ' + height + 'px');
				result.push('transform: rotateY(90deg) translateZ(' + transform + 'px)');
				result.push('-webkit-transform: rotateY(90deg) translateZ(' + transform + 'px)');
				result.push('-moz-transform: rotateY(90deg) translateZ(' + transform + 'px)');
				result.push('-o-transform: rotateY(90deg) translateZ(' + transform + 'px)');
				result.push('-ms-transform: rotateY(90deg) translateZ(' + transform + 'px)');
				return result.join(';');
			}, this);

			this.styleCara3 = ko.computed(function(){
				var result = []
					, width = this.obtenerProporcionCaraCubo( this.dimensionProfundidad() )
					, height = this.obtenerProporcionCaraCubo( this.dimensionAncho() )
					, transform = parseInt( this.obtenerProporcionCaraCubo( this.dimensionAlto() ) / 2 );

				result.push('width: ' + width + 'px');
				result.push('height: ' + height + 'px');
				result.push('transform: rotateY(180deg) translateZ(' + transform + 'px)');
				result.push('-webkit-transform: rotateY(180deg) translateZ(' + transform + 'px)');
				result.push('-moz-transform: rotateY(180deg) translateZ(' + transform + 'px)');
				result.push('-o-transform: rotateY(180deg) translateZ(' + transform + 'px)');
				result.push('-ms-transform: rotateY(180deg) translateZ(' + transform + 'px)');
				return result.join(';');
			}, this);

			this.styleCara4 = ko.computed(function(){
				var result = []
					, width = this.obtenerProporcionCaraCubo( this.dimensionAlto() )
					, height = this.obtenerProporcionCaraCubo( this.dimensionAncho() )
					, transform = parseInt( width / 2 );

				result.push('width: ' + width + 'px');
				result.push('height: ' + height + 'px');
				result.push('transform: rotateY(-90deg) translateZ(' + transform + 'px)');
				result.push('-webkit-transform: rotateY(-90deg) translateZ(' + transform + 'px)');
				result.push('-moz-transform: rotateY(-90deg) translateZ(' + transform + 'px)');
				result.push('-o-transform: rotateY(-90deg) translateZ(' + transform + 'px)');
				result.push('-ms-transform: rotateY(-90deg) translateZ(' + transform + 'px)');
				return result.join(';');
			}, this);

			this.styleCara5 = ko.computed(function(){
				var result = []
					, width = this.obtenerProporcionCaraCubo( this.dimensionProfundidad() )
					, height = this.obtenerProporcionCaraCubo( this.dimensionAlto() )
					, transform = parseInt( ( this.obtenerProporcionCaraCubo( this.dimensionAncho() ) * 2 -  height ) / 2 );

				result.push('width: ' + width + 'px');
				result.push('height: ' + height + 'px');
				result.push('transform: rotateX(-90deg) translateZ(' + transform + 'px)');
				result.push('-webkit-transform: rotateX(-90deg) translateZ(' + transform + 'px)');
				result.push('-moz-transform: rotateX(-90deg) translateZ(' + transform + 'px)');
				result.push('-o-transform: rotateX(-90deg) translateZ(' + transform + 'px)');
				result.push('-ms-transform: rotateX(-90deg) translateZ(' + transform + 'px)');
				return result.join(';');
			}, this);

			this.styleCara6 = ko.computed(function(){
				var result = []
					, width = this.obtenerProporcionCaraCubo( this.dimensionProfundidad() )
					, height = this.obtenerProporcionCaraCubo( this.dimensionAlto() )
					, transform = parseInt( height / 2 );

				result.push('width: ' + width + 'px');
				result.push('height: ' + height + 'px');
				result.push('transform: rotateX(90deg) translateZ(' + transform + 'px)');
				result.push('-webkit-transform: rotateX(90deg) translateZ(' + transform + 'px)');
				result.push('-moz-transform: rotateX(90deg) translateZ(' + transform + 'px)');
				result.push('-o-transform: rotateX(90deg) translateZ(' + transform + 'px)');
				result.push('-ms-transform: rotateX(90deg) translateZ(' + transform + 'px)');
				return result.join(';');
			}, this);

		},

		_applySubscriptions: function(){
			this.idYoutube.subscribe(function(newValue){
				var id = $.string.getIdFromYoutubeURL(newValue);
				if(id) this.idYoutube(id);
			}, this);


			ko.computed(function(){
				var data = this.imagenes();
				var self = this;
				data && $.each(data, function(index, imagen){
					imagen.producto = self;
				});			
			}, this);

		},

		traduccion: function(iso){
			if(!iso) return;
			return $.findInCollection(this.traducciones(), function(traduccion){
				return traduccion.iso() == iso;
			});
		},

		////////////////////////////////////////////////////////////////////////////

		eliminarImagen: function( imagen ){
			this._parent.apply( this, arguments );
			this.opcionesEliminarImagen( imagen );
		},

		quitarCategoria: function(categoria){
			this.categorias.remove(this.obtenerCategoriaPorId(categoria.id()));
		},

		obtenerCategoriaPorId: function(id){
			return $.findInCollection(this.categorias(), function(categoria){
				return categoria.id() == id
			});
		},

		agregarCategoria: function(categoria){
			if(!this.tieneCategoria(categoria)) this.categorias.push(categoria);
		},

		toggleAgregarCategoria: function(categoria, event){
			if(this.tieneCategoria(categoria)){
				this.quitarCategoria(categoria)
			} else this.agregarCategoria(categoria);
			setTimeout(function(){
				this.categorias.notifySubscribers();
			}.bind(this),1);
		},

		tieneCategoria: function(categoriaBuscada){
			return !! this.obtenerCategoriaPorId(categoriaBuscada.id());
		},
				
		determinarTabActivoPorDefecto: function(){
			var stockActivado = ko.unwrap( this.stockActivado )
				, precio = ko.unwrap( this.precio )
				, tieneOpciones = this.tieneOpciones()
				, tab = 'textos';
				
			if( stockActivado || $.isNumeric( precio ) || tieneOpciones ){
				tab = 'stock';
			}
			
			return tab;
		},
				
		mostrarTabStock: function(){
			this.tabActivo( 'stock' );
		},

		obtenerProporcionCaraCubo: function( valor ){
			var alto = parseInt( this.dimensionAlto() )
				, ancho = parseInt(this.dimensionAncho() )
				, profundidad = parseInt(this.dimensionProfundidad() )
				, dimensiones = [ancho, alto, profundidad]
				, valorSeleccionado = parseInt( valor )
				, valorMaximo
				, result = null
				, valorExiste = false;

			valorExiste = ko.utils.arrayFirst(dimensiones,function(item){
				if( valorSeleccionado == item ) return true;
			});

			if(valorExiste){
				valorMaximo = ko.utils.arrayFirst(dimensiones,function(item){
					return item === Math.max.apply(null,ko.utils.arrayMap(dimensiones,function(item){
						return item;
					}));
				});
				result = parseInt( (valorSeleccionado / valorMaximo) * 150 );
			}

			return result;
		},

		////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		puedeEditarMoneda: function() {
			return true;
		},

		setearStockInicial: function(){
			this._parent();
			if( this.tieneOpciones() ){
				$.each( this.opciones(), function( index, opcion ){
					opcion.setearStockInicial();
				})
			}
		},

		////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		tieneOpciones: function() {
			return this.opcionesObtenerCantidad() > 0;
		},

		opcionesObtenerCantidad: function(){
			var result = false;

			if( this.opcionesCargado() ){
				result = this.opciones().length;
			} else {
				result = this.opcionesCantidadTotal();
			}
			return result;
		},

		opcionesObtenerCantidadHabilitados: function(){

			var result = false;

			if( this.opcionesCargado() ){
				result = this.opcionesObtenerHabilitados().length;
			} else {
				result = this.opcionesCantidad();
			}
			return result;
		},

		opcionesEstanTodasHabilitadas: function(){
			return this.opcionesObtenerCantidad() == this.opcionesObtenerCantidadHabilitados();
		},

		opcionesObtenerHabilitados: function(){
			var count = 0
				, opcionesHabilitadas;

			opcionesHabilitadas = ko.utils.arrayFilter( this.opciones(), function( opcion ){
				return ko.unwrap( opcion.habilitado );
			});

			return opcionesHabilitadas;
		},


		
		opcionesAtributosObtenerIds: function(){
			var result = [];
			if( this.tieneOpciones() ){
				var atributos = [];
				if( this.opcionesCargado() ){
					var primerOpcion = this.opciones()[0];
					if( primerOpcion ){
						atributos = $.extend([], primerOpcion.atributos());
						atributos.sort($.createSortFN(['orden']));
					}
				} else {
					atributos = this.opcionesAtributos();
				}
				result = $.pluckCollection( atributos, 'id' );
			}
			return result;
		},

		opcionesAtributosTieneId: function( idAtributo ){
			var result = false;
			if( this.tieneOpciones()) {
				result = !!ko.utils.arrayFirst( this.opciones()[0].atributos(), function( atributo ){
					return atributo.id() == idAtributo;
				});
			}
			return result;
		},

		opcionesAtributosObtener: function(){
			var result = []
				, hashAtributos = {};
			$.each( this.opciones(), function( index, opcion ){
				$.each( opcion.atributos(), function( index2, atributo ){
					hashAtributos[ atributo.id() ] = hashAtributos[ atributo.id() ] || new tiendasimple.back.Atributo( atributo.toJS() );
					var nuevoAtributo = hashAtributos[ atributo.id() ];
					nuevoAtributo.__hashValores = nuevoAtributo.__hashValores || {};
					nuevoAtributo.__hashValores[ atributo.valor.id() ] = true;
				});
			});

			$.each( this.opcionesAtributosObtenerIds(), function( index, idAtributo ){
				var atributo = hashAtributos[ idAtributo ];
				$.each( atributo.__hashValores, function( idValor, isTrue ){
					atributo.valoresPosiblesSeleccionadosIds.push( idValor );
				});
				delete atributo.__hashValores;
				result.push( atributo );
			});

			return result;
		},

		/**
		 * Indica si este producto utiliza exactamente estos atributos para sus opciones
		 * @param idAtributos
		 * @returns {boolean}
		 */
		opcionesTieneAtributos: function( idAtributos ){
			function toNumber ( value ){
				return value ? Number( value ) : value;
			}

			var idAtributos 		= $.map( idAtributos.sort(), toNumber );
			var idAtributosSelf 	= $.map( this.opcionesAtributosObtenerIds().sort(),toNumber );

			return $.toJSON( idAtributos ) == $.toJSON( idAtributosSelf );
		},

		ordenarOpciones: function( atributosGlobales ){
			var self = this
				, atributos = this.opcionesAtributosObtener();

			if( atributosGlobales ){
				this.opciones.sort( function(a,b){
					var result = 0;
					$.each( atributos, function( index, atributo ){
						var atributoGlobal = ko.utils.arrayFirst( atributosGlobales, function( atributoGlobal ) {
							return atributoGlobal.id() == atributo.id();
						});

						var atributoA = a.obtenerAtributoPorId( atributo.id() );
						var atributoB = b.obtenerAtributoPorId( atributo.id() );

						var valorA = atributoGlobal.obtenerValorDeAtributoPorId( atributoA.valor.id() );
						var valorB = atributoGlobal.obtenerValorDeAtributoPorId( atributoB.valor.id() );

						if( valorA && valorB ){
							if( valorA.orden() < valorB.orden() ){
								result = -1;
								return false;
							}

							if( valorA.orden() > valorB.orden() ){
								result = 1;
								return false;
							}

						}

					});
					return result;
				});
			}


			return this.opciones();
		},

		opcionesCrearMatriz: function( atributos, cantMaxima ){
			var matriz = []
				, result;

			$.each( atributos, function( index, atributo){
				var valores = [];
				$.each( atributo.valoresPosiblesSeleccionadosIds(), function( index2, idValor ){
					valores.push({
						id: atributo.id(),
						valor: {
							id: idValor
						}
					});
				});
				matriz.push( valores );
			});

			result = $.arrayCartesianProduct( matriz );
			if( cantMaxima ){
				result = result.splice(0, cantMaxima );
			}
			return result;
		},

		opcionesCrearMatrizHash: function( atributos, cantMaxima ){
			var matriz = this.opcionesCrearMatriz( atributos, cantMaxima )
				, result = {};
			ko.utils.arrayForEach( matriz, function( elementoMatriz ){
				var key = ko.utils.arrayMap( elementoMatriz, function( atributo ) { return [atributo.id, atributo.valor.id].join('-') } ).join('|');
				result[key] = true;
			});
			return result;
		},


		/**
		 * Agrega nuevas opciones, pero deben tener los mismos atributos
		 * @param atributos
		 * @param precio
		 * @param precioSinDescuento
		 * @param stock
		 */
		_opcionesCrearNuevosDesdeMismosAtributos: function( atributos, defaultValues, mantenerOpciones, cantMaxima ){
			var idAtributos = $.pluckCollection( atributos, 'id' );
			if( this.tieneOpciones() && !this.opcionesTieneAtributos( idAtributos ) ){
				throw new RangeError('atributos debe tener los ids: ' + this.opcionesAtributosObtenerIds().join(', ') );
			}

			var self = this
				, productoCartesiano = this.opcionesCrearMatriz( atributos, cantMaxima )
				, result = [];

			$.each( productoCartesiano, function( idx, datosOpcion ){
				var opcion = self._opcionesObtenerDesdeAtributosSeleccionados( datosOpcion )
					, data = $.extend({}, defaultValues, {
						idPadre				: self.id(),
						atributos			: datosOpcion
					});
				if( !opcion ){
					opcion = new tiendasimple.back.Producto.Opcion(data, self );
					result.push( opcion );
				} else {
					if( mantenerOpciones ){
						result.push( opcion );
					}
				}
			});

			return result;
		},

		_opcionesCrearNuevosDesdeOtrosAtributos: function( atributos, defaultValues, cantMaxima ){
			var idAtributos = $.pluckCollection( atributos, 'id' );
			/*
			if( this.tieneOpciones() && !this.opcionesTieneAtributos( idAtributos ) ){
				throw new RangeError('atributos debe tener los ids: ' + this.opcionesAtributosObtenerIds().join(', ') );
			}*/

			var self = this
				, productoCartesiano = this.opcionesCrearMatriz( atributos, cantMaxima )
				, result = [];

			$.each( productoCartesiano, function( idx, datosOpcion ){

				var opcion = self._opcionesObtenerDesdeAtributosSeleccionados( datosOpcion, false, null, true )
					, data = $.extend({}, defaultValues );

				if( opcion ){
					data = $.extend( data, opcion.toJS() );
				}

				data = $.extend( data, {
					id					: null,
					idPadre				: self.id(),
					atributos			: datosOpcion
				});

				opcion = new tiendasimple.back.Producto.Opcion(data, self );
				result.push( opcion );
			});

			return result;
		},

		_opcionesCrearDesdeAtributos: function( atributos, productoReferencia, soloAgregar, cantMaxima ) {
			var self = this
				, tieneOpciones			= this.tieneOpciones()
				, mismosAtributos 		= this.opcionesTieneAtributos($.pluckCollection( atributos, 'id') )
				, productoReferencia 	= productoReferencia || ( self.tieneOpciones() ? $.arrayLast( self.opciones() ) : self )
				, precio				= productoReferencia.precio()
				, precioSinDescuento 	= productoReferencia.precioSinDescuento()
				, stock					= productoReferencia.stock()
				, idMoneda				= ko.unwrap( productoReferencia.idMoneda ) || ko.unwrap( self.idMoneda )
				, nuevasOpciones
				, defaultValues			= {
					precio				: precio,
					precioSinDescuento	: precioSinDescuento,
					stock				: stock
				};

			if( tieneOpciones && mismosAtributos ) {
				nuevasOpciones = this._opcionesCrearNuevosDesdeMismosAtributos( atributos, defaultValues, !soloAgregar, cantMaxima );
				if( !soloAgregar ){
					self.opciones.removeAll();
				}
				self.opciones.valueWillMutate();
				var opciones = self.opciones();
				if( cantMaxima ){
					var cantAAgregar = Math.max( 0, cantMaxima - opciones.length );
					nuevasOpciones = nuevasOpciones.slice(0, cantAAgregar );
				}
				$.each( nuevasOpciones, function( index, nuevaOpcion ){
					opciones.push( nuevaOpcion );
				});
				self.opciones.valueHasMutated();
			} else { // cambian los atributos as que todas las opciones sern nuevas
				nuevasOpciones = this._opcionesCrearNuevosDesdeOtrosAtributos( atributos, defaultValues, cantMaxima );
				self.opciones.destroyAll();
				self.opciones( nuevasOpciones );
			}

			if( stock ) this.stockActivado( true );
			if( idMoneda ) this.idMoneda( idMoneda );

			return nuevasOpciones;
		},

		/*
		_opcionesCrearDesdeAtributos: function( atributos, productoReferencia, soloAgregar ){
			var self = this;

			var productoReferencia 		= productoReferencia || ( self.tieneOpciones() ? $.arrayLast( self.opciones() ) : self )
				//, productoCartesiano 	= this.opcionesCrearMatriz( atributos )
				//, idPadre 				= self.id()
				, precio				= productoReferencia.precio()
				, precioSinDescuento 	= productoReferencia.precioSinDescuento()
				, stock					= productoReferencia.stock()
				, idMoneda				= ko.unwrap( productoReferencia.idMoneda ) || ko.unwrap( self.idMoneda )
				, nuevasOpciones;


			nuevasOpciones = this.opcionesCrearNuevosDesdeAtributos( atributos, precio, precioSinDescuento, stock );

			if( soloAgregar ){
			} else {
				self.opciones.removeAll();
			}


			self.opciones.valueWillMutate();
			var opciones = self.opciones();
			$.each( nuevasOpciones, function( index, nuevaOpcion ){
				opciones.push( nuevaOpcion );
			})
			self.opciones.valueHasMutated();


			if( stock ) this.stockActivado( true );
			if( idMoneda ) this.idMoneda( idMoneda );

		},
		*/

		opcionesAgregarDesdeAtributos: function( atributos, productoReferencia ) {
			var cantMaxima = this.constructor.cantMaximaOpciones;
			return this._opcionesCrearDesdeAtributos(atributos, productoReferencia, true, cantMaxima);
		},

		opcionesModificarDesdeAtributos: function( atributos, productoReferencia ){
			var cantMaxima = this.constructor.cantMaximaOpciones;
			return this._opcionesCrearDesdeAtributos( atributos, productoReferencia, false, cantMaxima);
		},

		obtenerPrecioMinimo: function(){
			var result = this._parent();
			if( this.tieneOpciones() && this.opcionesObtenerCantidadHabilitados() ){
				if( this.opcionesCargado() ){
					result = null;
					$.each( this.opcionesObtenerHabilitados(), function( index, opcion ){
						if( result === null ) result = opcion.precio();
						else {
							if (opcion.precio() && opcion.precio() < result ) result = opcion.precio();
						}
					});
				} else {
					result = this.opcionesPrecioMin();
				}
			}
			return result;
		},

		obtenerPrecioMinimoSinDescuento: function(){
			var result = this._parent();
			if( this.tieneOpciones() ){
				result = null;
				$.each( this.opciones(), function( index, opcion ){
					if( result === null ) result = opcion.precioSinDescuento();
					else {
						if (opcion.precioSinDescuento() && opcion.precioSinDescuento() < result ) result = opcion.precioSinDescuento();
					}
				});
			}
			return result;
		},

		obtenerPrecioMaximo: function(){
			var result = this._parent();
			if( this.tieneOpciones() ){
				if( this.opcionesCargado() ){
					result = null;
					$.each( this.opcionesObtenerHabilitados(), function( index, opcion ){
						if( result === null ) result = opcion.precio();
						else {
							if (opcion.precio() && opcion.precio() > result ) result = opcion.precio();
						}
					});
				} else {
					result = this.opcionesPrecioMax();
				}
			}
			return result;
		},


		obtenerPrecioMaximoSinDescuento: function(){
			var result = this._parent();
			if( this.tieneOpciones() ){
				if( this.opcionesCargado() ){
					result = null;
					$.each( this.opcionesObtenerHabilitados(), function( index, opcion ){
						if( result === null ) result = opcion.precioSinDescuento();
						else {
							if (opcion.precioSinDescuento() && opcion.precioSinDescuento() > result ) result = opcion.precioSinDescuento();
						}
					});
				} else {
					result = this.opcionesPrecioMaxSinDescuento();
				}
			}
			return result;
		},

		opcionesObtenerDesdeAtributos: function( atributos ){
			if(!$.isArray( atributos ) ){
				throw new TypeError('atributos debe ser array');
			}
			return this._opcionesObtenerDesdeAtributosSeleccionados( atributos, true );
		},

		/**
		 *
		 * @param atributos
		 * @param Booelan multiple
		 * @param Number cantidadAtributos
		 * @param Boolean ignorarAtributosQueNoTenga
		 * @returns {*}
		 * @private
		 */
		_opcionesObtenerDesdeAtributosSeleccionados: function( atributos, multiple, cantidadAtributos, ignorarAtributosQueNoTenga ){
			var self = this
				, result
				, atributos = atributos || this.opcionesAtributos()
				, fn = multiple ? 'arrayFilter' : 'arrayFirst';

			result = ko.utils[fn]( this.opciones(), function( opcion ){
				var coincide = true;
				$.each( atributos, function( index, atributo ){
					if( cantidadAtributos !== undefined && cantidadAtributos !== null ){
						if( cantidadAtributos <= index ) return false;
					}

					if( ignorarAtributosQueNoTenga ){
						if( !self.opcionesAtributosTieneId( ko.unwrap( atributo.id ) ) ) return;
					}

					coincide = ko.utils.arrayFirst( opcion.atributos(), function( atributoDeOpcion ){
						if( ko.unwrap( atributoDeOpcion.id ) == ko.unwrap( atributo.id ) ){
							var result;
							if( atributo.valor ){
								result = ko.unwrap( atributoDeOpcion.valor.id ) == ko.unwrap ( atributo.valor.id );
							} else {
								result = ko.unwrap( atributoDeOpcion.valor.id ) == ko.unwrap ( atributo.idValor );
							}
							return result;
						}
					});
					if( !coincide ) return false;
				});
				return coincide;
			});

			return result;
		},

		tieneVariosPrecios: function(){
			var result = this._parent();
			if( this.tieneOpciones() ){
				if( this.opcionesCargado() ){
					var opciones = this.opcionesObtenerHabilitados();
					var primerOpcion = opciones[0];
					if( primerOpcion ){
						var primerPrecio = primerOpcion.precio();
						$.each( opciones, function( index, opcion ){
							if( opcion.precio() != primerPrecio ){
								result = true;
								return false;
							}
						});
					}
				} else {
					result = this.opcionesPrecioMin() != this.opcionesPrecioMax();
				}
			}
			return result;
		},

		tieneAlgunValor: function( propiedad, comparer ){
			var result = false;

			if( this.tieneOpciones() ){
				result = ko.utils.arrayFirst( this.opciones(), function( opcion ){
					var value = ko.unwrap( opcion[propiedad] );
					return comparer ? comparer( value ) : value;
				});
			}
			return result;
		},

		tieneAlgunCodigo: function(){
			return this.tieneAlgunValor( 'codigo' );
		},

		tieneAlgunaImagen: function(){
			return this.tieneAlgunValor( 'imagenes', function( imagenes ){ return imagenes.length > 0 } );
		},

		opcionesValorTotal: function( propiedad, options){
			var options = $.extend( {}, options )
				, opciones = this.opciones()
				, result = 0;

			if( options.soloHabilitados ){
				opciones = this.opcionesObtenerHabilitados();
			}

			$.each( opciones, function( idx, opcion ){
				result += parseFloat( ko.unwrap( opcion[propiedad] ) ) || 0;
			});
			return result;
		},

		opcionesStockTotal: function( options ){
			return this.opcionesValorTotal( 'stock', options  );
		},

		opcionesCuantas: function( atributos ){
			var matriz = this.opcionesCrearMatriz( atributos );
			return matriz.length;
		},

		/**
		 * cuantas opciones nuevas se crearan con estos atributos
		 * @param atributos
		 */
		opcionesCuantasNuevas: function( atributos ){
			var matrizHash = this.opcionesCrearMatrizHash( atributos )
				, opcionesHashAtributosHash = this.opcionesObtenerHashAtributosHash()
				, cantExistentes = 0
				, cantNuevos = 0
				, cantMatrizHash = $.getObjectKeys( matrizHash).length;

			$.each( matrizHash, function( hash, value ){
				if( opcionesHashAtributosHash[ hash ] ){
					cantExistentes++;
				} else {
					cantNuevos++;
				}
			});

			return cantNuevos;
		},

		opcionesCantidadMaxima: function(){
			return this.constructor.cantMaximaOpciones;
		},

		opcionesPuedeTenerCantidad: function( cantidad ){
			return cantidad <= this.opcionesCantidadMaxima();
		},

		opcionesObtenerHashAtributos: function(){
			return ko.utils.arrayMap( this.opciones(), function( opcion ){
				return opcion.obtenerHashAtributos();
			})
		},

		opcionesObtenerHashAtributosHash: function(){
			var result = {};
			ko.utils.arrayForEach( this.opcionesObtenerHashAtributos(), function( hash ){
				result[ hash ] = true;
			});
			return result;
		},


		/////////////////////

		obtenerValorTotal: function( propiedad, options ){
			var options = $.extend( {}, options )
				, result = 0;
			if( this.tieneOpciones() ){
				result = this.opcionesValorTotal( propiedad, options );
			} else {
				result = ko.unwrap( this[propiedad] );
			}
			return result;
		},

		obtenerStockTotal: function( options ){
			var result = null;
				options = $.extend({}, options);
			if( this.tieneOpciones() && this.opcionesObtenerCantidadHabilitados() ){
				if( this.opcionesCargado() ){
					result = this.obtenerValorTotal( 'stock', options );
				} else {
					if( options.soloHabilitados ){
						result = this.opcionesStock();
					}
				}
			} else {
				result = this.stock();
			}
			return result;
		},

		/////////////////////

		opcionesObtenerPorId: function( id ){
			return ko.utils.arrayFirst( this.opciones(), function( opcion ){
				return ko.unwrap( opcion.id ) == id;
			});
		},

		eliminarOpciones: function(){
			$.each( this.opciones(), function( index, opcion) {
				opcion.destroy();
			});
			this.opciones.removeAll();
		},

		eliminarOpcion: function( opcion ){
			this.opciones.remove( opcion );
		},

		opcionesCopiarPrecio: function( opcionReferencia ){
			var precio = opcionReferencia.precio()
				, precioSinDescuento = opcionReferencia.precioSinDescuento();

			$.each( this.opciones(), function( idx, opcion ){
				opcion.update({ precio: precio, precioSinDescuento: precioSinDescuento });
			});
		},

		opcionesCopiarStock: function( opcionReferencia ){
			var stock = opcionReferencia.stock();

			$.each( this.opciones(), function( idx, opcion ){
				opcion.update({ stock: stock });
			});
		},

		opcionesObtenerImagenes: function(){
			var result = [];
			$.each( this.opciones(), function( idx, opcion ){
				if( opcion.tieneImagenes() ){
					result.push.apply( result, opcion.imagenes() );
				}
			});
			return result;
		},

		opcionesEliminarImagen: function( imagen ){
			$.each( this.opciones(), function( idx, opcion ){
				opcion.eliminarImagen( imagen );
			});
		},

		opcionesUtilizanImagen: function( imagen ) {
			return !!ko.utils.arrayFirst( this.opciones(), function( opcion ){
				return opcion.obtenerImagenPorIdONombre( imagen );
			});
		},
		
		_crearAtributoScopeLocal : function( data ){
			if (data.length >= 1){
				data.forEach(function( atributo ){
					model.data.buscarAgregarAtributoScopeLocal( atributo.id );
				});
			}
		}
	}
});




tiendasimple.back.Producto.Traduccion = tiendasimple.Traduccion.extend({
	init: function(data){
		this._parent(data);		
		this._createValidations();		
	},
	
	_setMappeable: function(){
		this._parent.apply(this, arguments);
		this._mergeMappeable({
			descripcion		: null, // nombre del producto
			descripcionCorta: null,
			descripcionLarga: '', // texto enriquecido - Fix: TinyMCE no permite null
			idProducto		: null,
			iso				: null			
		});
	},
	
	_createValidations: function(){
		if(ko.validation.disabled) return;
		this.descripcion.extend({
			required:true
		});
		
		this.descripcionLarga.extend({
			maxLength: {
				params	: 30000,
				message	: i18n.kot('snippetsback:snippet.texto_enriquecido.por_favor_reduce_el_contenido_de_tu_texto_solo_se_permiten_30_mil_caracteres_en_total_includos_los_tags_html')
			}
		});
		
		this._parent([this.descripcion]);
	}
});


tiendasimple.back.Producto.Imagen = tiendasimple.Imagen.extend({
	_setMappeable: function(){
		this._parent.apply( this, arguments );
		this._mergeMappeable( {
			principal	: false,
			nombre		: null,
			path		: null			
		});
	},
	
	init: function(data){
		this._parent.apply(this, arguments);
		
		this.makeEditable(['principal']);

		this.url = ko.computed(function(){
			return this.path() ? this.path() : 'productos/obtenerimagen/' + (this.id() || !this.nombre() ? '?id=' +  (this.id() || 0) : '?tmp=' + this.nombre()) ;
		}, this, {deferEvaluation: false});

		this.uid = ko.observable(Math.round(Math.random()*999999999999));


	},
		
	get: function(options){
		var options = $.extend({
			useDensity: true // escala las imgenes de acuerdo a la densidad de la pantalla
		}, options);
		
		/* 
		 * http://blinky.com.ar/mimarket/admin/galeriaimagenes/obtenerimagen/?id=79&width=450&height=1200&tipoEscala=cropEnd&padding=20:10:30:40&color=ff0000
		 * tipoEscala adopta estos valores:
			por defecto: 'fit' (se ve TODA la imagen)
			luego: 
			stretch : 'estira la imagen'
			crop: escala, corta y centra
			cropStart: escala, y corta al inicio
			cropEnd: escala y corta al final de la imgen
		 * options.cropratio
		 * options.width
		 * options.height
		 * options.useDensity
		 * */
		 if(options.useDensity){
			 ratio = window.devicePixelRatio || 1;
			 if(options.width) options.width *= ratio;
			 if(options.height) options.height *= ratio;
		 }
		return this.url() + (this.path() ? '' : '&' + $.param(options));
	},

	getForBackground: function( options ){
		return 'url("' + this.get( options ) + '")';
	}
});


//////////////////////////////// OPCIONES ////////////////////////////////////
tiendasimple.back.Producto.Opcion = tiendasimple.back.ProductoBase.createSubclass({
	mappeable:{
		idPadre	: null,
		atributos	: []
	},

	defaults: {
		productoPadre: null
	},

	mapping: {
		atributos: {
			create: function( options ){
				return new tiendasimple.back.Producto.Opcion.Atributo( options.data );
			}
		}
	}
}, {
	init: function( data, productoPadre ){
		var self = this;
		this._parent.apply( this, arguments );
		this._createComputed();
		self.productoPadre( productoPadre );
		this._createBlueImpFileUpload();
	},

	_createComputed: function(){
		this._parent.apply( this, arguments );
		this.imagenes.representativa = ko.computed(function(){
			var imagen = this.imagenes.principal() || this.imagenes()[0];
			if(!imagen) imagen = this.imagenes.vacia;
			return  imagen;
		}, this);
	},

	opcionesAtributosObtenerIds : function(){
		console.log('->');
		return $.pluckCollection( this.atributos(), 'id' );
	},

	obtenerAtributoPorId: function( id ){
		return ko.utils.arrayFirst( this.atributos(), function( atributo ){
			return atributo.id() == id;
		});
	},

	obtenerHashAtributos: function(){
		return this.constructor.obtenerHashDeAtributos( this.atributos() );
	},

	clone: function(){
		var data = this.toJS()
			, result = new this.constructor( data );

		result.productoPadre( this.productoPadre() );

		return result;

	},

	copiarImagenesDesdeOpcion: function( opcion ){
		this.update( opcion.toJS( ['imagenes'] ) );
	},

	////////////////////////////////////////////////////

	_onFileUpload: function(data){
		var productoPadre = this.productoPadre()
			, result = this._parent.apply( this, arguments );

		$.each( result, function( idx, imagen ) {
			productoPadre.imagenes.push( imagen.clone() );
		});

		return result;
	},

	agregarImagenURL: function ( url ){
		var productoPadre = this.productoPadre()
			, imagen = productoPadre.agregarImagenURL( url );

		this.agregarImagenPorIdONombre( imagen );
		return imagen;
	},

	getUrl: function(){
		return $.hashbang.get({catalogo:'productos', pagina: 0}, {'id': this.idPadre()});
	}

});



//////////// atributos generales //////////////////////////////

tiendasimple.back.Atributo = ko.ViewModel.createSubclass({
	mappeable: {
		id                  : null,
		nombre              : '',
		descripcion         : '',
		orden               : 0,
		tipo                : 'desplegable',
		valoresPosibles     : [],
		cantidadProductos   : 0
	},

	defaults: {
		expandido                       : false,
		guardando                       : false,
		eliminando                      : false,
		seleccionado                    : false,
		enCreacion                      : false,
		valoresPosiblesSeleccionadosIds : [],
		valorEnEdicion                  : null,

		tipoOptions                     : [
			{ id: 'desplegable', text: 'back:secciones.catalogo.atributos.opciones.lista_desplegable', icon: 'fa-list-ul' },
			{ id: 'color', text: 'back:secciones.catalogo.atributos.opciones.seleccion_de_colores', icon: 'fa-eyedropper' },
			{ id: 'etiqueta', text: 'back:secciones.catalogo.atributos.opciones.etiquetas', icon: 'fa-tags' }
		]
	},

	mapping: {
		valoresPosibles: {
			create: function (options) {
				return new options.parent.constructor.Valor(options.data);
			}
		}
	}

}, {
	prototype: {
		init: function(data){
			
			this._parent.apply(this, arguments);

			if( this._valorEsNuevo( this.id() ) && !this.nombre() ){
				this.nombre( this._obtenerNombreDeNuevoValor( this.id() ) );
			}

			this.makeEditable({fields: 'mappeable'});
			this.addEditableField('valoresPosiblesSeleccionadosIds');
			this._createComputed();
			this._applySubscriptions();
			this._createValidations();
		},

		beginEdit: function(){
			this.establecerValoresPosiblesSeleccionadosIds();
			this.valoresPosiblesSeleccionadosIds.isModified( false );
			this._parent.apply( this, arguments );
		},

		restringirValoresPosibles: function(){
			var self = this
				, nuevosValoresPosibles = []
				, viejosValores = this.valoresPosibles()
				, orden = 1;

			ko.utils.arrayForEach( self.valoresPosiblesSeleccionadosIds(), function( idValor ){
				var valor = ko.utils.arrayFirst( viejosValores, function( valor ){
					return valor.id() == idValor;
				});

				valor.orden(orden++);

				nuevosValoresPosibles.push( valor );
			});

			this.valoresPosibles( nuevosValoresPosibles );

			return nuevosValoresPosibles;
		},

		esNuevo: function(){
			return this._valorEsNuevo( this.id() );
		},

		establecerValoresPosiblesSeleccionadosIds: function(){
			var ids = this._obtenerIdsDeValoresPosibles();
			this.valoresPosiblesSeleccionadosIds( ids );
		},

		quitarValoresNuevosDeValoresPosiblesSeleccionadosIds: function(){
			var self = this
				, ids;

			ids = ko.utils.arrayFilter( this.valoresPosiblesSeleccionadosIds(), function( id ){
				return !self._valorEsNuevo( id );
			});

			this.valoresPosiblesSeleccionadosIds( ids );
		},

		_valorEsNuevo: function( id ) {
			return /^nuevo-.+/.test( id );
		},

		_obtenerNombreDeNuevoValor: function( id ) {
			return id && id.replace(/^nuevo-/, '');
		},

		_obtenerIdsDeValoresPosibles: function(){
			return $.pluckCollection( this.valoresPosibles(), 'id' );
		},

		_createValidations : function(){
			this.nombre.extend({ required: true });
			this.valoresPosiblesSeleccionadosIds.extend({ required: true });
			this.valoresPosibles.extend({ validChildren: true });
			ko.validatedObservable(this);
		},

		_applySubscriptions: function(){
			var self = this;
		},

		_createComputed: function(){
			var self = this;

			this.valoresPosibles.data = ko.computed(function(){
				return ko.utils.arrayMap( this.valoresPosibles(), function(valor){
					return {
						id      : valor.id(),
						text    : valor.nombre(),
						color   : self.tipo() == 'color' ? valor.data() : ''
					}
				});
			}, this);

			this.nombreDeValoresSeleccionados = function(){
				return ko.utils.arrayMap(this.valoresPosibles(), function(valor){
					return [ valor.nombre() ];
				}).join(', ');
			},

				this.procesando = ko.computed(function(){
					return this.eliminando() || this.guardando();
				}, this);

			this.puedeGuardar = ko.computed({
				read: function(){
					var hasChanges	= this.hasChanges();
					var isValid		= true; //this.isValid();
					var procesando	= this.procesando();
					return hasChanges && isValid && !procesando;
				}
			}, this);
		},

		toggleExpandido: function(){
			this.expandido(!this.expandido());
		},

		obtenerValorDeAtributoPorId: function(id){
			return ko.utils.arrayFirst(this.valoresPosibles(), function(item){
				return item.id() == id;
			});
		},

		obtenerValorDeAtributoPorNombre: function(nombre){
			return ko.utils.arrayFirst(this.valoresPosibles(), function(item){
				return item.nombre() == nombre;
			});
		},

		obtenerTipoDeVistaPorId: function(id){
			return ko.utils.arrayFirst(this.tipoOptions(), function(item){
				return item.id() == id;
			});
		},

		crearNuevoValor: function(nombre){
			var self = this
				, data = {
					id      : 'nuevo-' + nombre,
					nombre  : nombre
				};

			if( self.obtenerValorDeAtributoPorNombre( nombre ) ) return false;

			var nuevoValor = new this.constructor.Valor( data );
			self.valoresPosibles.push( nuevoValor );
			return data
		},

		obtenerNuevosValores: function(){
			return ko.utils.arrayFilter( this.valoresPosibles(), function( valor ){
				return valor.esNuevo();
			});
		},

		/*
		 obtenerValoresPosiblesSinValoresNuevosSinUso: function(){
		 var result = []
		 , valoresPosiblesSeleccionadosIds = this.valoresPosiblesSeleccionadosIds()
		 , hashIds = {};

		 $.each( valoresPosiblesSeleccionadosIds, function( idx, id){
		 hashIds[ Number( id ) ] = true;
		 });

		 function idEstaSeleccionado( id ) {
		 return !!hashIds[ Number( id ) ];
		 }

		 ko.utils.arrayForEach( this.valoresPosibles(), function( valor ){
		 if( valor.esNuevo() ){
		 return idEstaSeleccionado( valor.id() );
		 } else {
		 result.push( valor );
		 }
		 });

		 return result;
		 },
		 */

		eliminarValoresPosiblesNuevosSinUso: function(){
			var self = this
				, result = []
				, valoresPosiblesSeleccionadosIds = this.valoresPosiblesSeleccionadosIds()
				, hashIds = {}
				, valoresPosibles = $.extend([], this.valoresPosibles() );

			$.each( valoresPosiblesSeleccionadosIds, function( idx, id){
				hashIds[ Number( id ) ] = true;
			});

			function idEstaSeleccionado( id ) {
				return !!hashIds[ Number( id ) ];
			}

			ko.utils.arrayForEach( valoresPosibles , function( valor ){
				if( valor.esNuevo() && !idEstaSeleccionado( valor.id() )) {
					self.valoresPosibles.remove( valor );
				}
			});

			return this.valoresPosibles();
		},

		agregarValores: function( valores ){
			this.valoresPosibles.push.apply( this.valoresPosibles, valores );
		},

		eliminarValor: function( valor ){
			this.valoresPosibles.remove( valor );
		},

		eliminarValorPorId: function( id ){
			var valor = this.obtenerValorDeAtributoPorId( id );
			this.eliminarValor( valor );
		}
	}
});

tiendasimple.back.Atributo.Valor = ko.ViewModel.createSubclass({
	mappeable: {
		id			: null,
		nombre		: '',
		orden       : 0,
		data		: null
	},

	defaults: {
	},

	mapping: {
	}
}, {
	init: function(data){
		this._parent.apply(this, arguments);
		this.makeEditable('mappeable');
		this._createValidations();
	},

	_createValidations : function(){
		if(ko.validation.disabled) return;
		this.nombre.extend({ required: true });
		ko.validatedObservable(this);
		this._parent.apply(this, arguments);
	},

	esNuevo: function(){
		return this._valorEsNuevo( this.id() );
	},

	_valorEsNuevo: function( id ) {
		return /^nuevo-.+/.test( id );
	},

	_obtenerNombreDeNuevoValor: function( id ) {
		return id && id.replace(/^nuevo-/, '');
	},

	obtenerNombreDeNuevoValor: function( id ){
		return this._obtenerNombreDeNuevoValor( id || this.id() );
	}

});




////////////////////////// ATRIBUTOS DE PRODUCTOS ///////////////////////////////////////////

tiendasimple.back.Producto.Opcion.Atributo = ko.ViewModel.createSubclass({
	mappeable: {
		id		: null,
		valor	: {}
	},

	mapping	: {
		valor	: {
			create: function( options ){
				return new tiendasimple.back.Producto.Opcion.Atributo.Valor( options.data );
			}
		}
	}
});

tiendasimple.back.Producto.Opcion.Atributo.Valor = ko.ViewModel.createSubclass({
	mappeable: {
		id: null
	}
});


/* /js/front/fronttienda_model_apariencia.js
 * compresion time: 0.02313 -(ms)
 * ----------------------------------------- */
;(function(namespace){
	
	
	namespace.Apariencia = tiendasimple.Apariencia.extend({

		_setMappeable: function(){
			this._parent.apply(this, arguments);
			this._mergeMappeable({
				templateEdicion	: {},
				vacio			: false				
			})
		},
				
		_setMapping: function(){
			this._parent.apply(this, arguments);
			this._mergeMapping({
				templateEdicion: {
					create: function(options){
						return new tiendasimple.Template(options.data)
					}
				}
			})
		},

		init: function(data){
			this._parent.apply(this, arguments);
		},
		
		_createComputed: function(){
			this._parent.apply(this, arguments);
			var re = /(url\s*\(["']?)(?!\s*["']?\s*(htt[p:\/\/|ps:\/\/]|\.|\/))(?=[^)]*\);?)/ig;
			this.templateEdicion.estiloEntidad.css.absolutePaths = ko.computed(function(){
				var idEstilo		= this.templateEdicion.estiloEntidad.id()
					, idTemplate	= this.templateEdicion.id()
					, nuevaRuta		= this.templateEdicion.version() == '1' ? '$1/templates/estilos/' + idEstilo + '/' :  '$1/templates/v2/' + idTemplate + '/'
				return (this.templateEdicion.estiloEntidad.css() || '').replace(re, nuevaRuta );
			}, this);

			this.templateEdicion.temaEntidad.css.absolutePaths = ko.computed(function(){
				var idTema = this.templateEdicion.temaEntidad.id();
				return (this.templateEdicion.temaEntidad.css() || '').replace(re, '$1/templates/temas/' + idTema + '/' );
			}, this);
			
			this.templateEdicion.estiloEntidad.editando = ko.observable(false);
			this.templateEdicion.temaEntidad.editando = ko.observable(false);
			
			this.templateEdicion.editando = ko.observable(false);
			
			this.templateEdicion.thumbnail = new tiendasimple.Template.Thumbnail();
			this.templateEdicion.id.subscribe(function(id){
				this.templateEdicion.thumbnail.id(id);
			}, this);
			
			////////////////////////////////////////////////////////////////////
		
			this.templates.seleccion = ko.observable();
			this.templates.seleccion.thumbnail = new tiendasimple.Template.Thumbnail({basePath: 'admin/' });
			this.templates.seleccion.subscribe(function(id){
				this.templates.seleccion.thumbnail.id(id);
			}, this);
			
			
			// preseleccionar el SELECT con el valor del template actual
			this.templateActual.subscribe( function( template ) {
				this.templates.seleccion( template.id() );
			}, this);

			////////////////////////////////////////////////////////////////////////
			// TEMPLATES PERSONALES
			//this.templatesPersonales.loading = ko.observable(false);

		}
		

	});
	
})($.namespace('tiendasimple.front'));


/* /js/front/fronttienda_model_apariencia2.js
 * compresion time: 0.02193 -(ms)
 * ------------------------------------------ */
;(function(namespace){
	namespace.Apariencia2 = ko.ViewModel.extend({
		_setMappeable: function(){
			this._parent.apply( this, arguments );
			this._mergeMappeable({
				designModeOn			: false,				
				unitTests				: {},
				nombreTestSeleccionado	: ''
			});
		},
				
		_setMapping: function(){
			this._parent.apply( this, arguments );
			this._mergeMapping({
				unitTests		: {
					create		: function( options ){
						return new namespace.UnitTests( options.data );
					}
				}
			});
		},
		
		ejecutarUnitTestSeleccionado: function(){
			this.unitTests.run( this.nombreTestSeleccionado() );
		},
		
		resetearUnitTests: function(){
			this.unitTests.reset();
		}
		
	});
	
}($.namespace('tiendasimple.front')));


/* /js/front/fronttienda_model_estructura.js
 * compresion time: 0.02193 -(ms)
 * ----------------------------------------- */
;(function(namespace){
	
	namespace.Estructura = tiendasimple.Estructura.extend({
		prototype: {						
			init: function(){
				this._parent.apply(this, arguments);
			}
		}
	});
	
})($.namespace('tiendasimple.front'));


/* /js/back/backtienda_model_metodopago.js
 * compresion time: 0.02813 -(ms)
 * --------------------------------------- */
!function(namespace){
	namespace.MetodoPago = ( tiendasimple.back.SeccionEditable || ko.ViewModel).extend({
		createInstance: function( options ){
			var theClass = this,
				subClassName = $.string.capitalize( options.descripcion );
		
			if( theClass[ subClassName ]) theClass = theClass[ subClassName ];
			return new theClass( options );
		},
		
		sandbox	: ko.observable( false ),
		
		prototype: {
			init: function( data ){
				if( data.configuracion == null ) delete data.configuracion;
				
				this._parent.apply( this, arguments );
				this._createComputed();
				this._createValidations();
			},

			_setMappeable: function(){
				this._parent();
				this._mergeMappeable({
					usado				: false,
					nombre				: '',
					descripcion			: '',
					id					: '',
					logo				: '',
					monedas				: [],
					servicios			: [],
					permitePagoOnline	: false,
					
					permiteMultiplesMonedas	: false,
					montoMinimo					: 0,
					usarMontoMinimoPorMoneda	: false,
					
					habilitado			: false,
					deprecado			: false,
					configuracion		: {
						sandbox			: false
					}
				});
			},
					
			_setDefaults: function(){
				this._parent();
				this._mergeDefaults({
					autosubmit						: true,
					alwaysEdit						: false,
					motivoNoPuedeProcesarCarrito	: '',
					serviciosPorPais				: false,
					error							: ''
				});
			},


			_createValidations: function(){
				var self = this;
				this._parent();
			},

			_createComputed: function(){
				this.describe = ko.computed(function(){
					return '';
				}, this);
				
				this.sandbox = ko.computed( {
					read	: this.constructor.sandbox,
					write	: this.constructor.sandbox					
				}, this);
			},
					
			////////////////////////////////////////////////////////////////////
	
			toAmount: function( value ){
				return ( accounting.formatMoney( value , '', '2', '.' ) );
			},

			toCurrency: function( idMoneda ){
				var moneda = ko.utils.arrayFirst(this.obtenerMonedasHabilitadas(), function(moneda){
					return moneda.id() == idMoneda;
				});
				return ( moneda && ko.unwrap( moneda.iso ) ) || '';
			},

			obtenerMonedaPorIso: function( isoMoneda ){
				return ko.utils.arrayFirst(this.obtenerMonedasHabilitadas(), function(moneda){
					return ko.unwrap( moneda.iso ) == isoMoneda;
				});
			},

			obtenerMonedaPorId: function( idMoneda ){
				return ko.utils.arrayFirst(this.obtenerMonedasHabilitadas(), function(moneda){
					return ko.unwrap( moneda.id ) == idMoneda;
				});
			},


			////////////////////////////////////////////////////////////////////
			getBasePath: function(){
				return $.string.trimFromFirst(location.href, '#');
			},

			getOkUrl: function(){
				return this.getBasePath() + '#!/orden-compra/portal-pagos-ok';
			},

			getErrorUrl: function(){
				return this.getBasePath() + '#!/orden-compra/portal-pagos-error';
			},

			getPendingUrl: function(){
				return this.getBasePath() + '#!/orden-compra/portal-pagos-ok';
			},
					
			getNotifyUrl: function(){
				return 'http://tienda04.dattaweb.com/pp16/fronttienda/test/';
			},
					
			obtenerMonedasCarrito: function( carrito ){
				return $.unique( $.map( carrito.detalle(), function(item){
					return item.idMoneda();
				} ) );
			},
					
			puedeProcesarMontoCarrito: function( carrito ){
				var self = this
					, sumTotales = 0
					, result = true;

				if( this.usarMontoMinimoPorMoneda() ){
					$.each( carrito.totales() , function( index, subtotal ){
						var idMoneda = subtotal.idMoneda;
						var montoMinimo = self.obtenerMontoMinimoMoneda( idMoneda );
						if( montoMinimo ){
							self.motivoNoPuedeProcesarCarrito ( i18n.kot( 'app.metodospago.motivo.pago_minimo', { monto_minimo: montoMinimo } )  );
							if( subtotal.total < montoMinimo ){
								result = false;
								return false;
							}
						}
					});

				} else {
					if( this.montoMinimo() ){
						$.each( carrito.totales() , function( index, subtotal ){
							sumTotales += subtotal.total;
						});

						this.motivoNoPuedeProcesarCarrito ( i18n.kot( 'app.metodospago.motivo.pago_minimo', { monto_minimo: this.montoMinimo() } )  );

						result = sumTotales >= this.montoMinimo();
					}
				}


				return result;
			},

			obtenerMontoMinimoMoneda: function( idMoneda ){
			},
			
			obtenerMonedasHabilitadas: function(){
				return this.monedas();
			},
			
			puedeProcesarMonedasCarrito: function( carrito ){
				var monedas = this.obtenerMonedasCarrito ( carrito );
				return this.puedeProcesarMonedas( monedas );
			},
			
			puedeProcesarMonedas: function( monedas ){
				var self = this,
					result = true;
				
				if(!$.isArray(monedas)){
					monedas = [monedas];
				}
				
				if( this.obtenerMonedasHabilitadas().length > 0 ){ // si este mtodo de pago acepta slo algunas monedas...
					$.each( monedas, function( index, moneda ){
						if( !self.toCurrency( moneda ) ) {
							result = false;

							//self.motivoNoPuedeProcesarCarrito( 'no acepta pagos en la moneda de algunos de los productos del carro' );
							self.motivoNoPuedeProcesarCarrito ( i18n.kot( 'app.metodospago.motivo.pagos_en_moneda' ) );

							return false;
						}
					});
				}
				return result;				
			},

			puedeProcesarCotizacionEnvio: function( carrito ){
				return true;
			},

			puedeProcesarDireccionFacturacion: function( carrtio ){
				return true;
			},
	
			puedeProcesarDireccionEnvio: function( carrtio ){
				return true;
			},

			puedeProcesarCarrito: function( carrito ){
				var self = this,
					result = true,
					monedas = null;
				
				if( !this.permiteMultiplesMonedas() ){ // si este mtodo de pago slo acepta UNA moneda
					monedas = monedas || this.obtenerMonedasCarrito ( carrito );
					if( monedas.length > 1 ){

						//self.motivoNoPuedeProcesarCarrito( 'no acepta el pago de items en diferentes monedas' );
						self.motivoNoPuedeProcesarCarrito ( i18n.kot( 'app.metodospago.motivo.diferentes_monedas' )  );

						result = false;
					}
				}
				
				if( result ){
					result = this.puedeProcesarMontoCarrito( carrito );
				}
			
				if ( result ){
					result = this.puedeProcesarMonedasCarrito( carrito );			
				}

				if( result ){
					result = this.puedeProcesarCotizacionEnvio( carrito );
				}

				if( result ){
					result = this.puedeProcesarDireccionFacturacion( carrito );
				}
				
				if( result ){
					result = this.puedeProcesarDireccionEnvio( carrito );
				}


				return result;
			},
			
			obtenerServiciosHabilitadosCarrito: function( carrito ){
				var monedas = this.obtenerMonedasCarrito ( carrito );
				return this.obtenerServiciosHabilitadosMonedas( monedas );
			},
			
			obtenerServiciosHabilitadosMonedas: function( monedas ){
				return this.servicios();
			},
			
			obtenerTodosLosServicios: function(){
				var servicios = {};
				
				if( this.serviciosPorPais() ){
					$.each( this.servicios(), function( index, pais ){
						$.each( pais.servicios(), function( index, servicio ){
							servicios[servicio.nombre()] = servicio;
						});
					});					
				} else {
					$.each( this.servicios(), function( index, servicio ){
						servicios[servicio.nombre()] = servicio;
					});					
				}
				
				return $.map( servicios, function( servicio ){
					return servicio;
				});				
			},
			
			obtenerTodosLosServiciosConfigurados: function(){
				return this.obtenerTodosLosServicios();
			},
			
			obtenerPaisOperantePorId: function( id ){
				return ko.utils.arrayFirst( this.paisesOperantes(), function( pais ){
					return pais.id() == id;
				});
			},
			
			obtenerServiciosPorIsoPais: function( iso ){
				var servicio = ko.utils.arrayFirst( this.servicios(), function( servicio ){
					return servicio.pais() == iso;
				});

				return servicio && servicio.servicios();
			},

			obtenerIsoPaisesDeIsoMoneda: function( isoMoneda ){
				return {
					'ARS'	: ['ar'],
					'BRL'	: ['br'],
					'COP'	: ['co'],
					'MXN'	: ['mx'],
					'USD'	: ['pa'],
					'PEN'	: ['pe'],
					'CLP'	: ['cl'],
					'VEF'	: ['ve'],
					'UYU'	: ['uy']
				}[isoMoneda]
			},

			obtenerIsoPaisDeIsoMoneda: function( isoMoneda ){
				var paises = this.obtenerIsoPaisesDeIsoMoneda( isoMoneda );
				return paises && paises[0];
			}

		}
	});
	
	// DINEROMAIL
	namespace.MetodoPago.Dineromail = namespace.MetodoPago.extend({
		_setDefaults: function(){
			this._parent.apply(this, arguments);
			this._mergeDefaults({
				serviciosPorPais	: true
			});
		},
		
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				paisesOperantes	: [],
				configuracion	: {
					merchant	: '',
					country_id	: '1',
					ipnPassword	: ''
				},
				ipnUrl			: ''
			});
		},
				
		init: function(){
			this._parent.apply( this, arguments );
		},
				
		_createValidations: function() {
			var self = this;
			
			this.configuracion.merchant.extend({				
				required	: {
					onlyIf: function(){
						return self.habilitado();
					}
				},
				
				validation: {
					onlyIf: function(){
						return self.habilitado();
					},
					validator: function(val, someOtherVal){
						return $.isEmptyVal(val) || ko.validation.rules['email'].validator(val, someOtherVal) || ko.validation.rules['digit'].validator(val, someOtherVal) ;
					},
					message: "back:secciones.catalogo.metodos_de_pago.debe_ser_el_email_o_un_numero_de_cuenta",
					params: true
				}/*
				
				email		: {
					onlyIf: function(){
						return self.habilitado();
					}
				}*/
			});
	
			this._parent();			
		},

				
		_createComputed: function(){
			this._parent.apply( this, arguments );
			this.describe = ko.computed(function(){
				var self = this,
					pais,
					result = ''
					, nombrePais;
					
				if( this.configuracion.merchant() ){
					pais = ko.utils.arrayFirst( this.paisesOperantes(), function( paisOperante ){ 
							return paisOperante.id() == self.configuracion.country_id();
						});
						
					nombrePais = pais && pais.nombre();
					result = this.configuracion.merchant() + ' / ' + nombrePais ;
				}
				return result;
			}, this );
			
			
			this.formUrl = ko.computed(function(){
				var onlineUrl = 'https://checkout.dineromail.com/CheckOut',
					sandboxUrl = 'https://checkout.dineromail.com/CheckOut';
					
				return this.sandbox() ? sandboxUrl : onlineUrl;
			}, this);
			
			this.configuracion.merchant.subscribe(function(val){
				var newVal = $.string.trimFromFirst(val, '/');
				this.configuracion.merchant(newVal);
			}, this);
			
		},

		toAmount: function( value ){
			return Math.round( value * 100 );
		},

		obtenerPaisConfigurado: function(){
			return this.obtenerPaisOperantePorId( ko.unwrap( this.configuracion.country_id ) );
		},
		
		obtenerServiciosHabilitadosMonedas: function( monedas ){
			var servicios
				, paisConfigurado = this.obtenerPaisConfigurado()
				, isoPaisConfigurado = paisConfigurado && paisConfigurado.iso();
				
			servicios = ko.utils.arrayFirst( this.servicios(),function( servicio ){
				return servicio.pais() == isoPaisConfigurado;
			});
			
			return servicios ? servicios.servicios() : [];			
		},
		
		obtenerTodosLosServiciosConfigurados: function(){
			var self = this
				, servicios = {}
				, isoPaisConfigurado = this.obtenerPaisConfigurado() && this.obtenerPaisConfigurado().iso();
				
			return self.obtenerServiciosPorIsoPais( isoPaisConfigurado ) || [];
		},
		
		merchantIsId: function(){
			return $.isNumeric(this.configuracion.merchant());
		}


	});
	
	// PAYU
	namespace.MetodoPago.Payu = namespace.MetodoPago.createSubclass({
		defaults: {
			notifyUrl	: null,
			serviciosPorPais	: true,
			desarrollo	: false,
			
			sandboxData: {
			}
		},
		
		mappeable: {
			paisesOperantes	: [],
			configuracion	: {
				merchantId	: '',
				paises : [
					{ 
						iso			: 'ar',
						accountId	: '',
						habilitado		: false
					},
					{ 
						iso			: 'br',
						accountId	: '', 
						habilitado		: false
					},
					{ 
						iso			: 'co',
						accountId	: '',
						habilitado		: false
					},
					{ 
						iso			: 'cl',
						accountId	: '', 
						habilitado		: false
					},
					{ 
						iso			: 'mx',
						accountId	: '',
						habilitado		: false
					},
					{ 
						iso			: 'pa',
						accountId	: '',
						habilitado		: false
					},
					{ 
						iso			: 'pe',
						accountId	: '',
						habilitado		: false
					}
				],
				ApiKey		: '',
				sandbox		: false
			},
			usarMontoMinimoPorMoneda	: true
		},
		
		mapping: {
			paises	: {
				create: function( options ){
					return new namespace.MetodoPago.Payu.ConfiguracionPais( options.data );
				}
			}
		}
	}, {
		prototype: {		
			init: function(){
				this._parent.apply( this, arguments );
			},

			_createValidations: function() {
				var self = this;

				this.configuracion.merchantId.extend({
					required	: {
						onlyIf: function(){
							return self.habilitado() && !self.configuracion.sandbox();
						}
					}
				});

				this.configuracion.ApiKey.extend({
					required	: {
						onlyIf: function(){
							return self.habilitado() && !self.configuracion.sandbox();
						}
					},
					alphanumeric : true
				});

				this.configuracion.paises.extend({
					validChildren: {
						onlyIf	: function(){
							return self.habilitado() && !self.configuracion.sandbox();
						}
					}				
				});

				this.paisesHabilitados.extend({
					minLength	: {
						onlyIf	: function(){
							return self.habilitado();
						},
						params	: 1,
						message	: 'back:secciones.catalogo.metodos_de_pago.debes_configurar_al_menos_un_pais'
					}				
				});
				this._parent();			
				this.showAllMessages(false);

			},
			

			////////////////////////////////////////////////////////////////////
			_createComputed: function(){
				this._parent.apply( this, arguments );

				this.paisesConfigurados = ko.computed(function(){
					return ko.utils.arrayFilter( this._getConfiguracion().paises(), function( pais ){
						return ( ko.unwrap( pais.habilitado ) && ko.unwrap( pais.accountId ) );
					})				
				}, this);

				this.paisesDeshabilitados = ko.computed( function(){
					return ko.utils.arrayFilter( this._getConfiguracion().paises(), function( pais ){
						return !ko.unwrap( pais.habilitado )
					});
				}, this);

				this.paisesHabilitados = ko.computed( function(){
					return ko.utils.arrayFilter( this._getConfiguracion().paises(), function( pais ){
						return ko.unwrap( pais.habilitado )
					});
				}, this);

				this.describe = ko.computed(function(){
					var self = this
						, pais
						, result = ''
						, paises = [];

					if( this.configuracion.sandbox() ){
						result = ['SANDBOX'];
						paises = $.pluckCollection( this.paisesConfigurados(), 'iso' );
						paises = paises.join(',');
						if( paises ) result.push( '(' + paises + ')' );
						result = result.join(' ');
					} else {						
						if( this.configuracion.merchantId()){					
							result = [ this.configuracion.merchantId()];

							paises = $.pluckCollection( this.paisesConfigurados(), 'iso' );
							paises = paises.join(',');
							if( paises ) result.push( '(' + paises + ')' );
							result = result.join(' ');
						}
					}

					return result;
				}, this );


				this.formUrl = ko.computed(function(){
					var onlineUrl = 'https://gateway.payulatam.com/ppp-web-gateway',
						sandboxUrl = 'https://sandbox.gateway.payulatam.com/ppp-web-gateway';
						//sandboxUrl = 'https://stg.gateway.payulatam.com/ppp-web-gateway';

					return this.configuracion.sandbox() ? sandboxUrl : onlineUrl;
				}, this);
			},

			obtenerMonedasHabilitadas: function(){
				// todas las monedas en las que tenga cuentas configuradas, ms dlar
				var self = this
					, incluyeDolar = false
					, paisesIso = $.pluckCollection( this.paisesConfigurados(), 'iso' )
					, isoMonedasHabilitadas = $.map( paisesIso, function( iso ){
						var moneda = self.monedaPais( iso );
						if( moneda == 'USD') incluyeDolar = true;
						return moneda;
					});

				if( !incluyeDolar ){
					isoMonedasHabilitadas.push('USD');
				}

				return ko.utils.arrayFilter( this.monedas(), function( moneda ){
					return ko.utils.arrayIndexOf( isoMonedasHabilitadas, ko.unwrap( moneda.iso ) ) != -1;
				});			
			},

			obtenerMontoMinimoMoneda: function( idMoneda ){
				var monto;

				var moneda = this.obtenerMonedaPorId( idMoneda );
				var isoMoneda = moneda && ko.unwrap( moneda.iso );

				var montosMinimosPorMoneda = {
					'ARS'	: 17,
					'BRL'	: 6,
					'COP'	: 120,
					'MXN'	: 39,
					'USD'	: 3,
					'PEN'	: 7,
					'CLP'	: 1665
				};

				return montosMinimosPorMoneda[isoMoneda];
			},

			monedaPais: function( isoPais ){
				return {
					'ar'	: 'ARS',
					'br'	: 'BRL',
					'co'	: 'COP',
					'mx'	: 'MXN',
					'pa'	: 'USD',
					'pe'	: 'PEN',
					'cl'	: 'CLP'
				}[isoPais]
			},

			/*
			obtenerIsoPaisDeIsoMoneda: function( isoMoneda ){
				return {
					'ARS'	: 'ar',
					'BRL'	: 'br',
					'COP'	: 'co',
					'MXN'	: 'mx',
					'USD'	: 'pa',
					'PEN'	: 'pe',
					'CLP'	: 'cl'
				}[isoMoneda]			
			},
			*/

			toAmount: function( value ){
				return Math.round( value * 100 );
			},

			obtenerConfiguracionPorPais: function( iso ){
				var paises = this._getConfiguracion().paises();
				return ko.utils.arrayFirst( paises, function( pais ){
					return pais.iso() == iso;
				});
			},
			
			obtenerPrimerConfiguracionValida: function(){
				var primeraConfiguracionValida = this.paisesConfigurados()[0];
			},

			obtenerMonedaCarrito: function( carrito ){
				var monedas = this.obtenerMonedasCarrito( carrito );
				return monedas[0];
			},

			obtenerConfiguracionParaCarrito: function( carrito ){
				var moneda = this.obtenerMonedaCarrito( carrito )
					, configuracion = null
					, isoPais
					, isoMoneda = this.toCurrency( moneda );

				if( isoMoneda ){
					isoPais = this.obtenerIsoPaisDeIsoMoneda( isoMoneda );
					configuracion = this.obtenerConfiguracionPorPais( isoPais );
				}
				
				if( !configuracion && isoMoneda == 'USD' ){
					configuracion = this.obtenerPrimerConfiguracionValida();
				}
				
				return configuracion;
			},

			deshabilitarPais: function( configuracionPais ){
				configuracionPais.accountId('');
				configuracionPais.habilitado(false);
			},

			habilitarPais: function( isoPaisObservable ){
				var isoPais = ko.unwrap( isoPaisObservable )
					, configuracionPais = this.obtenerConfiguracionPorPais( isoPais );
				configuracionPais.habilitado(true);			
			},

			obtenerServiciosHabilitadosMonedas: function( monedas ){
				var moneda = monedas[0]
					, servicio = null
					, isoPais = null
					, isoPaises = []
					, isoMoneda = this.toCurrency( moneda )
					, servicios = {};

				if( isoMoneda && isoMoneda != 'USD' ){
					isoPais = this.obtenerIsoPaisDeIsoMoneda( isoMoneda );
					isoPaises.push(isoPais);
				} else{
					isoPaises = $.pluckCollection( this.paisesConfigurados(), 'iso' );
				}

				$.each( this.servicios(), function( index, servicio ){
					if( ko.utils.arrayIndexOf( isoPaises, servicio.pais() ) != -1 ){
						$.each( servicio.servicios(), function( index, servicio ){
							if( !servicios[servicio.nombre()] ) servicios[servicio.nombre()] = servicio;
						})
					}
				});

				return $.map(servicios, function( value, key ){
					return value;
				});			
			},

			obtenerTodosLosServiciosConfigurados: function(){
				var self = this
					, servicios = {};
				$.each( this.paisesConfigurados(), function( index, pais ){
					$.each( self.obtenerServiciosPorIsoPais( pais.iso() ), function(index, servicio ){
						servicios[ servicio.nombre() ] = servicio;
					});
				});

				return $.map( servicios, function( servicio ){
					return servicio;
				});
			},

			////////////////////////////////////////////////////////////////////
			
			_getConfiguracion: function(){
				return this.configuracion.sandbox() ? this.sandboxData.configuracion : this.configuracion;
			},

			getMerchantIdPorIsoPais: function( isoPais ){
				return ko.unwrap( this.configuracion.sandbox() ? this.obtenerConfiguracionPorPais( isoPais ).merchantId : this._getConfiguracion().merchantId );
			},

			getMerchantIdParaCarrito: function( carrito ){
				var configuracion = this.configuracion.sandbox() ? this.obtenerConfiguracionParaCarrito( carrito ) : this._getConfiguracion();
				return configuracion && ko.unwrap( configuracion.merchantId );
			},
			
			////////////////////////////////////////////////////////////////////////

			getNotifyUrl: function(){
				var onlineUrl = model.data.urlSegura() + 'fronttienda/payuipn/'
					, sandboxUrl = 'http://x073vm20.dattaweb.com/' + model.data.alias() + '/fronttienda/payuipn/';

				if( model.data.urlEstandar().indexOf('dattaweb.com') != -1 ){
					sandboxUrl = model.data.urlEstandar() + 'fronttienda/payuip';
				}

				var URL = this.notifyUrl() ? this.notifyUrl() : ( this.desarrollo() ? sandboxUrl : onlineUrl );
				var query = '';

				if( window.xdebug ){
					query = $.param({
						'XDEBUG_SESSION_START' : 'lisandro'
					});
				}
				return URL + '?' + query;
			},

			getOkUrl: function(){
				return this.getBasePath() + '#!/orden-compra/portal-pagos-payu';
			}
		}
	});
	
	namespace.MetodoPago.Payu.ConfiguracionPais = ko.ViewModel.createSubclass({
		mappeable: {
			iso				: '',
			accountId		: '',
			habilitado		: false
		}
	},{
		init	: function( options ){
			this._parent.apply(this, arguments);
			this._createValidations();
		},
		
		_createValidations: function(){
			var self = this;
			this.accountId.extend({
				number		: true,
				required	: {
					onlyIf	: function(){
						return self.habilitado();
					}
				}
			});
			
			this._parent.apply(this, arguments);
		}
	});
	
	
	// MERCADOPAGO
	namespace.MetodoPago.Mercadopago = namespace.MetodoPago.extend({
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				configuracion		: {
					country_id		: '1',
					client_id		: '',
					client_secret	: ''
				},
				ipnUrl			: '',
				sandboxEnMantenimiento	: false
			});
		},
		
		_setDefaults: function(){
			this._parent();
			this._mergeDefaults({
				serviciosPorPais	: true
			});
		},
				
		init: function(data){
                        data.paisEliminado = false;
                        if(data && data.configuracion && data.configuracion.country_id) //por si queda algun pais que ya no opere con mercadopago
                        {
                            if(!ko.utils.arrayFirst(data.paisesOperantes || [],function(pais){ return pais.id == data.configuracion.country_id }))
                            {
                                data.configuracion.country_id = '1';
                                data.paisEliminado = true;
                            }
                        }
                    
			this._parent.apply( this, arguments );
		},

		_createValidations: function() {
			var self = this;
			
			this.configuracion.client_id.extend({				
				required	: {
					onlyIf: function(){
						return self.habilitado();
					}
				}
			});	
			
			this.configuracion.client_secret.extend({				
				required	: {
					onlyIf: function(){
						return self.habilitado();
					}
				}
			});	
			this._parent();			
		},
		
		_createComputed: function(){
			this._parent.apply( this, arguments );
			this.describe = ko.computed(function(){
                                if(this.paisEliminado())
                                {
                                    if(ko.unwrap( this.configuracion.client_id ) ) return '';
                                }

				var self = this
					, result = []
					, paisOperante = this.obtenerPaisOperantePorId( this.configuracion.country_id() );
				
				if( ko.unwrap( this.configuracion.client_id ) && ko.unwrap( this.configuracion.client_secret ) ){					
					if( paisOperante ) result.push( paisOperante.nombre() );
					if(ko.unwrap( this.configuracion.client_id ) ) result.push(ko.unwrap( this.configuracion.client_id ));
					if( ko.unwrap( this.configuracion.sandbox) )result.push('(sandbox)');
				}
				return result.join('|');
			}, this );
			
			
			this.formUrl = ko.computed(function(){
				var onlineUrl = 'https://www.mercadopago.com/mla/checkout/pay',
					sandboxUrl = 'https://sandbox.mercadopago.com/mla/checkout/pay';
					
				return this.sandbox() ? sandboxUrl : onlineUrl;
			}, this);
			
		},
		
		monedaPais: function( isoPais ){
			return {
				'ar'	: 'ARS',
				'br'	: 'BRL',
				'co'	: 'COP',
				'mx'	: 'MXN',
				've'	: 'VEF',
				'cl'	: 'CLP',
				'pe'	: 'PEN',
				'uy'	: 'UYU'
			}[isoPais]
		},

		/*
		obtenerIsoPaisDeIsoMoneda: function( isoMoneda ){
			return {
				'ARS'	: 'ar',
				'BRL'	: 'br',
				'COP'	: 'co',
				'MXN'	: 'mx',
				'VEF'	: 've',
				'CLP'	: 'cl',
				'PEN'	: 'pe'
			}[isoMoneda]
		},
		*/
		
		// redefino el mtodo de obtener monedas
		obtenerMonedasHabilitadas: function(){			
			var paisOperante = this.obtenerPaisOperantePorId( this.configuracion.country_id() )
				, isoMoneda = this.monedaPais( paisOperante.iso() );
			
			return ko.utils.arrayFilter( this.monedas(), function( moneda ){
				return ko.unwrap( moneda.iso ) == isoMoneda ;
			});	
		},
		
		obtenerUrlConfiguracionIPN: function(){
			var paisOperante = this.obtenerPaisOperantePorId( this.configuracion.country_id() )
				, isoPais = paisOperante && paisOperante.iso();
				
			var urls = {
				'ar'	: 'https://www.mercadopago.com/mla/herramientas/notificaciones',
				'br'	: 'https://www.mercadopago.com/mlb/ferramentas/notificacoes',
				'mx'	: 'https://www.mercadopago.com/mlm/herramientas/notificaciones',
				've'	: 'https://www.mercadopago.com/mlv/herramientas/notificaciones',
				'co'	: 'https://www.mercadopago.com/mco/herramientas/notificaciones',
				'cl'	: 'https://www.mercadopago.com/mlc/herramientas/notificaciones',
				'pe'	: 'https://www.mercadopago.com/mpe/herramientas/notificaciones',
				'uy'	: 'https://www.mercadopago.com/mlu/herramientas/notificaciones'
			};
			
			return urls[isoPais];
		},
		
		obtenerUrlCredenciales: function(){
			var paisOperante = this.obtenerPaisOperantePorId( this.configuracion.country_id() )
				, isoPais = paisOperante && paisOperante.iso()
				, codigoLocale = {
					'ar'	: 'mla',
					'br'	: 'mlb',
					'mx'	: 'mlm',
					've'	: 'mlv',
					'co'	: 'mco',
					'cl'	: 'mlc',
					'pe'	: 'mpe',
					'uy'	: 'mlu'
				};

			return 'https://www.mercadopago.com/' + codigoLocale[isoPais] + '/account/credentials?type=basic';
		},
		
		obtenerMonedaCarrito: function( carrito ){
			var monedas = this.obtenerMonedasCarrito( carrito );
			return monedas[0];
		},

		obtenerServiciosHabilitadosMonedas: function( monedas ){
			var moneda = monedas[0]
				, servicio = null
				, isoPais = null
				, isoPaises = []
				, isoMoneda = this.toCurrency( moneda )
				, servicios = {};
				
			isoPaises = [ this.obtenerIsoPaisDeIsoMoneda( isoMoneda ) ];
			
			$.each( this.servicios(), function( index, servicio ){
				if( ko.utils.arrayIndexOf( isoPaises, servicio.pais() ) != -1 ){
					$.each( servicio.servicios(), function( index, servicio ){
						if( !servicios[servicio.nombre()] ) servicios[servicio.nombre()] = servicio;
					})
				}
			});
			
			return $.map(servicios, function( value, key ){
				return value;
			});			
		},

		obtenerTodosLosServiciosConfigurados: function(){
			var self = this
				, servicios = {}
				, paisOperante = this.obtenerPaisOperantePorId( this.configuracion.country_id() )
				, paisesConfigurados = [paisOperante];
				
			$.each( paisesConfigurados, function( index, pais ){
				$.each( self.obtenerServiciosPorIsoPais( pais.iso() ), function(index, servicio ){
					servicios[ servicio.nombre() ] = servicio;
				});
			});
			
			return $.map( servicios, function( servicio ){
				return servicio;
			});
		},
			
		traducirError: function( error ){
			return i18n.kot({
				'amount cannot be paid with MercadoPago' : 'front:app.metodospago.motivo.el_monto_no_esta_permitido'
			}[error]) || error;
		}		
	});

	//TodoPago
	namespace.MetodoPago.Todopago = namespace.MetodoPago.extend({

		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				configuracion		: {
					country_id: '1',
					merchant_id: '',
					authorization: '',
					merchant_id_sandbox: '',
					authorization_sandbox: '',

					informacionPago: 'Con las tarjetas de crdito y dbito habilitados y hasta en 12 cuotas'
				},
				ipnUrl			: '',
				sandboxEnMantenimiento	: false
			});
		},

		_setDefaults: function(){
			this._parent();
			this._mergeDefaults({
				serviciosPorPais	: true,
				credencialesPublicas: {
					merchant_id_sandbox: '2159',
					authorization_sandbox: 'PRISMA A793D307441615AF6AAAD7497A75DE59'
				}
			});
		},

		init: function(){
			this._parent.apply( this, arguments );
		},

		_createValidations: function() {
			var self = this;

			this.configuracion.merchant_id.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado() && self.configuracion.sandbox() == false;
					}
				}
			});

			this.configuracion.authorization.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado() && self.configuracion.sandbox() == false;
					}
				}
			});

			this.configuracion.merchant_id_sandbox.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado() && self.configuracion.sandbox();
					}
				}
			});

			this.configuracion.authorization_sandbox.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado() && self.configuracion.sandbox();
					}
				}
			});

			this._parent();
		},

		configurarCredencialesPublicas: function(){
			var self = this;

			self.configuracion.merchant_id_sandbox( self.credencialesPublicas.merchant_id_sandbox() );
			self.configuracion.authorization_sandbox( self.credencialesPublicas.authorization_sandbox() );
		},

		/*
		obtenerIsoPaisDeIsoMoneda: function( isoMoneda ){
			return {
				'ARS'	: 'ar'
			}[isoMoneda]
		},
		*/

		obtenerServiciosHabilitadosMonedas: function( monedas ){
			var moneda = monedas[0]
				, isoPaises = []
				, isoMoneda = this.toCurrency( moneda )
				, servicios = {};

			isoPaises = [ this.obtenerIsoPaisDeIsoMoneda( isoMoneda ) ];

			$.each( this.servicios(), function( index, servicio ){
				if( ko.utils.arrayIndexOf( isoPaises, servicio.pais() ) != -1 ){
					$.each( servicio.servicios(), function( index, servicio ){
						if( !servicios[servicio.nombre()] ) servicios[servicio.nombre()] = servicio;
					})
				}
			});

			return $.map(servicios, function( value, key ){
				return value;
			});
		},

		traducirError: function( error ){
			return error;
		},

		puedeProcesarDireccionEnvio: function( carrito ){
			var self = this;
			var result;
			var direccionEnvio = carrito.direccionEnvio;
			result = direccionEnvio && direccionEnvio.pais() == 'AR';
			if( !result ){
				self.motivoNoPuedeProcesarCarrito( 'slo trabaja en Argentina');
			}
			return result;
		},

		puedeProcesarDireccionFacturacion: function( carrito ){
			return this.puedeProcesarDireccionEnvio( carrito );
		}

	});
	
	// CuentaDigital
	namespace.MetodoPago.Cuentadigital = namespace.MetodoPago.extend({
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				configuracion: {
					idCuentaDigital: ''
				}
			});
		},
				
		init: function(){
			this._parent.apply( this, arguments );
		},

		_createValidations: function() {
			var self = this;
			
			this.configuracion.idCuentaDigital.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado();
					}
				}
			});
	
			this._parent();			
		},
				
		_createComputed: function(){
			this._parent.apply( this, arguments );
			this.describe = ko.computed(function(){
				var self = this,
					result = '';
				
				result = this.configuracion.idCuentaDigital();
				return result;
			}, this );
		}
	});

	
	// PAYPAL
	namespace.MetodoPago.Paypal = namespace.MetodoPago.extend({
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				configuracion	: {
					business			: '',
					sandbox				: false,
					business_sandbox	: ''
				}
			});
		},
				
		_setDefaults: function(){
			this._parent();
			this._mergeDefaults({
			});
		},
				
		init: function(){
			this._parent.apply( this, arguments );
		},

		_createValidations: function() {
			var self = this;
			
			this.configuracion.business.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado() && !self.configuracion.sandbox();
					}
				},
				email		: true
			});

			this.configuracion.business_sandbox.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado() && self.configuracion.sandbox();
					}
				},
				email		: true
			});

			this._parent();			
		},

				
		_createComputed: function(){
			this._parent.apply( this, arguments );
			this.describe = ko.computed(function(){
				var self = this,
					result = '';
				
				result = !this.useSandbox() ? this.configuracion.business() : this.configuracion.business_sandbox();
				return result;
			}, this );
			
			
			this.formUrl = ko.computed(function(){
				var onlineUrl = 'https://www.paypal.com/cgi-bin/webscr',
					sandboxUrl = 'https://www.sandbox.paypal.com/cgi-bin/webscr';
					
				return this.useSandbox() ? sandboxUrl : onlineUrl;
			}, this);
		},
				
		toAmount: function( value ){
			return accounting.formatMoney(value,'',2, '', '.');
		},
				
		getNotifyUrl: function(){
			var onlineUrl = model.data.urlSegura() + 'fronttienda/paypalipn/'
				//, sandboxUrl = 'http://200.58.96.16/' + model.data.alias() + '/fronttienda/paypalipn/'
				, sandboxUrl = onlineUrl;

			return this.useSandbox() ? sandboxUrl : onlineUrl;
		},

		useSandbox: function(){
			return this.sandbox() || ko.unwrap( this.configuracion.sandbox );
		}

	});

	
	// DEPOSITOTRANSFERENCIA
	namespace.MetodoPago.Depositotransferencia = namespace.MetodoPago.extend({
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				configuracion: {
					cuentaBancaria	: '',
					condicionesPago	: ''
				}
			});
		},
				
		init: function(){
			this._parent.apply( this, arguments );
		},

		_createValidations: function() {
			var self = this;
			
			this.configuracion.cuentaBancaria.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado();
					}
				}
			});
	
			this._parent();			
		},
				
		_createComputed: function(){
			this._parent.apply( this, arguments );
			this.describe = ko.computed(function(){
				var self = this,
					result = '';
				
				result = $.string.truncate( this.configuracion.cuentaBancaria(), 30 ) ;
				return result;
			}, this );
		}								

	});
	
	
	// ACONVENIR
	namespace.MetodoPago.Aconvenir = namespace.MetodoPago.extend({
		_setMappeable: function(){
			this._parent();
			this._mergeMappeable({
				configuracion: {
					condicionesPago	: ''
				}
			});
		},
				
		init: function(){
			this._parent.apply( this, arguments );
		},

		_createValidations: function() {
			var self = this;
			
			this.configuracion.condicionesPago.extend({
				required	: {
					onlyIf: function(){
						return self.habilitado();
					}
				}
			});
	
			this._parent();			
		},
				
		_createComputed: function(){
			this._parent.apply( this, arguments );
			this.describe = ko.computed(function(){
				var self = this,
					result = '';
				
				result = $.string.truncate( this.configuracion.condicionesPago(), 30 ) ;
				return result;
			}, this );
		}								
	});
	
	
	// CONTRA REEMBOLSO
	namespace.MetodoPago.Contrareembolso = namespace.MetodoPago.Aconvenir.createSubclass({
	}, {
		puedeProcesarCotizacionEnvio: function( carrito ){
			var result = true
				, tipoMetodoEnvio = ko.unwrap( $.getObjectProperty( carrito, 'datosMetodoEnvio.metodoEnvio.tipo') );

			if( tipoMetodoEnvio == 'oca' ){ // no se puede cobrar contra reembolso OCA.
				result = false;
				this.motivoNoPuedeProcesarCarrito ( 'OCA no lo permite' ); //todo: TRADUCIR
			}

			return  result;
		}
	});

}($.namespace('tiendasimple.back'));


/* /js/model_template_personalizado.js
 * compresion time: 2.7802 -(ms)
 * ----------------------------------- */
!function(namespace){
	namespace.TemplatePersonalizable = ko.ViewModel.extend({
		_setMappeable: function(){
			this._parent.apply(this, arguments);
			this._mergeMappeable({
				id				: null,
				nombre			: '',
				version			: '2.3.1',
				tipoTemplate	: '', // universal | personal

				variablesLess	: {
					bootstrap	: {
						'@bodyBackground'					: '',
						'@textColor'						: ''
					},
					
					site	: {
					}
				},
				
				less			: '',
				lessError		: '',
				css				: '',
				
				cssPersonalizado			: '',				
				cssPersonalizadoHabilitado	: true,	
				
				personalizacionBasicaHabilitada	: true
			});
			
			
			var seccion = this._mappeable.variablesLess.site;

			var variableNames = this.getVariableNames();
			$.each( variableNames, function(index, variableName){
				seccion[variableName] = '';
			});
			
		},
		
		_setDefaults: function(){
			this._parent.apply(this, arguments);
			this._mergeDefaults({
				__sanitizedVariables: '',
				
				guardando		: false,
				compilando		: false,
				cargado			: false,
				cargando		: false
			});
		},

		
		init: function(){
			var self = this;
			var __beginEditBkp;
	
			this._parent.apply(this, arguments);
			
			this.css.editable = false;
			this.makeEditable('mappeable');
			

			__beginEditBkp = this.beginEdit;
			this.beginEdit = function(){
				__beginEditBkp.apply( this, arguments );
				this.__sanitizedVariables ( ko.toJSON( this.sanitizedVariables.peek() ) ); // ac se guarda una "fotografa" del estado de las variables, para compararla luego con el estado actual y determinar si hay cambios
			};

			
			this.cssPersonalizado.paraEdicion = this.cssPersonalizado.extend({throttleWithDirty: 1000});
			
			this._createValidations();
			this._createComputed();


			/*
			var variableNames = this.getVariableNames();
			$.each( variableNames, function(index, variableName){
				var variable = self.variablesLess.site[variableName];
				self.variablesLess.site[variableName] = ko.computed({
					read    : function(){
						return variable();
					},
					write   : function( value ){
						var newValue = self.sanitizeVariable( variableName, value );
						variable( newValue );
					}
				})
			});
			*/

		},
		
		_createComputed: function(){
			var self = this,
				mediaList = ['', 'mobile_', 'mobile_landscape_', 'tablet_', 'desktop_'];

			this.variablesLessHasChanges = ko.computed(function(){

				var variablesOriginales = this.__sanitizedVariables()
					, variablesActuales = ko.toJSON(this.sanitizedVariables());

				var hayCambiosDeVariables = variablesOriginales != variablesActuales;
				var hayCambiosDePersonalizacionBasicaHabilitada = ( this.inTransaction() && this.personalizacionBasicaHabilitada.hasChanges() );

				return hayCambiosDeVariables || hayCambiosDePersonalizacionBasicaHabilitada ;  // hay cambios de variables less si cambiaron variables o la habilitacin
			}, this);
			
			
			this.cssPersonalizadoHasChanges = ko.computed( function(){
				//console.debug( 'inTransaction', this.inTransaction(), 'cssPersonalizado.hasChanges', this.cssPersonalizado.hasChanges );
				return this.inTransaction() && ( this.cssPersonalizado.hasChanges() || this.cssPersonalizadoHabilitado.hasChanges() );
			}, this);
			
			this.personalizacionHasChanges = ko.computed(function(){
				return this.variablesLessHasChanges() || this.cssPersonalizadoHasChanges();
			}, this);
			
			this.cssCompleto = ko.computed( function(){
				var result = [];
				if( this.personalizacionBasicaHabilitada() ) result.push( this.css() );
				if( this.cssPersonalizadoHabilitado() ) result.push( this.cssPersonalizado() );
				return result.join('\n');
			}, this);
			
			/////////////////////////////////////
			
			self.modifiedVariablesPerSection = { bootstrap: {}, site: {}};
			
			
			$.each( [ 'htmlBody', 'siteHeader', 'siteBody', 'siteFooter', 'pageHeader', 'pageBody', 'pageFooter' ], function( index, prefix ){				
				self.modifiedVariablesPerSection.site[ prefix ] = ko.computed(function(){
					var result = [];
					$.each( mediaList , function( index, mediaPrefix ) {
						
						$.each(['BackgroundColor', 'BackgroundImage', 'BackgroundPosition', 'BackgroundRepeat', 'BackgroundScale', 'Height', 'Color'], function( index, rulename ){
							var variableName = '@' + mediaPrefix + prefix + rulename;
							if( self.variablesLess.site[ variableName ]() ) {
								result.push( variableName );
							}
						});

						$.each( ['btnDefaultBackgroundColor',   'btnDefaultTextColor',  'btnDefaultBorderColor',
						        'btnPrimaryBackgroundColor',	'btnPrimaryTextColor',	'btnPrimaryBorderColor',
						        'btnInfoBackgroundColor', 	    'btnInfoTextColor', 	'btnInfoBorderColor',
						        'btnSuccessBackgroundColor',    'btnSuccessTextColor', 	'btnSuccessBorderColor',
						        'btnWarningBackgroundColor',    'btnWarningTextColor',	'btnWarningBorderColor',
						        'btnDangerBackgroundColor', 	'btnDangerTextColor', 	'btnDangerBorderColor',
						        'btnInverseBackgroundColor',    'btnInverseTextColor',	'btnInverseBorderColor',
						        'btnLinkTextColor'], function( index, rulename ){

							var variableName = '@' + mediaPrefix + prefix + rulename;
							if( self.variablesLess.site[ variableName ]() ){
								result.push( variableName );
							}
						});
						
					});

					return result;
				}, self );
			});

			self.modifiedVariablesPerSection.site[ 'brand' ] = ko.computed( function(){
				var result = [];
				$.each( mediaList , function( index, mediaPrefix ){
					$.each( [ 'brandLogoWidth', 'brandTitleDisplay', 'brandSubtitleDisplay' ], function( index, rulename ){
						var variableName = '@' + mediaPrefix + rulename;
						if( self.variablesLess.site[ variableName ]() ){
							result.push( variableName );
						}
					});
				});
				return result;
			}, self );
			
			self.modifiedVariablesPerSection.site[ 'navbar' ] = ko.computed( function(){
				var result = [];
				$.each( mediaList , function( index, mediaPrefix ){
					$.each( [ 'navbarBackgroundColor', 'navbarBackgroundImage', 'navbarBackgroundPosition', 'navbarBackgroundRepeat', 'navbarBackgroundScale', 'navbarHeight', 'navbarColor', 'navbarLinkColor', 'navbarBorder' ], function( index, rulename ){
						var variableName = '@' + mediaPrefix + rulename;
						if( self.variablesLess.site[ variableName ]() ){
							result.push( variableName );
						}
					});
				});
				return result;
			}, self );


			this.sanitizedVariables = ko.computed( function(){
				//var chrono = new Chronometer();

				var self = this,
					result = {};

				$.each( $.extend({}, this.variablesLess.bootstrap, this.variablesLess.site) , function( name, rawValue ){
					var value = self.sanitizeVariable( name, rawValue );
					if( value !== undefined ) result[ name ] = value;
				});

				//console.debug("sanitizeVariables", "time", chrono.elapsed().toString());

				return result;
			}, this, {deferEvaluation : true}); //.extend({throttle:1000});
		},
		
		_createValidations: function(){
			var self = this;
			this._parent.apply(this, arguments);
		},
				
				
		////////////////////////////////////////////////////////////////////////

		sanitizeVariable: function( name, rawValue ){
			var value = ko.unwrap(rawValue)
				, reColor = /color$/i
				, reBackground = /background$/i
				, reImage = /image$/i
				, reHeight = /height$/i;


			if( reColor.test(name) ){
				var color = $.xcolor.test(value);
				if(!color){
					value = undefined;
				} else {
					if( color && color.a == 0 ){
						value = 'rgba('+color.r+','+color.g+','+color.b+',0.01)';
					} else {
						value = color.getCSS();
					}
				}
			}

			if( reBackground.test(name) ){
				value = value || undefined;
			}

			if( reImage.test(name)){
				value = value || undefined;
				if( value && value != 'none' && !$.string.startsWith( value, 'url(' ) ) value = 'url("' + value + '")';
			}

			if( reHeight.test(name)){
				if( parseFloat( value ) ) value = parseFloat( value ) + 'px';
				else value = '';
				value = value || undefined;
			}

			return value || undefined;
		},


		toggleImageNone: function( variableLess ){
			if( variableLess() === 'none' ) variableLess('');
			else variableLess( 'none' );
		},
				
		resetVariables: function(){
			this.update( { variablesLess: this._mappeable.variablesLess } );
		},
		
		resetPersonalizacion: function(){
			var self = this;
			
			$.confirm('Est seguro que desea borrar la personalizacin?').done(function(){
				self.update({
					variablesLess: self._mappeable.variablesLess, 
					personalizacionBasicaHabilitada: true 
				});
			});
		},
				
		customVariablesLessFragment: function(){
			var result = [];
			var record = this.sanitizedVariables();
			for ( var name in record ) {				
				result.push(
					((name.slice(0,1) === '@')? '' : '@') + name +': '+ 
					((record[name].slice(-1) === ';')? record[name] : record[name] +';')
				);
			};
			return result.join('\n');
		},
				
		compileLess: function(lessData){
			var self = this,
				def = $.Deferred(),
				lessData = lessData || self.less(),
				str = [ lessData, self.customVariablesLessFragment() ].join('\n'),
				options = {
					compress: false
				};
		
			self.lessError( null );
			self.compilando( true );

			less.render(str, options)
				.then(function(output) {

					// output.css = string of css
					// output.map = string of sourcemap
					// output.imports = array of string filenames of the imports referenced

					self.compilando( false );
					def.resolve(output);

				},
				function(error) {
					self.lessError( error );
					def.reject();
				});

			return def;

		},
		
		corregirCssPersonalizado: function(){
			var css = this.cssPersonalizado();
			if( css ){
				css = $.string.replace( css, 'http://fonts.googleapis.com', 'https://fonts.googleapis.com');
				css = this.corregirRutas(css);
				this.cssPersonalizado( css );
			}

			return css;
		},
				
		cssPersonalizadoTieneContenidoCruzado: function(){
			var css = this.cssPersonalizado() || '';
			
			return css.indexOf('http://') != -1 ;
		},
		
		/*
		* corrige rutas directas al viejo sistema de archivos
		* es equivalente a Application_Model_TemplatePersonalModel.corregirRutas
		*/
		corregirRutas: function(css){
			var pattern = /\/imgmarkets\/(\d+)\/imgsPaginas\/(\d+).imgp/ig
				, sustitucion = 'galeriaimagenes/obtenerimagen/?id=$2'
				, cssOriginal = ko.unwrap(css)
				, cssCorregido = cssOriginal;

			if( cssOriginal ){
				cssCorregido = cssOriginal && cssOriginal.replace(pattern, sustitucion);
			}


			if(cssCorregido != cssOriginal){
				if(ko.isWriteableObservable(css)){
					css.withPausing();
					css.pauseNotifications = true;
					//console.debug('corrigiendo desde ', cssOriginal, 'a', cssCorregido);
					css(cssCorregido);
					css.pauseNotifications = false;
				} else {
					css = cssCorregido;
				}
			}

			return css;
		},

		getVariableNames: function(){
			var mediaList = [ '', 'mobile_', 'mobile_landscape_', 'tablet_', 'desktop_' ]
				, result = [];

			$.each( mediaList, function( index, mediaPrefix ){
				$.each(['htmlBody', 'siteHeader', 'siteBody', 'siteFooter', 'pageHeader', 'pageBody', 'pageFooter'], function(index, prefix) {

					$.each(['BackgroundColor', 'BackgroundImage', 'BackgroundPosition', 'BackgroundRepeat', 'BackgroundScale', 'Height', 'Color'], function( index, rulename ){
						result.push( '@' + mediaPrefix + prefix + rulename ) ;
					});

					$.each(['btnDefaultBackgroundColor', 'btnDefaultTextColor', 'btnDefaultBorderColor',
						'btnPrimaryBackgroundColor',	 'btnPrimaryTextColor',	'btnPrimaryBorderColor',
						'btnInfoBackgroundColor',   	 'btnInfoTextColor', 	'btnInfoBorderColor',
						'btnSuccessBackgroundColor',     'btnSuccessTextColor', 'btnSuccessBorderColor',
						'btnWarningBackgroundColor',     'btnWarningTextColor',	'btnWarningBorderColor',
						'btnDangerBackgroundColor', 	 'btnDangerTextColor', 	'btnDangerBorderColor',
						'btnInverseBackgroundColor',     'btnInverseTextColor',	'btnInverseBorderColor',
						'btnLinkTextColor'], function( index, rulename ){
						result.push( '@' + mediaPrefix + prefix + rulename ) ;
					});
				});

				$.each(['brandLogoWidth', 'brandTitleDisplay', 'brandSubtitleDisplay'], function( index, rulename ){
					result.push( '@' + mediaPrefix + rulename ) ;
				});

				$.each(['navbarBackgroundColor', 'navbarBackgroundImage', 'navbarBackgroundPosition', 'navbarBackgroundRepeat', 'navbarBackgroundScale', 'navbarHeight', 'navbarColor', 'navbarLinkColor', 'navbarBorder'], function( index, rulename ){
					result.push( '@' + mediaPrefix + rulename ) ;
				});
			});

			return result;
		}
			

		
		
	});
	
}($.namespace('tiendasimple'));


/* /js/front/fronttienda_model_producto.js
 * compresion time: 0.03004 -(ms)
 * --------------------------------------- */
$.namespace('tiendasimple.front');

tiendasimple.front.ProductoBase = ko.ViewModel.createSubclass({
	mappeable: {
		id					: null,
		codigo				: null,
		habilitado			: null,
		precio				: null,
		precioSinDescuento	: null,
		stock				: 0,
		idYoutube			: null,
		imagenes			: []
	},

	defaults: {
		openModal: false,
		imagenActualIndex: 0
	},

	mapping: {
		imagenes: {
			create: function (options) {
				return new tiendasimple.back.Producto.Imagen(options.data);
			}
		},

		opcionesAtributos: {
			create: function( options ){
				return new tiendasimple.front.Producto.Opcion.Atributo( options.data );
			}
		}
	}
},{
	createInstance: function( data ){
		var theClass = tiendasimple.front.Producto;
		if( data && data.idPadre ){
			theClass = tiendasimple.front.Producto.Opcion;
		}

		return new theClass( data );
	},

	prototype: {
		init: function () {
			this._parent.apply(this, arguments);

			this._createComputed();
		},

		_createComputed: function () {
			this.imagenes.principal = ko.computed(function () {
				return $.findInCollection(this.imagenes(), function (imagen) {
					return imagen.principal();
				})
			}, this);


			this.imagenes.vacia = new tiendasimple.back.Producto.Imagen();
			this.imagenes.youtube = new tiendasimple.back.Producto.Imagen();


			ko.computed(function () {
				this.imagenes.youtube.path('https://i.ytimg.com/vi/' + this.idYoutube() + '/mqdefault.jpg');
			}, this);


			this.imagenes.representativa = ko.computed(function () {
				var imagen = this.imagenes.principal() || this.imagenes()[0];
				if (!imagen && this.idYoutube()) imagen = this.imagenes.youtube;
				if (!imagen) imagen = this.imagenes.vacia;
				return imagen;
			}, this);


			this.imagenes.subscribe( function( imagenes ){
				this.imagenes().sort($.createSortFN([['principal', 'desc'], 'id']));
			}, this );

			this.imagenes.notifySubscribers();

		},

		obtenerStock: function () {
			return this.stock();
		},

		obtenerPrecioMinimo: function () {
			return this.precio();
		},

		obtenerPrecioMinimoSinDescuento: function () {
			return this.precioSinDescuento();
		},

		obtenerPrecioMaximoSinDescuento: function () {
			return this.precioSinDescuento();
		},

		obtenerPrecioMaximo: function () {
			return this.precio();
		},

		tieneVariosPrecios: function () {
			return false;
		},

		getUrl: function () {
			return $.hashbang.get({producto: this.id()});
		},
                
		obtenerDescripcion: function () {
			return '';
		},

		tieneOpciones: function () {
			return false;
		},



		mostrarPrecioTachado: function ( usarPrecioMaximo ) {
			var opcion = this
				, precio = usarPrecioMaximo ? opcion.obtenerPrecioMaximo() : opcion.obtenerPrecioMinimo()
				, precioSinDescuento = usarPrecioMaximo ? opcion.obtenerPrecioMaximoSinDescuento() : opcion.obtenerPrecioMinimoSinDescuento();

			return precio && precioSinDescuento && precio != precioSinDescuento;
		},

		/////////////////////// imagenes ///////////////////////

		abrirGaleriaImagenes: function (imagen) {
			var self = this;

			this.establecerImagenActual(imagen);
			this.openModal(true);
		},

		cantidadImagenes: function () {
			return this.imagenes().length;
		},

		obtenerImagenActual: function () {
			var imagen = this.imagenes()[this.imagenActualIndex()];
			return imagen;
		},

		obtenerIndexDeImagen: function (imagen) {
			return ko.utils.arrayIndexOf(this.imagenes(), imagen);
		},

		establecerImagenActual: function (imagen) {
			var index = this.obtenerIndexDeImagen(imagen);
			this.imagenActualIndex(index);
		},

		siguienteImagen: function () {
			if (!this.imagenActualEOF()) this.imagenActualIndex(this.imagenActualIndex() + 1);
		},

		anteriorImagen: function () {
			if (!this.imagenActualBOF()) this.imagenActualIndex(this.imagenActualIndex() - 1);
		},

		imagenActualBOF: function () {
			return this.imagenActualIndex() == 0;
		},

		imagenActualEOF: function () {
			return this.imagenActualIndex() == this.cantidadImagenes() - 1;
		},

		indicadorImagenActual: function () {
			return [this.imagenActualIndex() + 1, '/', this.cantidadImagenes()].join('');
		},

		esVendible: function () {
			return false;
		},

		tieneId: function( id ){
			return ko.unwrap( this.id ) == id;
		}

	}
});


tiendasimple.front.Producto = tiendasimple.front.ProductoBase.createSubclass({
	mappeable: {
		idMoneda: null,
		unidadesVenta: null,
		idYoutube: null,
		traducciones: [],
		categorias: [],
                
		stockMinimo: null,
		stockActivado: false,
		stockMostrarInexistentesEnCatalogo: false,
		stockValidarExistencia: false,
		stockMostrarEnProducto: false,
		stockTipoDeCalculo: 'enCheckout',
		stockConfiguracionPersonalizada: false,

		enviable: false,
		pesoUnidad: 'gr',
		pesoValor: null,
		dimensionUnidad: 'cm',
		dimensionAlto: null,
		dimensionAncho: null,
		dimensionProfundidad: null,

		opcionesCantidad		: 0,
		opcionesCantidadTotal	: 0, // incluye las opciones deshabilitadas
		opciones				: [],
		opcionesCargado			: false,
		opcionesAtributos		: [],
		opcionesCantidad		: 0,
		opcionesCantidadTotal	: 0,
		opcionesPrecioMin		: null,
		opcionesPrecioMinSinDescuento		: null,
		opcionesPrecioMax		: null,
		opcionesPrecioMaxSinDescuento		: null,
		opcionesStock			: null
	},

	defaults: {
		agregandoACarrito: false,
		obteniendoDatos		: false
	},

	mapping: {
		traducciones: {
			create: function (options) {
				return new tiendasimple.front.Producto.Traduccion(options.data);
			}
		},

		opciones: {
			create: function ( options ) {
				var opcion = new tiendasimple.front.Producto.Opcion(options.data);
				setTimeout( function(){ opcion.productoPadre( options.parent ); }, 0 );
				return opcion;
			}
		}
	}
}, {
	
	init: function(data){
		this._parent.apply(this, arguments);
		this._createComputed();
		this._createRange();
	},
	
	_createComputed: function(){
		this._parent.apply( this, arguments );

		this.traduccion = ko.computed(function(){
			return this.traducciones()[0];
		}, this);

		
		////////////////////////////////////////////////////////////

		this.imagenes.principal = ko.computed(function(){
			var imagenes = this.imagenes()
				, result;

			if( imagenes.length == 0 ) imagenes = this.opcionesObtenerImagenes();

			result = $.findInCollection( imagenes, function(imagen){
				return imagen.principal();
			});

			return result || imagenes[0];

		}, this);


		////////////////////////////////////////////////////////////
		/*var opcionesAtributos = this.opcionesAtributos;*/

		this.opcionesAtributosDeOpcionesCargadas = ko.computed( function(){
			return this._opcionesObtenerAtributos();
		}, this, { deferEvaluation: true } );


		this.opcionesSeleccionada = ko.computed( function(){
			return this._opcionesSeleccionada();
			/*if( this.opcionesCantidad() == 0 ) return this;
			return this._opcionesObtenerDesdeAtributosSeleccionados( this.opcionesAtributosDeOpcionesCargadas() );*/
		}, this, { deferEvaluation: true }  );

		this.opcionesSeleccionadaNoDisponible = ko.computed( function(){
			return this._opcionesAtributosTienenValores( this.opcionesAtributosDeOpcionesCargadas() ) && !this.opcionesSeleccionada();
		}, this, { deferEvaluation: true } );

		this._addDisposable( this.opcionesAtributosDeOpcionesCargadas );
		this._addDisposable( this.opcionesSeleccionada );
		this._addDisposable( this.opcionesSeleccionadaNoDisponible );

	},

	_createRange: function(){
		//////////////////////////////////////////////////////	
		this.unidadesVenta.toJS = ko.computed(function(){
			var result;
			try{
				result = $.parseJSON(this.unidadesVenta());
			} catch(e){
				result = null; //this.unidadesVenta().split(/[;\s,]+/ig);
			}
			return result;
		}, this);

		this.unidadesVenta.rango = ko.observableRange({start:1, end:10, step:1});
		this.unidadesVenta.personalizado = ko.observable();
		
		this.unidadesVenta.valores = ko.computed({
			read: function(){
				//console.debug('calculando valores de rango');
				var js = this.unidadesVenta.toJS();
				var result = [];
				if(js){
					if($.isArray(js)){
						result = js;
					} else if('start' in js && 'end' in js){
						this.unidadesVenta.rango.start(js.start||1);
						this.unidadesVenta.rango.end(js.end||10);
						this.unidadesVenta.rango.step(js.step||1);
						result = this.unidadesVenta.rango();
					}				
				} else {
					this.unidadesVenta.rango.start(1);
					this.unidadesVenta.rango.end(10);
					this.unidadesVenta.rango.step(1);
					result = this.unidadesVenta.rango()
				}
				return result;
			}, 
			deferEvaluation: true
		}, this);
		
		this.unidadesVenta.valores.seleccion = ko.observable();	
		
	},


	unidadesVentaObtenerValores: function(){
		return this.unidadesVenta.valores();
	},

	unidadesVentaObtenerSeleccion: function(){
		return this.unidadesVenta.valores.seleccion();
	},

	unidadesVentaEstablecerSeleccion: function( valor ) {
		return this.unidadesVenta.valores.seleccion( valor );
	},

	esVendible: function(){
		var result = false;
		if( this.tieneOpciones() && this.tieneOpcionesHabilitadas() ) {
				result = !!this.obtenerPrecioMinimo();
		} else {
			result = this.precio();
		}
		return result;
	},

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// OPCIONES

	/**
	 * devuelve los atributos que tienen las opciones. Toma la primer opcin, dado que todas deben tener los mismos atributos
	 * @returns {Array}
	 * @private
	 */
	_opcionesObtenerAtributos: function(){
		var self = this
			, atributos = {}
			, primerOpcion = this.opciones()[0]
			, result = [];

		$.each( this.opciones(), function( indexOpcion, opcion ){
			$.each( opcion.atributos(), function( index, atributo ){
				var id = atributo.id();
				if( !atributos[ id ] ){
					atributos[ id ] = $.extend({}, atributo);
					atributos[ id ].idValor = ko.observable();
					atributos[ id ].values = ko.observableArray();
					atributos[ id ].valuesFiltered = ko.computed( function(){
						var cantidad = index;
						return self.opcionesObtenerValoresDeAtributoDeSeleccion( id, cantidad).sort($.createSortFN(['orden']));
					}, self, { deferEvaluation: true}  );
				}
				var hasValue = $.indexInCollection( atributos[id].values(), function( value ) { return ko.unwrap( value.id ) == ko.unwrap( atributo.valor.id ) } ) != -1;
				if( !hasValue ){
					atributos[id].values.push( atributo.valor );
				}
			});
		});

		$.each( atributos, function( id, atributo ){
			result.push( atributo );
		});

		result.sort( jQuery.createSortFN(['orden', 'id'])  );

		return result;
	},

	_opcionesObtenerValoresDeAtributo: function( idAtributo, opciones ){
		var opciones = opciones || this.opciones()
			, result = {};

		$.each( opciones, function( index, opcion ){
			var atributo = opcion.obtenerAtributoPorId( idAtributo );
			if( atributo ){
				result[ atributo.valor.id() ] = atributo.valor;
			}
		});

		return $.map( result, function( value, key ){
			return value;
		});
	},

	opcionesObtenerValoresDeAtributoDeSeleccion: function( idAtributo, cantidad ){
		var opciones = this._opcionesObtenerDesdeAtributosSeleccionados( null, true, cantidad );
		return this._opcionesObtenerValoresDeAtributo( idAtributo, opciones );
	},

	_opcionesObtenerValoresDeAtributoDeSeleccion: function( idAtributo, atributos){
	},

	_opcionesSeleccionada: function(){
		if( this.opcionesCantidad() == 0 ) return this;
		return this._opcionesObtenerDesdeAtributosSeleccionados( this.opcionesAtributosDeOpcionesCargadas() );
	},

	_opcionesObtenerDesdeAtributosSeleccionados: function( atributos, multiple, cantidadAtributos ){
		var result
			, atributos = atributos || this.opcionesAtributosDeOpcionesCargadas()
			, fn = multiple ? 'arrayFilter' : 'arrayFirst';

		result = ko.utils[fn]( this.opciones(), function( opcion ){
			var coincide = true;
			$.each( atributos, function( index, atributo ){
				if( cantidadAtributos !== undefined ){
					if( cantidadAtributos <= index ) return false;
				}

				coincide = ko.utils.arrayFirst( opcion.atributos(), function( atributoDeOpcion ){
					var result
						, idValor = ko.unwrap( atributo.idValor ) || ko.unwrap( $.getObjectProperty(atributo, 'valor.id') );
					result = ko.unwrap( atributoDeOpcion.valor.id ) == idValor;
					return result;
				});

				if( !coincide ) return false;
			});
			return coincide;
		});

		return result;
	},

	_opcionesAtributosTienenValores: function( atributos ){
		return !ko.utils.arrayFirst( atributos, function( atributo ){
			return !ko.unwrap( atributo.idValor );
		});
	},

	opcionesObtenerAtributoPorId: function( idAtributo ){
		var atributos = this.opcionesAtributosDeOpcionesCargadas();
		return ko.utils.arrayFirst( atributos, function( atributo ){
			return atributo.id() == idAtributo;
		});
	},

	/*
	values es un array del tipo [{idAtributo: 3, idValor: 2}, {idAtributo: 2, idValor: 3}]
	donde cada elemento del array tiene el id del atributo, y el id del valor del atributo
	 */
	opcionesSeleccionarValoresAtributos: function( values ){
		var self = this;
		if( typeof values == 'string' ){
			values = this._opcionesObtenerValoresAtributosDesdeUrl( values );
		}

		$.each( values, function( index, atributoYValor ) {
			var atributo = self.opcionesObtenerAtributoPorId( atributoYValor.idAtributo );
			atributo && atributo.idValor( atributoYValor.idValor );
		});
	},

	opcionesSeleccionarPorOpcion: function( opcion ){
		if( opcion ) this.opcionesSeleccionarValoresAtributos(opcion.obtenerValoresAtributos());
	},

	opcionesSeleccionarPorIndice: function( index ){
		var opcion = this.opciones()[index];
		return this.opcionesSeleccionarPorOpcion( opcion );
	},

	opcionesSeleccionarPrimerOpcion: function(){
		return this.opcionesSeleccionarPorIndice(0);
	},

	opcionesSeleccionarPorId: function ( id ){
		var opcion = this.opcionesObtenerPorId( id );
		return this.opcionesSeleccionarPorOpcion( opcion );
	},

	opcionesSeleccionarPorPrecioMinimo: function(){
		var opcion = this.opcionesObtenerPorPrecioMinimo();
		this.opcionesSeleccionarPorOpcion( opcion );
	},

	opcionesSeleccionarPorPrecioMaximo: function(){
		var opcion = this.opcionesObtenerPorPrecioMaximo();
		this.opcionesSeleccionarPorOpcion( opcion );
	},



	_opcionesObtenerValoresAtributosDesdeUrl: function( url ){
		var valoresAtributos = url.split('-');

		var valoresAtributos = ko.utils.arrayMap( valoresAtributos, function ( valorAtributo ){
			var re = /a(\d+)v(\d+)/ig
				, valorAtributo = re.exec( valorAtributo )
				, result = {};

			if( valorAtributo && valorAtributo.length == 3 ){
				result = { idAtributo: valorAtributo[1], idValor: valorAtributo[2] };
			}
			return result;
		});

		return valoresAtributos;
	},

	tieneOpciones: function(){
		return this.opcionesCantidadTotal() > 0;
	},

	tieneOpcionesHabilitadas: function(){
		return this.opcionesCantidad() > 0;
	},

	opcionesEnumerarAtributos: function(){
		var nombresDeAtributos = $.pluckCollection( this.opcionesAtributos(), 'nombre' );
		return $.arrayEnumerate( nombresDeAtributos );
	},

	obtenerStock: function(){
		var result = this._parent();
		if( this.tieneOpciones() && this.tieneOpcionesHabilitadas() ){
			if( this.opcionesCargado() ){
				result = 0;
				$.each( this.opciones(), function( index, opcion ){
					result += opcion.stock();
				});
			} else {
				result = this.opcionesStock();
			}
		}
		return result;
	},

	obtenerPrecioMinimo: function(){
		var result = this._parent();
		if( this.tieneOpciones() && this.tieneOpcionesHabilitadas() ){
			result = null;
			if( this.opcionesCargado() ){
				$.each( this.opciones(), function( index, opcion ){
					if( result === null ) result = opcion.precio();
					else {
						if (opcion.precio() && opcion.precio() < result ) result = opcion.precio();
					}
				});
			} else {
				result = this.opcionesPrecioMin();
			}
		}
		return result;
	},

	obtenerPrecioMinimoSinDescuento: function(){
		var result = this._parent();
		if( this.tieneOpciones() && this.tieneOpcionesHabilitadas() ){
			result = null;
			if( this.opcionesCargado() ){
				var opcion = this.opcionesObtenerPorPrecioMinimo();
				result = opcion.precioSinDescuento();
			} else {
				result = this.opcionesPrecioMinSinDescuento();
			}
		}
		return result;
	},

	obtenerPrecioMaximo: function(){
		var result = this._parent();
		if( this.tieneOpciones() && this.tieneOpcionesHabilitadas() ){
			result = null;
			if( this.opcionesCargado() ){
				$.each( this.opciones(), function( index, opcion ){
					if( result === null ) result = opcion.precio();
					else {
						if (opcion.precio() && opcion.precio() > result ) result = opcion.precio();
					}
				});
			} else {
				result = this.opcionesPrecioMax();
			}
		}
		return result;
	},

	obtenerPrecioMaximoSinDescuento: function(){
		var result = this._parent();
		if( this.tieneOpciones() && this.tieneOpcionesHabilitadas() ){
			result = null;
			if( this.opcionesCargado() ){
				var opcion = this.opcionesObtenerPorPrecioMaximo();
				result = opcion.precioSinDescuento();
			} else {
				result = this.opcionesPrecioMaxSinDescuento();
			}
		}
		return result;
	},


	tieneVariosPrecios: function(){
		var result = this._parent();
		if( this.tieneOpciones() && this.tieneOpcionesHabilitadas() ){
			if( this.opcionesCargado() ){
				var primerOpcion = this.opciones()[0];
				if( primerOpcion ){
					var primerPrecio = primerOpcion.precio();
					$.each( this.opciones(), function( index, opcion ){
						if( opcion.precio() != primerPrecio ){
							result = true;
							return false;
						}
					});
				}
			} else {
				result = this.opcionesPrecioMin() != this.opcionesPrecioMax();
			}
		}
		return result;
	},

	tieneDescuento: function(){
		var precioMinimo = this.obtenerPrecioMinimo()
			, precioMinimoSinDescuento = this.obtenerPrecioMinimoSinDescuento();
		return precioMinimo && precioMinimoSinDescuento && precioMinimo != precioMinimoSinDescuento;
	},

	opcionesTienenImagenes: function(){
		return ko.utils.arrayFirst( this.opciones(), function( opcion ){
			return ko.unwrap( opcion.imagenes).length > 0;
		});
	},

	opcionesObtenerImagenes: function(){
		var result = [];
		$.each( this.opciones(), function( index, opcion ){
			result.push.apply( result, opcion.imagenes() );
		});

		return result;
	},

	debeMostrarOpciones: function(){
		return this.tieneOpciones() && ( this.obtenerPrecioMinimo() || this.opcionesTienenImagenes() );
	},

	opcionesTieneMasDeUna: function(){
		return this.tieneOpciones() && this.opcionesCantidad() > 1;
	},

	opcionesObtenerPorId: function( id ){
		return ko.utils.arrayFirst( this.opciones(), function( opcion ){
			return ko.unwrap( opcion.id ) == id;
		});
	},

	opcionesObtenerPorPrecioMinimo: function(){
		var opcionMinima = null;
		ko.utils.arrayForEach( this.opciones(), function( opcion ){
			if( !opcionMinima ){
				opcionMinima = opcion;
			} else {
				if( opcion.precio() ){
					if( opcion.precio() < opcionMinima.precio() || !opcionMinima.precio() ){
						opcionMinima = opcion;
					}
				}
			}
		});
		return opcionMinima;
	},

	opcionesObtenerPorPrecioMaximo: function(){
		var opcionMaxima = null;
		ko.utils.arrayForEach( this.opciones(), function( opcion ){
			if( !opcionMaxima){
				opcionMaxima = opcion;
			} else {
				if( opcion.precio() ){
					if( opcion.precio() > opcionMaxima.precio() || !opcionMaxima.precio() ){
						opcionMaxima= opcion;
					}
				}
			}
		});
		return opcionMaxima;
	},

	tieneOpcionPorId: function( id ){
		return !! this.opcionesObtenerPorId( id );
	},

	tieneId: function( id ){
		return this._parent( id ) || this.tieneOpcionPorId( id );
	},

	opcionesTienenImagenesPropias: function(){
		return !!ko.utils.arrayFirst( this.opciones(), function( opcion ){
			return opcion.tieneImagenesPropias();
		});
	}



});


tiendasimple.front.Producto.Traduccion = tiendasimple.Traduccion.extend({
	init: function(data){
		this._parent.apply(this, arguments);
		
		
		this.tieneDescripcionLarga = ko.computed(function(){
			var descripcionLarga = this.descripcionLarga();
			if(descripcionLarga){
				var $html = $('<div>').append($.parseHTML(descripcionLarga));
				return !!( ($html.find('img, video, iframe').length > 0) || $.trim($.string.decodeHTML($html)) !=='' );
			}
			return false;
		}, this, {deferEvaluation: true});

	},
	
	_setMappeable: function(){
		this._parent.apply(this, arguments);
		this._mergeMappeable({
			descripcion			: null,
			descripcionCorta	: null,
			descripcionLarga	: null			
		});
	}
});


tiendasimple.front.Producto.Opcion = tiendasimple.front.ProductoBase.createSubclass({
	mappeable: {
		idPadre: null,
		atributos	: []
	},

	defaults: {
		productoPadre: null
	},

	mapping: {
		atributos: {
			create: function( options ){
				return new tiendasimple.front.Producto.Opcion.Atributo( options.data )
			}
		}
	}
}, {
	init: function(){
		var self = this;
		this._parent.apply( this, arguments );
		//this._createComputed();
	},

	_createComputed: function(){

		var __imagenes = this.imagenes;
		this.imagenesPropias = this.imagenes;


		this.imagenes = ko.computed( {
			read: function() {
				var imagenes = ko.unwrap(__imagenes);
				if (( imagenes && imagenes.length > 0 ) || !this.productoPadre() || this.productoPadre().opcionesTienenImagenesPropias() ) {
					return imagenes || [];
				} else {
					return this.productoPadre().imagenes();
				}
			},
			write: function( data ){
				return __imagenes( data );
			}
		}, this, { deferEvaluation: true }  );




		this._parent.apply( this, arguments );

		var self = this
			, propertiesFromParent = ['stockConfiguracionPersonalizada', 'stockActivado', 'stockMostrarInexistentesEnCatalogo', 'stockValidarExistencia', 'stockMostrarEnProducto', 'unidadesVenta', 'idMoneda', 'agregandoACarrito'];

		$.each(propertiesFromParent, function( index, propertyName ){
			self[ propertyName ] = ko.computed({
				read: function(){
					return this.productoPadre() && ko.unwrap( this.productoPadre()[ propertyName ] );
				},
				write: function( value ){
					return this.productoPadre() && this.productoPadre()[ propertyName ]( value );
				}
			}, self);

			self._addDisposable( self[ propertyName ] );
		});

		this.descripcion = ko.computed( function(){
			var result = [];
			if ( this.productoPadre() && this.productoPadre().traduccion() ){
				result.push(  this.productoPadre().traduccion().descripcion() );
				result.push( '(' + this.descripcionAtributos() + ')' );
			}
			return result.join(' ');

		}, this);

		this.descripcionAtributos = ko.computed( function(){
			var result = [];
			$.each( this.atributos(), function( index, atributo ){
				result.push( atributo.nombre() + ': ' + atributo.valor.nombre() );
			});
			return result.join(', ');
		}, this, {deferEvaluation: true }  );


	},

	unidadesVentaObtenerValores: function(){
		return ( this.productoPadre() && this.productoPadre().unidadesVentaObtenerValores() ) || [];
	},

	unidadesVentaObtenerSeleccion: function(){
		return ( this.productoPadre() && this.productoPadre().unidadesVentaObtenerSeleccion() );
	},

	unidadesVentaEstablecerSeleccion: function( value ){
		return ( this.productoPadre() && this.productoPadre().unidadesVentaEstablecerSeleccion( value ) );
	},

	obtenerValoresAtributos: function(){
		var atributos = this.atributos();
		var result = ko.utils.arrayMap( atributos, function( atributo ){
			return { idAtributo: atributo.id(), idValor: atributo.valor.id() }
		});
		return result;
	},

	obtenerAtributoPorId: function( idAtributo ){
		return ko.utils.arrayFirst( this.atributos(), function( atributo ){
			return atributo.id() == idAtributo;
		});
	},

	getUrl: function(){
		var valoresAtributos = this.obtenerValoresAtributos();

		valoresAtributos = ko.utils.arrayMap( valoresAtributos, function( valorAtributo ){
			return ['a', valorAtributo.idAtributo , 'v', valorAtributo.idValor].join('');
		});
		var opcion = valoresAtributos.join('-');
		return $.hashbang.get({ producto: this.idPadre() }, { opcion: opcion });
	},

	esVendible: function(){
		return !!this.obtenerPrecioMinimo();
	},

	tieneImagenesPropias: function(){
		return this.imagenesPropias().length > 0;
	}


});
//////////////////////////////////

tiendasimple.front.Producto.Opcion.Atributo = ko.ViewModel.createSubclass({
	mappeable: {
		id			: null,
		nombre		: '',
		tipo		: null,
		valor		: {}
	},

	defaults: {
	},

	mapping: {
		valor : {
			create	: function( options ){
				return new tiendasimple.front.Producto.Opcion.Atributo.Valor( options.data );
			}
		}
	}
}, {
});


tiendasimple.front.Producto.Opcion.Atributo.Valor = ko.ViewModel.createSubclass({
	mappeable: {
		id			: null,
		nombre		: '',
		data		: null
	},

	defaults: {
	},

	mapping: {
	}
}, {

});


/* /js/front/fronttienda_model_unittest.js
 * compresion time: 0.02384 -(ms)
 * --------------------------------------- */
;(function(namespace){
	namespace.UnitTest = ko.ViewModel.extend({
		_setMappeable: function(){
			this._parent.apply( this, arguments );
			this._mergeMappeable({
				nombre		: '',
				descripcion	: '',
				fn			: ''
			});
		},
				
		init: function( data ){
			this._parent.apply( this, arguments );
		},
				
		run: function(){
			this.fn.apply( this, arguments );
		}
	});
	

	////////////////////////////////////////////////////////////////////////////
	
	namespace.UnitTests = ko.ViewModel.extend({
		_setMappeable: function(){
			this._parent.apply( this, arguments );
			this._mergeMappeable({
				tests		: []
			});
		},
				
		init: function( data ){
			this._parent.apply( this, arguments );
		},
				
		createTest: function( options ){
			var test = new namespace.UnitTest( options );			
			this.tests.push( test );
		},
				
		getTestByNombre: function( nombre ){
			return ko.utils.arrayFirst( this.tests(), function( test ){
				return test.nombre() == nombre;
			});
		},
				
		beforeRun: function(){
	
		},
				
		run: function( nombre, args ){
			var test = this.getTestByNombre( nombre );
			if( test ){
				this.beforeRun();
				test.run.apply( test, args );				
			}
		}
	});
	
}($.namespace('tiendasimple.front')));


/* /js/model.js
 * compresion time: 3.31998 -(ms)
 * ------------ */
/**
 * clase base para back y front
 */
;(function( namespace ){
	namespace.ViewModel = ko.ViewModel.extend({
		prototype: {
			init: function(){
				this._parent.apply( this, arguments );

				this._modifyInfuser();
				this._detectBrowserCapabilites();
			},

			_setMappeable: function(){
				this._parent.apply( this, arguments );

				this._mergeMappeable({
					'staticResources'				: {
						'version'					: '',
						'useCookielessDomain'		: false,
						'cookielessURLs'			: [],
						'images'					: {
							'useCookielessDomain'	: true,
							//'cookielessDomains'	: [],
							'cookielessURLs'		: []

						}
					},

					'request'				: {
						'ip'				: {
							'address'		: null,
							'isInternal'	: null
						}
					},

					'urlLibrary'					: {
						'providerURL'				: $.base64.decode('aHR0cHM6Ly9kb253ZWIuY29t'),
						'providerName'				: $.base64.decode('RG9ud2ViLmNvbQ=='),
						'providerShortName'			: $.base64.decode('RG9ud2Vi'),
						'providerHost'				: $.base64.decode('ZG9ud2ViLmNvbQ=='),
						'providerPoweredByLogo'		: $.base64.decode('cG93ZXJlZEJ5RG9ud2ViLnBuZw=='),
						'helpBlogURL'				: $.base64.decode('aHR0cDovL2RvbndlYmF5dWRhLmNvbQ=='),
						'helpBlogHost'				: $.base64.decode('ZG9ud2ViYXl1ZGEuY29t'),

						'builderName'				: $.base64.decode('U2l0aW9TaW1wbGU='),
						'builderBlogURL'			: $.base64.decode('aHR0cDovL2Jsb2cuc2l0aW9zaW1wbGUuY29t')
					},

					'browser'						: {
						'capabilities'				: {
							'navigatorShare'		: false
						}
					}
				});
			},

			/*
			_createComputed: function(){
			},*/

			////////////////////////////////////////////////////////////////////////////

			_modifyInfuser: function(){
				// modifico getTemplatePath para que inyecte la versin en tpl
				(function( infuser ){
					var version = $.getObjectProperty(window,'_serverData.version');
					if( version ) version = 'v_' + version;
					infuser.defaults.getTemplatePath = function(templateOptions) {
						var result;
						var templateFile = templateOptions.templatePrefix + templateOptions.templateId + templateOptions.templateSuffix;
						result = templateOptions.templateUrl === undefined || templateOptions.templateUrl === "" ?
							templateFile : templateOptions.templateUrl + "/" + templateFile;

						var matched = result.match(/\/tpl\/(v_[\w.\d]+)/);
						if( matched && matched[1]){
							version = matched[1];
						} else {
							if( version ){
								result = $.string.replace( result, '/tpl', '/tpl/' + version );
							}
						}
						return result;
					}
				})(infuser);
			},

			_detectBrowserCapabilites: function(){
				this.browser.capabilities.navigatorShare( ( window.navigator && window.navigator.share ) !== undefined && ( window.navigator.share instanceof Function ) );
			},

			_createInfoSitio: function(){
				if( !this.sitio ){
					$.extend( this, {
						'site': {
							'general': {
								'contadorDeVisitas'	: {
									'enable' 	: ko.computed( function(){
										var contadorDeVisitas = ko.unwrap( this.contadorDeVisitas );
										return contadorDeVisitas && ko.unwrap( contadorDeVisitas.habilitado );
									}, this )
								},
								'afipForm960NM'		: {
									'enable'	: ko.computed( function(){
										return !! this.site.general.afipForm960NM.value();
									}, this, { 'deferEvaluation': true } ),
									'value'		: ko.computed( function(){
										return ( this.market.afipForm960NM && ko.unwrap( this.market.afipForm960NM ) );
									}, this, { 'deferEvaluation': true } )
								}
							}
						}
					});
				}
			},

			////////////////////////////////////////////////////////////////////////////

			tieneTienda: function(){
				return this.market.dtTieneTienda();
			},

			////////////////////////////////////////////////////////////////////////////

			paginasObtenerAccesiblePublicoRestringido: function(){
				return this.obtenerPaginas( function( pagina ){ return pagina.accesiblePublico() == false} );
			},

			paginasTieneAlgunaConAccesoPublicoRestringido: function(){
				return this.paginasObtenerAccesiblePublicoRestringido().length > 0;
			},

			////////////////////////////////////////////////////////////////////////////

			productoEsVendible: function( producto ){
				return producto.esVendible();
			},

			productosTipoDeEscala: function( producto ){
				var result = this.market.productosTipoDeEscala();
				if( result == 'fit' ) result = 'contain';
				return result;
			},

			///////////////////////////////////////////////////////////////////////////////
			// its mobile ?

			itsMobile : function(){
				var isMobile = 'ontouchstart' in document.documentElement;
				return isMobile;
			},

			getGalleryPhotoHeight : function(){
				var h = parseInt((screen.height/2));
				return;
			},
			
			productosTipoDeEscalaParaListado: function( producto ){
				return this.market.productosTipoDeEscala();
			},

			productosMostrarDescripcion: function( producto ){
				return this.market.productosMostrarDescripcion();
			},

			productosMostrarDescripcionCorta: function( producto ){
				return this.market.productosMostrarDescripcionCorta();
			},

			productosMostrarImagen: function( producto ){
				return this.market.productosMostrarImagen();
			},

			productosCantidadPorPagina: function( producto ){
				return this.market.productosCantidadPorPagina();
			},

			productosEstanOrdenadosPorPrecioDesc: function(){
				var result = false
					, ordenPrecio;

				ordenPrecio = ko.utils.arrayFirst( this.market.productosOrden(), function( campo ){
					return campo.campo() == 'precio';
				});
				if( ordenPrecio && ordenPrecio.desc() ){
					result = true;
				}
				return result;
			},

			productoSePuedeVender: function( producto ){
				return this.carroComprasHabilitado() && this.productoEsVendible( producto ) && this.productoSePuedeVenderPorStock( producto );
			},

			productoSePuedeVenderPorStock: function( producto ){
				var result = true
					, stockValidarExistencia;

				if( this.productoStockActivado( producto ) ){
					stockValidarExistencia = this.stockValidarExistencia( producto );
					if( !stockValidarExistencia ) result = true;
					else {
						return this.obtenerStockProducto( producto )  >= this.primerValorUnidadesVenta( producto );
					}
				}

				return result;
			},

			productoStockActivado: function( producto ){
				return this.market.stockActivado() && producto.stockActivado();
			},

			obtenerStockProducto: function( producto ){
				var stock = producto.obtenerStock();
				if( this.carrito && this.carrito.esCarrito() ){
					stock = stock - this.obtenerCantidadProductoCarrito( producto );
				}
				return stock;
			},

			obtenerCantidadProductoCarrito: function( producto ){
				var cantidad = 0;

				$.each( ko.unwrap( this.carrito.detalle ), function( index, item ){
					var idPadre = item.producto && ko.unwrap( item.producto.idPadre )
						, id = ko.unwrap( item.idProducto );

					if( producto.tieneId( idPadre ) || producto.tieneId( id )){
						cantidad += Number( ko.unwrap( item.cantidad ) );
					}

				});

				return cantidad;
			},

			mostrarTextoEnStock: function( producto ){
				var productoSePuedeVenderPorStock = this.productoStockActivado( producto ) && this.productoSePuedeVenderPorStock( producto )
					, result = productoSePuedeVenderPorStock;

				if( productoSePuedeVenderPorStock ){
					if( this.stockMostrarEnProducto( producto ) ){
						result = this.obtenerStockProducto( producto ) >= this.primerValorUnidadesVenta( producto )
					}
				}
				return result;
			},

			stockMostrarInexistentesEnCatalogo: function( producto ){
				return producto.stockConfiguracionPersonalizada() ? producto.stockMostrarInexistentesEnCatalogo() : this.market.stockMostrarInexistentesEnCatalogo();
			},

			stockValidarExistencia: function ( producto ){
				return !this.stockMostrarInexistentesEnCatalogo( producto ) ? true : producto.stockConfiguracionPersonalizada() ? producto.stockValidarExistencia() : this.market.stockValidarExistencia();
			},

			stockMostrarEnProducto: function( producto ){
				return producto.stockConfiguracionPersonalizada() ? producto.stockMostrarEnProducto() : this.market.stockMostrarEnProducto();
			},

			///////////////////////////////////////////////////

			primerValorUnidadesVenta: function( producto ){
				var result = null
					, valoresUnidadesVenta = producto.unidadesVentaObtenerValores();

				if( valoresUnidadesVenta.length ){
					result = valoresUnidadesVenta[0];
				}

				return result;
			},

			obtenerUnidadesVentaProducto: function( producto ){
				var unidadesVenta = producto.unidadesVentaObtenerValores()
					, stock
					, stockValidarExistencia = this.stockValidarExistencia( producto );

				if( this.productoStockActivado( producto ) && stockValidarExistencia ){
					stock = this.obtenerStockProducto( producto );
					unidadesVenta = ko.utils.arrayFilter( unidadesVenta, function( value ){
						return value <= stock;
					});
				}

				if( unidadesVenta.length == 0 ) unidadesVenta.push(1);

				return unidadesVenta;
			},

			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			obtenerProductosPorIdDeCache: function( id ){
				var self = this;
				if( !this._obtenerProductoRequestPool ){
					this._obtenerProductoRequestPool  = new tiendasimple.helpers.RequestPool({
						throttle: 300,
						cache	: {
							expires	: 5000
						},
						get: function( aIds ){
							return self.ajaxHelper.obtenerProductosPorId(
								aIds
							).then( function( response ){
								return response.result;
							});
						},
						resultFilter: function( result, request ){
							return result.id == request;
						}
					});
				}

				return this._obtenerProductoRequestPool.get( id ).then( function( producto ){
					return producto;
				});
			},

			////////////////////////////////////////////////////////////////////////////

			mostrarSoloCompartirSocial: function( redSocial ){
				var self = this,
					redesSociales = $.getObjectKeys( this.market.social),
					redesSocialesHabilitadas = ko.utils.arrayFilter( redesSociales, function( redSocial ){
						return self.mostrarCompartirSocial( redSocial );
					});


				return redesSocialesHabilitadas.length == 1 && redesSocialesHabilitadas[0] == redSocial;
			},

			////////////////////////////////////////////////////////////////////////////

			mostrarCompartirSocial: function( redSocial ){
				var self = this
					, configuracion = this.market.social[redSocial]
					, result = true
					, redesSociales;

				if(!redSocial){
					redesSociales = $.getObjectKeys( this.market.social );
					if(redesSociales.length > 0){
						result = false;
						$.each( redesSociales, function( index, redSocial ){
							if( self.mostrarCompartirSocial( redSocial )) {
								result = true;
								return false;
							}
						});
						return result;
					}
				}

				if( configuracion && !ko.unwrap( configuracion.habilitado ) ) result = false;
				return result;
			},

			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			staticResourcesUseCookielessDomainForImages: function(){
				return this.staticResources.useCookielessDomain() && this.staticResources.images.useCookielessDomain() && this.staticResources.images.cookielessURLs().length > 0;
			},

			staticResourcesGetCookielessDomainURLForImages: function(){
				return this.staticResourcesUseCookielessDomainForImages() && this.staticResources.images.cookielessURLs()[0];
			},


			staticResourcesGetCookielessDomainURL: function( url, baseURL ){
				var result = url;
				if( !baseURL ) baseURL = this.staticResources.cookielessURLs()[0];
				if( baseURL && this.staticResources.useCookielessDomain() ){
					if( !$.string.startsWith( url, 'http' ) && !$.string.startsWith( url, '//' ) ){
						var alias = this.alias();
						var urlIsAbsolute = $.string.startsWith( url, '/' );
						result = baseURL + ( urlIsAbsolute ? '' : '/id/' + this.market.idMarket() ) + '/' + $.string.removeAtStart( url, '/' );
					}
				}
				return result;
			},

			staticResourcesGetCookielessDomainImageURL: function( url ){
				var result = url;
				if( this.staticResourcesUseCookielessDomainForImages() ){
					var baseURL = this.staticResourcesGetCookielessDomainURLForImages();
					result = this.staticResourcesGetCookielessDomainURL( url, baseURL );
				}
				return result;
			},

			staticResourcesTranslateCookielessDomainImageURLFromStyle: function( style ){
				var result = $.extend( true, {}, style );
				var backgroundImage = style.backgroundImage;
				if( backgroundImage ){
					var url = $.string.getCSSBackgroundImage( backgroundImage );
					var newUrl = this.staticResourcesGetCookielessDomainImageURL( url );
					result['backgroundImage'] = 'url(' + newUrl + ')';
				}
				return result;
			},

			obtenerURLBaseImagenes: function(){
				var result = this.staticResourcesGetCookielessDomainURLForImages();
				return result || '';
			},

			snippetImagenGet: function( snippet, options ){
				/*
				var useMVC = false;
				var imgURL = $.string.removeAtStart( snippet.get( options ) , '/');
				var urlBase = this.obtenerURLBaseImagenes();
				var result = urlBase + imgURL;
				if( urlBase ){
					var obtenerImagenesWithoutSearch = $.string.trimFromLast( imgURL, '?');
					var search = $.string.trimToLast( imgURL, '?');
					if( useMVC ){
						var searchAsMVC = $.querystring.path.toMVC( imgURL );
						result = urlBase + this.alias() + '/' + searchAsMVC + '/';
					} else {
						result = urlBase + this.alias() + '/' + obtenerImagenesWithoutSearch + '?' + search;
					}
				}
				return result;
				*/

				var url = snippet.get( options );
				result = this.staticResourcesGetCookielessDomainImageURL( url );
				return result;
			},
			
			tieneCompraSinRegistro: function(){
				return ( this.market.dtTieneCompraSinRegistro() == 1 ? true : false );
			},

			tieneBackup : function(){
				return ( this.market.dtTieneBackup() == 1 ? true : false );
			},

		}
	})
})( $.namespace( 'tiendasimple' ) );


/* /js/front/fronttienda_model.js
 * compresion time: 0.0422 -(ms)
 * ------------------------------ */
$.namespace('tiendasimple.front');



tiendasimple.front.Secciones = {
	NOTFOUND			: '404',
	
	CATALOGO			: 'catalogo',
	CHECKOUT			: 'checkout',
	CHECKOUT_RESUMEN	: 'checkout_resumen',
	CHECKOUT_FINALIZAR	: 'checkout_finalizar',
	CHECKOUT_METODOPAGO	: 'checkout_metodopago',
	CHECKOUT_METODOPAGO_OK		: 'checkout_metodopago_ok',
	CHECKOUT_METODOPAGO_ERROR	: 'checkout_metodopago_error',
	CHECKOUT_METODOPAGO_PENDING	: 'checkout_metodopago_pending',
	CARRITO				: 'carrito',
	
	ORDENCOMPRA_CONFIRMAR				: 'ordencompra_confirmar',
	ORDENCOMPRA_ESPERANDOAPROBACION		: 'ordencompra_esperandoaprobacion',
	ORDENCOMPRA_PORTALPAGOS				: 'ordencompra_portalpagos',
	ORDENCOMPRA_PORTALPAGOS_ERROR		: 'ordencompra_portalpagos_error',
	ORDENCOMPRA_PORTALPAGOS_OK			: 'ordencompra_portalpagos_ok',
	
	CONTACTO			: 'contacto',
	CONTACTO_ENVIADO	: 'contacto_enviado',
	PAGINA				: 'pagina',
	BIENVENIDA			: 'bienvenida',
	MI_CUENTA           : 'mi_cuenta',
	BLOG           		: 'blog',
	REGISTRO_INVITADO   : 'registro_invitado',
};


/**
 * ViewModel
 */
tiendasimple.front.ViewModel = tiendasimple.ViewModel.extend({
	_setDefaults: function(){
		this._parent.apply( this, arguments );
		
		this._mergeDefaults({
			apariencia2				: {

			},
			puedeRedireccionarPortalDePagos: false
		});
	},
	
	_setMappeable: function(){
		this._parent.apply( this, arguments );
		
		this._mergeMappeable({
			usarDominioPreferido	: false,
			dominioPropio			: false, // est en true si se ingres por dominio propio
			
			dtHerramientaID			: 'sitiosimple',
			dtHerramienta			: 'SitioSimple',
			dtHerramientaWeb		: 'http://sitiosimple.com',
			dtHerramientaLogoUrl	: '/img/sitiosimple-isologo.png',
			// google reviews
			googleReviews : [],
			googleReviewsState : false,
			// -> end of googleReviews
			// og:title && og:description blog
			ogTitle : '',
			ogDescription : '',
			// -> end of og:title && og:description blog
			// debugger
			debugger : false, 
			// debugger
			cargaInicialRealizada	: false,
			hashEvaluado			: false,
			blank					: false, // si est en true, no se renderiza el sitio

			textoBusquedaProductos	: '',

			alias					: '',
			market					: {},
			usuario					: {},
			categorias				: [],
			productos				: [],
			monedas					: [],
			paginas					: [],
			deshabilitarInteractividad	: false, // Deshabilita interactividad dentro del Iframe de listado de pginas
                        codigoAvanzado                  : '',
			seccionActiva			: '', //tiendasimple.front.Secciones.CATALOGO,
			idProductoActivo        : null, 
			idProducto				: null,
			carrito					: {},
			ultimaOrdenCompra		: null,

			carritos                : [],

			blog					: {},
			files					: {},
			apiEndpoint				: 'https://fileupload.pmtai.com/api/v1/',
			formsFileUploaded       : '',
			formsTokenUpload        : '',
			datosUsuario			: {},
			// Pagina formulario de consulta
			snippet					: {},
			paginaFormulario		: {},
			dominio					: {
				'nombre'			: null,
				'descripcion'		: null,
				'ssl'	 			: false,
				'idSSLCertCA'		: null
			},

			apariencia				: {},
			estructura				: {},

			template				: {},
			categoriasTemplates		: [],

			metodosPago				: [],
			metodosEnvio			: [],
			metodosEnvioHabilitado	: false,

			urlEstandar				: '',
			urlSegura				: '',

			cantidadDeVisitas       : 0,

			geo						: {
				paises				: [],
				regiones			: [],

				paisesCargando		: false,
				paisesCargado		: false,
				regionesCargando	: false,
				regionesCargado		: false

			},

			ajaxCalls: {
				enProgreso			: [],

				obtenerCargaInicial	: false,
				obtenerCategorias	: false,
				obtenerProductos	: false,
				agregarACarrito		: false,
				modificarCarrito	: false,
				enviarEmailContacto	: false,
				recordarPassword	: false,
				cambiarPassword		: false,
				habilitarCliente	: false,
				registrarCliente	: false,
				registrarInvitado	: false,
				guardarCliente      : false,
				loginCliente		: false,
				logoutCliente		: false,
				obtenerContadorDeVisitas    : false,
				obtenerCarritos     : false,
				duplicarCarrito     : false
			},

			ventanas:{
				carrito			: {
					activa		: false
				},

				login				: {
					usuario			: '',
					password		: '',
					noCerrarSesion	: false
				},
				recordarPassword: {},
				recordarPasswordEnviado: {},

				cambiarPassword     : {},

				registro			: {
					email			: '',
					password		: '',
					password2		: '',
					nombre			: '',
					gdpr            : null,
					field1			: '',
					field2			: '',
					field3			: '',
					field4			: '',
					field5			: '',
					field6			: '',
					field7			: '',
					field8			: '',
				},
				invitado: {
					email	 : '',
					password : '',
					password2: '',
					nombre	 : '',		
					apellido : '',
					gdpr	 : null,
					field1	 : '',
					field2	 : '',
					field3	 : '',
					field4	 : '',
					field5	 : '',
					field6	 : '',
					field7   : '',
					field8	 : '',								
				},

				registroCompleto	: {

				},

				validarEmail		: {
					codigo			: ''
				},

				contacto			: {
					nombre			: '',
					email			: '',
					mensaje			: '',
                                        gdpr                    : null,
				},
				
				aparienciaGuardar	: {
				},
				ordendecomprasOpciones	: {
					tipo				: 'agregar'
				},
				errorConfirmarCarro		: {},
				modificarItemsCarro		: {},
				eliminarOrdenCompra		: {},
				ordenCompraCancelada	: {},
				eliminarItemsCarro		: {},
				
				politicaCookiesEs		: {},

				productoElegirOpcion	: {},

				nuevaDireccion          : {},

				datosAdicionales        : {
					apellido            : '',
					telefono            : ''
				},
				galeriaZoom : {
					item:null
				},

				formularioConsulta : {},
				fileuploaderror : {},
			}
		});			
	},
	
	
	_setMapping: function(){
		this._parent.apply( this, arguments );
		
		this._mergeMapping({
			market: {
				create: function(options){
					return new tiendasimple.front.Market(options.data);
				}
			},

			usuario : {
				create: function(options){
					return new tiendasimple.front.Cliente(options.data);
				}
			},

			categorias : {
				create: function(options){
					return new tiendasimple.front.Categoria(options.data);
				}
			},

			productos : {
				create: function(options){
					return new tiendasimple.front.Producto(options.data);
				}
			},

			monedas : {
				create: function(options){
					return new tiendasimple.Moneda(options.data);
				}
			},

			carrito : {
				create: function(options){
					return new tiendasimple.front.Carrito(options.data);
				}
			},

			carritos: {
				create: function(options){
					return new tiendasimple.front.Carrito(options.data);
				}
			},

			apariencia: {
				create: function(options){
					return new tiendasimple.front.Apariencia(options.data);
				}
			},
			

			apariencia2: {
				create: function(options){
					return new tiendasimple.front.Apariencia2(options.data);
				}
			},

			estructura: {
				create: function(options){
					//console.debug('mapear estructura', options.data);
					return new tiendasimple.front.Estructura(options.data);
				}
			},		

			paginas	: {
				create: function(options){
					return tiendasimple.front.Pagina.createInstance(options.data);
				}
			},

			template: {
				create: function(options){
					return new tiendasimple.Template(options.data);
				}
			},

			categoriasTemplates: {
				create: function(options){
					return new tiendasimple.Template.Categoria(options.data);
				}
			},

			////////////////////////////////////////////////////////////////////////

			metodosPago: {
				create: function( options ){
					return tiendasimple.back.MetodoPago.createInstance( options.data );
				}
			},
			
			metodosEnvio: {
				create: function( options ){
					return tiendasimple.front.MetodoEnvio.createInstance( options.data );
				}
			},

			////////////////////////////////////////////////////////////////////////
			ventanas : {
				create: function(options){
					result = {};
					$.each(options.data, function(key, value){
						var clase = tiendasimple.front.Ventana;
						var className = key.substr(0,1).toUpperCase() + key.substr(1);
						if(clase[className]) clase = clase[className];
						result[key] = new clase(value);
					});
					return result;
				}
			}
		});
	},
	
	init: function(data, ajaxHelper){
		this.pageSize = 10;
		this.ajaxHelper = ajaxHelper;
		
		//this._configureValidation();
		
		
		this._parent.apply(this, arguments);
		this._createComputed();
		
		this.usuario.email.publishOn('usuario_email');

		this._createInfoSitio();

	},
	

	_createComputed: function(){
		var self = this;

		this.ajaxCalls.any = ko.computed(function(){
			return this.ajaxCalls.enProgreso().length > 0;
		}, this);
		
		this.ajaxCalls.obtenerCatalogo = ko.computed(function(){
			return this.ajaxCalls.obtenerProductos() || this.ajaxCalls.obtenerCategorias();
		}, this);
		
		this.loading = ko.computed( function(){
			return this.ajaxCalls.any();
		}, this );

		////////////////////////////////////////////////////////////////////////

		// la pgina activa es slo una pgina de tipo snippets, no una pgina de contacto ni de catlogo
		this.paginas.activa = ko.observable();

		// la pgina en visualizacin es una pgina de tipo snippet, catlogo o contacto
		this.paginas.enVisualizacion = ko.computed( function(){
			var seccionActiva = this.seccionActiva(),
				paginaEnVisualizacion = null;
			
			switch( seccionActiva ){
				case 'pagina':
					paginaEnVisualizacion = this.paginas.activa();
					break;
				case 'catalogo':
					paginaEnVisualizacion = this.obtenerPaginaCatalogo();
					break; 
				case 'contacto':
					paginaEnVisualizacion = this.obtenerPaginaContacto();
					break;
				default :
					if (this.paginas().length > 0 ){
						if (this.paginas()[0].tipo() == 'blog'){	
							var arrUrl = window.location.href.split('/#!/');
							if (arrUrl.length == 1){
								$.hashbang.get('/#!/blog/').navigate();
							}
						}
					}
					break;
			}
			return paginaEnVisualizacion;
		}, this);

		this.paginas.paraMenu = ko.computed( function(){
			return ko.utils.arrayFilter( this.paginas(), function( pagina ){
				return ko.unwrap( pagina.tipo ) != 'nolinkeada';
			})
		}, this);
		
		////////////////////////////////////////////////////////////////////////
		
		this.esHome = ko.computed( function(){
			var home = this.paginas()[0];
			
			if( this.seccionActiva() == 'pagina' && this.paginas.activa() ) {				
				if( this.paginas.activa() == home ) return true;				
			}
			if( home && home.tipo() == this.seccionActiva() ) {
				return true;
			}
			return false;
		}, this);
		
		////////////////////////////////////////////////////////////////////////

		this.tituloVentana = ko.computed(function(){
			var paginaEnVisualizacion 			= this.paginas.enVisualizacion(),
				traduccion 						= paginaEnVisualizacion && paginaEnVisualizacion.traduccion(),
				tituloPaginaEnVisualizacion 	= traduccion && traduccion.titulo(),
				tituloMarket 					= this.market.titulo(),
				subtituloMarket 				= this.market.subtitulo(),
				productoSeleccionado 			= this.paginaEnVisualizacionEsDetalleProducto() ? this.productos.seleccionado() : null,
				traduccionProductoSeleccionado	= productoSeleccionado ? productoSeleccionado.tieneOpcionesHabilitadas() ? productoSeleccionado.opcionesSeleccionada() : productoSeleccionado.traduccion() : null,
				descripcionProducto 			= traduccionProductoSeleccionado ? traduccionProductoSeleccionado.descripcion() : '',
				nombreCategoria					= this.paginaEnVisualizacionEsCategoria() ? this.categoriaSeleccionada() && this.categoriaSeleccionada().nombre() : '',
				nombreCategoriaCompleta			= this.paginaEnVisualizacionEsCategoria() ? $.pluckCollection( model.data.categorias.seleccionado.arbol() || [], 'nombre' ).join('  ') : '';
			
			if (traduccion != null && traduccion.tituloseo !== undefined && traduccion.tituloseo() != ""){
				tituloPaginaEnVisualizacion = traduccion.tituloseo();
			}

			if (window.location.href.indexOf('/#!/blog/') > -1){
				if ( this.blog ){
					if ( this.blog.entrada !== undefined && this.blog.entrada().titulo ){
						// tiene una entrada asignada
						if (this.ogTitle !== undefined){
							tituloPaginaEnVisualizacion = this.blog.entrada().titulo;
							this.ogTitle( this.blog.entrada().titulo );
							this.ogDescription( this.blog.entrada().descripcion );
						}
					}
				}
			}

			/*
			var aTitulo = $.arrayExclude([
				this.market.titulo(),
				tituloPaginaEnVisualizacion || this.market.subtitulo(),
				this.esHome() && tituloPaginaEnVisualizacion ? this.market.subtitulo() : '',
				this.paginaEnVisualizacionEsDetalleProducto() ? this.productos.seleccionado().traduccion().descripcion() : ''
			], [null, '']);
			*/

			var aTitulo = [
				tituloMarket,
				tituloPaginaEnVisualizacion || subtituloMarket,
				this.esHome() && tituloPaginaEnVisualizacion ? subtituloMarket : '',
				descripcionProducto,
				nombreCategoriaCompleta
			];

			var aTestHosts = ['d3d3LnN1bmRhcmFtLmNvbS5hcg==', 'c3VuZGFyYW0uY29tLmFy', 'Ym9yZGVyaW8uY29t', 'd3d3LnRvZG9ob2NrZXkuY29tLmFy' ];

			if( true || $.inArray( $.base64.encode( location.hostname ), aTestHosts ) != -1 ){
				aTitulo = [
					descripcionProducto,
					nombreCategoriaCompleta,
					tituloPaginaEnVisualizacion,
					tituloMarket,
					this.esHome() ? subtituloMarket : ''
				];
			}

			var titulo = $.arrayExclude( aTitulo, [null,''] ).join(' | ');
			return titulo || '';
		}, this);
		
		this.descripcionVentana = ko.computed(function(){			
			var paginaActiva = this.paginas.enVisualizacion()
				, result = []
				, traduccion = paginaActiva && paginaActiva.traduccion();
				
			if( this.paginaEnVisualizacionEsDetalleProducto() ) result.push( this.productos.seleccionado().traduccion().descripcionCorta() );
			else {
				result.push( ( traduccion && ( traduccion.descripcion() || traduccion.titulo()) ) || this.market.subtitulo() || this.market.titulo() || 'Visita nuestro sitio web' );
			}
			
			return $.arrayJoinClean(result, ' ');
			
		}, this);
		
		/*
		this.metaDescription = ko.computed(function(){
			var paginaActiva = this.paginas.enVisualizacion()
				, result = ''
				, traduccion = paginaActiva && paginaActiva.traduccion();

			if( this.paginaEnVisualizacionEsDetalleProducto() ) result += this.productos.seleccionado().traduccion().descripcionCorta() + ' | ';
			if( this.esHome() && this.market.subtitulo() ) result += this.market.subtitulo() + ' | ';
			
			result += ( ( traduccion && ( traduccion.metaDescription() ) ) ) || this.descripcionVentana();
			
			return result;
		}, this);
		*/

		this.metaDescription = ko.computed(function(){
			var paginaActiva = this.paginas.enVisualizacion()
				, result = []
				, traduccion = paginaActiva && paginaActiva.traduccion()
				, metaDescription = traduccion && traduccion.metaDescription()
				, metaDescriptionClean = metaDescription && $.trim( metaDescription.replace(/\s+/g, ' ') );

			if( this.paginaEnVisualizacionEsDetalleProducto() ) {
				var descripcion = this.productos.seleccionado().traduccion().descripcionCorta();
				if( !descripcion ){
					descripcion = this.productos.seleccionado().traduccion().descripcion() + ': ' + accounting.formatMoney(this.productos.seleccionado().precio());
				}
				result.push( descripcion );
			}
			if( this.esHome() && this.market.subtitulo() ) result.push( this.market.subtitulo() );

			result.push( metaDescriptionClean || this.descripcionVentana() );

			return $.arrayJoinClean( result, ' | ');
		}, this);

		this.metaKeywords = ko.computed(function(){
			var paginaActiva = this.paginas.enVisualizacion()
				, traduccion = paginaActiva && paginaActiva.traduccion()
				, metaKeywords = traduccion && traduccion.metaKeywords()
				, tieneMetaKeywords = metaKeywords && !!metaKeywords.length;

			//return ko.utils.arrayMap(metaKeywords, function(metaKeyword){return metaKeyword.nombre}).join(', ');
			return tieneMetaKeywords && metaKeywords.join(', ') || '';
		}, this);

		////////////////////////////////////////////////////////////////////////
		
		this.template.previewEstiloCSS = ko.observable();
		this.template.previewTemaCSS = ko.observable();
		
		
		/*
		this.ventanas.apariencia.estilo.css.subscribe(function(css){
			this.apariencia.templateEdicion.estiloEntidad.css(css);
		}, this);

		this.ventanas.apariencia.tema.css.subscribe(function(css){
			this.apariencia.templateEdicion.temaEntidad.css(css);
		}, this);
		*/

		
		////////////////////////////////////////////////////////////////////////

		this.carritos.extend( { recordset: { pageSize:5 } } );
		this.carritos.cargando = ko.observable(false);
		this.carritos.cargado = ko.observable(false);
		this.carritos.seleccionado = ko.observable();
		this.carritos.idOrden = ko.observable();

		////////////////////////////////////////////////////////////////////////

		this.categorias.extend( { recordset: { pageSize:200 } } ); // las categoras prcticamente no paginan
		this.categorias.recordset.productos = ko.observable();
		this.categorias.seleccionado = ko.observable();
		this.categorias.seleccionado.arbol = ko.observableArray();
		this.categorias.cargando = ko.observable(false);
		this.categorias.conProductos = ko.computed(function(){
			return $.findAllInCollection(this.categorias() || [], function(categoria){
				return categoria.cantidadProductos() > 0;
			})
		}, this);
		this.categorias.idActual = ko.observable();
		//this.categorias.conFiltroProductos = ko.observable(false);
		
		////////////////////////////////////////////////////////////////////////
                    
		this.productos.extend({
			recordset:{
				pageSize: this.market.productosCantidadPorPagina(), 
				pagerSize:10,
				orden: this.market.productosOrden()
			}
		});
		this.productos.seleccionado = ko.observable();
		this.productos.cargando = ko.observable(false);
		this.productos.agregandoACarrito = ko.computed(function(){
			var todosLosProductos  = this.productos().concat(this.productos.seleccionado());
			return $.findAllInCollection(todosLosProductos, function(producto){return producto && producto.agregandoACarrito()});
		}, this, {deferEvaluation: true});
		
		this.productos.filtroTexto = ko.observable();
		this.productos.filtroTexto.vacio = ko.computed(function(){
			return !this.productos.filtroTexto();
		}, this);
		
		this.productos.conFiltro = ko.computed(function(){
			return !! this.productos.filtroTexto(); // (this.productos.recordset.filter() || {})['descripcion'];
		}, this);
		
		this.productos.cargado = ko.observable(false);
		
		this.productos.obtenerAlCambiar = ko.observable(false); // indica que debe traerse por ajax la nueva coleccin de productos al cambiar el filtro  la paginacion

		
		this.market.productosOrden.subscribe(function( orden ){
			var idCategoria = this.categorias.seleccionado() && this.categorias.seleccionado().id() || null
				, filtroTexto = this.productos.filtroTexto()
				, filtro = { 'descripcion' : filtroTexto }
				, nuevoFiltro = $.extend( filtro, { idCategoria: idCategoria } );

			if(this.productos.cargado()){
				this.productos.obtenerAlCambiar( true );
				this.productos.recordset.orden( orden );
				this.productos.recordset.filter( nuevoFiltro );
			}
		}, this);
		
		
		
		////////////////////////////////////////////////////////////////////////
		
		this.catalogo = {
			mostrarCategorias: ko.computed(function(){
				return (this.categorias.seleccionado() || this.categorias.conProductos().length > 0)
					&& !(this.productos.filtroTexto() && this.productos().length == 0)
			}, this),

			tienePagina: ko.computed( function(){
				return !!this.obtenerPaginaCatalogo();
			}, this )
		};
		////////////////////////////////////////////////////////////////////////
		
		this.window = ko.observableWindow({steps: {phone:767, tablet: 979, desktop: 9999}});
		
                
                this.pagerSize = function(){
                    var props = this.window();
                    var pagerSize = 10;

                    if(props.width < 980)
                    {
                            pagerSize = 5;
                    }

                    if(props.width < 600)
                    {
                            pagerSize = 3;
                    }

                    return pagerSize;
                };
                
                this.updatePages = function(){
			var pagerSize = self.pagerSize();

			this.productos.recordset.pagerSize(pagerSize);
                        
                        if(this.blog.updateRecordset)
                        {
                            this.blog.updateRecordset(this.blog.record());
                        }
		};
		
		ko.computed(this.updatePages, this);


		////////////////////////////////////////////////////////////////////////
		var __dirty = ko.computed(function(){});
		this.configuracionColor = ko.computed(function(){
			this.template.rutaEstilo();
			this.template.rutaTema();
			__dirty();
			
			var colorNavbar = $('.navbar .navbar-inner').css('background-color')
				, hayBackgroundImage = $('body').css('background-image') != 'none'
				, bodyBackgroundColor = $('body').css('background-color')
				
				, siteBodyBackgroundColor = $.xcolor.test( $('.site-body').css('background-color') )
				, siteBodyBackgroundColorIsTransparent = !siteBodyBackgroundColor || siteBodyBackgroundColor.a == 0
				
				, pageBodyBackgroundColor = $.xcolor.test( $('.page-body').css('background-color') )
				, pageBodyBackgroundColorIsTransparent = !pageBodyBackgroundColor || pageBodyBackgroundColor.a == 0
				, sitePageContentColor = $('.site-page-content').css('color')

				, backgroundColorLegible = null;

			try{
				var backgroundTestColors = [
					{ color: $('.site-footer').css('backgroundColor')        , tests: 0     , name: 'site-footer' },
					{ color: $('.navbar-inner').css('backgroundColor')       , tests: 0     , name: 'navbar-inner' },
					{ color: bodyBackgroundColor                            , tests: 0      , name: 'body' },
					{ color: $.xcolor.darken(bodyBackgroundColor).getCSS()  , tests: 0      , name: 'darken body' },
					{ color: $.xcolor.lighten(bodyBackgroundColor).getCSS() , tests: 0      , name: 'lighten body' },
					{ color: '#fff'                                         , tests: 0      , name: 'white' },
					{ color: '#000'                                         , tests: 0      , name: 'black' }
				];
				var foregroundTestColors = [
					{ color: sitePageContentColor  },
					{ color: $('.site-page-content span').css('color') },
					{ color: $('.site-page-content td').css('color') },
					{ color: $('.site-page-content h3').css('color') },
					{ color: $('.site-page-content h4').css('color') },
					{ color: $('.site-page-content legend').css('color') }
				];
				var invalidColors = [null, undefined, 'transparent']
					, colorCompareFn = function( a, b ) { return a.color == b };

				backgroundTestColors = $.arrayExclude(backgroundTestColors, invalidColors , colorCompareFn );
				foregroundTestColors = $.arrayExclude(foregroundTestColors, invalidColors , colorCompareFn );


				if( hayBackgroundImage && pageBodyBackgroundColorIsTransparent && siteBodyBackgroundColorIsTransparent ){
					if( sitePageContentColor ){
						$.each( backgroundTestColors, function( index, backgroundTestColor ){
							$.each( foregroundTestColors, function( index, foregroundTestColor ){
								if($.xcolor.readable( foregroundTestColor.color, backgroundTestColor.color )){
									backgroundTestColor.tests ++;
								}
							});
							if( backgroundTestColor.tests == foregroundTestColors.length ){
								backgroundColorLegible = backgroundTestColor.color;
								return false;
							}
						});

						if( !backgroundColorLegible ){
							backgroundTestColors.sort( function( a, b ){
								return a.tests < b.tests ? 1 : -1;
							});
							backgroundColorLegible = backgroundTestColors[0].color;
						}

						//window.console && console.debug( backgroundTestColors );
					}

					if( backgroundColorLegible ){
						var backgroundColorLegibleRGBA = $.xcolor.test(backgroundColorLegible).getRGB();
						backgroundColorLegibleRGBA.a = .5;
						backgroundColorLegible = $.xcolor.test( backgroundColorLegibleRGBA ).getCSS();
					}
				}

			} catch( e ){

			}

			
			var response = {
				navbar: {
					bgcolor		: colorNavbar,
					isDark		: $.xcolor.readable(colorNavbar, '#fff' )
				},
				
				icono: {
					bgcolor		: colorNavbar && $.string.trimFirst($.xcolor.test(colorNavbar).getHex(), '#')
				},
				
				backgroundLegible: backgroundColorLegible
			};

			// hack para que navbar-text funcione con templates que no lo tienen bien hecho, copia el estilo de .navvar .nav > li > a
			try{
				$.rule('.navbar-text').text('');
				var styles = $('.nav > li > a').getStyles(['color', 'padding', 'line-height', 'display']);
				$.rule('.navbar-text{}').css(styles).appendTo('style');
				/*
				$.rule('.navbar .nav > li > a, .nav > li > a').each( function( index, rule ) {
					$.rule('.navbar-text').append( $.rule.text(rule) );
				});
				*/
			} catch( e ){

			}
			//
			
			return response;
		}, this).extend({throttle:1000});
		this.configuracionColor.dirty = ko.computed(function(){});
		
		this.configuracionColor.recalcular = function(){
			__dirty.notifySubscribers();
		};
		////////////////////////////////////////////////////////////////////////
		
		this.imagenRepresentativa = ko.computed(function(){
			var width = 300;
			var height = 300;
			
			var url = 'market/logo?width=' + width + '&height=' +  height + '&fit=1&padding=5&color=' + this.configuracionColor().icono.bgcolor;
			if(this.productos.seleccionado()){
				url = model.data.productos.seleccionado().imagenes.representativa().get({width:width, height: height});
			}
			return url;			
		}, this);
		
		this.imagenRepresentativa.absolute = ko.computed(function(){
			return $.string.startsWith(this.imagenRepresentativa(), 'http') ? this.imagenRepresentativa() : document.location.protocol + '//' + document.location.host + window.location.pathname + this.imagenRepresentativa();
		}, this);



		////////////////////////////////////////////////////////////////////////
		
		this.hashbang = ko.observableHashBang();
		
		////////////////////////////////////////////////////////////////////////
		
		// configuracin de accounting
		ko.computed(function(){
			var decimal = this.market.localizacion.number_format.decimal();
			var group = this.market.localizacion.number_format.group();
			var precision = this.market.localizacion.precision();
			
			accounting.settings = {
				currency: {
					symbol : "$",   // default currency symbol is '$'
					format: "%s%v", // controls output: %s = symbol, %v = value/number (can be object: see below)
					decimal : decimal,  // decimal point separator
					thousand: group,  // thousands separator
					precision : precision   // decimal places
				},
				number: {
					precision : 0,  // default precision on numbers is 0
					thousand: group,
					decimal : decimal
				}
			}
		}, this);
				
		////////////////////////////////////////////////////////////////////////
		
		this.bodyClass = ko.computed( function(){
			var bodyClass = [ this.seccionActiva() ]
				, home = this.paginas()[0]
				, pagName;
			
			if( this.seccionActiva() == 'pagina' && this.paginas.activa() ) {
				//pagName = $.string.trimToFirst(this.paginas.activa().getPermalink();
				//$.string.replace( pagName, 'span', 'sppan' );
				//bodyClass.push( 'pag-' + pageName, '-') );
				bodyClass.push( 'pagina-' + this.paginas.activa().id() );
				//if( this.paginas.activa() == home ) bodyClass.push( 'home' );
			}
			
			/*
			if( home && home.tipo() == this.seccionActiva() ) {
				bodyClass.push( 'home' );
			}*/
			if( this.esHome() ){
				bodyClass.push( 'home' );
			}

			return bodyClass.join(' ');
		}, this );
		
		////////////////////////////////////////////////////////////////////////

		this.pixelDeFacebookHabilitado = ko.computed(function(){
			return !!this.market.pixelFacebookScript();
		}, this);

		////////////////////////////////////////////////////////////////////////
		
		this.googleRemarketingPageType = ko.computed( function(){
			var tipoPagina = 'other'
				, home = this.paginas()[0];
			
			if( this.paginas.activa() === home ) tipoPagina = 'home';
			if( this.seccionActiva() === 'catalogo' ){
				if( !this.productos.seleccionado() ){
					tipoPagina = 'category';
				} else {
					if( this.productos.filtroTexto() ){
						tipoPagina = 'searchresults';
					} else {
						tipoPagina = 'product';						
					}
				}
			}
			
			if( this.seccionActiva() === 'carrito'){
				tipoPagina = 'cart';
			}
			
			if( this.seccionActiva().indexOf("checkout")  !== -1 ){
				tipoPagina = 'purchase';
			}
			
			return tipoPagina;			
		}, this );
		
		////////////////////////////////////////////////////////////////////////
		
		this.descripcionMetodoPagoSeleccionado = ko.computed( function(){
			return ko.utils.unwrapObservable( ( this.obtenerMetodoPagoPorId( this.carrito.idMetodoPago() ) || {} ).descripcion );
		}, this );
		
		////////////////////////////////////////////////////////////////////////
		
		this.metodoPagoSeleccionado = ko.computed ( function(){
			return this.obtenerMetodoPagoPorId( this.carrito.idMetodoPago() );
		}, this);
		
		// si est seleccionado un mtodo de pago que no puede procesar el carrito actual, se quita ese mtodo de pago del carrito
		ko.computed( function(){
			var metodoPagoSeleccionado = this.metodoPagoSeleccionado();
			if( metodoPagoSeleccionado && !metodoPagoSeleccionado.puedeProcesarCarrito ( this.carrito )){
				var nombre = metodoPagoSeleccionado.nombre();
				var motivo = metodoPagoSeleccionado.motivoNoPuedeProcesarCarrito();
				window.console && window.console.warn && window.console.warn('el mtodo de pago ' + nombre + ' se quitar del carrito porque no puede procesarlo.', motivo );
				this.carrito.idMetodoPago( null );
			}
		}, this).extend({throttle:100});
		
		////////////////////////////////////////////////////////////////////////
		
		this.carroComprasHabilitado = ko.computed( function(){
			return this.market.tieneProductos() && this.market.usarCarroCompras() && this.market.dtTieneTienda() && this.obtenerPaginaCatalogo() && this.metodosPago().length > 0 ;
		}, this );

		////////////////////////////////////////////////////////////////////////


		this.cargandoContenidos = ko.computed( function(){
			var paginaActiva = this.paginas.activa();
			return !this.hashEvaluado() || ( paginaActiva && !paginaActiva.cargado() );
		}, this);
		
		this.cargandoContenidos.throttled = ko.computed( this.cargandoContenidos ).extend({throttle: 100});
		
		////////////////////////////////////////////////////////////////////////

		this.politicaCookiesUECookie = ko.observableCookie('regional_politicaCookiesUE');

		////////////////////////////////////////////////////////////////////////

		this.contadorDeVisitas = ko.computed(function(){
			var cantidadDeVisitas = this.cantidadDeVisitas()
				, estadisticasVisitas = this.market.configuracion.get('estadisticas_visitas')
				, tema = estadisticasVisitas && estadisticasVisitas.tema() || 'default'
				, valorInicial = estadisticasVisitas && estadisticasVisitas.valorInicial() || 0
				, habilitado = estadisticasVisitas && estadisticasVisitas.habilitado() || false;

			return {
				visitas         : cantidadDeVisitas,
				tema            : tema,
				valorInicial    : valorInicial,
				habilitado      : habilitado,
				visitasTotales  : parseInt( valorInicial ) + parseInt( cantidadDeVisitas )
			};

		}, this);

		////////////////////////////////////////////////////////////////////////

		this.seccionActivaRequiereLegilibilidad = ko.computed( function(){
			var seccionActiva = this.seccionActiva()
				, esCarrito		= seccionActiva.indexOf('carrito') != -1
				, esOrdenCompra = seccionActiva.indexOf('ordencompra') != -1;
				
			return esCarrito || esOrdenCompra;
		}, this);

		////////////////////////////////////////////////////////////////////////////////////////////////////////////////

		this.idCotizacionEnvioSeleccionada = ko.computed({
			read	: function(){
				var  result
					, idCotizacionPadre = this.carrito.idCotizacionEnvioPadre()
					, cotizacion;

				if( idCotizacionPadre ){
					cotizacion = this.obtenerCotizacionEnvioPorId( idCotizacionPadre );
					if( cotizacion ){
						if( cotizacion.cotizaciones().length > 0 ){
							//console.debug('buscando cotizaciones de ', idCotizacionPadre)
							result = cotizacion.idCotizacionEnvioSeleccionada();
						} else {
							result = cotizacion.id();
						}
					}
				}

				return result;
			},

			write: function( idCotizacion ){
				var encontrada = false;
				$.each( self.metodosEnvio(), function( index, metodoEnvio ){
					$.each( metodoEnvio.cotizaciones(), function( index, cotizacion ){
						if( cotizacion.id() == idCotizacion ){
							self.carrito.idCotizacionEnvioPadre( idCotizacion );
							encontrada = true;
							return false;
						} else {
							var subCotizacion = cotizacion.obtenerCotizacionEnvioPorId( idCotizacion );
							if( subCotizacion ){
								self.carrito.idCotizacionEnvioPadre( cotizacion.id() );
								cotizacion.idCotizacionEnvioSeleccionada( idCotizacion );
								encontrada = true;
								return false;
							}
						}
					});
					if( encontrada ) return false;
				});
			}
		}, this);

		/////////////////////////////////////////////////////////////////

		this.idCotizacionEnvioSeleccionada.subscribe( function( value ){
			this.carrito.idCotizacionEnvio( value );
		}, this );

		//////////////////////////////////////////////////


		var _anclasEnPantallaRecalculator = ko.observable();
		this.paginas.enVisualizacion.anclasEnPantalla = ko.computed( function(){
			_anclasEnPantallaRecalculator();
			//console.debug('anclasEnPantalla');
			return $('[ancla]').toArray();
		}, this );
		this.paginas.enVisualizacion.anclasEnPantalla.recalc = function(){
			if( !self.paginas.enVisualizacion.nombreAnclaActiva.scrolling.peek() ) {
				_anclasEnPantallaRecalculator.notifySubscribers();
			}
		}

		var _anclaActivaRecalculator = ko.observable();
		var _nombreAnclaActiva = ko.computed({
			read: function(){
				_anclaActivaRecalculator();
				var anclas = this.paginas.enVisualizacion.anclasEnPantalla();
				var anclaAnterior;
				var activeTopPosition = tiendasimple.Snippet.Ancla.getActiveTopPosition() + 20;
				$.each( anclas, function( index, seccion ){
					var outsideInfo = $(seccion).isOutsideWindow();
					if( outsideInfo.absoluteTop < activeTopPosition ){
						anclaAnterior = seccion;
					} else {
						return false;
					}
				});

				var anclaActiva = anclaAnterior && ko.dataFor( anclaAnterior );
				return anclaActiva && anclaActiva.data.nombre();
			}
		}, this );

		this.paginas.enVisualizacion.nombreAnclaActiva = ko.observable().extend({ preserveChange: true });
		this.paginas.enVisualizacion.nombreAnclaActiva.scrolling = ko.observable( false );


		_nombreAnclaActiva.subscribe( function( value ){
			if ( typeof(value) != 'undefined' ) {
				this.paginas.enVisualizacion.nombreAnclaActiva( value );
			}
		}, this );

		this.paginas.enVisualizacion.nombreAnclaActiva.recalc = function(){
			if( !self.paginas.enVisualizacion.nombreAnclaActiva.scrolling.peek() ){
				_anclaActivaRecalculator.notifySubscribers();
			}
		}

		this.paginas.enVisualizacion.paginasDeTipoEnlaceAPagina = ko.computed( function(){
			//var c = new Chronometer();
			var pagina = this.paginas.enVisualizacion();
			var result = [];
			if( pagina ){
				result = this.obtenerPaginasDeTipoEnlaceAPagina( pagina.id() );
			}
			//console.debug( 'paginasDeTipoEnlaceAPagina', c.elapsed() );
			return result;
		}, this );

		this.paginas.enVisualizacion.paginasDeTipoEnlaceAPagina.enVisualizacion = ko.computed( function(){
			//var c = new Chronometer();
			var result = [];
			var nombreAnclaActiva = this.paginas.enVisualizacion.nombreAnclaActiva();
			if( nombreAnclaActiva ) {
				result = ko.utils.arrayFilter( this.paginas.enVisualizacion.paginasDeTipoEnlaceAPagina(), function( pagina ){
					var traduccion = pagina.traduccion();
					return traduccion.enlace.asJS.ancla() == nombreAnclaActiva;
				});
			}
			//console.debug( 'paginasDeTipoEnlaceAPagina.enVisualizacion', c.elapsed() );
			return result;
		}, this );

		/////////////////////////////////////////////////

		this.paginas.activas = ko.computed( function(){
			return this.obtenerPaginasActivas();
		}, this );
	},
	
	nuevoProducto: function(data){
		return new tiendasimple.front.Producto(data);
	},
	


    cambiarCantidadProductoSeleccionado: function( cantidad, productoSeleccionado ){
        var productoSeleccionado = productoSeleccionado || this.productos.seleccionado()
            , unidadesVentaProducto = this.obtenerUnidadesVentaProducto( productoSeleccionado )
            , valorSeleccionado = productoSeleccionado.unidadesVentaObtenerSeleccion() || 1
            , nuevaPosicion = unidadesVentaProducto.indexOf( valorSeleccionado ) + cantidad
            , nuevoValor = unidadesVentaProducto[ nuevaPosicion ];

        productoSeleccionado.unidadesVentaEstablecerSeleccion( nuevoValor );
    },

    validarCantidadProductoSeleccionado: function( direccion, productoSeleccionado ){
        var productoSeleccionado = productoSeleccionado || this.productos.seleccionado()
            , unidadesVentaProducto = this.obtenerUnidadesVentaProducto( productoSeleccionado )
            , valorSeleccionado = productoSeleccionado.unidadesVentaObtenerSeleccion()
            , posicionActual = unidadesVentaProducto.indexOf( valorSeleccionado )
            , result = false;

        if( direccion == 1 ) {
            result = posicionActual < unidadesVentaProducto.length - 1;
        }
        if( direccion == -1 ) {
            result = posicionActual > 0;
        }
        return result;
    },
    validarCantidadProductos:function(productoSeleccionado,cant){
        var c = parseInt(cant());

        if (c<1 || isNaN(c))
        {         
            c=1;
            cant(c);
            return true;
        
        } else if (c>1000)
        {            
            c=c;
        }       
        
        if((this.obtenerStockProducto(productoSeleccionado)>0 && productoSeleccionado.stockActivado()==true))
        {
            if (c>this.obtenerStockProducto(productoSeleccionado) && this.stockValidarExistencia(productoSeleccionado))
            {               
                c=this.obtenerStockProducto(productoSeleccionado);                
            }
        }
        
        cant(c);
        return true;
    },


	
	actualizarStockProducto: function( idProducto, stock ){
		var producto = this.obtenerProductoPorId( idProducto ),
			itemCarrito = this.obtenerItemCarritoPorIdProducto ( idProducto );
	
		producto && producto.stock( stock );
		if( itemCarrito ){
			if( itemCarrito.cantidad() > stock ){
				itemCarrito.cantidad.nuevoValor( stock );
				//if( stock == 0 ){
				//	this.carrito.detalle.remove( itemCarrito );
				//}
			}
		}
	},
			
	obtenerProductoPorId: function( id ){
		return ko.utils.arrayFirst( this.productos(), function( producto ){
			return ko.unwrap( producto.id ) == id;
		});
	},

	obtenerUrlCatalogoActual: function(){
		var idCategoria = ( model.data.categoriaSeleccionada() && model.data.categoriaSeleccionada().id() ) || 0
			, pagina = model.data.productos.recordset.absolutePage()
			, filtroTexto = model.data.productos.filtroTexto();

		return $.hashbang.get({
			categoria	: idCategoria, 
			pagina		: pagina
		}, {
			filtro		: filtroTexto
		} ).toString();
	},

	////////////////////////////////////////////////////////////////////////////
	
	obtenerMonedaPorId: function(id){
		return $.findInCollection(this.monedas() || [], function(moneda){
			return moneda.id() == id;
		});
	},
	
	obtenerSimboloMonedaPorId: function(id){
		var moneda = this.obtenerMonedaPorId(id);
		return moneda && moneda.simbolo();
	},

	formatearFecha: function( cadena ){
		var fecha = Date.parse( cadena );
		return fecha ? fecha.toString('dd/MM/yyyy') : '';
	},

	formatearHora: function( cadena ){
		var fecha = Date.parse( cadena );
		return fecha ? fecha.toString('HH:mm') : '';
	},

	formatearFechaYHora: function( cadena ){
		return [ this.formatearFecha( cadena ), this.formatearHora( cadena ) ].join(' ');
	},

	obtenerRepresentacionMonedaPorId: function( idMoneda ){
		var moneda = this.obtenerMonedaPorId( idMoneda );
		return moneda && moneda.representacion();		
	},


	obtenerMonedaPrecioFormateado: function(items){
		var self = this
			, arr = []
			, result = null;

		ko.utils.arrayForEach(items, function(item){
			var precioMoneda = [self.obtenerSimboloMonedaPorId( item.idMoneda() ), accounting.formatMoney(item.importe(), '')];
			arr.push(precioMoneda.join(' '));
		});

		if( arr.length ) result = '(' + arr.join(' + ') + ')';

		return result;
	},

	////////////////////////////////////////////////////////////////////////////
	
	categoriaSeleccionada: function(categoria){
		if(categoria !== undefined) {
			if(! (categoria instanceof tiendasimple.front.Categoria)){
				if(categoria && categoria.id) categoria = new tiendasimple.front.Categoria(categoria);
				else categoria = null;
			}
			this.categorias.seleccionado(categoria);			
		} else return this.categorias.seleccionado();
	},
	
	////////////////////////////////////////////////////////////////////////////
	
	direccionCarrito: function(){
		var direccionId = this.carrito.idDireccionEnvio();
		return this.usuario.obtenerDireccionPorId(direccionId);
	},
			
	obtenerItemCarrito: function( idItem ){
		return ko.utils.arrayFirst( this.carrito.detalle(), function( item ) {
			return ko.unwrap( item.id ) == idItem;
		});
	},
	
	obtenerItemCarritoPorIdProducto: function( idProducto ){
		return ko.utils.arrayFirst( this.carrito.detalle(), function( item ) {
			return ko.unwrap( item.idProducto ) == idProducto;
		});
	},
	
	redireccionarPortalDePagos: function(){
		return this.carrito.enPortalDePagos() && this.metodoPagoSeleccionado() && this.puedeRedireccionarPortalDePagos();
	},
	
	////////////////////////////////////////////////////////////////////////////
	obtenerPaginas: function(fn, paginas, options){
		var paginas = paginas || this.paginas,
			self = this,
			result = [];

		options = $.extend({
			excluirNoLinkeadas: false
		}, options );

		paginas = ko.utils.unwrapObservable( paginas );
		$.each( paginas, function( index, pagina ){
			if( options.excluirNoLinkeadas && pagina.tipo() == 'nolinkeada' ){

			} else {
				if( fn( pagina ) ) {
					result.push( pagina);
				}

				var subPaginas = pagina.subPaginas();
				if ( subPaginas.length > 0 ){
					var paginasEncontradasEnSubpaginas = self.obtenerPaginas( fn, pagina.subPaginas, options );
					if( !$.isEmptyObject( paginasEncontradasEnSubpaginas ) ){
						result = result.concat( paginasEncontradasEnSubpaginas );
					}
				}
			}

			if( options.onlyFirst ){
				if( result.length == 1 ){
					return false;
				}
			}

			//if( result ) return false;
		});

		if( options.onlyFirst ){
			return result[0];
		}

		return result;
	},

	obtenerPagina: function(fn, paginas, options){
		return this.obtenerPaginas( fn, paginas, $.extend({}, options, { onlyFirst: true }));
	},
	
	obtenerPaginaPorId: function( id ){
		return this.obtenerPagina( function ( pagina ){
			return pagina.id() == id;
		});
	},
	
	obtenerPaginaCatalogo: function(){
		return this.obtenerPagina(function(pagina){return pagina.tipo() == 'catalogo'});
	},
	
	obtenerPaginaContacto: function(){
		return this.obtenerPagina(function(pagina){return pagina.tipo() == 'contacto'});
	},

	obtenerPaginaBlog : function(){
		pagina = this.obtenerPagina(function(pagina){return pagina.tipo() == 'blog'});
		return pagina;
	},

	obtenerPaginaHome: function(){
		return this.obtenerPagina(
			function(pagina){
				return $.inArray( pagina.tipo(), ['enlace', 'nolinkeada', 'carpeta'] ) == -1;
			}, null, { excluirNoLinkeadas: true }
		);
	},
	
	obtenerPaginaPorPrettyLink: function( prettyLink ){
		return this.obtenerPagina( function( pagina ){
			return pagina.tieneEstePrettyLink( prettyLink );
		});
	},

	obtenerPaginaPorHashbang: function( hashbang ){

	},

	/**
	 *
	 * @param idPagina pgina a la que linkea
	 * @param seccion seccin a la que linkea
	 */
	obtenerPaginasDeTipoEnlaceAPagina: function( idPagina, ancla ){
		var args = arguments;
		var result = this.obtenerPaginas( function( pagina ){
			if( pagina instanceof tiendasimple.Pagina.Enlace ){
				var traduccion = pagina.traduccion();
				if( traduccion && traduccion.enlace.asJS.tipo() == tiendasimple.helpers.Enlace.TIPO_PAGINA ){
					if( args.length == 0 ){
						return true
					} else if( args.length == 1 ){
						return traduccion.enlace.asJS.idPagina() == idPagina;
					} else if( traduccion.enlace.asJS.idPagina() == idPagina && traduccion.enlace.asJS.ancla() == ancla ){
						return true;
					}
				}

			}
		});
		return result;
	},

	obtenerPaginasActivas: function(){
		var result;
		var paginasConEsteId = this.obtenerPaginasActivasConEsteId();
		var paginasDeTipoEnlaceAPaginas = this.obtenerPaginasDeTipoEnlaceAPaginaActivas();
		if( paginasDeTipoEnlaceAPaginas.length > 0 ){
			result = paginasDeTipoEnlaceAPaginas;
		} else {
			result = paginasConEsteId;
		}
		return result;
		//return $.arrayExclude( paginasConEsteId.concat( paginasDeTipoEnlaceAPaginas ),[undefined] ) ;
	},

	obtenerPaginasActivasConEsteId: function(){
		var paginaEnVisualizacion = this.paginas.enVisualizacion();
		var idPaginaEnVisualizacion = paginaEnVisualizacion && paginaEnVisualizacion.id();

		var paginas = $.arrayExclude( this.obtenerPaginas( function( pagina ){
			return pagina.id() == idPaginaEnVisualizacion;
		}), [ undefined ] );

		return paginas.concat( this.obtenerPaginasPadresDePaginas( paginas ) );

	},

	obtenerPaginasDeTipoEnlaceAPaginaActivas: function(){
		var paginaEnVisualizacion = this.paginas.enVisualizacion();
		var idPaginaEnVisualizacion = paginaEnVisualizacion && paginaEnVisualizacion.id();
		var nombreSeccionActivaDePaginaEnVisualizacion = this.paginas.enVisualizacion.nombreAnclaActiva();
		var paginasDeTipoEnlaceAPagina = this.obtenerPaginasDeTipoEnlaceAPagina( idPaginaEnVisualizacion, nombreSeccionActivaDePaginaEnVisualizacion );

		var paginas = $.arrayExclude( paginasDeTipoEnlaceAPagina ,[undefined] ) ;

		return paginas.concat( this.obtenerPaginasPadresDePaginas( paginas ) );
	},

	obtenerPaginasPadresDePaginas: function( paginas ){
		var self = this,
			idPadres = [],
			result;

		$.each( paginas, function( index, pagina ){
			var idPadre = pagina.idPadre();
			if( idPadre ) idPadres.push( idPadre );
		});

		idPadres = $.arrayUnique( idPadres );
		result = ko.utils.arrayFilter( this.paginas(), function( pagina ){
			return $.inArray( pagina.id(), idPadres ) != -1;
		});

		return result;
	},

	/*paginaEstaActiva: function( paginaBuscada ){
		//return false;
		var paginasActivas = this.paginas.activas();
		paginaEncontrada = paginaBuscada && ko.utils.arrayFirst( paginasActivas , function( pagina ){
			return pagina && paginaBuscada && pagina.id() == paginaBuscada.id();
		});
		//console.debug( paginaEncontrada && paginaEncontrada.describe() );
		return !!paginaEncontrada;
	},
	*/

	// determina si una pgina est activa en el men
	paginaEstaActivaEnMenu: function( paginaBuscada ){
		var self = this;
		var result = false;
		var paginaEnVisualizacion = this.paginas.enVisualizacion();

		if( paginaEnVisualizacion ){
			if( paginaBuscada instanceof tiendasimple.Pagina.Enlace ){
				var paginasEnlaceEnVisualizacion = this.paginas.enVisualizacion.paginasDeTipoEnlaceAPagina.enVisualizacion();
				result = !!ko.utils.arrayFirst( paginasEnlaceEnVisualizacion, function( pagina ){
					return pagina.id() == paginaBuscada.id();
				});
			} else {
				var noHayPaginasDeTipoEnlaceAPaginaEnVisualizacion = this.paginas.enVisualizacion.paginasDeTipoEnlaceAPagina.enVisualizacion().length == 0;
				result = noHayPaginasDeTipoEnlaceAPaginaEnVisualizacion && paginaBuscada.id() == paginaEnVisualizacion.id();
			}
		}

		if( result == false ){
			var subpaginas = paginaBuscada.subPaginas();
			if( subpaginas.length > 0 ){
				result = !!ko.utils.arrayFirst( subpaginas, function( subpagina ){
					return self.paginaEstaActivaEnMenu( subpagina );
				});
			}
		}

		return result;
	},
			
	paginaTieneContenido: function( pagina ){
		var contenido = pagina && pagina.traducciones() && pagina.traducciones()[0] && pagina.traducciones()[0].contenido
			, snippets = contenido.data && contenido.data.snippets;
		
		return snippets && snippets().length > 0;
	},
			
	paginaEsAccesible: function( pagina ){
		/* acceso restringido manualmente */
		if (this.usuario.puedeverpaginaprivada !== undefined){
			if (this.usuario.puedeverpaginaprivada() == 1) return true;
			var verificarclientemanualmente = this.usuario.puedeverpaginaprivada();
			if ( this.usuario.puedeverpaginaprivada() != 1 && pagina.accesiblePublico() == false){
				return false;
			}
		}
		var usuarioLogueadoYHabilitado = this.usuario.logueado() && this.usuario.habilitado()
			, modoPreview = !!this.market.adminPreviewKey();
		return pagina && ( modoPreview || ( pagina.accesibleClientes() &&  usuarioLogueadoYHabilitado ) || ( pagina.accesiblePublico() && !usuarioLogueadoYHabilitado ) );
	},

	paginaBlogEsAccesible : function(){
		var self = this;
		var paginaBlog = {};
		model.data.paginas().forEach(function(pagina){
			if (pagina.tipo() == 'blog'){ 
				paginaBlog = pagina; 
			}else{
				if (pagina.subPaginas().length >=1){
					pagina.subPaginas().forEach(function(subpagina){
						if (subpagina.tipo() == 'blog'){
							paginaBlog = subpagina;
						}
					});
				}
			}
		});
		if (paginaBlog.id === undefined || paginaBlog.id() === undefined){
			return false;
		}
		var usuarioLogueadoYHabilitado = self.usuario.logueado() && self.usuario.habilitado();
		var esAccesible = self.paginaEsAccesible( paginaBlog );
		if (!esAccesible){
			if (usuarioLogueadoYHabilitado){
				esAccesible = true;
			}
		}
		return esAccesible;
	},

	paginaEnVisualizacionEsDetalleProducto: function(){
		var paginaEnVisualizacion = this.paginas.enVisualizacion()
			, result = false;
			
		if( paginaEnVisualizacion ){
			if( ko.unwrap( paginaEnVisualizacion.tipo ) == 'catalogo' && ko.unwrap( this.productos.seleccionado ) ){
				result = true;
			}
		}
		
		return result;
	},
	
	paginaEnVisualizacionEsCategoria: function(){
		var paginaEnVisualizacion = this.paginas.enVisualizacion()
			, result = false;

		if( paginaEnVisualizacion ){
			if( ko.unwrap( paginaEnVisualizacion.tipo ) == 'catalogo' && !ko.unwrap( this.productos.seleccionado ) ){
				result = true;
			}
		}

		return result;
	},

	paginaEnVisualizacionTipoFuncionalidad: function(){
		var paginaEnVisualizacion = this.paginas.enVisualizacion()
			, result = null;
			
		if( paginaEnVisualizacion ){
			result = ko.unwrap( paginaEnVisualizacion.tipoFuncionalidad )
		}
		
		return result;		
	},

	getPageHashBang: function( pagina ){
		var traduccion = pagina.traduccion();
		return pagina.getPageHashBang( traduccion, {
			'obtenerPaginaPorId'	: this.obtenerPaginaPorId.bind( this )
		});
	},

	hayPaginasDeTipoEnlaceAPaginaActivas: function(){
		return this.obtenerPaginasDeTipoEnlaceAPaginaActivas().length > 0;
	},

	obtenerPaginaCanonicaDePaginaActiva: function(){
		var paginaCanonica;
		if( this.hayPaginasDeTipoEnlaceAPaginaActivas() ){
			paginaCanonica = this.obtenerPaginasActivasConEsteId()[0];
		}
		return paginaCanonica;
	},

	esEnlaceAPaginaActiva: function( enlace ){
		var result = false;

		if( enlace.asJS.tipo() == tiendasimple.helpers.Enlace.TIPO_ANCLA ){
			result = true;
		} else {
			if( enlace.asJS.tipo() == tiendasimple.helpers.Enlace.TIPO_PAGINA ){
				var paginaEnVisualizacion = model.data.paginas.enVisualizacion();
				if( paginaEnVisualizacion && paginaEnVisualizacion.id() == enlace.asJS.idPagina() ){
					result = true;
				}
			}
		}

		return result;
	},
	
	////////////////////////////////////////////////////////////////////////////

	mostrarLogin: function(){
		var mostrarLoginPorCatalogo = this.carroComprasHabilitado();
		var mostrarLoginPorForzarBoton = this.market.usarBotonAccesoClientes();
		var mostrarLoginPorPaginasConAccesoRestringido = this.paginasTieneAlgunaConAccesoPublicoRestringido();
		var mostrarLoginPorUsuarioLogueado = this.usuario.logueado();
		return mostrarLoginPorUsuarioLogueado || mostrarLoginPorCatalogo || mostrarLoginPorForzarBoton || mostrarLoginPorPaginasConAccesoRestringido;
	},

	////////////////////////////////////////////////////////////////////////////
	
	
	parseURL: function(url){
		var url = url || $.param.fragment();
		var hash = $.string.replace(url, '!/', '' );
		var hash = $.string.replace(hash, '#', '' );
		var splitted = hash.split("?");
		var path = splitted[0];
		var querystring = splitted[1];
		
		var parsedPath = $.querystring.path.toObject(path);
		var parsedQuery = querystring && $.unserialise(querystring, true);
		
		return [parsedPath, parsedQuery];
	},
	
	updateURL: function(newURL){
		var actualURL = this.parseURL();
		var newParsedURL = this.parseURL(newURL);
		
		var mixedPath = $.string.startsWith(newURL, "#!/") ? newParsedURL[0] : $.extend(actualURL[0], newParsedURL[0]);
		var mixedQuery = $.extend(actualURL[1], newParsedURL[1]);
		var mixed = [mixedPath, mixedQuery];
		
		mixed.toURL = function(){
			var path = $.querystring.path.fromObject(mixed[0]);
			var querystring = $.param(mixed[1]);
			var fullpath = [path, querystring].join('?');
			if(!$.string.startsWith(fullpath, '/')) fullpath = '/' + fullpath;
			return '#!' + fullpath;
		};
		mixed.toString = mixed.toURL;
		return mixed;
	},

	obtenerMetodoPagoPorId: function( idMetodoPago ){
		return ko.utils.arrayFirst( this.metodosPago(), function( metodoPago ){
			return metodoPago.id() == idMetodoPago;
		});
	},

	obtenerNombreMetodoPago: function( id ){
		var metodoPago = this.obtenerMetodoPagoPorId( id );
		return metodoPago && i18n.kot( 'global:catalogo.metodospago.' + metodoPago.descripcion() );
	},

	obtenerMetodoPagoPorDescripcion: function( descripcionMetodoPago ){
		return ko.utils.arrayFirst( this.metodosPago(), function( metodoPago ){
			return metodoPago.descripcion() == descripcionMetodoPago;
		});
	},
	
	obtenerMetodosPagoParaProducto: function( producto ){
		var idMoneda = producto.idMoneda();
		return ko.utils.arrayFilter( this.metodosPago(), function( metodoPago ){
			return metodoPago.puedeProcesarMonedas( idMoneda );
		});
	},
	
	obtenerServiciosHabilitadosParaProductoPorMetodoPago: function( producto, metodoPago ){
		return metodoPago.obtenerServiciosHabilitadosMonedas( [producto.idMoneda()] );
	},
			
	obtenerServiciosHabilitadosParaProducto: function( producto ){
		var hash = {},
			self = this,
			metodosPago = this.obtenerMetodosPagoParaProducto(producto);
		$.each( metodosPago, function( index, metodoPago ){
			var servicios = self.obtenerServiciosHabilitadosParaProductoPorMetodoPago( producto, metodoPago );
			$.each( servicios, function( index, servicio ){
				hash[servicio.nombre()] = servicio;
			});
		});
		
		return $.map( hash, function( value, key ){
			return value;
		});
		
	},
			
	////////////////////////////////////////////////////////////////////////////

	obtenerUrlLogin: function(){
		return this.hashbang().get('login').setQuery( {'callback' : this.hashbang().get().toURL(true)} ).toURL();
	},

	obtenerUrlValidarEmail: function(){
		return this.hashbang().get({'registro': 'validar-email'}).setQuery( {'callback' : this.hashbang().get().toURL(true)} ).toURL();
	},

	
	
	////////////////////////////////////////////////////////////////////////////

	getGoogleRemarketingImageURL: function(){
         
		var ecomm_prodid = ''
			, ecomm_pvalue = '';

		if ( this.googleRemarketingPageType() === 'product' ){
			ecomm_prodid = ko.unwrap( this.productos.seleccionado().id );
			ecomm_pvalue = ko.unwrap( this.productos.seleccionado().precio );
		}
 	
		if ( this.googleRemarketingPageType() === 'category' ){
			ecomm_prodid = $.pluckCollection( this.productos(), 'id');
		}
            
                
                var conversionX =  ko.unwrap( this.market.googleRemarketing.google_conversion_id );
                
            
                var gooogle_conversion_idX = conversionX;
		var gooogle_custom_paramsX = window.google_tag_params;
		var gooogle_remarketing_onlyX = true;
		var ecomm_category = ko.unwrap( $.getObjectProperty( model.data.categoriaSeleccionada(), 'id') );
            
           
                var result = (this.market.googleRemarketing.script());
                var match = result.match(/\<img.+src\=(?:\"|\')(.+?)(?:\"|\')(?:.+?)\>/);
          
                 
		var dataObj = {
			hasaccount		: this.usuario.logueado() ? 'y': 'n',
 			ecomm_prodid		: ecomm_prodid,
			ecomm_pagetype		: this.googleRemarketingPageType(),
			ecomm_category		: ecomm_category,
			ecomm_pvalue		: ecomm_pvalue
	
			/*,
			ecomm_totalvalue	:  google_tag_params.ecomm_totalvalue*/
		};
 
		var data = ( $.map( dataObj, function( value, key ) {
			return [ key, '=', $.makeArray( value ).join(',') ].join("");
		} ).join(';') );
      
		var query = {
			data				: data,
			random				: new Date().getTime()
		};

            var domain_1 = /googleads.g.doubleclick.net/;  // solo permitimos este dominio
            var domain_2 = /googleadservices.com/;  // y este tambin :D
            
            //Parche para quitar los "amp" de la cadena match[1]
            var cadenaA = match[1],
            patronA = "amp",
            nuevoValorA    = "",
            nuevaCadena = cadenaA.replace(patronA, nuevoValorA);
    
            var cadenaB = nuevaCadena,
            patronB = "amp",
            nuevoValorB    = "",
            nuevaCadenaMatch = cadenaB.replace(patronB, nuevoValorB);
    
          if(domain_1.test(nuevaCadenaMatch) || domain_2.test(nuevaCadenaMatch)){
            
                            return nuevaCadenaMatch + '&' + $.param(query);
                           
                    }else{
                    //no lo puedo aceptar :(

                            return "";
                    }

            }, 


	////////////////////////////////////////////////////////////////////////////
	usarPopupPoliticaDeCookiesUE: function(){
		return model.data.market.configuracion.get('regional_politicaCookiesUE_mode') === 'popup';
	},
	
	usarAlertPoliticaDeCookiesUE: function(){
		return model.data.market.configuracion.get('regional_politicaCookiesUE_mode') !== 'popup';
	},
	
	mostrarPoliticaDeCookiesUE: function(){
		var self = this
			, settingName = 'regional_politicaCookiesUE'
			, value = model.data.market.configuracion.get(settingName);
		
		return !window.G_esCuttyCapt && value && this.politicaCookiesUECookie() !== 'aprobado';
	},
	
	aceptarPoliticaDeCookiesUE: function(){
		this.politicaCookiesUECookie('aprobado');
	},

	rechazarPoliticaDeCookiesUE: function(){
		this.reset();
	},
	
	////////////////////////////////////////////////////////////////////////////
	
	obtenerDtHerramientaTieneLogo: function(){
		var logo = this.dtHerramientaLogoUrl()
			, emptyLogo = z.js("********************************************");
		return logo && logo !== emptyLogo;
	},
	
	obtenerDtHerramientaTieneNombre: function(){
		var nombre = this.dtHerramienta()
			, emptyNombre = z.js("******************");
		return nombre && nombre !== emptyNombre;
	},
	
	obtenerDtHerramientaTieneWeb: function(){
		var web = this.dtHerramientaWeb()
			, emptyWeb = '#';
		return web && web !== emptyWeb;
	},
	
	obtenerDtHerramientaLogo: function(){
		if( this.obtenerDtHerramientaTieneLogo() ){
			return this.dtHerramientaLogoUrl();
		}
	},
	
	obtenerDtHerramientaNombre: function(){
		if( this.obtenerDtHerramientaTieneNombre() ){
			return this.dtHerramienta();
		}
	},

	obtenerDtHerramientaWeb: function(){
		if( this.obtenerDtHerramientaTieneWeb() ){
			return this.dtHerramientaWeb();
		}
	},
	
	///////////////////////////////////////////////////////////////////////////
	
	esDominioPropioSSL: function(){
		return this.urlEstandar() === this.urlSegura() && location.protocol === 'https:';
	},

	mostrarLogoSsl: function(){
		if ( this.market.configuracion.get('mostrar_logo_ssl') === undefined ){
			return true;
		}else{
			return this.market.configuracion.get('mostrar_logo_ssl');
		}
	},
	
	///////////////////////////////////////////////////////////////////////////
	
	abrirRadio: function( url ){
		return window.open( url ,'','width=211,height=81');

	},
	

	///////////////////////////////////////////////////////////////////////////
	
	paginaEsIndexablePorBuscadores: function(){
		return this.seccionActiva() !== 'carrito';
	},
	
	///////////////////////////////////////////////////////////////////////////

	designModeOn: function(){
		var self = this,
			apariencia = this.apariencia2,
			unitTests = apariencia.unitTests,
			backup;
	
		unitTests.start = function(){
			backup = self.toJS();
		};
		
		unitTests.reset = function(){
			self.update( backup );
		};

		unitTests.beforeRun = function(){
			this.reset();
		};
		
		if( unitTests.tests().length == 0 ){
			unitTests.createTest({
				nombre		: 'npaginas',
				descripcion	: '2 pginas',
				fn			: function(){
					self.paginas.splice(2, 1000);
				}
			});
			
			unitTests.createTest({
				nombre		: '5paginas',
				descripcion	: '5 pginas',
				fn			: function(){
					var ultimaPagina = self.paginas()[self.paginas().length-1];
					
					self.paginas.splice(5, 1000);
					for (var i = self.paginas().length ; i < 5 ; i ++){
						self.paginas.push( ultimaPagina.clone() );
					}
				}
			});
			
			unitTests.createTest({
				nombre		: '10paginas',
				descripcion	: '10 pginas',
				fn			: function(){
					var ultimaPagina = self.paginas()[self.paginas().length-1];
					
					self.paginas.splice(10, 1000);
					for (var i = self.paginas().length ; i < 10 ; i ++){
						self.paginas.push( ultimaPagina.clone() );
					}
				}
			});
			
			unitTests.createTest({
				nombre		: 'sinlogo',
				descripcion	: 'Sin Logotipo',
				fn			: function(){
					self.market.tieneLogo(false);
				}
			});
			
			unitTests.createTest({
				nombre		: 'sincarro',
				descripcion	: 'Sin carro de compras',
				fn			: function(){
					self.market.usarCarroCompras(false);
				}
			});
			
			unitTests.createTest({
				nombre		: 'usuariologueado',
				descripcion	: 'Cliente logueado',
				fn			: function(){
					self.usuario.update({id: 3, 'email': 'pepe@popo.com'})
				}
			});
			
			unitTests.createTest({
				nombre		: 'paginaProductos',
				descripcion	: 'Pgina de productos',
				fn			: function(){
					location.href = "#!/categoria//pagina/0/";
				}
			});
		}
		unitTests.editable = false;
		
		apariencia.designModeOn(true);
		unitTests.start();
		
	},

	/////////////////////////////////////////////////////
	//
	//siguienteEstadoDeCompra: function(){
	//	var self = this
	//		, estadosDeCompra = self.carrito.estadosDeCompra()
	//		, estadoActual = self.carrito.estadoActualDeCompra()
	//		, indexActual = estadosDeCompra.indexOf(estadoActual)
	//		, estadoSiguiente = estadosDeCompra[ indexActual + 1 ];
	//
	//	if( estadoActual == 'confirmar' ){
	//		$.hashbang.get( '/orden-compra/confirmar/accion/pagar' ).navigate();
	//	} else {
	//		if( estadoSiguiente == 'metodo_de_envio' && !self.carritoRequiereMetodoEnvio( self.carrito ) ){
	//			estadoSiguiente = estadosDeCompra[ indexActual + 2 ];
	//		}
	//		self.carrito.estadoActualDeCompra( estadoSiguiente );
	//	}
	//},

	gotoTop : function(){
		if($(window).scrollTop() > 0) {
			$(window).animate({
				scrollTop:0
			}, {});
		}; 
	},

	datosEnvio: false,
	metodoPago: false,


	puedeCambiarEstadoCompra: function(){
		var self = this
			, estadoActual = self.carrito.estadoActualDeCompra()
			, puedeSeguir = false;

		switch (estadoActual) {
			case 'datos_de_envio':
				puedeSeguir = self.usuario.direcciones.seleccionado().isValid();
				if(!self.datosEnvio){
					self.gotoTop();
					self.datosEnvio = true;
				}
				break;
			case 'metodo_de_envio':
				puedeSeguir = self.obtenerCotizacionEnvioPorId( self.carrito.idCotizacionEnvio() );
				self.gotoTop();
				break;
			case 'metodo_de_pago':
				puedeSeguir = self.carrito.idMetodoPago();
				if(!self.metodoPago){
					self.gotoTop();
					self.metodoPago = true;
				}
				break;
			case 'confirmar':
				puedeSeguir = true;
				self.datosEnvio = false;
				self.metodoPago = false;
				self.gotoTop();
				break;
			default:
				puedeSeguir = false;
		}
		return puedeSeguir;
	},

	carritoRequiereMetodoEnvio: function( carrito ){
		return this.metodosEnvioHabilitado() && carrito.obtenerItemsDeTipoProductoEnviable().length > 0;
	},
	
        ///////////////////////////////////////////////////////////////////////////
        ////////////// Obtiene los descuentos activos
        
        descuentosActivos: function(){
            //wip
            return model.data.carrito.descuentosActivos();
	},
        
	/*
	obtenerCotizacionEnvioPorId: function( idCotizacionEnvio ){
		var self = this
			, cotizacionSeleccionada = null;

		if( idCotizacionEnvio ){
			ko.utils.arrayFirst( self.metodosEnvio(), function( metodoEnvio ){
				cotizacionSeleccionada = ko.utils.arrayFirst( metodoEnvio.cotizaciones(), function( cotizacion ){
					return cotizacion.id() == idCotizacionEnvio;
				});
				return cotizacionSeleccionada;
			});			
		}
		return cotizacionSeleccionada;
	},
	*/


	obtenerCotizacionEnvioPorId: function( idCotizacion ){
		var self = this
			, encontrada = null;

		$.each( self.metodosEnvio(), function( index, metodoEnvio ){
			$.each( metodoEnvio.cotizaciones(), function( index, cotizacion ){
				if( cotizacion.id() == idCotizacion ){
					self.carrito.idCotizacionEnvioPadre( idCotizacion );
					encontrada = cotizacion;
				} else {
					var subCotizacion = cotizacion.obtenerCotizacionEnvioPorId( idCotizacion );
					if( subCotizacion ){
						encontrada = subCotizacion ;
					}
				}
				if( encontrada ) return false;
			});
			if( encontrada ) return false;
		});
		return encontrada;

	},

	
	obtenerMetodoEnvioPorIdCotizacionEnvio: function( idCotizacionEnvio ){
		var self = this, 
				metodoEnvio = null;
		if( idCotizacionEnvio ){
			metodoEnvio = ko.utils.arrayFirst( self.metodosEnvio(), function( metodoEnvio ){
				return !!ko.utils.arrayFirst( metodoEnvio.cotizaciones(), function( cotizacion ){
					return cotizacion.id() == idCotizacionEnvio;
				});
			});			
		}
		
		return metodoEnvio;		
	},
	
	siNoHayMetodoEnvioNoVender: function(){
		return this.market.configuracion.getByKey('catalogo_metodosenvio_sinohay').value() === 'no_vender';
	},
	
	hayCotizaciones: function(){
		return this.metodosEnvio().length > 0;
	},

	obtenerEstadosDeCompraHabilitados: function( carrito ){
		var carritoRequiereMetodoEnvio = this.carritoRequiereMetodoEnvio( carrito );
		return ko.utils.arrayFilter( carrito.estadosDeCompra(), function( estadoDeCompra ){
			return estadoDeCompra != 'metodo_de_envio' || carritoRequiereMetodoEnvio;
		});
	},

	obtenerCarritoPorId: function( id ){
		return ko.utils.arrayFirst( this.carritos(), function( item ) {
			return ko.unwrap( item.id ) == id;
		});
	},

	obtenerNombreEstadoEnvioCarrito: function( id ){
		return i18n.kot( {
			'1'	: 'global:catalogo.estados_envio.envio_pendiente',
			'2'	: 'global:catalogo.estados_envio.despachado',
			'3'	: 'global:catalogo.estados_envio.entregado',
			'4'	: 'global:catalogo.estados_envio.envio_cancelado'
		}[ id ] );
	},

	////////////////////////////////////////////////////////////////////////////////////////

	obtenerIconoEstadoCarrito: function(id){
		/*
		 CARRO_INCOMPLETO		: 1,
		 CARRO_CONFIRMADO		: 2,
		 ESPERANDO_APROBACION	: 3,
		 INICIANDO_PAGO_ONLINE	: 4,
		 PAGO_ONLINE_OK			: 5,
		 PAGO_ONLINE_ERROR		: 6,
		 COBRADO					: 7,
		 CANCELADO				: 8
		 */

		return {
			1		: 'icon-edit',
			2		: 'icon-list-alt',
			3		: 'icon-time',
			4		: 'icon-credit-card',
			5		: 'icon-ok',
			6		: 'icon-exclamation-sign',
			7		: 'icon-money',
			8		: 'icon-ban-circle'
		}[ id ]
	},

	obtenerNombreEstadoCarrito: function(id){
		return i18n.kot
		( {
			1		: 'micuenta.ordenes.estadoscarrito.carro_incompleto',
			2		: 'micuenta.ordenes.estadoscarrito.carro_confirmado',
			3		: 'micuenta.ordenes.estadoscarrito.esperando_aprobacion',
			4		: 'micuenta.ordenes.estadoscarrito.iniciando_pago_online',
			5		: 'micuenta.ordenes.estadoscarrito.pago_online_preaprobado',
			6		: 'micuenta.ordenes.estadoscarrito.pago_online_error',
			7		: 'micuenta.ordenes.estadoscarrito.cobrado',
			8		: 'micuenta.ordenes.estadoscarrito.cancelado',
			9		: 'micuenta.ordenes.estadoscarrito.eliminado'
		}[id] );
	},

	////////////////////////////////////////////////////////////////////////////////////////////


	getSnippetStyle: function( snippet ){
		var options = {
			window				: this.window
		};

		return snippet.getStyle( options );
	}

});



// el model, es a grandes rasgos un ajaxHelper, con un ViewModel.
tiendasimple.front.Model = $.Class({
	init: function(data){
		this.data = new tiendasimple.front.ViewModel(data, this );
	},
	
	getUrl: function (url, data, options, ajaxCall){
		if (!$.string.startsWith(url, 'http') && !$.string.endsWith(url, '/') ){
			window.console && console.error('model.getUrl: las url deben terminar con "/"', url, data, options);
		}


		if(data){
			data = ko.mapping.toJS(data);
			delete data.constructor;
		}

		function extension(url){
			var result = '';
			var arr = url.split('.');
			if(arr.length > 1){
				result = arr[arr.length-1];
			}
			return result;
		}

		var urlExtension = extension(url);

		var options = $.extend({
			data: data,
			dataType: 'json'
		}, options);

		var xdomain = $.string.startsWith(url, 'http');

		if(!urlExtension || urlExtension == 'php' || xdomain) {
			$.extend(options,{
				type: 'POST',
				parseError: true
			})
		}

		if(xdomain){
			$.extend(options,{
				dataType: 'jsonp',
				type: 'GET'
			});
			if(
				$.string.startsWith(url, 'https://administracion.donweb.com')
				|| $.string.startsWith(url, 'https://micuenta.donweb.com/')
			) options.jsonp = 'jsoncallback';

		} else {
			var jsondata = $.toJSON(data);
			if( jsondata !== undefined ){
				options.data = {
					jsondata: jsondata // se envian los datos como un objeto JSON			
				};				
			}
			
			//--> TEST PREFIJO /~ PARA ACTIONS Y RUTAS FSICAS
			// Si la url corresponde a una action de un controller (no es xdomain), la prefijo para no confundirla con una pgina sin hashbang, tipo /pagina.
			// Comentamos (desactivamos) la prueba //
			//url = '~/' + url;
			
		}

		var self = this;
		
		if(ajaxCall) ajaxCall(true);
		var ajax = $.ajax(url ,options)
		.always(function(){
			self.data.ajaxCalls.enProgreso.remove(ajax);
			if(ajaxCall) ajaxCall(false);
		})
		.fail(function(jqXHR, status, response){
			var message = response.message;
			switch(message){
			}

			$(self).trigger('ajaxError', [message, url, options]);

		});

		self.data.ajaxCalls.enProgreso.push(ajax);
		return ajax;
	},
	
	///////////////////////////////////////////////////////////////////////////
	// BLOG

	obtenerCategoriasBlog : function( options ){
		options.pageSize = 100;
		options.absolutePage = 0;
		options.idIdioma = 1;
		return this.getUrl('blogcategorias/obtener/', options , null);
	},

	obtenerEntradasBlog : function( options ){
		return this.getUrl('blogentradas/obtener/', options , null);
	},

	obtenerTagsBlog : function( options ){
		return this.getUrl('blogtags/nube/', options , null);
	},

	obtenerEntradasRelacionadas : function( options ){
		return this.getUrl('blogentradas/relacionados/', options , null);
	},

	/////////////////////////////////////////////////////////////////////////////////
	/////////////// Formulario consulta

	obtenerFormularioConsulta : function( options ){
		return this.getUrl('fronttienda/obtenerpagina/', options, null);
	},
	
	////////////////////////////////////////////////////////////////////////////
	
	obtenerCargaInicial: function( parametros ){
		return this.getUrl('fronttienda/cargainicial/', parametros, null, this.data.ajaxCalls.obtenerCargaInicial);
	},
	
	////////////////////////////////////////////////////////////////////////////
	
	loginCliente: function(usuario, password, noCerrarSesion){
		return this.getUrl('fronttienda/logincliente/', {usuario: usuario, pwd: password, noCerrarSesion: noCerrarSesion}, null, this.data.ajaxCalls.loginCliente);
	},
	
	logoutCliente: function(){
		return this.getUrl('fronttienda/logout/', null, this.data.ajaxCalls.logoutCliente);		
	},
	
	recordarPassword: function(usuario){
		return this.getUrl('fronttienda/recordarpassword/', {'usuario': usuario}, null, this.data.ajaxCalls.recordarPassword);
	},

	cambiarPassword: function(passwordActual, passwordNuevo){
		return this.getUrl('fronttienda/cambiarpassword/', {'pwd': passwordActual, 'pwdNuevo': asswordNuevo}, null, this.data.ajaxCalls.cambiarPassword);
	},

	
	////////////////////////////////////////////////////////////////////////////

	registrarCliente: function(nombre, apellido, email, pwd, campos){
		return this.getUrl('fronttienda/registrarcliente/', {pwd: pwd, email: email, nombre: nombre, apellido: apellido, campos : campos }, null, this.data.ajaxCalls.registrarCliente);
	},

	habilitarCliente: function(usuario, codigo){
		return this.getUrl('fronttienda/habilitarcliente/', {usuario: usuario, codigo: codigo}, null, this.data.ajaxCalls.habilitarCliente);
	},

	guardarCliente: function(cliente){
		var data = cliente;
		var propiedadesQueInteresan = ['nombre', 'apellido', 'telefono', 'email', 'passwordActual', 'campos'];
		if( data && data.toJS ){
			data = data.toJS();
		}
		data = $.getSelectedProperties( data, propiedadesQueInteresan );
		/*
		var data = {
			nombre      : cliente.nombre(),
			apellido    : cliente.apellido(),
			telefono    : cliente.telefono(),
			email       : cliente.email(),
			passwordActual  : cliente.passwordActual()
		};
		*/
		return this.getUrl('fronttienda/guardarcliente/', data, null, this.data.ajaxCalls.guardarCliente);
	},

	cambiarPassword: function(passwordAnterior, passwordNuevo, enviarEmail){
		return this.getUrl('fronttienda/cambiarpassword/', {pwd: passwordAnterior, pwdNuevo: passwordNuevo, enviarEmail: enviarEmail}, null, this.data.ajaxCalls.cambiarPassword);
	},

	obtenerCarritos: function(options){
		var options = $.extend({}, options);
		return this.getUrl('fronttienda/obtenercarritoscliente/', options, null, this.data.ajaxCalls.obtenerCarritos );
	},

	duplicarCarrito: function(options){
		var options = $.extend({}, options);
		return this.getUrl('fronttienda/duplicarcarrito/', options, null, this.data.ajaxCalls.duplicarCarrito );
	},

	agregarDireccionCliente: function( data ){
		return this.getUrl('fronttienda/agregardireccioncliente/', data);
	},

	modificarDireccionCliente: function( data ){
		return this.getUrl('fronttienda/modificardireccioncliente/', data);
	},

	eliminarDireccionCliente: function( id ){
		return this.getUrl('fronttienda/eliminardireccioncliente/', { id: id });
	},

	reenviarCodigoActivacion: function(){
		return this.getUrl('fronttienda/reenviarcodigoactivacion/');
	},

	obtenerUltimoHistorialCarrito: function(){
		return this.getUrl('fronttienda/obtenerultimohistorialgatewaycarrito/');
	},
	
	
	////////////////////////////////////////////////////////////////////////////
	
	obtenerCategorias: function(options){
		var options = $.extend({
			filter: {
				nombre		: null,
				padre		: null
			}
		}, options);

		return this.getUrl('fronttienda/obtenercategorias/', options, null, this.data.ajaxCalls.obtenerCategorias)
	},

	////////////////////////////////////////////////////////////////////////////

	_obtenerProductos: function(options){
		var options = $.extend({
			filter: {
				codigo			: null,
				descripcion		: null,
				precio			: null //  precio: [=|<|>|g|l]+precio
			}
		}, options);

		return this.getUrl('fronttienda/obtenerproductos/', options, null, this.data.ajaxCalls.obtenerProductos)
	},
	
	obtenerProductos: function(options){
		return this._obtenerProductos.apply( this, arguments );
	},


	obtenerProducto: function( options ){
		var options = $.extend({
			id		: null,
			iso		: null
		}, options);

		return this.getUrl('fronttienda/obtenerproducto/', options);
	},

	obtenerProductosPorId: function( id ){
		return this.obtenerProductos({
			'filter'	: {
				'id': id
			}
		}).then( function( response ){
			return { 'result' : response.result.recordset };
		});
	},


	obtenerProductosMasVendidos: function( cantidad ){
		return this.obtenerProductos({vendidos: true, pageSize: cantidad});
	},

	////////////////////////////////////////////////////////////////////////////
	
	agregarACarrito: function(idProducto, cantidad){
		return this.getUrl('fronttienda/agregaracarrito/', {idProducto: idProducto, cantidad: cantidad}, null, this.data.ajaxCalls.agregarACarrito);
	},
	
	obtenerCarrito: function( debug ){
		var url = debug ? 'fronttienda/probar/' : 'fronttienda/obtenercarrito/';
		return this.getUrl( url );
	},
	
	modificarCarrito: function( idItem, cantidad ){
		return this.getUrl('fronttienda/modificaritemcarrito/', {idItem: idItem, cantidad: cantidad}, null, this.data.ajaxCalls.modificarCarrito);
	},
	
	quitarDeCarrito: function( idItem ){
		return this.getUrl('fronttienda/eliminaritemcarrito/', {idItem: idItem});
	},

	/*
	asignarDireccionACarrito: function( idDireccion ){
		return this.getUrl('fronttienda/asignardireccionacarrito/', {idDireccion: idDireccion});
	},
	*/
	
	asignarMetodoPagoACarrito: function( idMetodoPago ){
		return this.getUrl('fronttienda/asignarmetodopagoacarrito/', {idMetodoPago: idMetodoPago});
	},
	
	iniciarMetodoPagoCarrito: function( options ){
		return this.getUrl('fronttienda/iniciarmetodopagocarrito/', options );
	},
		
	establecerErrorMetodoPagoCarrito: function( options ){
		return this.getUrl('fronttienda/establecererrormetodopagocarrito/', options );
	},
			
	
	/**
	 * @param {Object} options {comentario: {String} }
	 * cambia el estado del carrito previo a verificar que tenga un cliente y direccin asignadas.
	 * te retorna el carrito con el nuevo estado, y lo borra de sesin.
	 * options.comentario puede tener un comentario para el carrito
	 */
	checkoutCarrito: function(options){
		return this.getUrl('fronttienda/checkoutcarrito/', options);
	},
			
	////////////////////////////////////////////////////////////////////////////
	// NUEVOS MTODOS DE CARRITO
	
	carritoConfirmar: function(){
		return this.getUrl('fronttienda/carritoconfirmar/');
	},
	
	/**
	 * devuelve un carrito nuevo
	 */
	ordenCompraModificar: function(){
		return this.getUrl('fronttienda/carritomodificar/');
	},
	
	/**
	 * devuelve la orden (con el estado cancelado)
	 */
	ordenCompraCancelar: function(){
		return this.getUrl('fronttienda/ordencancelar/');
	},
	
	/*
	 * @param data: {idMetodoPago: , idDireccion: , comentario: } 
	 * @return carro con el neuvo estado
	 */
	ordenCompraConfirmar: function( data ){
		return this.getUrl('fronttienda/ordenconfirmar/', data );
	},
	
	ordenCompraReiniciar: function(){
		return this.getUrl('fronttienda/ordenreiniciar/');
	},
	
	ordenCompraPortalPagosOk: function( data ){
		return this.getUrl('fronttienda/ordenportalpagosok/', data);
	},
	
	ordenCompraPortalPagosError: function(){
		return this.getUrl('fronttienda/ordenportalpagoserror/');
	},
	
	ordenCompraObtenerMercadoPagoInitPoint: function(){
		return this.getUrl('fronttienda/carritoobtenermercadopagoinitpoint/');
	},

	ordenCompraObtenerTodoPagoUrlCheckout: function(){
		return this.getUrl('fronttienda/obtenerautorizaciontodopago/');
	},
	
	ordenCompraMercadoPagoProcessPayment: function(collection_id){
		return this.getUrl('fronttienda/mercadopagoprocesspayment/', {'collection_id': collection_id});
	},
	
	ordenCompraCotizarEnvio: function(){
		return this.getUrl('fronttienda/cotizarenviocarrito/');
	},
	
	ordenCompraAplicarCotizacionEnvio: function( idCotizacionEnvio ){
            return this.getUrl('fronttienda/aplicarcotizacionenviocarrito/', { idCotizacionEnvio: idCotizacionEnvio } );
	},
        
        ordenCompraAplicarCotizacionCuponAutomatico: function( options ){
		return this.getUrl('fronttienda/aplicarcotizacioncuponcarrito/', options );
	},
        ordenCompraAplicarCotizacionCupon: function( options ){
		return this.getUrl('fronttienda/aplicarcuponcarrito/', options );
	},
        ordenCompraEliminarCupon: function(  ){
		return this.getUrl('fronttienda/eliminarcupon/');
	},
	ordenCompraAsignarDireccionEnvio: function( idDireccionEnvio ){
		return this.getUrl('fronttienda/ordenasignardireccionenvio/', {idDireccionEnvio: idDireccionEnvio} );
	},

	////////////////////////////////////////////////////////////////////////////
	
	enviarEmailContacto: function(nombre, direccion, mensaje){
		return this.getUrl('fronttienda/enviarmailcontacto/', {nombre: nombre, emailDesde: direccion, mensaje: mensaje}, null, this.data.ajaxCalls.enviarEmailContacto);
	},
	
	////////////////////////////////////////////////////////////////////////////
	
	widgetFormularioEnviar: function( titulo, urlPagina, tituloPagina, formData, emails, emailDestino ){
		return this.getUrl( 'fronttienda/enviarmailformulario/', { titulo: titulo, urlPagina: urlPagina, tituloPagina: tituloPagina, data: formData, emails: emails, emailDestino : emailDestino  } );
	},
	
	////////////////////////////////////////////////////////////////////////////
	/**
	 * @return []
	 */
	obtenerPaginas: function(){
		return this.getUrl('fronttienda/obtenerpaginas/');
	},
	
	/**
	 * @return {}
	 */
	obtenerPagina: function(id){
		return this.getUrl('fronttienda/obtenerpaginas/', {id: id});
	},

	///////////////////////////////////////////////////////////////////////////

	obtenerContadorDeVisitas: function(options){
		return this.getUrl('admin/visits/getcantidadvisitastotales/', options, null, this.data.ajaxCalls.obtenerContadorDeVisitas);
	},

	///////////////////////////////////////////////////////////////////////////

	geoObtenerPaises: function(){
		return this.getUrl('fronttienda/obtenergeopaises/');
	},

	geoObtenerRegionesPorIsoPais: function( isoPais ){
		return this.getUrl('fronttienda/obtenergeoregionesbycodigopais/', { isoPais: isoPais} );
	},
	
	////////////////////////////////////////////////////////////////////////////
	///////////////////////////////// Campos Personalizados

	obtenerCamposPersonalizados : function( options ){
		var self = this;
		options = $.extend({}, options);
		return self.getUrl('camposusuario/obtenertodos/', {}, options);
	},

	obtenerCamposPersonalizadosByField : function( filtro ){
		var self = this;
		return self.getUrl('camposusuario/obtenertodos/', {field: filtro});
	},
        
	////////////////////////////////////////////////////////////////////////////
	///////////////////////////////// Cupones
        
    buscarDescuentosDisponiblesCarrito : function( options ){
		var self = this;
		return self.getUrl('fronttienda/buscardescuentosdisponiblescarrito/', {}, options.options);
	},
	
	/////////////////////////////////////////////////////////////////////////
	/////// Google Reviews

	getGoogleReviewsData : function( placeId, rating ){
		var options = {};
		options.placeId = placeId;
		options.rating = rating;
		var self = this;
		options = $.extend({}, options);
		return this.getUrl('market/getgooglereviews/', options);
	},

	getGoogleReviews : function ( placeId, rating ){
		controller.chequearMarketIdPlace( placeId, rating )
			.then(function(response){
				model.data.googleReviewsState( true );
				model.data.googleReviews(response.result);
			}).catch(function(e){
				
			});
	},

	//////////////////////////////////////////////////////////////////////////////
	/////////////// BOTON CONSULTAR  

	enviarFormularioBotonConsultar : function( options ){
		var idproducto = options.idProducto;
		var idvariante = options.idVariante;
		var idusuario;
		options.idUsuario === undefined ? idusuario = 0 : idusuario = options.idUsuario;
		var email = options.email;
		var data = options.data;
		var emailDestino = options.emailDestino;
		return this.getUrl( 'productsmessages/guardar/', { idproducto : idproducto, idvariante : idvariante, idcliente : idusuario, email : email, emailDestino : emailDestino, data : data });
	},

	//////////////////////////////////////////////////////////////////////////////
	/////////////// COMPRA SIN REGISTRO
	
	registrarInvitado: function(nombre, apellido, email, pwd, recaptcha, campos){
		return this.getUrl('fronttienda/registrarinvitado/', {recaptcha: recaptcha, email: email, nombre: nombre, apellido: apellido, pwd: pwd, campos: campos }, null, this.data.ajaxCalls.registrarInvitado);
	},
	
	comprobarEmailInvitado : function(email, actualizar){
		return this.getUrl( 'fronttienda/comprobaremailinvitado/', { email : email, actualizar: actualizar });
	},

	compraSinRegistroHabilitada : function(){
		var mostrar = false;
		if ( model.data.market.dtTieneCompraSinRegistro() == 1 && model.data.market.compraSinRegistroHabilitada() == 1 ){
			mostrar = true;
		}
		return mostrar;
	},

	getTextosCompraSinRegistro : function (){
		var self = this;
		var texto = {titulo: '', cuerpo: '', enlace: '', sugerencia_registro: '' };
		if ( model.data.market.configuracion.get('texto_invitado_titulo_login') != '') texto.titulo = model.data.market.configuracion.get('texto_invitado_titulo_login');
		if ( model.data.market.configuracion.get('texto_invitado_cuerpo_login') != '') texto.cuerpo = model.data.market.configuracion.get('texto_invitado_cuerpo_login');
		if ( model.data.market.configuracion.get('texto_invitado_link_login') != '') texto.enlace = model.data.market.configuracion.get('texto_invitado_link_login');
		if ( model.data.market.configuracion.get('texto_invitado_sugerir_registro') != '') texto.sugerencia_registro = model.data.market.configuracion.get('texto_invitado_sugerir_registro');
		if ( model.data.market.configuracion.get('invitado_campo_personalizado_seleccionado') != '') texto.campo_personalizado_seleccionado = model.data.market.configuracion.get('invitado_campo_personalizado_seleccionado');
		return texto;
	},
	
	muestraCampoPersonalizadoEnCompraSinRegistro : function(){
		var mostrar = false;
		if ( model.data.market.configuracion.get('invitado_campo_personalizado_activado') != '' &&
			 model.data.market.configuracion.get('invitado_campo_personalizado_activado') === true && 
			  ( model.data.market.configuracion.get('campos_personalizados') != undefined && 
			  	model.data.market.configuracion.get('campos_personalizados').length > 4 )){
			mostrar = true;
		}
		return mostrar;
	},

	/////////////////////////////////////////////////////////////////////////////////
	/////////////// FILE UPLOAD /////////////////////////////////////////////////////
	
	obtenerDatosUsuarioEnFormUpload : function(){
		return this.getUrl('files/getdatafromuser/', {});
	},
	
	generateTokenFormUpload  : function(){
		return this.getUrl('files/generatetokenupload/', {});
	},

});

var model = new tiendasimple.front.Model( window.dataInicial );


/* /js/front/fronttienda_controller.js
 * compresion time: 0.03004 -(ms)
 * ----------------------------------- */
$.namespace('tiendasimple.front');

//TODO: Ver donde poner esta funcin
Object.values = function(object) {
  var values = [];
  for(var property in object) {
    values.push(object[property]);
  }
  return values;
}


tiendasimple.front.Controller = $.Class({
	init: function(){
		var self = this;
		
		model.data.carrito.subscribe(function(){
		}, this, 'commit');
		
	},
	
	_onObtenerCargaInicial: function( response ){
		var data = $.extend({}, response.result);
		controller.extendMapping(response.result);
		if(data.usuario == null) delete data.usuario; // MAPPING ENLOQUECE SI SE LE PASA UN VALOR NULO A UN SUBMODELO
		if (response.result.usuario !== null){ model.data.datosusuario = ko.toJS(response.result.usuario); }
		data.paginas = data.paginas.recordset;
		model.data.update(data);
		model.data.cargaInicialRealizada(true);
		try {
			model.data.snippets.obtenerFormularioConsulta();
		} catch (error) {
			console.log('Error =>', error);
		}
	},
	
	obtenerCargaInicial: function( parametros ){
		this.extendMapping();
		var obtenerCargaInicial;
		model.data.cargaInicialRealizada(false);
		if(window.dataInicial && window.dataInicial.cargainicial){
			obtenerCargaInicial = $.Deferred();
			setTimeout( function(){
				obtenerCargaInicial.resolve({result: window.dataInicial.cargainicial});
			},10);
		} else {
			obtenerCargaInicial = model.obtenerCargaInicial( parametros );
		}
		return obtenerCargaInicial.done( this._onObtenerCargaInicial );
	},

	////////////////////////////////////////////////////////////////////////////
	
	extendMapping : function() {
		var camposPersonalizados = new tiendasimple.front.CamposUsuario;
		model.data.camposPersonalizados = camposPersonalizados;
		var blog = new tiendasimple.front.Blog;
		model.data.blog = blog;
		var snippets = new tiendasimple.front.Snippets;
		model.data.snippets = snippets;
		var files = new tiendasimple.front.Files;
		model.data.files = files;
		// fileupload
		controller.obtenerDatosUsuarioEnFormUpload()
			.then(function(response){
				datosUsuarios = {};
				datosUsuarios.ip = response.ip;
				datosUsuarios.token = response.token;
				datosUsuarios.userId = response.userId;
				datosUsuarios.host = response.host;
				model.data.datosUsuario = datosUsuarios;
			}).catch(function(err){
				console.log(err);
			});
	},

	////////////////////////////////////////////////////////////////////////////

	loginCliente: function(usuario, password, noCerrarSesion){
		return model.loginCliente(usuario, password, noCerrarSesion)
			.done(function(response){
				model.data.usuario.update(response.result.usuario);
				model.data.carrito.update(response.result.carrito);
			})
	},
	
	logoutCliente: function(){
		return model.logoutCliente().always(function(response){
			model.data.usuario.reset();
			model.data.carrito.reset();
		})
	},
	
	recordarPassword: function(usuario){
		return model.recordarPassword(usuario);
	},
	
	registrarCliente: function(nombre, apellido, email, password, campos){
		return model.registrarCliente(nombre, apellido, email, password, campos)
			.done(function(response){
				model.data.update({usuario:response.result || {}});			
			})
	},
	
	habilitarCliente: function(usuario, codigo){
		return model.habilitarCliente(usuario, codigo)
			.done(function(response){
				if( model.data.usuario.logueado() ){
					model.data.usuario.habilitado( response.result.usuario.habilitado );					
				} else {
					model.data.update({ usuario: response.result.usuario, carrito: response.result.carrito });
				}
				
				/*
				model.data.usuario.update(response.result.usuario);
				model.data.carrito.update(response.result.carrito);
				*/
				
			})
	},

	guardarCliente: function(cliente){
		var datosCliente = cliente.toJS();
		datosCliente.campos = cliente.campos();
		return model.guardarCliente( datosCliente )
			.done(function(response){
				model.data.usuario.guardar( response.result );
			});
	},

	cambiarPassword: function(passwordAnterior, passwordNuevo, enviarPassword){
		return model.cambiarPassword(passwordAnterior, passwordNuevo, enviarPassword);
	},

	obtenerCarritos: function(options){
		var recordset = model.data.carritos.recordset;
		var options = $.extend({
			absolutePage			: recordset.absolutePage(),
			pageSize				: recordset.pageSize(),
			filter					: recordset.filter()
		}, options);

		model.data.carritos.cargando(true);

		return model.obtenerCarritos(options)
			.done(function(response){
				model.data.update({carritos: response.result.recordset || []});
				model.data.carritos.recordset.update(response.result, {exclude:'recordset'});

				model.data.carritos.cargado(true);
			})
			.always(function(){
				model.data.carritos.cargando(false);
			});
	},

	duplicarCarrito: function(options){
		return model.duplicarCarrito(options)
			.done(function(response){
				model.data.carrito.update(response.result);
			});
	},

	/* agrega la direccin en edicin al cliente
	 * 
	**/
	agregarDireccionCliente: function( direccion ){
		var direccion = direccion || model.data.usuario.direcciones.seleccionado().toJS();

		return model.agregarDireccionCliente( direccion )
			.done(function( response ){
				var direccionSeleccionadoJSON = ko.toJSON( $.withoutProperties( model.data.usuario.direcciones.seleccionado().toJS(), ['id', 'idCliente'] ) ),
					direccionSeleccionadoNuevo;
					
				model.data.usuario.update( response.result );
				
				direccionSeleccionadoNuevo = $.findInCollection( model.data.usuario.direcciones(), function( direccion ){
					var direccionJSON = ko.toJSON( $.withoutProperties( direccion.toJS(), ['id', 'idCliente'] ) );
					return direccionJSON === direccionSeleccionadoJSON;
				});
				
				if( direccionSeleccionadoNuevo ) model.data.usuario.direcciones.seleccionado( direccionSeleccionadoNuevo );
			});
	},

	modificarDireccionCliente: function( direccion ){
		var direccionSeleccionada = model.data.usuario.direcciones.seleccionado(),
			direccion = direccion || direccionSeleccionada.toJS();

		return model.modificarDireccionCliente( direccion )
			.done(function( response ){
				direccionSeleccionada.update( response.result );
			})
	},

	eliminarDireccionCliente: function( id ){
		return model.eliminarDireccionCliente( id )
			.done(function( response ){
				model.data.usuario.update( response.result );
			})
	},

	reenviarCodigoActivacion: function(){
		return model.reenviarCodigoActivacion();
	},
	
	////////////////////////////////////////////////////////////////////////////
	
	obtenerCategorias: function(options){
		var self = this;
		var categorias = model.data.categorias;
		var pageSize = ko.utils.unwrapObservable(categorias.recordset.pageSize);
		var productos = ko.utils.unwrapObservable(categorias.recordset.productos);
		var absolutePage = ko.utils.unwrapObservable(categorias.recordset.absolutePage);
		var categoriaPadre = ko.utils.unwrapObservable(categorias.seleccionado);
		var categoriaPadreId = categoriaPadre && ko.utils.unwrapObservable(categoriaPadre.id);
		var orden = ko.utils.unwrapObservable(categorias.recordset.orden);

		var filter = ko.utils.unwrapObservable(categorias.recordset.filter) || {
			nombre		: null,
			padre		: categoriaPadreId || null
		};

		var options = $.extend({
			pageSize		: pageSize,
			absolutePage	: absolutePage,
			productos		: productos,
			filter			: filter,
			orden			: orden
		}, options);
		
		model.data.categorias.cargando( true );

		model.data.productos.dispose();
		model.data.productos.cargado( false );
		model.data.update({productos: []});
		model.data.productos.filtroTexto( productos && productos.filter && productos.filter.descripcion );



		return model.obtenerCategorias(options).done(function(response){
			model.data.categorias.dispose();
			model.data.update({categorias: response.result.recordset});
			model.data.categorias.recordset.update(response.result, {exclude:'recordset'});
			model.data.categorias.seleccionado.arbol(response.result.arbol);
			var ultimoElementoDelArbol = $.arrayLast(model.data.categorias.seleccionado.arbol());
			//console.debug('ultimoElementoDelArbol', ultimoElementoDelArbol);
			model.data.categoriaSeleccionada(ultimoElementoDelArbol || null); // es un setter, no un observable
			// console.debug('categoriaSeleccionada', ultimoElementoDelArbol);
			
			model.data.categorias.idActual( options.filter.padre || categoriaPadreId || null );
			
			if(response.result.productos){
				self._onObtenerProductos({result:response.result.productos});
			}			
			setTimeout(function(){model.data.categorias.cargando(false);},1);
		});
	},
	
	////////////////////////////////////////////////////////////////////////////
	_onObtenerProductos: function(response){
		model.data.productos.dispose();
		model.data.update({productos: response.result.recordset});
		model.data.productos.recordset.update(response.result, {exclude:'recordset'});
		model.data.productos.cargado( true );
		model.data.productos.obtenerAlCambiar(false);
	},
	
	obtenerProductos: function(options){
		var categorias = model.data.categorias;
		var productos = model.data.productos;

		var absolutePage = ko.utils.unwrapObservable(productos.recordset.absolutePage);
		var pageSize = ko.utils.unwrapObservable(productos.recordset.pageSize);
		var filter = ko.utils.unwrapObservable(productos.recordset.filter) || {};
		
		/*	ORDEN
		 *  
		 * 	id | descripcion | descripcionCorta | descripcionLarga | idProducto | idIdioma | iso
		 *  desc : true/false
		 *  
		 *  Ej: [{ campo: 'id', desc: true }]
		 */
		var orden = ko.utils.unwrapObservable(productos.recordset.orden || []);
		

		model.data.productos.filtroTexto( filter && filter.descripcion );


		var options = $.extend({
			absolutePage	: absolutePage,
			pageSize		: pageSize,
			filter			: filter,
			orden			: orden
		}, options);

		return model.obtenerProductos(options).done(this._onObtenerProductos);
	},
	
	obtenerProducto: function(options){
		var options = $.extend({
			id			: 0,
			isoIdioma	: model.data.market.isoIdioma() 
		}, options);
		
		return model.obtenerProducto(options);
	},

	obtenerProductoCompleto: function( producto ){
		producto.obteniendoDatos( true );
		return this.obtenerProducto( { id: producto.id() } ).then(
			function(response){
				producto.update( response.result );
			})
			.always( function(){
				producto.obteniendoDatos( false );
			})
	},

	productoSeleccionarOpcionDefault: function( producto ){
		if( producto ){
			if( model.data.productosEstanOrdenadosPorPrecioDesc && model.data.productosEstanOrdenadosPorPrecioDesc() ){
				producto.opcionesSeleccionarPorPrecioMaximo();
			} else {
				producto.opcionesSeleccionarPorPrecioMinimo();
			}
		}
	},


	productoSeleccionado: function ( id, opcion ){
		var self = this
			, productos = model.data.productos
			, next
			, result;

		productos.cargando( true );

		if( productos.seleccionado() ){
			if( productos.seleccionado().id() == id ){
				next = $.Deferred().resolve( productos.seleccionado() );
			} else {
				productos.seleccionado().dispose();
				productos.seleccionado( null );
			}
		}

		if( id ){
			if( !next ){
				next = this.obtenerProducto( { id: id } ).then(
					function(response){
						var producto = response.result && new model.data.nuevoProducto(response.result);
						productos.seleccionado( producto );
						return producto;
					});
			}

			result = next.then( function( producto ){
				if( opcion ) {
					//console.group("Indicar opcin seleccionada");
					//console.log('Seleccionar ', opcion );
					producto.opcionesSeleccionarValoresAtributos( opcion );
					//console.log('Seleccionada', producto.opcionesSeleccionada().getUrl().query.opcion);
					//console.groupEnd();

				}
				else {
					self.productoSeleccionarOpcionDefault( producto );
				}
				return producto;
			});

		} else {
			result = $.Deferred().resolve( null );
		}

		result.always( function(){
			setTimeout( function() {
				productos.cargando(false);
			}, 10); // este valor est bien, es para que no haya problemas con el cambio de URL
		});

		return result;

	},

////////////////////////////////////////////////////////////////////////////
	
	_onObtenerCarrito: function(response){
		if( !response.result ){
			model.data.carrito.reset();
		} else {
			var result = response.result;
			//console.debug('id', result.id, 'fechaCreacion', result.fechaCreacion, 'fechaEsOrden', result.fechaEsOrden, 'timeoutRestante', result.timeoutRestante, 'vigenciaRestante', result.vigenciaRestante );
			model.data.update({carrito: result || {} });
			// solo buscamos descuentos disponibles si estamos en /carrito
			if (window.location.href.indexOf('/carrito/') != -1){
				model.data.carrito.buscarDescuentosDisponiblesCarrito();
			}
		}
	},
			
	_onObtenerCarritoFail: function( response ){
		var errorCode = $.getObjectProperty( response, 'error.code' )
			, data = $.toArray($.getObjectProperty( response, 'error.data' ));
		
		switch( errorCode ){
			case -16: //stock insuficiente
				$.each( data, function(index, data ){
					model.data.actualizarStockProducto( data.idProducto, data.stock );					
				});
				break;
				
			case -18: //producto inexistente
				$.each( data, function(index, data ){
					model.data.actualizarStockProducto( data.idProducto, 0 );					
				});
				break;
				
			case -21: //error mixto
				$.each( data, function(index, data ){
					model.data.actualizarStockProducto( data.idProducto, data.stock );
				});
				break;
				
			case -23: // venci la orden
				model.data.carrito.notifySubscribers( 0 , 'vencioTimeout' );
				break;
		}		
	},
			
	_onModificarCarritoFail: function( response ){
		var self = this
			, errorCode = $.getObjectProperty( response, 'error.code' )
			, data = $.toArray($.getObjectProperty( response, 'error.data' ));
			
		switch( errorCode ){
			case -16: //stock insuficiente
				$.each( data, function(index, data ){
					var idProducto	= data.idProducto
						, stock		= data.stock
						, itemCarrito = model.data.obtenerItemCarritoPorIdProducto( idProducto );
						
					self.modificarCarrito( itemCarrito.id(), stock, itemCarrito.cantidad() );
				});
				break;
			
			case -20:
				model.data.carrito.revertCantidades();
				self.obtenerCarrito();
				break;
			
			default:
				model.data.carrito.revertCantidades();
				break;
		}		
	},
	
	obtenerCarrito: function( debug ){
		var defer;
		if( window.dataInicial && window.dataInicial.carrito ){
			defer = $.Deferred().resolve({result: window.dataInicial.carrito});
			delete window.dataInicial.carrito;
		} else {
			defer = model.obtenerCarrito( debug );
		}
		
		return defer.done( this._onObtenerCarrito ).fail( this._onObtenerCarritoFail );
	},
	
	agregarACarrito: function(id, cantidad){
		var self = this;
		return model.agregarACarrito(id, cantidad).done(this._onObtenerCarrito).fail( this._onObtenerCarritoFail );
	},
	
	quitarDeCarrito: function(item){
		item.quitando( true );
		return model.quitarDeCarrito(item.id()).done(this._onObtenerCarrito).fail( this._onObtenerCarritoFail ).fail( function(){
			item.quitando( false );
		});
	},
	
	modificarCarrito: function( idItem, nuevaCantidad, cantidadInicial ){
		if( model.data.carrito.sePuedeModificarDetalle() ){
			return model.modificarCarrito( idItem, nuevaCantidad )
				.done( this._onObtenerCarrito )
				.fail( this._onObtenerCarritoFail )
				.fail( this._onModificarCarritoFail.bind( this ))
		} else {
			model.data.obtenerItemCarrito( idItem ).revertCantidad();		
			return $.Deferred().reject('ORDEN_COMPRAS');
		}
	},


	asignarMetodoPagoACarrito: function( idMetodoPago ){
		var idMetodoPago = idMetodoPago || model.data.carrito.idMetodoPago();
		
		return model.asignarMetodoPagoACarrito( idMetodoPago ).done(function( response ){
			//model.data.carrito.update( response.result );
		})
	},

	iniciarMetodoPagoCarrito: function(options){		
		if(model.data.carrito.detalle().length === 0) return $.Deferred().reject({error:{message: 'carrito vaco' }});
		
		var options = $.extend({
			comentario	: model.data.carrito.comentario()
		}, options);
		
		return model.iniciarMetodoPagoCarrito(options);
	},
			
	establecerErrorMetodoPagoCarrito: function(){
		return this.getUrl( 'fronttienda/establecererrormetodopagocarrito/', options );
	},
	

	checkoutCarrito: function(options){		
		if(model.data.carrito.detalle().length == 0) return $.Deferred().reject({error:{message: 'carrito vaco' }});
		
		var options = $.extend({
			comentario: model.data.carrito.comentario()
		}, options);
		
		return model.checkoutCarrito(options).done(function(){
			model.data.carrito.reset();
		});
	},
	
	////////////////////////////////////////////////////////////////////////////
	// Nuevos mtodos carrito
	
	carritoConfirmar: function(){
		var carrito = model.data.carrito;
		
		carrito.confirmando( true );
		return model.carritoConfirmar()
			.then( this._onObtenerCarrito.bind( this ),
				function( response ){
					var errorCode = $.getObjectProperty( response, 'error.code' )
						, data = $.toArray($.getObjectProperty( response, 'error.data' ));

					switch( errorCode ){
						case -21: //producto inexistente
							$.each( data, function(index, data ){
								var itemCarrito = model.data.obtenerItemCarritoPorIdProducto( data.idProducto );
								data.descripcion = itemCarrito && ko.unwrap( itemCarrito.descripcion );
							});
							break;
					}
					return response;
				}
			)
			.fail ( this._onObtenerCarritoFail.bind( this ) )
			.always( function(){
				carrito.confirmando( false );				
			});
	},
			
	/**
	 * devuelve un carrito nuevo
	 */
	ordenCompraModificar: function(){
		return model.ordenCompraModificar()
			.done( function( response ){
				model.data.update( {carrito: response.result } );
				model.data.carrito.showAllMessages(false);
			});
	},
	
	/**
	 * devuelve la orden (con el estado cancelado)
	 */
	ordenCompraCancelar: function(){
		return  model.ordenCompraCancelar()
			.done( function( response ){
				model.data.carrito.reset();
			});
	},
	
	/* Confirma un carro de compras indicando el mtodo de pago, direccin de envo 
	 * @return carro con el neuvo estado
	 */
	ordenCompraConfirmar: function(){
		var self = this
			, carrito = model.data.carrito
			, direccion	= model.data.usuario.direcciones.seleccionado() || {}
			, data = {
				idMetodoPago			: ko.unwrap( carrito.idMetodoPago ),
				idDireccionEnvio		: ko.unwrap( direccion.id ),
				comentario				: ko.unwrap( carrito.comentario )
			};
			
		return model.ordenCompraConfirmar( data )
			.done( function( response ){
				model.data.update( {carrito: response.result } );
				if( model.data.carrito.esperandoAprobacion() ){
					self.ordenComprasArchivarYReiniciarCarrito();
				}
			})
			.fail( self._onObtenerCarritoFail.bind(self) )
	},		
			
	ordenCompraReiniciar: function(){
		return model.ordenCompraReiniciar()
			.done( function( response ){
				model.data.update( { carrito: response.result} );
			});
	},

	ordenCompraPortalPagosOk: function( data ){
		var self = this;
			data = $.extend({}, data);
			
		return model.ordenCompraPortalPagosOk( {'metodoPago': data.metodoPago, 'resultado': data.resultado, 'servicio': data.servicio, 'collection_id': data.collection_id} )
			.done( function(){
				self.ordenComprasArchivarYReiniciarCarrito();
			});
	},
	
	ordenCompraPortalPagosError: function(){
		return model.ordenCompraPortalPagosError();
	},			
			
	ordenComprasArchivarYReiniciarCarrito: function(){
		if( model.data.carrito.id() ){
			model.data.ultimaOrdenCompra( model.data.carrito.clone() );				
		}
		model.data.carrito.reset();
	},
	
	ordenCompraCotizarEnvio: function(){
		model.data.carrito.cotizandoEnvio( true );
		model.ordenCompraCotizarEnvio().done( function( response ){
			model.data.update({ metodosEnvio: response.result, carrito: { envioCotizado: true } });
		}).always( function(){
			model.data.carrito.cotizandoEnvio( false );
		});
	},
	
	ordenCompraAplicarCotizacionEnvio: function( idCotizacionEnvio ){
		idCotizacionEnvio = idCotizacionEnvio || model.data.carrito.idCotizacionEnvio();
		model.ordenCompraAplicarCotizacionEnvio( idCotizacionEnvio ).done( this._onObtenerCarrito ).fail( this._onObtenerCarritoFail );
	},
        
        ordenCompraAplicarDescuentoAutomatico: function( options ){
		model.ordenCompraAplicarCotizacionCuponAutomatico( options ).done( this._onObtenerCarrito ).fail( this._onObtenerCarritoFail );
	},

        ordenCompraAplicarCupon: function( options ){
        model.data.carrito.mensajeCupon('');
    	var self = this;
		model.ordenCompraAplicarCotizacionCupon( options ).done( $.proxy(function(resp){model.data.carrito.estadoCupon('agregado');this._onObtenerCarrito(resp);},self ))
			.fail( function(response){
                                var mensaje = response.error.data[0];
                                model.data.carrito.mensajeCupon(mensaje);
                                model.data.carrito.mensajeCupon(model.data.carrito.settearMensajeErrorCupon(model.data.carrito.mensajeCupon()));
				model.data.carrito.estadoCupon('fallo');
				self.ordenCompraAplicarDescuentoAutomatico(options);
			})
			.always(function(){
				model.data.carrito.aplicandoCupon(false)
			});
	},
        ordenCompraEliminarCupon: function( options ){
            var self = this;
		model.ordenCompraEliminarCupon().done( $.proxy(function(resp){model.data.carrito.cupon("");model.data.carrito.estadoCupon('aplicar');this._onObtenerCarrito(resp);},self ))
                        .always(function(){
							model.data.carrito.eliminandoCupon(false);
							if ( options.calcularAutomatico){
								var settings = {idMetodoPago:model.data.carrito.idMetodoPago()};
                            	controller.ordenCompraAplicarDescuentoAutomatico(settings);
							}
                        });
	},
        
	ordenCompraAsignarDireccionEnvio: function( direccion ){
		var self = this
			, direccion = direccion || model.data.usuario.direcciones.seleccionado()
			, direccionId = direccion && direccion.id();

		return model.ordenCompraAsignarDireccionEnvio( direccionId )
			.done( self._onObtenerCarrito.bind( self ) )
			.fail( self._onObtenerCarritoFail.bind(self) )
	},

	ordenCompraRequiereDatosAdicionales: function(){
		var nombre = model.data.usuario.nombre()
			, apellido = model.data.usuario.apellido()
			, telefono = model.data.usuario.telefono()
			, direccionSeleccionada = model.data.usuario.direcciones.seleccionado()
			, ciudad = direccionSeleccionada.ciudad()
			, direccion = direccionSeleccionada.direccion()
			, codigoPostal = direccionSeleccionada.codigoPostal()
			, result = {
				validarCliente      : false,
				validarDatosEnvio   : false
			};

		if( model.data.metodoPagoSeleccionado() instanceof tiendasimple.back.MetodoPago.Todopago ){

			var esTelefonoValido = telefono && ko.validation.rules.phoneNumberTodoPago.validator(telefono, true);
			var esNombreValido = nombre && ko.validation.rules.firstLastNameTodoPago.validator(nombre, true);
			var esApellidoValido = apellido && ko.validation.rules.firstLastNameTodoPago.validator(apellido, true);
			var esCiudadValida = ciudad && ko.validation.rules.cityTodoPago.validator(ciudad, true);
			var esDireccionValida = direccion && ko.validation.rules.streetTodoPago.validator(direccion, true);
			var esCodigoPostalValido = codigoPostal && ko.validation.rules.postalCodeTodoPago.validator(codigoPostal, true);

			var clienteValido = esNombreValido && esApellidoValido && esTelefonoValido;
			var datosEnvioValido = esCiudadValida && esDireccionValida && esCodigoPostalValido;

			result = {
				validarCliente      : !clienteValido,
				validarDatosEnvio   : !datosEnvioValido
			}

		}

		return $.Deferred().resolve( result );
	},

	/*
	guardarDatosAdicionales: function( data ){
		return $.Deferred().resolve('ok');
	},
	*/

	////////////////////////////////////////////////////////////////////////////
	
	enviarEmailContacto: function(nombre, email, mensaje){
		return model.enviarEmailContacto(nombre, email, mensaje);
	},
	
	////////////////////////////////////////////////////////////////////////////

	obtenerPaginas: function(){
		model.obtenerPaginas().done(function(response){
			model.data.paginas.dispose();
			model.data.update({paginas: response.result.recordset});
		});
	},
	
	obtenerPagina: function(id){

		//console.assert(id, 'view.obtenerPagina(id) id no puede ser null');
		var deferred = $.Deferred();
		//var pagina = $.findInCollection( model.data.paginas(), function(pagina){return pagina.id() == id });
		var pagina = model.data.obtenerPaginaPorId(id);	
		if( ! ( pagina && ( pagina.cargado() || pagina.cargando() ) ) ){
			pagina && pagina.cargando( true );
			model.obtenerPagina(id)
				.done(function(response){
					delete response.result.subPaginas;
					if(pagina){
						pagina.update(response.result);
					} else {
						pagina = tiendasimple.front.Pagina.createInstance(response.result);
					}
					pagina.cargado(true);
					deferred.resolve(pagina);
				})
				.fail(function(){return deferred.reject()})
				.always( function(){
					pagina.cargando( false );
				});
		}
	
		if(pagina) return deferred.resolve(pagina);
		return deferred;
	},
	
	paginaActiva: function(id){
		this.obtenerPagina(id).done(function(pagina){
			var anteriorPaginaActiva = model.data.paginas.activa();
			if( !anteriorPaginaActiva || anteriorPaginaActiva.id() != pagina.id() ){
				model.data.paginas.activa(pagina);				
			}
		});
	},
			
	previsualizarPagina: function( data ){
		var pagina = tiendasimple.front.Pagina.createInstance( data );
		pagina.cargado( true );
		model.data.paginas.activa( pagina );
		model.data.seccionActiva( 'pagina' );
	},
	
	establecerPaginasDesdeJSON: function( data ){
		var data = $.parseJSON( data );
		model.data.update({paginas: data});
	},
	
	////////////////////////////////////////////////////////////////////////////

	obtenerCamposPersonalizados : function( options ){
		var self = this;
		options = options || {};
		options = $.extend({}, options);
		model.obtenerCamposPersonalizados(options)
			.done(function(response){
				if (response.result && Array.isArray(response.result)){
					if (typeof response.result[0] === 'object'){
						response.result[0] = Object.values(response.result[0]);
					}
					model.data.camposPersonalizados.cargar(ko.toJS(response.result[0]), options);
				}else{
					model.data.camposPersonalizados.cargar(ko.toJS([]), options);
				}
		});
	},

	obtenerCamposPersonalizadosByField : function( field, options ){
		var self = this;
		options = options || {};
		options = $.extend({}, options);
		model.obtenerCamposPersonalizadosByField(field)
			.done(function(response){
				if (response.result && Array.isArray(response.result)){
					if (typeof response.result[0] === 'object'){
						response.result[0] = Object.values(response.result[0]);
					}
					model.data.camposPersonalizados.cargar(ko.toJS(response.result[0]), options);
				}else{
					model.data.camposPersonalizados.cargar(ko.toJS([]), options);
				}				
		});
	},

	////////////////////////////////////////////////////////////////////////////

	/*
	obtenerCategoriasTemplates: function(){
		model.obtenerCategoriasTemplates().done(function(response){
			model.data.update({categoriasTemplates: response.result});
			model.data.categoriasTemplates.cargado = true;
		});
	},

	obtenerTemplates: function(options){
		return model.obtenerTemplates(options).done(function(response){
			response.result.templatesDeSistema.sort(function(a,b){return a.nombre.toLowerCase() < b.nombre.toLowerCase() ? -1 : 1});
			model.data.apariencia.update(response.result);
		});
	},
	
	guardarTemplate: function(template){
		template = $.extend({}, template);
		delete template.estiloEntidad;
		delete template.temaEntidad;
		return model.guardarTemplate(template).done(function(response){
			template.update(response.result);
		});
	},
	
	
	obtenerTemplateEdicion: function(idTemplate){
		return model.obtenerTemplateEdicion(idTemplate).done(function(response){
			model.data.apariencia.templateEdicion.update(response.result);
		})
	},
	
	obtenerEstilos: function(){
		model.obtenerEstilos().done(function(response){
			response.result.sort(function(a,b){return a.nombre.toLowerCase() < b.nombre.toLowerCase() ? -1 : 1});
			model.data.apariencia.update({estilos: response.result});
		})
	},
	
	obtenerEstiloEdicion: function(idEstilo){
		model.obtenerEstiloEdicion(idEstilo).done(function(response){
			model.data.apariencia.templateEdicion.estiloEntidad.update(response.result);
		})
	},

	guardarEstilo: function(estilo){		
		var ventana = model.data.ventanas.apariencia;
		if(!estilo) {
			estilo = model.data.apariencia.templateEdicion.estiloEntidad;
			estilo.less(ventana.estilo.less());
			estilo.css(ventana.estilo.css());
			estilo.variables(ko.toJSON(ventana.estilo.variables));
		}
		
		var nuevoEstilo = !estilo.id();
		
		return model.guardarEstilo(estilo).done(function(response){
			estilo.update(response.result);
			
			if(nuevoEstilo){
				var idEstilo = estilo.id();
				var estilos = model.data.apariencia.estilos();
				var estiloActual = ko.utils.arrayFirst(estilos, function(elemento){return elemento.id() == idEstilo});
				var clone = estiloActual ? estiloActual.clone() : new tiendasimple.Estilo();
				clone.id(estilo.id());
				clone.nombre(estilo.nombre());
				model.data.apariencia.estilos.push(clone);
			}
			
		});
	},
	
	obtenerTemas: function(){
		model.obtenerTemas().done(function(response){
			response.result.sort(function(a,b){return a.nombre.toLowerCase() < b.nombre.toLowerCase() ? -1 : 1});
			model.data.apariencia.update({temas: response.result});
		})
	},
	
	obtenerTemaEdicion: function(idTema){
		model.obtenerTemaEdicion(idTema).done(function(response){
			model.data.apariencia.templateEdicion.update({temaEntidad: response.result});
		})
	},
	
	guardarTema: function(tema){
		var ventana = model.data.ventanas.apariencia;
		if(!tema) {
			tema = model.data.apariencia.templateEdicion.temaEntidad;
			tema.less(ventana.tema.less());
			tema.css(ventana.tema.css());
			tema.variables(ko.toJSON(ventana.tema.variables));
		}
		
		var nuevoTema = !tema.id();

		return model.guardarTema(tema).done(function(response){
			tema.update(response.result);
			
			if(nuevoTema){
				var idtema = tema.id();
				var temas = model.data.apariencia.temas();
				var temaActual = ko.utils.arrayFirst(temas, function(elemento){return elemento.id() == idtema});
				var clone = temaActual ? temaActual.clone() : new tiendasimple.Tema();
				clone.id(tema.id());
				clone.nombre(tema.nombre());
				model.data.apariencia.temas.push(clone);
			}
			
		});
	},*/
	
	/*
	templatesPersonalesObtener: function(){
		model.data.apariencia.templatesPersonales.loading( true );
		return model.templatesPersonalesObtener()
			.done( function( response ){
				model.data.apariencia.update( { templatesPersonales: response.result.recordset } );
				model.data.apariencia.templatesPersonales.recordset.update( response.result );
			})
			.always( function(){
				model.data.apariencia.templatesPersonales.loading( false );
			});
	},
			
	templatesPersonalesGuardar: function( templatePersonal ){
		var data = templatePersonal.toJS();
		return model.templatesPersonalesGuardar( data )
			.done(function( response ){
				templatePersonal.update( response.result );
			});
	},
	 */
	
	////////////////////////////////////////////////////////////////////////////
	
	widgetFormularioEnviar: function( widget, urlPagina, tituloPagina, formData, emails ){
		var titulo = widget.data.titulo();
		var emailDestino = widget.data.emailDestino();
		widget.enviando();
		return model.widgetFormularioEnviar( titulo, urlPagina, tituloPagina, formData, emails, emailDestino )
			.always( function() {
			})
			.done( function() {
				widget.enviado();
			})
			.fail( function( response ) {
				widget.error( response.error );
			})
	},

	////////////////////////////////////////////////////////////////////////////

	obtenerContadorDeVisitas: function(){
		var contadorDeVisitas = model.data.contadorDeVisitas();
		if( contadorDeVisitas.habilitado ){
			model.obtenerContadorDeVisitas().done( function(response){
				model.data.cantidadDeVisitas( response.result );
			});
		}
	},

	////////////////////////////////////////////////////////////////////////////

	geoObtenerPaises: function(){
		var self = this;

		if( !model.data.geo.paisesCargando() ){
			model.data.geo.paisesCargando( true );
			model.data.geo.paisesCargado( false );

			model.geoObtenerPaises()
				.done( function( response ){
					model.data.update({geo: { paises: response.result } });
					model.data.geo.paisesCargado( true );
				})
				.always( function(){
					model.data.geo.paisesCargando( false );
				})

		}
	},

	geoObtenerRegionesPorIsoPais: function( isoPais ){
		var self = this;

		if( !model.data.geo.regionesCargando() ){
			model.data.geo.regionesCargando( true );
			model.data.geo.regionesCargado( false );

			model.geoObtenerRegionesPorIsoPais(isoPais)
				.done( function( response ){
					model.data.update({geo: { regiones: response.result } });
					model.data.geo.regionesCargado( true );
				})
				.always( function(){
					model.data.geo.regionesCargando( false );
				})

		}
	},
        
        ///////////////////////////////////////////////////////////////////////////
        ////////////////////////////// Cupones
        
	buscarDescuentosDisponiblesCarrito : function ( options ){
            model.buscarDescuentosDisponiblesCarrito( options )
				.done( function( response ){
                                    // setteamos los descuentos
                                    model.data.carrito.settearDescuentosEnCarrito(ko.toJS(response.result));
				})
				.always( function(){
					
				})
        },
        
    

	///////////////////////////////////////////////////////////
	///////////////////// BLOG ///////////////////////////////

	obtenerCategoriasBlog : function( options ){
		var self = this;
		options = $.extend({}, options);
		return new Promise ( function (resolve, reject) {
			model.obtenerCategoriasBlog(options)
			.done( function( response ){
				if ( response.result.recordset ){
					resolve( response );
				}else{ 
					reject('Error recuperando categoriasBlog.');
				}
			})
		})
	},

	obtenerTagsBlog : function( options ){
		var self = this;
		options = $.extend({}, options);
		return new Promise ( function (resolve, reject) {
			model.obtenerTagsBlog(options)
			.done( function( response ){
				if ( response ){
					resolve( response );
				}else{ 
					reject('Error recuperando tagsBlog.');
				}
			})
		})
	},

	obtenerEntradasRelacionadas : function( options ){
		var self = this;
		options = $.extend({}, options);
		return new Promise ( function (resolve, reject) {
			model.obtenerEntradasRelacionadas(options)
			.done( function( response ){
				if ( response ){
					resolve( response );
				}else{ 
					reject('Error recuperando tagsBlog.');
				}
			})
		})
	},

	obtenerEntradasBlog : function( options ){
		var self = this;
		options = $.extend({}, options);
		return new Promise ( function (resolve, reject) {
			model.obtenerEntradasBlog(options)
			.done( function( response ){
                            
                                    response.result.recordset = response.result.recordset || [];
                            
                                    if ( response.result.recordset )
                                    {
                                        model.data.blog.record(response.result);
					model.data.blog.updateRecordset(response.result);
					resolve( response );
                                    }
			})
		})
	},

	//////////////////////////////////////////////////////////

	chequearMarketIdPlace : function( placeId, rating ){
		var self = this;
		return new Promise ( function (resolve, reject) {
			model.getGoogleReviewsData( placeId, rating )
			.done( function( response ){
				resolve(response);
			})
			.fail(function(){
				reject('error');
			});
		});
	},
	
	///////// Formulario / Boton de consultar

	obtenerFormularioConsulta : function( options ){
		var self = this;
		return new Promise ( function (resolve, reject) {
			model.obtenerFormularioConsulta(options)
			.done( function( response ){
				if ( response.result ){
					resolve( response );
				}else{ 
					reject('Error');
				}
			})
		})
	},

	////////////////////////////////////////////////////////////////////////////
	
	enviarFormularioBotonConsultar : function( options ){
		return model.enviarFormularioBotonConsultar( options )
			.done( function( response ) {
			})
			.fail( function( response ) {
			});
	},
	
	////////////////////////////////////////////////////////////////////////////	
	registrarInvitado: function(nombre, apellido, email, password, recaptcha, campos){
		return model.registrarInvitado(nombre, apellido, email, password, recaptcha, campos)
			.done(function(response){
				model.data.update({usuario:response.result || {}});
			})
	},

	comprobarEmailInvitado: function(email, actualizar){
		if (typeof actualizar === 'undefined' ) actualizar = true;
		return model.comprobarEmailInvitado(email, actualizar);
	},

	////////////////////////////////////////////////////////////////////////////////
	///////////////////// FILEUPLOAD

	obtenerDatosUsuarioEnFormUpload : function(){
		var self = this;
		options = {};
		return new Promise ( function (resolve, reject) {
			model.obtenerDatosUsuarioEnFormUpload()
			.done( function( response ){
				if ( response ){
					resolve( response.result );
				}else{ 
					reject('error');
				}
			})
		});
	},

	generateTokenFormUpload : function(){
		var self = this;
		options = {};
		return new Promise ( function (resolve, reject) {
			model.generateTokenFormUpload()
			.done( function( response ){
				if ( response ){
					resolve( response.result );
				}else{ 
					reject('error');
				}
			})
		});
	},
	
});


controller = new tiendasimple.front.Controller();


/* /js/front/fronttienda_view.js
 * compresion time: 0.04601 -(ms)
 * ----------------------------- */
___DEBUG = $.getAllQueryStrings().debug ? true : false;


if(___DEBUG) $.addHistoryToConsole(); // todo: quitar esto fuera de debug

$.namespace('tiendasimple.back');

window.RDSmoothScroll = {
	'Defaults'	: {
		friction: 0.95,
		autoInit: false
	}
}

tiendasimple.back.View = $.Class({
	init: function(){
		//this.start();
		this.trackearURLSeccionActiva = true;
		this.anclasEnPantallaDebounce = 300;
		this.trackearURLSeccionActivaDebounce = 300;
		this.autocorregirURLSeccionActiva = true;
		this.autoScrollDuration	= window.G_esCuttyCapt ? 0 : 800;
	},

	start: function(){
		var self = this
			, obtenerCarritoEnCargaInicial = true
			, idTemplate = $.getAllQueryStrings().idTemplate
			, crearPaginaEjemplo = $.getAllQueryStrings().crearPaginaEjemplo;

		///////////////////////////////////
		window.appLoadEndTime  = new Date();
		var tiempoDeCarga = window.appLoadEndTime - window.appLoadStartTime;
		ko.NetworkInfo.getInstance().loadingTimeReference( 2000 );
		ko.NetworkInfo.getInstance().loadingTime( tiempoDeCarga );
		///////////////////////////////////

		$.browser.addClasses();

		this.ventanas = {
			login: null
		};


		self._configurarRedesSociales();

		this._applySubscriptions();

		model.data.hashEvaluado(false);

		this._applyBindings();


		var url = $.hashbang.get();
		
		var obtenerCarritoDeferred = self.obtenerCarrito.bind(self);

		if( obtenerCarritoEnCargaInicial ){
			obtenerCarritoDeferred = $.Deferred().resolve();
		}


		var _cargaInicialOptions = {
			'carrito'				: true,
			'idTemplate'			: idTemplate,
			'crearPaginaEjemplo'	: crearPaginaEjemplo
		};
		var _prettyLinkUrl = self._getPrettyLinkFromUrl(url);
		if( _prettyLinkUrl ){
			_cargaInicialOptions.prettyLink = _prettyLinkUrl;
		} else {
			_cargaInicialOptions.home = true;
		}



		var option = {
			ns: {
				namespaces: ['front', 'global', 'snippets'],
				defaultNs: 'front'
			},
			lng: dataInicial.market.localizacion.locale || 'es',
			fallbackLng: dataInicial.market.localizacion.locale || 'es',
			resGetPath: model.data.staticResourcesGetCookielessDomainURL('/locales/traducciones/locales/isoIdioma/__lng__/namespace/__ns__/version/' + model.data.staticResources.version() + '/')
			//--> TEST PREFIJO /~ PARA ACTIONS Y RUTAS FSICAS
			// Comentamos (desactivamos) la prueba //
			//resGetPath: model.data.staticResourcesGetCookielessDomainURL('/~/locales/traducciones/locales/isoIdioma/__lng__/namespace/__ns__/version/' + model.data.staticResources.version() + '/')
		};

		i18n.init(option, function() {
			self.obtenerCargaInicial(_cargaInicialOptions)
				.then( obtenerCarritoDeferred ).always(function(){
					////////////////////////////////////////////////////////////////////
					ko.NetworkInfo.getInstance().appLoadComplete( new Date() );

					self._observarURL();
					model.data.hashEvaluado(true);
				})
				.then( self._politicaCookies.bind(self) )
				.then( function(){
					//slo si no se rechaz la poltica de cookies:
					self._configurarGoogleAnalytics = window._configurarGoogleAnalytics;
					self._configurarGoogleAnalytics();
					self._configurarPixelDeFacebook();
				});
			self.setLng(option.lng);

			model.data.market.localizacion.locale.subscribe( function( lng ){
				self.setLng( lng );
			})

		}.bind(this));








		model.data.apariencia.templateEdicion.idEstilo.subscribe(function(idEstilo){
			controller.obtenerEstiloEdicion(idEstilo);
		});

		model.data.apariencia.templateEdicion.idTema.subscribe(function(idTema){
			controller.obtenerTemaEdicion(idTema);
		});

		$(model).on('ajaxError', function(event, message, url, options){
			var trad=i18n.kot('front:app.mensajes.sin_acceso_para_realizar_esa_operacion');
			if(message=='noaccess' && url.indexOf('logout')==-1 && model.data.usuario.logueado()){
				$.alert(trad);
				self.logoutCliente();
			}
		});

		chrono = new Chronometer();
		this._configurarZoomImagenes();

		$(window).on('estructuraCargada', function(){
			chrono = new Chronometer();
			this._configurarColores();
			this._configureSmoothScroll();
		}.bind(this));

	},
	

	
	
	setLng: function(iso){
		if( iso != i18n.lng() ){
			i18n.setLng( iso, ko.bindingHandlers.i18nText.lng.bind(ko.bindingHandlers.i18nText.lng, iso) );
		} else {
			ko.bindingHandlers.i18nText.lng( iso );
		}
	},

	
	_politicaCookies: function(){
		var self = this
			, result = $.Deferred()
			, cookieSubscription;
			
		if(model.data.mostrarPoliticaDeCookiesUE()){
			if(model.data.usarPopupPoliticaDeCookiesUE()){
				return model.data.ventanas.politicaCookiesEs.mostrar()
					.done( function(){
						model.data.aceptarPoliticaDeCookiesUE();
					})
					.fail( function(){
						model.data.rechazarPoliticaDeCookiesUE();
					});
			}
			cookieSubscription = model.data.politicaCookiesUECookie.subscribe(function( value ){
				if( value ) {
					result.resolve('ok');
					cookieSubscription.dispose();
				}
			});
		} else {
			result.resolve('ok');
		}
		
		return result;
	},
	
	_configurarColores: function(){
		model.data.configuracionColor.recalcular();
	},
	
	_configurarZoomImagenes: function(){

		$('body').on('click', '[rel=zoomimage]', function(event){
			event && event.preventDefault();
			var $element = $(event.currentTarget);
			var src = $element.attr('href');			
			var img = $('<img>').attr('src', src);
			$.alert(img);
		});

		$('body').on('click', '[rel=galeriaModal]', function(event){
			event && event.preventDefault();
			var element = (event.currentTarget)
				, imagen = ko.contextFor( element ).$data
				, galeria = ko.contextFor( element ).$parents[0];
			
			galeria.establecerImagenActual( imagen );
                        
                        model.data.ventanas.galeriaZoom.item( galeria );
                        model.data.ventanas.galeriaZoom.activa(true);
		});
		
		$('body').on('click', '[rel=sliderModal]', function(event){
			event && event.preventDefault();
			var element = (event.currentTarget)
				, imagen = ko.contextFor( element ).$data
				, galeria = ko.contextFor( element ).$parents[3];
			
			galeria.establecerImagenActual( imagen );
                        
                        model.data.ventanas.galeriaZoom.item( galeria );
                        model.data.ventanas.galeriaZoom.activa(true);
		});
	},

	_configurarPixelDeFacebook: function(){
            var self = this
            , pixelFacebookScript = model.data.market.configuracion.get('facebook_pixel_script')
            , pixelFacebookId =  pixelFacebookScript && $.string.getIdFromPixelFacebookScript( pixelFacebookScript );
            if( window.G_esCuttyCapt ) return;
            if( pixelFacebookId ){
                    setTimeout(function() {
                            !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
                                    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
                                    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
                                    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
                                    document,'script','//connect.facebook.net/en_US/fbevents.js');
                            window.fbq.push(['addPixelId', pixelFacebookId]);
                            self.FBPageView();
                    }, 2000);
            }
	},

	FBViewContent : function( producto ){
		var contentType = '';
		var content_ids = 0;
		var contents = [];
		if ( $.hashbang.get().path.producto === undefined ){
			contentType = 'page';
			content_ids = 0001;
			contents = [{'id' : content_ids}, {'quantity' : '1'}];
		}else{
			contentType = 'product';
			if ( producto.tieneOpciones()){
				content_ids = producto.opcionesSeleccionada().id();
			} else {
				content_ids =  $.hashbang.get().path.producto;
			}
			contents = [{'id' : content_ids}, {'quantity' : '1'}];
		}
		window.fbq && window.fbq.push(['track', 'ViewContent', {
			content_type : contentType,
			contents_ids : content_ids,
			contents : contents,
		}]);
		if(___DEBUG) console.debug('PixelFacebook: ViewContent');	
	},

	FBPageView: function(){
            window.fbq && window.fbq.push(['track', 'PageView', {
                url_visitada: window.location.href,
            }]);
            if(___DEBUG) console.debug('PixelFacebook: PageView');
	},

	FBSearch: function( searchText ){
            window.fbq && window.fbq.push(['track', 'Search', {
                search_string : searchText,
                content_type : 'product'
            }]);
            if(___DEBUG) console.debug('PixelFacebook: Search');
	},

	FBAddToCart: function( item ){
		if (item.currency  === undefined){
			item.currency = model.data.market.isoMoneda();
		}
		var arrIdsProductos = [];
		arrIdsProductos.push( item.id );
		window.fbq && window.fbq.push(['track', 'AddToCart', {
                    content_name : item.descripcion,
                    content_category : item.categoria,
                    content_ids : arrIdsProductos,
                    value : item.value,
                    currency : item.currency,
                    content_type : 'product',
                    url_producto : window.location.href,
		}]);
		if(___DEBUG) console.debug('PixelFacebook: AddToCart');
	},

	FBAddToWishlist: function(){
		window.fbq && window.fbq.push(['track', 'AddToWishlist', {
			content_type : 'AddToWishlist-' + tiendasimple.helpers.Utils.getFechaActual()
		}]);
		if(___DEBUG) console.debug('PixelFacebook: AddToWishlist');
	},

	FBInitiateCheckout: function(){
                var dataCarrito = tiendasimple.helpers.Utils.getDataCarrito();
		window.fbq && window.fbq.push(['track', 'InitiateCheckout', {
                    currency : dataCarrito['moneda'][0],
                    value :  dataCarrito['totales'][0],
		}]);
		if(___DEBUG) console.debug('PixelFacebook: InitiateCheckout');
	},

	FBAddPaymentInfo: function(){
            var dataCarrito = tiendasimple.helpers.Utils.getDataCarrito();
            window.fbq && window.fbq.push(['track', 'AddPaymentInfo', {
                currency : dataCarrito['moneda'][0],
                value :  dataCarrito['totales'][0],
            }]);
            if(___DEBUG) console.debug('PixelFacebook: AddPaymentInfo');
	},

	FBPurchase: function(){
		var totales = model.data.carrito.totales();

		ko.utils.arrayForEach(totales, function(item){
			var moneda = model.data.obtenerMonedaPorId(item.idMoneda)
				, iso = moneda && moneda.iso()
				, total = item.total;

			var options = {
				value       : total,
				currency    : iso
			}

			window.fbq && fbq('track', 'Purchase', options);
			if(___DEBUG) console.debug('PixelFacebook: Purchase', ko.toJSON(options));

		});

	},

	FBLead: function(){
            var dataCarrito = tiendasimple.helpers.Utils.getDataCarrito();
            window.fbq && window.fbq.push(['track', 'Lead', {
                currency : dataCarrito['moneda'][0],
                value :  dataCarrito['totales'][0],
            }]);
            if(___DEBUG) console.debug('PixelFacebook: Lead');
	},

	FBCompleteRegistration: function(){
		var data = {};
		data.moneda = model.data.market.isoMoneda();
		data.value = 1.00;
		window.fbq && window.fbq.push(['track', 'CompleteRegistration', {
			currency : data.moneda,
			value :  data.value,
			status : true
		}]);
		if(___DEBUG) console.debug('PixelFacebook: CompleteRegistration');
	},

	FBContact : function( data ){
		window.fbq && window.fbq.push(['track', 'Contact', {
			name : data.Nombre,
			surname : data.Apellido,
			message : data.mensaje
		}]);
		if(___DEBUG) console.debug('PixelFacebook: Contact');
	},

	_configurarRedesSociales: function(){
		// twitter
		/*
		!function(d,s,id){
			var js,fjs=d.getElementsByTagName(s)[0];
			if(!d.getElementById(id)){
				js=d.createElement(s);
				js.id=id;
				js.src="//platform.twitter.com/widgets.js";
				fjs.parentNode.insertBefore(js,fjs);
			}}
		(document,"script","twitter-wjs");
		*/
	},
	
	
	_applySubscriptions: function() {
		var self = this;

		self.__oldProductosComputedValue;

		ko.computed(function () {
			return ko.mapping.toJSON({
				absolutePage: model.data.productos.recordset.absolutePage(),
				filter: model.data.productos.recordset.filter(),
				orden: model.data.productos.recordset.orden()
			})
		}, this).extend({throttle: 100}).subscribe(function (value) {
			if (model.data.productos.obtenerAlCambiar() && self.__oldProductosComputedValue != value) {
				this.obtenerProductos();
				self.__oldProductosComputedValue = value;
			}
		}, this);


		var __oldCategoriasComputedValue;
		ko.computed(function () {
			return ko.toJSON({
				productos: model.data.categorias.recordset.productos(),
				absolutePage: model.data.categorias.recordset.absolutePage(),
				filter: model.data.categorias.recordset.filter()
			})
		}, this).extend({throttle: 100}).subscribe(function (value) {
			if (__oldCategoriasComputedValue != value) {
				this.obtenerCategorias();
				__oldCategoriasComputedValue = value;
			}
		}, this);


		var __oldCarritosComputedValue;
		ko.computed(function () {
			return ko.mapping.toJSON({
				absolutePage: model.data.carritos.recordset.absolutePage()
			})
		}, this).extend({throttle: 100}).subscribe(function (value) {
			if (__oldCarritosComputedValue != value) {
				this.obtenerCarritos();
				__oldCarritosComputedValue = value;
			}
		}, this);


		ko.computed(function () {
			var idOrden = model.data.carritos.idOrden()
				, carritosCargado = model.data.carritos.cargado();

			if (idOrden && carritosCargado) {
				var carrito = model.data.obtenerCarritoPorId(idOrden);
				model.data.carritos.seleccionado(carrito);
			}
		}, this);

		////////////////////////////////////////////////////////////////////////

		model.data.carrito.subscribe(function (item) {			
                    
                    var viejoValor = ko.unwrap(item.cantidad)
				, nuevoValor = parseInt(ko.unwrap(item.cantidad.nuevoValor));                                
                                
                                if(nuevoValor<0 || isNaN(nuevoValor))
                                {
                                    nuevoValor = 1;
                                    item.cantidad.nuevoValor(1);                                                                        
                                }                                
                                
                                var max = parseInt(item.producto.stock());
                                
                                if(isNaN(max) || max < 0) max=0;
                                
                                if (max>0 && item.producto.stockValidarExistencia())
                                {
                                    max = Math.min(9999,max);
                                } else
                                {
                                    max = 9999;
                                }
                                
                                if(nuevoValor>max)
                                {
                                    nuevoValor = max;
                                    item.cantidad.nuevoValor(nuevoValor);
                                }
                                
			self.modificarCarrito(item.idProducto(), nuevoValor, viejoValor);
		}, this, 'itemCambioCantidadNuevoValor');

		////////////////////////////////////////////////////////////////////////

		model.data.carrito.subscribe(function () {
			if (model.data.market.timeoutCarritoConfirmadoActivado()) {
				controller.obtenerCarrito().done(function () {
					if (model.data.carrito.canceladoPorVencimiento()) {
						self._onOrdenCompraCancelada();
					}
				});
			}
		}, this, 'vencioTimeout');

		////////////////////////////////////////////////////////////////////////

		model.data.carrito.idCotizacionEnvio.subscribe(function (idCotizacionEnvio) {
			if (idCotizacionEnvio) {
				controller.ordenCompraAplicarCotizacionEnvio();
			}
		}, this);

		////////////////////////////////////////////////////////////////////////

		ko.computed(model.data.estructura.contenido.data.snippets).extend({throttle: 100})
			.subscribe(function (snippetsDeEstructura) {
				setTimeout(function () {
					$(window).trigger('estructuraCargada');
				}, 100);
			}, this);


		///////////////////////////////////////////////////////////////////////

		// autocorregir las URLs de acuerdo a la seccin activa
		if( this.autocorregirURLSeccionActiva ){
			ko.computed(model.data.paginas.enVisualizacion.nombreAnclaActiva).extend({throttle: 100})
				.subscribe(function ( anclaActiva ) {
					var newQuery = {};
					newQuery[ tiendasimple.Pagina.Enlace.getAnclaParamName() ] = anclaActiva;

					var hb = $.hashbang.get().mergeQuery( newQuery ).toURL()
					this.reemplazarHashbang( hb );
				}, this );
		}


		///////////////////////////////////////////////////////////////////////

		model.data.usuario.subscribe( function( nuevaDireccion ){
			nuevaDireccion.pais( model.data.isoPaisDesdeIp() );
		}, this, 'nuevaDireccion');
	},
	
	_applyBindings: function(){
		$('body').on('click', '[data-action=history-back]', this.historyBack.bind(this));

		$('body').on('click', '[data-action=logout]', this.logoutCliente.bind(this));

		$('body').on('click', '[data-action=agregar-a-carrito]', this.agregarACarrito.bind(this));
		$('body').on('click', '[data-action=quitar-de-carrito]', this.quitarDeCarrito.bind(this));

		$('body').on('click', '[data-action=reenviar-codigo-activacion]', this.reenviarCodigoActivacion.bind(this));

		// BOTON CONSULTAR
		$('body').on('click', '[data-action=enviar-form-consulta]', this.enviarFormConsulta.bind(this));


		//$('body').on('click', '[data-action=guardar-direccion]', this.guardarDireccion.bind(this));

		//$('body').on('click', '[data-action=asignar-direccion-a-carrito]', this.asignarDireccionACarrito.bind(this));

		$('body').on('click', '[data-action=asignar-metodopago-a-carrito]', this.asignarMetodoPagoACarrito.bind(this));
		$('body').on('click', '[data-action=checkout-finalizar]', this.checkoutCarrito.bind(this));
		$('body').on('click', '[data-action=iniciar-metodopago-carrito]', this.iniciarMetodoPagoCarrito.bind(this));
		
		$('body').on('click', '[data-action=ordencompra-confirmar]', this.ordenCompraPagar.bind(this)); // el botn pagar
		$('body').on('click', '[data-action=ordencompra-cancelar]', this.ordenCompraCancelar.bind(this));
		$('body').on('click', '[data-action=ordencompra-modificar]', this.ordenCompraModificar.bind(this));
		$('body').on('click', '[data-action=ordencompra-reiniciar]', this.ordenCompraReiniciar.bind(this));
		$('body').on('click', '[data-action=ordencompra-estado-siguiente]', this.ordenCompraSiguienteEstado.bind(this));
                $('body').on('click', '[data-action=ordencompra-aplicar-descuento]', this.ordencompraAplicarDescuento.bind(this));
                $('body').on('click', '[data-action=ordencompra-eliminar-descuento]', this.ordencompraEliminarDescuento.bind(this));

		$('body').on('click', '[data-action=duplicar-carrito]', this.duplicarCarrito.bind(this));

		$('body').on('click', '[data-action=cambiar-password]', this.cambiarPassword.bind(this));
		$('body').on('click', '[data-action=guardar-cliente]', this.guardarCliente.bind(this));
		$('body').on('click', '[data-action=eliminar-direccion-cliente]', this.eliminarDireccionCliente.bind(this));

		$('body').on('submit', '#ventana-login form', this.loginCliente.bind(this));
		$('body').on('submit', '#ventana-registro form', this.registrarCliente.bind(this));
		$('body').on('submit', '#ventana-invitado form', this.registrarInvitado.bind(this));
		$('body').on('submit', '#registro-invitado form', this.registrarInvitado.bind(this));
		$('body').on('change', '[data-action="aceptar-gdpr"]', this.aceptarGDPR.bind(this));
		$('body').on('submit', '#ventana-validar-email form', this.habilitarCliente.bind(this));
		$('body').on('submit', '#ventana-recordar-password form', this.recordarPassword.bind(this));

		$('body').on('submit', '#seccion-contacto form', this.enviarEmailContacto.bind(this));
		
		$('body').on('submit', 'form.buscar-productos', this.buscarProductos.bind(this));

		$('body').on('click', '[data-action="social-share-twitter"]', this.socialShareTwitter.bind(this));
		$('body').on('click', '[data-action="social-share-facebook"]', this.socialShareFacebook.bind(this));
		$('body').on('click', '[data-action="social-share-googleplus"]', this.socialShareGooglePlus.bind(this));
		$('body').on('click', '[data-action="social-share-pinterest"]', this.socialSharePinterest.bind(this));
		$('body').on('click', '[data-action="social-share-whatsapp"]', this.socialShareWhatsapp.bind(this));
		$('body').on('click', '[data-action="ask-me-on-whatsapp"]', this.askMeOnWhatsapp.bind(this));
		$('body').on('click', '[data-action="social-share-linkedin"]', this.socialShareLinkedIn.bind(this));
    	$('body').on('click', '[data-action="aceptar-gdpr"]', this.checkPoliticasPrivacidad.bind(this));
		
		/*
		//$('body').on('submit', '#ventana-apariencia-guardar', this.guardarTemplate.bind(this));
		$('body').on('click', '[data-action=apariencia-guardar]', this.guardarTemplate.bind(this));
		//$('body').on('click', '[data-action=apariencia-confirmar-guardar-nuevo]', this.confirmarGuardarTemplateNuevo.bind(this));
		$('body').on('click', '[data-action=apariencia-obtener-template-edicion]', this.obtenerTemplateEdicion.bind(this));
		$('body').on('click', '[data-action=apariencia-clonar-template]', this.clonarTemplate.bind(this));
		$('body').on('click', '[data-action=apariencia-nuevo-template]', this.nuevoTemplate.bind(this));

		$('body').on('click', '[data-action=apariencia-editar-estilo]', this.editarEstilo.bind(this));
		$('body').on('click', '[data-action=apariencia-clonar-estilo]', this.clonarEstilo.bind(this));
		$('body').on('click', '[data-action=apariencia-guardar-estilo]', this.guardarEstilo.bind(this));
		$('body').on('click', '[data-action=apariencia-nuevo-estilo]', this.nuevoEstilo.bind(this));
		$('body').on('click', '[data-action=apariencia-cancelar-estilo]', this.cancelarEdicionEstilo.bind(this));
		
		$('body').on('click', '[data-action=apariencia-editar-tema]', this.editarTema.bind(this));
		$('body').on('click', '[data-action=apariencia-clonar-tema]', this.clonarTema.bind(this));
		$('body').on('click', '[data-action=apariencia-guardar-tema]', this.guardarTema.bind(this));
		$('body').on('click', '[data-action=apariencia-nuevo-tema]', this.nuevoTema.bind(this));
		$('body').on('click', '[data-action=apariencia-cancelar-tema]', this.cancelarEdicionTema.bind(this));		
		$('body').on('click', '[data-action=nueva-categoria-template]', this.nuevaCategoriaTemplate.bind(this));
		*/

		$('body').on('click', '[data-action=widget-formulario-enviar]', this.widgetFormularioEnviar.bind(this));

		////////////////////////////////////////////////////////////////////////
		// al hacer click en un collapse, se agrega una clase al body para que los menes puedan hacer scroll en pantallas pequeas

		$('body').on('click.collapse.data-api', '[data-toggle="collapse"]', function(event){
			var $this = $(this), href
			, target = $this.attr('data-target')
			|| e.preventDefault()
			|| (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') //strip for ie7
				, option = $(target).data('collapse') ? 'toggle' : $this.data();
			setTimeout(function(){
				var $element = $this;
				//console.debug(target);
				/*if( $element.hasClass('btn-navbar') ){
					$('body').toggleClass( 'nav-collapse-expanded', !$element.hasClass('collapsed') );
				}*/
				if( target == '.nav-collapse' ){
					$('body').toggleClass( 'nav-collapse-expanded nav-collapse-show', $(target).hasClass('in') );					
				}
			},100);
		});		
		////////////////////////////////////////////////////////////////////////
                ////////////////////////////////////////////////////////////////////////

		if( this.trackearURLSeccionActiva ){
			
			$(window).on('scroll', $.throttle( this.trackearURLSeccionActivaDebounce , function(){
				model.data.paginas.enVisualizacion.nombreAnclaActiva.recalc();
			}));

			$(window).on('scroll', $.debounce( this.anclasEnPantallaDebounce , function(){
				model.data.paginas.enVisualizacion.anclasEnPantalla.recalc();
			}));
		}

		////////////////////////////////////////////////////////////////////////
		///////////////////////////// BLOG

		$('body').on('click', '[data-action="btn-buscar-blog"]', this.buscarEnBlog.bind(this)); 
		$('body').on('keypress', '[data-action="input-buscar-blog"]', this.buscarEnBlogKeyBoard.bind(this));
		$('body').on('click', '[data-action="ir-a-blog"]', this.irAblog.bind(this));

		$('body').on('blur', '[data-action="input-buscar-email-invitado"]', this.comprobarEmailInvitado.bind(this));

		///////////////////////////////////////////////////////////////////////
		///////////// FIX NAVEGACION

		$('body').on('click', '[data-action="click-link-menu"]', function(event){
			var self = this;
			$('.navbar .nav>').removeClass("active");
		});

		////////////////////////////////////////////////////////////////////////
		////// FILES UPLOAD
		/////////////////////////////////////////////////////////////////////////

		// forms
		$('body').on('change', '[data-action="form-upload-file-forms"]', function(event){ 
			$('#form-files-upload-forms').submit();
		});
		 
		$('body').on('change', '#fileuploadform', function(event){ 
		var file = $('form.form-files-upload-forms input[type=file]').val();
		var ext = file.substr(file.lastIndexOf('.') + 1);
		var extensionsValid = ''; 
		extensionsValid += 'jpeg,jpg,png,bmp,';
        extensionsValid += 'pdf,';
        extensionsValid += 'doc,docx,';
        extensionsValid += 'xls,xlsx,';
        extensionsValid += 'zip,rar';
        // others
        extensionsValid += 'txt,ppt,xls,csv,odt,mp3,mp4';
        extensionsValid += 'ogg,waw,epub'; 
		extensionsValid += 'jpeg,jpg,png,bmp,';
        extensionsValid += 'pdf,';
        extensionsValid += 'doc,docx,';
        extensionsValid += 'xls,xlsx,';
        extensionsValid += 'zip,rar';
        // others
        extensionsValid += 'txt,ppt,xls,csv,odt,mp3,mp4';
		extensionsValid += 'ogg,waw,epub';
		var arrExtensions = extensionsValid.split(',');
		if (!extensionsValid.includes(ext)){
			model.data.ventanas.fileuploaderror.mostrar();
			return;
		}
		// get token for upload
		controller.generateTokenFormUpload()
			.then(function(response){
				model.data.formsTokenUpload(response.token);
			}).catch(function(err){
				console.log('err =>', err);
			});
		
		file = file.split('\\');
		file = file.pop();
		model.data.formsFileUploaded(file);
		});

		// LOGIN REDES SOCIALES
		$('body').on('click', '[data-action="loginGmail"]', this.loginGmail.bind(this));
		$('body').on('click', '[data-action="loginFacebook"]', this.loginFacebook.bind(this));
		
		// forms...

		$('body').on('submit', '#form-files-upload-forms', function (e){
			e.preventDefault();
			var formData = new FormData(document.getElementById("form-files-upload-forms"));
			var endpoint = model.data.apiEndpoint() + "fileupload";
			var options = {};
			$.ajax({
				url: endpoint,
				type: "post",
				dataType: "html",
				data: formData,
				cache: false,
				contentType: false,
				processData: false,
				files: $(".form-files-upload #file"),
				headers: {
					"Authorization" : 'Bearer ' + token,
				},
			})
			.done(function(res){
				if (res.Success !== true){
					model.data.ventanas.fileuploaderror.mostrar();
					return;
				}
				//console.log('res =>', res);
				//model.data.files.uploadingFiles = false ;
				//model.data.files.getFiles( options );
				//model.data.files.inProgress( false );
			})
			.fail(function(e){
				model.data.ventanas.fileuploaderror.mostrar();
				return;
				//model.data.files.inProgress( false );
				//model.data.files.uploadingFiles = false;
				//console.log('e =>', e);
			});
			
		});

		////////////////////////////////////////////////////////////////////////

		ko.applyBindings(model.data, $('html')[0]);
	},

	_observarURL: function(){
		var self = this;
		$(window).bind( "hashchange", this.hashChange.bind(this));
		this.hashChange();
	},

	_getHashbang: function( url, query ){
		var hashbang = url;
		if( !(url instanceof HashBang.Result) ){
			hashbang = $.hashbang.get( url);
		}
		if( query ){
			hashbang.setQuery( query );
		}
		return hashbang;
	},

	corregirHashbang: function( url, query ){
		this.__corrigiendoHashbang = true;
		var hashbang = this._getHashbang( url, query );
		hashbang.navigate();
	},

	reemplazarHashbang: function( url, query, sinCorregir ){
		var hashbang = this._getHashbang( url, query );
		if( hashbang.toURL() != location.hash ){
			this.__corrigiendoHashbang = !sinCorregir;
			hashbang.replace();
		}
		/*
		setTimeout( function(){
			this.__corrigiendoHashbang = false;
		},10);
		*/
	},
			
	navegarAHashbang: function( url, query ){
		var hashbang = this._getHashbang( url, query );
		hashbang.navigate();
	},

	navegarAProductoSeleccionado:function(){
		var productoSeleccionado = model.data.productos.seleccionado();
		if( productoSeleccionado ){
			var url = productoSeleccionado.opcionesSeleccionada().getUrl();
			if( location.hash != url ){
				//console.log('corregir url a la del producto seleccionado de', location.hash, 'a', url.toString());
				this.navegarAHashbang( url );
			}
		}
	},

	_onPaginaNoEncontrada: function(){
		//console.log('_onPaginaNoEncontrada');
		if( window.G_esCuttyCapt ){
			this.show404();
		}
		else $.hashbang.get({}).replace();
	},
	navegarAAncla: function( nombreAncla ){
			var duration = this.autoScrollDuration;
			if( nombreAncla === undefined ) {
				var query = model.data.hashbang().get().query;
				nombreAncla = query[ tiendasimple.Pagina.Enlace.getAnclaParamName() ];
			}
                                
			var $element;
			if( nombreAncla ){
				$element = $('[ancla="' + nombreAncla + '"]');
			}

			var offsetTop = -tiendasimple.Snippet.Ancla.getActiveTopPosition();
			var settings = {
				'duration'	: duration,
				'offset'	: {
					'top'	: offsetTop
				},
				'onAfter'	: $.debounce(this.trackearURLSeccionActivaDebounce+100, function(){
					model.data.paginas.enVisualizacion.nombreAnclaActiva.scrolling( false );
					model.data.paginas.enVisualizacion.nombreAnclaActiva(nombreAncla);
					/*
					if( $element ){
						var offsetTop = -tiendasimple.Snippet.Ancla.getActiveTopPosition();
						$.scrollTo( $element , {duration: 100, offset: {top: offsetTop}});
					}*/
				})
			};

			$(window).stop();
			model.data.paginas.enVisualizacion.nombreAnclaActiva.scrolling( true );
			if( $element && $element.length != 0 ){
				var chrono = new Chronometer();
				var iniScrollTop	= $(window).scrollTop();
				$(window).animate({
					scrollTop:0
				}, {
					duration: duration,
					complete	: function(){
						model.data.paginas.enVisualizacion.nombreAnclaActiva.scrolling( false );
						model.data.paginas.enVisualizacion.nombreAnclaActiva(nombreAncla);
						//console.log( chrono.elapsed() );
					},
					step: function( now, tween){
						var relativePosition 	= $element.relativePosition();
						var offsetTop 			= tiendasimple.Snippet.Ancla.getActiveTopPosition();
						var destination 		= relativePosition.top - offsetTop;
						var pos 				= tween.pos;
						//var actual				= $(window).scrollTop();
						var now = $.math.linear( pos ,{x:0,y:iniScrollTop},{x:0,y:destination});
						tween.now = now.y;
					}
				});
			} else{
				if($(window).scrollTop() > 0) {
					// => FIX (borrar) $.hashbang.get().setQuery('').navigate();
					$(window).animate({
						scrollTop:0
					}, {});
				};
				
			}
	},

	navegarAEnlace: function( enlace ){
		var self = this;
		if( enlace.asJS.tipo() == 'stream' ) {
			var url = enlace.getHref();
			if( url.indexOf('url') !== -1 ) {
				if ( url.split("url=")[1].substring(0,5) != 'https' ) {
					url = model.data.market.dtUrlApp() + url;
				}
			}
			model.data.abrirRadio ? model.data.abrirRadio( url ) : window.open( url,'','width=260,height=160');
		} else {
			if( model.data.esEnlaceAPaginaActiva( enlace ) ){
				setTimeout( function(){
					self.navegarAAncla( enlace.asJS.ancla() );
				}, 100 );
			} else {
				return true;
			}
		}
	},

	hashChange: function(e){
		var self = this;

		if( this.__corrigiendoHashbang == true ){
			this.__corrigiendoHashbang = false;
			return;
		}
		
		//si la URL tiene codificado el bang (generalmente por error de gmail, reemplazar el %21 por ! 
		if( $.param.fragment().substr(0,3) == '%21' ){
			return $.hashbang.get( $.param.fragment().substr(3) ).replace();
		}
		
		var url = $.hashbang.get();


		////////////////////////////////////////////////////////////////////
		// aplicar temas //
		if(url.query.estilo){
			model.data.template.rutaEstilo(url.query.estilo);
		}

		if(url.query.tema){
			model.data.template.rutaTema(url.query.tema);
		}

		////////////////////////////////////////////////////////////////////
		//si no hay un ! luego del #, navegar al raz
		if(url.getPath()[0] && url.getPath()[0].key=='!'){
			return $.hashbang.get('/').replace();
		}


		////////////////////////////////////////////////////////////////////////
		// no hay path
		if($.isEmptyObject(url.path)) {
			
			// si el market aun no fue configurado, se muestra la pantalla de bienvenida
			//if( model.data.market.estadoWizard().indexOf('wizardConfiguracion')!=-1 ){
			if( $.inArray( model.data.market.estadoWizard(), [tiendasimple.Market.EstadoWizard.WIZARD_CONFIGURACION_NOMBRE_SITIO] )!=-1 ){
				return url.setPath({bienvenida:null}).replace();
			}
			
			var primerPagina = model.data.obtenerPaginaHome();
			if( primerPagina ){
				var newHashBang = model.data.getPageHashBang( primerPagina );
				if( primerPagina.tipo() == 'enlace' ) return location.href = newHashBang;
				else return url.setPath( newHashBang ).replace();
			} else {
				
				// return url.setPath({categoria:0}).replace();			
			}
		}
		
		////////////////////////////////////////////////////////////////////////
		var recordarPassword = url.inPath('login') && url.path.login == 'recordar-password';
		model.data.ventanas.recordarPassword.activa( recordarPassword );
		if( recordarPassword ) return;
		
		////////////////////////////////////////////////////////////////////////	

		var recordarPasswordEnviado = url.inPath('login') && url.path.login == 'recordar-password-enviado';
		model.data.ventanas.recordarPasswordEnviado.activa( recordarPasswordEnviado );
		if( recordarPasswordEnviado ) return;


		if('login' in url.path && url.isPathEmpty('login')){
			model.data.ventanas.login.reset();
			model.data.ventanas.login.mostrar();
			return;
		} else {
			model.data.ventanas.login.ocultar();
		}

		if('logout' in url.path) return controller.logoutCliente();

		if('registro' in url.path && !url.path.registro){
			if(model.data.usuario.logueado()) url.reset().navigate();
			else {
				model.data.ventanas.registro.reset();
				model.data.ventanas.registro.mostrar();
			}
			return;
		} else {
			model.data.ventanas.registro.ocultar();				
		}

		if('invitado' in url.path && !url.path.invitado){
			if(model.data.usuario.logueado()) url.reset().navigate();
			else {
				model.data.ventanas.invitado.reset();
				model.data.ventanas.invitado.mostrar();
			}
			return;
		} else {
			model.data.ventanas.invitado.ocultar();				
		}

		if(url.path.registro == 'validar-email') {
			if(url.query.usuario) model.data.ventanas.validarEmail.usuario(url.query.usuario);
			if(url.query.codigo) model.data.ventanas.validarEmail.codigo(url.query.codigo);
			model.data.ventanas.validarEmail.mostrar();
			return; 
		} else {
			model.data.ventanas.validarEmail.ocultar();				
		}

		var registroCompleto = 'registro-completo' in url.path;
		model.data.ventanas.registroCompleto.toggleMostrar( registroCompleto );
		if( registroCompleto ) return;


		////////////////////////////////////////////////////////////////////
		
		if(url.firstPathIs('404')){
			return model.data.seccionActiva(tiendasimple.front.Secciones.NOTFOUND);
		}
		
		////////////////////////////////////////////////////////////////////

		if(url.firstPathIs('carrito')){
			if( model.data.carrito.esOrdenDeCompras() ){
				return self.navegarAHashbang('/orden-compra/confirmar');
			}
			if( url.path['carrito'] == 'confirmar' ){
				return this.carritoConfirmar();
			} else {
				return model.data.seccionActiva(tiendasimple.front.Secciones.CARRITO);
			}
		}
		
		////////////////////////////////////////////////////////////////////

		if(url.firstPathIs('orden-compra')){
			
			if( url.path['orden-compra'] == 'confirmar' ){

				if( url.path['accion'] == 'pagar' ){
					self.ordenCompraPagar();
					return;
				}

				if( model.data.carrito.esCarrito() ){
					return self.navegarAHashbang('/carrito/');
				} if( model.data.carrito.cancelado() ){
					return self._onOrdenCompraCancelada();
				} else {
					if( model.data.carrito.enPortalDePagos() ) return self.navegarAHashbang('/orden-compra/portal-pagos');
					else return model.data.seccionActiva(tiendasimple.front.Secciones.ORDENCOMPRA_CONFIRMAR);
				} 
				
			}
			
			if( url.path['orden-compra'] == 'esperando-aprobacion' ){
				return model.data.seccionActiva(tiendasimple.front.Secciones.ORDENCOMPRA_ESPERANDOAPROBACION);
			}
			
			if( url.path['orden-compra'] == 'portal-pagos' ){
				if(model.data.carrito.enPortalDePagos()){
					return model.data.seccionActiva(tiendasimple.front.Secciones.ORDENCOMPRA_PORTALPAGOS);					
				} else {
					return self.navegarAHashbang('/carrito/');
				}
			}
			
			if( url.path['orden-compra'] == 'portal-pagos-error' ){
				if(model.data.carrito.enPortalDePagos() || model.data.carrito.enPortalDePagosConError() ){
					return model.data.seccionActiva(tiendasimple.front.Secciones.ORDENCOMPRA_PORTALPAGOS_ERROR);					
				} else {
					return self.navegarAHashbang('/carrito/');
				}
			}

   			if( url.path['orden-compra'] == 'portal-pagos-ok' ){
				if(model.data.carrito.enPortalDePagos()){
					controller.ordenCompraPortalPagosOk(url.query);
				} else {
					//return self.navegarAHashbang('/carrito/');
				}
				return model.data.seccionActiva(tiendasimple.front.Secciones.ORDENCOMPRA_PORTALPAGOS_OK);					

			}
			
			if( url.path['orden-compra'] == 'portal-pagos-payu' ){
				var transactionState = url.query.transactionState
					,query = {};					
				query.metodoPago = 'payu';
				query.resultado = url.query.message;
				query.servicio	= url.query.lapPaymentMethod;
				
				if( transactionState == 4 || transactionState == 7 ) {
					return this.navegarAHashbang({'orden-compra': 'portal-pagos-ok'}, query);
				}
				else return this.navegarAHashbang({'orden-compra': 'portal-pagos-error'}, query);
			}
			
		}
		
		////////////////////////////////////////////////////////////////////

		
		if(url.firstPathIs('blank')){
			return model.data.blank( true );
		}
		
		////////////////////////////////////////////////////////////////////
		
		if(url.firstPathIs('bienvenida')){
			return model.data.seccionActiva( tiendasimple.front.Secciones.BIENVENIDA );
		}

		////////////////////////////////////////////////////////////////////

		if(url.firstPathIs('mi-cuenta')){

			if( url.path['mi-cuenta'] == undefined ){
				self.navegarAHashbang('/mi-cuenta/datos-personales');
			}

			if( url.path['mi-cuenta'] == 'datos-personales' ){ }

			if( url.path['mi-cuenta'] == 'ordenes-de-compra' ){
				var absolutePage = url.path.pagina || 0;
				var pageSize = model.data.carritos.recordset.pageSize();

				var carritosOptions = {
					absolutePage	: absolutePage || 0,
					pageSize		: pageSize
				};

				model.data.carritos.recordset.absolutePage( carritosOptions.absolutePage );
				model.data.carritos.recordset.pageSize( carritosOptions.pageSize );

				var orden = url.path.orden;
				model.data.carritos.idOrden( orden );

			}

			return model.data.seccionActiva(tiendasimple.front.Secciones.MI_CUENTA);
		}

		////////////////////////////////////////////////////////////////////

		if('checkout' in url.path){
			if(url.path.checkout == 'direccion') {
				if(!model.data.usuario.logueado()) url.setPath({'carrito': ''}).replace();
				else model.data.seccionActiva(tiendasimple.front.Secciones.CHECKOUT);
			}
			
			if(url.path.checkout == 'metodopago') {
				if(!model.data.usuario.logueado()) url.setPath({'carrito': ''}).replace();			
				else {
					if( url.path.resultado ){
						if( url.path.resultado == 'ok' ) model.data.seccionActiva( tiendasimple.front.Secciones[ 'CHECKOUT_METODOPAGO_OK'] );
						if( url.path.resultado == 'error' ) model.data.seccionActiva( tiendasimple.front.Secciones[ 'CHECKOUT_METODOPAGO_ERROR'] );
						if( url.path.resultado == 'pending' ) model.data.seccionActiva( tiendasimple.front.Secciones[ 'CHECKOUT_METODOPAGO_PENDING'] );
						
						if( url.path.resultado == 'ok' ){
							self.checkoutCarrito();
						}
						
					} else {
						model.data.seccionActiva(tiendasimple.front.Secciones.CHECKOUT_METODOPAGO);
					}
				}
			}

			
			if(url.path.checkout == 'resumen') {
				if(!model.data.carrito.idDireccionEnvio()) url.setPath({'checkout': 'direccion'}).navigate();
				if(model.data.carrito.detalle().length == 0) url.setPath('carrito').replace();
				else model.data.seccionActiva(tiendasimple.front.Secciones.CHECKOUT_RESUMEN);
				
				if(url.inPath( 'finalizar' ) ) {
					this.checkoutCarrito().fail(function(){
						history.back();
					})
				}
				
				if(url.inPath('iniciar-metodo-pago')) {
					
					this.reemplazarHashbang( url.removePathKey('iniciar-metodo-pago').toURL() );
					this.iniciarMetodoPagoCarrito();
				}
			}


			if(url.path.checkout == 'finalizar') {
				model.data.seccionActiva(tiendasimple.front.Secciones.CHECKOUT_FINALIZAR);
			}


			return;

		} else {
			// model.data.seccionActiva(tiendasimple.front.Secciones.CATALOGO);				
		}


		////////////////////////////////////////////////////////////////////////

		if('producto' in url.path){
			var opcion = url.query.opcion;
			model.data.productos.cargando( true );
			model.data.seccionActiva(tiendasimple.front.Secciones.CATALOGO);
			controller.productoSeleccionado(url.path.producto, opcion )
				.done( function( producto ){
					if(!producto){
						self.show404();
					} else {
						self.FBViewContent( producto );
						var urlProducto = producto.opcionesSeleccionada().getUrl();
						if( urlProducto != location.hash ){ // la URL es de otra opcin...
							//console.log( 'la url actual ', location.hash, 'no es la de la opcin seleccionada', urlProducto.toString() );
							urlProducto.replace(); // reemplazar la URL actual por la nueva URL
							//console.log( 'se reemplaz la URL por', location.hash );
						}
					}
				});
			return;
		}
		
		////////////////////////////////////////////////////////////////////////		
		
		if('categoria' in url.path){
			controller.productoSeleccionado(null);
			model.data.seccionActiva(tiendasimple.front.Secciones.CATALOGO);
			if(!url.path.pagina){
				//return $.bbq.pushState('#!/categoria/' + params.categoria + '/pagina/0')
			}
			var absolutePage = url.path.pagina || 0;
			var pageSize = model.data.productos.recordset.pageSize();
			var filterCategoria = model.data.categorias.recordset.filter() || {};
			var idCategoria = url.path.categoria;
			if(idCategoria == 0) idCategoria = null;
			
			var filtroProducto = url.query['filtro'];
			if(typeof filtroProducto == 'string') {
				filtroProducto = $.trim(filtroProducto);
			}
			
			if(!filtroProducto) filtroProducto = null;
			
			model.data.textoBusquedaProductos(filtroProducto);

			//var categoriaActual = (model.data.categorias.seleccionado() && model.data.categorias.seleccionado().id()) || filterCategoria.padre || 0;
			var categoriaActual = filterCategoria.padre || 0;
			var categoriaCargada = model.data.categorias.idActual() !== undefined;  // categoriaActual == 0 ? !model.data.categorias.seleccionado() : model.data.categorias.seleccionado() && model.data.categorias.seleccionado().id() == categoriaActual;  // model.data.categorias().length != 0;

			//console.debug('categoriaActual', categoriaActual, 'categoriaCargada', categoriaCargada);
			var productosOptions = {
				absolutePage	: absolutePage || 0,
				pageSize		: pageSize,
				filter			: { 'descripcion' : filtroProducto }
			};

			//console.debug( 'productosOptions', productosOptions );

			var estaBusquedaConFiltro = !!filtroProducto;
			var cambioFiltro = this.__ultimaBusquedaConFiltro != filtroProducto;
			//console.debug('cambioFiltro', cambioFiltro);
			
			if(!cambioFiltro && categoriaCargada && categoriaActual == url.path.categoria){
				var nuevoFilter = $.extend( productosOptions.filter, { idCategoria: idCategoria } );
				//console.debug( 'misma categora, cargar productos.', nuevoFilter );
				model.data.productos.recordset.absolutePage( productosOptions.absolutePage );
				model.data.productos.recordset.pageSize( productosOptions.pageSize );
				model.data.productos.recordset.filter( nuevoFilter );
				model.data.productos.obtenerAlCambiar( true );
			} else {
				//console.debug( 'cargar nueva categora con sus productos' );
				model.data.categorias.recordset.filter( { padre: idCategoria, soloProductosEncontrados: estaBusquedaConFiltro } );
				model.data.categorias.recordset.productos( productosOptions );
			}
			
			this.__ultimaBusquedaConFiltro = filtroProducto;

			return; 
		}

		////////////////////////////////////////////////////////////////////////
		if( url.inPath('contacto')){
			if(url.isPathEmpty('contacto')) {
				model.data.seccionActiva(tiendasimple.front.Secciones.CONTACTO);
                                self.navegarAAncla();
			} else {
				model.data.seccionActiva(tiendasimple.front.Secciones.CONTACTO_ENVIADO);					
			}
			return;
		}

		////////////////////////////////////////////////////////////////////
		clearTimeout( this._navegarAAnclaTimeout );
		this._navegarAAnclaTimeout = setTimeout( function(){
			self.navegarAAncla();
		}, 100);

		////////////////////////////////////////////////////////////////////////

		if('blog' in url.path){

			if (model.data.market.dtTieneBlog() == 0){
				// redireccionar o mostrar una pagina donde 
				// se indique que la pagina blog ya no est 
				// disponible
				return;
			}

			var pagina = model.data.blog.obtenerPagina();
			model.data.seccionActiva('blog');
			var seccion = url.path.blog;
			var arrUrl = window.location.href.split('/');
			model.data.blog.seccionActiva('listado');

			////////////////////////////////////////////////////////////////////
			// -> Ampliar entrada

			$('#input-buscar-blog').val('');
			
			if (url.path.blog !== undefined && arrUrl[arrUrl.length-2] == 'p'){
				var slug = url.path.blog;
				var entradaId = window.location.href.split('/');
				entradaId = entradaId[entradaId.length -3];
				var options = {};
				options.id = entradaId;
				if (!isNaN(entradaId)){
					model.data.blog.entrada([]);
					model.data.blog.obtenerEntradas(options);
					options.tagsPorCategoria = true;
					model.data.blog.obtenerTags(options);
					model.data.blog.obtenerEntradasRelacionadas(options);
				}else{	
					model.data.blog.redireccionarBlog();				
				}
				model.data.blog.seccionActiva('entrada');
				return;
			}

			////////////////////////////////////////////////////////////////////
			// -> Busqueda en blog

			if (url.path.blog !== undefined && url.path.blog == 'search'){
				var search = window.location.href.split('/');
				var i = search.indexOf(model.data.blog.urlBusqueda());
				i++;
				search = search[i];
				model.data.blog.buscarEnBlog(search);
				model.data.blog.seccionActiva('listado-busqueda');
				return;
			}

			////////////////////////////////////////////////////////////////////
			// -> Filtrado de entradas por categoria

			if (url.path.blog !== undefined && url.path.blog == model.data.blog.urlCategorias()){
				var categoria = window.location.href.split('/');
				var indexCategoria = categoria.indexOf(model.data.blog.urlCategorias()) + 2;
				indexCategoria = categoria[indexCategoria];
				categoria = categoria[categoria.length -2];
				if (isNaN(indexCategoria)){
					model.data.blog.redireccionarBlog();
					return;
				}
				model.data.blog.entradasPorCategoria(indexCategoria);
				model.data.blog.seccionActiva('entradas-por-categoria');
				return;
			}

			////////////////////////////////////////////////////////////////////
			// -> Tags
		
			if (url.path.blog !== undefined && url.path.blog == model.data.blog.urlTags()){
				var idTag = arrUrl.indexOf(model.data.blog.urlTags()) + 2;
				idTag = arrUrl[idTag];
				if (isNaN(idTag)){
					model.data.blog.redireccionarBlog();
					return;
				}
				var options = {};
				options.idTag = idTag;
				model.data.blog.obtenerEntradas(options);
				model.data.blog.seccionActiva('entradas-por-tags');
				return;
			}

			///////////////////////////////////////////////////////////////
			// -> home
			model.data.blog.obtenerEntradas();
			model.data.seccionActiva(tiendasimple.front.Secciones.BLOG);
			return; 
		}
		////////////////////////////////////////////////////////////////////////

		if( url.getPath()[0] && url.getPath()[0].key == 'pagina'){
			var id = url.path.pagina
				, pagina = model.data.obtenerPaginaPorId(id);
				
			if( pagina ){
				var id = pagina.id();
				controller.paginaActiva(id);
				return model.data.seccionActiva(tiendasimple.front.Secciones.PAGINA);
			} else {
				self._onPaginaNoEncontrada();
			}
		}

		////////////////////////////////////////////////////////////////////////
		if( url.getPath()[0] && url.getPath()[0].key == 'catalogo'){
			var filterCategoria = model.data.categorias.recordset.filter() || {};
			var pagina = model.data.categorias.recordset.absolutePage();
			var nuevaUrl = url.setPath( {'categoria': filterCategoria.padre || 0, 'pagina': pagina } );
			//console.debug("nueva url", nuevaUrl);
			return nuevaUrl.replace();
		}

		if(url.firstPathIs('registro-invitado')){
			model.data.ventanas.invitado.reset();
			model.data.ventanas.invitado.nombre(model.data.usuario.nombre());
			model.data.ventanas.invitado.apellido(model.data.usuario.apellido());
			model.data.ventanas.invitado.email(model.data.usuario.email());
			model.data.seccionActiva(tiendasimple.front.Secciones.REGISTRO_INVITADO);
			controller.comprobarEmailInvitado(model.data.usuario.email(), false )
				.done( function( result ){
					var response = result.result;
					if ( response === 'transicion' ){
						model.data.ventanas.invitado.enProcesoDeRegistro(true);
					} 
					self.navegarAHashbang('/registro-invitado');
				});
			return;
		}

		////////////////////////////////////////////////////////////////////////
		// ser un prettyLink ?
		var prettyLink = self._getPrettyLinkFromUrl(url);
		if(prettyLink){
			var pagina = model.data.obtenerPaginaPorPrettyLink( prettyLink );
			if( pagina && pagina.tipo()=='carpeta' && pagina.subPaginas().length > 0 ) {
				pagina = pagina.subPaginas()[0];
				return self.navegarAHashbang(pagina.getPageHashBang());
			} else if( pagina && pagina.tipo()=='carpeta' ){
				return self.show404();
			} else if( pagina && pagina.tipo()!='carpeta' ) {
				var id = pagina.id();
				controller.paginaActiva(id);
				model.data.seccionActiva(tiendasimple.front.Secciones.PAGINA);
			} else {
				self._onPaginaNoEncontrada();
			}
		}

	},
	
	_getPrettyLinkFromUrl: function( url ){
		var prettyLink = url.getPath()[0] && url.getPath()[0].key
			, response;
		if(prettyLink){
			response = $.string.trimFirst( prettyLink, '-' );
		}
		return response;
	},

	////////////////////////////////////////////////////////////////////////////
	
	historyBack: function(event){
		event && event.preventDefault();
		event && event.stopPropagation();
		history.back();
	},
	
	////////////////////////////////////////////////////////////////////////////

	iluminarSeccion: function ( selectorSeccion ){
		if( this.__$seccionIluminada ){
			$(this.__$seccionIluminada).areamask('destroy');
		}

		this.__$seccionIluminada = $( selectorSeccion );
		this.__$seccionIluminada.areamask();
		//$(window).scrollTo(this.__$seccionIluminada, 500);
	},

	////////////////////////////////////////////////////////////////////////////

	deshabilitarInteractividad: function( flag ){
		model.data.deshabilitarInteractividad( flag );
	},

	////////////////////////////////////////////////////////////////////////////

	cambiarEstiloDetalleProducto: function( estilo ){
		model.data.market.configuracion.set('catalogo_estiloDetalleProducto', estilo );
	},

	obtenerEstiloDetalleProducto: function(){
		var estilo = model.data.market.configuracion.getByKeyOrCreate('catalogo_estiloDetalleProducto').value() || 'default'
			, nombreTemplate = 'template-estilo-' + estilo;

		return '/tpl/front/producto/detalle/' + nombreTemplate;
	},

	////////////////////////////////////////////////////////////////////////////

	loginCliente: function(event){
		var self = this;
		event && event.preventDefault();
		var context = ko.contextFor(event.target);
		var ventana = model.data.ventanas.login;
		var usuario = ventana.usuario();
		var password = ventana.password();
		var noCerrarSesion = ventana.noCerrarSesion();
		return controller.loginCliente(usuario, password, noCerrarSesion)
			.fail(function(result){
				var message = {
					'loginIncorrecto' : i18n.kot('global:validacion.mensaje.usuario_o_contrasena_incorrectos')
				}[result.error.message] || result.error.message;
				ventana.ajaxError(message);
			})

			.done(function(){
				ventana.ocultar();
				model.data.usuario.guardar();
				var parsedURL = $.hashbang.get();
				var callback = parsedURL.query.callback || '/';
				location.hash = '#!' + callback;
			});
		
	},
	
	logoutCliente: function(event){
		event && event.preventDefault();
		return controller.logoutCliente().always(function(){
			location.hash = '#!/';
		});
	},

	recordarPassword: function(event){
		event && event.preventDefault();
		var ventana = model.data.ventanas.recordarPassword;
		var usuario = ventana.usuario();
		ventana.errors && ventana.errors.showAllMessages && ventana.errors.showAllMessages();
		ventana.ajaxError(null);
		if(!ventana.isValid || ventana.isValid()){
			controller.recordarPassword(usuario)
			.fail(function(result){
				var message = {
					'inexistente': i18n.kot('global:validacion.mensaje.usuario_inexistente')
				}[result.error.message] || result.error.message;
				ventana.ajaxError(message);
			})
			.done(function(){
				ventana.reset();
				$.hashbang.get().setPath({'login':'recordar-password-enviado'}).navigate();
			});
		}
	},

	registrarCliente: function(event){
		
		event && event.preventDefault();
		var self = this
			, context = ko.contextFor(event.target)
			, ventana = model.data.ventanas.registro;
		
		var info = tiendasimple.helpers.Utils.getDataByElement('registro-clientes-form');
		
		/* gdpr check */

		var gdpr = model.data.market.configuracion.get('regional_politicaGDPR');

		if (gdpr === true){
			if (typeof info.context.$parent.ventanas.registro.gdpr === 'boolean' && info.context.$parent.ventanas.registro.gdpr === false){
				ventana.ajaxError('Debe aceptar las politicas de privacidad.');
				return;
			}
		
			if (typeof info.context.$parent.ventanas.registro.gdpr === 'function'){
				if (info.context.$parent.ventanas.registro.gdpr() === null){
					ventana.ajaxError('Debe aceptar las politicas de privacidad.');
					return;
				}
			}
		}

		/* ----- */

		if(ventana.isValid()){
            
			var datos = ventana.toJS();
			ventana.ajaxError(null);
			
			var validar = model.data.camposPersonalizados.validarCampos();
		
			if (validar.validacion === false){
				$('*[data-requerido="true"]').each(function (index, value) { 
					if ($(this).val() == '' || $(this).val() == '-1' || $(this).val() == 'on'){
						model.data.camposPersonalizados.camposRequeridos($(this).attr('id'));
					}
				});
				return;
			}

			controller.registrarCliente(datos.nombre, datos.apellido, datos.email, datos.password, validar.campos)
				.fail(function(result){
					ventana.ajaxError(result.error.message);
				})
				.done(function(){
					$.hashbang.get().setPath('registro-completo').navigate();
					self.FBCompleteRegistration();
				});
		}
	},
	
	habilitarCliente: function(event){
		var self = this;
		event && event.preventDefault();
		var context = ko.contextFor(event.target);
		var ventana = model.data.ventanas.validarEmail;
		if(ventana.isValid()){
			var datos = ventana.toJS();
			return controller.habilitarCliente(ventana.usuario, ventana.codigo)
				.fail(function(result){
					var message = {
						'codigoincorrecto'		: i18n.kot('global:validacion.mensaje.codigo_incorrecto'),
						'usuarioinexistente'	: i18n.kot('global:validacion.mensaje.usuario_inexistente')
					}[result.error.message] || result.error.message;
					ventana.ajaxError(message);
				})
				.done(function(){
					ventana.ocultar();
					var parsedURL = $.hashbang.get();
					var callback = (parsedURL.query && parsedURL.query.callback) || '/';
					location.hash = '#!' + callback;
				});
		}
		
	},
        aceptarGDPR: function(event){
		
            if ($('#' + event.currentTarget.id).attr('data-ventana') == 'registro'){
                 var ventana = model.data.ventanas.registro;
            }else if ($('#' + event.currentTarget.id).attr('data-ventana') == 'registro-invitado'){
                 var ventana = model.data.ventanas.invitado;
            }else{
                 var ventana = model.data.ventanas.contacto;
            }
			
            if(document.getElementById(event.currentTarget.id)){
                if(event.currentTarget.checked){
					ventana.gdpr = true;
                }else{
					ventana.gdpr = false;
                }
            }    
        },
	nuevaDireccionModal: function(){
		var self = this
			, usuario = model.data.usuario
			, ventana = model.data.ventanas.nuevaDireccion
			, nuevaDireccion;

		usuario.nuevaDireccion();
		usuario.direcciones.seleccionado.id(0);
		nuevaDireccion = usuario.direcciones.seleccionado();
		ventana.direccion( nuevaDireccion );
		ventana.mostrar()
			.always(function(){
				ventana.direccion().showAllMessages(false);
				ventana.direccion(null);
			});
	},

	nuevaDireccionModalBeforeAccept: function( deferred ){
		var direccion = model.data.ventanas.nuevaDireccion.direccion();
		direccion.showAllMessages();
		if( direccion && direccion.isValid() ){
			controller.agregarDireccionCliente( direccion.toJS() ).done(function(){
				deferred.resolve('ok');
			});
		} else {
			deferred.reject();
		}
	},

	eliminarDireccionCliente: function( event ){
		event && event.preventDefault();
		var $element = $( event && event.target )
			, direccion = ko.dataFor( $element[0] );

		$.confirm( i18n.kot( 'front:mensajes.eliminar_esta_direccion' ) ).done( function(){
			controller.eliminarDireccionCliente( direccion.id() );
		});

	},
        
        checkPoliticasPrivacidad: function ( event ){
            var self = this;
            var context = ko.contextFor(event.target);
            if (context.$parent.ajaxError){
                 context.$parent.ajaxError(null);
            }
            $("#gdpr_error").fadeOut();
        },
        
	/*
	guardarDireccion: function(event){
		var self = this;
		event && event.preventDefault();
		var context = ko.contextFor(event.target);
		var direccion = model.data.usuario.direcciones.seleccionado().toJS();
		var idCliente = model.data.usuario.id();
		if(direccion && idCliente){
			return controller.agregarDireccionCliente( direccion ).done(function(){
				self.asignarDireccionACarrito();
			});
		
		}
	},
	*/

	guardarCliente: function(event){
		var cliente = model.data.usuario;
		event && event.preventDefault();
		var validar = model.data.camposPersonalizados.validarCampos();
		if (validar.validacion === false){
			$('*[data-requerido="true"]').each(function (index, value) { 
				if ($(this).val() == '' || $(this).val() == '-1' || $(this).val() == 'on'){
					model.data.camposPersonalizados.camposRequeridos($(this).attr('id'));
				}
			});
			return;
		}
		cliente.campos(validar.campos);
		cliente.errors.showAllMessages();
		cliente.ajaxError(null);
		if(cliente.isValid()){
			controller.guardarCliente( cliente )
				.done(function(){

				})
				.fail(function(response){
					var errorCode = $.getObjectProperty( response, 'error.code' )
						, trad = '';

					switch( errorCode ){
						case -6: // estado incorrecto
							trad = i18n.kot('app.cambiarcontrasena.la_contrasena_actual_es_incorrecta');
							cliente.ajaxError(trad);
							break;
					}

				});
		}
	},

	cambiarPassword: function(event){
		var ventana = model.data.ventanas.cambiarPassword
			, trad = i18n.kot('app.cambiarcontrasena.la_contrasena_se_cambio_exitosamente');
		event && event.preventDefault();

		ventana.mostrar()
			.done(function(){
				$.alert(trad);
			})
			.always(function(){
				ventana.reset();
			})
	},

	cambiarPasswordBeforeAccept: function( deferred ){
		var ventana = model.data.ventanas.cambiarPassword;

		ventana.errors.showAllMessages();

		if(ventana.isValid()){
			controller.cambiarPassword(ventana.passwordActual(), ventana.passwordNuevo(), ventana.enviarPassword())
				.done(function(){
					deferred.resolve('ok');
				})
				.fail(function(response){
					var message = {
							passwordincorrecto: i18n.kot('app.cambiarcontrasena.la_contrasena_actual_es_incorrecta')
						}[response.error.message] || response.error.message;

					ventana.ajaxError(message);
					deferred.reject();
				})
		} else {
			deferred.reject();
		}
	},

	obtenerCarritos: function(event){
		event && event.preventDefault();
		return controller.obtenerCarritos()
			.done(function(){

			});
	},

	duplicarCarrito: function( event ){
		event && event.preventDefault();
		var self = this
			, $element = $( event && event.target )
			, carrito = ko.dataFor( $element[0] )
			, options = {
				id  : carrito.id()
			};

		$.confirm('Repetir esta compra?')
			.done( function(){
				controller.duplicarCarrito( options )
					.done(function(){
						self.navegarAHashbang('/carrito/');
					})
					.fail( self._duplicarCarritoFail.bind(self, options) );
			});
	},

	_duplicarCarritoFail: function( options, response ){
		var self = this
			, errorCode = $.getObjectProperty( response, 'error.code' )
			, trad = '';

		switch( errorCode ){
			case -16: // stock insuficiente o producto inexistente
				trad = i18n.kot('app.mensajes.desea_repetir_compra');
				$.confirm(trad)
					.done(function(){
						options = $.extend({
							forzar  : true
						}, options);
						controller.duplicarCarrito( options )
							.done(function(){
								self.navegarAHashbang('/carrito/');
							})
					});
				break;
		}
	},

	reenviarCodigoActivacion: function(event){
		event && event.preventDefault();
		if(model.data.usuario.logueado()){
			controller.reenviarCodigoActivacion().done(function(){
				$.alert(i18n.kot('app.mensajes.te_hemos_enviado_tu_nuevo_codigo_de_activacion_a_tu_casilla_de_email'));
			});
		}
	},
	
	////////////////////////////////////////////////////////////////////////////

	obtenerCargaInicial: function( options ){
		var self = this
			, parametros = $.extend({}, options)
			, queryString = $.getAllQueryStrings();
	
		if( queryString.previsualizacion == 'true' ){
			$.extend(parametros, { previsualizacion: true, idTemplate: queryString.idTemplate} );
		}
		$.extend(parametros, { adminPreviewKey: queryString.adminPreviewKey  } );
		
		return controller.obtenerCargaInicial( parametros ).done(function(){
			console.timeEnd('cargainicial');
			if(model.data.market.activo()==false) $.alert(i18n.kot('global:mensajes.sitio_en_construccion'), {close: false});
			//self.obtenerCategorias();
			self.obtenerContadorDeVisitas();
			//guardo model.data.usuario para que comience a editar
			model.data.usuario.guardar();
			self.addScripts();
		});
	},

	/* add scripts */

	addScripts : function(){
		var self = this;
		self.addScript('recaptchav3', 'https://www.google.com/recaptcha/api.js?render=6Lcc3KkZAAAAAOwiFHV-W_fMTENEk94LNuFxyNfY');
		self.addCss('byoutube', 'byoutube.css');
	},

	addScript : function(id, url, options)
	{	
		if (options === undefined){
			var options = {
				async : false,
				defer : false
			}
		}
		if($('#' + id).length == 0) {
			$script = $('<script>');
			$script.attr( 'type', 'text/javascript' );
			$script.attr( 'src', url );					
			$script.attr( 'id', id );
			$('head')[0].appendChild( $script[0] );
		}
	},

	addCss(id, url, options)
	{
		var version = 'v_' + window.version;
		var rutabase = window.rutabase;
		var rutafinal = rutabase + '/css/' + version + '/' + url;
		if (options === undefined){
			var options = {
				async : false,
				defer : false,
			}
		}
		if (!document.getElementById(id))
		{
			var head  = document.getElementsByTagName('head')[0];
			var link  = document.createElement('link');
			link.id   = id;
			link.rel  = 'stylesheet';
			link.type = 'text/css';
			link.href = rutafinal;
			options.media === undefined ? link.media = 'all' : link.media = options.media;
			head.appendChild(link);
		}
	},

	/* end of add scripts */

	obtenerContadorDeVisitas: function(){
		return controller.obtenerContadorDeVisitas();
	},

	obtenerCategorias: function(event){
		event && event.preventDefault();
		var market = model.data.market;
		model.data.categorias.recordset.orden( market.productosOrden() );
		//model.data.categorias.recordset.pageSize( market.productosCantidadPorPagina() );
		model.data.categorias.recordset.productos().pageSize = market.productosCantidadPorPagina();
		
		return controller.obtenerCategorias();
	},
	
	////////////////////////////////////////////////////////////////////////////

	obtenerProductos: function(event){
		event && event.preventDefault();
		if(event && event.type=='submit'){
			model.data.productos.recordset.absolutePage(0);
		}
		controller.obtenerProductos();
	},

	buscarProductos: function(event){
		var self = this;
		event && event.preventDefault();
		var textoBusquedaProductos = $.trim(model.data.textoBusquedaProductos() || '');
		
		if(textoBusquedaProductos.length >= 3){
			var url = $.hashbang.get( { 'catalogo': 'filtrado' }, { 'filtro': textoBusquedaProductos } );
			url.navigate();
			self.FBSearch( textoBusquedaProductos );
		}
	},

	////////////////////////////////////////////////////////////////////////////
	_onOrdenComprasNoEsModificable: function( tipo ){
		var ventana =  model.data.ventanas.ordendecomprasOpciones;
		ventana.tipo( tipo || 'agregar' );
		
		return ventana.mostrar()
			.then( function(){
				return controller.ordenCompraModificar();
			}, function(){
				return controller.obtenerCarrito()
					.then( function(){
						$.hashbang.get('/orden-compra/confirmar/').navigate();
					})
			});
	},
	
	obtenerCarrito: function(event){
		var self = this;
		return controller.obtenerCarrito()
			.done( function( response ){
				if( model.data.carrito.cancelado() ){
					self._onOrdenCompraCancelada();
				}
			});
	},

	_agregarACarrito: function ( producto ){
		var self = this
			, id = producto.id()
			, primerValorUnidadesVenta = model.data.primerValorUnidadesVenta( producto )
			, cantidad = 1
			, verificarSiEsCarro
			, ventanaElegirOpcion = model.data.ventanas.productoElegirOpcion
                        , precio = producto.precio();
		if( !producto.unidadesVentaObtenerSeleccion() ){
			if( primerValorUnidadesVenta ) cantidad = primerValorUnidadesVenta
		} else {
			cantidad = producto.unidadesVentaObtenerSeleccion();
		}
		verificarSiEsCarro = $.Deferred().resolve('ok');
                var dataProducto = tiendasimple.helpers.Utils.getDataProducto(producto);
		return verificarSiEsCarro.then( function(){
			var result = $.Deferred();

			if( ventanaElegirOpcion.activa()){
				ventanaElegirOpcion.ocultar();
			}
			producto.agregandoACarrito(true);
			setTimeout( function(){ result.resolve() }, 1000);
			return result;
		}).then( function(){
			return controller.agregarACarrito( id, cantidad )
				.fail( self._onAgregarACarritoFail.bind( self, id, cantidad ) )
				.always( function(){
					producto.agregandoACarrito( false );
					if (model.data.obtenerStockProducto(producto) == 0){
						// se llev el ltimo! (no mostramos mensaje en rojo)
						$("#texto-stock-" + producto.id()).hide();
						$("#cantidad-stock-" + producto.id()).hide();
					}
					producto.unidadesVentaEstablecerSeleccion( primerValorUnidadesVenta );
				});
		}).then(function(){
			self.FBAddToCart(dataProducto);
		});
	},
	
	agregarACarrito: function(event){
		event && event.preventDefault();
		var self = this
			, context = ko.contextFor(event.target)
			, producto = context.$data
			, ventanaElegirOpcion = model.data.ventanas.productoElegirOpcion;

		if(model.data.productos.agregandoACarrito().length > 0) return;

		if( producto.tieneOpciones() && producto.tieneOpcionesHabilitadas() ){
			if( producto.opcionesCantidad() == 1 ){
				var next = $.Deferred().resolve();
				if( !producto.opcionesCargado() ){
					next = controller.obtenerProductoCompleto( producto );
				}
				next.then( function(){
					var primerOpcion = producto.opciones()[0];
					if(primerOpcion) {
						producto.opcionesSeleccionarPrimerOpcion();
						producto.agregandoACarrito( true );
						self._agregarACarrito( primerOpcion )
							.always( function(){
								producto.agregandoACarrito( false );
							});
					}
				});

			} else {
				ventanaElegirOpcion.producto( producto );
				if( !producto.opcionesCargado() ) {
					controller.obtenerProductoCompleto( producto )
						.then(function(){
							controller.productoSeleccionarOpcionDefault( producto );
						})
				}
				ventanaElegirOpcion.mostrar();
			}
		} else {
			return self._agregarACarrito( producto );
		}
	},
	
	quitarDeCarrito: function(event){
		event && event.preventDefault();
		var self = this
			, context = ko.contextFor(event.target)
			, item = context.$data;
			
		model.data.ventanas.eliminarItemsCarro.mostrar({
			done: function(){
				if( model.data.carrito.sePuedeModificarDetalle() ){
					return controller.quitarDeCarrito( item ).fail( self._onOrdenComprasNoEsModificable.bind( self, 'quitar' ) );
				} else {
					this._onOrdenComprasNoEsModificable('quitar');
				}			
			}
		});
	},	
	
	_onModificarCarritoFail: function( idProducto, nuevoValor, viejoValor, response ){
		var self = this
			, errorCode = $.getObjectProperty( response, 'error.code' )
			, trad = '';
			
		switch( errorCode ){
			case -16: // estado incorrecto
				trad = i18n.kot('app.mensajes.no_hay_stock');
				$.alert(trad, { accept: i18n.kot('global:btn.cerrar') })
					.done( function(){
						var itemCarrito = model.data.obtenerItemCarritoPorIdProducto(idProducto);
						if( itemCarrito ){
							itemCarrito.revertCantidad();
						}
					})
				break;
				
			case -18: // estado incorrecto
				trad = i18n.kot('app.mensajes.no_se_encuentra_producto');
				$.alert(trad, { accept: i18n.kot('global:btn.cerrar') }); //$.alert('mensaje', { accept o cancel: 'texto' })
				break;
				
			case -20: // estado incorrecto
				self._onOrdenComprasNoEsModificable('modificar')
					.then( function(){
						self.modificarCarrito( idProducto, nuevoValor, viejoValor );
					});
				break;
		}
	},
	
	modificarCarrito: function( idProducto, nuevoValor, viejoValor ){
		var	self = this
		, item = model.data.obtenerItemCarritoPorIdProducto( idProducto )
		, idItem = ko.unwrap( item.id )
		, primerValorUnidadesVenta = model.data.primerValorUnidadesVenta( item.producto )
		, nuevoValor = nuevoValor == 0 ? 0 : nuevoValor >= primerValorUnidadesVenta ? nuevoValor : primerValorUnidadesVenta;

		if( viejoValor != nuevoValor ) {
			controller.modificarCarrito( idItem, nuevoValor, viejoValor )
				.fail( self._onModificarCarritoFail.bind( self, idProducto, nuevoValor, viejoValor ) );
		} else {
			item.cantidad.nuevoValor( nuevoValor );
		}
	},
	
	/**
	 * cualquier error en el proceso de checkout
	 */
	_onCheckoutError: function( response ){
		var self = this;
		
		switch( response.error.code ){
			case -6: // carrito no existe
				$.alert($('<div><div class="modal-header"><h3>No hay un carrito sobre el que realizar la operacin.</h3></div><div class="modal-body">Te redirigiremos al catlogo para que puedas comenzar el proceso de compra nuevamente.</div></div>'))
					.done( function(){
						self.navegarAHashbang( model.data.obtenerPaginaCatalogo().getPageHashBang() );
					});
			break;
		}
	},

	/*
	asignarDireccionACarrito: function( event ){
		self = this;
		event && event.preventDefault();
		
		controller.asignarDireccionACarrito()
			.fail( self._onCheckoutError.bind( self ))
			.done(function( response ){
				self.navegarAHashbang( '#!/checkout/metodopago/' );
			});
	},
	*/
			
	asignarMetodoPagoACarrito: function( event ){
		var self = this;
		event && event.preventDefault();
		
		controller.asignarMetodoPagoACarrito()
			.fail( self._onCheckoutError.bind( self ))
			.done(function( response ){
				self.navegarAHashbang( '#!/checkout/resumen/' );
			});
		
	},
			
	iniciarMetodoPagoCarrito: function( event ){
		var self = this;
		event && event.preventDefault();

		model.data.carrito.abriendoGatewayDePago( true );
		
		switch( model.data.descripcionMetodoPagoSeleccionado() ){
			case 'dineromail':
			case 'paypal':
			case 'cuentadigital':
				return controller.iniciarMetodoPagoCarrito()
					.fail( self._onCheckoutError.bind( self ))
					.done(function( response ){			
						switch( model.data.descripcionMetodoPagoSeleccionado() ){
							case 'dineromail':
								$('.form-dineromail-checkout').submit();
							break;

							case 'paypal':
								$('.form-paypal-checkout').submit();
							break;

							case 'cuentadigital':
								$('.form-cuentadigital-checkout').submit();
							break;
						}
					});
			break;
			
			default: 
				return controller.checkoutCarrito().done(function( response ){
					$.bbq.pushState('#!/checkout/finalizar/');
				});
			break;
		}
		
	},
	
	establecerErrorMetodoPagoCarrito: function( event ){
		event && event.preventDefault();
		return controller.establecerErrorMetodoPagoCarrito();
	},
	
	checkoutCarrito: function(event){
		var self = this;
		event && event.preventDefault();
		
		return controller.checkoutCarrito().done(function( response ){
			$.bbq.pushState('#!/checkout/finalizar');
		});

	},
			
	////////////////////////////////////////////////////////////////////////////
	
	_onAgregarACarritoFail: function( id, cantidad, response ){
		var self = this
			, errorCode = $.getObjectProperty( response, 'error.code' )
			, data = $.toArray($.getObjectProperty( response, 'error.data' ))
			, trad = '';


		switch( errorCode ){
			case -18: // estado incorrecto
				trad = i18n.kot('app.mensaje.no_se_encuentra_producto');
				$.alert(trad);
				break;

			case -20: // orden de compras no es modificable
				self._onOrdenComprasNoEsModificable('agregar')
					.then( function(){
						if( id ){
							controller.agregarACarrito( id, cantidad );
						}
					});
			break;
			
			case -25:  // orden cancelada por admin
				return self._onOrdenCompraCancelada();
				break;

			case -31:
				$.alert('Por favor completa o cancela la orden de compras actual antes de agregar ms productos')
					.then( function(){
						self.navegarAHashbang('/carrito/');
					});
				break;
			
		}
	},
	
	_onOrdenCompraCancelada: function(){
		var self = this;
		return model.data.ventanas.ordenCompraCancelada.mostrar({
				beforeAccept: function( defer ){
					controller.ordenCompraModificar()
						.fail ( function( response ){
							controller.obtenerCarrito()
								.always( function(){
									defer.resolve();
								});
						})
						.done( function(){
							defer.resolve();
						});
				}
			})
				.then( function(){
					self.navegarAHashbang('/carrito/');					
				});
	},
	
	_onCarritoError: function( response ){
		var self = this
			, errorCode = $.getObjectProperty( response, 'error.code' )
			, idProducto = $.getObjectProperty( response, 'error.data.idProducto' )
			, stock = $.getObjectProperty( response, 'error.data.stock' )
			, itemCarrito; 
		
		switch( errorCode ){
			case -16: //stock insuficiente
				break;
				
			case -18: //producto inexistente
				return $.alert(i18n.kot('front:mensajes.tu_orden_de_compras_no_se_puede_completar'))
					.then( function(){
						return controller.ordenCompraCancelar();
					})
					.then( function(){
						self.navegarAHashbang('/catalogo/');								
					});
				break;
				
			case -23: // orden vencida				
			case -25: // orden cancelada
				return self._onOrdenCompraCancelada();
				break;
		}		

	},
	
	_onCarritoConfirmarError: function( response ){
		self = this;
		
		switch( response.error.code ){
			case -19: 
				controller.obtenerCarrito()
					.then( function(){
						self.navegarAHashbang('/orden-compra/confirmar/')
					});
			break;
			
			case -16: // stock insuficiente
			case -18: // producto inexistente
			case -21: // mixto				
				model.data.ventanas.errorConfirmarCarro.mostrar({
					done : function() {
						self.navegarAHashbang('/carrito/');
					}
				});
			break;

		}
		
	},
	
	carritoConfirmar: function( event ){
		var self = this;
		event && event.preventDefault();
		
		return controller.carritoConfirmar()
			.done( function( response ){
				self.navegarAHashbang('/orden-compra/confirmar/');
				self.FBInitiateCheckout();
			})
			.fail( self._onCarritoConfirmarError.bind( self ) );
	},
	
	ordenCompraCancelar: function( event ){
		var self = this;
		event && event.preventDefault();
		
		model.data.carrito.timeoutRestante.estimado.pausado(true);
		model.data.ventanas.eliminarOrdenCompra.mostrar({
			beforeAccept: function( deferred ){
				$.linkDeferreds(controller.ordenCompraCancelar(), deferred);				
			}
		})
		.done( function() {
			self.navegarAHashbang('/catalogo/');
		})
		.always( function(){
			model.data.carrito.timeoutRestante.estimado.pausado(false);
		});

	},
			
	ordenCompraModificar: function( event ){
		var self = this;
		event && event.preventDefault();

		model.data.carrito.timeoutRestante.estimado.pausado(true);
		model.data.ventanas.modificarItemsCarro.mostrar({
			beforeAccept: function( deferred ){
				controller.ordenCompraModificar()
					.done( deferred.resolve.bind( deferred ) )
					.fail ( function( response ){
						controller.obtenerCarrito()
						.always(function(){
							deferred.resolve();
						});
					});				
			}
		})
		.done( function() {
			self.navegarAHashbang('/catalogo/');								
		})
		.always( function(){
			model.data.carrito.timeoutRestante.estimado.pausado(false);
		});
		
	},

	_onOrdenCompraConfirmarFail: function( response ){
            
		var self = this;
		switch( response.error.code ){
			case -23:
				return self._onOrdenCompraCancelada();
				break;
			
			case -6:
			case -19:
				return $.alert(i18n.kot('front:mensajes.esta_orden_de_compras_ya_no_esta_disponible'))
					.then( function(){
						return controller.obtenerCarrito()
							.then( function(){
								self.navegarAHashbang('/carrito');							
							})
					});
				break;
                        case -33:
				return $.alert('Algunos de los descuentos aplicados en esta compra ya no estn disponibles.')
					.then( function(){
						return controller.obtenerCarrito()
							.then( function(){
								//model.data.carrito.cupon('');
							    if(model.data.carrito.cupon())
                                                            {
                                                                model.data.carrito.estadoCupon('agregar');
								 var options = {
									idMetodoPago : model.data.carrito.idMetodoPago(),
								};
								controller.ordenCompraAplicarCupon( options );
                                                            }
                                                                
							});
					});
                        break;
		}
	},
	
	ordenCompraPagar: function( event ){
		var self = this
			, direccionSeleccionada = model.data.usuario.direcciones.seleccionado()
			, carrito = model.data.carrito
			, usuario = model.data.usuario
			, deferred
			, url = $.hashbang.get();
		event && event.preventDefault();

		direccionSeleccionada && direccionSeleccionada.showAllMessages();
		carrito.showAllMessages();
		
		if( direccionSeleccionada.isValid() && carrito.isValid() ){
			if( !direccionSeleccionada.id() ){
				deferred = controller.agregarDireccionCliente();
			} else deferred = $.Deferred().resolve('ya tiene asignada direccin');
			
			deferred.then( function(){
				if( !usuario.habilitado() ){
					var aDondeNavegar = $.hashbang.get({'registro': 'validar-email'}).setQuery( {'callback' : url.toURL(true), 'fail': $.hashbang.get('orden-compra/confirmar').toURL(true) } ).toURL();
					return self.navegarAHashbang( aDondeNavegar );
				} else {
					return self.ordenCompraConfirmar( event );
				}
			});			
		}
		
		return self.navegarAHashbang( $.hashbang.get().removePathKey('accion').toURL() );
	},
	
	ordenCompraConfirmar: function( event ){
		var self = this
			, direccionSeleccionada = model.data.usuario.direcciones.seleccionado()
			, carrito = model.data.carrito
			, usuario = model.data.usuario
			, deferred
			, url = $.hashbang.get();
		event && event.preventDefault();

		self.FBPurchase();

		if( direccionSeleccionada.id() && carrito.isValid() && usuario.habilitado() ){
			model.data.puedeRedireccionarPortalDePagos( false );
			carrito.timeoutRestante.estimado.pausado(true); 
			return controller.ordenCompraConfirmar()
				.then( self.mostrarVigenciaRestante.bind( self ) )
				.done( self.ordenCompraIniciarMetodoPago.bind( self ) )
				.fail( self._onOrdenCompraConfirmarFail.bind( self ) )
				.fail( self._onCarritoError.bind( self ))
				.always( function(){ 
					carrito.timeoutRestante.estimado.pausado(false); 
				})			
		}
	},
	
	mostrarVigenciaRestante: function(){
		var market = model.data.market
			, carrito = model.data.ultimaOrdenCompra() || model.data.carrito
			, vigenciaRestante = new Chronometer.Lapse( carrito.vigenciaRestante() * 1000 ).toString();
			
		if( market.vigenciaOrdenActivado() ){

			return $.alert(i18n.kot('app.mensajes.completa_la_orden_de_compra_dentro_de', {
				tiempo  : vigenciaRestante
			}) , {
				accept: i18n.kot('global:btn.continuar')
			});

		} else return $.Deferred().resolve('ok');
	},

	ordenCompraReiniciar: function( event ){
		var self = this;
		event && event.preventDefault();
		
		return controller.ordenCompraReiniciar()
			.fail( self._onCarritoError.bind( self ) )
			.always( function(){
				self.navegarAHashbang('/orden-compra/confirmar/')	
			});
	},

	ordenCompraIniciarMetodoPago: function(){
		var self = this
			, carrito = model.data.carrito.id() ? model.data.carrito : model.data.ultimaOrdenCompra() || model.data.carrito
			, metodosPago = model.data.metodosPago()
			, hayCarrito = ko.unwrap( carrito.id )
			, metodoPago = model.data.obtenerMetodoPagoPorId( ko.unwrap( carrito.idMetodoPago ) );

		if( hayCarrito && metodoPago ){
			if( metodoPago.permitePagoOnline() ){
				model.data.puedeRedireccionarPortalDePagos( true );
				// no es necesario hacer nada, automticamente se postea el formulario al mtodo de pago
			} else {
				self.navegarAHashbang('/orden-compra/esperando-aprobacion/');
			}
		}
	},

	ordenCompraCotizarEnvio: function(){
		var self = this
			, metodosEnvio = model.data.metodosEnvio();

		if( !metodosEnvio.length ) controller.ordenCompraCotizarEnvio();
	},

	guardarDatosAdicionales: function( deferred ){
		var datosAdicionales = model.data.ventanas.datosAdicionales;

		datosAdicionales.errors.showAllMessages();

		if( datosAdicionales && datosAdicionales.isValid() ){
			var next = $.Deferred().resolve();
			next
				.then(function(){
					if( datosAdicionales.validarCliente() ){
						var cliente = model.data.usuario;
						cliente.update( datosAdicionales.getDatosCliente() );

						return controller.guardarCliente(cliente);
					}
				})
				.then(function(){
					if( datosAdicionales.validarDatosEnvio() ){
						var direccion = model.data.usuario.direcciones.seleccionado();
						direccion.update( datosAdicionales.getDatosDireccion() );

						return controller.modificarDireccionCliente()
							.done(function(){
								return controller.ordenCompraAsignarDireccionEnvio();
							});
					}
				})
				.then(function(){
					deferred.resolve(true);
				});

		} else {
			deferred.reject();
		}
	},


	ordenCompraSolicitarDatosAdicionales: function(){
		var self = this
			, usuario = model.data.usuario
			, direccion = model.data.usuario.direcciones.seleccionado()
			, ventanaDatosAdicionales = model.data.ventanas.datosAdicionales;

		return controller.ordenCompraRequiereDatosAdicionales()
			.fail( function( error ){
				$.alert( JSON.stringify( error ) );
			})
			.then( function( response ){
				if( response.validarCliente || response.validarDatosEnvio ){
					if( response.validarCliente ){
						ventanaDatosAdicionales.update({
							validarCliente  : true,
							nombre          : usuario.nombre(),
							apellido        : usuario.apellido(),
							telefono        : usuario.telefono()
						});
					}
					if( response.validarDatosEnvio ) {
						ventanaDatosAdicionales.update({
							validarDatosEnvio   : true,
							ciudad              : direccion.ciudad(),
							direccion           : direccion.direccion(),
							codigoPostal        : direccion.codigoPostal()
						});
					}
					return ventanaDatosAdicionales.mostrar();
				} else {
					return true;
				}
			});
	},

	/**
	 * pasa al siguiente estado dentro de una orden de compra. Entre indicar direccin, elegir mtodo de envo, mtodo de pago, y detalle
	 */
	ordenCompraSiguienteEstado: function(){
          
            
                
		var self = this
			, carrito = model.data.carrito
			, usuario = model.data.usuario
			, estadosDeCompra = carrito.estadosDeCompra()
			, estadoActual = carrito.estadoActualDeCompra()
			, indexActual = estadosDeCompra.indexOf(estadoActual)
			, estadoSiguiente = estadosDeCompra[ indexActual + 1 ]
			, direccionSeleccionada = usuario.direcciones.seleccionado()
                        
		if( estadoActual == 'confirmar' ){
			this.ordenCompraSolicitarDatosAdicionales().then( function(){
				$.hashbang.get( '/orden-compra/confirmar/accion/pagar' ).navigate();
			});
		} else {
			var next = $.Deferred();
			if( estadoActual == 'datos_de_envio' ){
				var agregarDireccionEnvio = $.Deferred();

				if( direccionSeleccionada && direccionSeleccionada.isValid() ) {
					if (!direccionSeleccionada.id()) {
						agregarDireccionEnvio = controller.agregarDireccionCliente();
					} else agregarDireccionEnvio = $.Deferred().resolve('ya tiene asignada direccin');

					next = agregarDireccionEnvio.then( function(){
						return controller.ordenCompraAsignarDireccionEnvio()
							.fail( function( response ){
								var message = $.getObjectProperty( response, 'error.message' ) || JSON.stringify( response );
								self.mostrarErrorAjax( message );
							})
					});

				} else {
					next.reject('Direccin de envo invlida');
				}

			} else {
				next.resolve();
			}

			next.then( function(){
				if( estadoSiguiente == 'metodo_de_envio' && !model.data.carritoRequiereMetodoEnvio( model.data.carrito ) ){
					estadoSiguiente = estadosDeCompra[ indexActual + 2 ];
				}
				model.data.carrito.estadoActualDeCompra( estadoSiguiente );
				self.FBAddPaymentInfo();
			});
                        
                        next.then( function(){
                                var options = {
									idMetodoPago : model.data.carrito.idMetodoPago(),
									codigoCupon  : model.data.carrito.cupon()
								};
                                if(estadoActual == 'metodo_de_pago') {
									var cupon = model.data.carrito.cupon();
									if (cupon != ""){
                                        //model.data.carrito.estadoCupon('agregado');
										controller.ordenCompraAplicarCupon( options );
									}else{
										controller.ordenCompraAplicarDescuentoAutomatico( options );
									}
								}
                                    
			});

		}
               
           
	},
        
        ordencompraAplicarDescuento:function(event)
        {
            var options = {idMetodoPago : model.data.carrito.idMetodoPago(),codigoCupon:model.data.carrito.cupon()};
            
            if(model.data.carrito.cupon()!="")
            {
                model.data.carrito.aplicandoCupon(true);
            
                controller.ordenCompraAplicarCupon(options);
            }
        },
        
        ordencompraEliminarDescuento:function(event)
        {
			event.preventDefault();
			model.data.carrito.eliminandoCupon(true);
			var options = {
				calcularAutomatico : true
			};
            controller.ordenCompraEliminarCupon(options);
        },
        
	////////////////////////////////////////////////////////////////////////////
	//// BLOG
	
	buscarEnBlog : function(event){
		event && event.preventDefault();
		var s = $('#input-buscar-blog').val();
		if (s == '') return;
		if (s.length < 3) return;
		model.data.blog.queryString(s);
		$.hashbang.get('/#!/blog/search/' + s + '/').navigate();
	},

	buscarEnBlogKeyBoard : function(event){
		if (event.keyCode == 13){
			var s = $('#input-buscar-blog').val();
			if (s == '') return;
			if (s.length < 3) return;
			model.data.blog.queryString(s);
			var url = '/#!/blog/search/' + s + '/';
			$.hashbang.get(url).navigate();
		}
	},

	irAblog : function(){
		event && event.preventDefault();
		$.hashbang.get('/#!/blog/').navigate();	
	},

	////////////////////////////////////////////////////////////////////////////
	
	enviarEmailContacto: function(event){
		event && event.preventDefault();
		var self = this,
			ventana = model.data.ventanas.contacto,
			nombre = ventana.nombre(),
			email = ventana.email(),
			mensaje = ventana.mensaje();

		ventana.errors.showAllMessages();

		if( ventana.isValid() ){
			
			if(document.getElementById('GDPR_check')){
				var checkGDPR = event.target[3].checked; // recuperamos el check de la ventana (por si existe otro elemento dpgr en la vista)
				if(!checkGDPR && event.target[3].id == 'GDPR_check'){
						ventana.ajaxError('Debe aceptar las politicas de privacidad.');
						return;
				}
			}
                        
                        ventana.ajaxError(null);
			ventana.enviando(true);
			controller.enviarEmailContacto(nombre, email, mensaje).done(function(response) {
				ventana.reset();
				$.hashbang.get({contacto: 'mensaje-enviado'}).navigate();
				self.FBLead();
			}).always(function() {
				ventana.enviando(false);
			});			
		}
	},
	
	////////////////////////////////////////////////////////////////////////////
	
	obtenerPaginas: function(event){
		event && event.preventDefault && event.preventDefault();
		controller.obtenerPaginas();		
	},

	
	////////////////////////////////////////////////////////////////////////////
	
	widgetFormularioEnviar: function( event ) {
		var self = this,
		$element = $( event && event.target ),
		widget = ko.dataFor( $element[0] ),
		$form = $element.closest( 'form' ),
		formData = $form.serializeObject(),
		urlPagina = document.location.href,
		tituloPagina = model.data.paginas.activa().traducciones()[0].titulo(),
		nombreFormulario = widget.data.titulo(),
		ventana = model.data.ventanas.registro,
		emails = widget.obtenerEmailsDestinatarios();

		event && event.preventDefault();

		$form.find("input[name='GDPR_check']").attr("id") !== undefined ? validarGDPR = true : validarGDPR = false;
	
		if(document.getElementById('GDPR_check') && validarGDPR){
			if(!document.getElementById('GDPR_check').checked){
				$("#gdpr_error").fadeIn();
				return;
			}else{
				$("#gdpr_error").fadeOut();
			}
		}
               
		ventana.ajaxError(null);
		widget.showAllMessages();
		if( widget.isValid() ){
			if ( model.data.obtenerPaginasActivas()[0].tipo() == 'catalogo' ){
				// es un formulario de consulta
				options = self.queryFormSettings( formData, widget );
				self.sendQueryForm( options );
			}else{
				// contact form || anyware form
				if ( widget.data.adjuntarArchivo() && model.data.market.dtEsDemo() == false && model.data.market.dtTieneFileUpload() == 1 ){
					// first send file
					self.sendFileUploadForm( widget )
						.then(function(res){
							// OK | all right 
							if (res.errCode == -1){
								var file = res.file;
								file = file.split('\\');
								file = file.pop();
								formData.ArchivoAdjunto = file;
								formData.LinkArchivoAdjunto = self.obtenerDominio() + 'admin/#!/configuracion/archivosadjuntos/'; 
								self.sendForm( widget, urlPagina, tituloPagina, formData, emails, nombreFormulario );
							}
						})
						.catch(function(e){
							// not file attached
							if (e.errCode == 0){
								self.sendForm( widget, urlPagina, tituloPagina, formData, emails, nombreFormulario );
							}
							// KO | upload error
							if (e.errCode == 1){
								self.sendForm( widget, urlPagina, tituloPagina, formData, emails, nombreFormulario );
								/*
								$.confirm('No se pudo adjunto el archivo, desea enviar el mensaje igualmente?', { preset: 'yesno' })
								.done(function(){
									self.sendForm( widget, urlPagina, tituloPagina, formData, emails, nombreFormulario );
								});
								*/
							}
						});
				}else{
					// send form now
					self.sendForm( widget, urlPagina, tituloPagina, formData, emails );
				}
			}
		}		
	},
	
	obtenerDominio : function(){
		var arrDominio = window.location.href.split("#!")[0];
		return arrDominio;
	},

	queryFormSettings : function( formData, widget ){
		var idVariante = model.data.idProductoActivo;
		var idProducto = model.data.idProducto;
		if (idProducto === null ) idProducto = idVariante;
		if (idVariante == idProducto) idVariante = null;
		var idUsuario;
		model.data.usuario.logueado() === true ? idUsuario = model.data.usuario.id() : 0; 
		var dataFormularioConsulta = formData;
		var options = {};
		options.idProducto = idProducto;
		options.idVariante = idVariante;
		options.idUsuario = idUsuario;
		options.idProducto = idProducto;
		options.idUsuario = idUsuario;
		options.data = dataFormularioConsulta;
		widget.data.emailDestino() != "" ? options.emailDestino = widget.data.emailDestino() : options.emailDestino = model.data.market.emailContacto();
		// obtenemos el email desde el DOM
		var email;
		$('.form').find('input[type=email]').each(function( index ){ email = $( this ).val(); });
		options.email = email;
		return options;
	},

	sendForm : function( widget, urlPagina, tituloPagina, formData, emails, nombreFormulario ){
		var self = this;
		controller.widgetFormularioEnviar( widget, urlPagina, tituloPagina, formData, emails )
				.done(function(){
					widget.showAllMessages( false );
					/*_gaq.push(['_trackEvent', 'Formulario', 'Enviado', nombreFormulario ]);*/
					ga('send', 'event', 'Formulario', 'Enviado', nombreFormulario);
					self.FBLead();
					// FB PIXEL 
					self.FBContact( formData );
					model.data.formsFileUploaded('');
				});
	},

	sendQueryForm : function( options ){
		controller.enviarFormularioBotonConsultar( options )
		.done(function(res){
			if (res.result.id){
				// FB PIXEL 
				// TODO CHECK IT //
				//self.FBContact( formData );
				$.alert('Su mensaje ha sido enviado.');
			}else{
				$.alert('Error enviando el mensaje.')
			}
			model.data.ventanas.formularioConsulta.activa( false );
			model.data.ventanas.productoElegirOpcion.activa( false );
		});
	},

	////////////////////////////////////////////////////////////////////////
	////// FILES UPLOAD
	/////////////////////////////////////////////////////////////////////////

	getTokenForUpload : function(){
		model.data.files.getTokenForUpload();
	},

	sendFileUploadForm : function( widget ){
		///////////////// FILE UPLOAD //////////////////////////////////////
		var id = $('form.form-files-upload-forms').attr("id");
		var file = $('form.form-files-upload-forms input[type=file]').val();
		var oResponse = {};
		return new Promise(function(resolve,reject){
			if (file == ''){
				oResponse.success = false;
				oResponse.errCode = 0;
				reject( oResponse );
				return;
			}
			var formData = new FormData(document.getElementById(id));
			formData.append('file', file);
			var endpoint = 'https://fileupload.pmtai.com/api/formsfileupload';
			var options = {};
			token = model.data.formsTokenUpload();
			$.ajax({
				url: endpoint + '?token=' + token + '&market=' + model.data.market.idMarket() + '&host=' + model.data.datosUsuario.host,
				type: "post",
				dataType: "html",
				data: formData,
				cache: false,
				contentType: false,
				processData: false,
				files: $(".form-files-upload #file"),
				headers : {
					crossDomain : true,
					type : 'POST'
				}
			})
				.done(function(res){
					widget.enviado();
					oResponse.success = true;
					oResponse.errCode = -1;
					oResponse.message = res;
					oResponse.file = file;
					resolve( oResponse );
					return;
				})
				.fail(function(e){
					console.log('e =>', e);
					widget.enviado();
					oResponse.success = false;
					oResponse.errCode = 1;
					oResponse.message = e;
					oResponse.file = file;
					reject( oResponse );
					return;
				});
		});
		///////////////// .FILE UPLOAD //////////////////////////////////////
	},
		

	////////////////////////////////////////////////////////////////////////////
	/*
	recargarCatalogo: function(){
		var self = this;
		self.obtenerCategorias();
		controller.productoSeleccionado(0);
	},
	*/
	
	borrarCacheCatalogo: function(){
		var self = this;
		self.__oldProductosComputedValue = null;
		controller.productoSeleccionado(0);
		model.data.productos.obtenerAlCambiar( true );
	},
	
	show404: function(){
		//todo: hacer la funcionalidad para que cutycapt pueda devolver un 404
		this.reemplazarHashbang('404', null, true);
	},

	geoObtenerPaises: function(){
		controller.geoObtenerPaises();
	},

	geoObtenerRegionesPorIsoPais: function( isoPais ){
		controller.geoObtenerRegionesPorIsoPais( isoPais );
	},

	_onShowFormularioConsulta : function( tituloFormulario ){
		// vaciamos el form
		$( ".popupFormularioConsulta input").each(function( index ) {
			$( this ).val('');
		});
		$("#formulario-consulta-title").html( $("h3.form-title").html() );
		$("h3.form-title").hide();
	},

	////////////////////////////////////////////////////////////////////////////

	/**
	 * ejemplos:
	 * view.frontBackProxy('model.data.obtenerPaginaPorPrettyLink', '["contacto"]')
	 * view.frontBackProxy('model.data.obtenerUrlLogin')
	 * view.frontBackProxy('model.data.actualizarStockProducto', '["3","4"]')
	 * @param {string} fnName
	 * @param {string} params // siempre debe ser un json que represente un array
	 * @returns {*}
	 */
	frontBackProxy: function( fnName, params ){
		/*
		 fnName = 'model.data.productos.recordset.orden'
		 params = '["pepe":"ASC"]'
		 */
		var arr = fnName.split('.')
			, fn = arr.pop()
			, instance = arr.join('.')
			, obj = null
			, result = null
			, params = $.toArray($.parseJSON(params));

		if(instance == '') obj = window;
		else obj = $.getObjectProperty.apply($, [window, instance]);

		result = obj[fn].apply(obj, params);
		return $.toJSON(result);
	},


	
	obtenerImagenesDePaginaActual: function(){
		var result = {}
			, urlActual = model.data.urlActual();

		$.each( $('img:first', '.page-body'), function(index, img){
			var src = $(img).attr("src");
			if( !$.string.startsWith(src, 'http') ) src = urlActual + src;
			result[index] = src;
		});

		return result;
	},

	imagenEsCompartibleEnFB: function( url ){
		var result = true;
		if( $.string.startsWith( url, '/img/' ) ){
			result = false;
		}
		if($.string.startsWith( url, 'https://www.afip.gob.ar/')){
			result = false;
		}

		return result;
	},

	obtenerUrlImagenParaFB: function( url ){
		if( !$.string.startsWith( url, 'http' )){
			url = model.data.urlActual() +  url;
		}
		return url;
	},

	obtenerDatosImagenParaFB: function( img ){
		var $img = $(img)
			, url = $.string.decodeHTML( $img.attr('data-original-src') || $img.attr('src') )
			, width = $img.width()
			, height = $img.height()
			, social = $img.attr('alt') == 'social';

		url = $.string.replace(url, '&amp;', '&');
		
		if( !this.imagenEsCompartibleEnFB( url ) ) return;

		var deparam = $.deparam( url );
		if( deparam.width && deparam.height ){
			width = deparam.width;
			height = deparam.height;
		}

		if(!$.string.startsWith( url, 'http' )){
			var base = model.data.urlActual();
			var base = document.location.href.split('?')[0];
			base = base.split('#')[0];
			if( !$.string.endsWith( base, '/') ){
				base += '/';
			}
			url = base + url;
		}

		return this.adaptarImagenParaFB({
			social	: social,
			url		: url,
			width	: width,
			height	: height
		});
	},

	obtenerDimensionesParaFB: function(){
		return {width: 200, height: 200};
	},

	adaptarImagenParaFB: function( imagen ){
		var minWidth = this.obtenerDimensionesParaFB().width;
		var minHeight = this.obtenerDimensionesParaFB().height;

		if( $.string.startsWith( imagen.url, model.data.urlActual() ) ){
			if( imagen.url.indexOf('obtenerimagen') != -1 ){
				var url = new $.URL( imagen.url );
				var search = url.deparamsearch();
				if( search.width && search.height && ( search.width < minWidth || search.height < minHeight ) ){
					var prop = search.width / search.height;
					if( search.width < search.height ){
						search.width = minWidth;
						search.height = search.width / prop;
					} else {
						search.height = minHeight;
						search.width = search.height * prop;
					}

					url.deparamsearch( search );
					imagen.url = url.toString();
					imagen.width = search.width;
					imagen.height = search.height;
				}
			}
		}
		imagen.width = Math.round( imagen.width );
		imagen.height = Math.round( imagen.height );

		return imagen;
	},

	obtenerImagenesParaRedesSociales: function(){
		
		//var chrono = new Chronometer();
		
		var self = this
			, imagenes = $('img', '.page-body')
			, result;

		var imagenesFondo = this.obtenerImagenesDeFondo();
		var imagenesFondoImg = $('');
		imagenesFondo.each(function(i, el){
			var bgImage = $(el).backgroundImage();
			var img = $('<img>').attr('src', bgImage );
			imagenesFondoImg = imagenesFondoImg.add( img );
		});

		imagenesFondoImg.appendTo('body');

		var imagenes = ko.utils.arrayMap( imagenes.add( imagenesFondoImg ), function( imagen ){
			return self.obtenerDatosImagenParaFB( imagen );
		});

		var dimensionesParaFB = this.obtenerDimensionesParaFB();
	
		result = ko.utils.arrayFilter( imagenes, function( imagen ){
			return imagen && imagen.width >= dimensionesParaFB.width && imagen.height >= dimensionesParaFB.height;
		} ).sort( function( a, b ){
			var aSize = Math.pow(a.width,2) + Math.pow(a.height,2)
				, bSize = Math.pow(b.width,2) + Math.pow(b.height,2);

			if(a.social > b.social ) return -1;
			if(a.social < b.social ) return 1;

			return aSize > bSize ? -1 : 1
		});

		if( result && result.length > 0 && result[0].social ) result = [result[0]];
          
		/*                
                if((result && result.length > 0) && (result[0].width > 800 || result[0].height>800))
                {
                    
                    var scaled;
                    
                    scaled = this.scaleImg(result[0].width,result[0].height);
                    
                    var imgParaWhatsapp = {social:true,url:result[0].url+"&width="+scaled.width+"&height="+scaled.height,width:scaled.width,height:scaled.height};
                    
                    result.unshift(imgParaWhatsapp);                    
                    result.push(imgParaWhatsapp);
                }
		*/
		imagenesFondoImg.remove();

		//console.debug('view.obtenerImagenesParaRedesSociales', chrono.elapsed());
	
		return result;
	},
        scaleImg:function(w,h){
            
            var scaled = {};
            
            if(w>h)
            {
                
                scaled.width = 800;
                scaled.height = Math.floor(h*(800/w));               
                
            } else
            {
                scaled.height = 800;
                scaled.width = Math.floor(w*(800/h));
            }            
            
            return scaled;
        },
        redimensionarImg:function(src,w,h){
            
        },
	obtenerImagenParaTwitter: function(){
		return this.obtenerImagenesParaRedesSociales()[0];
	},

	obtenerImagenesDeFondo: function(){
		return $('.site-body').find(':hasBgImageUrl');
	},

	////////////////////////////////////////

	getDataByElement : function ( element ){

		var context = ko.contextFor( element );
		
		var data = context.$data;
		var value = element.value;

		var info = {
			data : data,
			elementId : element.id,
			value : value,
			context : context
		};
	},

	////////////////////////////////////////
	socialShareTwitter: function( event ){
		event && event.preventDefault();
		var url = 'https://twitter.com/share?' + $.param( {url:location.href} );
		this.openShareWindow( url );
	},

	socialShareFacebook: function( event ){
		event && event.preventDefault();

/*
		var self = this
			, url = 'https://www.facebook.com/sharer/sharer.php?' + $.param({
				u: document.location.href
			});
		return self.openShareWindow( url ) ;
*/
		var self = this
			, url = 'https://www.facebook.com/sharer/sharer.php?' + $.param({
					s	: 100,
					u	: document.location.href/*,
					p	: {
						images	: $.pluckCollection(self.obtenerImagenesParaRedesSociales(), 'url'),
						url		: document.location.href,
						title	: ko.unwrap( model.data.tituloVentana ),
						summary	: ko.unwrap( model.data.descripcionVentana )
					}*/
				});
		//return location.href = url;
		self.openShareWindow( url );
	},

	socialShareGooglePlus: function( event ){
		event && event.preventDefault();
		var url = 'https://plus.google.com/share?' + $.param({url:location.href});
		this.openShareWindow( url );
	},

	socialSharePinterest: function( event ){
		event && event.preventDefault();
		var url = 'https://pinterest.com/pin/create/button/?' + $.param( {
				url  		: location.href,
				media		: ko.unwrap( model.data.imagenRepresentativa.absolute ),
				description	: ko.unwrap( model.data.tituloVentana )
			});
		this.openShareWindow( url );
	},        
        wappWindow:null,
	askMeOnWhatsapp: function( event ){
		event && event.preventDefault();
		this.wappWindow && this.wappWindow.close();

		var urlApi = ( detectMobile() ? 'https://api.whatsapp.com/' : 'https://web.whatsapp.com/') + 'send?';
		var phone  = 'phone='+model.data.market.configuracion.get('social_whatsapp');
		var text   = 'text=';
		
		if ( model.data.market.configuracion.get('whatsapp_texto_predeterminado') ) {
			text += encodeURIComponent(model.data.market.configuracion.get('whatsapp_texto_predeterminado') + "\r\n" );
		}
		if ( model.data.market.configuracion.get('whatsapp_compartir_url_producto') 
			&& model.data.paginaEnVisualizacionEsDetalleProducto() ) {
			text += encodeURIComponent(model.data.tituloVentana()+" " + location.href);
		}
		var url = urlApi + phone +'&'+ text;

		this.wappWindow = window.open( url, "_blank");
	},

	socialShareWhatsapp: function( event ){
		event && event.preventDefault();
		this.wappWindow && this.wappWindow.close();

		var urlApi = ( detectMobile() ? 'https://api.whatsapp.com/' : 'https://web.whatsapp.com/') + 'send?';
		var text   = 'text='+encodeURIComponent(model.data.tituloVentana()+" " + location.href);;
		var url = urlApi + text;

		this.wappWindow = window.open( url, "_blank");
	},

	socialShareLinkedIn: function( event ){
		event && event.preventDefault();
		var url = 'https://www.linkedin.com/shareArticle?' + $.param({
				mini	: true,
				url	: location.href,
				title: model.data.tituloVentana()
			});
		this.openShareWindow( url );
	},

	openShareWindow: function( url ){
		var width = 530
			, height = 250
			, top = 0
			, left = 0;

		top = screen.height / 2 - height / 2;
		left = screen.width / 2 - width / 2;

		var windowParams = $.param({width: width, height: height, left: left, top: top}).replace(/&/g,',');
		window.open( url, "", windowParams );
	},

	openQRWindow: function(){
		var params = {
			'chs'	: '500x500',
			'cht'	: 'qr',
			'chl'	: document.location.href
		}
		var url = 'https://chart.googleapis.com/chart?' + $.param( params );
		var $img = $('<img>').attr('src', url );
		$.alert( $img );

	},
	////////////////////////////////////////

	_configureSmoothScroll: function() {
		if(model.data.market.configuracion.get('visual_smoothscrollwheel_enable')){
			if(window.RDSmoothScroll){
				RDSmoothScroll.instance.initialize();
			}
		}
	},

	///////////////////////////////////////////////////////////
	// BOTON CONSULTAR

	enviarFormConsulta : function(event){
		event && event.preventDefault();
		var self = this;
		var context = ko.contextFor(event.target);
		var producto = context.$data;
		var ventanaElegirOpcion = model.data.ventanas.productoElegirOpcion;
		var precio = producto.precio();
		var redirect = false;
		var idProducto = producto.id();
		if (model.data.paginas.enVisualizacion().tipo() != 'catalogo'){ 
			$.hashbang.get({producto:idProducto}).navigate();
			return;
		}
		if (producto.opcionesCantidad && producto.opcionesCantidad() >= 1){
			// ->
			ventanaElegirOpcion.producto( producto );
			if( !producto.opcionesCargado() ) {
				controller.obtenerProductoCompleto( producto )
					.then(function(){
						controller.productoSeleccionarOpcionDefault( producto );
					})
			}
			ventanaElegirOpcion.mostrar();
			// <-
			return;
		}
		if (producto.idPadre !== undefined){
			// tiene variantes
			model.data.idProductoActivo = producto.id();
			model.data.idProducto = producto.idPadre();
		}else{
			// sin opciones
			model.data.idProductoActivo = producto.id();
			model.data.idProducto = null;
		}
		var ventanaFormulario = model.data.ventanas.formularioConsulta;
		ventanaFormulario.mostrar();
		// cargamos el email una vez renderizada la ventana (si el usuario est logueado )
		setTimeout(function(){
			$('.form').find('textarea').val('');
		}, 100 );
		return;
	},

	registrarInvitado: function(event){

		event && event.preventDefault();
		var self = this
			, context = ko.contextFor(event.target)
			, ventana = model.data.ventanas.invitado;
		
		var info = tiendasimple.helpers.Utils.getDataByElement('registro-invitado-form');
	
		/* gdpr check */

		var gdpr = model.data.market.configuracion.get('regional_politicaGDPR');

		if (gdpr === true){
			if (typeof info.context.$parent.ventanas.invitado.gdpr === 'boolean' && info.context.$parent.ventanas.invitado.gdpr === false){
				ventana.ajaxError('Debe aceptar las politicas de privacidad.');
				return;
			}
		
			if (typeof info.context.$parent.ventanas.invitado.gdpr === 'function'){
				if (info.context.$parent.ventanas.registro.gdpr() === null){
					ventana.ajaxError('Debe aceptar las politicas de privacidad.');
					return;
				}
			}
		}

		// /* ----- */

		if(ventana.isValid()){
			
			var datos = ventana.toJS();
			ventana.ajaxError(null);
			
			var validar = model.data.camposPersonalizados.validarCampos();
		
			if (validar.validacion === false){
				$('*[data-requerido="true"]').each(function (index, value) { 
					if ($(this).val() == '' || $(this).val() == '-1' || $(this).val() == 'on'){
						model.data.camposPersonalizados.camposRequeridos($(this).attr('id'));
					}
				});
				return;
			}

			grecaptcha.ready(function() {
				// do request for recaptcha token
				// response is promise with passed token
				grecaptcha.execute('6Lcc3KkZAAAAAOwiFHV-W_fMTENEk94LNuFxyNfY', {action: 'new_guest_user'})
				.then(function(token) {
					datos.recaptcha = token;
					controller.registrarInvitado(datos.nombre, datos.apellido, datos.email, datos.password, datos.recaptcha, validar.campos)
					.fail(function(result){
						ventana.ajaxError(result.error.message);
					})
					.done(function(){
						$.hashbang.get().setPath('registro-completo').navigate();
						self.FBCompleteRegistration();
						controller.comprobarEmailInvitado(datos.email, false)
						.done(function(result){
	
						});
					});	
				});
			});
		}
	},

	comprobarEmailInvitado: function(event){
		var self = this;
		var ventana = model.data.ventanas.invitado;

		var correo = document.getElementById(event.currentTarget.id).value;  
		var vError = document.getElementById("registroInvitadoEmailErrorMessage");
		if ( correo !== '' && vError.style.display === 'none' ) {			
			ventana.ajaxError(null);

			controller.comprobarEmailInvitado(correo)
			.fail(function(result){
				ventana.ajaxError(result.error.message);
			})
			.done(function(result){
				var response = result.result;
				//if registrado
				if ( response === 'registrado' || response === 'deshabilitado' ) {
					var mensaje = '<div><div class="modal-header"><h3>El mail ingresado se encuentra registrado.</h3></div><div class="modal-body">';
					if ( response === 'deshabilitado' ) {
						mensaje += '<div class="alert alert-info"><p>';
						mensaje += i18n.kot('ventana_registro_completo.revisa_la_bandeja_de_entrada',{ text: correo });
						mensaje += '</p></div>';
					}
					mensaje += 'Te redirigiremos a la pantalla de login para que ingreses con tu usuario y tu clave.</div></div>';

					setTimeout(function () {
						$.alert($(mensaje))
						.done( function(){
							ventana.activa(false);
							self.navegarAHashbang( 'login' );
						});
					}, 350);
				}
				//if invitado
				if ( response === 'invitado' ) {
					// Mostrar campos de contrasea en ventana actual
					ventana.recomendarRegistro(true);
				}
			});
		}
	},

	///////////////////////////////////////////////////////////
    // REDES SOCIALES LOGIN

        loginGmail : function(event){
			var self = this;
			event && event.preventDefault();
			var currenLocation = window.location.href;
			var environment = '';
			if (currenLocation.indexOf('qa.tiendadev.tk') !== -1){
					environment = 'prod';
			}else{
					environment = 'local';
			}
			var url = event.target.dataset.url;
			url = url.replace('dominio','builder.ferozo.com');
			//url = url.replace('dominio','mrossi.c0460474.ferozo.com');
			url = url.replace('alias',model.data.alias());
			url += '&alias=' + model.data.alias() + '&location=' + encodeURIComponent(window.location.href);
			//console.log(url);
			window.location = url; 
	},

	loginFacebook : function(event){
			var self = this;
			event && event.preventDefault();
			var currenLocation = window.location.href;
			var environment = '';
			if (currenLocation.indexOf('qa.tiendadev.tk') !== -1){
					environment = 'prod';
			}else{
					environment = 'local';
			}
			var url = event.target.dataset.url;
			url = url.replace('dominio','builder.ferozo.com');
			//url = url.replace('dominio','mrossi.c0460474.ferozo.com');
			//url = url.replace('alias',model.data.alias());
			url += '&alias=' + model.data.alias() + '&location=' + encodeURIComponent(window.location.href);
			window.location = url; 
			//console.log('window.location == ', url);
	},


});


$(function(){
	
	if(!$.getAllQueryStrings()._escaped_fragment_){
		// slo instanciar la vista si no se est recibiendo _escaped_fragment, dado que en este caso se devuelve un render para los buscadores
		view = new tiendasimple.back.View();
		view.start();
	}
});


/* /js/front/fronttienda_model_campos_personalizados.js
 * compresion time: 0.02599 -(ms)
 * ---------------------------------------------------- */
$.namespace('tiendasimple.front');

/**
 * CamposUsuarios
 */

tiendasimple.front.CamposUsuario = ko.ViewModel.extend({

    _mappeable: {
        html : '',
        maxLengthInput : 100,
        maxlengthTextarea : 256,
        tabindex : 8,
	},
	
	_defaults: {
    },
    
	_mapping: {   
	},
	
	init: function(data){	
		this._parent.apply(this,arguments);
		this.makeEditable(['campos']);
		this._createValidations();
        this._createComputed();
    },

    _obtenerCampos:function( data ){
        data = data || {};
        controller.obtenerCamposPersonalizados(data);
    },

    _obtenerCampoPorField:function( field, data ){
        data = data || {};
        controller.obtenerCamposPersonalizadosByField(field, data);
    },

    _createComputed : function(){
        this.campos = ko.observableArray();
        this.valores = ko.observableArray();
        this.html = ko.observable();
	},
	
	_createValidations: function(){
		this._parent();
    },
    
    _generateHTML: function(options){
        options = options || {};
        var self = this;
        var nCampos = self.campos().length;
        if (nCampos === 0) return;
        var html = '';
        var tabindex = this.tabindex();
        var maxLengthInput = this.maxLengthInput();
        var maxlengthTextarea = this.maxlengthTextarea();
        var nCampo = 1;
        var id = '';
        var arrValores = [];
        var seccion = '';
        var data = {};
        var cssClass = 'campos-personalizados';
        var evento = ' onkeyup="model.data.camposPersonalizados.habilitarBotonCamposPersonalizados(this.id)" ';
        var eventoSelect = ' onchange="model.data.camposPersonalizados.habilitarBotonCamposPersonalizados(this.id)" ';
        var eventoCheck = ' onclick="model.data.camposPersonalizados.habilitarBotonCamposPersonalizados(this.id)" ';
        var primeraOpcionSelect = 'Selecciona una opcin';
        var mensajeValidacionCheckbox = 'Debes marcar esta casilla para poder registrarte';
        var mensajeValidacionInput = 'Este campo es obligatorio';
        var mensajeValidacionSelect = 'Debe seleccionar una opcin';
        var anchoCompleto = options.anchoCompleto !== undefined && options.anchoCompleto == true ? true : false ;

        if (options.seccion != null || options.seccion !== undefined){
            seccion = options.seccion;
            if (model.data.datosusuario.nombre){
                data = model.data.datosusuario;
            }else{
                data = model.data.usuario;
                data.field1 = data.field1();
                data.field2 = data.field2();
                data.field3 = data.field3();
                data.field4 = data.field4();
                data.field5 = data.field5();
                data.field6 = data.field6();
                data.field7 = data.field7();
                data.field8 = data.field8();
            }
        }
        
        this.campos().forEach(function(campo) {

            if (data){
                switch(campo.field) {
                    case 'field1':
                        valor = data.field1 ? self._setFieldValue(data.field1) : ''; 
                    break;
                    case 'field2':
                        valor = data.field2 ? self._setFieldValue(data.field2) : ''; 
                    break;
                    case 'field3':
                        valor = data.field3 ? self._setFieldValue(data.field3) : ''; 
                    break;
                    case 'field4':
                        valor = data.field4 ? self._setFieldValue(data.field4) : ''; 
                    break;
                    case 'field5':
                        valor = data.field5 ? self._setFieldValue(data.field5) : ''; 
                    break;
                    case 'field6':
                        valor = data.field6 ? self._setFieldValue(data.field6) : ''; 
                    break;
                    case 'field7':
                        valor = data.field7 ? self._setFieldValue(data.field7) : ''; 
                    break;
                    case 'field8':
                        valor = data.field8 ? self._setFieldValue(data.field8) : ''; 
                    break;
                }
            }
         
            if (self._esPar(nCampo) === false){
                html += '<div class="row-fluid">';
            }

            if (seccion != 'usuario'){
                html += '<div class="';
                html += anchoCompleto ? 'span12' : 'span6';
                html += '">';
            }

            switch(campo.tipo) {
                case 'input' :
                    html += '<div class="control-group">';
                    html += '   <label>';
                    html += '   <span class="control-label">' + campo.nombre + self._getValidacion(campo) + '</span>';
                    html += '   <span class="controls">';
                    html += '   <input type="text" maxlength="' + maxLengthInput + '" tabindex="' + tabindex + '" id="cp-' + campo.id + '" name="' + campo.id + '"  title="' + campo.textoayuda + '" data-requerido="' + campo.requerido + '" value="' + valor + '"' + evento + '>';
                    html += '   </span>';   
                    html += '   </label>';
                    html += '   <span class="help-block mensaje-validacion-campos-personalizados hide" style="color:#b94a48;position:relative;top:-10px;" id="cp-'+campo.id+'-label">'+mensajeValidacionInput+'</span>';
                    html += '</div>';
                break;

                case 'textarea' :
                    html += '<div class="control-group">';
                    html += '   <label>';
                    html += '   <span class="control-label">' + campo.nombre + self._getValidacion(campo) +  '</span>';
                    html += '   <span class="controls">';
                    html += '       <textarea type="text" maxlength="' + maxlengthTextarea + '" tabindex="' + tabindex + '" id="cp-' + campo.id + '" name="' + campo.id + '" title="' + campo.textoayuda + '" data-requerido="' + campo.requerido + '"' + evento + '>' + valor + '</textarea>';
                    html += '   </span>';
                    html += '   </label>';
                    html += '  <span class="help-block mensaje-validacion-campos-personalizados hide" style="color:#b94a48;position:relative;top:-10px;" id="cp-'+campo.id+'-label">'+mensajeValidacionInput+'</span>';
                    html += '</div>';
                break;

                case 'checkbox' :
                    html += '<div class="control-group">';
                    html += '   <label>';
                    html += '   <span class="control-label checkbox-campos-personalizados" id="label-cp-' + campo.id + '">' + campo.nombre + self._getValidacion(campo) +  '</span>';
                    html += '   <span class="controls">';
                    if (valor == 'Si'){
                        html += '<input type="checkbox" tabindex="' + tabindex + '" id="cp-' + campo.id + '" name="' + campo.id + '" title="' + campo.textoayuda + '" data-requerido="' + campo.requerido + '"' + ' data-tipo-campo="' + campo.tipo + '" ' + valor + '" class="' + cssClass + '" checked' + eventoCheck + '></input>';
                    }else{
                        html += '<input type="checkbox" value="" tabindex="' + tabindex + '" id="cp-' + campo.id + '" name="' + campo.id + '" title="' + campo.textoayuda + '" data-requerido="' + campo.requerido + '"' + ' data-tipo-campo="' + campo.tipo + '" ' +  'class="' + cssClass + '"' + eventoCheck + '></input>';
                    }
                    html += '   </span>';
                    html += '   </label>';
                    html += '   <span class="help-block mensaje-validacion-campos-personalizados hide" style="color:#b94a48;position:relative;top:5px;" id="cp-'+campo.id+'-label">'+mensajeValidacionCheckbox+'</span>';
                    html += '</div>';
                break;
                
                case 'select' :
                    arrValores = campo.valores;
                    html += '<div class="control-group">';
                    html += '   <label>';
                    html += '   <span class="control-label">' + campo.nombre + self._getValidacion(campo) +  '</span>';
                    html += '   <span class="controls">';
                    html += '   <select tabindex="' + tabindex + '" id="cp-' + campo.id + '" name="' + campo.id + '" title="' + campo.textoayuda + '" data-requerido="' + campo.requerido + '"' + 'data-tipo-campo="' + campo.tipo + '"' + eventoSelect + "'>'";
                    html += ' <option value="">'+primeraOpcionSelect+'</option>' ;
                        arrValores.forEach(function(valorCombo)  {
                            if ( valor === valorCombo.text){
                                html += '<option tabindex="' + tabindex + '" value="' + valorCombo.text + '" SELECTED>' + valorCombo.text.charAt(0).toUpperCase() + valorCombo.text.slice(1) + '</option>';
                            }else{
                                html += '<option tabindex="' + tabindex + '" value="' + valorCombo.text + '" >' + valorCombo.text.charAt(0).toUpperCase() + valorCombo.text.slice(1) + '</option>';
                            }
                        });
                    html += '   </select>';
                    html += '   </span>';
                    html += '   </label>';
                    html += '   <span class="help-block mensaje-validacion-campos-personalizados hide" style="color:#b94a48;position:relative;top:-10px;" id="cp-'+campo.id+'-label">'+mensajeValidacionSelect+'</span>';
                    html += '</div>';
                break;
            }

            if (seccion != 'usuario'){
                html += '</div>';
            }

            if (self._esPar(nCampo) === true){
                html += '</div>';
            }
            tabindex++;
            nCampo++;
        });

        this.html(html);
    },

    habilitarBotonCamposPersonalizados: function(campoId){
        
        var id = 'nombre-panel-usuario';
        var elementExists = document.getElementById(id);
        var selector = "#" + campoId;

        if (elementExists){
            var info = tiendasimple.helpers.Utils.getDataByElement(id);
            info.data.nombre(info.data.nombre() + ' ');
        }

        /* Checkbox  */

        if ($(selector).attr('data-tipo-campo') === 'checkbox' && $(selector).attr('data-requerido') == 'true' && ($(selector).attr('value') == '' || $(selector).attr('value') == '1')){
            if ($(selector).is(':checked')) {
                $(selector).attr('value', '1');
                this._setStdField($(selector).attr('id'));
            }else{
                $(selector).attr('value', '');
                this._setRequiredField($(selector).attr('id'));
            }
        }

        /* Select  */

        if ($(selector).attr('data-tipo-campo') === 'select' && $(selector).attr('data-requerido') == 'true' && $(selector).attr('value') == ''){
            this._setRequiredField($(selector).attr('id'));
        }else{
            this._setStdField($(selector).attr('id'));
        }

        /* mapeamos los datos */
        model.data.ventanas.registro.mappearDatosCamposPersonalizados({
            field1 : $('#cp-1').val() || $('#cp-field1').val(), // data-value
            field2 : $('#cp-2').val() || $('#cp-field2').val(), 
            field3 : $('#cp-3').val() || $('#cp-field3').val(), 
            field4 : $('#cp-4').val() || $('#cp-field4').val(), 
            field5 : $('#cp-5').val() || $('#cp-field5').val(), 
            field6 : $('#cp-6').val() || $('#cp-field6').val(), 
            field7 : $('#cp-7').val() || $('#cp-field7').val(), 
            field8 : $('#cp-8').val() || $('#cp-field8').val(), 
        });
        /* end of mappeo */

        this.validarCamposRequeridosUI(campoId);
        
    },  

    validarCampos:function(){
        var validar = {
            validacion : true,
            campos : []
        }
        this.campos().forEach(function(campo) {
            var id = 'cp-' + campo.id;
            campo.valor = '';
            if (campo.requerido === 'true'){
               if (document.getElementById(id).value === '' || document.getElementById(id).value === 'null'){
                    validar.validacion = false;
               }
            }
            if (campo.tipo == 'checkbox'){
                campo.valor = $('#' + id + ':checked').val();
                if (campo.valor === undefined){
                    campo.valor = 'No';
                }else{
                    campo.valor = 'Si';
                }
            }else{
                campo.valor = document.getElementById(id).value;
            }
            validar.campos.push(campo);
        });

        validar.campos.forEach(function(campo)  {
            if (campo.tipo == 'select' && campo.valor == '-1' && campo.requerido == 'true') {
                validar.validacion = false;
            }
            if (campo.tipo == 'checkbox' && campo.valor == 'No' && campo.requerido == 'true') {
                validar.validacion = false;
            }
            if (campo.tipo == 'select' && campo.valor == '' && campo.requerido == 'false') {
                campo.valor = '';
            }
        });

        return validar;
    },
    
    _setFieldValue : function(value)  {
        return value === null ? '' : value;
    },
    
    _esPar : function(n)  {
        return n % 2 === 1 ? false : true;
    },

    _getValidacion : function(campo) {
        var textoayuda = campo.textoayuda;
        var requerido = campo.requerido;
        var html = '';
        if (textoayuda != ''){
            html = '  <span class="ayuda-tooltip">  <i class="fa fa-question-circle" data-title="'+textoayuda+'" title="'+textoayuda+'" ></i>  </span>';
        }
        return html;
    },

    _getToolTip : function(textoAyuda) {
        if ( textoAyuda === '' ) return ''; 
    },

    cargar : function (data, options){
        options = options || {};
        this.campos(data);
        this._generateHTML(options);
    },

    actualizarDatos : function() {
      controller.obtenerCamposPersonalizados();
    },

    obtenerCampos : function () {
        return this.campos();
    },

    _getTabIndex : function () {
        return this.tabindex;
    },

    booleanToStringSiNo : function ( value ){
        return value === 'true' || value === true ? 'SI' : 'NO'; 
    },

    retornarTipoDeCampo : function ( value ){
       switch( value ) {
            case 'input':
                return 'Texto Corto'
            break;
            case 'textarea':
                return 'Texto Largo'
            break;
            case 'select':
                return 'Lista Desplegable'
            break;
            case 'checkbox':
                return 'Casilla de Verificacin'
            break;
        } 
    },

    validarCamposRequeridosUI : function(campoId){
        if (!campoId || campoId === undefined){
            campoId = '';
        }
        if (campoId){ if ($('#' + campoId).attr("data-requerido") != 'true') return; }
        $('.mensaje-validacion-campos-personalizados').hide();
        var validar = model.data.camposPersonalizados.validarCampos();
		if (validar.validacion === false){
            if ($('#' + campoId).val() == '' || $('#' + campoId).val() == 'on'){
                model.data.camposPersonalizados.camposRequeridos(campoId);
            }
		}
    },

    camposRequeridos : function(id) {
        var campo = '#'+id;
        var labelId = 'label-' + id;
        switch($(campo).attr('data-tipo-campo')) {
            case 'checkbox':
                var chequeado = document.getElementById($(campo).attr('id')).checked;
                if (!chequeado){
                    $("#" + labelId ).css('color', '#b94a48');
                }else{
                    $("#" + labelId ).css('color', '#5f5f5f');
                }
            default:
            this._setRequiredField(id);
        }
        /*
        $('*[data-requerido="true"]').keyup(function() {
            if ($(campo).val() != ""){
                this._setStdField(id);
            }
        });
        /*
        $('*[data-requerido="true"]').change(() => {
            this._setStdField(id);
        });
        $('*[data-requerido="true"]').click(() => {
            this._setStdField(id);
        });
        */
    },  

    _setRequiredField : function(id){
        var campo = '#'+id;
        var label = campo + '-label';
        $(campo).css('border', '1px #b94a48 solid');
        $(campo).parent().parent().css('color', '#b94a48');
        $(label).show();
    },

    _setStdField : function(id){
        var campo = '#'+id;
        var label = campo + '-label';
        $(campo).css('border', '1px solid #ccc');
        $(campo).parent().parent().css('color', '#5f5f5f');
        $('.checkbox-campos-personalizados').css('color', '#5f5f5f');
        $(label).hide();
    },

});


/* /js/front/fronttienda_model_blog.js
 * compresion time: 0.02694 -(ms)
 * ----------------------------------- */
$.namespace('tiendasimple.front');

/**
 * Blog
 */

tiendasimple.front.Blog = ko.ViewModel.extend({

    _mappeable: {
        categorias : [],
        entradas : [],
        tags : [],
        tagsEntrada : [],
        entradasRelacionadas : [],
        entrada : {},
        error: false,
        queryString : '',
        seccionActiva : 'listado',
        cantidadEntradasPorPagina : 6,
        bof : true,
        eof : false,
        paginaActual : 0,
        paginas : [],
        urlBase : '#!/blog/',
        urlCategorias : 'cat', // -> /blog/cat/[slug]/[id]/pagina/[n]/
        urlBusqueda : 'search', //  -> /blog/search/[q]/pagina/[n]/
        urlTags : 'tags', //  -> /blog/tags/[slug]/[id]/
        urlAuthor : 'author', //  -> /blog/author/[id]/
        record : null,
        pagerSize : null,
	},
	
	_defaults: {
    },
    
	_mapping: {   
	},
	
	init : function(){	
    
		this._parent.apply(this,arguments);
		this.makeEditable([]);
		this._createValidations();
        this._createComputed();

        if (this.blogHabilitado){
            this.obtenerCategorias();
            this.obtenerTags();
        }

        this.seccionActiva.subscribe(function(value){
            if (value != 'listado-busqueda'){
                model.data.blog.queryString('');
            }
        }, this);
        
    },

    _createComputed : function(){
        this.entrada = ko.observableArray();
        this.entradas = ko.observableArray();
	},
	
	_createValidations: function(){
		this._parent();
    },
    
    estaEnBlog : function(){
        var uri = window.location.href;
        if (uri.indexOf('/#!/blog/') > -1){
            return true;
        }else{
            return false;
        }
    },

    blogHabilitado : function(){
		var bReturn = false;
		if (model.data.configuracionBlog.estado() == 1 ) bReturn = true;
		return bReturn;
    },
    
    getImagenPortada : function()
    {
        var imagenCabecera = model.data.configuracionBlog.imagenCabecera();
        var url;
        
        if (imagenCabecera == '' || imagenCabecera == 0 || imagenCabecera == null)
        {
            url = '/images/blank.gif';
        }
        else
        {
            url = 'galeriaimagenes/obtenerimagen/?id=' + imagenCabecera;
        }
        
        return model.data.staticResourcesGetCookielessDomainImageURL(url);
    },

    mostrarImagenEntrada : function (imagen, w, h, cropType){
        var sImage = '';      
        if (cropType == ''){
            cropType = 'crop';
        }
        if (imagen == '' || imagen == 0 || imagen == null){
            sImage = '/images/blank.gif';
        }else{
            if( w > 0 && h > 0){
                sImage = 'galeriaimagenes/obtenerimagen/?id=' + imagen + '&useDensity=false&width=' + w + '&height=' + h + '&tipoEscala=' + cropType;
            }else{
                // default
                sImage = 'galeriaimagenes/obtenerimagen/?id=' + imagen + '&useDensity=false&width=640&height=360&tipoEscala=crop';
            }
        }
        return model.data.staticResourcesGetCookielessDomainImageURL(sImage);
    },

    setDateInEnglish : function(strFecha, arrFechaOriginal){
        var months = {
            enero: 'January',
            febrero: 'February',
            marzo: 'March',
            abril: 'April',
            mayo: 'May',
            junio: 'June',
            julio: 'July',
            agosto: 'August',
            septiembre: 'September',
            octubre: 'October',
            noviembre: 'November',
            diciembre: 'December'
        };

        arrFecha = strFecha.split('-');            
        var sufijos = ["st", "nd", "rd", "th"];
        var sufijo = sufijos[3];
        var dia = parseInt(arrFechaOriginal[2], 10);
        
        if (dia < 4) {
            sufijo = sufijos[dia - 1];
        }

        var mesNombre = arrFecha[1]
        var date = months[`${mesNombre}`] + ' ' + arrFechaOriginal[2] + sufijo + ' ' + arrFechaOriginal[0];
        return date

    },

    setDateInSpanish : function(strFecha, arrFechaOriginal, strGlue){
        arrFecha = strFecha.split('-');
         var date = arrFechaOriginal[2] + strGlue + arrFecha[1] + strGlue + arrFechaOriginal[0];
         return date 
    },
    
    
    parsearFecha: function (fecha) {
        
        if (fecha === undefined) {
            return '';
        }                     
        var strFecha = '';
        var strGlue = ' de ';
        var arrFechaOriginal;
        
        fecha = fecha.split(' ')[0];
        arrFechaOriginal = fecha.split('-');
        
        strFecha = moment(fecha).locale(model.data.market.isoIdioma()).format("YYYY-MMMM-dddd");


        
        var idioma = model.data.market.localizacion.locale();
        
        switch (idioma) {
            case 'es_AR':
                strFecha = this.setDateInSpanish(strFecha, arrFechaOriginal, strGlue)
            break;

            case 'en_US':
                strFecha = this.setDateInEnglish(strFecha, arrFechaOriginal)
            break;

            default:
                strFecha =  this.setDateInSpanish(strFecha, arrFechaOriginal, strGlue)
            break;
        }        
        
        return strFecha;
    },
    redireccionarHome : function(){
        $.hashbang.get('/#!/').navigate();
    },
    
    redireccionarBlog : function(){
        $.hashbang.get('/#!/blog/').navigate();
    },

    buscar : function( s ){
        $.hashbang.get('/#!/blog/search/' + s + '/').navigate();
    },

    obtenerCategoriaActual : function(){
        var self = this;
        var idCategoria = window.location.href.split('/');
        var objCategoria = {};
        idCategoria = idCategoria[idCategoria.indexOf(self.urlCategorias())+2];
        model.data.blog.categorias.forEach(function(cat){
            if (cat['id'] == idCategoria){
                objCategoria.nombre = cat['nombre'];
                objCategoria.id = cat['id'];
                objCategoria.slug = cat['slug'];
                objCategoria.entradas = cat['entradas'];
            }
        });
        return objCategoria;
    },

    obtenerTituloCategoriaActual : function(){
        var self = this;
        var categoria = self.obtenerCategoriaActual();
        return categoria.nombre;
    },

    obtenerCategorias : function(){
        var self = this;
        var arrCategorias = [];
        var options = self.obtenerOpcionesDefault();
        options.origen = 1;
        controller.obtenerCategoriasBlog( options )
                .then(function( response ){
                    self.chequearUrl( response );
                    if (response.result.recordset){
                        response.result.recordset.forEach(function(categoria){
                            var cat = [];
                            cat['id'] = categoria.id;
                            cat['entradas'] = categoria.entradas;
                            cat['nombre'] = categoria.traducciones[0].nombre;
                            cat['slug'] = categoria.traducciones[0].slug;
                            arrCategorias.push( cat );
                        });
                        self.categorias = arrCategorias;
                    }
                }).catch(function(err){
                    console.log('err =>', err);
                    //self.redireccionarHome();
                });
    },

    obtenerEntradas : function ( options ){
        var self = this;
        var arrEntradas = [];
        var options = options || {};
        var arrUrl = window.location.href.split('/');
        $.extend(options, self.obtenerOpcionesDefault());
        /* si es una entrada le enviamos el slug y el id */
        if (window.location.href.indexOf('/p/') > -1){
            var indexBlog = arrUrl.indexOf('blog');
            var slug = arrUrl[indexBlog+1];
            options.slug = slug;
            options.seccion = 'entrada';
        }
        /* si es una entrada con tags le enviamos el slug y el id */
        if (options.idTag !== undefined){
            var indexBlog = arrUrl.indexOf('tags');
            var slug = arrUrl[indexBlog+1];
            options.slug = slug;
            options.seccion = 'tags';
            options.path = 'tags';
        }
        /* -> */
        
        model.data.pagerSize();
        
        controller.obtenerEntradasBlog(options)
                .then(function( response ){
                    self.chequearUrl(response);
                    if (response.result.recordset && options.absolutePage == response.result.absolutePage){
                        response.result.recordset.forEach(function(entrada){
                            var entradaBlog = [];
                            if (entrada.titulo !== null){
                                entradaBlog['id'] = entrada.id;
                                entradaBlog['titulo'] = entrada.traducciones[0].titulo;
                                entradaBlog['descripcion'] = entrada.traducciones[0].descripcion;
                                entradaBlog['contenido'] = entrada.traducciones[0].contenido;
                                entradaBlog['fechapublicacion'] = entrada.fechapublicacion;
                                entradaBlog['fechaedicion'] = entrada.fechaedicion;
                                entradaBlog['slug'] = entrada.traducciones[0].slug;
                                // nombre cat, slug cat, idautor, nombreautor
                                entradaBlog['categoria'] = entrada.nombrecategoria; 
                                entradaBlog['slugcategoria'] = entrada.slugcategoria;
                                entradaBlog['idcategoria'] = entrada.idcategoria;
                                entradaBlog['idautor'] = entrada.idautor;
                                entradaBlog['nombreautor'] = entrada.nombreautor;
                                entradaBlog['imagen'] = entrada.imagen_portada;
                                entradaBlog['comentarios'] = entrada.comentarios;
                                arrEntradas.push( entradaBlog );
                            }
                        });

                        if (options.id){
                            // una entrada
                            var arrEntrada = [];
                            arrEntrada['titulo'] = arrEntradas[0].titulo;
                            arrEntrada['descripcion'] = arrEntradas[0].descripcion;
                            arrEntrada['contenido'] = arrEntradas[0].contenido;
                            arrEntrada['imagen'] = arrEntradas[0].imagen;
                            arrEntrada['categoria'] = arrEntradas[0].categoria;
                            arrEntrada['slugcategoria'] = arrEntradas[0].slugcategoria;
                            arrEntrada['idcategoria'] = arrEntradas[0].idcategoria;
                            arrEntrada['idautor'] = arrEntradas[0].idautor;
                            arrEntrada['nombreautor'] = arrEntradas[0].nombreautor;
                            arrEntrada['fechapublicacion'] = arrEntradas[0].fechapublicacion;
                            arrEntrada['fechaedicion'] = arrEntradas[0].fechaedicion;
                            arrEntrada['comentarios'] = arrEntradas[0].comentarios;
                            self.entrada(arrEntrada);
                        }else{
                            // varias filtradas
                            self.entradas(arrEntradas);
                        }
                    }
                    else
                    {
                        self.entradas([]);
                    }
                }).catch(function(err){
                    console.log('err =>', err);
                    //self.redireccionarHome();
                });
    },

    obtenerEntradaBlog : function ( entrada ){
        var self = this;
        var arrEntradas = [];
        if (entrada === null){
            entrada = 0;
        }
        var options = {};
        $.extend(options, self.obtenerOpcionesDefault());
        options.id = entrada;
        controller.obtenerEntradaBlog(options)
                .then(function( response ){
                    if (response.result.recordset){
                        response.result.recordset.forEach(function(entrada){
                            var arrEntrada = [];
                            arrEntrada['titulo'] = entrada.traducciones[0].titulo;
                            arrEntrada['contenido'] = entrada.traducciones[0].contenido;
                            arrEntrada['imagen'] = entrada.imagen_portada;
                            self.entrada(arrEntrada);
                        });
                    }
                }).catch(function(err){
                    console.log('err =>', err);
                    //self.redireccionarHome();
                });
    },

    buscarEnBlog : function( s ){
        var self = this;
        var arrEntradas = [];
        var options = {};
        $.extend(options, self.obtenerOpcionesDefault());
        options.cadena = decodeURIComponent(s); // seria cadena para buscar
        options.idIdioma = 1;
        controller.obtenerEntradasBlog(options)
                .then(function( response ){
                    if (response.result.recordset){
                        response.result.recordset.forEach(function(entrada){
                            var arrEntrada = [];
                                arrEntrada['id'] = entrada.id;
                                arrEntrada['titulo'] = entrada.traducciones[0].titulo;
                                arrEntrada['descripcion'] = entrada.traducciones[0].descripcion;
                                arrEntrada['contenido'] = entrada.traducciones[0].contenido;
                                arrEntrada['fechapublicacion'] = entrada.fechapublicacion;
                                arrEntrada['fechaedicion'] = entrada.fechaedicion;
                                arrEntrada['slug'] = entrada.traducciones[0].slug;
                                arrEntrada['imagen'] = entrada.imagen_portada;
                                arrEntradas.push(arrEntrada);
                        });
                    }
                    model.data.blog.entradas(arrEntradas);
                }).catch(function(err){
                    console.log('err =>', err);
                    //self.redireccionarHome();
                });
    },

    entradasPorCategoria : function( categoria ){
        var self = this;
        var arrUrl = window.location.href.split('/');
        var options = {};
        /* si es una entrada le enviamos el slug y el id */
        if (arrUrl.indexOf(self.urlCategorias()) > -1){
            var indexBlog = arrUrl.indexOf(self.urlCategorias());
            var slug = arrUrl[indexBlog+1];
            options.slug = slug;
            options.seccion = 'categoria';
            options.path = self.urlCategorias();
        }
        /* --> */
        var self = this;
        var arrEntradas = [];
        $.extend(options, self.obtenerOpcionesDefault());
        options.categoria = categoria; 
        options.idIdioma = 1;
        controller.obtenerEntradasBlog(options)
                .then(function( response ){
                    if (response.result.recordset){
                        response.result.recordset.forEach(function(entrada){
                            var arrEntrada = [];
                            if (entrada.idcategoria == categoria){
                                arrEntrada['id'] = entrada.id;
                                arrEntrada['titulo'] = entrada.traducciones[0].titulo;
                                arrEntrada['descripcion'] = entrada.traducciones[0].descripcion;
                                arrEntrada['contenido'] = entrada.traducciones[0].contenido;
                                arrEntrada['fechapublicacion'] = entrada.fechapublicacion;
                                arrEntrada['fechaedicion'] = entrada.fechaedicion;
                                arrEntrada['slug'] = entrada.traducciones[0].slug;
                                arrEntrada['imagen'] = entrada.imagen_portada;
                                arrEntradas.push(arrEntrada);
                            }
                        });
                    }
                    model.data.blog.entradas(arrEntradas);
                }).catch(function(err){
                    model.data.blog.entradas([]);
                    console.log('err =>', err);
                    //self.redireccionarHome();
                });
    },
    
    obtenerTags : function ( options ){
        var self = this;
        var arrTags = [];
        var arrTag = [];
        var options = options || {};
        $.extend(options, self.obtenerOpcionesDefault());
        controller.obtenerTagsBlog(options)
                .then(function( response ){
                    self.chequearUrl( response );
                    response.result.forEach(function(tag){
                        arrTag = [];
                        arrTag['id'] = tag.id_tag;
                        arrTag['entrada'] = tag.cantidad;
                        arrTag['nombre'] = tag.nombre;
                        arrTag['slug'] = tiendasimple.helpers.Enlace.toSeoUrl(tag.nombre);
                        arrTags.push( arrTag );
                    });

                    if (options.tagsPorCategoria === undefined){
                        self.tags(arrTags);
                    }else{
                        self.tagsEntrada(arrTags);
                    }
                    
                }).catch(function(err){
                    console.log('err =>', err);
                    //self.redireccionarHome(); 
                });
    },

    obtenerFechaEntrada : function(){
        var self = this;
        setTimeout(function(){
            var fechaPublicacion = self.entrada().fechapublicacion;
            var fecha = self.parsearFecha(self.entrada().fechapublicacion);
            if (document.getElementById('fecha-publicacion-entrada')){
                document.getElementById('fecha-publicacion-entrada').innerHTML = fecha;
            }
        }, 200);
    },

    obtenerEntradasRelacionadas : function( options ){
        var self = this;
        var arrEntradas = [];
        var arrEntrada = [];
        var options = options || {};
        $.extend(options, self.obtenerOpcionesDefault());
        controller.obtenerEntradasRelacionadas( options )
                .then(function( response ){
                    if (response.result != null){
                        response.result.data.forEach(function(entrada){
                            arrEntrada = [];
                            arrEntrada['id'] = entrada.id;
                            arrEntrada['titulo'] = entrada.traducciones[0].titulo;
                            arrEntrada['descripcion'] = entrada.traducciones[0].descripcion;
                            arrEntrada['slug'] = entrada.traducciones[0].slug;
                            arrEntrada['slugCategoria'] = entrada.slugcategoria;
                            arrEntrada['idCategoria'] = entrada.idcategoria;
                            arrEntrada['tituloCategoria'] = entrada.nombrecategoria;
                            arrEntrada['imagen'] = entrada.imagen_portada;
                            arrEntradas.push(arrEntrada);
                        });
                    }
                self.entradasRelacionadas( arrEntradas );
                }).catch(function(err){
                    console.log('err =>', err);
                    //self.redireccionarHome(); 
                });
    },

    obtenerPagina : function(){
        var self = this;
        var url = window.location.href;
        var strGlue = 'page';
        var arrUrl = url.split('/');
        var paginaActual = 0;
        if (arrUrl.indexOf(strGlue) > -1){
            paginaActual = arrUrl[(arrUrl.indexOf(strGlue) + 1)];
        }
        return paginaActual;
    },

    updateRecordset : function(recordset){
        if(!recordset)return;
        var self = this;
        var paginaActual = recordset.absolutePage;
        var arrPaginas = [];
        var pagerSize = model.data.pagerSize();
        var desde;
        var hasta;
        
        self.paginaActual(paginaActual);
        
        desde = paginaActual - Math.floor(pagerSize/2) + (pagerSize+1)%2;
        
        if(desde < 0)
        {
            desde = 0;
            hasta = Math.min(pagerSize,recordset.pageCount);
        }
        else
        {
            hasta = paginaActual + Math.floor(pagerSize/2) + 1;
            
            if(hasta > recordset.pageCount)
            {
                desde = Math.max(recordset.pageCount - pagerSize,0);
                hasta = recordset.pageCount;
            }
        }
        
        for (var i = desde; i < hasta; i++)
        {
            arrPaginas.push({ pagina : i});
        }
        
        self.paginas(arrPaginas);
        
        if (paginaActual == 0){
            self.bof( true );
            self.eof( false );
            return;
        } 
        if (paginaActual == (recordset.pageCount-1)){
            self.bof( false );
            self.eof( true );
            return;
        }
        
        self.bof( false );
        self.eof( false );
    },

    obtenerOpcionesDefault : function(){
        var self = this;
        var options = {};
        var arrUrl = window.location.href.split('/');
        options.pageSize = self.cantidadEntradasPorPagina();
        options.absolutePage = self.obtenerPagina();
        options.idIdioma = 1;
        options.origen = 1;
        options.url = window.location.href;
        if (arrUrl.indexOf('author') > -1 && !isNaN(arrUrl[arrUrl.indexOf('author')+1])){
            options.idAutor = arrUrl[arrUrl.indexOf('author')+1];
        }
        return options;
    },

    chequearUrl : function( response ){
        if (response.result.success !== undefined && response.result.redirect !== undefined){
            if (!response.result.success && response.result.redirect){
                document.location.replace(response.result.url);
                return false;
            }
        }
    },

    getRoute : function( accion, pagina ){
        var self = this;
        var url = self.urlBase();
        var arrUrl = window.location.href.split('/');
        var nPages = self.paginas().length;
        var paginaActual = self.obtenerPagina();
        var seccionActual = model.data.blog.seccionActiva();
        var slug = '';
        var id = '';
        var pagina = pagina || 0;
        // seccionActual -> | listado | entrada | entradas-por-categoria | listado-busqueda
        ///////////////////////////////////////////////////////////////////////////////////
        switch (seccionActual) {
            case 'listado':
                if (window.location.href.indexOf('/author/') > -1){
                    id = arrUrl[arrUrl.indexOf('author')+1];
                    url += 'author/' + id + '/'; 
                }
            break;
            case 'entradas-por-categoria':
                url += self.urlCategorias() + '/';
                if (arrUrl.indexOf(model.data.blog.urlCategorias() > -1)){
                    slug = arrUrl[arrUrl.indexOf(model.data.blog.urlCategorias()) + 1];
                    id = arrUrl[arrUrl.indexOf(model.data.blog.urlCategorias()) + 2];
                    url += slug + '/' + id + '/'; 
                } 
            break;
            case 'listado-busqueda':
                url += self.urlBusqueda() + '/';
                if (arrUrl.indexOf(model.data.blog.urlBusqueda() > -1)){
                    slug = arrUrl[arrUrl.indexOf(model.data.blog.urlBusqueda()) + 1];
                    url += slug + '/'; 
                } 
            break;
            case 'entradas-por-tags':
                url += self.urlTags() + '/';
                if (arrUrl.indexOf(model.data.blog.urlTags() > -1)){
                    id = arrUrl[arrUrl.indexOf(model.data.blog.urlTags()) + 2];
                    slug = arrUrl[arrUrl.indexOf(model.data.blog.urlTags()) + 1];
                    url += slug + '/' + id + '/';  
                } 
            break;
            default:
        }
        // accion -> inicio | atras | pagina | siguientePagina | final
        ///////////////////////////////////////////////////////////////////////////////////
        switch (accion) {
            case 'inicio':
            break;
            case 'atras':                
                url += 'page/' + (model.data.blog.record().absolutePage-1) + '/';                 
            break;
            case 'pagina' :
                url += 'page/' + (pagina) + '/'; 
            break;
            case 'siguientePagina' :                
                url += 'page/' + (model.data.blog.record().absolutePage+1) + '/';                 
            break;
            case 'final' :
                url += 'page/' + (model.data.blog.record().pageCount-1) + '/'; 
            break;
            default:
        }
        return url;
    },
    
});


/* /js/front/fronttienda_model_snippets.js
 * compresion time: 0.02289 -(ms)
 * --------------------------------------- */
$.namespace('tiendasimple.front');

/**
 * Snippet
 */

tiendasimple.front.Snippets = ko.ViewModel.extend({

    _mappeable: {
	},
	
	_defaults: {
    },
    
	_mapping: {   
	},
	
	init : function(){	
		this._parent.apply(this,arguments);
		this.makeEditable([]);
		this._createValidations();
        this._createComputed();
    },

	_createValidations: function(){
		this._parent();
    },
    
    _createComputed: function(){
        
    },

    /////////////////////////////////////////////////////////////////////
    /// GOOGLE REVIEWS

    getGoogleReviews : function( placeId, rating ){
        controller.chequearMarketIdPlace( placeId, rating )
                .then(function( response ){
                    if ( response.result.name !== undefined && response.result.name !== null ){
                        model.data.googleReviewsState( true );
                        model.data.googleReviews ( response.result );
                    }else{
                        model.data.googleReviewsState( false );
                        model.data.googleReviews ( response.result );
                    }
                }).catch(function(err){
                    model.data.googleReviewsState( false );
                    model.data.googleReviews ( response.result );
                });
    },

    //////////////////////////////////////////////////////////////////////
    ///////////////// BOTON CONSULTAR

    obtenerFormularioConsulta : function(){
        var self = this;
        var arrCategorias = [];
        var options = {};
        options.tipoFuncionalidad = 'formulario_de_consulta';
        controller.obtenerFormularioConsulta( options )
                .then(function( res ){
                    var paginaFormulario = tiendasimple.front.Pagina.createInstance(res.result);
                    model.data.paginaFormulario = paginaFormulario;
                }).catch(function(err){
                    // catch err
                });
    },

});


/* /js/front/fronttienda_model_files.js
 * compresion time: 0.02122 -(ms)
 * ------------------------------------ */
$.namespace('tiendasimple.front');

/**
 * Blog
 */

tiendasimple.front.Files = ko.ViewModel.extend({

    _mappeable: {
	},
	
	_defaults: {
    },
    
	_mapping: {   
	},
	
	init : function(){	
		this._parent.apply(this,arguments);
		this.makeEditable([]);
		this._createValidations();
        this._createComputed();
    },

    _createComputed : function(){
	},
	
	_createValidations: function(){
		this._parent();
    },
    
    getTokenForUpload : function(){
        var token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjEwMDg0MywiYXVkIjoiIiwiZGF0YSI6eyJpZE1hcmtldCI6IjEwMDc5MyJ9LCJpc3MiOiJodHRwOlwvXC8xMjcuMC4wLjE6ODAwMFwvYXBpXC9sb2dpbiIsImlhdCI6MTU5MDQ5ODExMiwiZXhwIjoxNTkwNTAxNzEyLCJuYmYiOjE1OTA0OTgxMTIsImp0aSI6ImlaQWtZSU1XTFkza1J3NGMiLCJwcnYiOiI4N2UwYWYxZWY5ZmQxNTgxMmZkZWM5NzE1M2ExNGUwYjA0NzU0NmFhIiwidXNlciI6eyJpZCI6MTAwODQzfX0.3xhAyencmOw3xaB9RBtYx5VgjUakoIZAZFn13vO5tQw';
        return token;
        /*
        var self = this;
        var arrCategorias = [];
        var options = self.obtenerOpcionesDefault();
        options.origen = 1;
        controller.obtenerCategoriasBlog( options )
                .then(function( response ){
                    self.chequearUrl( response );
                    if (response.result.recordset){
                        response.result.recordset.forEach(function(categoria){
                            var cat = [];
                            cat['id'] = categoria.id;
                            cat['entradas'] = categoria.entradas;
                            cat['nombre'] = categoria.traducciones[0].nombre;
                            cat['slug'] = categoria.traducciones[0].slug;
                            arrCategorias.push( cat );
                        });
                        self.categorias = arrCategorias;
                    }
                }).catch(function(err){
                    console.log('err =>', err);
                    //self.redireccionarHome();
                });
    }
    */
    }
});


